---
uid: web-pages/overview/data/7-displaying-data-in-a-chart
title: ASP.NET Web ページを使用したグラフでのデータの表示 (Razor) |Microsoft Docs
author: microsoft
description: この章では、グラフにデータを表示する方法について説明します。 前の章では、データを手動でグリッドに表示する方法について学習しました。 この章では次のことについて説明します。
ms.author: riande
ms.date: 05/22/2012
ms.assetid: f889fd46-4dac-4ecb-83d8-60e64c22036e
msc.legacyurl: /web-pages/overview/data/7-displaying-data-in-a-chart
msc.type: authoredcontent
ms.openlocfilehash: 6dad67d4e3d38d57a761c567d937d714a3184ea9
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78509134"
---
# <a name="displaying-data-in-a-chart-with-aspnet-web-pages-razor"></a>ASP.NET Web ページを使用したグラフでのデータの表示 (Razor)

[Microsoft](https://github.com/microsoft)

> この記事では、`Chart` ヘルパーを使用して、グラフを使用して ASP.NET Web ページ (Razor) web サイトにデータを表示する方法について説明します。
> 
> **学習内容**:
> 
> - グラフにデータを表示する方法。
> - 組み込みのテーマを使用してグラフのスタイルを作成する方法。
> - グラフを保存する方法と、グラフをキャッシュしてパフォーマンスを向上させる方法について説明します。
> 
> この記事で紹介する ASP.NET プログラミング機能を次に示します。
> 
> - `Chart` ヘルパー。
> 
> > [!NOTE]
> > この記事の情報は、ASP.NET Web ページ1.0 と Web ページ2に適用されます。

<a id="The_Chart_Helper"></a>
## <a name="the-chart-helper"></a>グラフヘルパー

データをグラフィカルな形式で表示するには、`Chart` ヘルパーを使用します。 `Chart` ヘルパーは、さまざまな種類のグラフでデータを表示する画像を表示できます。 書式設定とラベル付けに関する多くのオプションがサポートされています。 `Chart` helper では、30種類を超えるグラフを表示できます。これには、Microsoft Excel や他のツール&#8212;領域グラフ、横棒グラフ、縦棒グラフ、折れ線グラフ、円グラフなど、さまざまなグラフの種類が含まれます。これには、株価チャートのような特殊なグラフも含まれます。

| **面グラフ**![説明: 面グラフの画像の画像](7-displaying-data-in-a-chart/_static/image1.jpg) | **横棒グラフ**![説明: 横棒グラフの画像の画像](7-displaying-data-in-a-chart/_static/image2.jpg) |
| --- | --- |
| **縦棒グラフ**![説明: 縦棒グラフの画像](7-displaying-data-in-a-chart/_static/image3.jpg) | **折れ線グラフ**![説明: 折れ線グラフの画像](7-displaying-data-in-a-chart/_static/image4.jpg) |
| **円グラフ**![説明: 円グラフの種類の画像](7-displaying-data-in-a-chart/_static/image5.jpg) | **株価チャート**![説明: 株価チャートの画像](7-displaying-data-in-a-chart/_static/image6.jpg) |

### <a name="chart-elements"></a>グラフ要素

グラフには、データと、凡例、軸、系列などの追加の要素が表示されます。 次の図は、`Chart` ヘルパーを使用してカスタマイズできるグラフ要素の多くを示しています。 この記事では、これらの要素の一部 (すべてではない) を設定する方法について説明します。

![説明: グラフ要素を示す画像](7-displaying-data-in-a-chart/_static/image7.jpg)

<a id="Creating_a_Chart"></a>
## <a name="creating-a-chart-from-data"></a>データからのグラフの作成

グラフに表示されるデータは、配列、データベースから返された結果、または XML ファイル内のデータから取得できます。

### <a name="using-an-array"></a>配列の使用

「 [Razor 構文を使用した ASP.NET Web ページプログラミングの概要](https://go.microsoft.com/fwlink/?LinkId=202890)」で説明したように、配列を使用すると、類似した項目のコレクションを1つの変数に格納できます。 配列を使用して、グラフに含めるデータを含めることができます。

この手順では、既定のグラフの種類を使用して、配列内のデータからグラフを作成する方法について説明します。 また、ページ内にグラフを表示する方法についても説明します。

1. *Chartarraybasic. cshtml*という名前の新しいファイルを作成します。
2. 既存のコンテンツを次の内容に置き換えます。 

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample1.cshtml)]

    このコードでは、まず新しいグラフを作成し、その幅と高さを設定します。 `AddTitle` メソッドを使用して、グラフのタイトルを指定します。 データを追加するには、`AddSeries` メソッドを使用します。 この例では、`AddSeries` メソッドの `name`、`xValue`、および `yValues` パラメーターを使用します。 `name` パラメーターがグラフの凡例に表示されます。 `xValue` パラメーターには、グラフの横軸に沿って表示されるデータの配列が含まれています。 `yValues` パラメーターには、グラフの垂直点をプロットするために使用されるデータの配列が含まれています。

    `Write` メソッドは、実際にグラフをレンダリングします。 この場合、グラフの種類を指定しなかったため、`Chart` ヘルパーは既定のグラフ (縦棒グラフ) をレンダリングします。
3. ブラウザーでページを実行します。 ブラウザーにグラフが表示されます。 

    ![](7-displaying-data-in-a-chart/_static/image8.jpg)

### <a name="using-a-database-query-for-chart-data"></a>グラフデータに対するデータベースクエリの使用

グラフ化する情報がデータベース内にある場合は、データベースクエリを実行し、結果のデータを使用してグラフを作成できます。 この手順では、「 [ASP.NET Web ページサイトでのデータベースの操作の概要](https://go.microsoft.com/fwlink/?LinkId=202893)」で作成したデータベースからデータを読み取り、表示する方法について説明します。

1. フォルダーがまだ存在しない場合は、*アプリ\_データ*フォルダーを web サイトのルートに追加します。
2. [ *App\_Data* ] フォルダーで、「 [ASP.NET Web ページサイトでのデータベースの操作の概要](https://go.microsoft.com/fwlink/?LinkId=202893)」で説明されている*SmallBakery*という名前のデータベースファイルを追加します。
3. *ChartDataQuery*という名前の新しいファイルを作成します。
4. 既存のコンテンツを次の内容に置き換えます。   

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample2.cshtml)]

    このコードは、まず SmallBakery データベースを開き、`db`という名前の変数に割り当てます。 この変数は、データベースの読み取りと書き込みに使用できる `Database` オブジェクトを表します。 次に、このコードでは、各製品の名前と価格を取得するために SQL クエリを実行します。 このコードでは、グラフの `DataBindTable` メソッドを呼び出すことによって、新しいグラフを作成し、そのグラフにデータベースクエリを渡します。 このメソッドは、2つのパラメーターを受け取ります。 `dataSource` パラメーターはクエリのデータ用で、`xField` パラメーターを使用すると、グラフの x 軸に使用するデータ列を設定できます。

    `DataBindTable` メソッドを使用する代わりに、`Chart` ヘルパーの `AddSeries` メソッドを使用することもできます。 `AddSeries` メソッドを使用すると、`xValue` と `yValues` パラメーターを設定できます。 たとえば、次のように `DataBindTable` メソッドを使用するのではなく、

    [!code-css[Main](7-displaying-data-in-a-chart/samples/sample3.css)]

    次のように `AddSeries` メソッドを使用できます。

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample4.html)]

    どちらも同じ結果を表示します。 `AddSeries` メソッドは、グラフの種類とデータをより明示的に指定できるため、より柔軟ですが、追加の柔軟性が不要な場合は、`DataBindTable` 方法を使用する方が簡単です。
5. ブラウザーでページを実行します。 

    ![](7-displaying-data-in-a-chart/_static/image9.jpg)

### <a name="using-xml-data"></a>XML データの使用

グラフのデータとして XML ファイルを使用すると、グラフを作成できます。 このためには、xml ファイルに XML 構造を記述するスキーマファイル ( *.xsd*ファイル) も含まれている必要があります。 この手順では、XML ファイルからデータを読み取る方法について説明します。

1. *App\_data*フォルダーで、 *data .xml*という名前の新しい xml ファイルを作成します。
2. 既存の XML を次のコードに置き換えます。これは、架空の会社の従業員に関する XML データです。 

    [!code-xml[Main](7-displaying-data-in-a-chart/samples/sample5.xml)]
3. *App\_data*フォルダーで、 *data .xsd*という名前の新しい XML ファイルを作成します。 (この拡張子は *.xsd*です)。
4. 既存の XML を次のように置き換えます。 

    [!code-xml[Main](7-displaying-data-in-a-chart/samples/sample6.xml)]
5. Web サイトのルートで、 *Chartdataxml*という名前の新しいファイルを作成します。
6. 既存のコンテンツを次の内容に置き換えます。 

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample7.cshtml)]

    このコードでは、最初に `DataSet` オブジェクトを作成します。 このオブジェクトは、XML ファイルから読み取られたデータを管理し、スキーマファイル内の情報に従って編成するために使用されます。 (コードの先頭にステートメント `using SystemData`が含まれていることに注意してください。 これは、`DataSet` オブジェクトを操作できるようにするために必要です。 詳細については、この記事で後述[する「&quot; ステートメントと完全修飾名の使用&quot;](#SB_UsingStatements) 」を参照してください)。

    次に、このコードはデータセットに基づいて `DataView` オブジェクトを作成します。 データビューには、グラフが読み取りとプロットに&#8212;バインドできるオブジェクトが用意されています。 このグラフは、前に示したように、`AddSeries` メソッドを使用してデータにバインドします。ただし、この時点では、`xValue` パラメーターと `yValues` パラメーターが `DataView` オブジェクトに設定されている点が異なります。

    この例では、特定のグラフの種類を指定する方法も示しています。 `AddSeries` メソッドにデータを追加すると、`chartType` パラメーターも円グラフを表示するように設定されます。
7. ブラウザーでページを実行します。 

    ![](7-displaying-data-in-a-chart/_static/image10.jpg)

> [!TIP]
> 
> <a id="SB_UsingStatements"></a>
> ### <a name="using-statements-and-fully-qualified-names"></a>"Using" ステートメントと完全修飾名
> 
> Razor 構文で ASP.NET Web ページする .NET Framework は、数千のコンポーネント (クラス) で構成されています。 これらのすべてのクラスを使用して管理できるようにするために、ライブラリのような*名前空間*に編成されています。 たとえば、`System.Web` 名前空間には、ブラウザーとサーバー間の通信をサポートするクラスが含まれています。 `System.Xml` 名前空間には、XML ファイルの作成と読み取りに使用されるクラスが含まれています。また、`System.Data` 名前空間には、データを操作できるクラスが含まれています。
> 
> .NET Framework 内の特定のクラスにアクセスするには、クラス名だけでなく、クラスが含まれている名前空間も認識している必要があります。 たとえば、`Chart` ヘルパーを使用するには、コードで `System.Web.Helpers.Chart` クラスを検索する必要があります。これにより、名前空間 (`System.Web.Helpers`) とクラス名 (`Chart`) が結合されます。 これは、クラスの*完全修飾*名&#8212;として知られており、.NET Framework の内部では明確な場所になります。 コードでは、これは次のようになります。
> 
> `var myChart = new System.Web.Helpers.Chart(width: 600, height: 400) // etc.`
> 
> ただし、クラスまたはヘルパーを参照するたびに、これらの長い完全修飾名を使用する必要はありません (エラーが発生しやすくなります)。 したがって、クラス名の使用を容易にするために、興味のある名前空間を*インポート*できます。通常は、.NET Framework 内の多数の名前空間のうち、ごく一部にすぎません。 名前空間をインポートした場合は、完全修飾名 (`System.Web.Helpers.Chart`) の代わりにクラス名 (`Chart`) のみを使用できます。 コードを実行してクラス名を検出すると、そのクラスを検索するためにインポートした名前空間だけが検索されます。
> 
> Razor 構文で ASP.NET Web ページを使用して Web ページを作成する場合、通常は、`WebPage` クラス、さまざまなヘルパーなどを含む、毎回同じクラスのセットを使用します。 Web サイトを作成するたびに関連する名前空間をインポートする作業を節約するために、ASP.NET は、すべての web サイトの一連のコア名前空間を自動的にインポートするように構成されています。 このため、名前空間を使用したり、今までインポートしたりする必要はありませんでした。作業したすべてのクラスは、既にインポートされている名前空間にあります。
> 
> ただし、場合によっては、自動的にインポートされる名前空間に含まれていないクラスを使用する必要があります。 その場合は、そのクラスの完全修飾名を使用するか、クラスを含む名前空間を手動でインポートすることができます。 名前空間をインポートするには、前述の記事の例のように、`using` ステートメント (Visual Basic の`import`) を使用します。
> 
> たとえば、`DataSet` クラスは `System.Data` 名前空間にあります。 ASP.NET Razor ページでは、`System.Data` 名前空間を自動的に使用することはできません。 そのため、完全修飾名を使用して `DataSet` クラスを操作するには、次のようなコードを使用できます。
> 
> `var dataSet = new System.Data.DataSet();`
> 
> `DataSet` クラスを繰り返し使用する必要がある場合は、次のような名前空間をインポートし、コードでクラス名だけを使用することができます。
> 
> [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample8.cshtml)]
> 
> 参照する他のすべての .NET Framework 名前空間に `using` ステートメントを追加できます。 ただし、前述のように、この操作は頻繁に行う必要はありません *。* これは、使用するクラスのほとんどが、ASP.NET ページおよび*vbhtml*ページで使用するために自動的にインポートされる名前空間にあるためです。

<a id="Displaying_Charts"></a>
## <a name="displaying-charts-inside-a-web-page"></a>Web ページ内のグラフの表示

これまでに見た例では、グラフを作成し、グラフをグラフィックとして直接ブラウザーにレンダリングします。 ただし、多くの場合、ブラウザーではなく、ページの一部としてグラフを表示する必要があります。 これを行うには、2段階のプロセスが必要です。 最初の手順では、既に説明したように、グラフを生成するページを作成します。

2番目の手順では、結果として得られるイメージを別のページに表示します。 画像を表示するには、画像を表示する場合と同じように、HTML `<img>` 要素を使用します。 ただし、 *.jpg*ファイルまたは *.png*ファイルを参照するのではなく、`<img>` 要素は、グラフを作成する `Chart` ヘルパーを含む*cshtml*ファイルを参照します。 表示ページを実行すると、`<img>` 要素によって `Chart` ヘルパーの出力が取得され、グラフがレンダリングされます。

![](7-displaying-data-in-a-chart/_static/image11.jpg)

1. *Showchart. cshtml*という名前のファイルを作成します。
2. 既存のコンテンツを次の内容に置き換えます。 

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample9.html)]

    このコードでは、`<img>` 要素を使用して、以前に作成したグラフをグラフに表示*します。*
3. ブラウザーで web ページを実行します。 *Showchart.* cshtml ファイルには、グラフイメージが表示されます。これは、 *chartarraybasic の cshtml*ファイルに含まれるコードに基づいています。

<a id="Styling_a_Chart"></a>
## <a name="styling-a-chart"></a>グラフのスタイル設定

`Chart` helper では、グラフの外観をカスタマイズできる多数のオプションがサポートされています。 色、フォント、罫線などを設定できます。 グラフの外観をカスタマイズする簡単な方法は、*テーマ*を使用することです。 テーマは、フォント、色、ラベル、パレット、枠線、効果を使用したグラフの表示方法を指定する情報の集まりです。 (グラフのスタイルは、グラフの種類を示すものではないことに注意してください)。

次の表に、組み込みのテーマを示します。

| テーマ | Description |
| --- | --- |
| `Vanilla` | 白い背景に赤い縦棒を表示します。 |
| `Blue` | 青いグラデーションの背景に青い縦棒を表示します。 |
| `Green` | 青い縦棒を緑色の背景に表示します。 |
| `Yellow` | 黄色のグラデーションの背景にオレンジ色の列を表示します。 |
| `Vanilla3D` | 白い背景に3-d の赤い縦棒を表示します。 |

新しいグラフを作成するときに使用するテーマを指定できます。

1. *Chartスタイルの green. cshtml*という名前の新しいファイルを作成します。
2. ページ内の既存のコンテンツを次の内容に置き換えます。

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample10.cshtml)]

    このコードは、データベースをデータに使用する前の例と同じですが、`Chart` オブジェクトを作成するときに `theme` パラメーターを追加します。 次に、変更されたコードを示します。

    [!code-csharp[Main](7-displaying-data-in-a-chart/samples/sample11.cs)]
3. ブラウザーでページを実行します。 前と同じデータが表示されますが、グラフは洗練された外観になります。 

    ![](7-displaying-data-in-a-chart/_static/image12.jpg)

<a id="Saving_a_Chart"></a>
## <a name="saving-a-chart"></a>グラフの保存

この記事で既に説明したように `Chart` ヘルパーを使用すると、ヘルパーは、呼び出されるたびにグラフをゼロから再作成します。 必要に応じて、グラフのコードもデータベースに再クエリを行うか、XML ファイルを再読み込みしてデータを取得します。 場合によっては、クエリを実行するデータベースが大きい場合や XML ファイルに大量のデータが含まれている場合など、複雑な操作を行うことがあります。 グラフに大量のデータが含まれていない場合でも、イメージを動的に作成するプロセスではサーバーリソースが消費され、多くのユーザーがそのグラフを表示するページを要求すると、web サイトのパフォーマンスに影響を与える可能性があります。

グラフを作成した場合のパフォーマンスへの影響を軽減するために、最初に必要になったときにグラフを作成して保存することができます。 グラフが再生成されるのではなく、再び必要になった場合は、保存したバージョンを取得してレンダリングするだけで済みます。

次の方法でグラフを保存できます。

- サーバー上のコンピューターメモリにグラフをキャッシュします。
- グラフをイメージファイルとして保存します。
- グラフを XML ファイルとして保存します。 このオプションを使用すると、グラフを保存する前に変更できます。

### <a name="caching-a-chart"></a>グラフのキャッシュ

グラフを作成したら、それをキャッシュすることができます。 グラフをキャッシュすることは、再度表示する必要がある場合に再作成する必要がないことを意味します。 キャッシュにグラフを保存するときは、そのグラフに一意のキーを指定します。

キャッシュに保存されたグラフは、サーバーのメモリが不足している場合に削除される可能性があります。 また、アプリケーションが何らかの理由で再起動した場合、キャッシュはクリアされます。 そのため、キャッシュされたグラフを使用する標準的な方法は、キャッシュで使用できるかどうかを最初に確認し、存在しない場合は作成または再作成することです。

1. Web サイトのルートで、 *ShowCachedChart*という名前のファイルを作成します。
2. 既存のコンテンツを次の内容に置き換えます。 

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample12.html)]

    `<img>` タグには、 *ChartSaveToCache*ファイルを参照し、キーをクエリ文字列としてページに渡す `src` 属性が含まれています。 このキーには、myChartKey&quot;&quot;値が含まれています。 *ChartSaveToCache*ファイルには、グラフを作成する `Chart` ヘルパーが含まれています。 このページはすぐに作成します。

    ページの最後に、 *Clearcache. cshtml*という名前のページへのリンクがあります。 後でも作成するページです。 *Clearcache*は、この例のキャッシュをテストする場合にのみ必要です。キャッシュされたグラフを操作するときに通常含めるリンクやページではありません。
3. Web サイトのルートで、 *ChartSaveToCache*という名前の新しいファイルを作成します。
4. 既存のコンテンツを次の内容に置き換えます。

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample13.cshtml)]

    このコードでは、クエリ文字列のキー値として渡されたものがあるかどうかを最初に確認します。 その場合、コードは `GetFromCache` メソッドを呼び出してキーを渡すことによって、キャッシュからグラフを読み取ります。 このキーの下にキャッシュに何もないことが判明した場合 (グラフが初めて要求されたときに発生します)、このコードでは通常どおりにグラフが作成されます。 グラフが完成すると、コードは `SaveToCache`を呼び出してキャッシュに保存します。 このメソッドにはキー (後でグラフを要求できるようにするため) と、グラフをキャッシュに保存する時間の長さが必要です。 (グラフをキャッシュする正確な時間は、そのグラフが表すデータが変更される可能性があると思われる頻度によって異なります)。`SaveToCache` メソッドでは、この値が&#8212; true に設定されている場合にも `slidingExpiration` パラメーターが必要です。この場合、グラフにアクセスするたびにタイムアウトカウンターがリセットされます。 この場合、これは、グラフにだれかが最後にアクセスしたときから、グラフのキャッシュエントリの有効期限が2分に切れることを意味します。 (スライド式有効期限の代わりには絶対有効期限があります。つまり、キャッシュエントリがキャッシュに格納されてから、キャッシュエントリがアクセスされた頻度にかかわらず、正確に2分が経過することを意味します)。

    最後に、`WriteFromCache` メソッドを使用して、キャッシュからグラフを取得して表示します。 このメソッドはキャッシュをチェックする `if` ブロックの外側にあることに注意してください。これは、グラフがキャッシュから取得されるか、生成されてキャッシュに保存される必要があるかどうかをキャッシュから取得するためです。

    この例では、`AddTitle` メソッドにタイムスタンプが含まれていることに注意してください。 (これにより、現在の日付&#8212;と&#8212;時刻 `DateTime.Now` がタイトルに追加されます)。
5. *Clearcache. cshtml*という名前の新しいページを作成し、その内容を次のように置き換えます。

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample14.cshtml)]

    このページでは、`WebCache` ヘルパーを使用して、 *ChartSaveToCache*にキャッシュされているグラフを削除します。 既に説明したように、通常、このようなページは必要ありません。 ここで作成するのは、キャッシュを簡単にテストできるようにするためだけです。
6. ブラウザーで*ShowCachedChart* web ページを実行します。 このページには、 *ChartSaveToCache*ファイルに含まれているコードに基づいてグラフイメージが表示されます。 タイムスタンプがグラフのタイトルに表示されていることを確認します。 

    ![説明: グラフのタイトルにタイムスタンプが付いた基本的なグラフの画像](7-displaying-data-in-a-chart/_static/image13.jpg)
7. ブラウザーを閉じます。
8. *ShowCachedChart*をもう一度実行します。 タイムスタンプは前と同じであることに注意してください。これは、グラフが再生成されず、代わりにキャッシュから読み取られたことを示します。
9. *ShowCachedChart*で、 **[キャッシュのクリア]** リンクをクリックします。 これにより、キャッシュがクリアされたことを報告する*Clearcache. cshtml*に移動します。
10. **[ShowCachedChart に戻る]** リンクをクリックするか、WebMatrix から*ShowCachedChart*を再実行します。 この時点で、キャッシュがクリアされているため、タイムスタンプが変更されていることに注意してください。 そのため、コードでは、グラフを再生成してキャッシュに戻す必要がありました。

### <a name="saving-a-chart-as-an-image-file"></a>画像ファイルとしてグラフを保存する

また、グラフをイメージファイル ( *.jpg*ファイルなど) としてサーバーに保存することもできます。 これにより、イメージファイルを任意のイメージとして使用できます。 この利点は、一時キャッシュに保存されるのではなく、ファイルが格納されることです。 新しいグラフイメージを異なるタイミング (たとえば、1時間ごと) に保存し、時間の経過と共に発生する変更の永続的な記録を保持することができます。 Web アプリケーションが、イメージファイルを配置するサーバー上のフォルダーにファイルを保存するためのアクセス許可を持っていることを確認する必要があることに注意してください。

1. Web サイトのルートで、 *\_ChartFiles*という名前のフォルダーを作成します (まだ存在していない場合)。
2. Web サイトのルートで、 *Chartsave. cshtml*という名前の新しいファイルを作成します。
3. 既存のコンテンツを次の内容に置き換えます。

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample15.cshtml)]

    このコードでは、まず、`File.Exists` メソッドを呼び出すことによって、 *.jpg*ファイルが存在するかどうかを確認します。 ファイルが存在しない場合、コードは配列から新しい `Chart` を作成します。 このとき、コードは `Save` メソッドを呼び出し、`path` パラメーターを渡して、グラフを保存するファイルパスとファイル名を指定します。 ページの本文では、`<img>` 要素は、表示する *.jpg*ファイルを指すパスを使用します。
4. *Chartsave. cshtml*ファイルを実行します。
5. WebMatrix に戻ります。 *Chart01*という名前のイメージファイルが *\_chartfiles*フォルダーに保存されていることに注意してください。

### <a name="saving-a-chart-as-an-xml-file"></a>グラフを XML ファイルとして保存する

最後に、グラフを XML ファイルとしてサーバーに保存できます。 グラフのキャッシュまたはファイルへのグラフの保存にこの方法を使用する利点は、必要に応じて、グラフを表示する前に XML を変更できることです。 アプリケーションは、イメージファイルを配置するサーバー上のフォルダーに対する読み取り/書き込みアクセス許可を持っている必要があります。

1. Web サイトのルートで、 *ChartSaveXml*という名前の新しいファイルを作成します。
2. 既存のコンテンツを次の内容に置き換えます。

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample16.cshtml)]

    このコードは、XML ファイルを使用する点を除いて、キャッシュにグラフを格納するために前に見たコードに似ています。 このコードでは、まず、`File.Exists` メソッドを呼び出して XML ファイルが存在するかどうかを確認します。 ファイルが存在する場合、コードは新しい `Chart` オブジェクトを作成し、ファイル名を `themePath` パラメーターとして渡します。 これにより、XML ファイル内の内容に基づいてグラフが作成されます。 XML ファイルがまだ存在しない場合は、通常のようなグラフが作成され、`SaveXml` が呼び出されて保存されます。 前に見たように、`Write` メソッドを使用してグラフが表示されます。

    キャッシュを表示したページと同様に、このコードではグラフのタイトルにタイムスタンプが含まれています。
3. *Chartdisplayxmlchart. cshtml*という名前の新しいページを作成し、次のマークアップを追加します。 

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample17.html)]
4. *Chartpage*を実行します。 グラフが表示されます。 グラフのタイトルのタイムスタンプをメモしておきます。
5. ブラウザーを閉じます。
6. WebMatrix で、[ *\_ChartFiles* ] フォルダーを右クリックし、 **[更新]** をクリックして、フォルダーを開きます。 このフォルダー内の*Xmlchart .xml*ファイルは、`Chart` ヘルパーによって作成されています。 

    ![説明: グラフヘルパーによって作成された XMLChart .xml ファイルを表示する _ChartFiles フォルダー。](7-displaying-data-in-a-chart/_static/image14.jpg)
7. もう一度、 *Chartdisplayxmlchart. cshtml*ページを実行します。 グラフには、ページを初めて実行したときと同じタイムスタンプが表示されます。 これは、前に保存した XML からグラフが生成されているためです。
8. WebMatrix で、[ *\_ChartFiles* ] フォルダーを開き、 *xmlchart .xml*ファイルを削除します。
9. さらに1回、 *Chartdisplayxmlchart. cshtml*ページを実行します。 今回は、`Chart` ヘルパーが XML ファイルを再作成する必要があったため、タイムスタンプが更新されます。 必要に応じて、[ *\_ChartFiles* ] フォルダーをチェックし、XML ファイルが返されていることを確認します。

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>その他のリソース

- [ASP.NET Web ページサイトでのデータベースの操作の概要](https://go.microsoft.com/fwlink/?LinkId=202893)
- [ASP.NET Web ページサイトでキャッシュを使用してパフォーマンスを向上させる](https://go.microsoft.com/fwlink/?LinkId=202903)
- [Chart クラス](https://msdn.microsoft.com/library/system.web.helpers.chart(v=vs.99))(MSDN の ASP.NET Web ページ API リファレンス)
