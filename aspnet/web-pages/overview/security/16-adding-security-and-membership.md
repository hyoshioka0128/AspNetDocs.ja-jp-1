---
uid: web-pages/overview/security/16-adding-security-and-membership
title: ASP.NET Web ページ (Razor) サイトへのセキュリティとメンバーシップの追加 |Microsoft Docs
author: Rick-Anderson
description: この章では、ログインしているユーザーのみが使用できるように web サイトをセキュリティで保護する方法について説明します。 (ページ tha を作成する方法についても説明します。
ms.author: riande
ms.date: 02/24/2014
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: 0be3e767a42939a3c343f6d4a730eb1d9a6b367c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78509902"
---
# <a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="271df-104">ASP.NET Web ページ (Razor) サイトへのセキュリティとメンバーシップの追加</span><span class="sxs-lookup"><span data-stu-id="271df-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>

<span data-ttu-id="271df-105">[Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="271df-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="271df-106">この記事では、ASP.NET Web ページ (Razor) web サイトをセキュリティで保護する方法について説明します。これにより、一部のページは、ログインしているユーザーのみが使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="271df-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="271df-107">(誰でもアクセスできるページの作成方法についても説明します)。</span><span class="sxs-lookup"><span data-stu-id="271df-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="271df-108">**学習内容:**</span><span class="sxs-lookup"><span data-stu-id="271df-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="271df-109">登録ページとログインページを持つ web サイトを作成する方法。一部のページでは、アクセスをメンバーのみに制限できるようにします。</span><span class="sxs-lookup"><span data-stu-id="271df-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="271df-110">パブリックページとメンバー専用ページを作成する方法。</span><span class="sxs-lookup"><span data-stu-id="271df-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="271df-111">役割を定義する方法 (サイトに対して異なるセキュリティアクセス許可を持つグループ)、およびユーザーをロールに割り当てる方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="271df-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="271df-112">CAPTCHA を使用して、自動プログラム (ボット) がメンバーアカウントを作成できないようにする方法。</span><span class="sxs-lookup"><span data-stu-id="271df-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="271df-113">この記事で導入された ASP.NET 機能を次に示します。</span><span class="sxs-lookup"><span data-stu-id="271df-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="271df-114">WebMatrix**スターターサイト**テンプレート。</span><span class="sxs-lookup"><span data-stu-id="271df-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="271df-115">`WebSecurity` helper および `Roles` クラス。</span><span class="sxs-lookup"><span data-stu-id="271df-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="271df-116">`ReCaptcha` ヘルパー。</span><span class="sxs-lookup"><span data-stu-id="271df-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="271df-117">このチュートリアルで使用されているソフトウェアのバージョン</span><span class="sxs-lookup"><span data-stu-id="271df-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="271df-118">ASP.NET Web ページ (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="271df-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="271df-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="271df-119">WebMatrix 3</span></span>
> - <span data-ttu-id="271df-120">ASP.NET Web ヘルパーライブラリ</span><span class="sxs-lookup"><span data-stu-id="271df-120">ASP.NET Web Helpers Library</span></span>

<span data-ttu-id="271df-121">サイトが&#8212; *メンバーシップ*をサポートするように、web サイトをセットアップすることができます。</span><span class="sxs-lookup"><span data-stu-id="271df-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="271df-122">これは、さまざまな理由で役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="271df-122">This can be useful for many reasons.</span></span> <span data-ttu-id="271df-123">たとえば、メンバーだけが使用できるページがサイトに存在する場合があります。</span><span class="sxs-lookup"><span data-stu-id="271df-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="271df-124">場合によっては、フィードバックを送信したりコメントを残したりするためにユーザーにログインすることが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="271df-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="271df-125">Web サイトでメンバーシップがサポートされている場合でも、ユーザーはサイトの一部のページを使用する前に、必ずしもログインする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="271df-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="271df-126">ログインしていないユーザーは、*匿名ユーザー*と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="271df-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="271df-127">ユーザーは、web サイトに登録して、サイトにログインできます。</span><span class="sxs-lookup"><span data-stu-id="271df-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="271df-128">Web サイトには、ユーザー名 (電子メールアドレス) とパスワードを入力して、ユーザーが要求していることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="271df-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="271df-129">このようにログインし、ユーザーの id を確認するプロセスは、*認証*と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="271df-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="271df-130">セキュリティとメンバーシップは、さまざまな方法で設定できます。</span><span class="sxs-lookup"><span data-stu-id="271df-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="271df-131">WebMatrix を使用している場合、簡単な方法は、**スタートサイト**テンプレートに基づいて新しいサイトを作成することです。</span><span class="sxs-lookup"><span data-stu-id="271df-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="271df-132">このテンプレートは既にセキュリティとメンバーシップ用に構成されており、登録ページ、ログインページなどが既に存在します。</span><span class="sxs-lookup"><span data-stu-id="271df-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="271df-133">テンプレートによって作成されたサイトには、ユーザーが Facebook、Google、Twitter などの外部サイトを使用してログインできるようにするオプションもあります。</span><span class="sxs-lookup"><span data-stu-id="271df-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="271df-134">既存のサイトにセキュリティを追加する場合、または**スターターサイト**テンプレートを使用しない場合は、独自の登録ページやログインページなどを作成できます。</span><span class="sxs-lookup"><span data-stu-id="271df-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="271df-135">この記事では、**スターターサイト**テンプレートを使用してセキュリティを追加する方法 &mdash; 最初のオプションについて説明します。</span><span class="sxs-lookup"><span data-stu-id="271df-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="271df-136">また、独自のセキュリティを実装する方法についての基本的な情報を提供し、その方法に関する詳細情報へのリンクを示します。</span><span class="sxs-lookup"><span data-stu-id="271df-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="271df-137">外部ログインを有効にする方法についての情報もあります。詳細については、別の記事で説明します。</span><span class="sxs-lookup"><span data-stu-id="271df-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="271df-138">スターターサイトテンプレートを使用して Web サイトのセキュリティを作成する</span><span class="sxs-lookup"><span data-stu-id="271df-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="271df-139">WebMatrix では、**スターターサイト**テンプレートを使用して、次のものを含む web サイトを作成できます。</span><span class="sxs-lookup"><span data-stu-id="271df-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="271df-140">メンバーのユーザー名とパスワードを格納するために使用されるデータベース。</span><span class="sxs-lookup"><span data-stu-id="271df-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="271df-141">匿名 (新規) ユーザーが登録できる登録ページ。</span><span class="sxs-lookup"><span data-stu-id="271df-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="271df-142">ログインとログアウトのページ。</span><span class="sxs-lookup"><span data-stu-id="271df-142">A login and logout page.</span></span>
- <span data-ttu-id="271df-143">パスワードの回復とリセットのページ。</span><span class="sxs-lookup"><span data-stu-id="271df-143">A password recovery and reset page.</span></span>

<span data-ttu-id="271df-144">次の手順では、サイトを作成して構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="271df-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="271df-145">WebMatrix を起動し、 **[クイックスタート]** ページで、 **[テンプレートからサイト]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="271df-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="271df-146">**スターターサイト**テンプレートを選択し、[ **OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="271df-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="271df-147">WebMatrix によって新しいサイトが作成されます。</span><span class="sxs-lookup"><span data-stu-id="271df-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="271df-148">左側のウィンドウで、 **[ファイル]** ワークスペースセレクターをクリックします。</span><span class="sxs-lookup"><span data-stu-id="271df-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="271df-149">Web サイトのルートフォルダーで、 *\_該当*ファイルを開きます。このファイルは、グローバル設定を格納するために使用される特殊なファイルです。</span><span class="sxs-lookup"><span data-stu-id="271df-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="271df-150">ここには、`//` 文字を使用してコメントアウトされたステートメントがいくつか含まれています。</span><span class="sxs-lookup"><span data-stu-id="271df-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="271df-151">これらのステートメントは、電子メールの送信に使用できる `WebMail` ヘルパーを構成します。</span><span class="sxs-lookup"><span data-stu-id="271df-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="271df-152">メンバーシップシステムは、ユーザーが登録するとき、またはパスワードを変更するときに、電子メールを使用して確認メッセージを送信できます。</span><span class="sxs-lookup"><span data-stu-id="271df-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="271df-153">(たとえば、ユーザーが登録した後、登録プロセスを完了するためにクリックできるリンクを含む電子メールが届きます)。</span><span class="sxs-lookup"><span data-stu-id="271df-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="271df-154">電子メールを送信するには、「 [ASP.NET Web ページサイトに電子メールを追加](https://go.microsoft.com/fwlink/?LinkId=202899)する」の説明に従って、SMTP サーバーにアクセスする必要があります。</span><span class="sxs-lookup"><span data-stu-id="271df-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="271df-155">電子メールの設定を*該当ファイル\_* に保存し、電子メールを送信できる各ページに繰り返しコードを記述する必要がないようにします。</span><span class="sxs-lookup"><span data-stu-id="271df-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="271df-156">(SMTP 設定を構成して登録データベースを設定する必要はありません。電子メールエイリアスからユーザーを検証し、ユーザーが忘れたパスワードをリセットできるようにする場合にのみ、SMTP 設定が必要です)。</span><span class="sxs-lookup"><span data-stu-id="271df-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="271df-157">ステートメントをコメント解除するには、各ステートメントの先頭から `//` を削除します。</span><span class="sxs-lookup"><span data-stu-id="271df-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="271df-158">電子メールの確認を設定しない場合は、この手順と次の手順を省略できます。</span><span class="sxs-lookup"><span data-stu-id="271df-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="271df-159">SMTP の値が設定されていない場合は、確認の電子メールを送信せずに、新しいアカウントをすぐに使用できます。</span><span class="sxs-lookup"><span data-stu-id="271df-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="271df-160">コード内の次の電子メール関連の設定を変更します。</span><span class="sxs-lookup"><span data-stu-id="271df-160">Modify the following email-related settings in the code:</span></span>

   - <span data-ttu-id="271df-161">`WebMail.SmtpServer` に、アクセス権のある SMTP サーバーの名前を設定します。</span><span class="sxs-lookup"><span data-stu-id="271df-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
   - <span data-ttu-id="271df-162">`WebMail.EnableSsl` を `true`に設定したままにします。</span><span class="sxs-lookup"><span data-stu-id="271df-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="271df-163">この設定により、SMTP サーバーに送信される資格情報が暗号化されて保護されます。</span><span class="sxs-lookup"><span data-stu-id="271df-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
   - <span data-ttu-id="271df-164">`WebMail.UserName` を、SMTP サーバーアカウントのユーザー名に設定します。</span><span class="sxs-lookup"><span data-stu-id="271df-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
   - <span data-ttu-id="271df-165">`WebMail.Password` を SMTP サーバーアカウントのパスワードに設定します。</span><span class="sxs-lookup"><span data-stu-id="271df-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
   - <span data-ttu-id="271df-166">`WebMail.From` を独自の電子メールアドレスに設定します。</span><span class="sxs-lookup"><span data-stu-id="271df-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="271df-167">これは、メッセージの送信元の電子メールアドレスです。</span><span class="sxs-lookup"><span data-stu-id="271df-167">This is the email address that the message is sent from.</span></span>

     > [!NOTE] 
     > 
     > <span data-ttu-id="271df-168">**ヒント**これらのプロパティの値の詳細については、「 [ASP.NET Web ページのサイト全体の動作をカスタマイズ](https://go.microsoft.com/fwlink/?LinkID=202906)する」の「[電子メール設定の構成](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="271df-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="271df-169">該当を保存して *\_* 閉じます。</span><span class="sxs-lookup"><span data-stu-id="271df-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="271df-170">ブラウザーで*既定の cshtml*ページを実行します。</span><span class="sxs-lookup"><span data-stu-id="271df-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![セキュリティ-メンバーシップ-2](16-adding-security-and-membership/_static/image1.png)

   > [!NOTE]
   > <span data-ttu-id="271df-172">プロパティが `ExtendedMembershipProvider`のインスタンスである必要があることを示すエラーが表示された場合は、ASP.NET Web ページメンバーシップシステム (SimpleMembership) を使用するようにサイトが構成されていない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="271df-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="271df-173">これは、ホスティングプロバイダーのサーバーがローカルサーバーとは異なる方法で構成されている場合に発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="271df-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="271df-174">この問題を解決するには、次の要素をサイトの*web.config*ファイルに追加します。</span><span class="sxs-lookup"><span data-stu-id="271df-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
   > 
   > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
   > 
   > <span data-ttu-id="271df-175">この要素を `<configuration>` 要素の子として、`<system.web>` 要素のピアとして追加します。</span><span class="sxs-lookup"><span data-stu-id="271df-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="271df-176">ページの右上隅にある **[登録]** リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="271df-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="271df-177">[の*登録*] ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="271df-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="271df-178">ユーザー名とパスワードを入力し、 **[登録]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="271df-178">Enter a user name and password and then click **Register**.</span></span>

    ![セキュリティ-メンバーシップ-3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="271df-180">**スターターサイト**テンプレートから web サイトを作成した場合、サイトの*App\_Data*フォルダーに、 *startersite. .sdf*という名前のデータベースが作成されます。</span><span class="sxs-lookup"><span data-stu-id="271df-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="271df-181">登録時に、ユーザー情報がデータベースに追加されます。</span><span class="sxs-lookup"><span data-stu-id="271df-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="271df-182">SMTP の値を設定すると、登録を完了するために使用した電子メールアドレスにメッセージが送信されます。</span><span class="sxs-lookup"><span data-stu-id="271df-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![セキュリティ-メンバーシップ-4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="271df-184">電子メールプログラムにアクセスし、メッセージを検索します。このメッセージには、確認コードとサイトへのハイパーリンクが含まれています。</span><span class="sxs-lookup"><span data-stu-id="271df-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="271df-185">ハイパーリンクをクリックして、アカウントをアクティブ化します。</span><span class="sxs-lookup"><span data-stu-id="271df-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="271df-186">確認のハイパーリンクを開くと、[登録の確認] ページが開きます。</span><span class="sxs-lookup"><span data-stu-id="271df-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![セキュリティ-メンバーシップ-5](16-adding-security-and-membership/_static/image4.png)
13. <span data-ttu-id="271df-188">**[ログイン]** リンクをクリックし、登録したアカウントを使用してログインします。</span><span class="sxs-lookup"><span data-stu-id="271df-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

      <span data-ttu-id="271df-189">ログインすると、**ログイン**リンクと**登録**リンクが**ログアウト**リンクに置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="271df-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="271df-190">ログイン名がリンクとして表示されます。</span><span class="sxs-lookup"><span data-stu-id="271df-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="271df-191">(このリンクを使用すると、パスワードを変更できるページに移動できます)。</span><span class="sxs-lookup"><span data-stu-id="271df-191">(The link lets you go to a page where you can change your password.)</span></span>

      ![セキュリティ-メンバーシップ-6](16-adding-security-and-membership/_static/image5.png)

      > [!NOTE]
      > <span data-ttu-id="271df-193">既定では、ASP.NET web ページは、資格情報をクリアテキストでサーバーに送信します (人間が判読できるテキスト)。</span><span class="sxs-lookup"><span data-stu-id="271df-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="271df-194">運用サイトでは、サーバーと交換される機密情報を暗号化するために、セキュリティで保護された HTTP (https://、 *secure sockets layer*または SSL とも呼ばれます) を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="271df-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="271df-195">前の例のように `WebMail.EnableSsl=true` を設定することにより、SSL を使用して電子メールメッセージを送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="271df-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="271df-196">SSL の詳細については、「 [Web 通信をセキュリティで保護する: 証明書、SSL、および https://](https://go.microsoft.com/fwlink/?LinkId=208660)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="271df-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="271df-197">サイトの追加のメンバーシップ機能</span><span class="sxs-lookup"><span data-stu-id="271df-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="271df-198">サイトには、ユーザーが自分のアカウントを管理できるようにするその他の機能が含まれています。</span><span class="sxs-lookup"><span data-stu-id="271df-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="271df-199">ユーザーは次の操作を実行できます。</span><span class="sxs-lookup"><span data-stu-id="271df-199">Users can do the following:</span></span>

- <span data-ttu-id="271df-200">パスワードを変更します。</span><span class="sxs-lookup"><span data-stu-id="271df-200">Change their passwords.</span></span> <span data-ttu-id="271df-201">ログインした後、ユーザー名 (リンク) をクリックできます。</span><span class="sxs-lookup"><span data-stu-id="271df-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="271df-202">これにより、新しいパスワード (*Account/ChangePassword. cshtml*) を作成できるページに移動します。</span><span class="sxs-lookup"><span data-stu-id="271df-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="271df-203">忘れたパスワードを回復します。</span><span class="sxs-lookup"><span data-stu-id="271df-203">Recover a forgotten password.</span></span> <span data-ttu-id="271df-204">[ログイン] ページに、ユーザーが電子メールアドレスを入力できるページ (*Account/ForgotPassword*) に移動するリンク (**パスワードを忘れた場合**) が表示されます。</span><span class="sxs-lookup"><span data-stu-id="271df-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="271df-205">サイトは、新しいパスワードを設定するためにクリックできるリンクを含む電子メールメッセージを送信します (*アカウント/PasswordReset. cshtml*)。</span><span class="sxs-lookup"><span data-stu-id="271df-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="271df-206">また、後で説明するように、ユーザーが外部サイトを使用してログインすることもできます。</span><span class="sxs-lookup"><span data-stu-id="271df-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="271df-207">メンバー専用ページを作成する</span><span class="sxs-lookup"><span data-stu-id="271df-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="271df-208">期間中は、だれでも web サイト内の任意のページを参照できます。</span><span class="sxs-lookup"><span data-stu-id="271df-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="271df-209">ただし、ログインしているユーザー (つまり、メンバー) だけが使用できるページが必要になる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="271df-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="271df-210">ASP.NET を使用すると、ログインしているメンバーだけがアクセスできるページを作成できます。</span><span class="sxs-lookup"><span data-stu-id="271df-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="271df-211">通常、匿名ユーザーがメンバーのみのページにアクセスしようとすると、ログインページにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="271df-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="271df-212">この手順では、ログインしているユーザーのみが使用できるページを含むフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="271df-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="271df-213">サイトのルートで、新しいフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="271df-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="271df-214">(リボンで、 **[新規]** の下の矢印をクリックし、 **[新しいフォルダー]** を選択します)。</span><span class="sxs-lookup"><span data-stu-id="271df-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="271df-215">新しいフォルダーの*メンバー*に名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="271df-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="271df-216">*Members*フォルダー内に新しいページを作成し、そのページに「 *membersinformation. cshtml*」という名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="271df-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="271df-217">既存の内容を次のコードとマークアップに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="271df-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="271df-218">このコードは、`WebSecurity` オブジェクトの `IsAuthenticated` プロパティをテストします。これにより、ユーザーがログインした場合は `true` が返されます。</span><span class="sxs-lookup"><span data-stu-id="271df-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="271df-219">ユーザーがログインしていない場合、コードは `Response.Redirect` を呼び出して、*アカウント*フォルダーの*Login. cshtml*ページにユーザーを送信します。</span><span class="sxs-lookup"><span data-stu-id="271df-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="271df-220">リダイレクトの URL には、現在のページのパスを設定するために `Request.Url.LocalPath` を使用する `returnUrl` クエリ文字列値が含まれます。</span><span class="sxs-lookup"><span data-stu-id="271df-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="271df-221">次のようなクエリ文字列で `returnUrl` 値を設定した場合 (および返される URL がローカルパスの場合)、ログインページはログイン後にこのページにユーザーを返します。</span><span class="sxs-lookup"><span data-stu-id="271df-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="271df-222">また、このコードでは *\_SiteLayout*ページをレイアウトページとして設定します。</span><span class="sxs-lookup"><span data-stu-id="271df-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="271df-223">(レイアウトページの詳細については、「 [ASP.NET Web ページサイトでの一貫したレイアウトの作成](https://go.microsoft.com/fwlink/?LinkId=202891)」を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="271df-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="271df-224">サイトを実行します。</span><span class="sxs-lookup"><span data-stu-id="271df-224">Run the site.</span></span> <span data-ttu-id="271df-225">まだログインしている場合は、ページの上部にある **[ログアウト]** ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="271df-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="271df-226">ブラウザーで、ページ */メンバーの情報*を要求します。</span><span class="sxs-lookup"><span data-stu-id="271df-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="271df-227">たとえば、URL は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="271df-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="271df-228">(ポート番号 (38366) は URL によって異なる可能性があります)。</span><span class="sxs-lookup"><span data-stu-id="271df-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="271df-229">ログインしていないので、[ *cshtml* ] ページにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="271df-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
7. <span data-ttu-id="271df-230">前の手順で作成したアカウントを使用してログインします。</span><span class="sxs-lookup"><span data-stu-id="271df-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="271df-231">[ *Membersinformation* ] ページにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="271df-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="271df-232">この時点でログインしているため、ページの内容が表示されます。</span><span class="sxs-lookup"><span data-stu-id="271df-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="271df-233">複数のページへのアクセスをセキュリティで保護するには、次の操作を行います。</span><span class="sxs-lookup"><span data-stu-id="271df-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="271df-234">各ページにセキュリティチェックを追加します。</span><span class="sxs-lookup"><span data-stu-id="271df-234">Add the security check to each page.</span></span>
- <span data-ttu-id="271df-235">保護されたページを保持するフォルダーに *\_PageStart. cshtml*ページを作成し、そこにセキュリティチェックを追加します。</span><span class="sxs-lookup"><span data-stu-id="271df-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="271df-236">*\_PageStart. cshtml*ページは、フォルダー内のすべてのページのグローバルページの一種として機能します。</span><span class="sxs-lookup"><span data-stu-id="271df-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="271df-237">この手法の詳細については、「 [ASP.NET Web ページのサイト全体の動作をカスタマイズする](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="271df-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="271df-238">ユーザーグループ (ロール) のセキュリティを作成する</span><span class="sxs-lookup"><span data-stu-id="271df-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="271df-239">サイトに多数のメンバーが含まれている場合は、ページを表示する前に、各ユーザーのアクセス許可を個別に確認するのは効率的ではありません。</span><span class="sxs-lookup"><span data-stu-id="271df-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="271df-240">代わりに、個々のメンバーが属するグループ (*ロール*) を作成することができます。</span><span class="sxs-lookup"><span data-stu-id="271df-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="271df-241">その後、ロールに基づいてアクセス許可を確認できます。</span><span class="sxs-lookup"><span data-stu-id="271df-241">You can then check permissions based on role.</span></span> <span data-ttu-id="271df-242">このセクションでは、&quot;管理者&quot; ロールを作成し、そのロールに属している (だれが属している) ユーザーがアクセスできるページを作成します。</span><span class="sxs-lookup"><span data-stu-id="271df-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="271df-243">ASP.NET メンバーシップシステムは、ロールをサポートするように設定されています。</span><span class="sxs-lookup"><span data-stu-id="271df-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="271df-244">ただし、メンバーシップの登録とログインとは異なり、**スターターサイト**テンプレートには、役割の管理に役立つページは含まれていません。</span><span class="sxs-lookup"><span data-stu-id="271df-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="271df-245">(ロールの管理は、ユーザータスクではなく、管理タスクです)。ただし、WebMatrix のメンバーシップデータベースにグループを直接追加することはできます。</span><span class="sxs-lookup"><span data-stu-id="271df-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="271df-246">WebMatrix で、 **[データベース]** ワークスペースセレクターをクリックします。</span><span class="sxs-lookup"><span data-stu-id="271df-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="271df-247">左側のウィンドウで、 *Startersite. .sdf*ノードを開き、 **[テーブル]** ノードを開いて、[ *web ページ\_ロール*] テーブルをダブルクリックします。</span><span class="sxs-lookup"><span data-stu-id="271df-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![セキュリティ-メンバーシップ-7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="271df-249">&quot;admin&quot;という名前のロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="271df-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="271df-250">*RoleId*フィールドは自動的に入力されます。</span><span class="sxs-lookup"><span data-stu-id="271df-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="271df-251">(これは主キーであり、「 [ASP.NET Web ページサイトでのデータベースの操作の概要](https://go.microsoft.com/fwlink/?LinkId=202893)」で説明されているように、識別フィールドとして設定されています)。</span><span class="sxs-lookup"><span data-stu-id="271df-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="271df-252">*RoleId*フィールドの値をメモしておきます。</span><span class="sxs-lookup"><span data-stu-id="271df-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="271df-253">(定義している最初のロールである場合は1になります)。</span><span class="sxs-lookup"><span data-stu-id="271df-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![セキュリティ-メンバーシップ-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="271df-255">*Web ページの\_Roles*  テーブルを閉じます。</span><span class="sxs-lookup"><span data-stu-id="271df-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="271df-256">*UserProfile*テーブルを開きます。</span><span class="sxs-lookup"><span data-stu-id="271df-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="271df-257">テーブル内の1人以上のユーザーの*UserId*値をメモしておき、テーブルを閉じます。</span><span class="sxs-lookup"><span data-stu-id="271df-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="271df-258">*Web ページ\_UserInRoles*テーブルを開き、 *UserID*と*RoleID*値をテーブルに入力します。</span><span class="sxs-lookup"><span data-stu-id="271df-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="271df-259">たとえば、ユーザー2を &quot;admin&quot; ロールに配置するには、次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="271df-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![セキュリティ-メンバーシップ-9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="271df-261">*Web ページ\_UsersInRoles*テーブルを閉じます。</span><span class="sxs-lookup"><span data-stu-id="271df-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="271df-262">ロールが定義されたので、そのロールに属しているユーザーがアクセスできるページを構成できます。</span><span class="sxs-lookup"><span data-stu-id="271df-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="271df-263">Web サイトのルートフォルダーで、 *Adminerror. cshtml*という名前の新しいページを作成し、既存の内容を次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="271df-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="271df-264">これは、ページへのアクセスが許可されていない場合にユーザーがリダイレクトされるページです。</span><span class="sxs-lookup"><span data-stu-id="271df-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="271df-265">Web サイトのルートフォルダーで、 *Adminonly. cshtml*という名前の新しいページを作成し、既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="271df-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="271df-266">`Roles.IsUserInRole` メソッドは、現在のユーザーが指定されたロール (この場合は "admin" ロール) のメンバーである場合に `true` を返します。</span><span class="sxs-lookup"><span data-stu-id="271df-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="271df-267">*既定の cshtml*をブラウザーで実行しますが、ログインしません。</span><span class="sxs-lookup"><span data-stu-id="271df-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="271df-268">(既にログインしている場合は、ログアウトしてください)。</span><span class="sxs-lookup"><span data-stu-id="271df-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="271df-269">ブラウザーのアドレスバーで、URL に*Adminonly*を追加します。</span><span class="sxs-lookup"><span data-stu-id="271df-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="271df-270">(つまり、 *Adminonly. cshtml*ファイルを要求します)。&quot;admin&quot; ロールのユーザーとして現在ログインしていないため、 *Adminerror. cshtml*ページにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="271df-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="271df-271">既定の*cshtml*に戻り、&quot;admin&quot; ロールに追加したユーザーとしてログインします。</span><span class="sxs-lookup"><span data-stu-id="271df-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="271df-272">*Adminonly. cshtml*ページを参照します。</span><span class="sxs-lookup"><span data-stu-id="271df-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="271df-273">今度は、このページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="271df-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="271df-274">自動プログラムが Web サイトに参加できないようにする</span><span class="sxs-lookup"><span data-stu-id="271df-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="271df-275">ログインページでは、自動プログラム ( *web ロボット*または*ボット*と呼ばれることもあります) が web サイトへの登録を停止することはありません。</span><span class="sxs-lookup"><span data-stu-id="271df-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="271df-276">この手順では、登録ページの ReCaptcha テストを有効にする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="271df-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="271df-278">Web サイトを ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)) に登録します。</span><span class="sxs-lookup"><span data-stu-id="271df-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="271df-279">登録が完了すると、公開キーと秘密キーが取得されます。</span><span class="sxs-lookup"><span data-stu-id="271df-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="271df-280">「 [ASP.NET Web ページサイトにヘルパーをインストール](https://go.microsoft.com/fwlink/?LinkId=252372)する」の説明に従って、ASP.NET Web ヘルパーライブラリを web サイトに追加します (まだインストールしていない場合)。</span><span class="sxs-lookup"><span data-stu-id="271df-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="271df-281">*Account*フォルダーで、 *Register. cshtml*という名前のファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="271df-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="271df-282">ページの上部にあるコードで、次の行を見つけて、`//` コメント文字を削除してコメント解除します。</span><span class="sxs-lookup"><span data-stu-id="271df-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="271df-283">`PRIVATE_KEY` を独自の ReCaptcha 秘密キーに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="271df-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="271df-284">ページのマークアップで、ページマークアップの次の行の周囲にある `@*` と `*@` コメント化文字を削除します。</span><span class="sxs-lookup"><span data-stu-id="271df-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="271df-285">`PUBLIC_KEY` をキーに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="271df-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="271df-286">まだ削除していない場合は、"CAPTCHA 検証を有効にするには、" で始まるテキストを含む `<div>` 要素を削除します。</span><span class="sxs-lookup"><span data-stu-id="271df-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="271df-287">(`<div>` 要素全体とその内容を削除します)。</span><span class="sxs-lookup"><span data-stu-id="271df-287">(Remove the entire `<div>` element and its contents.)</span></span>

9. <span data-ttu-id="271df-288">ブラウザーで*既定の cshtml*を実行します。</span><span class="sxs-lookup"><span data-stu-id="271df-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="271df-289">サイトにログインしている場合は、 **[ログアウト]** リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="271df-289">If you're logged into the site, click the **Logout** link.</span></span>
10. <span data-ttu-id="271df-290">[Register] \ (**登録**\) リンクをクリックし、CAPTCHA テストを使用して登録をテストします。</span><span class="sxs-lookup"><span data-stu-id="271df-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

     ![セキュリティ-メンバーシップ-10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="271df-292">`ReCaptcha` helper の詳細については、「 [CATPCHA を使用して自動プログラム (ボット) が ASP.NET Web サイトを使用できないようにする](https://go.microsoft.com/fwlink/?LinkId=251967)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="271df-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="271df-293">ユーザーが外部サイトを使用してログインできるようにする</span><span class="sxs-lookup"><span data-stu-id="271df-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="271df-294">**スターターサイト**テンプレートには、ユーザーが Facebook、Windows Live、Twitter、Google、または Yahoo を使用してログインできるようにするコードとマークアップが含まれています。</span><span class="sxs-lookup"><span data-stu-id="271df-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="271df-295">既定では、この機能は有効になっていません。</span><span class="sxs-lookup"><span data-stu-id="271df-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="271df-296">これらの外部プロバイダーを使用したログインをユーザーに使用するための一般的な手順は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="271df-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="271df-297">サポートする外部サイトを決定します。</span><span class="sxs-lookup"><span data-stu-id="271df-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="271df-298">必要に応じて、そのサイトにアクセスし、ログインアプリを設定します。</span><span class="sxs-lookup"><span data-stu-id="271df-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="271df-299">(たとえば、Facebook ログインを許可するには、これを行う必要があります)。</span><span class="sxs-lookup"><span data-stu-id="271df-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="271df-300">サイトで、プロバイダーを構成します。</span><span class="sxs-lookup"><span data-stu-id="271df-300">In your site, configure the provider.</span></span> <span data-ttu-id="271df-301">ほとんどの場合、 *\_該当*ファイルの一部のコードをコメント解除するだけで済みます。</span><span class="sxs-lookup"><span data-stu-id="271df-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="271df-302">登録ページにマークアップを追加して、ユーザーがログインのために外部サイトにリンクできるようにします。</span><span class="sxs-lookup"><span data-stu-id="271df-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="271df-303">通常は、必要なマークアップをコピーし、テキストを少し変更します。</span><span class="sxs-lookup"><span data-stu-id="271df-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="271df-304">詳細な手順については、「 [ASP.NET Web ページサイトの外部サイトからのログインを有効](https://go.microsoft.com/fwlink/?LinkId=251969)にする」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="271df-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="271df-305">ユーザーが別のサイトからログインすると、ユーザーはサイトに戻り、そのログインをサイトに*関連付け*ます。</span><span class="sxs-lookup"><span data-stu-id="271df-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="271df-306">実際には、ユーザーの外部ログイン用のメンバーシップエントリがサイトに作成されます。</span><span class="sxs-lookup"><span data-stu-id="271df-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="271df-307">これにより、外部ログインでメンバーシップの通常の機能 (ロールなど) を使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="271df-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="271df-308">既存の Web サイトへのセキュリティの追加</span><span class="sxs-lookup"><span data-stu-id="271df-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="271df-309">この記事の前半で説明した手順は、web サイトのセキュリティの基礎として**スターターサイト**テンプレートを使用することに依存しています。</span><span class="sxs-lookup"><span data-stu-id="271df-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="271df-310">**スターターサイト**テンプレートから開始したり、そのテンプレートに基づいてサイトから関連ページをコピーしたりするのが実用的でない場合は、自分でコーディングすることで、独自のサイトに同じ種類のセキュリティを実装できます。</span><span class="sxs-lookup"><span data-stu-id="271df-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="271df-311">同じ種類のページ (登録、ログインなど) を作成し、ヘルパーとクラスを使用してメンバーシップを設定します。</span><span class="sxs-lookup"><span data-stu-id="271df-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="271df-312">基本的なプロセスについては、ブログ記事「 [ASP.NET Razor セキュリティを実装する最も基本的な方法](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240)」で説明されています。</span><span class="sxs-lookup"><span data-stu-id="271df-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="271df-313">ほとんどの作業は、`WebSecurity` ヘルパーの次のメソッドとプロパティを使用して行われます。</span><span class="sxs-lookup"><span data-stu-id="271df-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="271df-314">[WebCreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx)、 [websecurity.](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx)のようになります。</span><span class="sxs-lookup"><span data-stu-id="271df-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="271df-315">これらのメソッドを使用すると、他のユーザーが既に登録されているかどうかを判断し、登録できます。</span><span class="sxs-lookup"><span data-stu-id="271df-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="271df-316">[Webauthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx)。</span><span class="sxs-lookup"><span data-stu-id="271df-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="271df-317">このプロパティを使用すると、現在のユーザーがログインしているかどうかを判断できます。</span><span class="sxs-lookup"><span data-stu-id="271df-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="271df-318">これは、ログインページにユーザーがまだログインしていない場合にユーザーをリダイレクトするのに便利です。</span><span class="sxs-lookup"><span data-stu-id="271df-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="271df-319">[Websecurity. Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [Websecurity. Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="271df-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="271df-320">これらのメソッドは、ユーザーを記録します。</span><span class="sxs-lookup"><span data-stu-id="271df-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="271df-321">[Websecurity. CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx)。</span><span class="sxs-lookup"><span data-stu-id="271df-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="271df-322">このプロパティは、現在のユーザーのログイン名 (ユーザーがログインしている場合) を表示する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="271df-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="271df-323">[Websecurity. ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx)。</span><span class="sxs-lookup"><span data-stu-id="271df-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="271df-324">この方法は、登録の電子メール確認を設定する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="271df-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="271df-325">(詳細につい[ては、ASP.NET Web ページセキュリティの確認機能を使用し](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267)たブログ投稿を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="271df-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="271df-326">ロールを管理するには、ブログの記事で説明されているように、[ロール](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx)と[メンバーシップ](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx)クラスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="271df-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="271df-327">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="271df-327">Additional Resources</span></span>

- [<span data-ttu-id="271df-328">サイト全体の動作をカスタマイズする</span><span class="sxs-lookup"><span data-stu-id="271df-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="271df-329">Web 通信のセキュリティ保護: 証明書、SSL、 https://</span><span class="sxs-lookup"><span data-stu-id="271df-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="271df-330">ASP.NET Razor セキュリティを実装し、 [ASP.NET Web ページセキュリティの確認機能を使用](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267)[する最も基本的な方法](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240)です。</span><span class="sxs-lookup"><span data-stu-id="271df-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="271df-331">これらは、**スターターサイト**テンプレートを使用せずに ASP.NET メンバーシップ機能を実装する方法を説明するブログの投稿です。</span><span class="sxs-lookup"><span data-stu-id="271df-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="271df-332">ASP.NET Web ページ サイトで外部サイトからのログインを有効にする</span><span class="sxs-lookup"><span data-stu-id="271df-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="271df-333">[Websecurity CLASS API リファレンス](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="271df-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="271df-334">[Simpleroleprovider クラス API リファレンス](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="271df-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="271df-335">[SimpleMembershipProvider CLASS API リファレンス](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="271df-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
