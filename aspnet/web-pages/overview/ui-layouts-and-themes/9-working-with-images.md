---
uid: web-pages/overview/ui-layouts-and-themes/9-working-with-images
title: ASP.NET Web ページ (Razor) サイトでのイメージの操作 |Microsoft Docs
author: Rick-Anderson
description: この章では、web サイトでイメージを追加、表示、操作する方法 (サイズ変更、反転、透かしの追加) について説明します。
ms.author: riande
ms.date: 02/20/2014
ms.assetid: 778c4e58-4372-4d25-bab9-aec4a8d8e38d
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/9-working-with-images
msc.type: authoredcontent
ms.openlocfilehash: 53514b3c314fc182a43c82974ffcfa8158a636a1
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78512878"
---
# <a name="working-with-images-in-an-aspnet-web-pages-razor-site"></a>ASP.NET Web ページ (Razor) サイトでのイメージの操作

[Tom FitzMacken](https://github.com/tfitzmac)

> この記事では、ASP.NET Web ページ (Razor) web サイトでイメージを追加、表示、操作する方法 (サイズ変更、反転、透かしの追加) について説明します。
> 
> ここでは、次の内容について学習します。
> 
> - ページにイメージを動的に追加する方法。
> - ユーザーがイメージをアップロードできるようにする方法。
> - イメージのサイズを変更する方法。
> - 画像を反転または回転させる方法。
> - 画像にウォーターマークを追加する方法。
> - 画像をウォーターマークとして使用する方法。
> 
> この記事で紹介する ASP.NET プログラミング機能を次に示します。
> 
> - `WebImage` ヘルパー。
> - `Path` オブジェクト。パスとファイル名を操作できるメソッドを提供します。
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>このチュートリアルで使用されているソフトウェアのバージョン
> 
> 
> - ASP.NET Web ページ (Razor) 2
> - WebMatrix 2
>   
> 
> このチュートリアルでは、WebMatrix 3 も使用できます。

<a id="Adding_an_Image"></a>
## <a name="adding-an-image-to-a-web-page-dynamically"></a>Web ページへのイメージの動的な追加

Web サイトの開発中に、web サイトや個々のページに画像を追加できます。 また、ユーザーがイメージをアップロードできるようにすることもできます。これは、プロファイルの写真を追加するなどのタスクに便利な場合があります。

イメージがサイトで既に使用可能であり、ページに表示する場合は、次のような HTML `<img>` 要素を使用します。

[!code-html[Main](9-working-with-images/samples/sample1.html)]

ただし、イメージを動的&#8212;に表示できる必要がある場合もあります。これは、ページが実行されるまでどの画像を表示するかがわからないことがあります。

このセクションの手順では、イメージ名の一覧からユーザーがイメージファイル名を指定するときにイメージを表示する方法について説明します。 ドロップダウンリストからイメージの名前を選択すると、ページを送信するときに、選択したイメージが表示されます。

![絵](9-working-with-images/_static/image1.jpg "ch9images-1")

1. WebMatrix で、新しい web サイトを作成します。
2. *Dynamicimage. cshtml*という名前の新しいページを追加します。
3. Web サイトのルートフォルダーに新しいフォルダーを追加し、「 *images*」という名前を指定します。
4. 先ほど作成した*images*フォルダーに4つのイメージを追加します。 (便利なイメージであれば、1ページに収めることができます)。画像の名前を*Photo1*、 *Photo2*、 *Photo3*、および*Photo4*に変更します。 (この手順では*Photo4*を使用しませんが、この記事の後半で使用します)。
5. 4つのイメージが読み取り専用としてマークされていないことを確認します。
6. ページ内の既存のコンテンツを次の内容に置き換えます。

    [!code-cshtml[Main](9-working-with-images/samples/sample2.cshtml)]

    ページの本文には、`photoChoice`という名前のドロップダウンリスト (`<select>` 要素) があります。 この一覧には3つのオプションがあり、各リストオプションの `value` 属性には、 *images*フォルダーに配置したいずれかのイメージの名前が含まれています。 基本的に、この一覧では、ユーザーは &quot;Photo 1&quot;のようなフレンドリ名を選択できます。その後、ページの送信時に *.jpg*ファイル名が渡されます。

    コードでは、`Request["photoChoice"]`を読み取ることで、一覧からユーザーの選択を取得できます (つまり、イメージファイル名)。 最初に選択範囲があるかどうかを確認します。 存在する場合は、イメージのフォルダー名とユーザーのイメージファイル名で構成されるイメージのパスを作成します。 (パスを構築しようとしたときに `Request["photoChoice"]`に何もなかった場合は、エラーが発生します)。この結果、次のような相対パスになります。

    *images/Photo1*

    パスは `imagePath` という名前の変数に格納されます。この変数は後で必要になります。

    本文には、ユーザーが選択したイメージを表示するために使用される `<img>` 要素もあります。 `src` 属性は、静的要素を表示する場合と同様に、ファイル名または URL に設定されていません。 代わりに、`@imagePath`に設定されています。つまり、コードで設定したパスから値を取得します。

    ただし、ユーザーが何も選択していないため、ページを初めて実行するときは、表示するイメージはありません。 これは通常、`src` 属性が空であり、イメージが赤い &quot;x&quot; として表示されることを意味します (または、イメージが見つからないときにブラウザーでレンダリングされます)。 これを回避するには、`imagePath` 変数に何かが含まれているかどうかをテストする `if` ブロックに `<img>` 要素を配置します。 ユーザーが選択を行った場合、`imagePath` にはパスが含まれます。 ユーザーがイメージを選択しなかった場合、またはページを初めて表示する場合は、`<img>` 要素もレンダリングされません。
7. ファイルを保存し、ブラウザーでページを実行します。 (実行する前に、 **[ファイル]** ワークスペースでページが選択されていることを確認してください)。
8. ドロップダウンリストからイメージを選択し、 **[サンプルイメージ]** をクリックします。 さまざまな選択肢に対して異なるイメージが表示されていることを確認します。

<a id="Uploading_an_Image"></a>
## <a name="uploading-an-image"></a>イメージのアップロード

前の例では、イメージを動的に表示する方法を示しましたが、web サイトに既に存在していたイメージでのみ動作していました。 この手順では、ユーザーがイメージをアップロードして、ページに表示する方法について説明します。 ASP.NET では、イメージの作成、操作、保存を行うことができるメソッドを含む `WebImage` ヘルパーを使用して、すぐにイメージを操作できます。 `WebImage` helper は、 *.jpg*、 *.png*、 *.bmp*など、一般的な種類の web イメージファイルをすべてサポートしています。 この記事では、 *.jpg*イメージを使用しますが、イメージの種類を使用することもできます。

![絵](9-working-with-images/_static/image2.jpg "ch9images-2")

1. 新しいページを追加し、 *UploadImage*という名前を指定します。
2. ページ内の既存のコンテンツを次の内容に置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample3.cshtml)]

    テキストの本文には、アップロードするファイルをユーザーが選択できるようにする `<input type="file">` 要素があります。 **[送信]** をクリックすると、選択したファイルがフォームと共に送信されます。

    アップロードされたイメージを取得するには、`WebImage` ヘルパーを使用します。このヘルパーには、イメージを操作するための便利なメソッドがすべて含まれています。 具体的には、`WebImage.GetImageFromRequest` を使用してアップロードされたイメージ (存在する場合) を取得し、それを `photo`という名前の変数に格納します。

    この例の作業の大部分には、ファイル名とパス名の取得と設定が含まれます。 この問題は、ユーザーがアップロードしたイメージの名前 (および名前のみ) を取得し、イメージを保存する場所の新しいパスを作成することです。 ユーザーは、同じ名前を持つ複数のイメージをアップロードできる可能性があるため、いくつかの追加のコードを使用して一意の名前を作成し、ユーザーが既存の画像を上書きしないようにします。

    イメージが実際にアップロードされている場合 (テスト `if (photo != null)`)、イメージの `FileName` プロパティからイメージ名を取得します。 ユーザーがイメージをアップロードすると `FileName` には、ユーザーのコンピューターからのパスを含む、ユーザーの元の名前が含まれます。 次のようになります。

    *C:\Users\Joe\Pictures\SamplePhoto1.jpg*

    実際のファイル名 (*SamplePhoto1*) だけが&#8212;必要な場合でも、すべてのパス情報は必要ありません。 次のように `Path.GetFileName` メソッドを使用して、パスからファイルのみを取り除くことができます。

    [!code-csharp[Main](9-working-with-images/samples/sample4.cs)]

    次に、元の名前に GUID を追加して、新しい一意のファイル名を作成します。 (Guid の詳細については、この記事で後述する「 [Guid につい](#SB_AboutGUIDs)て」を参照してください)。次に、イメージを保存するために使用できる完全なパスを作成します。 保存パスは、新しいファイル名、フォルダー (イメージ)、および現在の web サイトの場所で構成されます。

    > [!NOTE]
    > コードで*images*フォルダーにファイルを保存するには、そのフォルダーに対する読み取り/書き込みアクセス許可がアプリケーションに必要です。 開発用コンピューターでは、これは通常は問題ではありません。 ただし、サイトをホスティングプロバイダーの web サーバーに発行する場合は、これらのアクセス許可を明示的に設定する必要がある場合があります。 このコードをホスティングプロバイダーのサーバーで実行し、エラーが発生した場合は、ホスティングプロバイダーに確認して、これらのアクセス許可を設定する方法を確認してください。

    最後に、保存パスを `WebImage` ヘルパーの `Save` メソッドに渡します。 これにより、アップロードしたイメージが新しい名前で格納されます。 Save メソッドは、`photo.Save(@"~\" + imagePath)`のようになります。 完全なパスは、現在の web サイトの場所である `@"~\"`に追加されます。 (`~` 演算子の詳細については、「 [Razor 構文を使用した ASP.NET Web プログラミングの概要」を](https://go.microsoft.com/fwlink/?LinkId=202890#ID_WorkingWithFileAndFolderPaths)参照してください。)

    前の例と同様に、ページの本文には、イメージを表示するための `<img>` 要素が含まれています。 `imagePath` が設定されている場合、`<img>` 要素がレンダリングされ、その `src` 属性が `imagePath` 値に設定されます。
3. ブラウザーでページを実行します。
4. イメージをアップロードして、ページに表示されることを確認します。
5. サイトで、 *images*フォルダーを開きます。 次のようなファイル名を持つ新しいファイルが追加されていることがわかります。 

    *45ea4527-7ddd-4965-b9ca-c6444982b342\_MyPhoto .png*

    これは、名前にプレフィックスとして GUID を付けてアップロードしたイメージです。 (独自のファイルには GUID が異なり、場合によっては*Myphoto .png*という名前の別の名前が付けられます)。

> [!TIP] 
> 
> <a id="SB_AboutGUIDs"></a>
> ### <a name="about-guids"></a>Guid について
> 
> GUID (グローバル一意 ID) は、通常、`936DA01F-9ABD-4d9d-80C7-02AF85C822A8`のような形式で表示される識別子です。 数字と文字 (A ~ F) は GUID ごとに異なりますが、これらはすべて8-4-4-4-12 文字のグループを使用するパターンに従います。 (技術的には、GUID は16バイト/128 ビットの数値です)。GUID が必要な場合は、GUID を生成する特殊なコードを呼び出すことができます。 Guid の背後にある考え方は、数値の巨大なサイズ (3.4 x 10<sup>38</sup>) とそれを生成するためのアルゴリズムの間で、結果として得られる数値が実質的にはいずれかの種類であることが保証されることです。 したがって、Guid は、同じ名前を2回使用しないことを保証する必要がある場合に、名前を生成するのに適した方法です。 当然のことですが、Guid は特にユーザーフレンドリではないため、名前がコード内でのみ使用される場合に使用される傾向があります。

<a id="Resizing_an_Image"></a>
## <a name="resizing-an-image"></a>イメージのサイズ変更

Web サイトがユーザーのイメージを受け入れる場合は、イメージを表示または保存する前にサイズを変更することができます。 このためには、もう一度 `WebImage` ヘルパーを使用できます。

この手順では、アップロードしたイメージのサイズを変更してサムネイルを作成し、サムネイルと元のイメージを web サイトに保存する方法を示します。 ページにサムネイルを表示し、ハイパーリンクを使用して、フルサイズの画像にユーザーをリダイレクトします。

![絵](9-working-with-images/_static/image3.jpg "ch9images-3")

1. *Thumbnail. cshtml*という名前の新しいページを追加します。
2. *Images*フォルダーで、「*親指*」という名前のサブフォルダーを作成します。
3. ページ内の既存のコンテンツを次の内容に置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample5.cshtml)]

    このコードは、前の例のコードに似ています。 違いは、このコードでは、イメージのサムネイルコピーを作成した後、通常と1回、イメージを2回保存することです。 まず、アップロードしたイメージを取得し、 *images*フォルダーに保存します。 次に、サムネイル画像の新しいパスを作成します。 実際にサムネイルを作成するには、`WebImage` ヘルパーの `Resize` メソッドを呼び出して、60ピクセルの60ピクセルのイメージを作成します。 この例は、縦横比を維持する方法と、画像が拡大されないようにする方法を示しています (新しいサイズが実際にイメージを拡大する場合)。 サイズ変更されたイメージは、*親指*サブフォルダーに保存されます。

    マークアップの最後に、前の例で示した動的 `src` 属性と同じ `<img>` 要素を使用して、条件に応じてイメージを表示します。 この場合、サムネイルが表示されます。 また、`<a>` 要素を使用して、イメージの大規模なバージョンへのハイパーリンクを作成します。 `<img>` 要素の `src` 属性と同様に、`<a>` 要素の `href` 属性を `imagePath`内の任意のものに動的に設定します。 パスが URL として機能できることを確認するには、`imagePath` を `Html.AttributeEncode` メソッドに渡します。これにより、パス内の予約文字が URL 内の ok 文字に変換されます。
4. ブラウザーでページを実行します。
5. 写真をアップロードし、サムネイルが表示されていることを確認します。
6. サムネイルをクリックすると、フルサイズの画像が表示されます。
7. *画像*と*画像/親指*で、新しいファイルが追加されていることに注意してください。

<a id="Rotating_and_Flipping"></a>
## <a name="rotating-and-flipping-an-image"></a>イメージの回転と反転

`WebImage` ヘルパーを使用すると、イメージを反転して回転させることもできます。 この手順では、サーバーからイメージを取得し、画像を上下に反転させて保存し、反転したイメージをページに表示する方法について説明します。 この例では、サーバー上に既にあるファイル (*Photo2*) を使用しています。 実際のアプリケーションでは、前の例で行ったように、動的に取得した名前を持つイメージを反転させることができます。

![絵](9-working-with-images/_static/image4.jpg "ch9images-4")

1. *FlipImage*という名前の新しいページを追加します。
2. ページ内の既存のコンテンツを次の内容に置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample6.cshtml)]

    このコードでは、`WebImage` ヘルパーを使用して、サーバーからイメージを取得します。 イメージのパスを作成するには、前の例でイメージを保存する場合と同じ手法を使用し、`WebImage`を使用してイメージを作成するときにそのパスを渡します。

    [!code-javascript[Main](9-working-with-images/samples/sample7.js)]

    イメージが見つかった場合は、前の例で行ったように、新しいパスとファイル名を作成します。 画像を反転させるには、`FlipVertical` メソッドを呼び出してから、再度画像を保存します。

    このイメージは、`src` 属性が `imagePath`に設定された `<img>` 要素を使用して、ページに再び表示されます。
3. ブラウザーでページを実行します。 *Photo2*のイメージが反転して表示されます。
4. ページを最新の情報に更新するか、もう一度ページを要求して、もう一度イメージが反転されていることを確認します。

画像を回転させるには、同じコードを使用します。ただし、`FlipVertical` または `FlipHorizontal`を呼び出すのではなく、`RotateLeft` または `RotateRight`を呼び出します。

<a id="Adding_a_Watermark"></a>
## <a name="adding-a-watermark-to-an-image"></a>画像へのウォーターマークの追加

Web サイトに画像を追加する場合は、画像を保存したり、ページに表示したりする前に、透かしを画像に追加することができます。 多くの場合、透かしを使用して、画像に著作権情報を追加したり、ビジネス名を提供したりします。

![絵](9-working-with-images/_static/image5.jpg "ch9images-5")

1. *Watermark. cshtml*という名前の新しいページを追加します。
2. ページ内の既存のコンテンツを次の内容に置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample8.cshtml)]

    このコードは、前の*FlipImage*ページのコードに似ています (現時点では、 *Photo3*ファイルを使用します)。 透かしを追加するには、イメージを保存する前に、`WebImage` ヘルパーの `AddTextWatermark` メソッドを呼び出します。 `AddTextWatermark`への呼び出しでは、テキストをウォーターマーク&quot;&quot;渡し、フォントの色を黄色に設定し、フォントファミリを Arial に設定します。 (ここには示されていませんが、`WebImage` ヘルパーでは、不透明度、フォントファミリ、フォントサイズ、および透かしテキストの位置を指定することもできます)。イメージを保存するときは、読み取り専用にすることはできません。

    前に説明したように、[src] 属性が [`@imagePath`] に設定された `<img>` 要素を使用して、ページに画像を表示します。
3. ブラウザーでページを実行します。 イメージの右下隅に "My Watermark" というテキストが表示されます。

<a id="Using_an_Image_as_a_Watermark"></a>
## <a name="using-an-image-as-a-watermark"></a>透かしとしての画像の使用

透かしのテキストを使用する代わりに、別の画像を使用することもできます。 会社のロゴなどの画像を透かしとして使用する場合や、著作権情報のテキストではなく透かし画像を使用する場合があります。

![絵](9-working-with-images/_static/image6.jpg "ch9images-6")

1. *Imagewatermark. cshtml*という名前の新しいページを追加します。
2. ロゴとして使用できるイメージを*images*フォルダーに追加し、画像の名前を*my企業のロゴ .jpg*に変更します。 この画像は、幅が80ピクセル、高さが20ピクセルに設定されている場合に明確に見える画像にする必要があります。
3. ページ内の既存のコンテンツを次の内容に置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample9.cshtml)]

    これは、前の例のコードの別のバリエーションです。 この場合は、`AddImageWatermark` を呼び出して、画像を保存する前にウォーターマーク画像をターゲットイメージ (*Photo3*) に追加します。 `AddImageWatermark`を呼び出すときは、幅を80ピクセル、高さを20ピクセルに設定します。 *My企業のロゴ .jpg*画像は、中央に水平方向に配置され、ターゲットイメージの下部に垂直方向に配置されます。 不透明度は100% に設定され、余白は10ピクセルに設定されます。 ウォーターマークの画像がターゲットイメージより大きい場合は、何も起こりません。 透かし画像がターゲットイメージよりも大きい場合に、画像ウォーターマークの埋め込みを0に設定すると、透かしは無視されます。

    前と同様に、`<img>` 要素と動的 `src` 属性を使用してイメージを表示します。
4. ブラウザーでページを実行します。 透かし画像がメインイメージの下部に表示されることに注意してください。

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>その他のリソース

[ASP.NET Web ページサイト内のファイルの操作](https://go.microsoft.com/fwlink/?LinkId=202896)

[Razor 構文を使用した ASP.NET Web ページプログラミングの概要](https://go.microsoft.com/fwlink/?LinkID=251587)
