---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/form-basics
title: ASP.NET Web ページの概要-HTML フォームの基礎 |Microsoft Docs
author: Rick-Anderson
description: このチュートリアルでは、ASP.NET Web ページ (Razor) を使用するときに、入力フォームを作成する方法とユーザーの入力を処理する方法の基本について説明します。 これで...
ms.author: riande
ms.date: 05/28/2015
ms.assetid: 81ed82bf-b940-44f1-b94a-555d0cb7cc98
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/form-basics
msc.type: authoredcontent
ms.openlocfilehash: f57661077ec3bb13f3d4ec41b130bda4d2fb9070
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78463540"
---
# <a name="introducing-aspnet-web-pages---html-form-basics"></a>ASP.NET Web ページの概要-HTML フォームの基礎

[Tom FitzMacken](https://github.com/tfitzmac)

> このチュートリアルでは、ASP.NET Web ページ (Razor) を使用するときに、入力フォームを作成する方法とユーザーの入力を処理する方法の基本について説明します。 データベースが完成したので、フォームのスキルを使用して、ユーザーがデータベース内の特定の映画を検索できるようにします。 ここでは、 [ASP.NET Web ページを使用したデータの表示の概要につい](/aspnet/web-pages/overview/getting-started/introducing-aspnet-web-pages-2/displaying-data)て説明します。
> 
> ここでは、次の内容について学習します。
> 
> - 標準の HTML 要素を使用してフォームを作成する方法。
> - フォームでユーザーの入力を読み取る方法。
> - ユーザーが指定した検索語句を使用してデータを選択的に取得する SQL クエリを作成する方法について説明します。
> - ページ内のフィールドに、ユーザーが入力した内容を "記憶" する方法。
>   
> 
> 説明する機能/テクノロジ:
> 
> - `Request` オブジェクトです。
> - SQL `Where` 句。

## <a name="what-youll-build"></a>作成するアプリケーション:

前のチュートリアルでは、データベースを作成し、データを追加した後、`WebGrid` ヘルパーを使用してデータを表示しました。 このチュートリアルでは、特定のジャンルの映画を検索できる検索ボックスを追加します。タイトルには、入力した単語が含まれています。 (たとえば、ジャンルが "Action" であるか、タイトルに "Harry" または "Adventure." が含まれているすべての映画を見つけることができます)。

このチュートリアルを完了すると、次のようなページが表示されます。

![ジャンルとタイトルの検索を含むムービーページ](form-basics/_static/image1.png)

ページのリスティング部分は、最後のチュートリアルのグリッド &mdash; と同じです。 違いは、検索したムービーのみがグリッドに表示されることです。

## <a name="about-html-forms"></a>HTML フォームについて

(HTML フォームの作成に関する経験があり、`GET` と `POST`の違いがある場合は、このセクションを省略できます)。

フォームには、テキストボックス、ボタン、オプションボタン、チェックボックス、ドロップダウンリストなど &mdash; ユーザー入力要素があります。 ユーザーは、ボタンをクリックして、これらのコントロールを入力するか、選択を行い、フォームを送信します。

次の例では、フォームの基本的な HTML 構文を示しています。

[!code-html[Main](form-basics/samples/sample1.html)]

このマークアップをページで実行すると、次の図のような単純なフォームが作成されます。

![ブラウザーに表示される基本的な HTML フォーム](form-basics/_static/image2.png)

`<form>` 要素は、送信される HTML 要素を囲みます。 (簡単に作成できないのは、要素をページに追加してから、`<form>` 要素内に配置することです。 この場合、何も送信されません)。`method` 属性は、ユーザー入力を送信する方法をブラウザーに指示します。 サーバーで更新を実行する場合、またはサーバーからデータをフェッチするだけの場合は `get` するには、これを `post` に設定します。

<a id="GET,_POST,_and_HTTP_Verb_Safety"></a>

> [!TIP] 
> 
> **GET、POST、および HTTP 動詞の安全性**
> 
> HTTP は、ブラウザーとサーバーが情報を交換するために使用するプロトコルで、基本的な操作が非常に単純です。 ブラウザーは、いくつかの動詞のみを使用してサーバーに要求を行います。 Web 用のコードを記述するときは、これらの動詞と、ブラウザーとサーバーでそれらを使用する方法を理解することをお勧めします。 最も一般的に使用されている動詞は、次のとおりです。
> 
> - [https://login.microsoftonline.com/consumers/](`GET`) ブラウザーは、この動詞を使用してサーバーから何かをフェッチします。 たとえば、ブラウザーに URL を入力すると、ブラウザーは `GET` 操作を実行して、必要なページを要求します。 ページにグラフィックスが含まれている場合、ブラウザーは画像を取得するために追加の `GET` 操作を実行します。 `GET` 操作でサーバーに情報を渡す必要がある場合、情報はクエリ文字列の URL の一部として渡されます。
> - [https://login.microsoftonline.com/consumers/](`POST`) ブラウザーは、サーバー上で追加または変更されるデータを送信するために `POST` 要求を送信します。 たとえば、`POST` 動詞は、データベース内のレコードを作成したり、既存のレコードを変更したりするために使用されます。 ほとんどの場合、フォームに入力して [送信] ボタンをクリックすると、ブラウザーによって `POST` 操作が実行されます。 `POST` 操作では、サーバーに渡されるデータはページの本文に含まれます。
> 
> これらの動詞の重要な違いは、`GET` 操作ではサーバー上の何も変更されないことです。つまり、`GET` 操作によってサーバー上の状態が変更されることはありません。 同じリソースに対して `GET` 操作を何度でも実行でき、それらのリソースは変更されません。 (`GET` 操作は、"安全" と呼ばれることがよくあります。また、技術的な用語を使用する場合は、*べき等*です)。これとは対照的に、`POST` 要求では、操作を実行するたびにサーバー上の何かが変更されます。
> 
> この区別を示す2つの例があります。 Bing や Google などのエンジンを使用して検索を実行する場合は、1つのテキストボックスで構成されるフォームに入力し、[検索] ボタンをクリックします。 ブラウザーは、URL の一部として渡されたボックスに入力した値を使用して、`GET` 操作を実行します。 この種類のフォームに対して `GET` 操作を使用することは問題ありません。検索操作によってサーバー上のリソースが変更されることはないため、情報をフェッチするだけです。
> 
> 次に、何かをオンラインで注文するプロセスを検討します。 注文の詳細を入力し、[送信] ボタンをクリックします。 この操作は `POST` 要求になります。これは、新しい注文レコード、アカウント情報の変更、およびその他の多くの変更などがサーバーで変更されるためです。 `GET` 操作とは異なり、要求を再送信するたびに、サーバーに新しい注文が生成された場合は、`POST` 要求を繰り返すことはできません。 (このような場合、web サイトでは、[送信] ボタンを複数回クリックしないことを警告することがよくあります。または、誤ってフォームを再送信しないように、[送信] ボタンが無効になります)。
> 
> このチュートリアルでは、HTML フォームを操作するために、`GET` 操作と `POST` 操作の両方を使用します。 ここでは、使用する動詞が適切なものである場合について説明します。
> 
> (HTTP 動詞の詳細については、W3C サイトの[メソッド定義](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html)に関する記事を参照してください)。

ほとんどのユーザー入力要素は HTML `<input>` 要素です。 `<input type="type" name="name">,` のようになります。ここで、 *type*はユーザー入力コントロールの種類を示します。 一般的な要素は次のとおりです。

- テキストボックス: `<input type="text">`
- チェックボックス: `<input type="check">`
- オプションボタン: `<input type="radio">`
- ボタン: `<input type="button">`
- 送信ボタン: `<input type="submit">`

`<textarea>` 要素を使用して複数行のテキストボックスを作成し、`<select>` 要素を使用してドロップダウンリストまたはスクロール可能な一覧を作成することもできます。 (HTML フォーム要素の詳細については、「W3Schools サイトでの[Html フォームと入力](http://www.w3schools.com/html/html_forms.asp)」を参照してください)。

`name` 属性は、後で説明するように、後で要素の値を取得する方法であるため、非常に重要です。

興味深いのは、ユーザーの入力を使用した、ページの開発者です。 これらの要素に関連付けられた組み込みの動作はありません。 代わりに、ユーザーが入力または選択した値を取得し、その値を使用して操作を行う必要があります。 このチュートリアルで学習する内容は次のようになります。

> [!TIP] 
> 
> **HTML5 と入力フォーム**
> 
> ご存知のように、HTML は移行中であり、最新バージョン (HTML5) には、ユーザーが情報を入力するためのより直感的な方法がサポートされています。 たとえば、HTML5 では、ユーザーが日付を入力するように求めるページを表示することができます。 ブラウザーは、ユーザーが手動で日付を入力することを要求するのではなく、自動的に予定表を表示できます。 ただし、HTML5 は新しいものであり、すべてのブラウザーでまだサポートされていません。
> 
> ASP.NET Web ページは、ユーザーのブラウザーが行っているエクステントへの HTML5 入力をサポートしています。 HTML5 の `<input>` 要素の新しい属性の概念については、W3Schools サイトの「 [HTML &lt;入力&gt; Type 属性](http://www.w3schools.com/html/html_form_input_types.asp)」を参照してください。

## <a name="creating-the-form"></a>フォームの作成

WebMatrix の **[ファイル]** ワークスペースで、[*ムービー* ] ページを開きます。

終了 `</h1>` タグの後、`grid.GetHtml` 呼び出しの開始 `<div>` タグの前に、次のマークアップを追加します。

[!code-html[Main](form-basics/samples/sample2.html)]

このマークアップにより、`searchGenre` という名前のテキストボックスと [送信] ボタンを持つフォームが作成されます。 テキストボックスと送信ボタンは、`method` 属性が `get`に設定されている `<form>` 要素で囲まれています。 (テキストボックスと [送信] ボタンを `<form>` 要素内に配置しないと、ボタンをクリックしても何も送信されないことに注意してください)。ここでは `GET` 動詞を使用します。これは、サーバーに変更を加えないフォームを作成しているためです。これにより、検索結果が表示されます。 (前のチュートリアルでは、`post` 方法を使用しています。これは、サーバーに変更を送信する方法です。 これについては、次のチュートリアルでもう一度説明します)。

ページを実行します。 フォームの動作を定義していなくても、次のように表示されます。

![ジャンルの検索ボックスがあるムービーページ](form-basics/_static/image3.png)

テキストボックスに値を入力します ("コメディ" など)。 **[ジャンルの検索]** をクリックします。

ページの URL をメモしておきます。 `<form>` 要素の `method` 属性を `get`に設定するため、入力した値は URL のクエリ文字列の一部になります。次にその例を示します。

`http://localhost:45661/Movies.cshtml?searchGenre=Comedy`

## <a name="reading-form-values"></a>フォーム値の読み取り

このページには、データベースデータを取得し、結果をグリッドに表示するコードが既に含まれています。 次に、検索語句を含む SQL クエリを実行できるように、テキストボックスの値を読み取るコードを追加する必要があります。

フォームのメソッドを `get`に設定するため、次のようなコードを使用して、テキストボックスに入力された値を読み取ることができます。

`var searchTerm = Request.QueryString["searchGenre"];`

`Request.QueryString` オブジェクト (`Request` オブジェクトの `QueryString` プロパティ) には、`GET` 操作の一部として送信された要素の値が含まれます。 `Request.QueryString` プロパティには、フォームで送信される値の*コレクション*(リスト) が格納されます。 個々の値を取得するには、必要な要素の名前を指定します。 このため、テキストボックスを作成する `<input>` 要素 (`searchTerm`) に `name` 属性を設定する必要があります。 (`Request` オブジェクトの詳細については、後の「[サイドバー](#BKMK_TheRequestObject) 」を参照してください)。

テキストボックスの値を読み取るだけで十分です。 ただし、ユーザーがテキストボックスに何も入力せずに **[検索]** をクリックした場合は、検索するものがないため、このクリックを無視できます。

これらの条件を実装する方法を示すコード例を次に示します。 (このコードを追加する必要はありません。しばらくしてから作成してください)。

[!code-csharp[Main](form-basics/samples/sample3.cs)]

テストは次のように分割されます。

- `Request.QueryString["searchGenre"]`の値、つまり `searchGenre`という名前の `<input>` 要素に入力した値を取得します。
- `IsEmpty` メソッドを使用して空であるかどうかを確認します。 このメソッドは、何らかの値 (たとえば、form 要素) に値が含まれているかどうかを判断するための標準的な方法です。 しかし、実際には、空で*ない*場合にのみ注意してください。
- `IsEmpty` テストの前に `!` 演算子を追加します。 (`!` 演算子は、論理 NOT) を意味します。

英語では、`if` 条件全体が次のように変換されます。*フォームの searchGenre 要素が空でない場合、...*

このブロックは、検索語句を使用するクエリを作成するためのステージを設定します。 これは、次のセクションで行います。

<a id="BKMK_TheRequestObject"></a>

> [!TIP] 
> 
> **要求オブジェクト**
> 
> `Request` オブジェクトには、ページが要求または送信されたときにブラウザーがアプリケーションに送信するすべての情報が含まれています。 このオブジェクトには、テキストボックスの値やアップロードするファイルなど、ユーザーが指定した情報がすべて含まれます。 また、cookie、URL クエリ文字列の値 (存在する場合)、実行中のページのファイルパス、ユーザーが使用しているブラウザーの種類、ブラウザーで設定されている言語の一覧など、あらゆる種類の追加情報が含まれています。などです。
> 
> `Request` オブジェクトは、値の*コレクション*(リスト) です。 コレクションから個別の値を取得するには、その名前を指定します。
> 
> `var someValue = Request["name"];`
> 
> `Request` オブジェクトは、実際にいくつかのサブセットを公開します。 次に例を示します。
> 
> - 要求が `POST` 要求の場合、`Request.Form` は、送信された `<form>` 要素内の要素からの値を提供します。
> - `Request.QueryString` には、URL のクエリ文字列の値だけが表示されます。 (`http://mysite/myapp/page?searchGenre=action&page=2`のような URL では、URL の `?searchGenre=action&page=2` セクションはクエリ文字列です)。
> - `Request.Cookies` コレクションを使用すると、ブラウザーによって送信された cookie にアクセスできます。
> 
> 送信されたフォームにあることがわかっている値を取得するには、`Request["name"]`を使用します。 または、より具体的なバージョン `Request.Form["name"]` (`POST` 要求の場合) または `Request.QueryString["name"]` (`GET` 要求の場合) を使用することもできます。 もちろん、 *name*は取得する項目の名前です。
> 
> 取得する項目の名前は、使用しているコレクション内で一意である必要があります。 そのため、`Request` オブジェクトは `Request.Form` や `Request.QueryString`などのサブセットを提供します。 ページに `userName` という名前のフォーム要素が含まれており、`userName`という名前の cookie*も*含まれているとします。 `Request["userName"]`を取得した場合、フォーム値と cookie のどちらを使用するかによってあいまいになります。 ただし、`Request.Form["userName"]` または `Request.Cookie["userName"]`の場合は、取得する値を明示的に指定しています。
> 
> `Request.Form` や `Request.QueryString`など、興味のある `Request` のサブセットを使用することをお勧めします。 このチュートリアルで作成している単純なページでは、実際には何の違いもありません。 ただし、より複雑なページを作成する場合は、明示的なバージョン `Request.Form` または `Request.QueryString` を使用すると、ページにフォーム (または複数のフォーム)、cookie、クエリ文字列値などが含まれている場合に発生する問題を回避するのに役立ちます。

## <a name="creating-a-query-by-using-a-search-term"></a>検索用語を使用してクエリを作成する

これで、ユーザーが入力した検索用語を取得する方法がわかったので、それを使用するクエリを作成できます。 すべてのムービー項目をデータベースから取得するには、次のステートメントのような SQL クエリを使用していることに注意してください。

`SELECT * FROM Movies`

特定の映画だけを取得するには、`Where` 句を含むクエリを使用する必要があります。 この句を使用すると、クエリによって返される行の条件を設定できます。 次に例を示します。

`SELECT * FROM Movies WHERE Genre = 'Action'`

基本形式は `WHERE column = value`です。 検索対象に応じて、`>` (より大きい)、`<` (より小さい)、`<>` (等しくない)、`<=` (以下) などの `=`だけでなく、さまざまな演算子を使用することもできます。

注意が必要な場合は、SQL ステートメントの大文字と小文字は区別されません &mdash; `SELECT` は `Select` (または `select`) と同じです。 ただし、多くの場合、`SELECT` や `WHERE`のように、SQL ステートメントのキーワードを大文字にすると、読みやすくなります。

### <a name="passing-the-search-term-as-a-parameter"></a>検索用語をパラメーターとして渡す

特定のジャンルを検索するのは簡単ですが (`WHERE Genre = 'Action'`)、ユーザーが入力したジャンルを検索できるようにする必要があります。 これを行うには、検索する値のプレースホルダーを含む SQL クエリとしてを作成します。 このコマンドは次のようになります。

`SELECT * FROM Movies WHERE Genre = @0`

プレースホルダーは `@` 文字の後に0が続きます。 推測されるように、クエリには複数のプレースホルダーを含めることができ、`@0`、`@1`、`@2`などの名前が付けられます。

クエリを設定し、実際に値を渡すには、次のようなコードを使用します。

[!code-sql[Main](form-basics/samples/sample4.sql)]

このコードは、グリッドにデータを表示するために既に実行したものと似ています。 唯一の違いは次のとおりです。

- このクエリにはプレースホルダー (`WHERE Genre = @0"`) が含まれています。
- クエリは変数 (`selectCommand`) に格納されます。前に、クエリを `db.Query` メソッドに直接渡しました。
- `db.Query` メソッドを呼び出す場合は、プレースホルダーに使用するクエリと値の両方を渡します。 (クエリに複数のプレースホルダーがある場合は、それらすべてを個別の値としてメソッドに渡します)。

これらの要素をすべて一緒に配置すると、次のコードが表示されます。

[!code-csharp[Main](form-basics/samples/sample5.cs)]

> [!NOTE] 
> 
> **重要!** プレースホルダー (`@0`など) を使用して SQL コマンドに値を渡すことは、セキュリティのために*非常に重要*です。 ここに表示される方法は、変数データのプレースホルダーを使用して、SQL コマンドを構築する唯一の方法です。
> 
> リテラルテキストとユーザーから取得した値を連結 (連結) することで、SQL ステートメントを作成しないようにします。 ユーザー入力を SQL ステートメントに連結すると、サイトが*sql インジェクション攻撃*に対して開かれます。この攻撃では、悪意のあるユーザーが、データベースをハッキングするためのページに値を送信します。 (詳細については、MSDN web サイトの「 [SQL インジェクション](https://msdn.microsoft.com/library/ms161953.aspx)」を参照してください)。

## <a name="updating-the-movies-page-with-search-code"></a>検索コードを使用したムービーページの更新

これで、*ムービーの cshtml*ファイルのコードを更新できるようになりました。 まず、ページの先頭にあるコードブロック内のコードを次のコードに置き換えます。

[!code-csharp[Main](form-basics/samples/sample6.cs)]

ここでの違いは、クエリを `selectCommand` 変数に配置したことです。これは後 `db.Query` に渡すことができます。 SQL ステートメントを変数に指定すると、ステートメントを変更できます。このステートメントは、検索を実行するために使用します。

また、これらの2つの行を削除しました。これらは後で後で使用します。

[!code-csharp[Main](form-basics/samples/sample7.cs)]

クエリをまだ実行しない (つまり、`db.Query`を呼び出す) のではなく、`WebGrid` ヘルパーをまだ初期化する必要はありません。 実行する必要がある SQL ステートメントを特定した後に、これらの処理を行います。

この書き換えられたブロックの後に、検索を処理するための新しいロジックを追加できます。 完成したコードは次のようになります。 次の例に一致するように、ページ内のコードを更新します。

[!code-cshtml[Main](form-basics/samples/sample8.cshtml)]

これで、このページは次のように機能します。 このコードは、ページが実行されるたびにデータベースを開き、`selectCommand` 変数は、`Movies` テーブルからすべてのレコードを取得する SQL ステートメントに設定されます。 このコードでは、`searchTerm` 変数も初期化します。

ただし、現在の要求に `searchGenre` 要素の値が含まれている場合、コードは `selectCommand` を別のクエリ (つまり、ジャンルを検索する `Where` 句を含む) に設定します。 また、`searchTerm` を、検索ボックスに渡されたものにも設定します (これは何もできません)。

`selectCommand`にある SQL ステートメントに関係なく、コードは `db.Query` を呼び出してクエリを実行し、`searchTerm`にあるものを渡します。 `searchTerm`に何も含まれていない場合は、そのような場合でも、`selectCommand` に値を渡すパラメーターはありません。

最後に、このコードでは、前と同様に、クエリ結果を使用して `WebGrid` ヘルパーを初期化します。

SQL ステートメントと検索語句を変数に配置することで、コードに柔軟性を追加したことがわかります。 このチュートリアルで後ほど説明するように、この基本的なフレームワークを使用して、さまざまな種類の検索のロジックを追加することができます。

## <a name="testing-the-search-by-genre-feature"></a>ジャンル別検索機能のテスト

WebMatrix で、[*ムービー* ] ページを実行します。 ジャンルのテキストボックスを含むページが表示されます。

テストレコードのいずれかに入力したジャンルを入力し、 **[検索]** をクリックします。 今度は、そのジャンルに一致する映画だけが一覧表示されます。

![ジャンル ' Comedies ' を検索した後のムービーページリスト](form-basics/_static/image4.png)

別のジャンルを入力して、もう一度検索してください。 検索で大文字と小文字が区別されないことを確認できるように、すべて小文字または大文字を使用してジャンルを入力してみてください。

## <a name="remembering-what-the-user-entered"></a>ユーザーが入力した内容を記憶する

ジャンルを入力し、 **[ジャンルの検索]** をクリックすると、そのジャンルの一覧が表示されていることがわかります。 ただし、検索テキストボックスは空の &mdash;、入力した内容を覚えていませんでした。

この動作が発生する理由を理解しておくことが重要です。 ページを送信すると、ブラウザーは web サーバーに要求を送信します。 ASP.NET が要求を取得すると、ページの新しいインスタンスが作成され、その中のコードが実行されて、ブラウザーに再びページが表示されます。 しかし、実際には、以前のバージョンのを操作していたことはわかりません。 認識できるのは、何らかのフォームデータを含む要求を受け取ったことだけです。

ページを初めて要求する場合でも、ページを送信する場合でも、新しいページが表示される &mdash; には、ページを要求するたびに &mdash; ます。 Web サーバーには、前回の要求のメモリがありません。 どちらも ASP.NET ではなく、どちらもブラウザーを行いません。 このページの個別のインスタンス間の接続は、これらのインスタンス間で送信されるデータだけです。 たとえば、ページを送信する場合、新しいページインスタンスでは、前のインスタンスによって送信されたフォームデータを取得できます。 (ページ間でデータを渡すもう1つの方法は、cookie を使用することです)。

この状況を説明するための正式な方法は、web ページが*ステートレス*であるということです。 Web サーバー、ページ自体、およびページ内の要素は、ページの以前の状態に関する情報を保持しません。 Web はこのように設計されています。これは、個々の要求の状態を維持することで web サーバーのリソースを迅速に消費するためです。多くの場合、1秒あたり数百単位の要求を処理します。

このため、テキストボックスが空でした。 ページを送信した後、ASP.NET はページの新しいインスタンスを作成し、コードとマークアップを実行します。 ASP.NET がテキストボックスに値を設定するように指示したコードには何もありませんでした。 ASP.NET は何も実行しなかったので、テキストボックスは値なしでレンダリングされました。

実際には、この問題を回避するための簡単な方法があります。 テキストボックスに入力したジャンル*は*、`Request.QueryString["searchGenre"]`にある &mdash; コードで使用できます。

次の例のように、テキストボックスのマークアップを更新して、`value` 属性が `searchTerm`から値を取得するようにします。

[!code-html[Main](form-basics/samples/sample9.html?highlight=1)]

このページでは、`value` 属性を `searchTerm` 変数に設定することもできます。この変数には、入力したジャンルが含まれているためです。 ただし、このタスクを実行するには、次に示すように、`Request` オブジェクトを使用して、`value` 属性を設定します。 (この &mdash; を実行する場合は、フィールドに値を*指定せず*にページを表示することもできます。 これは、アプリで何が起こっているかによって異なります)。

> [!NOTE]
> パスワードに使用されるテキストボックスの値を「記憶」することはできません。 コードを使用してパスワードフィールドを入力することを許可するセキュリティホールです。

もう一度ページを実行し、ジャンルを入力して、 **[ジャンルの検索]** をクリックします。 今回は、検索結果が表示されるだけでなく、最後に入力した内容をテキストボックスに記憶します。

![テキストボックスに前のエントリが "記憶されました" と表示されていることを示すページ](form-basics/_static/image5.png)

## <a name="searching-for-any-word-in-the-title"></a>タイトル内の任意の単語を検索する

ジャンルを検索できるようになりましたが、タイトルを検索することもできます。 検索時にタイトルを正確に取得するのは難しいので、代わりに、タイトル内の任意の場所に表示される単語を検索できます。 SQL でこれを行うには、次のように `LIKE` 演算子と構文を使用します。

`SELECT * FROM Movies WHERE Title LIKE '%adventure%'`

このコマンドは、タイトルに "adventure" が含まれているすべての映画を取得します。 `LIKE` 演算子を使用する場合は、検索語句の一部としてワイルドカード文字 `%` を含めます。 検索 `LIKE 'adventure%'` は、"adventure ' で始まる" という意味です。 (技術的には、"文字列" adventure "の後に何かが続くことを意味します)。同様に、検索用語 `LIKE '%adventure'` は "adventure" という文字列が続くことを意味します。これは、"adventure ' で終わる" というもう1つの方法です。

したがって、検索用語 `LIKE '%adventure%'`、タイトルのどこかに "adventure" があることを意味します。 (技術的には、"タイトルに含まれるもの、" adventure "、その後に何かが続きます。")

`<form>` 要素内で、ジャンル検索の終了 `</div>` タグのすぐ下に、次のマークアップを追加します (終了 `</form>` 要素の直前)。

[!code-html[Main](form-basics/samples/sample10.html)]

この検索を処理するコードは、ジャンル検索のコードに似ていますが、`LIKE` 検索をアセンブルする必要がある点が異なります。 ページの上部にあるコードブロック内で、次の `if` ブロックを、ジャンル検索の `if` ブロックの直後に追加します。

[!code-csharp[Main](form-basics/samples/sample11.cs)]

このコードでは、前に見たものと同じロジックを使用します。ただし、検索では `LIKE` 演算子が使用され、コードでは検索語句の前後に "`%`" が挿入される点が異なります。

ページに別の検索を簡単に追加できることに注目してください。 必要な作業は次のとおりです。

- 関連する検索ボックスに値があるかどうかをテストする `if` ブロックを作成します。
- `selectCommand` 変数を新しい SQL ステートメントに設定します。
- `searchTerm` 変数に、クエリに渡す値を設定します。

次に、タイトル検索の新しいロジックを含む完全なコードブロックを示します。

[!code-cshtml[Main](form-basics/samples/sample12.cshtml)]

このコードの動作の概要を次に示します。

- 変数 `searchTerm` と `selectCommand` は、上部で初期化されます。 これらの変数は、適切な検索用語 (存在する場合) と、ユーザーがページで実行した内容に基づいて適切な SQL コマンドに設定されます。 既定の検索は、データベースからすべてのムービーを取得するための単純なケースです。
- `searchGenre` と `searchTitle`のテストでは、コードは検索する値に `searchTerm` を設定します。 また、これらのコードブロックは、その検索用の適切な SQL コマンドに `selectCommand` を設定します。
- `db.Query` メソッドは1回だけ呼び出され、任意の SQL コマンドが `selectedCommand` 内にあり、どの値も `searchTerm`に含まれています。 検索語句がない場合 (ジャンルとタイトルの単語がない場合)、`searchTerm` の値は空の文字列になります。 ただし、そうではありません。この場合、クエリにはパラメーターは必要ありません。

## <a name="testing-the-title-search-feature"></a>タイトル検索機能のテスト

これで、完成した検索ページをテストできます。 *ムービーの*を実行します。

ジャンルを入力し、 **[ジャンルの検索]** をクリックします。 グリッドには、そのジャンルの映画 (前など) が表示されます。

タイトルの単語を入力し、 **[検索タイトル]** をクリックします。 グリッドには、タイトルにその単語が含まれる映画が表示されます。

![タイトルで ' the ' を検索した後のムービーページリスト](form-basics/_static/image6.png)

両方のテキストボックスを空白のままにして、いずれかのボタンをクリックします。 グリッドには、すべてのムービーが表示されます。

## <a name="combining-the-queries"></a>クエリの結合

実行できる検索条件は排他的です。 両方の検索ボックスに値がある場合でも、タイトルとジャンルを同時に検索することはできません。 たとえば、タイトルに "Adventure" が含まれているすべてのアクションムービーを検索することはできません。 (ページが現在コーディングされているので、ジャンルとタイトルの両方に値を入力すると、タイトルの検索が優先されます)。条件を組み合わせた検索を作成するには、次のような構文を含む SQL クエリを作成する必要があります。

`SELECT * FROM Movies WHERE Genre = @0 AND Title LIKE @1`

また、次のようなステートメントを使用してクエリを実行する必要があります (おおよその話)。

`var selectedData = db.Query(selectCommand, searchGenre, searchTitle);`

検索条件の多くの順列を可能にするロジックを作成することは、ご覧のように、少し複雑になることがあります。 そのため、ここでは停止します。

## <a name="coming-up-next"></a>次へ

次のチュートリアルでは、フォームを使用するページを作成して、ユーザーがムービーをデータベースに追加できるようにします。

## <a name="complete-listing-for-movie-page-updated-with-search"></a>[ムービーの完全な一覧表示] ページ (検索で更新)

[!code-cshtml[Main](form-basics/samples/sample13.cshtml)]

## <a name="additional-resources"></a>その他のリソース

- [Razor 構文を使用した ASP.NET Web プログラミングの概要](https://go.microsoft.com/fwlink/?LinkID=202890)
- W3Schools サイトの[SQL WHERE 句](http://www.w3schools.com/sql/sql_where.asp)
- W3C サイトの[メソッド定義](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html)に関する記事

> [!div class="step-by-step"]
> [前へ](displaying-data.md)
> [次へ](entering-data.md)
