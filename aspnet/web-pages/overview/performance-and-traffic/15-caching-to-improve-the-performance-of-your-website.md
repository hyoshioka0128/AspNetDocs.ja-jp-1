---
uid: web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
title: パフォーマンスを向上させるために ASP.NET Web ページ (Razor) サイトでデータをキャッシュするMicrosoft Docs
author: Rick-Anderson
description: Web サイトを格納することによって web サイトを高速化できます (つまり、キャッシュ-通常は、データの取得または処理にかなりの時間がかかるデータの結果です...
ms.author: riande
ms.date: 02/14/2014
ms.assetid: 961e525b-7700-469e-8a68-d7010b6fb68c
msc.legacyurl: /web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
msc.type: authoredcontent
ms.openlocfilehash: 01796d3ca699a6af5d9162b22a926551435c2040
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78521158"
---
# <a name="caching-data-in-an-aspnet-web-pages-razor-site-for-better-performance"></a><span data-ttu-id="a4cb9-103">パフォーマンスを向上させるために ASP.NET Web ページ (Razor) サイトでデータをキャッシュする</span><span class="sxs-lookup"><span data-stu-id="a4cb9-103">Caching Data in an ASP.NET Web Pages (Razor) Site for Better Performance</span></span>

<span data-ttu-id="a4cb9-104">[Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="a4cb9-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="a4cb9-105">この記事では、ヘルパーを使用して、ASP.NET Web ページ (Razor) web サイトで高速なパフォーマンスを実現するための情報をキャッシュする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-105">This article explains how to use a helper to cache information for faster performance in an ASP.NET Web Pages (Razor) website.</span></span> <span data-ttu-id="a4cb9-106">Web サイトを格納&#8212;することで、web サイトの処理速度を&#8212;上げることができます。これにより、通常は取得や処理にかなり時間がかかるデータの結果がキャッシュされ、頻繁に変更されることはありません。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-106">You can speed up your website by having it store &#8212; that is, cache &#8212; the results of data that ordinarily would take considerable time to retrieve or process and that does not change often.</span></span>
> 
> <span data-ttu-id="a4cb9-107">**学習内容:**</span><span class="sxs-lookup"><span data-stu-id="a4cb9-107">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="a4cb9-108">キャッシュを使用して、web サイトの応答性を向上させる方法。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-108">How to use caching to improve the responsiveness of your website.</span></span>
> 
> <span data-ttu-id="a4cb9-109">この記事で導入された ASP.NET 機能を次に示します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-109">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="a4cb9-110">`WebCache` ヘルパー。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-110">The `WebCache` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="a4cb9-111">このチュートリアルで使用されているソフトウェアのバージョン</span><span class="sxs-lookup"><span data-stu-id="a4cb9-111">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="a4cb9-112">ASP.NET Web ページ (Razor) 3</span><span class="sxs-lookup"><span data-stu-id="a4cb9-112">ASP.NET Web Pages (Razor) 3</span></span>
>   
> 
> <span data-ttu-id="a4cb9-113">このチュートリアルは ASP.NET Web ページ2でも動作します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-113">This tutorial also works with ASP.NET Web Pages 2.</span></span>

<span data-ttu-id="a4cb9-114">他のユーザーがサイトからページを要求するたびに、web サーバーは、要求を満たすために何らかの作業を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-114">Every time someone requests a page from your site, the web server has to do some work in order to fulfill the request.</span></span> <span data-ttu-id="a4cb9-115">一部のページでは、データベースからのデータの取得など、(比較的) 長い時間を要するタスクをサーバーで実行しなければならない場合があります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-115">For some of your pages, the server might have to perform tasks that take a (comparatively) long time, such as retrieving data from a database.</span></span> <span data-ttu-id="a4cb9-116">これらのタスクが絶対に時間を要することがない場合でも、サイトで大量のトラフィックが発生した場合でも、web サーバーが複雑なタスクや低速のタスクを実行する原因となる一連の個別の要求は、大量の作業に追加される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-116">Even if these tasks don't take long in absolute terms, if your site experiences a lot of traffic, a whole series of individual requests that cause the web server to perform the complicated or slow task can add up to a lot of work.</span></span> <span data-ttu-id="a4cb9-117">これにより、最終的にサイトのパフォーマンスが低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-117">This can ultimately affect the performance of the site.</span></span>

<span data-ttu-id="a4cb9-118">このような状況で web サイトのパフォーマンスを向上させる方法の1つは、データをキャッシュすることです。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-118">One way to improve the performance of your website in circumstances like this is to cache data.</span></span> <span data-ttu-id="a4cb9-119">サイトが同じ情報に対して繰り返し要求を取得し、その情報をユーザーごとに変更する必要がなく、時間の区別がない場合は、データを一度フェッチまたは再計算するのではなく、一度フェッチしてから結果を保存することができます。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-119">If your site gets repeated requests for the same information, and the information does not need to be modified for each person, and it's not time sensitive, instead of re-fetching or recalculating it, you can fetch the data once and then store the results.</span></span> <span data-ttu-id="a4cb9-120">その情報に対して次に要求が送信されたときに、キャッシュから取得するだけです。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-120">The next time a request comes in for that information, you just get it out of the cache.</span></span>

<span data-ttu-id="a4cb9-121">一般に、頻繁に変更されない情報をキャッシュします。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-121">In general, you cache information that doesn't change frequently.</span></span> <span data-ttu-id="a4cb9-122">キャッシュに情報を格納すると、web サーバー上のメモリに格納されます。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-122">When you put information in the cache, it's stored in memory on the web server.</span></span> <span data-ttu-id="a4cb9-123">キャッシュする期間 (秒から日) を指定できます。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-123">You can specify how long it should be cached, from seconds to days.</span></span> <span data-ttu-id="a4cb9-124">キャッシュ期間が終了すると、情報はキャッシュから自動的に削除されます。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-124">When the caching period expires, the information is automatically removed from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="a4cb9-125">キャッシュ内のエントリは、有効期限が切れている以外の理由で削除される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-125">Entries in the cache might be removed for reasons other than that they've expired.</span></span> <span data-ttu-id="a4cb9-126">たとえば、web サーバーで一時的にメモリが不足している可能性があり、メモリを再利用する方法の1つとして、キャッシュからエントリをスローする方法があります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-126">For example, the web server might temporarily run low on memory, and one way it can reclaim memory is by throwing entries out of the cache.</span></span> <span data-ttu-id="a4cb9-127">ここで説明するように、キャッシュに情報を格納している場合でも、必要なときにまだ存在していることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-127">As you'll see, even if you've put information into the cache, you have to check to be sure it's still there when you need it.</span></span>

<span data-ttu-id="a4cb9-128">Web サイトに、現在の気温と天気予報を表示するページがあるとします。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-128">Imagine your website has a page that displays the current temperature and weather forecast.</span></span> <span data-ttu-id="a4cb9-129">この種類の情報を取得するには、外部サービスに要求を送信することがあります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-129">To get this type of information, you might send a request to an external service.</span></span> <span data-ttu-id="a4cb9-130">この情報はあまり変更されない (たとえば、2時間の期間内) ため、外部の呼び出しには時間と帯域幅が必要であるため、キャッシュの候補として適しています。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-130">Since this information doesn't change much (within a two-hour time period, for example) and since external calls require time and bandwidth, it's a good candidate for caching.</span></span>

## <a name="adding-caching-to-a-page"></a><span data-ttu-id="a4cb9-131">ページへのキャッシュの追加</span><span class="sxs-lookup"><span data-stu-id="a4cb9-131">Adding Caching to a Page</span></span>

<span data-ttu-id="a4cb9-132">ASP.NET には、サイトへのキャッシュの追加とキャッシュへのデータの追加を容易にする `WebCache` ヘルパーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-132">ASP.NET includes a `WebCache` helper that makes it easy to add caching to your site and add data to the cache.</span></span> <span data-ttu-id="a4cb9-133">この手順では、現在の時刻をキャッシュするページを作成します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-133">In this procedure, you'll create a page that caches the current time.</span></span> <span data-ttu-id="a4cb9-134">これは実際の例ではありません。現在の時刻は頻繁に変更され、さらには計算が複雑ではないためです。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-134">This isn't a real-world example, since the current time is something that does change often, and that moreover isn't complex to calculate.</span></span> <span data-ttu-id="a4cb9-135">ただし、実行中のキャッシュを示すことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-135">However, it's a good way to illustrate caching in action.</span></span>

1. <span data-ttu-id="a4cb9-136">*Webcache. cshtml*という名前の新しいページを web サイトに追加します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-136">Add a new page named *WebCache.cshtml* to the website.</span></span>
2. <span data-ttu-id="a4cb9-137">次のコードとマークアップをページに追加します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-137">Add the following code and markup to the page:</span></span>

    [!code-cshtml[Main](15-caching-to-improve-the-performance-of-your-website/samples/sample1.cshtml)]

    <span data-ttu-id="a4cb9-138">データをキャッシュするときに、名前を使用してキャッシュに格納します。これは、web サイト全体で一意です。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-138">When you cache data, you put it into the cache using a name this is unique across the website.</span></span> <span data-ttu-id="a4cb9-139">この場合は、`CachedTime`という名前のキャッシュエントリを使用します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-139">In this case, you'll use a cache entry named `CachedTime`.</span></span> <span data-ttu-id="a4cb9-140">これは、コード例に示されている `cacheItemKey` です。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-140">This is the `cacheItemKey` shown in the code example.</span></span>

    <span data-ttu-id="a4cb9-141">このコードは、最初に `CachedTime` キャッシュエントリを読み取ります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-141">The code first reads the `CachedTime` cache entry.</span></span> <span data-ttu-id="a4cb9-142">値が返された場合 (つまり、キャッシュエントリが null でない場合)、コードは時間変数の値をキャッシュデータに設定するだけです。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-142">If a value is returned (that is, if the cache entry isn't null), the code just sets the value of the time variable to the cache data.</span></span>

    <span data-ttu-id="a4cb9-143">ただし、キャッシュエントリが存在しない場合 (つまり null の場合)、コードは時刻値を設定してキャッシュに追加し、有効期限の値を1分に設定します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-143">However, if the cache entry doesn't exist (that is, it's null), the code sets the time value, adds it to the cache, and sets an expiration value to one minute.</span></span> <span data-ttu-id="a4cb9-144">1分後、キャッシュエントリは破棄されます。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-144">After one minute, the cache entry is discarded.</span></span> <span data-ttu-id="a4cb9-145">(キャッシュ内の項目の既定の有効期限の値は20分です)。コマンド `WebCache.Set(cacheItemKey, time, 1, false)` は、現在の時刻値をキャッシュに追加し、その有効期限を1分に設定する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-145">(The default expiration value for an item in the cache is 20 minutes.) The command `WebCache.Set(cacheItemKey, time, 1, false)` shows how to add the current time value to the cache and set its expiration to 1 minute.</span></span> <span data-ttu-id="a4cb9-146">*SlidingExpiration*パラメーターを `false` に設定すると、要求されるたびに有効期限が更新されなくなります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-146">Setting the *slidingExpiration* parameter to `false` means the expiration time is not renewed each time it is requested.</span></span> <span data-ttu-id="a4cb9-147">最初にキャッシュに追加されてから1分だけ有効期限が切れます。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-147">It will expire exactly 1 minute after it was originally added to the cache.</span></span> <span data-ttu-id="a4cb9-148">この値を `true` に設定すると、値がキャッシュから要求されるたびに1分の有効期限がリセットされます。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-148">If you set this value to `true` the 1 minute expiration time is reset each time the value is requested from the cache.</span></span>

    <span data-ttu-id="a4cb9-149">このコードは、データをキャッシュするときに常に使用する必要があるパターンを示しています。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-149">This code illustrates the pattern you should always use when you cache data.</span></span> <span data-ttu-id="a4cb9-150">キャッシュから取得する前に、`WebCache.Get` メソッドが null を返したかどうかを最初に確認してください。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-150">Before you get something out of the cache, always check first whether the `WebCache.Get` method has returned null.</span></span> <span data-ttu-id="a4cb9-151">キャッシュエントリの有効期限が切れているか、他の何らかの理由で削除された可能性があるため、特定のエントリがキャッシュ内に存在することは保証されないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-151">Remember that the cache entry might have expired or might have been removed for some other reason, so any given entry is never guaranteed to be in the cache.</span></span>
3. <span data-ttu-id="a4cb9-152">ブラウザーで*Webcache. cshtml*を実行します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-152">Run *WebCache.cshtml* in a browser.</span></span> <span data-ttu-id="a4cb9-153">(実行する前に、 **[ファイル]** ワークスペースでページが選択されていることを確認してください)。ページを初めて要求したときに、時間データがキャッシュに含まれておらず、コードによって時間値がキャッシュに追加されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-153">(Make sure the page is selected in the **Files** workspace before you run it.) The first time you request the page, the time data isn't in the cache, and the code has to add the time value to the cache.</span></span>

    ![cache-1](15-caching-to-improve-the-performance-of-your-website/_static/image1.jpg)
4. <span data-ttu-id="a4cb9-155">ブラウザーで*Webcache. cshtml*を更新します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-155">Refresh *WebCache.cshtml* in the browser.</span></span> <span data-ttu-id="a4cb9-156">今回は、時間データはキャッシュにあります。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-156">This time, the time data is in the cache.</span></span> <span data-ttu-id="a4cb9-157">最後にページを表示してから時間が変更されていないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-157">Notice that the time hasn't changed since the last time you viewed the page.</span></span>

    ![cache-2](15-caching-to-improve-the-performance-of-your-website/_static/image2.jpg)
5. <span data-ttu-id="a4cb9-159">キャッシュが空になるまで1分待ってから、ページを更新します。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-159">Wait one minute for the cache to be emptied, and then refresh the page.</span></span> <span data-ttu-id="a4cb9-160">このページでは、時間データがキャッシュ内に見つからなかったことが示され、更新された時間がキャッシュに追加されます。</span><span class="sxs-lookup"><span data-stu-id="a4cb9-160">The page again indicates that the time data wasn't found in the cache, and the updated time is added to the cache.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="a4cb9-161">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="a4cb9-161">Additional Resources</span></span>

- [<span data-ttu-id="a4cb9-162">グラフでデータを表示する</span><span class="sxs-lookup"><span data-stu-id="a4cb9-162">Displaying Data in a Chart</span></span>](https://go.microsoft.com/fwlink/?LinkId=202895)
- <span data-ttu-id="a4cb9-163">[Webcache API リファレンス](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx)(MSDN)</span><span class="sxs-lookup"><span data-stu-id="a4cb9-163">[WebCache API reference](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span></span>
