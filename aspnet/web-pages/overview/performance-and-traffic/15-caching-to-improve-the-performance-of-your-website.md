---
uid: web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
title: パフォーマンスを向上させるために ASP.NET Web ページ (Razor) サイトでデータをキャッシュするMicrosoft Docs
author: Rick-Anderson
description: Web サイトを格納することによって web サイトを高速化できます (つまり、キャッシュ-通常は、データの取得または処理にかなりの時間がかかるデータの結果です...
ms.author: riande
ms.date: 02/14/2014
ms.assetid: 961e525b-7700-469e-8a68-d7010b6fb68c
msc.legacyurl: /web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
msc.type: authoredcontent
ms.openlocfilehash: 01796d3ca699a6af5d9162b22a926551435c2040
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78521158"
---
# <a name="caching-data-in-an-aspnet-web-pages-razor-site-for-better-performance"></a>パフォーマンスを向上させるために ASP.NET Web ページ (Razor) サイトでデータをキャッシュする

[Tom FitzMacken](https://github.com/tfitzmac)

> この記事では、ヘルパーを使用して、ASP.NET Web ページ (Razor) web サイトで高速なパフォーマンスを実現するための情報をキャッシュする方法について説明します。 Web サイトを格納&#8212;することで、web サイトの処理速度を&#8212;上げることができます。これにより、通常は取得や処理にかなり時間がかかるデータの結果がキャッシュされ、頻繁に変更されることはありません。
> 
> **学習内容:** 
> 
> - キャッシュを使用して、web サイトの応答性を向上させる方法。
> 
> この記事で導入された ASP.NET 機能を次に示します。
> 
> - `WebCache` ヘルパー。
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>このチュートリアルで使用されているソフトウェアのバージョン
> 
> 
> - ASP.NET Web ページ (Razor) 3
>   
> 
> このチュートリアルは ASP.NET Web ページ2でも動作します。

他のユーザーがサイトからページを要求するたびに、web サーバーは、要求を満たすために何らかの作業を行う必要があります。 一部のページでは、データベースからのデータの取得など、(比較的) 長い時間を要するタスクをサーバーで実行しなければならない場合があります。 これらのタスクが絶対に時間を要することがない場合でも、サイトで大量のトラフィックが発生した場合でも、web サーバーが複雑なタスクや低速のタスクを実行する原因となる一連の個別の要求は、大量の作業に追加される可能性があります。 これにより、最終的にサイトのパフォーマンスが低下する可能性があります。

このような状況で web サイトのパフォーマンスを向上させる方法の1つは、データをキャッシュすることです。 サイトが同じ情報に対して繰り返し要求を取得し、その情報をユーザーごとに変更する必要がなく、時間の区別がない場合は、データを一度フェッチまたは再計算するのではなく、一度フェッチしてから結果を保存することができます。 その情報に対して次に要求が送信されたときに、キャッシュから取得するだけです。

一般に、頻繁に変更されない情報をキャッシュします。 キャッシュに情報を格納すると、web サーバー上のメモリに格納されます。 キャッシュする期間 (秒から日) を指定できます。 キャッシュ期間が終了すると、情報はキャッシュから自動的に削除されます。

> [!NOTE]
> キャッシュ内のエントリは、有効期限が切れている以外の理由で削除される可能性があります。 たとえば、web サーバーで一時的にメモリが不足している可能性があり、メモリを再利用する方法の1つとして、キャッシュからエントリをスローする方法があります。 ここで説明するように、キャッシュに情報を格納している場合でも、必要なときにまだ存在していることを確認する必要があります。

Web サイトに、現在の気温と天気予報を表示するページがあるとします。 この種類の情報を取得するには、外部サービスに要求を送信することがあります。 この情報はあまり変更されない (たとえば、2時間の期間内) ため、外部の呼び出しには時間と帯域幅が必要であるため、キャッシュの候補として適しています。

## <a name="adding-caching-to-a-page"></a>ページへのキャッシュの追加

ASP.NET には、サイトへのキャッシュの追加とキャッシュへのデータの追加を容易にする `WebCache` ヘルパーが含まれています。 この手順では、現在の時刻をキャッシュするページを作成します。 これは実際の例ではありません。現在の時刻は頻繁に変更され、さらには計算が複雑ではないためです。 ただし、実行中のキャッシュを示すことをお勧めします。

1. *Webcache. cshtml*という名前の新しいページを web サイトに追加します。
2. 次のコードとマークアップをページに追加します。

    [!code-cshtml[Main](15-caching-to-improve-the-performance-of-your-website/samples/sample1.cshtml)]

    データをキャッシュするときに、名前を使用してキャッシュに格納します。これは、web サイト全体で一意です。 この場合は、`CachedTime`という名前のキャッシュエントリを使用します。 これは、コード例に示されている `cacheItemKey` です。

    このコードは、最初に `CachedTime` キャッシュエントリを読み取ります。 値が返された場合 (つまり、キャッシュエントリが null でない場合)、コードは時間変数の値をキャッシュデータに設定するだけです。

    ただし、キャッシュエントリが存在しない場合 (つまり null の場合)、コードは時刻値を設定してキャッシュに追加し、有効期限の値を1分に設定します。 1分後、キャッシュエントリは破棄されます。 (キャッシュ内の項目の既定の有効期限の値は20分です)。コマンド `WebCache.Set(cacheItemKey, time, 1, false)` は、現在の時刻値をキャッシュに追加し、その有効期限を1分に設定する方法を示しています。 *SlidingExpiration*パラメーターを `false` に設定すると、要求されるたびに有効期限が更新されなくなります。 最初にキャッシュに追加されてから1分だけ有効期限が切れます。 この値を `true` に設定すると、値がキャッシュから要求されるたびに1分の有効期限がリセットされます。

    このコードは、データをキャッシュするときに常に使用する必要があるパターンを示しています。 キャッシュから取得する前に、`WebCache.Get` メソッドが null を返したかどうかを最初に確認してください。 キャッシュエントリの有効期限が切れているか、他の何らかの理由で削除された可能性があるため、特定のエントリがキャッシュ内に存在することは保証されないことに注意してください。
3. ブラウザーで*Webcache. cshtml*を実行します。 (実行する前に、 **[ファイル]** ワークスペースでページが選択されていることを確認してください)。ページを初めて要求したときに、時間データがキャッシュに含まれておらず、コードによって時間値がキャッシュに追加されている必要があります。

    ![cache-1](15-caching-to-improve-the-performance-of-your-website/_static/image1.jpg)
4. ブラウザーで*Webcache. cshtml*を更新します。 今回は、時間データはキャッシュにあります。 最後にページを表示してから時間が変更されていないことに注意してください。

    ![cache-2](15-caching-to-improve-the-performance-of-your-website/_static/image2.jpg)
5. キャッシュが空になるまで1分待ってから、ページを更新します。 このページでは、時間データがキャッシュ内に見つからなかったことが示され、更新された時間がキャッシュに追加されます。

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>その他のリソース

- [グラフでデータを表示する](https://go.microsoft.com/fwlink/?LinkId=202895)
- [Webcache API リファレンス](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx)(MSDN)
