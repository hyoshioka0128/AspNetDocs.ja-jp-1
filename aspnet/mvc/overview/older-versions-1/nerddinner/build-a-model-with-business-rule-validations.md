---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: ビジネスルール検証を使用してモデルを構築する |Microsoft Docs
author: microsoft
description: 手順 3. では、データベースのクエリと更新の両方に使用できるモデルを作成する方法を示します。
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 6ebf1b71c089229ba9139ff7dc788b8978724046
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78435580"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="e3ad4-103">ビジネス ルール検証でモデルをビルドする</span><span class="sxs-lookup"><span data-stu-id="e3ad4-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="e3ad4-104">[Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="e3ad4-104">by [Microsoft](https://github.com/microsoft)</span></span>

<span data-ttu-id="e3ad4-105">[[Download PDF]\(PDF をダウンロード\)](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e3ad4-105">[Download PDF](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)</span></span>

> <span data-ttu-id="e3ad4-106">これは、ASP.NET MVC 1 を使用して小規模で完成した web アプリケーションを構築する方法について説明する無料の["" アプリケーションのチュートリアル](introducing-the-nerddinner-tutorial.md)の手順3です。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="e3ad4-107">手順 3. では、データベースのクエリと更新の両方に使用できるモデルを作成する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="e3ad4-108">ASP.NET MVC 3 を使用している場合は、MVC 3 または[Mvc ミュージックストア](../../older-versions/mvc-music-store/mvc-music-store-part-1.md)[のチュートリアルではじめに](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md)に従うことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="e3ad4-109">手順 3: モデルを作成する</span><span class="sxs-lookup"><span data-stu-id="e3ad4-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="e3ad4-110">モデルビューコントローラーフレームワークでは、"モデル" という用語は、アプリケーションのデータを表すオブジェクトと、検証とビジネスルールを統合するための対応するドメインロジックを指します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="e3ad4-111">このモデルは、多くの点で MVC ベースのアプリケーションの "ハート" と呼ばれています。このモデルの動作は、後ほど根本的に左右されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="e3ad4-112">ASP.NET MVC フレームワークは、任意のデータアクセステクノロジの使用をサポートしており、開発者は、LINQ to Entities、LINQ to SQL、NHibernate、LLBLGen Pro、SubSonic、、または生の ADO のようなモデルを実装するために、さまざまな豊富な .NET データオプションから選択できます。NET Datareader またはデータセット。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="e3ad4-113">このアプリケーションでは、LINQ to SQL を使用して、データベースの設計に厳密に対応する単純なモデルを作成し、カスタム検証ロジックとビジネスルールを追加します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="e3ad4-114">次に、アプリケーションの他の部分からデータ永続化の実装を抽象化するのに役立つリポジトリクラスを実装します。これにより、簡単に単体テストを実行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="e3ad4-115">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="e3ad4-115">LINQ to SQL</span></span>

<span data-ttu-id="e3ad4-116">LINQ to SQL は、.NET 3.5 の一部として出荷される ORM (オブジェクトリレーショナルマッパー) です。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="e3ad4-117">LINQ to SQL を使用すると、コードに対して使用できる .NET クラスにデータベーステーブルを簡単にマップできます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="e3ad4-118">このアプリケーションでは、このアプリケーションを使用して、データベース内のディナーテーブルと RSVP テーブルをディナーおよび RSVP クラスにマップします。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="e3ad4-119">ディナーテーブルと RSVP テーブルの列は、ディナークラスと RSVP クラスのプロパティに対応しています。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="e3ad4-120">各ディナーおよび RSVP オブジェクトは、データベース内のディナーテーブルまたは RSVP テーブル内の個別の行を表します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="e3ad4-121">LINQ to SQL を使用すると、SQL ステートメントを手動で作成して、データベースデータでディナーおよび RSVP オブジェクトを取得および更新する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="e3ad4-122">代わりに、ディナークラスと RSVP クラス、データベースとの間のマッピング、およびそれらの間のリレーションシップを定義します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="e3ad4-123">次に、操作と使用時に実行時に使用する適切な SQL 実行ロジックの生成が LINQ to SQL によって行われます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="e3ad4-124">VB の LINQ 言語サポートを使用して、 C#データベースからディナーおよび RSVP オブジェクトを取得する表現力のあるクエリを記述することができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="e3ad4-125">これにより、記述する必要があるデータコードの量が最小限に抑えられ、本当にクリーンなアプリケーションを作成できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="e3ad4-126">プロジェクトへの LINQ to SQL クラスの追加</span><span class="sxs-lookup"><span data-stu-id="e3ad4-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="e3ad4-127">まず、プロジェクト内の "モデル" フォルダーを右クリックし、[**新しい項目の&gt;追加**] メニューコマンドを選択します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="e3ad4-128">[新しい項目の追加] ダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="e3ad4-129">"Data" カテゴリによってフィルター処理を行い、その中に "LINQ to SQL Classes" テンプレートを選択します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="e3ad4-130">項目に "" という名前を指定し、[追加] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="e3ad4-131">Visual Studio は、次のように、モデルのディレクトリにある .dbml ファイルを追加し、LINQ to SQL オブジェクトリレーショナルデザイナーを開きます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="e3ad4-132">LINQ to SQL を使用したデータモデルクラスの作成</span><span class="sxs-lookup"><span data-stu-id="e3ad4-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="e3ad4-133">LINQ to SQL を使用すると、既存のデータベーススキーマからデータモデルクラスをすばやく作成できます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="e3ad4-134">これを行うには、サーバーエクスプローラーで [データベース] を開き、モデル化するテーブルを選択します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="e3ad4-135">テーブルを LINQ to SQL デザイナー画面にドラッグすることができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="e3ad4-136">LINQ to SQL この操作を実行すると、テーブルのスキーマ (データベーステーブルの列にマップされたクラスプロパティを含む) を使用して、ディナーおよび RSVP クラスが自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="e3ad4-137">既定では、データベーススキーマに基づいてクラスを作成するときに、LINQ to SQL デザイナーはテーブル名と列名を自動的に "複数化" します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="e3ad4-138">たとえば、上の例の "ディナー" テーブルは "ディナー" クラスになりました。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="e3ad4-139">このクラスの名前付けは、モデルを .NET の名前付け規則と一貫性のあるものにするために役立ちます。また、通常は、デザイナーを使用して適切に修正することをお勧めします (多数のテーブルを追加する場合は特に)。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="e3ad4-140">デザイナーが生成するクラスまたはプロパティの名前が気に入らない場合は、いつでもオーバーライドして任意の名前に変更することができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="e3ad4-141">これを行うには、デザイナー内のエンティティまたはプロパティ名をインラインで編集するか、プロパティグリッドを使用して変更します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="e3ad4-142">既定では、LINQ to SQL デザイナーによってテーブルの主キー/外部キーのリレーションシップも検査され、作成される異なるモデルクラス間に既定の "リレーションシップの関連付け" が自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="e3ad4-143">たとえば、ディナーテーブルと RSVP テーブルを LINQ to SQL デザイナーにドラッグした場合、その2つの間の一対多リレーションシップの関連付けは、RSVP テーブルにディナーテーブルへの外部キーがあるという事実に基づいて推定されます (これは、デザイナー):</span><span class="sxs-lookup"><span data-stu-id="e3ad4-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="e3ad4-144">上記の関連付けにより、厳密に型指定された "ディナー" プロパティが、開発者が特定の RSVP に関連付けられているディナーにアクセスするために使用できる、RSVP クラスに追加さ LINQ to SQL ます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="e3ad4-145">また、ディナークラスに "RSVPs" コレクションプロパティが含まれるようになります。これにより、開発者は特定のディナーに関連付けられた RSVP オブジェクトを取得および更新できます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="e3ad4-146">新しい RSVP オブジェクトを作成してディナーの RSVPs collection に追加すると、Visual Studio 内の intellisense の例が表示されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="e3ad4-147">LINQ to SQL によって、ディナーオブジェクトに "RSVPs" コレクションが自動的に追加されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="e3ad4-148">ここでは、RSVPs コレクションに RSVP オブジェクトを追加することにより、ディナーとデータベース内の RSVP 行との間に外部キーのリレーションシップを関連付けるように LINQ to SQL 指示します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="e3ad4-149">デザイナーがテーブルの関連付けをモデル化または名前付けした方法が気に入らない場合は、それをオーバーライドできます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="e3ad4-150">デザイナー内の [association] 矢印をクリックし、プロパティグリッドを使用してプロパティにアクセスし、名前の変更、削除、または変更を行います。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="e3ad4-151">ただし、このアプリケーションでは、既定のアソシエーションルールは、開発中のデータモデルクラスに対して適切に機能します。既定の動作を使用するだけで済みます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="e3ad4-152">のクラス</span><span class="sxs-lookup"><span data-stu-id="e3ad4-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="e3ad4-153">Visual Studio では、LINQ to SQL デザイナーを使用して定義されたモデルとデータベースリレーションシップを表す .NET クラスが自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="e3ad4-154">LINQ to SQL DataContext クラスは、ソリューションに追加された各 LINQ to SQL デザイナーファイルに対しても生成されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="e3ad4-155">ここでは LINQ to SQL クラス項目に "" は "" という名前を付けているので、作成された DataContext クラスは "" という名前になります。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="e3ad4-156">このクラスは、データベースを操作する主な方法です。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="e3ad4-157">"ディナー" と "RSVPs" という2つのプロパティが公開されています。このクラスは、データベース内でモデル化された2つのテーブルを表しています。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="e3ad4-158">を使用C#すると、これらのプロパティに対して LINQ クエリを作成し、データベースからディナーおよび RSVP オブジェクトを照会して取得することができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="e3ad4-159">次のコードは、ディナーオブジェクトをインスタンス化し、それに対して LINQ クエリを実行して、今後発生する一連のを取得する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="e3ad4-160">Visual Studio は、LINQ クエリを記述するときに完全な intellisense を提供します。また、そのオブジェクトから返されたオブジェクトは厳密に型指定され、intellisense もサポートしています。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="e3ad4-161">ディナーおよび RSVP オブジェクトのクエリを実行できるようにするだけでなく、それを通じて取得したディナーおよび RSVP オブジェクトに対して行われた変更も、自動的に追跡されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="e3ad4-162">この機能を使用すると、明示的な SQL update コードを記述しなくても、データベースに変更を簡単に保存できます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="e3ad4-163">たとえば、次のコードは、LINQ クエリを使用してデータベースから単一のディナーオブジェクトを取得し、2つのディナープロパティを更新して、変更をデータベースに保存する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="e3ad4-164">上記のコードでは、このオブジェクトから取得したディナーオブジェクトに対して行われたプロパティの変更が自動的に追跡されています。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="e3ad4-165">"SubmitChanges ()" メソッドを呼び出した場合、更新された値を保持するために、適切な SQL "UPDATE" ステートメントをデータベースに対して実行します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="e3ad4-166">Dinのリポジトリクラスを作成する</span><span class="sxs-lookup"><span data-stu-id="e3ad4-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="e3ad4-167">小規模なアプリケーションの場合、コントローラーを LINQ to SQL DataContext クラスに対して直接動作させ、コントローラー内に LINQ クエリを埋め込むことが問題になることがあります。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="e3ad4-168">しかし、アプリケーションの規模が大きくなるにつれて、このアプローチは保守とテストが煩雑になります。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="e3ad4-169">また、同じ LINQ クエリを複数の場所で複製することもできます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="e3ad4-170">アプリケーションの保守とテストを容易にする方法の1つは、"リポジトリ" パターンを使用することです。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="e3ad4-171">リポジトリクラスは、データのクエリと永続化ロジックをカプセル化し、アプリケーションからのデータ永続化の実装の詳細を抽象化するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="e3ad4-172">アプリケーションコードをすっきりさせるだけでなく、リポジトリパターンを使用すると、将来のデータストレージの実装を簡単に変更できるようになります。また、実際のデータベースを必要とせずに、アプリケーションの単体テストを容易にすることができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="e3ad4-173">このアプリケーションでは、次のシグネチャを使用して Dinのリポジトリクラスを定義します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="e3ad4-174">*注: この章の後の方で、このクラスから IDinnerRepository インターフェイスを抽出し、コントローラーでの依存関係の挿入を有効にします。最初に、簡単に始めて、Dinのリポジトリクラスを直接操作します。*</span><span class="sxs-lookup"><span data-stu-id="e3ad4-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="e3ad4-175">このクラスを実装するには、[モデル] フォルダーを右クリックし、[**新しい項目の&gt;追加**] メニューコマンドを選択します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="e3ad4-176">[新しい項目の追加] ダイアログボックスで、"Class" テンプレートを選択し、ファイルに "DinnerRepository.cs" という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="e3ad4-177">次のコードを使用して、Din: Repository クラスを実装できます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="e3ad4-178">Dinのリポジトリクラスを使用した取得、更新、挿入、および削除</span><span class="sxs-lookup"><span data-stu-id="e3ad4-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="e3ad4-179">これで、Dinのリポジトリクラスが作成されました。次に、それを使用して実行できる一般的なタスクを示すいくつかのコード例を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="e3ad4-180">クエリの例</span><span class="sxs-lookup"><span data-stu-id="e3ad4-180">Querying Examples</span></span>

<span data-ttu-id="e3ad4-181">次のコードは、Dinid 値を使用して1つのディナーを取得します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="e3ad4-182">次のコードは、今後のすべてのディナーとループを取得します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="e3ad4-183">挿入と更新の例</span><span class="sxs-lookup"><span data-stu-id="e3ad4-183">Insert and Update Examples</span></span>

<span data-ttu-id="e3ad4-184">次のコードは、2つの新しいディナーを追加する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="e3ad4-185">リポジトリに対する追加や変更は、"Save ()" メソッドが呼び出されるまでデータベースにコミットされません。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="e3ad4-186">LINQ to SQL によって、データベーストランザクションのすべての変更が自動的にラップされます。そのため、すべての変更が行われるか、リポジトリに保存されるときにいずれの変更も行われません。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="e3ad4-187">次のコードでは、既存のディナーオブジェクトを取得し、そのオブジェクトの2つのプロパティを変更します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="e3ad4-188">リポジトリで "Save ()" メソッドが呼び出されると、変更がデータベースにコミットされます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="e3ad4-189">次のコードは、ディナーを取得し、それに対して RSVP を追加します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="e3ad4-190">これを行うには、LINQ to SQL 作成したディナーオブジェクトの RSVPs コレクションを使用します (データベース内の2つの間に主キー/外部キーのリレーションシップがあるため)。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="e3ad4-191">この変更は、リポジトリで "Save ()" メソッドが呼び出されたときに、新しい RSVP テーブル行としてデータベースに戻されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="e3ad4-192">Delete の例</span><span class="sxs-lookup"><span data-stu-id="e3ad4-192">Delete Example</span></span>

<span data-ttu-id="e3ad4-193">次のコードでは、既存のディナーオブジェクトを取得し、削除対象としてマークします。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="e3ad4-194">リポジトリで "Save ()" メソッドが呼び出されると、削除がデータベースにコミットされます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="e3ad4-195">検証とビジネスルールロジックのモデルクラスとの統合</span><span class="sxs-lookup"><span data-stu-id="e3ad4-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="e3ad4-196">検証とビジネスルールのロジックの統合は、データを処理するアプリケーションの重要な部分です。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="e3ad4-197">スキーマの検証</span><span class="sxs-lookup"><span data-stu-id="e3ad4-197">Schema Validation</span></span>

<span data-ttu-id="e3ad4-198">LINQ to SQL デザイナーを使用してモデルクラスが定義されている場合、データモデルクラスのプロパティのデータ型はデータベーステーブルのデータ型に対応します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="e3ad4-199">たとえば、ディナーテーブルの "EventDate" 列が "datetime" の場合、LINQ to SQL によって作成されたデータモデルクラスは "DateTime" (組み込みの .NET データ型) になります。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="e3ad4-200">つまり、コードから整数またはブール値を割り当てようとするとコンパイルエラーが発生し、実行時に有効でない文字列型を暗黙的に変換しようとすると、エラーが自動的に発生します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="e3ad4-201">また、LINQ to SQL では、文字列を使用する場合に SQL の値のエスケープが自動的に処理されます。これにより、SQL インジェクション攻撃を防ぐのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="e3ad4-202">検証とビジネスルールのロジック</span><span class="sxs-lookup"><span data-stu-id="e3ad4-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="e3ad4-203">スキーマの検証は、最初の手順としては便利ですが、あまり十分ではありません。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="e3ad4-204">ほとんどの実際のシナリオでは、より高度な検証ロジックを指定する機能が必要です。これは、複数のプロパティにまたがることができ、コードを実行し、多くの場合、モデルの状態を認識します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="e3ad4-205">モデルクラスに検証ルールを定義して適用するために使用できるさまざまなパターンとフレームワークが用意されています。また、これを支援するために使用できる .NET ベースのフレームワークがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="e3ad4-206">ASP.NET MVC アプリケーション内では、ほとんどすべてを使用できます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="e3ad4-207">私たちは、このアプリケーションのために、ディナーモデルオブジェクトに対して IsValid プロパティと GetRuleViolations () メソッドを公開する、比較的単純でストレートなパターンを使用します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="e3ad4-208">IsValid プロパティは、検証ルールとビジネスルールがすべて有効であるかどうかに応じて、true または false を返します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="e3ad4-209">GetRuleViolations () メソッドは、ルールエラーの一覧を返します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="e3ad4-210">"部分クラス" をプロジェクトに追加して、ディナーモデルに対して IsValid と GetRuleViolations () を実装します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="e3ad4-211">部分クラスを使用すると、VS デザイナーによって管理されているクラス (LINQ to SQL デザイナーによって生成されるディナークラスなど) にメソッド/プロパティ/イベントを追加したり、ツールがコードと触っことがないようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="e3ad4-212">新しい部分クラスをプロジェクトに追加するには、[モデル] フォルダーを右クリックし、[新しい項目の追加] メニューコマンドを選択します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="e3ad4-213">次に、[新しい項目の追加] ダイアログボックスで "Class" テンプレートを選択して、Dinner.cs という名前を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="e3ad4-214">[追加] ボタンをクリックすると、Dinner.cs ファイルがプロジェクトに追加され、IDE 内で開かれます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="e3ad4-215">その後、次のコードを使用して、基本的なルール/検証実施フレームワークを実装できます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="e3ad4-216">上記のコードについては、次の点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-216">A few notes about the above code:</span></span>

- <span data-ttu-id="e3ad4-217">ディナークラスには "partial" キーワードが付いています。これは、その中に含まれるコードが、LINQ to SQL デザイナーによって生成または管理され、1つのクラスにコンパイルされたクラスと結合されることを意味します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="e3ad4-218">RuleViolation クラスは、プロジェクトに追加するヘルパークラスであり、規則違反に関する詳細情報を提供することができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="e3ad4-219">GetRuleViolations () メソッドを使用すると、検証とビジネスルールが評価されます (後で実装します)。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="e3ad4-220">次に、ルールエラーに関する詳細情報を提供する RuleViolation オブジェクトのシーケンスを返します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="e3ad4-221">ディナープロパティは、ディナーオブジェクトにアクティブな RuleViolations があるかどうかを示す便利なヘルパープロパティを提供します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="e3ad4-222">常にディナーオブジェクトを使用して開発者が積極的にチェックすることができます (例外は発生しません)。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="e3ad4-223">ディナー () 部分メソッドは、ディナーオブジェクトがデータベース内で保持されようとしているときに通知を受け取ることができるようにするフック LINQ to SQL です。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="e3ad4-224">上記の OnValidate () 実装により、ディナーが保存される前に、ディナー違反がないことが保証されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="e3ad4-225">無効な状態にある場合は、例外が発生し、LINQ to SQL によってトランザクションが中止されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="e3ad4-226">この方法では、検証とビジネスルールをに統合できる単純なフレームワークが提供されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="e3ad4-227">ここでは、次のルールを GetRuleViolations () メソッドに追加します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="e3ad4-228">ここでは、のC# "yield return" 機能を使用して、ruleviolations のシーケンスを返しています。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="e3ad4-229">上記の最初の6つのルールチェックでは、ディナーの文字列プロパティを null または空にすることはできません。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="e3ad4-230">最後の規則はもう少し興味深いものであり、次のように、プロジェクトに追加して、ContactPhone の番号の形式がディナーの国と一致することを確認するためにプロジェクトに追加できる、参照してください。 IsValidNumber () ヘルパーメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="e3ad4-231">を使用できます。この電話検証サポートを実装するための、NET の正規表現サポート。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="e3ad4-232">次に示すのは、国固有の正規表現パターンチェックを追加できるようにするプロジェクトに追加できる、次のような、簡単な電話検証の実装です。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="e3ad4-233">検証とビジネスロジック違反の処理</span><span class="sxs-lookup"><span data-stu-id="e3ad4-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="e3ad4-234">上記の検証とビジネスルールコードを追加したので、ディナーを作成または更新しようとするたびに、検証ロジックルールが評価され、適用されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="e3ad4-235">開発者は、次のようなコードを記述して、ディナーオブジェクトが有効かどうかを事前に判断し、例外を発生させずにすべての違反の一覧を取得することができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="e3ad4-236">ディナーを無効な状態で保存しようとすると、Dinrepository で Save () メソッドを呼び出すと例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="e3ad4-237">これは、LINQ to SQL がディナーの変更を保存する前に、ディナー () 部分メソッドを自動的に呼び出し、ディナーに規則違反が存在する場合に例外を発生させるコードをディナー () に追加したためです。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="e3ad4-238">この例外をキャッチして、修正する違反の一覧を事後で取得することができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="e3ad4-239">検証とビジネスルールは、UI レイヤー内ではなく、モデルレイヤー内に実装されるため、アプリケーション内のすべてのシナリオで適用および使用されます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="e3ad4-240">後でビジネスルールを変更または追加し、ディナーオブジェクトで動作するすべてのコードでそれらを優先することができます。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="e3ad4-241">これらの変更をアプリケーションおよび UI ロジック全体に波及させずに、ビジネスルールを1か所で柔軟に変更できるようにすることは、適切に記述されたアプリケーションの署名であり、MVC フレームワークが推奨する利点です。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="e3ad4-242">次の手順</span><span class="sxs-lookup"><span data-stu-id="e3ad4-242">Next Step</span></span>

<span data-ttu-id="e3ad4-243">これで、データベースのクエリと更新の両方に使用できるモデルが完成しました。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="e3ad4-244">ここで、いくつかのコントローラーとビューをプロジェクトに追加して、それに関する HTML UI エクスペリエンスを構築するために使用できるようにしましょう。</span><span class="sxs-lookup"><span data-stu-id="e3ad4-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e3ad4-245">[前へ](create-a-database.md)
> [次へ](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="e3ad4-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
