---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
title: 'イテレーション #5 –単体テストを作成する (VB) |Microsoft Docs'
author: microsoft
description: 5番目のイテレーションでは、単体テストを追加することによって、アプリケーションの保守と変更を容易にします。 私たちは、データモデルクラスを作成し、
ms.author: riande
ms.date: 02/20/2009
ms.assetid: c6e5c036-2265-4fa7-a9eb-47f197bdc262
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
msc.type: authoredcontent
ms.openlocfilehash: 4ce1c6224a7e9203ff62f136f4f3a43e4561a904
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78437836"
---
# <a name="iteration-5--create-unit-tests-vb"></a><span data-ttu-id="2e92c-104">イテレーション #5 –単体テストを作成する (VB)</span><span class="sxs-lookup"><span data-stu-id="2e92c-104">Iteration #5 – Create unit tests (VB)</span></span>

<span data-ttu-id="2e92c-105">[Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="2e92c-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="2e92c-106">コードのダウンロード</span><span class="sxs-lookup"><span data-stu-id="2e92c-106">Download Code</span></span>](iteration-5-create-unit-tests-vb/_static/contactmanager_5_vb1.zip)

> <span data-ttu-id="2e92c-107">5番目のイテレーションでは、単体テストを追加することによって、アプリケーションの保守と変更を容易にします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="2e92c-108">データモデルクラスをモック化し、コントローラーと検証ロジックの単体テストをビルドします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a><span data-ttu-id="2e92c-109">Contact Management ASP.NET MVC アプリケーションの構築 (VB)</span><span class="sxs-lookup"><span data-stu-id="2e92c-109">Building a Contact Management ASP.NET MVC Application (VB)</span></span>

<span data-ttu-id="2e92c-110">この一連のチュートリアルでは、最初から最後まで、連絡先管理アプリケーション全体を作成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="2e92c-111">連絡先マネージャーアプリケーションを使用すると、連絡先情報 (名前、電話番号、電子メールアドレスなど) をユーザーの一覧に格納できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="2e92c-112">複数のイテレーションに対してアプリケーションをビルドします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="2e92c-113">各イテレーションで、アプリケーションを段階的に改善します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="2e92c-114">この複数のイテレーションアプローチの目的は、各変更の理由を理解できるようにすることです。</span><span class="sxs-lookup"><span data-stu-id="2e92c-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="2e92c-115">イテレーション #1-アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="2e92c-116">最初のイテレーションでは、最も簡単な方法で Contact Manager を作成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="2e92c-117">基本的なデータベース操作 (作成、読み取り、更新、削除) のサポートを追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="2e92c-118">イテレーション #2-アプリケーションの外観を良くします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="2e92c-119">このイテレーションでは、既定の ASP.NET MVC ビューマスターページとカスケードスタイルシートを変更することによって、アプリケーションの外観を改善します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="2e92c-120">イテレーション #3-フォーム検証を追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="2e92c-121">3番目のイテレーションでは、基本的なフォーム検証を追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="2e92c-122">必要なフォームフィールドを完了しないで、フォームを送信できないようにします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="2e92c-123">また、電子メールアドレスと電話番号も検証します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="2e92c-124">イテレーション #4-アプリケーションの疎結合を実現します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="2e92c-125">この4回目のイテレーションでは、複数のソフトウェア設計パターンを利用して、連絡先マネージャーアプリケーションを簡単に管理および変更できるようにします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="2e92c-126">たとえば、リポジトリパターンと依存関係の注入パターンを使用するようにアプリケーションをリファクターします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="2e92c-127">イテレーション #5-単体テストを作成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="2e92c-128">5番目のイテレーションでは、単体テストを追加することによって、アプリケーションの保守と変更を容易にします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="2e92c-129">データモデルクラスをモック化し、コントローラーと検証ロジックの単体テストをビルドします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="2e92c-130">イテレーション #6-テスト駆動型開発を使用します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="2e92c-131">この6番目のイテレーションでは、最初に単体テストを記述し、単体テストに対してコードを記述することによって、アプリケーションに新しい機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="2e92c-132">このイテレーションでは、連絡先グループを追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="2e92c-133">イテレーション #7-Ajax 機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="2e92c-134">7番目のイテレーションでは、Ajax のサポートを追加することによって、アプリケーションの応答性とパフォーマンスを向上させます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="2e92c-135">このイテレーション</span><span class="sxs-lookup"><span data-stu-id="2e92c-135">This Iteration</span></span>

<span data-ttu-id="2e92c-136">Contact Manager アプリケーションの前のイテレーションでは、アプリケーションが疎結合されるようにリファクタリングしています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="2e92c-137">アプリケーションは、個別のコントローラー、サービス、およびリポジトリレイヤーに分離されています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="2e92c-138">各レイヤーは、インターフェイスを介してその下のレイヤーと対話します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="2e92c-139">アプリケーションを簡単に管理および変更できるように、アプリケーションをリファクタリングしました。</span><span class="sxs-lookup"><span data-stu-id="2e92c-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="2e92c-140">たとえば、新しいデータアクセステクノロジを使用する必要がある場合は、コントローラーやサービスレイヤーに触れることなくリポジトリレイヤーを変更するだけで済みます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="2e92c-141">連絡先マネージャーを疎結合することにより、変更のためにアプリケーションの回復性を高めることができました。</span><span class="sxs-lookup"><span data-stu-id="2e92c-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="2e92c-142">しかし、Contact Manager アプリケーションに新しい機能を追加する必要がある場合はどうなるでしょうか。</span><span class="sxs-lookup"><span data-stu-id="2e92c-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="2e92c-143">バグを修正するとどうなりますか。</span><span class="sxs-lookup"><span data-stu-id="2e92c-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="2e92c-144">悲しいですが、コードを記述すると、コードを操作するたびに新しいバグが発生するリスクが生じます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="2e92c-145">たとえば、上司から連絡担当者に新しい機能を追加するように要求される場合があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="2e92c-146">連絡先グループのサポートを追加したいと考えています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="2e92c-147">彼女は、友人やビジネスなどのグループに連絡先を整理することをユーザーに許可したいと考えています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="2e92c-148">この新機能を実装するには、Contact Manager アプリケーションの3つのレイヤーすべてを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="2e92c-149">コントローラー、サービス層、およびリポジトリに新しい機能を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="2e92c-150">コードの変更を開始するとすぐに、それまでに動作していた機能が中断する危険性があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="2e92c-151">前のイテレーションで行ったように、アプリケーションを別のレイヤーにリファクタリングすることは、良い方法でした。</span><span class="sxs-lookup"><span data-stu-id="2e92c-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="2e92c-152">アプリケーションの他の部分に触れることなく、レイヤー全体に変更を加えることができるため、これは良い方法でした。</span><span class="sxs-lookup"><span data-stu-id="2e92c-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="2e92c-153">ただし、レイヤー内のコードを保守および変更しやすいようにするには、コードの単体テストを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="2e92c-154">単体テストを使用して、個々のコード単位をテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="2e92c-155">これらのコード単位は、アプリケーションレイヤー全体よりも小さくなります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="2e92c-156">通常、単体テストを使用して、コード内の特定のメソッドが期待どおりに動作するかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="2e92c-157">たとえば、ContactManagerService クラスによって公開される CreateContact () メソッドの単体テストを作成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="2e92c-158">アプリケーションの単体テストは、安全性ネットワークと同様に動作します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="2e92c-159">アプリケーションのコードを変更するたびに、一連の単体テストを実行して、変更によって既存の機能が破損していないかどうかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="2e92c-160">単体テストを使用すると、コードの変更を安全に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="2e92c-161">単体テストを使用すると、アプリケーション内のすべてのコードの変更に対する回復力を高めることができます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="2e92c-162">このイテレーションでは、Contact Manager アプリケーションに単体テストを追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="2e92c-163">このようにして、次のイテレーションでは、既存の機能の中断を気にせずに、連絡先グループをアプリケーションに追加できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="2e92c-164">NUnit、xUnit.net、MbUnit などのさまざまな単体テストフレームワークがあります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="2e92c-165">このチュートリアルでは、Visual Studio に付属する単体テストフレームワークを使用します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="2e92c-166">ただし、これらの代替フレームワークの1つを簡単に使用できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-166">However, you could just as easily use one of these alternative frameworks.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="2e92c-167">テスト対象</span><span class="sxs-lookup"><span data-stu-id="2e92c-167">What Gets Tested</span></span>

<span data-ttu-id="2e92c-168">完全な世界では、すべてのコードが単体テストによってカバーされます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="2e92c-169">最適な世界では、完全な安全性が確保されています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="2e92c-170">アプリケーション内の任意のコード行を変更し、単体テストを実行することで、変更によって既存の機能が破損していないかどうかをすぐに知ることができます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="2e92c-171">しかし、完璧な世界では生きていません。</span><span class="sxs-lookup"><span data-stu-id="2e92c-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="2e92c-172">実際には、単体テストを記述するときに、ビジネスロジックのテスト (検証ロジックなど) を記述することに専念します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="2e92c-173">特に、データアクセスロジックまたはビューロジックの単体テストは記述し*ません*。</span><span class="sxs-lookup"><span data-stu-id="2e92c-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="2e92c-174">単体テストは非常に短時間で実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="2e92c-175">アプリケーションに対して、数百 (または数千単位) の単体テストを簡単に蓄積できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="2e92c-176">単体テストの実行に時間がかかる場合は、単体テストを実行しないようにします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="2e92c-177">つまり、実行時間の長い単体テストは、日常のコーディングのためには役に立ちません。</span><span class="sxs-lookup"><span data-stu-id="2e92c-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="2e92c-178">このため、通常は、データベースと対話するコードの単体テストを作成しません。</span><span class="sxs-lookup"><span data-stu-id="2e92c-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="2e92c-179">ライブデータベースに対して数百の単体テストを実行すると、時間がかかりすぎます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="2e92c-180">代わりに、データベースをモックし、モックデータベースと対話するコードを記述します (以下のデータベースのモックについて説明します)。</span><span class="sxs-lookup"><span data-stu-id="2e92c-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="2e92c-181">同様の理由から、通常はビューの単体テストを作成しません。</span><span class="sxs-lookup"><span data-stu-id="2e92c-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="2e92c-182">ビューをテストするには、web サーバーを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="2e92c-183">Web サーバーをスピンアップするプロセスは比較的低速であるため、ビューの単体テストを作成することはお勧めできません。</span><span class="sxs-lookup"><span data-stu-id="2e92c-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="2e92c-184">ビューに複雑なロジックが含まれている場合は、ヘルパーメソッドにロジックを移行することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="2e92c-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="2e92c-185">Web サーバーをスピンアップせずに実行するヘルパーメソッドの単体テストを作成できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="2e92c-186">単体テストを作成する場合、データアクセスロジックまたはビューロジックのテストを記述することはお勧めできませんが、これらのテストは、機能テストまたは統合テストをビルドするときに非常に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="2e92c-187">ASP.NET MVC は Web フォームビューエンジンです。</span><span class="sxs-lookup"><span data-stu-id="2e92c-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="2e92c-188">Web フォームビューエンジンは web サーバーに依存しますが、他のビューエンジンは使用できません。</span><span class="sxs-lookup"><span data-stu-id="2e92c-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>

## <a name="using-a-mock-object-framework"></a><span data-ttu-id="2e92c-189">モックオブジェクトフレームワークの使用</span><span class="sxs-lookup"><span data-stu-id="2e92c-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="2e92c-190">単体テストをビルドする場合は、ほとんどの場合、モックオブジェクトフレームワークを利用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="2e92c-191">モックオブジェクトフレームワークを使用すると、アプリケーション内のクラスのモックとスタブを作成できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="2e92c-192">たとえば、モックオブジェクトフレームワークを使用して、リポジトリクラスのモックバージョンを生成できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="2e92c-193">これにより、単体テストで実際のリポジトリクラスではなく、モックリポジトリクラスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="2e92c-194">モックリポジトリを使用すると、単体テストの実行時にデータベースコードが実行されないようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="2e92c-195">Visual Studio には、モックオブジェクトフレームワークは含まれていません。</span><span class="sxs-lookup"><span data-stu-id="2e92c-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="2e92c-196">ただし、.NET framework には、いくつかの市販およびオープンソースのモックオブジェクトフレームワークが用意されています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="2e92c-197">Moq-このフレームワークは、オープンソースの BSD ライセンスで利用できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="2e92c-198">Moq は[https://code.google.com/p/moq/](https://code.google.com/p/moq/)からダウンロードできます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="2e92c-199">Rhino モック-このフレームワークは、オープンソースの BSD ライセンスで利用できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="2e92c-200">[http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx)から Rhino モックをダウンロードできます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="2e92c-201">Typemock Isolator-これは商用フレームワークです。</span><span class="sxs-lookup"><span data-stu-id="2e92c-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="2e92c-202">[http://www.typemock.com/](http://www.typemock.com/)から試用版をダウンロードできます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="2e92c-203">このチュートリアルでは、Moq を使用することにしました。</span><span class="sxs-lookup"><span data-stu-id="2e92c-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="2e92c-204">ただし、Rhino モックまたは Typemock Isolator を使用して、Contact Manager アプリケーションのモックオブジェクトを簡単に作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="2e92c-205">Moq を使用するには、次の手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="2e92c-206">。</span><span class="sxs-lookup"><span data-stu-id="2e92c-206">.</span></span>
2. <span data-ttu-id="2e92c-207">ダウンロードを解凍する前に、ファイルを右クリックし、 **[ブロック解除]** ボタン (図1を参照) をクリックしてください。</span><span class="sxs-lookup"><span data-stu-id="2e92c-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="2e92c-208">ダウンロードを解凍します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-208">Unzip the download.</span></span>
4. <span data-ttu-id="2e92c-209">メニューオプションプロジェクトを選択し **、[参照の追加**] をクリックして [参照の**追加**] ダイアログを開くことにより、moq アセンブリへの参照をテストプロジェクトに追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-209">Add a reference to the Moq assembly to your Test project by selecting the menu option **Project, Add Reference** to open the **Add Reference** dialog.</span></span> <span data-ttu-id="2e92c-210">[参照] タブで、Moq を解凍したフォルダーを参照し、Moq .dll アセンブリを選択します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="2e92c-211">**[OK]** ボタンをクリックします (図2を参照)。</span><span class="sxs-lookup"><span data-stu-id="2e92c-211">Click the **OK** button (see Figure 2).</span></span>

<span data-ttu-id="2e92c-212">[ブロック解除 ![Moq](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="2e92c-212">[![Unblocking Moq](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span></span>

<span data-ttu-id="2e92c-213">**図 01**: moq のブロック解除 ([クリックすると、フルサイズの画像が表示](iteration-5-create-unit-tests-vb/_static/image2.png)される)</span><span class="sxs-lookup"><span data-stu-id="2e92c-213">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image2.png))</span></span>

<span data-ttu-id="2e92c-214">[Moq を追加した後の参照の ![](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="2e92c-214">[![References after adding Moq](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span></span>

<span data-ttu-id="2e92c-215">**図 02**: moq を追加した後の参照 ([クリックすると、フルサイズの画像が表示](iteration-5-create-unit-tests-vb/_static/image4.png)される)</span><span class="sxs-lookup"><span data-stu-id="2e92c-215">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image4.png))</span></span>

## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="2e92c-216">サービス層の単体テストの作成</span><span class="sxs-lookup"><span data-stu-id="2e92c-216">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="2e92c-217">まず、Contact Manager application s サービスレイヤーの一連の単体テストを作成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-217">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="2e92c-218">これらのテストを使用して、検証ロジックを検証します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-218">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="2e92c-219">ContactManager. テストプロジェクトに、モデルという名前の新しいフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-219">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="2e92c-220">次に、[モデル] フォルダーを右クリックし、[**追加]、[新しいテスト**] の順に選択します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-220">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="2e92c-221">図3に示されている **[新しいテストの追加]** ダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-221">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="2e92c-222">**単体テスト**テンプレートを選択し、新しいテストに名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-222">Select the **Unit Test** template and name your new test ContactManagerServiceTest.vb.</span></span> <span data-ttu-id="2e92c-223">**[OK]** ボタンをクリックして、テストプロジェクトに新しいテストを追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-223">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="2e92c-224">通常、テストプロジェクトのフォルダー構造は、ASP.NET MVC プロジェクトのフォルダー構造と一致させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-224">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="2e92c-225">たとえば、コントローラーのテストを Controllers フォルダーに配置し、モデルフォルダー内のテストをモデル化します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-225">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>

<span data-ttu-id="2e92c-226">[![Model\ contactmanagerservicetest? cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="2e92c-226">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span></span>

<span data-ttu-id="2e92c-227">**図 03**: Model\ Contactmanagerservicetest/Cs ([クリックすると、フルサイズの画像が表示](iteration-5-create-unit-tests-vb/_static/image6.png)される)</span><span class="sxs-lookup"><span data-stu-id="2e92c-227">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image6.png))</span></span>

<span data-ttu-id="2e92c-228">最初に、ContactManagerService クラスによって公開されている CreateContact () メソッドをテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-228">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="2e92c-229">次の5つのテストを作成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-229">We'll create the following five tests:</span></span>

- <span data-ttu-id="2e92c-230">CreateContact ()-有効な連絡先がメソッドに渡されたときに、CreateContact () が値 true を返すことをテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-230">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="2e92c-231">CreateContactRequiredFirstName ()-最初の名前が指定されていない連絡先が CreateContact () メソッドに渡されたときに、モデル状態にエラーメッセージが追加されることをテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-231">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="2e92c-232">CreateContactRequiredLastName ()-姓が指定されていない連絡先が CreateContact () メソッドに渡されたときに、モデル状態にエラーメッセージが追加されたことをテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-232">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="2e92c-233">CreateContactInvalidPhone ()-無効な電話番号を持つ連絡先が CreateContact () メソッドに渡されたときに、モデル状態にエラーメッセージが追加されたことをテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-233">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="2e92c-234">CreateContactInvalidEmail ()-無効な電子メールアドレスを持つ連絡先が CreateContact () メソッドに渡されたときに、モデル状態にエラーメッセージが追加されたことをテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-234">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="2e92c-235">最初のテストでは、有効な連絡先が検証エラーを生成しないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-235">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="2e92c-236">残りのテストでは、各検証規則がチェックされます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-236">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="2e92c-237">これらのテストのコードは、リスト1に含まれています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-237">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="2e92c-238">**リスト 1-Model\ contactmanagerservicetest, vb**</span><span class="sxs-lookup"><span data-stu-id="2e92c-238">**Listing 1 - Models\ContactManagerServiceTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample1.vb)]

<span data-ttu-id="2e92c-239">リスト1で Contact クラスを使用しているので、Microsoft Entity Framework への参照をテストプロジェクトに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-239">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="2e92c-240">System.string アセンブリへの参照を追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-240">Add a reference to the System.Data.Entity assembly.</span></span>

<span data-ttu-id="2e92c-241">リスト1には、[TestInitialize] 属性で修飾された Initialize () という名前のメソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-241">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="2e92c-242">このメソッドは、各単体テストの実行前に自動的に呼び出されます (各単体テストの直前に5回呼び出されます)。</span><span class="sxs-lookup"><span data-stu-id="2e92c-242">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="2e92c-243">Initialize () メソッドは、次のコード行を使用して、モックリポジトリを作成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-243">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample2.vb)]

<span data-ttu-id="2e92c-244">このコード行では、Moq フレームワークを使用して、IContactManagerRepository インターフェイスからモックリポジトリを生成します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-244">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="2e92c-245">各単体テストの実行時にデータベースにアクセスしないように、実際の EntityContactManagerRepository の代わりにモックリポジトリが使用されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-245">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="2e92c-246">モックリポジトリは IContactManagerRepository インターフェイスのメソッドを実装しますが、メソッドは実際には何も行いません。</span><span class="sxs-lookup"><span data-stu-id="2e92c-246">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="2e92c-247">Moq フレームワークを使用する場合、\_mockRepository と \_mockRepository は区別されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-247">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="2e92c-248">前者は、モックリポジトリの動作方法を指定するメソッドを含む、モック (Of IContactManagerRepository) クラスを参照します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-248">The former refers to the Mock(Of IContactManagerRepository) class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="2e92c-249">後者は、IContactManagerRepository インターフェイスを実装する実際のモックリポジトリを参照します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-249">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>

<span data-ttu-id="2e92c-250">モックリポジトリは、ContactManagerService クラスのインスタンスを作成するときに Initialize () メソッドで使用されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-250">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="2e92c-251">個々の単体テストでは、ContactManagerService クラスのこのインスタンスが使用されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-251">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="2e92c-252">リスト1には、各単体テストに対応する5つのメソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-252">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="2e92c-253">これらの各メソッドは、[を持つ] 属性で修飾されています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-253">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="2e92c-254">単体テストを実行すると、この属性を持つメソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-254">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="2e92c-255">言い換えると、[状態] 属性で修飾されたメソッドは単体テストです。</span><span class="sxs-lookup"><span data-stu-id="2e92c-255">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="2e92c-256">CreateContact () という名前の最初の単体テストでは、Contact クラスの有効なインスタンスがメソッドに渡されたときに、CreateContact () の呼び出しで値 true が返されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-256">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="2e92c-257">このテストでは、Contact クラスのインスタンスを作成し、CreateContact () メソッドを呼び出して、CreateContact () が値 true を返すことを確認します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-257">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="2e92c-258">残りのテストでは、CreateContact () メソッドが無効な連絡先で呼び出されたときに、メソッドが false を返し、予期された検証エラーメッセージがモデルの状態に追加されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-258">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="2e92c-259">たとえば、CreateContactRequiredFirstName () テストでは、FirstName プロパティの空の文字列を使用して Contact クラスのインスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-259">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="2e92c-260">次に、無効な連絡先で CreateContact () メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-260">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="2e92c-261">最後に、テストは CreateContact () が false を返すことを検証し、そのモデルの状態には "First name is required" というエラーメッセージが含まれていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-261">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="2e92c-262">リスト1の単体テストを実行するには、[**ソリューションのテスト]、[実行]、[すべてのテスト] (CTRL + R、A)** の順に選択します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-262">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="2e92c-263">テストの結果が [テスト結果] ウィンドウに表示されます (図4を参照)。</span><span class="sxs-lookup"><span data-stu-id="2e92c-263">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>

<span data-ttu-id="2e92c-264">[![テスト結果](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="2e92c-264">[![Test Results](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span></span>

<span data-ttu-id="2e92c-265">**図 04**: テスト結果 ([クリックしてフルサイズのイメージを表示する](iteration-5-create-unit-tests-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="2e92c-265">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image8.png))</span></span>

## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="2e92c-266">コントローラーの単体テストの作成</span><span class="sxs-lookup"><span data-stu-id="2e92c-266">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="2e92c-267">ASP.NET MVC アプリケーションは、ユーザー操作のフローを制御します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-267">ASP.NET MVC application control the flow of user interaction.</span></span> <span data-ttu-id="2e92c-268">コントローラーをテストするときに、コントローラーが適切なアクションの結果を返し、データを表示するかどうかをテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-268">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="2e92c-269">また、コントローラーが必要な方法でモデルクラスと対話するかどうかをテストすることもできます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-269">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="2e92c-270">たとえば、リスト2には Contact controller Create () メソッドの2つの単体テストが含まれています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-270">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="2e92c-271">最初の単体テストでは、有効な連絡先が Create () メソッドに渡されたときに、Create () メソッドによってインデックスアクションにリダイレクトされることを確認します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-271">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="2e92c-272">つまり、有効な連絡先が渡された場合、Create () メソッドは、インデックスアクションを表す RedirectToRouteResult を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-272">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="2e92c-273">コントローラーレイヤーをテストするときに、ContactManager サービスレイヤーをテストする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="2e92c-273">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="2e92c-274">そのため、Initialize メソッドで次のコードを使用してサービスレイヤーをモックします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-274">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample3.vb)]

<span data-ttu-id="2e92c-275">CreateValidContact () 単体テストでは、次のコード行を使用して、service layer CreateContact () メソッドを呼び出す動作をモック化します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-275">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample4.vb)]

<span data-ttu-id="2e92c-276">このコード行により、CreateContact () メソッドが呼び出されたときに、モック ContactManager サービスによって値 true が返されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-276">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="2e92c-277">サービスレイヤーをモックすることで、サービスレイヤーでコードを実行しなくても、コントローラーの動作をテストできます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-277">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="2e92c-278">2番目の単体テストでは、無効な連絡先がメソッドに渡されたときに create () アクションによって作成ビューが返されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-278">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="2e92c-279">次のコード行を使用して、service layer CreateContact () メソッドが値 false を返すようにします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-279">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample5.vb)]

<span data-ttu-id="2e92c-280">Create () メソッドが期待どおりに動作する場合は、サービスレイヤーが false の値を返すと、Create view が返されます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-280">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="2e92c-281">そうすることで、コントローラーは [作成] ビューに検証エラーメッセージを表示することができ、ユーザーは無効な連絡先プロパティを修正する機会を得られます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-281">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>

<span data-ttu-id="2e92c-282">コントローラーの単体テストをビルドする場合は、コントローラーアクションから明示的なビュー名を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="2e92c-282">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="2e92c-283">たとえば、次のようなビューを返さないでください。</span><span class="sxs-lookup"><span data-stu-id="2e92c-283">For example, do not return a view like this:</span></span>

<span data-ttu-id="2e92c-284">返されるビュー ()</span><span class="sxs-lookup"><span data-stu-id="2e92c-284">Return View()</span></span>

<span data-ttu-id="2e92c-285">代わりに、次のようなビューを返します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-285">Instead, return the view like this:</span></span>

<span data-ttu-id="2e92c-286">返されるビュー ("作成")</span><span class="sxs-lookup"><span data-stu-id="2e92c-286">Return View("Create")</span></span>

<span data-ttu-id="2e92c-287">ビューを返すときに明示的でない場合、ViewName プロパティは空の文字列を返します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-287">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>

<span data-ttu-id="2e92c-288">**リスト 2-コントローラーの一覧表示**</span><span class="sxs-lookup"><span data-stu-id="2e92c-288">**Listing 2 - Controllers\ContactControllerTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample6.vb)]

## <a name="summary"></a><span data-ttu-id="2e92c-289">まとめ</span><span class="sxs-lookup"><span data-stu-id="2e92c-289">Summary</span></span>

<span data-ttu-id="2e92c-290">このイテレーションでは、Contact Manager アプリケーションの単体テストを作成しました。</span><span class="sxs-lookup"><span data-stu-id="2e92c-290">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="2e92c-291">これらの単体テストをいつでも実行して、アプリケーションが期待どおりに動作することを確認できます。</span><span class="sxs-lookup"><span data-stu-id="2e92c-291">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="2e92c-292">単体テストは、アプリケーションの安全性を確保するためのものとして機能し、今後、アプリケーションを安全に変更できるようにします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-292">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="2e92c-293">2つの単体テストのセットを作成しました。</span><span class="sxs-lookup"><span data-stu-id="2e92c-293">We created two sets of unit tests.</span></span> <span data-ttu-id="2e92c-294">まず、サービスレイヤーの単体テストを作成して、検証ロジックをテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-294">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="2e92c-295">次に、コントローラーレイヤーの単体テストを作成して、フロー制御ロジックをテストします。</span><span class="sxs-lookup"><span data-stu-id="2e92c-295">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="2e92c-296">サービスレイヤーをテストするときに、リポジトリレイヤーをモック化することで、microsoft のサービスレイヤーのテストをリポジトリレイヤーから分離しています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-296">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="2e92c-297">コントローラーレイヤーをテストするときに、サービスレイヤーをモックすることによって、コントローラーレイヤーのテストを分離しています。</span><span class="sxs-lookup"><span data-stu-id="2e92c-297">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="2e92c-298">次のイテレーションでは、連絡先グループをサポートするように Contact Manager アプリケーションを変更します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-298">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="2e92c-299">この新しい機能は、テスト駆動型開発と呼ばれるソフトウェア設計プロセスを使用して、アプリケーションに追加します。</span><span class="sxs-lookup"><span data-stu-id="2e92c-299">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="2e92c-300">[前へ](iteration-4-make-the-application-loosely-coupled-vb.md)
> [次へ](iteration-6-use-test-driven-development-vb.md)</span><span class="sxs-lookup"><span data-stu-id="2e92c-300">[Previous](iteration-4-make-the-application-loosely-coupled-vb.md)
[Next](iteration-6-use-test-driven-development-vb.md)</span></span>
