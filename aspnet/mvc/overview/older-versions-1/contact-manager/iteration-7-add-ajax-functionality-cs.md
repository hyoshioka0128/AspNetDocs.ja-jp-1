---
uid: mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
title: 'イテレーション #7 – Ajax 機能の追加 (C#) |マイクロソフトドキュメント'
author: rick-anderson
description: 7 回目のイテレーションでは、Ajax のサポートを追加することで、アプリケーションの応答性とパフォーマンスを向上させます。
ms.author: riande
ms.date: 02/20/2009
ms.assetid: f1b0809e-8909-444e-b6bb-a5cd1dea3f72
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
msc.type: authoredcontent
ms.openlocfilehash: 12d7348382bc55af049567922bd6963970a9421b
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542314"
---
# <a name="iteration-7--add-ajax-functionality-c"></a><span data-ttu-id="5e9f3-103">繰り返し #7 – Ajax 機能を追加する (C#)</span><span class="sxs-lookup"><span data-stu-id="5e9f3-103">Iteration #7 – Add Ajax functionality (C#)</span></span>

<span data-ttu-id="5e9f3-104">[マイクロソフト](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="5e9f3-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="5e9f3-105">コードをダウンロード</span><span class="sxs-lookup"><span data-stu-id="5e9f3-105">Download Code</span></span>](iteration-7-add-ajax-functionality-cs/_static/contactmanager_7_cs1.zip)

> <span data-ttu-id="5e9f3-106">7 回目のイテレーションでは、Ajax のサポートを追加することで、アプリケーションの応答性とパフォーマンスを向上させます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-106">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="5e9f3-107">MVC アプリケーション (C#) ASP.NET連絡先管理の構築</span><span class="sxs-lookup"><span data-stu-id="5e9f3-107">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="5e9f3-108">この一連のチュートリアルでは、最初から最後まで連絡先管理アプリケーション全体を構築します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-108">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="5e9f3-109">連絡先マネージャー アプリケーションでは、連絡先の情報 (名前、電話番号、電子メール アドレス) を保存できます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-109">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="5e9f3-110">複数のイテレーションでアプリケーションをビルドします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-110">We build the application over multiple iterations.</span></span> <span data-ttu-id="5e9f3-111">各反復処理で、アプリケーションを徐々に改善します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-111">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="5e9f3-112">この複数の反復アプローチの目的は、各変更の理由を理解できるようにすることです。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-112">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="5e9f3-113">イテレーション #1 - アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-113">Iteration #1 - Create the application.</span></span> <span data-ttu-id="5e9f3-114">最初のイテレーションでは、できるだけ簡単な方法で連絡先マネージャーを作成します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-114">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="5e9f3-115">基本的なデータベース操作のサポートを追加: 作成、読み取り、更新、および削除 (CRUD) 。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-115">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="5e9f3-116">イテレーション #2 - アプリケーションを見栄えよくします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-116">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="5e9f3-117">このイテレーションでは、既定の ASP.NET MVC ビュー マスター ページとカスケード スタイル シートを変更することで、アプリケーションの外観を向上させます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-117">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="5e9f3-118">イテレーション #3 - フォームの検証を追加します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-118">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="5e9f3-119">3 回目のイテレーションでは、基本的なフォーム検証を追加します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-119">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="5e9f3-120">必須のフォームフィールドに入力せずにフォームを送信できないようにします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-120">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="5e9f3-121">また、メールアドレスと電話番号も検証します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-121">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="5e9f3-122">イテレーション #4 - アプリケーションを疎結合にします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-122">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="5e9f3-123">この 4 回目のイテレーションでは、いくつかのソフトウェア設計パターンを利用して、Contact Manager アプリケーションの保守と変更を容易にします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-123">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="5e9f3-124">たとえば、リポジトリ パターンと依存関係の挿入パターンを使用するようにアプリケーションをリファクタリングします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-124">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="5e9f3-125">イテレーション #5 - 単体テストを作成します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-125">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="5e9f3-126">5 回目のイテレーションでは、単体テストを追加することで、アプリケーションの保守と変更を容易にします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-126">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="5e9f3-127">データ モデル クラスをモックし、コントローラーと検証ロジックの単体テストをビルドします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-127">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="5e9f3-128">イテレーション #6 - テスト駆動型開発を使用します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-128">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="5e9f3-129">この 6 回目のイテレーションでは、単体テストを最初に記述し、単体テストに対してコードを記述することで、アプリケーションに新しい機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-129">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="5e9f3-130">このイテレーションでは、連絡先グループを追加します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-130">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="5e9f3-131">イテレーション #7 - Ajax 機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-131">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="5e9f3-132">7 回目のイテレーションでは、Ajax のサポートを追加することで、アプリケーションの応答性とパフォーマンスを向上させます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-132">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="5e9f3-133">このイテレーション</span><span class="sxs-lookup"><span data-stu-id="5e9f3-133">This Iteration</span></span>

<span data-ttu-id="5e9f3-134">連絡先マネージャー アプリケーションのこのイテレーションでは、Ajax を使用するためにアプリケーションをリファクタリングします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-134">In this iteration of the Contact Manager application, we refactor our application to make use of Ajax.</span></span> <span data-ttu-id="5e9f3-135">Ajaxを利用することで、アプリケーションの応答性を高めます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-135">By taking advantage of Ajax, we make our application more responsive.</span></span> <span data-ttu-id="5e9f3-136">ページ内の特定の領域だけを更新する必要がある場合は、ページ全体のレンダリングを回避できます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-136">We can avoid rendering an entire page when we need to update only a certain region in a page.</span></span>

<span data-ttu-id="5e9f3-137">インデックス ビューをリファクタリングして、新しい連絡先グループを選択したときにページ全体を再表示する必要がないようにします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-137">We'll refactor our Index view so that we don t need to redisplay the entire page whenever someone selects a new contact group.</span></span> <span data-ttu-id="5e9f3-138">代わりに、連絡先グループをクリックすると、連絡先の一覧が更新され、ページの残りの部分はそのままにしておきます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-138">Instead, when someone clicks a contact group, we'll just update the list of contacts and leave the rest of the page alone.</span></span>

<span data-ttu-id="5e9f3-139">また、削除リンクの動作方法も変更します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-139">We'll also change the way our delete link works.</span></span> <span data-ttu-id="5e9f3-140">別の確認ページを表示する代わりに、JavaScript の確認ダイアログが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-140">Instead of displaying a separate confirmation page, we'll display a JavaScript confirmation dialog.</span></span> <span data-ttu-id="5e9f3-141">連絡先を削除することを確認した場合は、サーバーに対して HTTP DELETE 操作を実行して、データベースから連絡先レコードを削除します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-141">If you confirm that you want to delete a contact, an HTTP DELETE operation is performed against the server to delete the contact record from the database.</span></span>

<span data-ttu-id="5e9f3-142">さらに、jQuery を利用して、インデックスビューにアニメーション効果を追加します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-142">Furthermore, we will take advantage of jQuery to add animation effects to our Index view.</span></span> <span data-ttu-id="5e9f3-143">新しい連絡先リストがサーバーから取得されるときにアニメーションを表示します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-143">We'll display an animation when the new list of contacts is being fetched from the server.</span></span>

<span data-ttu-id="5e9f3-144">最後に、ブラウザ履歴を管理するためのAJAXフレームワークのサポートASP.NETを活用します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-144">Finally, we'll take advantage of the ASP.NET AJAX framework support for managing browser history.</span></span> <span data-ttu-id="5e9f3-145">連絡先リストを更新する Ajax 呼び出しを実行するたびに、履歴ポイントを作成します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-145">We'll create history points whenever we perform an Ajax call to update the contact list.</span></span> <span data-ttu-id="5e9f3-146">これにより、ブラウザの後方および前方のボタンが機能します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-146">That way, the browser backward and forward buttons will work.</span></span>

## <a name="why-use-ajax"></a><span data-ttu-id="5e9f3-147">なぜアヤックスを使うのですか?</span><span class="sxs-lookup"><span data-stu-id="5e9f3-147">Why use Ajax?</span></span>

<span data-ttu-id="5e9f3-148">Ajax を使用すると、多くの利点があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-148">Using Ajax has many benefits.</span></span> <span data-ttu-id="5e9f3-149">まず、アプリケーションに Ajax 機能を追加すると、ユーザー エクスペリエンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-149">First, adding Ajax functionality to an application results in a better user experience.</span></span> <span data-ttu-id="5e9f3-150">通常の Web アプリケーションでは、ユーザーが操作を実行するたびに、ページ全体をサーバーにポストバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-150">In a normal web application, the entire page must be posted back to the server each and every time a user performs an action.</span></span> <span data-ttu-id="5e9f3-151">アクションを実行するたびに、ブラウザはロックされ、ユーザーはページ全体がフェッチされて再表示されるまで待たなければなりません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-151">Whenever you perform an action, the browser locks and the user must wait until the entire page is fetched and redisplayed.</span></span>

<span data-ttu-id="5e9f3-152">これは、デスクトップ アプリケーションの場合は、許容できないエクスペリエンスになります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-152">This would be an unacceptable experience in the case of a desktop application.</span></span> <span data-ttu-id="5e9f3-153">しかし、従来は、Webアプリケーションの場合、これ以上うまくやれるということは分からなかったので、この悪いユーザーエクスペリエンスを持っていました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-153">But, traditionally, we lived with this bad user experience in the case of a web application because we did not know that we could do any better.</span></span> <span data-ttu-id="5e9f3-154">実際には、それは私たちの想像力の限界に過ぎないとき、それはWebアプリケーションの限界だと思っていました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-154">We thought it was a limitation of web applications when, in actuality, it was just a limitation of our imaginations.</span></span>

<span data-ttu-id="5e9f3-155">Ajax アプリケーションでは、ページを更新するためだけにユーザー エクスペリエンスを停止させる必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-155">In an Ajax application, you don t need to bring the user experience to a halt just to update a page.</span></span> <span data-ttu-id="5e9f3-156">代わりに、バックグラウンドで非同期要求を実行してページを更新できます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-156">Instead, you can perform an asynchronous request in the background to update the page.</span></span> <span data-ttu-id="5e9f3-157">ページの一部が更新されるまで、ユーザーに待機を強制しません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-157">You don t force the user to wait while part of the page gets updated.</span></span>

<span data-ttu-id="5e9f3-158">Ajax を利用することで、アプリケーションのパフォーマンスを向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-158">By taking advantage of Ajax, you also can improve the performance of your application.</span></span> <span data-ttu-id="5e9f3-159">Ajax 機能を使用せずに、コンタクトマネージャーアプリケーションの動作を今すぐ検討してください。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-159">Consider how the Contact Manager application works right now without Ajax functionality.</span></span> <span data-ttu-id="5e9f3-160">連絡先グループをクリックすると、インデックス ビュー全体が再表示される必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-160">When you click a contact group, the entire Index view must be redisplayed.</span></span> <span data-ttu-id="5e9f3-161">連絡先の一覧と連絡先グループの一覧は、データベース サーバーから取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-161">The list of contacts and list of contact groups must be retrieved from the database server.</span></span> <span data-ttu-id="5e9f3-162">このデータはすべて、Web サーバーから Web ブラウザーにネットワーク経由で渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-162">All of this data must be passed across the wire from web server to web browser.</span></span>

<span data-ttu-id="5e9f3-163">ただし、アプリケーションに Ajax 機能を追加した後、ユーザーが連絡先グループをクリックしたときにページ全体を再表示することを回避できます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-163">After we add Ajax functionality to our application, however, we can avoid redisplaying the entire page when a user clicks a contact group.</span></span> <span data-ttu-id="5e9f3-164">データベースから連絡先グループを取得する必要がなくなりました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-164">We no longer need to grab the contact groups from the database.</span></span> <span data-ttu-id="5e9f3-165">また、インデックスビュー全体をネットワーク全体にプッシュする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-165">We also don t need to push the entire Index view across the wire.</span></span> <span data-ttu-id="5e9f3-166">Ajaxを利用することで、データベースサーバが実行しなければならない作業量を削減し、アプリケーションに必要なネットワークトラフィックの量を削減します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-166">By taking advantage of Ajax, we reduce the amount of work that our database server must perform and we reduce the amount of network traffic required by our application.</span></span>

## <a name="don-t-be-afraid-of-ajax"></a><span data-ttu-id="5e9f3-167">アヤックスを恐れてはいけない</span><span class="sxs-lookup"><span data-stu-id="5e9f3-167">Don t be Afraid of Ajax</span></span>

<span data-ttu-id="5e9f3-168">開発者の中には、下位レベルのブラウザを心配するため、Ajax を使用しない開発者もいます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-168">Some developers avoid using Ajax because they worry about downlevel browsers.</span></span> <span data-ttu-id="5e9f3-169">JavaScript をサポートしていないブラウザからアクセスしても、Web アプリケーションが動作することを確認したいと考えています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-169">They want to make sure that their web applications will still work when accessed by a browser that does not support JavaScript.</span></span> <span data-ttu-id="5e9f3-170">Ajax は JavaScript に依存しているため、一部の開発者は Ajax の使用を避けます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-170">Because Ajax depends on JavaScript, some developers avoid using Ajax.</span></span>

<span data-ttu-id="5e9f3-171">ただし、Ajax の実装方法に注意を払えば、上位レベルと下位レベルの両方のブラウザで動作するアプリケーションを構築できます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-171">However, if you are careful about how you implement Ajax then you can build applications that work with both uplevel and downlevel browsers.</span></span> <span data-ttu-id="5e9f3-172">当社のコンタクトマネージャアプリケーションは、JavaScriptをサポートするブラウザとサポートしていないブラウザで動作します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-172">Our Contact Manager application will work with browsers that support JavaScript and browsers that do not.</span></span>

<span data-ttu-id="5e9f3-173">JavaScript をサポートするブラウザーで連絡先マネージャー アプリケーションを使用すると、より良いユーザー エクスペリエンスが得られます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-173">If you use the Contact Manager application with a browser that supports JavaScript then you will have a better user experience.</span></span> <span data-ttu-id="5e9f3-174">たとえば、連絡先グループをクリックすると、連絡先を表示するページの領域のみが更新されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-174">For example, when you click a contact group, only the region of the page that displays contacts will be updated.</span></span>

<span data-ttu-id="5e9f3-175">一方、JavaScript をサポートしていない (または JavaScript が無効になっている) ブラウザーで連絡先マネージャー アプリケーションを使用する場合は、ユーザー エクスペリエンスが少し望ましくないことがあります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-175">If, on the other hand, you use the Contact Manager application with a browser that does not support JavaScript (or that has JavaScript disabled) then you will have a slightly less desirable user experience.</span></span> <span data-ttu-id="5e9f3-176">たとえば、連絡先グループをクリックすると、連絡先の一致する一覧を表示するために、インデックス ビュー全体をブラウザにポストバックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-176">For example, when you click a contact group, the entire Index view must be posted back to the browser in order to display the matching list of contacts.</span></span>

## <a name="adding-the-required-javascript-files"></a><span data-ttu-id="5e9f3-177">必要な JavaScript ファイルの追加</span><span class="sxs-lookup"><span data-stu-id="5e9f3-177">Adding the Required JavaScript Files</span></span>

<span data-ttu-id="5e9f3-178">アプリケーションに Ajax 機能を追加するには、3 つの JavaScript ファイルを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-178">We'll need to use three JavaScript files to add Ajax functionality to our application.</span></span> <span data-ttu-id="5e9f3-179">これらの 3 つのファイルはすべて、新しい ASP.NET MVC アプリケーションの Scripts フォルダーに含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-179">All three of these files are included in the Scripts folder of a new ASP.NET MVC application.</span></span>

<span data-ttu-id="5e9f3-180">アプリケーションの複数のページで Ajax を使用する場合は、アプリケーションのビューマスターページに必要な JavaScript ファイルを含めるのが理にかなっています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-180">If you plan to use Ajax in multiple pages in your application then it makes sense to include the required JavaScript files in your application s view master page.</span></span> <span data-ttu-id="5e9f3-181">これにより、JavaScript ファイルはアプリケーションのすべてのページに自動的に含まれます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-181">That way, the JavaScript files will be included in all of the pages in your application automatically.</span></span>

<span data-ttu-id="5e9f3-182">ビューマスターページのヘッド&lt;&gt;タグ内に、次の JavaScript インクルードを追加します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-182">Add the following JavaScript includes inside the &lt;head&gt; tag of your view master page:</span></span>

[!code-html[Main](iteration-7-add-ajax-functionality-cs/samples/sample1.html)]

## <a name="refactoring-the-index-view-to-use-ajax"></a><span data-ttu-id="5e9f3-183">Ajax を使用するためのインデックス ビューのリファクタリング</span><span class="sxs-lookup"><span data-stu-id="5e9f3-183">Refactoring the Index View to use Ajax</span></span>

<span data-ttu-id="5e9f3-184">まず、連絡先グループをクリックすると、連絡先を表示するビューの領域だけが更新されるように、インデックス ビューを変更します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-184">Let s start by modifying our Index view so that clicking a contact group only updates the region of the view that displays contacts.</span></span> <span data-ttu-id="5e9f3-185">図 1 の赤いボックスには、更新する領域が表示されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-185">The red box in Figure 1 contains the region that we want to update.</span></span>

<span data-ttu-id="5e9f3-186">[![連絡先のみを更新する](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5e9f3-186">[![Updating only contacts](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span></span>

<span data-ttu-id="5e9f3-187">**図 01**: 連絡先のみを更新する ([フルサイズの画像を表示する をクリック](iteration-7-add-ajax-functionality-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="5e9f3-187">**Figure 01**: Updating only contacts([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image2.png))</span></span>

<span data-ttu-id="5e9f3-188">最初の手順では、非同期的に更新するビューの部分を別の部分 (ビュー ユーザー コントロール) に分割します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-188">The first step is to separate the part of the view that we want to update asynchronously into a separate partial (view user control).</span></span> <span data-ttu-id="5e9f3-189">連絡先のテーブルを表示するインデックス ビューのセクションは、リスト 1 の部分に移動されました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-189">The section of the Index view that displays the table of contacts has been moved into the partial in Listing 1.</span></span>

<span data-ttu-id="5e9f3-190">**リスト 1 - ビュー\連絡先\連絡先リスト.ascx**</span><span class="sxs-lookup"><span data-stu-id="5e9f3-190">**Listing 1 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample2.aspx)]

<span data-ttu-id="5e9f3-191">リスト 1 の部分は、インデックス ビューとは異なるモデルを持っていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-191">Notice that the partial in Listing 1 has a different model than the Index view.</span></span> <span data-ttu-id="5e9f3-192">%@ ページ %&lt;&gt;ディレクティブの&lt;*継承*属性は、部分が ViewUserControl グループ&gt;クラスから継承することを指定します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-192">The *Inherits* attribute in the &lt;%@ Page %&gt; directive specifies that the partial inherits from the ViewUserControl&lt;Group&gt; class.</span></span>

<span data-ttu-id="5e9f3-193">更新されたインデックス ビューは、リスト 2 に含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-193">The updated Index view is contained in Listing 2.</span></span>

<span data-ttu-id="5e9f3-194">**リスト 2 - ビュー\連絡先\インデックス.aspx**</span><span class="sxs-lookup"><span data-stu-id="5e9f3-194">**Listing 2 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample3.aspx)]

<span data-ttu-id="5e9f3-195">リスト 2 の更新されたビューについて、2 つの点に注意する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-195">There are two things that you should notice about the updated view in Listing 2.</span></span> <span data-ttu-id="5e9f3-196">まず、部分に移動されたすべてのコンテンツが Html.RenderPartial() への呼び出しに置き換えられることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-196">First, notice that all of the content moved into the partial is replaced with a call to Html.RenderPartial().</span></span> <span data-ttu-id="5e9f3-197">Html.RenderPartial() メソッドは、最初の連絡先セットを表示するためにインデックス ビューが最初に要求されたときに呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-197">The Html.RenderPartial() method is called when the Index view is first requested in order to display the initial set of contacts.</span></span>

<span data-ttu-id="5e9f3-198">次に、連絡先グループの表示に使用される Html.ActionLink() が Ajax.ActionLink() に置き換えられていることに注目してください。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-198">Second, notice that the Html.ActionLink() used to display contact groups has been replaced with an Ajax.ActionLink().</span></span> <span data-ttu-id="5e9f3-199">Ajax.ActionLink() は、次のパラメーターを使用して呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-199">The Ajax.ActionLink() is called with the following parameters:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample4.aspx)]

<span data-ttu-id="5e9f3-200">最初のパラメータはリンクに表示するテキストを表し、2 番目のパラメータはルート値を表し、3 番目のパラメータは Ajax オプションを表します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-200">The first parameter represents the text to display for the link, the second parameter represents the route values, and the third parameter represents the Ajax options.</span></span> <span data-ttu-id="5e9f3-201">この場合、UpdateTargetId Ajax オプションを使用して、Ajax&lt;要求&gt;が完了した後に更新する HTML div タグを指します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-201">In this case, we use the UpdateTargetId Ajax option to point to the HTML &lt;div&gt; tag that we want to update after the Ajax request completes.</span></span> <span data-ttu-id="5e9f3-202">div&lt;&gt;タグを新しい連絡先リストで更新します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-202">We want to update the &lt;div&gt; tag with the new list of contacts.</span></span>

<span data-ttu-id="5e9f3-203">連絡先コントローラの更新された Index() メソッドは、リスト 3 に含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-203">The updated Index() method of the Contact controller is contained in Listing 3.</span></span>

<span data-ttu-id="5e9f3-204">**リスト 3 - コントローラー\連絡先コントローラー.cs (インデックスメソッド)**</span><span class="sxs-lookup"><span data-stu-id="5e9f3-204">**Listing 3 - Controllers\ContactController.cs (Index method)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample5.cs)]

<span data-ttu-id="5e9f3-205">更新された Index() アクションは、条件に応じて 2 つのうちいずれかを返します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-205">The updated Index() action conditionally returns one of two things.</span></span> <span data-ttu-id="5e9f3-206">Index() アクションが Ajax 要求によって呼び出された場合、コントローラーは部分を戻します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-206">If the Index() action is invoked by an Ajax request then the controller returns a partial.</span></span> <span data-ttu-id="5e9f3-207">それ以外の場合、Index() アクションはビュー全体を返します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-207">Otherwise, the Index() action returns an entire view.</span></span>

<span data-ttu-id="5e9f3-208">Index() アクションは、Ajax リクエストによって呼び出されたときに、それほど多くのデータを返す必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-208">Notice that the Index() action does not need to return as much data when invoked by an Ajax request.</span></span> <span data-ttu-id="5e9f3-209">通常の要求のコンテキストでは、インデックス アクションは、すべての連絡先グループと選択した連絡先グループの一覧を返します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-209">In the context of a normal request, the Index action returns a list of all of the contact groups and the selected contact group.</span></span> <span data-ttu-id="5e9f3-210">Ajax リクエストのコンテキストでは、Index() アクションは選択したグループのみを返します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-210">In the context of an Ajax request, the Index() action returns only the selected group.</span></span> <span data-ttu-id="5e9f3-211">Ajax は、データベース・サーバでの作業が少ないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-211">Ajax means less work on your database server.</span></span>

<span data-ttu-id="5e9f3-212">変更されたインデックスビューは、上位レベルと下位レベルの両方のブラウザの場合に機能します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-212">Our modified Index view works in the case of both uplevel and downlevel browsers.</span></span> <span data-ttu-id="5e9f3-213">連絡先グループをクリックし、ブラウザが JavaScript をサポートしている場合は、連絡先のリストを含むビューの領域のみが更新されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-213">If you click a contact group, and your browser supports JavaScript, then only the region of the view that contains the list of contacts is updated.</span></span> <span data-ttu-id="5e9f3-214">一方、ブラウザが JavaScript をサポートしていない場合は、ビュー全体が更新されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-214">If, on the other hand, your browser does not support JavaScript, then the entire view is updated.</span></span>

<span data-ttu-id="5e9f3-215">更新されたインデックスビューには 1 つの問題があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-215">Our updated Index view has one problem.</span></span> <span data-ttu-id="5e9f3-216">連絡先グループをクリックしても、選択したグループは強調表示されません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-216">When you click a contact group, the selected group is not highlighted.</span></span> <span data-ttu-id="5e9f3-217">グループのリストは、Ajax 要求中に更新される領域の外部に表示されるため、右側のグループは強調表示されません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-217">Because the list of groups is displayed outside of the region that is updated during an Ajax request, the right group does not get highlighted.</span></span> <span data-ttu-id="5e9f3-218">この問題は次のセクションで修正します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-218">We'll fix this issue in the next section.</span></span>

## <a name="adding-jquery-animation-effects"></a><span data-ttu-id="5e9f3-219">jQuery アニメーション効果の追加</span><span class="sxs-lookup"><span data-stu-id="5e9f3-219">Adding jQuery Animation Effects</span></span>

<span data-ttu-id="5e9f3-220">通常、Web ページ内のリンクをクリックすると、ブラウザの進行状況バーを使用して、更新されたコンテンツがブラウザによってアクティブに取得されているかどうかを検出できます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-220">Normally, when you click a link in a web page, you can use the browser progress bar to detect whether or not the browser is actively fetching the updated content.</span></span> <span data-ttu-id="5e9f3-221">一方、Ajax リクエストを実行すると、ブラウザの進行状況バーに進行状況が表示されません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-221">When performing an Ajax request, on the other hand, the browser progress bar does not show any progress.</span></span> <span data-ttu-id="5e9f3-222">これは、ユーザーを緊張させることができます.</span><span class="sxs-lookup"><span data-stu-id="5e9f3-222">This can make users nervous.</span></span> <span data-ttu-id="5e9f3-223">ブラウザがフリーズしたかどうかを確認するにはどうすればよいですか?</span><span class="sxs-lookup"><span data-stu-id="5e9f3-223">How do you know whether the browser has frozen?</span></span>

<span data-ttu-id="5e9f3-224">Ajax 要求の実行中に作業が実行されていることをユーザーに示す方法はいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-224">There are several ways that you can indicate to a user that work is being performed while performing an Ajax request.</span></span> <span data-ttu-id="5e9f3-225">1 つの方法は、単純なアニメーションを表示することです。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-225">One approach is to display a simple animation.</span></span> <span data-ttu-id="5e9f3-226">たとえば、Ajax リクエストが開始され、リクエストが完了したときに領域内でフェードアウトすると、リージョンをフェードアウトできます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-226">For example, you can fade out a region when an Ajax request begins and fade in the region when the request completes.</span></span>

<span data-ttu-id="5e9f3-227">アニメーション効果を作成するには、マイクロソフト ASP.NET MVC フレームワークに含まれている jQuery ライブラリを使用します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-227">We'll use the jQuery library which is included with the Microsoft ASP.NET MVC framework, to create the animation effects.</span></span> <span data-ttu-id="5e9f3-228">更新されたインデックス ビューは、リスト 4 に含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-228">The updated Index view is contained in Listing 4.</span></span>

<span data-ttu-id="5e9f3-229">**リスト 4 - ビュー\連絡先\インデックス.aspx**</span><span class="sxs-lookup"><span data-stu-id="5e9f3-229">**Listing 4 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample6.aspx)]

<span data-ttu-id="5e9f3-230">更新されたインデックス ビューには、3 つの新しい JavaScript 関数が含まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-230">Notice that the updated Index view contains three new JavaScript functions.</span></span> <span data-ttu-id="5e9f3-231">最初の 2 つの関数は、jQuery を使用して、新しい連絡先グループをクリックしたときに、連絡先のリストをフェードアウトしてフェードインします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-231">The first two functions use jQuery to fade out and fade in the list of contacts when you click a new contact group.</span></span> <span data-ttu-id="5e9f3-232">3 番目の関数は、Ajax 要求がエラー (ネットワークタイムアウトなど) を発生した場合にエラー・メッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-232">The third function displays an error message when an Ajax request results in an error (for example, network timeout).</span></span>

<span data-ttu-id="5e9f3-233">最初の関数は、選択したグループをハイライト表示します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-233">The first function also takes care of highlighting the selected group.</span></span> <span data-ttu-id="5e9f3-234">class= 選択した属性が、クリックされた要素の親要素 (LI 要素) に追加されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-234">A class= selected attribute is added to the parent element (the LI element) of the element clicked.</span></span> <span data-ttu-id="5e9f3-235">ここでも、jQuery は、適切な要素を選択して CSS クラスを追加することが容易になります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-235">Again, jQuery makes it easy to select the right element and add the CSS class.</span></span>

<span data-ttu-id="5e9f3-236">これらのスクリプトは、Ajax.ActionLink() AjaxOptions パラメーターの助けを借りてグループ・リンクに関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-236">These scripts are tied to the group links with the help of the Ajax.ActionLink() AjaxOptions parameter.</span></span> <span data-ttu-id="5e9f3-237">更新された Ajax.ActionLink() メソッド呼び出しは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-237">The updated Ajax.ActionLink() method call looks like this:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample7.aspx)]

## <a name="adding-browser-history-support"></a><span data-ttu-id="5e9f3-238">ブラウザ履歴のサポートの追加</span><span class="sxs-lookup"><span data-stu-id="5e9f3-238">Adding Browser History Support</span></span>

<span data-ttu-id="5e9f3-239">通常、ページを更新するリンクをクリックすると、ブラウザーの履歴が更新されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-239">Normally, when you click a link to update a page, your browser history is updated.</span></span> <span data-ttu-id="5e9f3-240">この方法で、ブラウザの [戻る] ボタンをクリックして、ページの前の状態に戻すことができます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-240">That way, you can click the browser Back button to move back in time to the previous state of the page.</span></span> <span data-ttu-id="5e9f3-241">たとえば、Friends 連絡先グループをクリックしてビジネス用連絡先グループをクリックした場合、ブラウザの [戻る] ボタンをクリックして、Friends 連絡先グループが選択されているページの状態に戻ることができます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-241">For example, if you click the Friends contact group and then click the Business contact group, you can click the browser Back button to navigate back to the state of the page when the Friends contact group was selected.</span></span>

<span data-ttu-id="5e9f3-242">残念ながら、Ajax リクエストを実行してもブラウザの履歴は自動的に更新されません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-242">Unfortunately, performing an Ajax request does not update browser history automatically.</span></span> <span data-ttu-id="5e9f3-243">連絡先グループをクリックし、一致する連絡先のリストが Ajax リクエストで取得された場合、ブラウザーの履歴は更新されません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-243">If you click a contact group, and the list of matching contacts is retrieved with an Ajax request, then the browser history is not updated.</span></span> <span data-ttu-id="5e9f3-244">新しい連絡先グループを選択した後、ブラウザの [戻る] ボタンを使用して連絡先グループに戻ることはできません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-244">You cannot use the browser Back button to navigate back to a contact group after selecting a new contact group.</span></span>

<span data-ttu-id="5e9f3-245">Ajax リクエストを実行した後にブラウザの [戻る] ボタンを使用できるようにする場合は、もう少し作業を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-245">If you want users to be able to use the browser Back button after performing Ajax requests then you need to perform a little more work.</span></span> <span data-ttu-id="5e9f3-246">ASP.NET AJAX フレームワークに組み込まれているブラウザー履歴管理機能を利用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-246">You need to take advantage of the browser history management functionality built in the ASP.NET AJAX Framework.</span></span>

<span data-ttu-id="5e9f3-247">AJAX ブラウザの履歴ASP.NET、次の 3 つの操作を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-247">ASP.NET AJAX browser history, you need to do three things:</span></span>

1. <span data-ttu-id="5e9f3-248">[ブラウザーの履歴] プロパティを true に設定して、ブラウザーの履歴を有効にします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-248">Enable Browser History by setting the enableBrowserHistory property to true.</span></span>
2. <span data-ttu-id="5e9f3-249">addHistoryPoint() メソッドを呼び出してビューの状態が変更されたときに履歴ポイントを保存します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-249">Save history points when the state of a view changes by calling the addHistoryPoint() method.</span></span>
3. <span data-ttu-id="5e9f3-250">navigate イベントが発生したときのビューの状態を再構築します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-250">Reconstruct the state of the view when the navigate event is raised.</span></span>

<span data-ttu-id="5e9f3-251">更新されたインデックス ビューは、リスト 5 に含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-251">The updated Index view is contained in Listing 5.</span></span>

<span data-ttu-id="5e9f3-252">**リスト 5 - ビュー\連絡先\インデックス.aspx**</span><span class="sxs-lookup"><span data-stu-id="5e9f3-252">**Listing 5 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample8.aspx)]

<span data-ttu-id="5e9f3-253">リスト 5 では、ブラウザー履歴は pageInit() 関数で有効になっています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-253">In Listing 5, Browser History is enabled in the pageInit() function.</span></span> <span data-ttu-id="5e9f3-254">pageInit() 関数は、navigate イベントのイベント ハンドラーを設定するためにも使用されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-254">The pageInit() function is also used to set up the event handler for the navigate event.</span></span> <span data-ttu-id="5e9f3-255">ナビゲーション イベントは、ブラウザーの [進む] ボタンまたは [戻る] ボタンによってページの状態が変化するたびに発生します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-255">The navigate event is raised whenever the browser Forward or Back button causes the state of the page to change.</span></span>

<span data-ttu-id="5e9f3-256">連絡先グループをクリックすると、beginContactList() メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-256">The beginContactList() method is called when you click a contact group.</span></span> <span data-ttu-id="5e9f3-257">このメソッドは、addHistoryPoint() メソッドを呼び出して新しい履歴ポイントを作成します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-257">This method creates a new history point by calling the addHistoryPoint() method.</span></span> <span data-ttu-id="5e9f3-258">クリックした連絡先グループの ID が履歴に追加されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-258">The id of the contact group clicked is added to history.</span></span>

<span data-ttu-id="5e9f3-259">グループ ID は、連絡先グループ リンクの expando 属性から取得されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-259">The group id is retrieved from an expando attribute on the contact group link.</span></span> <span data-ttu-id="5e9f3-260">リンクは、Ajax.ActionLink() への次の呼び出しでレンダリングされます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-260">The link is rendered with the following call to Ajax.ActionLink().</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample9.aspx)]

<span data-ttu-id="5e9f3-261">Ajax.ActionLink() に渡された最後のパラメーターは、groupid という名前の expando 属性をリンクに追加します (XHTML 互換性の小文字)。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-261">The last parameter passed to the Ajax.ActionLink() adds an expando attribute named groupid to the link (lowercase for XHTML compatibility).</span></span>

<span data-ttu-id="5e9f3-262">ユーザーがブラウザの [戻る] ボタンまたは [進む] ボタンをクリックすると、navigate イベントが発生し、navigate() メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-262">When a user hits the browser Back or Forward button, the navigate event is raised and the navigate() method is called.</span></span> <span data-ttu-id="5e9f3-263">このメソッドは、ページに表示される連絡先を、ナビゲーション メソッドに渡されたブラウザーの履歴ポイントに対応するページの状態に一致するように更新します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-263">This method updates the contacts displayed in the page to match the state of the page that corresponds to the browser history point passed to the navigate method.</span></span>

## <a name="performing-ajax-deletes"></a><span data-ttu-id="5e9f3-264">Ajax 削除の実行</span><span class="sxs-lookup"><span data-stu-id="5e9f3-264">Performing Ajax Deletes</span></span>

<span data-ttu-id="5e9f3-265">現在、連絡先を削除するには、[削除] リンクをクリックし、削除確認ページに表示される [削除] ボタンをクリックする必要があります (図 2 参照)。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-265">Currently, in order to delete a contact, you need to click on the Delete link and then click the Delete button displayed in the delete confirmation page (see Figure 2).</span></span> <span data-ttu-id="5e9f3-266">これは、データベースレコードを削除するような単純なことを行うための多くのページ要求のように思えます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-266">This seems like a lot of page requests to do something simple like deleting a database record.</span></span>

<span data-ttu-id="5e9f3-267">[![削除確認ページ](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="5e9f3-267">[![The delete confirmation page](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span></span>

<span data-ttu-id="5e9f3-268">**図02**: 削除確認ページ ([フルサイズの画像を表示する をクリック](iteration-7-add-ajax-functionality-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="5e9f3-268">**Figure 02**: The delete confirmation page([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image4.png))</span></span>

<span data-ttu-id="5e9f3-269">削除確認ページをスキップし、インデックスビューから直接連絡先を削除するのは魅力的です。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-269">It is tempting to skip the delete confirmation page and delete a contact directly from the Index view.</span></span> <span data-ttu-id="5e9f3-270">この方法を使用すると、アプリケーションがセキュリティ ホールに開かれるため、この誘惑を避ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-270">You should avoid this temptation because taking this approach opens your application to security holes.</span></span> <span data-ttu-id="5e9f3-271">一般に、Web アプリケーションの状態を変更するアクションを呼び出すときに、HTTP GET 操作を実行する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-271">In general, you don t want to perform an HTTP GET operation when invoking an action that modifies the state of your web application.</span></span> <span data-ttu-id="5e9f3-272">削除を実行する場合は、HTTP POST を実行するか、さらに HTTP DELETE 操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-272">When performing a delete, you want to perform an HTTP POST, or better yet, an HTTP DELETE operation.</span></span>

<span data-ttu-id="5e9f3-273">削除リンクは、連絡先リストの一部に含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-273">The Delete link is contained in the ContactList partial.</span></span> <span data-ttu-id="5e9f3-274">リスト 6 には、ContactList の一部の更新バージョンが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-274">An updated version of the ContactList partial is contained in Listing 6.</span></span>

<span data-ttu-id="5e9f3-275">**リスト 6 - ビュー\連絡先\連絡先リスト.ascx**</span><span class="sxs-lookup"><span data-stu-id="5e9f3-275">**Listing 6 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample10.aspx)]

<span data-ttu-id="5e9f3-276">削除リンクは、Ajax.ImageActionLink() メソッドに対する次の呼び出しでレンダリングされます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-276">The Delete link is rendered with the following call to the Ajax.ImageActionLink() method:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample11.aspx)]

> [!NOTE] 
> 
> <span data-ttu-id="5e9f3-277">ajax.ImageActionLink() は、ASP.NET MVC フレームワークの標準部分ではありません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-277">The Ajax.ImageActionLink() is not a standard part of the ASP.NET MVC framework.</span></span> <span data-ttu-id="5e9f3-278">Ajax.ImageActionLink() は、連絡先マネージャー プロジェクトに含まれるカスタム ヘルパー メソッドです。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-278">The Ajax.ImageActionLink() is a custom helper methods included in the Contact Manager project.</span></span>

<span data-ttu-id="5e9f3-279">AjaxOptions パラメーターには 2 つのプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-279">The AjaxOptions parameter has two properties.</span></span> <span data-ttu-id="5e9f3-280">まず、確認プロパティを使用して、ポップアップ JavaScript 確認ダイアログを表示します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-280">First, the Confirm property is used to display a popup JavaScript confirmation dialog.</span></span> <span data-ttu-id="5e9f3-281">次に、HTTP メソッド プロパティを使用して、HTTP 削除操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-281">Second, the HttpMethod property is used to perform an HTTP DELETE operation.</span></span>

<span data-ttu-id="5e9f3-282">リスト 7 には、連絡先コントローラーに追加された新しい AjaxDelete() アクションが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-282">Listing 7 contains a new AjaxDelete() action that has been added to the Contact controller.</span></span>

<span data-ttu-id="5e9f3-283">**リスト 7 - コントローラ\コンタクトコントローラー.cs (AjaxDelete)**</span><span class="sxs-lookup"><span data-stu-id="5e9f3-283">**Listing 7 - Controllers\ContactController.cs (AjaxDelete)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample12.cs)]

<span data-ttu-id="5e9f3-284">アクションは、AcceptVerbs 属性で修飾されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-284">The AjaxDelete() action is decorated with an AcceptVerbs attribute.</span></span> <span data-ttu-id="5e9f3-285">この属性は、HTTP DELETE 操作以外の HTTP 操作以外の操作が呼び出されないようにします。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-285">This attribute prevents the action from being invoked except by any HTTP operation other than an HTTP DELETE operation.</span></span> <span data-ttu-id="5e9f3-286">特に、HTTP GET を使用してこのアクションを呼び出すことはできません。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-286">In particular, you cannot invoke this action with an HTTP GET.</span></span>

<span data-ttu-id="5e9f3-287">データベース レコードを削除した後、削除されたレコードが含まれていない連絡先の更新された一覧を表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-287">After you delete database record, you need to display the updated list of contacts that does not contain the deleted record.</span></span> <span data-ttu-id="5e9f3-288">AjaxDelete() メソッドは、連絡先リストの一部と更新された連絡先のリストを返します。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-288">The AjaxDelete() method returns the ContactList partial and the updated list of contacts.</span></span>

## <a name="summary"></a><span data-ttu-id="5e9f3-289">まとめ</span><span class="sxs-lookup"><span data-stu-id="5e9f3-289">Summary</span></span>

<span data-ttu-id="5e9f3-290">このイテレーションでは、連絡先マネージャー アプリケーションに Ajax 機能を追加しました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-290">In this iteration, we added Ajax functionality to our Contact Manager application.</span></span> <span data-ttu-id="5e9f3-291">アプリケーションの応答性とパフォーマンスを向上させるために Ajax を使用しました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-291">We used Ajax to improve the responsiveness and performance of our application.</span></span>

<span data-ttu-id="5e9f3-292">まず、連絡先グループをクリックしてもビュー全体が更新されないように、インデックス ビューをリファクタリングしました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-292">First, we refactored the Index view so that clicking a contact group does not update the entire view.</span></span> <span data-ttu-id="5e9f3-293">代わりに、連絡先グループをクリックすると、連絡先の一覧のみが更新されます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-293">Instead, clicking a contact group only updates the list of contacts.</span></span>

<span data-ttu-id="5e9f3-294">次に、jQuery アニメーション効果を使用して、連絡先のリストをフェードアウトしてフェードインしました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-294">Next, we used jQuery animation effects to fade out and fade in the list of contacts.</span></span> <span data-ttu-id="5e9f3-295">Ajax アプリケーションにアニメーションを追加すると、ブラウザーの進行状況バーと同等のアプリケーションのユーザーを提供できます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-295">Adding animation to an Ajax application can be used to provide users of the application with the equivalent of a browser progress bar.</span></span>

<span data-ttu-id="5e9f3-296">また、Ajax アプリケーションにブラウザ履歴のサポートを追加しました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-296">We also added browser history support to our Ajax application.</span></span> <span data-ttu-id="5e9f3-297">ユーザーがブラウザの [戻る] ボタンと [進む] ボタンをクリックして、インデックス ビューの状態を変更することを有効にしました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-297">We enabled users to click the browser Back and Forward buttons to change the state of the Index view.</span></span>

<span data-ttu-id="5e9f3-298">最後に、HTTP DELETE 操作をサポートする削除リンクを作成しました。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-298">Finally, we created a delete link that supports HTTP DELETE operations.</span></span> <span data-ttu-id="5e9f3-299">Ajax 削除を実行することにより、ユーザーは追加の削除確認ページを要求することなく、データベースレコードを削除することができます。</span><span class="sxs-lookup"><span data-stu-id="5e9f3-299">By performing Ajax deletes, we enable users to delete database records without requiring the user to request an additional delete confirmation page.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5e9f3-300">[前へ](iteration-6-use-test-driven-development-cs.md)
> [次へ](iteration-1-create-the-application-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5e9f3-300">[Previous](iteration-6-use-test-driven-development-cs.md)
[Next](iteration-1-create-the-application-vb.md)</span></span>
