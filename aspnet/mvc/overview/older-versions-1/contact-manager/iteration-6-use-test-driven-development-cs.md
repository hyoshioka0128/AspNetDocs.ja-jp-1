---
uid: mvc/overview/older-versions-1/contact-manager/iteration-6-use-test-driven-development-cs
title: 'イテレーション #6 – テスト駆動開発 (C#) を使用する |マイクロソフトドキュメント'
author: rick-anderson
description: この 6 回目のイテレーションでは、単体テストを最初に記述し、単体テストに対してコードを記述することで、アプリケーションに新しい機能を追加します。 このイテレーションでは,...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 013c3c26-7dc3-41d1-8064-f233c86008b5
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-6-use-test-driven-development-cs
msc.type: authoredcontent
ms.openlocfilehash: d0e8f30a075cc79c7410ffe1b8bf02da2bd44443
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542327"
---
# <a name="iteration-6--use-test-driven-development-c"></a><span data-ttu-id="e46bd-104">繰り返し #6 – テスト駆動型開発を使用する (C#)</span><span class="sxs-lookup"><span data-stu-id="e46bd-104">Iteration #6 – Use test-driven development (C#)</span></span>

<span data-ttu-id="e46bd-105">[マイクロソフト](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="e46bd-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="e46bd-106">コードをダウンロード</span><span class="sxs-lookup"><span data-stu-id="e46bd-106">Download Code</span></span>](iteration-6-use-test-driven-development-cs/_static/contactmanager_6_cs1.zip)

> <span data-ttu-id="e46bd-107">この 6 回目のイテレーションでは、単体テストを最初に記述し、単体テストに対してコードを記述することで、アプリケーションに新しい機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-107">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="e46bd-108">このイテレーションでは、連絡先グループを追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-108">In this iteration, we add contact groups.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="e46bd-109">MVC アプリケーション (C#) ASP.NET連絡先管理の構築</span><span class="sxs-lookup"><span data-stu-id="e46bd-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="e46bd-110">この一連のチュートリアルでは、最初から最後まで連絡先管理アプリケーション全体を構築します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="e46bd-111">連絡先マネージャー アプリケーションでは、連絡先の情報 (名前、電話番号、電子メール アドレス) を保存できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="e46bd-112">複数のイテレーションでアプリケーションをビルドします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="e46bd-113">各反復処理で、アプリケーションを徐々に改善します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="e46bd-114">この複数の反復アプローチの目的は、各変更の理由を理解できるようにすることです。</span><span class="sxs-lookup"><span data-stu-id="e46bd-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="e46bd-115">イテレーション #1 - アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="e46bd-116">最初のイテレーションでは、できるだけ簡単な方法で連絡先マネージャーを作成します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="e46bd-117">基本的なデータベース操作のサポートを追加: 作成、読み取り、更新、および削除 (CRUD) 。</span><span class="sxs-lookup"><span data-stu-id="e46bd-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="e46bd-118">イテレーション #2 - アプリケーションを見栄えよくします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="e46bd-119">このイテレーションでは、既定の ASP.NET MVC ビュー マスター ページとカスケード スタイル シートを変更することで、アプリケーションの外観を向上させます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="e46bd-120">イテレーション #3 - フォームの検証を追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="e46bd-121">3 回目のイテレーションでは、基本的なフォーム検証を追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="e46bd-122">必須のフォームフィールドに入力せずにフォームを送信できないようにします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="e46bd-123">また、メールアドレスと電話番号も検証します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="e46bd-124">イテレーション #4 - アプリケーションを疎結合にします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="e46bd-125">この 4 回目のイテレーションでは、いくつかのソフトウェア設計パターンを利用して、Contact Manager アプリケーションの保守と変更を容易にします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="e46bd-126">たとえば、リポジトリ パターンと依存関係の挿入パターンを使用するようにアプリケーションをリファクタリングします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="e46bd-127">イテレーション #5 - 単体テストを作成します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="e46bd-128">5 回目のイテレーションでは、単体テストを追加することで、アプリケーションの保守と変更を容易にします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="e46bd-129">データ モデル クラスをモックし、コントローラーと検証ロジックの単体テストをビルドします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="e46bd-130">イテレーション #6 - テスト駆動型開発を使用します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="e46bd-131">この 6 回目のイテレーションでは、単体テストを最初に記述し、単体テストに対してコードを記述することで、アプリケーションに新しい機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="e46bd-132">このイテレーションでは、連絡先グループを追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="e46bd-133">イテレーション #7 - Ajax 機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="e46bd-134">7 回目のイテレーションでは、Ajax のサポートを追加することで、アプリケーションの応答性とパフォーマンスを向上させます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="e46bd-135">このイテレーション</span><span class="sxs-lookup"><span data-stu-id="e46bd-135">This Iteration</span></span>

<span data-ttu-id="e46bd-136">Contact Manager アプリケーションの以前のイテレーションでは、コードのセーフティ ネットを提供する単体テストを作成しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-136">In the previous iteration of the Contact Manager application, we created unit tests to provide a safety net for our code.</span></span> <span data-ttu-id="e46bd-137">単体テストを作成する動機は、コードの変更に対する耐性を高めるためです。</span><span class="sxs-lookup"><span data-stu-id="e46bd-137">The motivation for creating the unit tests was to make our code more resilient to change.</span></span> <span data-ttu-id="e46bd-138">単体テストを実施することで、コードを変更して、既存の機能が壊れているかどうかをすぐに確認できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-138">With unit tests in place, we can happily make any change to our code and immediately know whether we have broken existing functionality.</span></span>

<span data-ttu-id="e46bd-139">このイテレーションでは、まったく異なる目的で単体テストを使用します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-139">In this iteration, we use unit tests for an entirely different purpose.</span></span> <span data-ttu-id="e46bd-140">このイテレーションでは、単体テストをアプリケーション設計の一部として使用*します*。</span><span class="sxs-lookup"><span data-stu-id="e46bd-140">In this iteration, we use unit tests as part of an application design philosophy called *test-driven development*.</span></span> <span data-ttu-id="e46bd-141">テスト駆動開発を実践する場合は、まずテストを記述してから、テストに対してコードを記述します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-141">When you practice test-driven development, you write tests first and then write code against the tests.</span></span>

<span data-ttu-id="e46bd-142">より正確に言うと、テスト駆動開発を実践する場合、コードを作成する際に完了する手順は 3 つあります (赤/緑/リファクタリング)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-142">More precisely, when practicing test-driven development, there are three steps that you complete when creating code (Red/ Green/Refactor):</span></span>

1. <span data-ttu-id="e46bd-143">失敗した単体テストを書く (赤)</span><span class="sxs-lookup"><span data-stu-id="e46bd-143">Write a unit test that fails (Red)</span></span>
2. <span data-ttu-id="e46bd-144">単体テストに合格するコードを記述する (緑)</span><span class="sxs-lookup"><span data-stu-id="e46bd-144">Write code that passes the unit test (Green)</span></span>
3. <span data-ttu-id="e46bd-145">コードのリファクタリング (リファクタリング)</span><span class="sxs-lookup"><span data-stu-id="e46bd-145">Refactor your code (Refactor)</span></span>

<span data-ttu-id="e46bd-146">まず、単体テストを記述します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-146">First, you write the unit test.</span></span> <span data-ttu-id="e46bd-147">単体テストでは、コードの動作を想定する意図を表現する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-147">The unit test should express your intention for how you expect your code to behave.</span></span> <span data-ttu-id="e46bd-148">単体テストを初めて作成すると、単体テストは失敗します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-148">When you first create the unit test, the unit test should fail.</span></span> <span data-ttu-id="e46bd-149">テストを満たすアプリケーション コードをまだ記述していないため、テストは失敗します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-149">The test should fail because you have not yet written any application code that satisfies the test.</span></span>

<span data-ttu-id="e46bd-150">次に、単体テストが成功するために十分なコードを記述します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-150">Next, you write just enough code in order for the unit test to pass.</span></span> <span data-ttu-id="e46bd-151">目標は、最も怠惰で、ずさんで、最速の方法でコードを書く方法です。</span><span class="sxs-lookup"><span data-stu-id="e46bd-151">The goal is to write the code in the laziest, sloppiest and fastest possible way.</span></span> <span data-ttu-id="e46bd-152">アプリケーションのアーキテクチャについて考える時間を無駄にしないでください。</span><span class="sxs-lookup"><span data-stu-id="e46bd-152">You should not waste time thinking about the architecture of your application.</span></span> <span data-ttu-id="e46bd-153">代わりに、単体テストで表現される意図を満たすために必要な最小限のコードを記述することに重点を置く必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-153">Instead, you should focus on writing the minimal amount of code necessary to satisfy the intention expressed by the unit test.</span></span>

<span data-ttu-id="e46bd-154">最後に、十分なコードを記述した後、一歩下がってアプリケーションの全体的なアーキテクチャを検討できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-154">Finally, after you have written enough code, you can step back and consider the overall architecture of your application.</span></span> <span data-ttu-id="e46bd-155">この手順では、リポジトリ パターンなどのソフトウェア設計パターンを利用してコードを書き直し (リファクタリング) して、コードの保守性を高めます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-155">In this step, you rewrite (refactor) your code by taking advantage of software design patterns -- such as the repository pattern -- so that your code is more maintainable.</span></span> <span data-ttu-id="e46bd-156">コードは単体テストでカバーされるため、この手順でコードを書き直すことができます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-156">You can fearlessly rewrite your code in this step because your code is covered by unit tests.</span></span>

<span data-ttu-id="e46bd-157">テスト駆動開発の実践には多くのメリットがあります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-157">There are many benefits that result from practicing test-driven development.</span></span> <span data-ttu-id="e46bd-158">まず、テスト駆動型の開発では、実際に記述する必要があるコードに集中する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-158">First, test-driven development forces you to focus on code that actually needs to be written.</span></span> <span data-ttu-id="e46bd-159">特定のテストに合格するのに十分なコードを記述することに常に重点を置いているため、雑草に迷い込んで、決して使用しない大量のコードを記述することはできなくなります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-159">Because you are constantly focused on just writing enough code to pass a particular test, you are prevented from wandering into the weeds and writing massive amounts of code that you will never use.</span></span>

<span data-ttu-id="e46bd-160">次に、「テストファースト」設計方法論は、コードの使用方法の観点からコードを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-160">Second, a "test first" design methodology forces you to write code from the perspective of how your code will be used.</span></span> <span data-ttu-id="e46bd-161">つまり、テスト駆動型開発を実践する場合、ユーザーの視点から常にテストを記述しています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-161">In other words, when practicing test-driven development, you are constantly writing your tests from a user perspective.</span></span> <span data-ttu-id="e46bd-162">したがって、テスト駆動型の開発により、よりクリーンで理解しやすい API が得られます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-162">Therefore, test-driven development can result in cleaner and more understandable APIs.</span></span>

<span data-ttu-id="e46bd-163">最後に、テスト駆動型の開発では、アプリケーションを記述する通常のプロセスの一部として単体テストを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-163">Finally, test-driven development forces you to write unit tests as part of the normal process of writing an application.</span></span> <span data-ttu-id="e46bd-164">プロジェクトの期限が近づくと、テストは通常、ウィンドウの外に出る最初のものです。</span><span class="sxs-lookup"><span data-stu-id="e46bd-164">As a project deadline approaches, testing is typically the first thing that goes out the window.</span></span> <span data-ttu-id="e46bd-165">一方、テスト駆動開発を実践する場合、単体テストの作成は、単体テストをアプリケーション構築プロセスの中心にするため、高潔な方が高い方がよいでしょう。</span><span class="sxs-lookup"><span data-stu-id="e46bd-165">When practicing test-driven development, on the other hand, you are more likely to be virtuous about writing unit tests because test-driven development makes unit tests central to the process of building an application.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="e46bd-166">テスト駆動開発の詳細については、Michael Feathers の著書 **「レガシー コードを効果的に使用する**」を読むことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-166">To learn more about test-driven development, I recommend that you read Michael Feathers book **Working Effectively with Legacy Code**.</span></span>

<span data-ttu-id="e46bd-167">このイテレーションでは、連絡先マネージャー アプリケーションに新しい機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-167">In this iteration, we add a new feature to our Contact Manager application.</span></span> <span data-ttu-id="e46bd-168">連絡先グループのサポートを追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-168">We add support for Contact Groups.</span></span> <span data-ttu-id="e46bd-169">連絡先グループを使用して、連絡先をビジネス グループや友商グループなどのカテゴリに分類できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-169">You can use Contact Groups to organize your contacts into categories such as Business and Friend groups.</span></span>

<span data-ttu-id="e46bd-170">テスト駆動型開発のプロセスに従って、この新しい機能をアプリケーションに追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-170">We'll add this new functionality to our application by following a process of test-driven development.</span></span> <span data-ttu-id="e46bd-171">まず単体テストを記述し、これらのテストに対してすべてのコードを記述します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-171">We'll write our unit tests first and we'll write all of our code against these tests.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="e46bd-172">テスト内容</span><span class="sxs-lookup"><span data-stu-id="e46bd-172">What Gets Tested</span></span>

<span data-ttu-id="e46bd-173">前のイテレーションで説明したように、通常はデータ アクセス ロジックまたはビュー ロジックの単体テストを記述しません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-173">As we discussed in the previous iteration, you typically do not write unit tests for data access logic or view logic.</span></span> <span data-ttu-id="e46bd-174">データベースへのアクセスは比較的低速な操作であるため、データ アクセス ロジックの単体テストは記述しません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-174">You don t write unit tests for data access logic because accessing a database is a relatively slow operation.</span></span> <span data-ttu-id="e46bd-175">ビューにアクセスするには、比較的低速な操作である Web サーバーを作成する必要があるため、ビュー ロジックの単体テストは記述しません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-175">You don t write unit tests for view logic because accessing a view requires spinning up a web server which is a relatively slow operation.</span></span> <span data-ttu-id="e46bd-176">テストを何度も何度も繰り返し実行できない限り、単体テストを記述しないでください。</span><span class="sxs-lookup"><span data-stu-id="e46bd-176">You shouldn't write a unit test unless the test can be executed over and over again very fast</span></span>

<span data-ttu-id="e46bd-177">テスト駆動型開発は単体テストによって駆動されるため、最初はコントローラーとビジネス ロジックの記述に重点を置いています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-177">Because test-driven development is driven by unit tests, we focus initially on writing controller and business logic.</span></span> <span data-ttu-id="e46bd-178">データベースやビューへのアクセスは避けます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-178">We avoid touching the database or views.</span></span> <span data-ttu-id="e46bd-179">このチュートリアルの最後まで、データベースの変更やビューの作成は行いません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-179">We won't modify the database or create our views until the very end of this tutorial.</span></span> <span data-ttu-id="e46bd-180">まず、テストできることから始めます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-180">We start with what can be tested.</span></span>

## <a name="creating-user-stories"></a><span data-ttu-id="e46bd-181">ユーザー ストーリーの作成</span><span class="sxs-lookup"><span data-stu-id="e46bd-181">Creating User Stories</span></span>

<span data-ttu-id="e46bd-182">テスト駆動開発を実践する場合は、常にテストを書くことから始めます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-182">When practicing test-driven development, you always start by writing a test.</span></span> <span data-ttu-id="e46bd-183">これはすぐに問題を提起します:どのように最初に書くテストを決めるのですか?</span><span class="sxs-lookup"><span data-stu-id="e46bd-183">This immediately raises the question: How do you decide what test to write first?</span></span> <span data-ttu-id="e46bd-184">この質問に答えるためには、[**ユーザー ストーリー**](http://en.wikipedia.org/wiki/User_stories)のセットを書く必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-184">To answer this question, you should write a set of [**user stories**](http://en.wikipedia.org/wiki/User_stories).</span></span>

<span data-ttu-id="e46bd-185">ユーザー ストーリーは、ソフトウェア要件の非常に簡潔な (通常は 1 つの文) 説明です。</span><span class="sxs-lookup"><span data-stu-id="e46bd-185">A user story is a very brief (usually one sentence) description of a software requirement.</span></span> <span data-ttu-id="e46bd-186">これは、ユーザーの視点から書かれた要件の非技術的な説明である必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-186">It should be a non-technical description of a requirement written from a user perspective.</span></span>

<span data-ttu-id="e46bd-187">新しい連絡先グループ機能で必要な機能を説明するユーザー ストーリーのセットを次に示します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-187">Here s the set of user stories that describe the features required by the new Contact Group functionality:</span></span>

1. <span data-ttu-id="e46bd-188">ユーザーは連絡先グループの一覧を表示できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-188">User can view a list of contact groups.</span></span>
2. <span data-ttu-id="e46bd-189">ユーザーは新しい連絡先グループを作成できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-189">User can create a new contact group.</span></span>
3. <span data-ttu-id="e46bd-190">ユーザーは既存の連絡先グループを削除できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-190">User can delete an existing contact group.</span></span>
4. <span data-ttu-id="e46bd-191">ユーザーは、新しい連絡先を作成するときに連絡先グループを選択できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-191">User can select a contact group when creating a new contact.</span></span>
5. <span data-ttu-id="e46bd-192">既存の連絡先を編集するときに、ユーザーは連絡先グループを選択できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-192">User can select a contact group when editing an existing contact.</span></span>
6. <span data-ttu-id="e46bd-193">連絡先グループの一覧がインデックス ビューに表示されます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-193">A list of contact groups is displayed in the Index view.</span></span>
7. <span data-ttu-id="e46bd-194">ユーザーが連絡先グループをクリックすると、一致する連絡先の一覧が表示されます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-194">When a user clicks a contact group, a list of matching contacts is displayed.</span></span>

<span data-ttu-id="e46bd-195">このユーザー ストーリーの一覧は、顧客が完全に理解できることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e46bd-195">Notice that this list of user stories is completely understandable by a customer.</span></span> <span data-ttu-id="e46bd-196">技術的な実装の詳細については言及していません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-196">There is no mention of technical implementation details.</span></span>

<span data-ttu-id="e46bd-197">アプリケーションの構築中に、ユーザー ストーリーのセットをより洗練することができます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-197">While in the process of building your application, the set of user stories can become more refined.</span></span> <span data-ttu-id="e46bd-198">ユーザー ストーリーを複数のストーリー (要件) に分割する場合があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-198">You might break a user story into multiple stories (requirements).</span></span> <span data-ttu-id="e46bd-199">たとえば、新しい連絡先グループの作成には検証が必要であると判断できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-199">For example, you might decide that creating a new contact group should involve validation.</span></span> <span data-ttu-id="e46bd-200">名前を付けずに連絡先グループを送信すると、検証エラーが返されます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-200">Submitting a contact group without a name should return a validation error.</span></span>

<span data-ttu-id="e46bd-201">ユーザー ストーリーのリストを作成したら、最初の単体テストを記述する準備が整いました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-201">After you create a list of user stories, you are ready to write your first unit test.</span></span> <span data-ttu-id="e46bd-202">まず、連絡先グループの一覧を表示するための単体テストを作成します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-202">We'll start by creating a unit test for viewing the list of contact groups.</span></span>

## <a name="listing-contact-groups"></a><span data-ttu-id="e46bd-203">連絡先グループの一覧表示</span><span class="sxs-lookup"><span data-stu-id="e46bd-203">Listing Contact Groups</span></span>

<span data-ttu-id="e46bd-204">最初のユーザー ストーリーは、ユーザーが連絡先グループの一覧を表示できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-204">Our first user story is that a user should be able to view a list of contact groups.</span></span> <span data-ttu-id="e46bd-205">この話をテストで表現する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-205">We need to express this story with a test.</span></span>

<span data-ttu-id="e46bd-206">ContactManager.Tests プロジェクトでコントローラー フォルダーを右クリックし、**追加、新しいテスト**を選択し、単体テスト テンプレートを選択して、新しい**単体テスト**を作成します (図 1 参照)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-206">Create a new unit test by right-clicking the Controllers folder in the ContactManager.Tests project, selecting **Add, New Test**, and selecting the **Unit Test** template (see Figure 1).</span></span> <span data-ttu-id="e46bd-207">新しい単体テストに名前をGroupControllerTest.csし **、[OK] ボタン**をクリックします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-207">Name the new unit test GroupControllerTest.cs and click the **OK** button.</span></span>

<span data-ttu-id="e46bd-208">[![グループコントローラーテスト単体テストの追加](iteration-6-use-test-driven-development-cs/_static/image1.jpg)](iteration-6-use-test-driven-development-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e46bd-208">[![Adding the GroupControllerTest unit test](iteration-6-use-test-driven-development-cs/_static/image1.jpg)](iteration-6-use-test-driven-development-cs/_static/image1.png)</span></span>

<span data-ttu-id="e46bd-209">**図 01**: GroupControllerTest 単体テストの追加 ([フルサイズのイメージを表示する をクリック](iteration-6-use-test-driven-development-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="e46bd-209">**Figure 01**: Adding the GroupControllerTest unit test([Click to view full-size image](iteration-6-use-test-driven-development-cs/_static/image2.png))</span></span>

<span data-ttu-id="e46bd-210">最初の単体テストは、リスト 1 に含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-210">Our first unit test is contained in Listing 1.</span></span> <span data-ttu-id="e46bd-211">このテストでは、グループ コントローラの Index() メソッドがグループのセットを返すかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-211">This test verifies that the Index() method of the Group controller returns a set of Groups.</span></span> <span data-ttu-id="e46bd-212">テストでは、グループのコレクションがビュー データに返されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-212">The test verifies that a collection of Groups is returned in view data.</span></span>

<span data-ttu-id="e46bd-213">**リスト 1 - コントローラ\グループコントローラテスト.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-213">**Listing 1 - Controllers\GroupControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample1.cs)]

<span data-ttu-id="e46bd-214">Visual Studio のリスト 1 に最初にコードを入力すると、赤い波線が多く表示されます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-214">When you first type the code in Listing 1 in Visual Studio, you'll get a lot of red squiggly lines.</span></span> <span data-ttu-id="e46bd-215">グループコントローラまたはグループクラスは作成していません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-215">We have not created the GroupController or Group classes.</span></span>

<span data-ttu-id="e46bd-216">この時点では、最初の単体テストを実行できないように、アプリケーションを構築することさえできません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-216">At this point, we can t even build our application so we can t execute our first unit test.</span></span> <span data-ttu-id="e46bd-217">それは良いことです。</span><span class="sxs-lookup"><span data-stu-id="e46bd-217">That s good.</span></span> <span data-ttu-id="e46bd-218">これは失敗したテストとしてカウントされます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-218">That counts as a failing test.</span></span> <span data-ttu-id="e46bd-219">したがって、アプリケーション コードの作成を開始する権限が与えられます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-219">Therefore, we now have permission to start writing application code.</span></span> <span data-ttu-id="e46bd-220">テストを実行するのに十分なコードを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-220">We need to write enough code to execute our test.</span></span>

<span data-ttu-id="e46bd-221">リスト 2 の Group コントローラー クラスには、単体テストに合格するために必要な最小限のコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-221">The Group controller class in Listing 2 contains the bare minimum of code required to pass the unit test.</span></span> <span data-ttu-id="e46bd-222">Index() アクションは、静的にコード化されたグループのリストを返します (グループクラスはリスト 3 で定義されています)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-222">The Index() action returns a statically coded list of Groups (the Group class is defined in Listing 3).</span></span>

<span data-ttu-id="e46bd-223">**リスト 2 - コントローラ\グループコントローラ.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-223">**Listing 2 - Controllers\GroupController.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample2.cs)]

<span data-ttu-id="e46bd-224">**リスト 3 - モデル\グループ.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-224">**Listing 3 - Models\Group.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample3.cs)]

<span data-ttu-id="e46bd-225">プロジェクトに GroupController クラスとグループ クラスを追加すると、最初の単体テストが正常に完了します (図 2 参照)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-225">After we add the GroupController and Group classes to our project, our first unit test completes successfully (see Figure 2).</span></span> <span data-ttu-id="e46bd-226">テストに合格するために必要な最低限の作業を行いました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-226">We have done the minimum work required to pass the test.</span></span> <span data-ttu-id="e46bd-227">それはお祝いする時間です。</span><span class="sxs-lookup"><span data-stu-id="e46bd-227">It is time to celebrate.</span></span>

<span data-ttu-id="e46bd-228">[![成功！](iteration-6-use-test-driven-development-cs/_static/image2.jpg)](iteration-6-use-test-driven-development-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e46bd-228">[![Success!](iteration-6-use-test-driven-development-cs/_static/image2.jpg)](iteration-6-use-test-driven-development-cs/_static/image3.png)</span></span>

<span data-ttu-id="e46bd-229">**図02**: 成功!([フルサイズの画像を表示するには クリック](iteration-6-use-test-driven-development-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="e46bd-229">**Figure 02**: Success!([Click to view full-size image](iteration-6-use-test-driven-development-cs/_static/image4.png))</span></span>

## <a name="creating-contact-groups"></a><span data-ttu-id="e46bd-230">連絡先グループの作成</span><span class="sxs-lookup"><span data-stu-id="e46bd-230">Creating Contact Groups</span></span>

<span data-ttu-id="e46bd-231">これで、2 番目のユーザー ストーリーに移ります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-231">Now we can move on to the second user story.</span></span> <span data-ttu-id="e46bd-232">新しい連絡先グループを作成できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-232">We need to be able to create new contact groups.</span></span> <span data-ttu-id="e46bd-233">この意図をテストで表現する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-233">We need to express this intention with a test.</span></span>

<span data-ttu-id="e46bd-234">リスト 4 のテストでは、Create() メソッドを新しいグループで呼び出すと、Index() メソッドから返されたグループのリストにグループが追加されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-234">The test in Listing 4 verifies that calling the Create() method with a new Group adds the Group to the list of Groups returned by the Index() method.</span></span> <span data-ttu-id="e46bd-235">つまり、新しいグループを作成すれば、Index() メソッドによって返されたグループのリストから新しいグループを取り戻すことができるはずです。</span><span class="sxs-lookup"><span data-stu-id="e46bd-235">In other words, if I create a new group then I should be able to get the new Group back from the list of Groups returned by the Index() method.</span></span>

<span data-ttu-id="e46bd-236">**リスト 4 - コントローラ\グループコントローラテスト.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-236">**Listing 4 - Controllers\GroupControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample4.cs)]

<span data-ttu-id="e46bd-237">リスト 4 のテストでは、新しい連絡先グループを使用してグループ コントローラー Create() メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-237">The test in Listing 4 calls the Group controller Create() method with a new contact Group.</span></span> <span data-ttu-id="e46bd-238">次に、テストは、グループ コント ローラーの Index() メソッドを呼び出すと、ビュー データで新しいグループが返されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-238">Next, the test verifies that calling the Group controller Index() method returns the new Group in view data.</span></span>

<span data-ttu-id="e46bd-239">リスト 5 の変更されたグループ コントローラーには、新しいテストに合格するために必要な最小限の変更が含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-239">The modified Group controller in Listing 5 contains the bare minimum of changes required to pass the new test.</span></span>

<span data-ttu-id="e46bd-240">**リスト 5 - コントローラ\グループコントローラ.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-240">**Listing 5 - Controllers\GroupController.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample5.cs)]

## <a name="the-group-controller-in-listing-5-has-a-new-create-action-this-action-adds-a-group-to-a-collection-of-groups-notice-that-the-index-action-has-been-modified-to-return-the-contents-of-the-collection-of-groups"></a><span data-ttu-id="e46bd-241">リスト 5 のグループ コントローラには、新しい Create() アクションがあります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-241">The Group controller in Listing 5 has a new Create() action.</span></span> <span data-ttu-id="e46bd-242">このアクションにより、グループのコレクションにグループが追加されます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-242">This action adds a Group to a collection of Groups.</span></span> <span data-ttu-id="e46bd-243">グループのコレクションの内容を返すように、Index() アクションが変更されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e46bd-243">Notice that the Index() action has been modified to return the contents of the collection of Groups.</span></span>

<span data-ttu-id="e46bd-244">もう一度、我々は、単体テストに合格するために必要な最低限の作業を実行しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-244">Once again, we have performed the bare minimum amount of work required to pass the unit test.</span></span> <span data-ttu-id="e46bd-245">グループ コントローラーにこれらの変更を加えた後、すべての単体テストに合格します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-245">After we make these changes to the Group controller, all of our unit tests pass.</span></span>

## <a name="adding-validation"></a><span data-ttu-id="e46bd-246">検証の追加</span><span class="sxs-lookup"><span data-stu-id="e46bd-246">Adding Validation</span></span>

<span data-ttu-id="e46bd-247">この要件は、ユーザー ストーリーでは明示的に記述されていません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-247">This requirement was not stated explicitly in the user story.</span></span> <span data-ttu-id="e46bd-248">ただし、グループに名前を付けることを要求することは合理的です。</span><span class="sxs-lookup"><span data-stu-id="e46bd-248">However, it is reasonable to require that a Group have a name.</span></span> <span data-ttu-id="e46bd-249">そうしないと、連絡先をグループに整理することはあまり役に立ちません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-249">Otherwise, organizing contacts into Groups would not be very useful.</span></span>

<span data-ttu-id="e46bd-250">リスト 6 には、この意図を表現する新しいテストが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-250">Listing 6 contains a new test that expresses this intention.</span></span> <span data-ttu-id="e46bd-251">このテストでは、名前を指定せずにグループを作成しようとすると、モデル状態の検証エラー メッセージが表示されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-251">This test verifies that attempting to create a Group without supplying a name results in a validation error message in model state.</span></span>

<span data-ttu-id="e46bd-252">**リスト 6 - コントローラ\グループコントローラテスト.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-252">**Listing 6 - Controllers\GroupControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample6.cs)]

<span data-ttu-id="e46bd-253">このテストを満たすためには、グループクラスにNameプロパティを追加する必要があります(リスト7を参照)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-253">In order to satisfy this test, we need to add a Name property to our Group class (see Listing 7).</span></span> <span data-ttu-id="e46bd-254">さらに、グループコントローラのCreate()アクションに検証ロジックを少し追加する必要があります(リスト8を参照)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-254">Furthermore, we need to add a tiny bit of validation logic to our Group controller s Create() action (see Listing 8).</span></span>

<span data-ttu-id="e46bd-255">**リスト 7 - モデル\グループ.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-255">**Listing 7 - Models\Group.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample7.cs)]

<span data-ttu-id="e46bd-256">**リスト 8 - コントローラ\グループコントローラ.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-256">**Listing 8 - Controllers\GroupController.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample8.cs)]

<span data-ttu-id="e46bd-257">グループ コントローラー Create() アクションに検証とデータベース ロジックの両方が含まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e46bd-257">Notice that the Group controller Create() action now contains both validation and database logic.</span></span> <span data-ttu-id="e46bd-258">現在、グループ コントローラで使用されるデータベースは、メモリ内コレクションだけで構成されています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-258">Currently, the database used by the Group controller consists of nothing more than an in-memory collection.</span></span>

## <a name="time-to-refactor"></a><span data-ttu-id="e46bd-259">リファクタリングまでの時間</span><span class="sxs-lookup"><span data-stu-id="e46bd-259">Time to Refactor</span></span>

<span data-ttu-id="e46bd-260">赤/緑/リファクタリングの 3 番目のステップは、リファクタリングパーツです。</span><span class="sxs-lookup"><span data-stu-id="e46bd-260">The third step in Red/Green/Refactor is the Refactor part.</span></span> <span data-ttu-id="e46bd-261">この時点で、コードから一歩下がって、アプリケーションをリファクタリングしてデザインを改善する方法を検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-261">At this point, we need to step back from our code and consider how we can refactor our application to improve its design.</span></span> <span data-ttu-id="e46bd-262">リファクタリングステージは、ソフトウェア設計の原則とパターンを実装する最善の方法について一生懸命考える段階です。</span><span class="sxs-lookup"><span data-stu-id="e46bd-262">The Refactor stage is the stage at which we think hard about the best way of implementing software design principles and patterns.</span></span>

<span data-ttu-id="e46bd-263">コードの設計を改善するために選択した方法で、コードを自由に変更できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-263">We are free to modify our code in any way that we choose to improve the design of the code.</span></span> <span data-ttu-id="e46bd-264">私たちは、既存の機能を壊すから私たちを防ぐユニットテストのセーフティネットを持っています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-264">We have a safety net of unit tests that prevent us from breaking existing functionality.</span></span>

<span data-ttu-id="e46bd-265">今のところ、私たちのグループコントローラは、優れたソフトウェア設計の観点から混乱しています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-265">Right now, our Group controller is a mess from the perspective of good software design.</span></span> <span data-ttu-id="e46bd-266">グループ コントローラには、検証とデータ アクセス コードが混乱しています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-266">The Group controller contains a tangled mess of validation and data access code.</span></span> <span data-ttu-id="e46bd-267">単一責任原則に違反しないように、これらの懸念事項を異なるクラスに分ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-267">To avoid violating the Single Responsibility Principle, we need to separate these concerns into different classes.</span></span>

<span data-ttu-id="e46bd-268">リファクタリングされたグループ コントローラ クラスは、リスト 9 に含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-268">Our refactored Group controller class is contained in Listing 9.</span></span> <span data-ttu-id="e46bd-269">コントローラーが、ContactManager サービス層を使用するように変更されました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-269">The controller has been modified to use the ContactManager service layer.</span></span> <span data-ttu-id="e46bd-270">これは、連絡先コントローラーで使用するサービス層と同じです。</span><span class="sxs-lookup"><span data-stu-id="e46bd-270">This is the same service layer that we use with the Contact controller.</span></span>

<span data-ttu-id="e46bd-271">リスト 10 には、グループの検証、一覧表示、および作成をサポートするために ContactManager サービス層に追加された新しいメソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-271">Listing 10 contains the new methods added to the ContactManager service layer to support validating, listing, and creating groups.</span></span> <span data-ttu-id="e46bd-272">インターフェイスが更新され、新しいメソッドが含まれました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-272">The IContactManagerService interface was updated to include the new methods.</span></span>

<span data-ttu-id="e46bd-273">リスト 11 には、IContactManager リポジトリ インターフェイスを実装する新しいフェイクコンタクトマネージャーリポジトリクラスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-273">Listing 11 contains a new FakeContactManagerRepository class that implements the IContactManagerRepository interface.</span></span> <span data-ttu-id="e46bd-274">IContactManager リポジトリ インターフェイスも実装する EntityContactManager リポジトリ クラスとは異なり、新しいクラスはデータベースと通信しません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-274">Unlike the EntityContactManagerRepository class that also implements the IContactManagerRepository interface, our new FakeContactManagerRepository class does not communicate with the database.</span></span> <span data-ttu-id="e46bd-275">クラスは、データベースのプロキシとしてメモリ内コレクションを使用します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-275">The FakeContactManagerRepository class uses an in-memory collection as a proxy for the database.</span></span> <span data-ttu-id="e46bd-276">このクラスは、偽のリポジトリ レイヤーとして単体テストで使用します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-276">We'll use this class in our unit tests as a fake repository layer.</span></span>

<span data-ttu-id="e46bd-277">**リスト 9 - コントローラ\グループコントローラ.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-277">**Listing 9 - Controllers\GroupController.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample9.cs)]

<span data-ttu-id="e46bd-278">**リスト 10 - コントローラー\コンタクトマネージャーサービス.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-278">**Listing 10 - Controllers\ContactManagerService.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample10.cs)]

<span data-ttu-id="e46bd-279">**リスト 11 - コントローラー\フェイクコンタクトマネージャーリポジトリ.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-279">**Listing 11 - Controllers\FakeContactManagerRepository.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample11.cs)]

<span data-ttu-id="e46bd-280">インターフェイスを変更するには、エンティティコンタクトマネージャーリポジトリクラスで CreateGroup() メソッドとリストグループ() メソッドを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-280">Modifying the IContactManagerRepository interface requires use to implement the CreateGroup() and ListGroups() methods in the EntityContactManagerRepository class.</span></span> <span data-ttu-id="e46bd-281">これを行う最も怠惰で最速の方法は、次のようなスタブ メソッドを追加することです。</span><span class="sxs-lookup"><span data-stu-id="e46bd-281">The laziest and fastest way to do this is to add stub methods that look like this:</span></span>   

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample12.cs)]

<span data-ttu-id="e46bd-282">最後に、アプリケーションの設計に対するこれらの変更では、単体テストに変更を加える必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-282">Finally, these changes to the design of our application require us to make some modifications to our unit tests.</span></span> <span data-ttu-id="e46bd-283">これで、単体テストを実行するときに FakeContactManager リポジトリを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-283">We now need to use the FakeContactManagerRepository when performing the unit tests.</span></span> <span data-ttu-id="e46bd-284">更新されたグループコントローラテストクラスは、リスト 12 に含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-284">The updated GroupControllerTest class is contained in Listing 12.</span></span>

<span data-ttu-id="e46bd-285">**リスト 12 - コントローラ\グループコントローラテスト.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-285">**Listing 12 - Controllers\GroupControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample13.cs)]

<span data-ttu-id="e46bd-286">これらの変更をすべて行った後、もう一度、すべての単体テストに合格します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-286">After we make all of these changes, once again, all of our unit tests pass.</span></span> <span data-ttu-id="e46bd-287">レッド/グリーン/リファクタリングの全サイクルを完了しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-287">We have completed the entire cycle of Red/Green/Refactor.</span></span> <span data-ttu-id="e46bd-288">最初の 2 つのユーザー ストーリーを実装しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-288">We have implemented the first two user stories.</span></span> <span data-ttu-id="e46bd-289">これで、ユーザー ストーリーで表現される要件に対するサポート単体テストが提供されました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-289">We now have supporting unit tests for the requirements expressed in the user stories.</span></span> <span data-ttu-id="e46bd-290">残りのユーザー ストーリーを実装するには、同じサイクルの赤/緑/リファクタリングを繰り返します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-290">Implementing the remainder of the user stories involves repeating the same cycle of Red/Green/Refactor.</span></span>

## <a name="modifying-our-database"></a><span data-ttu-id="e46bd-291">データベースの変更</span><span class="sxs-lookup"><span data-stu-id="e46bd-291">Modifying our Database</span></span>

<span data-ttu-id="e46bd-292">残念ながら、単体テストで表される要件をすべて満たしていますが、作業は完了していません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-292">Unfortunately, even though we have satisfied all of the requirements expressed by our unit tests, our work is not done.</span></span> <span data-ttu-id="e46bd-293">データベースを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-293">We still need to modify our database.</span></span>

<span data-ttu-id="e46bd-294">新しいグループ データベース テーブルを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-294">We need to create a new Group database table.</span></span> <span data-ttu-id="e46bd-295">次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="e46bd-295">Follow these steps:</span></span>

1. <span data-ttu-id="e46bd-296">サーバー エクスプローラ ウィンドウで、[テーブル] フォルダを右クリックし、メニュー オプションの **[新しいテーブルの追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-296">In the Server Explorer window, right-click the Tables folder and select the menu option **Add New Table**.</span></span>
2. <span data-ttu-id="e46bd-297">テーブル デザイナーで、次に説明する 2 つの列を入力します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-297">Enter the two columns described below in the Table Designer.</span></span>
3. <span data-ttu-id="e46bd-298">ID 列を主キーおよび ID 列としてマークします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-298">Mark the Id column as a primary key and Identity column.</span></span>
4. <span data-ttu-id="e46bd-299">フロッピーのアイコンをクリックして、新しいテーブルを Groups という名前で保存します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-299">Save the new table with the name Groups by clicking the icon of the floppy.</span></span>

<a id="0.11_table01"></a>

| <span data-ttu-id="e46bd-300">**列名**</span><span class="sxs-lookup"><span data-stu-id="e46bd-300">**Column Name**</span></span> | <span data-ttu-id="e46bd-301">**[データ型]**</span><span class="sxs-lookup"><span data-stu-id="e46bd-301">**Data Type**</span></span> | <span data-ttu-id="e46bd-302">**NULL を許可する**</span><span class="sxs-lookup"><span data-stu-id="e46bd-302">**Allow Nulls**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e46bd-303">Id</span><span class="sxs-lookup"><span data-stu-id="e46bd-303">Id</span></span> | <span data-ttu-id="e46bd-304">INT</span><span class="sxs-lookup"><span data-stu-id="e46bd-304">int</span></span> | <span data-ttu-id="e46bd-305">False</span><span class="sxs-lookup"><span data-stu-id="e46bd-305">False</span></span> |
| <span data-ttu-id="e46bd-306">名前</span><span class="sxs-lookup"><span data-stu-id="e46bd-306">Name</span></span> | <span data-ttu-id="e46bd-307">nvarchar(50)</span><span class="sxs-lookup"><span data-stu-id="e46bd-307">nvarchar(50)</span></span> | <span data-ttu-id="e46bd-308">False</span><span class="sxs-lookup"><span data-stu-id="e46bd-308">False</span></span> |

<span data-ttu-id="e46bd-309">次に、連絡先テーブルからすべてのデータを削除する必要があります (そうしないと、連絡先テーブルとグループ テーブル間のリレーションシップを作成できません)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-309">Next, we need to delete all of the data from the Contacts table (otherwise, we won't be able to create a relationship between the Contacts and Groups tables).</span></span> <span data-ttu-id="e46bd-310">次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="e46bd-310">Follow these steps:</span></span>

1. <span data-ttu-id="e46bd-311">[連絡先] テーブルを右クリックし、メニュー オプションの [**テーブル データの表示**] を選択します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-311">Right-click the Contacts table and select the menu option **Show Table Data**.</span></span>
2. <span data-ttu-id="e46bd-312">すべての行を削除します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-312">Delete all of the rows.</span></span>

<span data-ttu-id="e46bd-313">次に、グループ データベース テーブルと既存の連絡先データベース テーブルの間のリレーションシップを定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-313">Next, we need to define a relationship between the Groups database table and the existing Contacts database table.</span></span> <span data-ttu-id="e46bd-314">次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="e46bd-314">Follow these steps:</span></span>

1. <span data-ttu-id="e46bd-315">[サーバー エクスプローラー] ウィンドウで [連絡先] テーブルをダブルクリックして、テーブル デザイナーを開きます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-315">Double-click the Contacts table in the Server Explorer window to open the Table Designer.</span></span>
2. <span data-ttu-id="e46bd-316">GroupId という名前の連絡先テーブルに新しい整数列を追加します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-316">Add a new integer column to the Contacts table named GroupId.</span></span>
3. <span data-ttu-id="e46bd-317">[リレーションシップ] ボタンをクリックして 、[外部キー リレーションシップ] ダイアログを開きます (図 3 参照)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-317">Click the Relationship button to open the Foreign Key Relationships dialog (see Figure 3).</span></span>
4. <span data-ttu-id="e46bd-318">[追加] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-318">Click the Add button.</span></span>
5. <span data-ttu-id="e46bd-319">[テーブルと列の指定] ボタンの横に表示される省略記号ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-319">Click the ellipsis button that appears next to the Table and Columns Specification button.</span></span>
6. <span data-ttu-id="e46bd-320">[テーブルと列] ダイアログで、[主キー テーブルとしてグループ] を選択し、主キー列として [ID] を選択します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-320">In the Tables and Columns dialog, select Groups as the primary key table and Id as the primary key column.</span></span> <span data-ttu-id="e46bd-321">外部キー テーブルとして連絡先を選択し、外部キー列として GroupId を選択します (図 4 参照)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-321">Select Contacts as the foreign key table and GroupId as the foreign key column (see Figure 4).</span></span> <span data-ttu-id="e46bd-322">[OK] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-322">Click the OK button.</span></span>
7. <span data-ttu-id="e46bd-323">[**挿入および更新の指定]** で、[**削除ルール**] の値 **[カスケード**] を選択します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-323">Under **INSERT and UPDATE Specification**, select the value **Cascade** for **Delete Rule**.</span></span>
8. <span data-ttu-id="e46bd-324">[閉じる] ボタンをクリックして、[外部キーリレーションシップ] ダイアログを閉じます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-324">Click the Close button to close the Foreign Key Relationships dialog.</span></span>
9. <span data-ttu-id="e46bd-325">[保存] ボタンをクリックして、連絡先テーブルに変更を保存します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-325">Click the Save button to save the changes to the Contacts table.</span></span>

<span data-ttu-id="e46bd-326">[![データベース テーブル リレーションシップの作成](iteration-6-use-test-driven-development-cs/_static/image3.jpg)](iteration-6-use-test-driven-development-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e46bd-326">[![Creating a database table relationship](iteration-6-use-test-driven-development-cs/_static/image3.jpg)](iteration-6-use-test-driven-development-cs/_static/image5.png)</span></span>

<span data-ttu-id="e46bd-327">**図 03**: データベース テーブル リレーションシップを作成する ([フルサイズの画像を表示するには クリック](iteration-6-use-test-driven-development-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e46bd-327">**Figure 03**: Creating a database table relationship ([Click to view full-size image](iteration-6-use-test-driven-development-cs/_static/image6.png))</span></span>

<span data-ttu-id="e46bd-328">[![テーブルのリレーションシップの指定](iteration-6-use-test-driven-development-cs/_static/image4.jpg)](iteration-6-use-test-driven-development-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e46bd-328">[![Specifying table relationships](iteration-6-use-test-driven-development-cs/_static/image4.jpg)](iteration-6-use-test-driven-development-cs/_static/image7.png)</span></span>

<span data-ttu-id="e46bd-329">**図 04**: テーブルのリレーションシップを指定する ([フルサイズの画像を表示する をクリック](iteration-6-use-test-driven-development-cs/_static/image8.png)します )</span><span class="sxs-lookup"><span data-stu-id="e46bd-329">**Figure 04**: Specifying table relationships([Click to view full-size image](iteration-6-use-test-driven-development-cs/_static/image8.png))</span></span>

### <a name="updating-our-data-model"></a><span data-ttu-id="e46bd-330">データ モデルの更新</span><span class="sxs-lookup"><span data-stu-id="e46bd-330">Updating our Data Model</span></span>

<span data-ttu-id="e46bd-331">次に、新しいデータベース テーブルを表すためにデータ モデルを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-331">Next, we need to update our data model to represent the new database table.</span></span> <span data-ttu-id="e46bd-332">次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="e46bd-332">Follow these steps:</span></span>

1. <span data-ttu-id="e46bd-333">モデル フォルダーで ContactManagerModel.edmx ファイルをダブルクリックして、エンティティ デザイナーを開きます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-333">Double-click the ContactManagerModel.edmx file in the Models folder to open the Entity Designer.</span></span>
2. <span data-ttu-id="e46bd-334">Designer 画面を右クリックし、メニューオプションの **[データベースからモデルを更新**] を選択します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-334">Right-click the Designer surface and select the menu option **Update Model from Database**.</span></span>
3. <span data-ttu-id="e46bd-335">更新ウィザードで、[グループ] テーブルを選択し、[完了] ボタンをクリックします (図 5 参照)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-335">In the Update Wizard, select the Groups table and click the Finish button (see Figure 5).</span></span>
4. <span data-ttu-id="e46bd-336">Groups エンティティを右クリックし、メニュー オプションの **[名前の変更**] を選択します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-336">Right-click the Groups entity and select the menu option **Rename**.</span></span> <span data-ttu-id="e46bd-337">*グループ*エンティティの名前を*グループ*(単数) に変更します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-337">Change the name of the *Groups* entity to *Group* (singular).</span></span>
5. <span data-ttu-id="e46bd-338">連絡先エンティティの下部に表示される [グループ] ナビゲーション プロパティを右クリックします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-338">Right-click the Groups navigation property that appears at the bottom of the Contact entity.</span></span> <span data-ttu-id="e46bd-339">*グループ*ナビゲーション プロパティの名前を *[グループ*(単数)] に変更します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-339">Change the name of the *Groups* navigation property to *Group* (singular).</span></span>

<span data-ttu-id="e46bd-340">[![データベースからのエンティティ フレームワーク モデルの更新](iteration-6-use-test-driven-development-cs/_static/image5.jpg)](iteration-6-use-test-driven-development-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e46bd-340">[![Updating an Entity Framework model from the database](iteration-6-use-test-driven-development-cs/_static/image5.jpg)](iteration-6-use-test-driven-development-cs/_static/image9.png)</span></span>

<span data-ttu-id="e46bd-341">**図 05**: データベースから Entity Framework モデルを更新する ([フルサイズの画像を表示する をクリック](iteration-6-use-test-driven-development-cs/_static/image10.png)して)</span><span class="sxs-lookup"><span data-stu-id="e46bd-341">**Figure 05**: Updating an Entity Framework model from the database([Click to view full-size image](iteration-6-use-test-driven-development-cs/_static/image10.png))</span></span>

<span data-ttu-id="e46bd-342">これらの手順を完了すると、データ モデルは連絡先テーブルとグループ テーブルの両方を表します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-342">After you complete these steps, your data model will represent both the Contacts and Groups tables.</span></span> <span data-ttu-id="e46bd-343">エンティティ デザイナーには、両方のエンティティが表示されます (図 6 参照)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-343">The Entity Designer should show both entities (see Figure 6).</span></span>

<span data-ttu-id="e46bd-344">[![グループと連絡先を表示するエンティティ デザイナー](iteration-6-use-test-driven-development-cs/_static/image6.jpg)](iteration-6-use-test-driven-development-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="e46bd-344">[![Entity Designer displaying Group and Contact](iteration-6-use-test-driven-development-cs/_static/image6.jpg)](iteration-6-use-test-driven-development-cs/_static/image11.png)</span></span>

<span data-ttu-id="e46bd-345">**図 06**: グループと取引先担当者を表示するエンティティ デザイナー ([フルサイズの画像を表示する をクリック](iteration-6-use-test-driven-development-cs/_static/image12.png)して )</span><span class="sxs-lookup"><span data-stu-id="e46bd-345">**Figure 06**: Entity Designer displaying Group and Contact([Click to view full-size image](iteration-6-use-test-driven-development-cs/_static/image12.png))</span></span>

### <a name="creating-our-repository-classes"></a><span data-ttu-id="e46bd-346">リポジトリクラスの作成</span><span class="sxs-lookup"><span data-stu-id="e46bd-346">Creating our Repository Classes</span></span>

<span data-ttu-id="e46bd-347">次に、リポジトリ クラスを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-347">Next, we need to implement our repository class.</span></span> <span data-ttu-id="e46bd-348">このイテレーションの過程で、単体テストを満たすコードを記述しながら、いくつかの新しいメソッドを IContactManagerRepository インターフェイスに追加しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-348">Over the course of this iteration, we added several new methods to the IContactManagerRepository interface while writing code to satisfy our unit tests.</span></span> <span data-ttu-id="e46bd-349">IContactManager リポジトリ インターフェイスの最終バージョンは、リスト 14 に含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-349">The final version of the IContactManagerRepository interface is contained in Listing 14.</span></span>

<span data-ttu-id="e46bd-350">**リスト 14 - モデル\IContactManager リポジトリ.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-350">**Listing 14 - Models\IContactManagerRepository.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample14.cs)]

<span data-ttu-id="e46bd-351">連絡先グループの操作に関連するメソッドは実際には実装していません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-351">We haven't actually implemented any of the methods related to working with contact groups.</span></span> <span data-ttu-id="e46bd-352">現在、クラスには、IContactManagerRepository インターフェイスに記載されている各連絡先グループ メソッドのスタブ メソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-352">Currently, the EntityContactManagerRepository class has stub methods for each of the contact group methods listed in the IContactManagerRepository interface.</span></span> <span data-ttu-id="e46bd-353">たとえば、ListGroups() メソッドは現在次のようになります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-353">For example, the ListGroups() method currently looks like this:</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample15.cs)]

<span data-ttu-id="e46bd-354">スタブ メソッドを使用して、アプリケーションをコンパイルして単体テストに合格することができました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-354">The stub methods enabled us to compile our application and pass the unit tests.</span></span> <span data-ttu-id="e46bd-355">しかし、今ではこれらのメソッドを実際に実装する時が経ちます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-355">However, now it is time to actually implement these methods.</span></span> <span data-ttu-id="e46bd-356">エンティティコンタクトマネージャーリポジトリクラスの最終バージョンは、リスト13に含まれています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-356">The final version of the EntityContactManagerRepository class is contained in Listing 13.</span></span>

<span data-ttu-id="e46bd-357">**リスト 13 - モデル\エンティティコンタクトマネージャーリポジトリ.cs**</span><span class="sxs-lookup"><span data-stu-id="e46bd-357">**Listing 13 - Models\EntityContactManagerRepository.cs**</span></span>

[!code-csharp[Main](iteration-6-use-test-driven-development-cs/samples/sample16.cs)]

### <a name="creating-the-views"></a><span data-ttu-id="e46bd-358">ビューの作成</span><span class="sxs-lookup"><span data-stu-id="e46bd-358">Creating the Views</span></span>

<span data-ttu-id="e46bd-359">既定のASP.NETビュー エンジンを使用する場合は、mvc アプリケーションをASP.NETします。</span><span class="sxs-lookup"><span data-stu-id="e46bd-359">ASP.NET MVC application when you use the default ASP.NET view engine.</span></span> <span data-ttu-id="e46bd-360">したがって、特定の単体テストに応答してビューを作成する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-360">So, you don t create views in response to a particular unit test.</span></span> <span data-ttu-id="e46bd-361">ただし、アプリケーションはビューなしでは役に立たないため、Contact Manager アプリケーションに含まれるビューを作成および変更せずに、このイテレーションを完了することはできません。</span><span class="sxs-lookup"><span data-stu-id="e46bd-361">However, because an application would be useless without views, we can t complete this iteration without creating and modifying the views contained in the Contact Manager application.</span></span>

<span data-ttu-id="e46bd-362">連絡先グループを管理するために、次の新しいビューを作成する必要があります (図 7 参照)。</span><span class="sxs-lookup"><span data-stu-id="e46bd-362">We need to create the following new views for managing contact groups (see Figure 7):</span></span>

- <span data-ttu-id="e46bd-363">ビュー\グループ\Index.aspx - 連絡先グループの一覧を表示します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-363">Views\Group\Index.aspx - Displays list of contact groups</span></span>
- <span data-ttu-id="e46bd-364">ビュー\グループ\削除.aspx - 連絡先グループを削除するための確認フォームを表示します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-364">Views\Group\Delete.aspx - Displays confirmation form for deleting a contact group</span></span>

<span data-ttu-id="e46bd-365">[![グループインデックスビュー](iteration-6-use-test-driven-development-cs/_static/image7.jpg)](iteration-6-use-test-driven-development-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e46bd-365">[![The Group Index view](iteration-6-use-test-driven-development-cs/_static/image7.jpg)](iteration-6-use-test-driven-development-cs/_static/image13.png)</span></span>

<span data-ttu-id="e46bd-366">**図 07**: グループインデックスビュー ([フルサイズの画像を表示する をクリック](iteration-6-use-test-driven-development-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="e46bd-366">**Figure 07**: The Group Index view([Click to view full-size image](iteration-6-use-test-driven-development-cs/_static/image14.png))</span></span>

<span data-ttu-id="e46bd-367">連絡先グループを含むように、次の既存のビューを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e46bd-367">We need to modify the following existing views so that they include contact groups:</span></span>

- <span data-ttu-id="e46bd-368">ビュー\ホーム\作成.aspx</span><span class="sxs-lookup"><span data-stu-id="e46bd-368">Views\Home\Create.aspx</span></span>
- <span data-ttu-id="e46bd-369">ビュー\ホーム\編集.aspx</span><span class="sxs-lookup"><span data-stu-id="e46bd-369">Views\Home\Edit.aspx</span></span>
- <span data-ttu-id="e46bd-370">ビュー\ホーム\インデックス.aspx</span><span class="sxs-lookup"><span data-stu-id="e46bd-370">Views\Home\Index.aspx</span></span>

<span data-ttu-id="e46bd-371">このチュートリアルに付属する Visual Studio アプリケーションを見ると、変更されたビューを確認できます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-371">You can see the modified views by looking at the Visual Studio application that accompanies this tutorial.</span></span> <span data-ttu-id="e46bd-372">たとえば、図 8 は、連絡先インデックス ビューを示しています。</span><span class="sxs-lookup"><span data-stu-id="e46bd-372">For example, Figure 8 illustrates the Contact Index view.</span></span>

<span data-ttu-id="e46bd-373">[![連絡先インデックスビュー](iteration-6-use-test-driven-development-cs/_static/image8.jpg)](iteration-6-use-test-driven-development-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e46bd-373">[![The Contact Index view](iteration-6-use-test-driven-development-cs/_static/image8.jpg)](iteration-6-use-test-driven-development-cs/_static/image15.png)</span></span>

<span data-ttu-id="e46bd-374">**図 08**: 連絡先インデックス ビュー ([フルサイズの画像を表示する をクリック](iteration-6-use-test-driven-development-cs/_static/image16.png)します)</span><span class="sxs-lookup"><span data-stu-id="e46bd-374">**Figure 08**: The Contact Index view([Click to view full-size image](iteration-6-use-test-driven-development-cs/_static/image16.png))</span></span>

## <a name="summary"></a><span data-ttu-id="e46bd-375">まとめ</span><span class="sxs-lookup"><span data-stu-id="e46bd-375">Summary</span></span>

<span data-ttu-id="e46bd-376">このイテレーションでは、テスト駆動型開発アプリケーションの設計方法に従って、Contact Manager アプリケーションに新しい機能を追加しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-376">In this iteration, we added new functionality to our Contact Manager application by following a test-driven development application design methodology.</span></span> <span data-ttu-id="e46bd-377">まず、ユーザー ストーリーのセットを作成しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-377">We started by creating a set of user stories.</span></span> <span data-ttu-id="e46bd-378">ユーザー ストーリーによって表される要件に対応する単体テストのセットを作成しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-378">We created a set of unit tests that corresponds to the requirements expressed by the user stories.</span></span> <span data-ttu-id="e46bd-379">最後に、単体テストで表される要件を満たすだけのコードを記述しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-379">Finally, we wrote just enough code to satisfy the requirements expressed by the unit tests.</span></span>

<span data-ttu-id="e46bd-380">単体テストで表される要件を満たすだけのコードを記述し終えたら、データベースとビューを更新しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-380">After we finished writing enough code to satisfy the requirements expressed by the unit tests, we updated our database and views.</span></span> <span data-ttu-id="e46bd-381">新しいグループ テーブルをデータベースに追加し、エンティティ フレームワーク データ モデルを更新しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-381">We added a new Groups table to our database and updated our Entity Framework Data Model.</span></span> <span data-ttu-id="e46bd-382">また、ビューのセットを作成および変更しました。</span><span class="sxs-lookup"><span data-stu-id="e46bd-382">We also created and modified a set of views.</span></span>

<span data-ttu-id="e46bd-383">次のイテレーション (最終イテレーション) では、Ajax を利用するようにアプリケーションを書き直します。</span><span class="sxs-lookup"><span data-stu-id="e46bd-383">In the next iteration -- the final iteration -- we rewrite our application to take advantage of Ajax.</span></span> <span data-ttu-id="e46bd-384">Ajax を利用することで、Contact Manager アプリケーションの応答性とパフォーマンスを向上させます。</span><span class="sxs-lookup"><span data-stu-id="e46bd-384">By taking advantage of Ajax, we'll improve the responsiveness and performance of the Contact Manager application.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e46bd-385">[前へ](iteration-5-create-unit-tests-cs.md)
> [次へ](iteration-7-add-ajax-functionality-cs.md)</span><span class="sxs-lookup"><span data-stu-id="e46bd-385">[Previous](iteration-5-create-unit-tests-cs.md)
[Next](iteration-7-add-ajax-functionality-cs.md)</span></span>
