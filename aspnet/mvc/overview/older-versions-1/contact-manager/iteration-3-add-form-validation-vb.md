---
uid: mvc/overview/older-versions-1/contact-manager/iteration-3-add-form-validation-vb
title: 'イテレーション #3 – フォーム検証 (VB) の追加 |マイクロソフトドキュメント'
author: rick-anderson
description: 3 回目のイテレーションでは、基本的なフォーム検証を追加します。 必須のフォームフィールドに入力せずにフォームを送信できないようにします。 また、emai..
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 4805e75a-7911-46e3-b11b-229a6eed245e
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-3-add-form-validation-vb
msc.type: authoredcontent
ms.openlocfilehash: 3ee2f40996873a7af2eaa255edd5f157c3fefb29
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542392"
---
# <a name="iteration-3--add-form-validation-vb"></a>繰り返し #3 – フォーム検証を追加する (VB)

[マイクロソフト](https://github.com/microsoft)

[コードをダウンロード](iteration-3-add-form-validation-vb/_static/contactmanager_3_vb1.zip)

> 3 回目のイテレーションでは、基本的なフォーム検証を追加します。 必須のフォームフィールドに入力せずにフォームを送信できないようにします。 また、メールアドレスと電話番号も検証します。

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a>MVC アプリケーション (VB) ASP.NET連絡先管理の構築

この一連のチュートリアルでは、最初から最後まで連絡先管理アプリケーション全体を構築します。 連絡先マネージャー アプリケーションでは、連絡先の情報 (名前、電話番号、電子メール アドレス) を保存できます。

複数のイテレーションでアプリケーションをビルドします。 各反復処理で、アプリケーションを徐々に改善します。 この複数の反復アプローチの目的は、各変更の理由を理解できるようにすることです。

- イテレーション #1 - アプリケーションを作成します。 最初のイテレーションでは、できるだけ簡単な方法で連絡先マネージャーを作成します。 基本的なデータベース操作のサポートを追加: 作成、読み取り、更新、および削除 (CRUD) 。

- イテレーション #2 - アプリケーションを見栄えよくします。 このイテレーションでは、既定の ASP.NET MVC ビュー マスター ページとカスケード スタイル シートを変更することで、アプリケーションの外観を向上させます。

- イテレーション #3 - フォームの検証を追加します。 3 回目のイテレーションでは、基本的なフォーム検証を追加します。 必須のフォームフィールドに入力せずにフォームを送信できないようにします。 また、メールアドレスと電話番号も検証します。

- イテレーション #4 - アプリケーションを疎結合にします。 この 4 回目のイテレーションでは、いくつかのソフトウェア設計パターンを利用して、Contact Manager アプリケーションの保守と変更を容易にします。 たとえば、リポジトリ パターンと依存関係の挿入パターンを使用するようにアプリケーションをリファクタリングします。

- イテレーション #5 - 単体テストを作成します。 5 回目のイテレーションでは、単体テストを追加することで、アプリケーションの保守と変更を容易にします。 データ モデル クラスをモックし、コントローラーと検証ロジックの単体テストをビルドします。

- イテレーション #6 - テスト駆動型開発を使用します。 この 6 回目のイテレーションでは、単体テストを最初に記述し、単体テストに対してコードを記述することで、アプリケーションに新しい機能を追加します。 このイテレーションでは、連絡先グループを追加します。

- イテレーション #7 - Ajax 機能を追加します。 7 回目のイテレーションでは、Ajax のサポートを追加することで、アプリケーションの応答性とパフォーマンスを向上させます。

## <a name="this-iteration"></a>このイテレーション

連絡先マネージャー アプリケーションのこの 2 回目のイテレーションでは、基本的なフォーム検証を追加します。 必須フォームフィールドの値を入力せずに、連絡先を送信できないようにします。 電話番号と電子メール アドレスも検証します (図 1 参照)。

[![[New Project]\(新しいプロジェクト\) ダイアログ ボックス](iteration-3-add-form-validation-vb/_static/image1.jpg)](iteration-3-add-form-validation-vb/_static/image1.png)

**図 01**: 検証を行うフォーム ([フルサイズの画像を表示する をクリック](iteration-3-add-form-validation-vb/_static/image2.png)して )

このイテレーションでは、コント ローラー アクションに直接検証ロジックを追加します。 一般に、これはASP.NET MVC アプリケーションに検証を追加する推奨される方法ではありません。 アプリケーションの検証ロジックを別の[サービス層](http://martinfowler.com/eaaCatalog/serviceLayer.html)に配置する方が良い方法です。 次のイテレーションでは、アプリケーションをより保守しやすくするために、Contact Manager アプリケーションをリファクタリングします。

このイテレーションでは、単純な処理を行うために、すべての検証コードを手入力で記述します。 検証コードを自分で記述する代わりに、検証フレームワークを利用できます。 たとえば、Microsoft エンタープライズ ライブラリ検証アプリケーション ブロック (VAB) を使用して、ASP.NET MVC アプリケーションの検証ロジックを実装できます。 検証アプリケーション ブロックの詳細については、次の項目を参照してください。

[*http://msdn.microsoft.com/library/dd203099.aspx*](https://msdn.microsoft.com/library/dd203099.aspx)

## <a name="adding-validation-to-the-create-view"></a>作成ビューへの検証の追加

まず、検証ロジックを作成ビューに追加します。 さいわい、Visual Studio で作成ビューを生成したので、作成ビューには検証メッセージを表示するために必要なすべてのユーザー インターフェイス ロジックが既に含まれています。 作成ビューはリスト 1 に含まれています。

**リスト 1 - \ビュー\連絡先\作成.aspx**

[!code-aspx[Main](iteration-3-add-form-validation-vb/samples/sample1.aspx)]

フィールド検証エラー クラスは、Html.ValidationMessage() ヘルパーによってレンダリングされる出力のスタイルを設定するために使用されます。 入力検証エラー クラスは、Html.TextBox() ヘルパーによってレンダリングされるテキストボックス (入力) のスタイルを設定するために使用されます。 検証サマリー エラー クラスは、Html.ValidationSummary() ヘルパーによって表示される順序なしリストのスタイルを設定するために使用されます。

> [!NOTE] 
> 
> このセクションで説明するスタイル シート クラスを変更して、検証エラー メッセージの外観をカスタマイズできます。

## <a name="adding-validation-logic-to-the-create-action"></a>作成アクションへの検証ロジックの追加

現時点では、メッセージを生成するロジックを記述していないため、Create ビューに検証エラー メッセージが表示されることはありません。 検証エラー メッセージを表示するには、ModelState にエラー メッセージを追加する必要があります。

> [!NOTE] 
> 
> UpdateModel() メソッドは、フォーム フィールドの値をプロパティに割り当てる際にエラーが発生すると、ModelState にエラー メッセージを自動的に追加します。 たとえば、DateTime 値を受け取る誕生日プロパティに文字列 "apple" を割り当てようとすると、UpdateModel() メソッドはモデル状態にエラーを追加します。

リスト 2 で変更された Create() メソッドには、新しい連絡先がデータベースに挿入される前に、Contact クラスのプロパティを検証する新しいセクションが含まれています。

**リスト 2 - コント ローラー\連絡先コント ローラー.vb (検証を使用して作成)**

[!code-vb[Main](iteration-3-add-form-validation-vb/samples/sample2.vb)]

検証セクションでは、次の 4 つの異なる検証規則が適用されます。

- FirstName プロパティの長さは 0 より大きくする必要があります (スペースだけで構成することはできません)。
- LastName プロパティの長さが 0 より大きい必要があります (スペースだけで構成することはできません)。
- Phone プロパティに値が設定されている場合 (長さが 0 より大きい場合)、Phone プロパティは正規表現と一致する必要があります。
- Email プロパティに値 (長さが 0 より大きい値) がある場合、Email プロパティは正規表現と一致する必要があります。

検証規則違反がある場合は、エラー メッセージが追加されます、 AddModelError() メソッドの助けを借りて、 ModelState です。 ModelState にメッセージを追加する場合は、プロパティの名前と検証エラー メッセージのテキストを指定します。 このエラー メッセージは、ヘルパー メソッドによってビューに表示されます。

検証規則が実行された後、モデル状態の IsValid プロパティがチェックされます。 検証エラー メッセージが ModelState に追加された場合、IsValid プロパティは false を返します。 検証が失敗した場合、エラー メッセージと共に作成フォームが再表示されます。

> [!NOTE] 
> 
> 私は、正規表現リポジトリから電話番号とメールアドレスを検証するための正規表現を取得しました。[*http://regexlib.com*](http://regexlib.com)

## <a name="adding-validation-logic-to-the-edit-action"></a>編集アクションへの検証ロジックの追加

Edit() アクションは連絡先を更新します。 Edit() アクションは、Create() アクションとまったく同じ検証を実行する必要があります。 同じ検証コードを複製するのではなく、Create() アクションと Edit() アクションの両方が同じ検証メソッドを呼び出すように、連絡先コントローラーをリファクタリングする必要があります。

変更された連絡先コントローラー クラスは、リスト 3 に含まれています。 このクラスには、Create() アクションと Edit() アクションの両方で呼び出される新しい ValidateContact() メソッドがあります。

**リスト 3 - コントローラー\連絡先コントローラー.vb**

[!code-vb[Main](iteration-3-add-form-validation-vb/samples/sample3.vb)]

## <a name="summary"></a>まとめ

このイテレーションでは、連絡先マネージャー アプリケーションに基本的なフォーム検証を追加しました。 この検証ロジックにより、ユーザーは、FirstName プロパティと LastName プロパティに値を指定せずに、新しい連絡先を送信したり、既存の連絡先を編集したりできなくなります。 さらに、ユーザーは有効な電話番号と電子メールアドレスを入力する必要があります。

このイテレーションでは、可能な限り簡単な方法で、Contact Manager アプリケーションに検証ロジックを追加しました。 しかし、検証ロジックをコントローラロジックに組み込むと、長期的に問題が発生します。 アプリケーションは、時間の経過と同時に保守や変更が難しくなります。

次のイテレーションでは、検証ロジックとデータベース アクセス ロジックをコントローラからリファクタリングします。 いくつかのソフトウェア設計原則を活用して、より緩やかに結合され、保守性の高いアプリケーションを作成できるようにします。

> [!div class="step-by-step"]
> [前へ](iteration-2-make-the-application-look-nice-vb.md)
> [次へ](iteration-4-make-the-application-loosely-coupled-vb.md)
