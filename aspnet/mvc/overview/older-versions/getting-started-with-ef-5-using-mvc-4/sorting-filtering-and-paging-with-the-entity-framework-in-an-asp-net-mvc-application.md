---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application
title: ASP.NET MVC アプリケーションでの Entity Framework を使用した並べ替え、フィルター処理、およびページング (3/10) |Microsoft Docs
author: tdykstra
description: Contoso 大学のサンプル web アプリケーションでは、Entity Framework 5 Code First と Visual Studio を使用して ASP.NET MVC 4 アプリケーションを作成する方法を示しています。
ms.author: riande
ms.date: 07/30/2013
ms.assetid: 8af630e0-fffa-4110-9eca-c96e201b2724
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: b1ddb70805dcb07fb60eea895ff572c054bde5c6
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74595233"
---
# <a name="sorting-filtering-and-paging-with-the-entity-framework-in-an-aspnet-mvc-application-3-of-10"></a><span data-ttu-id="4ed2e-103">ASP.NET MVC アプリケーションでの Entity Framework を使用した並べ替え、フィルター処理、およびページング (3/10)</span><span class="sxs-lookup"><span data-stu-id="4ed2e-103">Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application (3 of 10)</span></span>

<span data-ttu-id="4ed2e-104">[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="4ed2e-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="4ed2e-105">完成したプロジェクトのダウンロード</span><span class="sxs-lookup"><span data-stu-id="4ed2e-105">Download Completed Project</span></span>](https://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="4ed2e-106">Contoso 大学のサンプル web アプリケーションは、Entity Framework 5 Code First と Visual Studio 2012 を使用して ASP.NET MVC 4 アプリケーションを作成する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="4ed2e-107">チュートリアル シリーズについては、[シリーズの最初のチュートリアル](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="4ed2e-108">チュートリアルシリーズは、最初から開始するか、[この章のスタートプロジェクトをダウンロード](building-the-ef5-mvc4-chapter-downloads.md)して開始することができます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="4ed2e-109">解決できない問題が発生した場合は、完成した[章をダウンロード](building-the-ef5-mvc4-chapter-downloads.md)し、問題の再現を試みてください。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="4ed2e-110">一般に、コードと完成したコードを比較することで、問題の解決策を見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="4ed2e-111">一般的なエラーとその解決方法については、「[エラーと回避策](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>

<span data-ttu-id="4ed2e-112">前のチュートリアルでは、`Student` エンティティに対する基本的な CRUD 操作用の一連の web ページを実装しています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-112">In the previous tutorial you implemented a set of web pages for basic CRUD operations for `Student` entities.</span></span> <span data-ttu-id="4ed2e-113">このチュートリアルでは、並べ替え、フィルター処理、およびページング機能を**Students**インデックスページに追加します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-113">In this tutorial you'll add sorting, filtering, and paging functionality to the **Students** Index page.</span></span> <span data-ttu-id="4ed2e-114">単純なグループ化を実行するページも作成します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-114">You'll also create a page that does simple grouping.</span></span>

<span data-ttu-id="4ed2e-115">次の図は、作業が終了したときにページがどのように表示されるかを示しています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-115">The following illustration shows what the page will look like when you're done.</span></span> <span data-ttu-id="4ed2e-116">列見出しとは、ユーザーがクリックしてその列で並べ替えを行うことができるリンクです。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-116">The column headings are links that the user can click to sort by that column.</span></span> <span data-ttu-id="4ed2e-117">列見出しを繰り返しクリックすると、昇順と降順の並べ替え順序が切り替えられます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-117">Clicking a column heading repeatedly toggles between ascending and descending sort order.</span></span>

![Students_Index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

## <a name="add-column-sort-links-to-the-students-index-page"></a><span data-ttu-id="4ed2e-119">Students インデックス ページに列の並べ替えリンクを追加する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-119">Add Column Sort Links to the Students Index Page</span></span>

<span data-ttu-id="4ed2e-120">学生用インデックスページに並べ替えを追加するには、`Student` コントローラーの `Index` メソッドを変更し、`Student` インデックスビューにコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-120">To add sorting to the Student Index page, you'll change the `Index` method of the `Student` controller and add code to the `Student` Index view.</span></span>

### <a name="add-sorting-functionality-to-the-index-method"></a><span data-ttu-id="4ed2e-121">Index メソッドに並べ替え機能を追加する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-121">Add Sorting Functionality to the Index Method</span></span>

<span data-ttu-id="4ed2e-122">*Controllers\StudentController.cs*で、`Index` メソッドを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-122">In *Controllers\StudentController.cs*, replace the `Index` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs)]

<span data-ttu-id="4ed2e-123">このコードは、URL 内の文字列から `sortOrder` パラメーターを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-123">This code receives a `sortOrder` parameter from the query string in the URL.</span></span> <span data-ttu-id="4ed2e-124">クエリ文字列値は、ASP.NET MVC によってアクションメソッドのパラメーターとして提供されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-124">The query string value is provided by ASP.NET MVC as a parameter to the action method.</span></span> <span data-ttu-id="4ed2e-125">パラメータは、"Name" または "Date" という文字列で、その後に必要に応じてアンダースコアと降順を指定する文字列 "desc" が続きます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-125">The parameter will be a string that's either "Name" or "Date", optionally followed by an underscore and the string "desc" to specify descending order.</span></span> <span data-ttu-id="4ed2e-126">既定の並べ替え順序は昇順です。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-126">The default sort order is ascending.</span></span>

<span data-ttu-id="4ed2e-127">インデックス ページが初めて要求されたときには、クエリ文字列はありません。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-127">The first time the Index page is requested, there's no query string.</span></span> <span data-ttu-id="4ed2e-128">学生は、`LastName`によって昇順に表示されます。これは、`switch` ステートメントのフォールスルーケースによって確立される既定の設定です。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-128">The students are displayed in ascending order by `LastName`, which is the default as established by the fall-through case in the `switch` statement.</span></span> <span data-ttu-id="4ed2e-129">ユーザーが列見出しハイパーリンクをクリックすると、適切な `sortOrder` 値がクエリ文字列で提供されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-129">When the user clicks a column heading hyperlink, the appropriate `sortOrder` value is provided in the query string.</span></span>

<span data-ttu-id="4ed2e-130">次の2つの `ViewBag` 変数を使用して、ビューが列見出しのハイパーリンクと適切なクエリ文字列値を構成できるようにします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-130">The two `ViewBag` variables are used so that the view can configure the column heading hyperlinks with the appropriate query string values:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="4ed2e-131">これらは、三項ステートメントです。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-131">These are ternary statements.</span></span> <span data-ttu-id="4ed2e-132">最初のパラメーターでは、`sortOrder` パラメーターが null または空の場合、`ViewBag.NameSortParm` を "name\_desc" に設定する必要があることを指定します。それ以外の場合は、空の文字列に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-132">The first one specifies that if the `sortOrder` parameter is null or empty, `ViewBag.NameSortParm` should be set to "name\_desc"; otherwise, it should be set to an empty string.</span></span> <span data-ttu-id="4ed2e-133">これらの 2 つのステートメントを使用して、次のようにビューで列見出しのハイパーリンクの設定することができます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-133">These two statements enable the view to set the column heading hyperlinks as follows:</span></span>

| <span data-ttu-id="4ed2e-134">既定の並べ替え順</span><span class="sxs-lookup"><span data-stu-id="4ed2e-134">Current sort order</span></span> | <span data-ttu-id="4ed2e-135">姓のハイパーリンク</span><span class="sxs-lookup"><span data-stu-id="4ed2e-135">Last Name Hyperlink</span></span> | <span data-ttu-id="4ed2e-136">日付のハイパーリンク</span><span class="sxs-lookup"><span data-stu-id="4ed2e-136">Date Hyperlink</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4ed2e-137">姓の昇順</span><span class="sxs-lookup"><span data-stu-id="4ed2e-137">Last Name ascending</span></span> | <span data-ttu-id="4ed2e-138">descending</span><span class="sxs-lookup"><span data-stu-id="4ed2e-138">descending</span></span> | <span data-ttu-id="4ed2e-139">ascending</span><span class="sxs-lookup"><span data-stu-id="4ed2e-139">ascending</span></span> |
| <span data-ttu-id="4ed2e-140">姓の降順</span><span class="sxs-lookup"><span data-stu-id="4ed2e-140">Last Name descending</span></span> | <span data-ttu-id="4ed2e-141">ascending</span><span class="sxs-lookup"><span data-stu-id="4ed2e-141">ascending</span></span> | <span data-ttu-id="4ed2e-142">ascending</span><span class="sxs-lookup"><span data-stu-id="4ed2e-142">ascending</span></span> |
| <span data-ttu-id="4ed2e-143">日付の昇順</span><span class="sxs-lookup"><span data-stu-id="4ed2e-143">Date ascending</span></span> | <span data-ttu-id="4ed2e-144">ascending</span><span class="sxs-lookup"><span data-stu-id="4ed2e-144">ascending</span></span> | <span data-ttu-id="4ed2e-145">descending</span><span class="sxs-lookup"><span data-stu-id="4ed2e-145">descending</span></span> |
| <span data-ttu-id="4ed2e-146">日付の降順</span><span class="sxs-lookup"><span data-stu-id="4ed2e-146">Date descending</span></span> | <span data-ttu-id="4ed2e-147">ascending</span><span class="sxs-lookup"><span data-stu-id="4ed2e-147">ascending</span></span> | <span data-ttu-id="4ed2e-148">ascending</span><span class="sxs-lookup"><span data-stu-id="4ed2e-148">ascending</span></span> |

<span data-ttu-id="4ed2e-149">このメソッドは[LINQ to Entities](https://msdn.microsoft.com/library/bb386964.aspx)を使用して、並べ替えの基準となる列を指定します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-149">The method uses [LINQ to Entities](https://msdn.microsoft.com/library/bb386964.aspx) to specify the column to sort by.</span></span> <span data-ttu-id="4ed2e-150">このコードは、`switch` ステートメントの前に[IQueryable](https://msdn.microsoft.com/library/bb351562.aspx)変数を作成し、`switch` ステートメントで変更し、`switch` ステートメントの後に `ToList` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-150">The code creates an [IQueryable](https://msdn.microsoft.com/library/bb351562.aspx) variable before the `switch` statement, modifies it in the `switch` statement, and calls the `ToList` method after the `switch` statement.</span></span> <span data-ttu-id="4ed2e-151">`IQueryable` 変数を作成および変更するときに、データベースに送信されるクエリはありません。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-151">When you create and modify `IQueryable` variables, no query is sent to the database.</span></span> <span data-ttu-id="4ed2e-152">`ToList`などのメソッドを呼び出すことによって `IQueryable` オブジェクトをコレクションに変換するまで、クエリは実行されません。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-152">The query is not executed until you convert the `IQueryable` object into a collection by calling a method such as `ToList`.</span></span> <span data-ttu-id="4ed2e-153">このため、このコードでは、`return View` ステートメントまで実行されない1つのクエリが生成されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-153">Therefore, this code results in a single query that is not executed until the `return View` statement.</span></span>

### <a name="add-column-heading-hyperlinks-to-the-student-index-view"></a><span data-ttu-id="4ed2e-154">列見出しのハイパーリンクを Student インデックスビューに追加する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-154">Add Column Heading Hyperlinks to the Student Index View</span></span>

<span data-ttu-id="4ed2e-155">*Views\Student\Index.cshtml*で、見出し行の `<tr>` と `<th>` の要素を、強調表示されたコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-155">In *Views\Student\Index.cshtml*, replace the `<tr>` and `<th>` elements for the heading row with the highlighted code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cshtml?highlight=5-15)]

<span data-ttu-id="4ed2e-156">このコードでは、`ViewBag` プロパティの情報を使用して、適切なクエリ文字列値を持つハイパーリンクを設定します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-156">This code uses the information in the `ViewBag` properties to set up hyperlinks with the appropriate query string values.</span></span>

<span data-ttu-id="4ed2e-157">ページを実行し、 **[Last Name]** と **[Enrollment Date]** 列見出しをクリックして、並べ替えが機能することを確認します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-157">Run the page and click the **Last Name** and **Enrollment Date** column headings to verify that sorting works.</span></span>

![Students_Index_page_with_sort_hyperlinks](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

<span data-ttu-id="4ed2e-159">**最後の名前**の見出しをクリックすると、学生が姓の降順で表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-159">After you click the **Last Name** heading, students are displayed in descending last name order.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

## <a name="add-a-search-box-to-the-students-index-page"></a><span data-ttu-id="4ed2e-160">Students インデックスページに検索ボックスを追加する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-160">Add a Search Box to the Students Index Page</span></span>

<span data-ttu-id="4ed2e-161">Students インデックス ページにフィルターを追加するには、テキスト ボックスと送信ボタンをビューに追加し、`Index` メソッドで対応する変更を行います。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-161">To add filtering to the Students Index page, you'll add a text box and a submit button to the view and make corresponding changes in the `Index` method.</span></span> <span data-ttu-id="4ed2e-162">テキスト ボックスを使用して、姓と名のフィールドに検索する文字列を入力できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-162">The text box will let you enter a string to search for in the first name and last name fields.</span></span>

### <a name="add-filtering-functionality-to-the-index-method"></a><span data-ttu-id="4ed2e-163">Index メソッドにフィルター機能を追加する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-163">Add Filtering Functionality to the Index Method</span></span>

<span data-ttu-id="4ed2e-164">*Controllers\StudentController.cs*で、`Index` メソッドを次のコードに置き換えます (変更は強調表示されています)。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-164">In *Controllers\StudentController.cs*, replace the `Index` method with the following code (the changes are highlighted):</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs?highlight=1,7-11)]

<span data-ttu-id="4ed2e-165">`searchString` パラメーターを `Index` メソッドに追加しました。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-165">You've added a `searchString` parameter to the `Index` method.</span></span> <span data-ttu-id="4ed2e-166">また、LINQ ステートメント `where` 句を追加しました。この句は、名または姓に検索文字列が含まれている学生だけを選択します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-166">You've also added to the LINQ statement a `where` clause that selects only students whose first name or last name contains the search string.</span></span> <span data-ttu-id="4ed2e-167">検索文字列の値は、インデックスビューに追加するテキストボックスから受け取ります。[Where](https://msdn.microsoft.com/library/bb535040.aspx)句を追加するステートメントは、検索する値がある場合にのみ実行されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-167">The search string value is received from a text box that you'll add to the Index view.The statement that adds the [where](https://msdn.microsoft.com/library/bb535040.aspx) clause is executed only if there's a value to search for.</span></span>

> [!NOTE]
> <span data-ttu-id="4ed2e-168">多くの場合、Entity Framework のエンティティセットまたはメモリ内のコレクションの拡張メソッドとして、同じメソッドを呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-168">In many cases you can call the same method either on an Entity Framework entity set or as an extension method on an in-memory collection.</span></span> <span data-ttu-id="4ed2e-169">通常、結果は同じですが、場合によっては異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-169">The results are normally the same but in some cases may be different.</span></span> <span data-ttu-id="4ed2e-170">たとえば、`Contains` メソッドの .NET Framework 実装では、空の文字列を渡すとすべての行が返されますが、SQL Server Compact 4.0 の Entity Framework プロバイダーは空の文字列に対して0行を返します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-170">For example, the .NET Framework implementation of the `Contains` method returns all rows when you pass an empty string to it, but the Entity Framework provider for SQL Server Compact 4.0 returns zero rows for empty strings.</span></span> <span data-ttu-id="4ed2e-171">したがって、この例のコード (`if` ステートメント内に `Where` ステートメントを記述する) を使用すると、すべてのバージョンの SQL Server に対して同じ結果が得られるようになります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-171">Therefore the code in the example (putting the `Where` statement inside an `if` statement) makes sure that you get the same results for all versions of SQL Server.</span></span> <span data-ttu-id="4ed2e-172">また、`Contains` メソッドの .NET Framework 実装では、既定で大文字と小文字を区別した比較が実行されますが、Entity Framework SQL Server プロバイダーは既定で大文字と小文字を区別しない比較を実行します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-172">Also, the .NET Framework implementation of the `Contains` method performs a case-sensitive comparison by default, but Entity Framework SQL Server providers perform case-insensitive comparisons by default.</span></span> <span data-ttu-id="4ed2e-173">したがって、`ToUpper` メソッドを呼び出してテストを明示的に大文字と小文字を区別しないようにすると、後でリポジトリを使用するようにコードを変更したときに結果が変更されないようにすることができます。これにより、`IQueryable` オブジェクトではなく `IEnumerable` コレクションが返されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-173">Therefore, calling the `ToUpper` method to make the test explicitly case-insensitive ensures that results do not change when you change the code later to use a repository, which will return an `IEnumerable` collection instead of an `IQueryable` object.</span></span> <span data-ttu-id="4ed2e-174">(`IEnumerable` コレクションに対して `Contains` メソッドを呼び出したときには、.NET Framework の実装を取得します。`IQueryable` オブジェクトに対して呼び出したときには、データベース プロバイダーの実装を取得します)。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-174">(When you call the `Contains` method on an `IEnumerable` collection, you get the .NET Framework implementation; when you call it on an `IQueryable` object, you get the database provider implementation.)</span></span>

### <a name="add-a-search-box-to-the-student-index-view"></a><span data-ttu-id="4ed2e-175">Students インデックス ビューに [検索] ボックスを追加する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-175">Add a Search Box to the Student Index View</span></span>

<span data-ttu-id="4ed2e-176">*Views\Student\Index.cshtml*で、キャプション、テキストボックス、および**検索**ボタンを作成するために、開始 `table` タグの直前に強調表示されているコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-176">In *Views\Student\Index.cshtml*, add the highlighted code immediately before the opening `table` tag in order to create a caption, a text box, and a **Search** button.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cshtml?highlight=5-10)]

<span data-ttu-id="4ed2e-177">ページを実行し、検索文字列を入力して **[検索]** をクリックし、フィルター処理が機能していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-177">Run the page, enter a search string, and click **Search** to verify that filtering is working.</span></span>

![Students_Index_page_with_search_box](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="4ed2e-179">URL に "an" という検索文字列が含まれていないことに注意してください。つまり、このページにブックマークを指定すると、ブックマークを使用するとフィルター処理された一覧が表示されません。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-179">Notice the URL doesn't contain the "an" search string, which means that if you bookmark this page, you won't get the filtered list when you use the bookmark.</span></span> <span data-ttu-id="4ed2e-180">このチュートリアルの後の方で、フィルター条件にクエリ文字列を使用するように **[検索]** ボタンを変更します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-180">You'll change the **Search** button to use query strings for filter criteria later in the tutorial.</span></span>

## <a name="add-paging-to-the-students-index-page"></a><span data-ttu-id="4ed2e-181">Students インデックスページにページングを追加する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-181">Add Paging to the Students Index Page</span></span>

<span data-ttu-id="4ed2e-182">Students インデックスページにページングを追加するには、まず**PagedList** NuGet パッケージをインストールします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-182">To add paging to the Students Index page, you'll start by installing the **PagedList.Mvc** NuGet package.</span></span> <span data-ttu-id="4ed2e-183">次に、`Index` メソッドに追加の変更を加え、ページングリンクを `Index` ビューに追加します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-183">Then you'll make additional changes in the `Index` method and add paging links to the `Index` view.</span></span> <span data-ttu-id="4ed2e-184">**PagedList**は、ASP.NET Mvc 用の多くの優れたページングおよび並べ替えパッケージの1つです。この使用方法は、他のオプションよりも推奨されるものではなく、例としてのみ使用することを目的としています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-184">**PagedList.Mvc** is one of many good paging and sorting packages for ASP.NET MVC, and its use here is intended only as an example, not as a recommendation for it over other options.</span></span> <span data-ttu-id="4ed2e-185">次の図は、ページングリンクを示しています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-185">The following illustration shows the paging links.</span></span>

![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image5.png)

### <a name="install-the-pagedlistmvc-nuget-package"></a><span data-ttu-id="4ed2e-187">PagedList NuGet パッケージをインストールする</span><span class="sxs-lookup"><span data-stu-id="4ed2e-187">Install the PagedList.MVC NuGet Package</span></span>

<span data-ttu-id="4ed2e-188">NuGet **PagedList**パッケージは、 **PagedList**パッケージを依存関係として自動的にインストールします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-188">The NuGet **PagedList.Mvc** package automatically installs the **PagedList** package as a dependency.</span></span> <span data-ttu-id="4ed2e-189">**PagedList**パッケージは `IQueryable` コレクションと `IEnumerable` コレクションの `PagedList` コレクション型および拡張メソッドをインストールします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-189">The **PagedList** package installs a `PagedList` collection type and extension methods for `IQueryable` and `IEnumerable` collections.</span></span> <span data-ttu-id="4ed2e-190">拡張メソッドは、`IQueryable` または `IEnumerable`から `PagedList` コレクション内の1ページのデータを作成します。 `PagedList` コレクションには、ページングを容易にするいくつかのプロパティとメソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-190">The extension methods create a single page of data in a `PagedList` collection out of your `IQueryable` or `IEnumerable`, and the `PagedList` collection provides several properties and methods that facilitate paging.</span></span> <span data-ttu-id="4ed2e-191">**PagedList**パッケージは、ページングボタンを表示するページングヘルパーをインストールします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-191">The **PagedList.Mvc** package installs a paging helper that displays the paging buttons.</span></span>

<span data-ttu-id="4ed2e-192">**[ツール]** メニューの **[nuget パッケージマネージャー]** を選択し、 **[ソリューションの nuget パッケージの管理]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-192">From the **Tools** menu, select **NuGet Package Manager** and then **Manage NuGet Packages for Solution**.</span></span>

<span data-ttu-id="4ed2e-193">**[NuGet パッケージの管理]** ダイアログボックスで、左側の **[オンライン]** タブをクリックし、検索ボックスに「ページ」と入力します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-193">In the **Manage NuGet Packages** dialog box, click the **Online** tab on the left and then enter "paged" in the search box.</span></span> <span data-ttu-id="4ed2e-194">**PagedList**パッケージが表示されたら、 **[インストール]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-194">When you see the **PagedList.Mvc** package, click **Install**.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="4ed2e-195">**[プロジェクトの選択]** ボックスで、[ **OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-195">In the **Select Projects** box, click **OK**.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image7.png)

### <a name="add-paging-functionality-to-the-index-method"></a><span data-ttu-id="4ed2e-196">Index メソッドにページング機能を追加する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-196">Add Paging Functionality to the Index Method</span></span>

<span data-ttu-id="4ed2e-197">*Controllers\StudentController.cs*で、`PagedList` 名前空間の `using` ステートメントを追加します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-197">In *Controllers\StudentController.cs*, add a `using` statement for the `PagedList` namespace:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="4ed2e-198">`Index` メソッドを次のコードで置き換えます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-198">Replace the `Index` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

<span data-ttu-id="4ed2e-199">次に示すように、このコードでは、`page` パラメーター、現在の並べ替え順序パラメーター、および現在のフィルターパラメーターをメソッドシグネチャに追加します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-199">This code adds a `page` parameter, a current sort order parameter, and a current filter parameter to the method signature, as shown here:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="4ed2e-200">最初にページが表示されるとき、またはユーザーがページングや並べ替えのリンクをクリックしていない場合、すべてのパラメーターは null になります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-200">The first time the page is displayed, or if the user hasn't clicked a paging or sorting link, all the parameters will be null.</span></span> <span data-ttu-id="4ed2e-201">ページングリンクがクリックされると、`page` 変数に表示するページ番号が含まれます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-201">If a paging link is clicked, the `page` variable will contain the page number to display.</span></span>

<span data-ttu-id="4ed2e-202">ページング中に並べ替え順序を維持するためにページングリンクに含める必要があるため、`A ViewBag` プロパティは現在の並べ替え順序でビューを提供します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-202">`A ViewBag` property provides the view with the current sort order, because this must be included in the paging links in order to keep the sort order the same while paging:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample9.cs)]

<span data-ttu-id="4ed2e-203">もう1つのプロパティである `ViewBag.CurrentFilter`は、現在のフィルター文字列を使用してビューを提供します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-203">Another property, `ViewBag.CurrentFilter`, provides the view with the current filter string.</span></span> <span data-ttu-id="4ed2e-204">ページング中にフィルターの設定を維持するために、ページングのリンクにこの値を含める必要があり、ページが再表示されるときに、この値をテキスト ボックスに復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-204">This value must be included in the paging links in order to maintain the filter settings during paging, and it must be restored to the text box when the page is redisplayed.</span></span> <span data-ttu-id="4ed2e-205">ページングの中に検索文字列を変更した場合は、新しいフィルターのために別のデータが表示されるため、ページを 1 にリセットする必要があります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-205">If the search string is changed during paging, the page has to be reset to 1, because the new filter can result in different data to display.</span></span> <span data-ttu-id="4ed2e-206">テキストボックスに値を入力し、[送信] ボタンを押すと、検索文字列が変更されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-206">The search string is changed when a value is entered in the text box and the submit button is pressed.</span></span> <span data-ttu-id="4ed2e-207">この場合、`searchString` パラメーターは null ではありません。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-207">In that case, the `searchString` parameter is not null.</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample10.cs)]

<span data-ttu-id="4ed2e-208">メソッドの末尾で、students `IQueryable` オブジェクトの `ToPagedList` 拡張メソッドは、ページングをサポートするコレクション型の生徒の1ページに学生クエリを変換します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-208">At the end of the method, the `ToPagedList` extension method on the students `IQueryable` object converts the student query to a single page of students in a collection type that supports paging.</span></span> <span data-ttu-id="4ed2e-209">これにより、学生の1つのページがビューに渡されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-209">That single page of students is then passed to the view:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample11.cs)]

<span data-ttu-id="4ed2e-210">`ToPagedList` メソッドは、ページ番号を受け取ります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-210">The `ToPagedList` method takes a page number.</span></span> <span data-ttu-id="4ed2e-211">2つの疑問符は、 [null 合体演算子](https://msdn.microsoft.com/library/ms173224.aspx)を表します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-211">The two question marks represent the [null-coalescing operator](https://msdn.microsoft.com/library/ms173224.aspx).</span></span> <span data-ttu-id="4ed2e-212">null 合体演算子は null 許容型の既定値を定義します。式 `(page ?? 1)` は、値がある場合は `page` の値を返し、`page` が null の場合は 1 を返すことを意味します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-212">The null-coalescing operator defines a default value for a nullable type; the expression `(page ?? 1)` means return the value of `page` if it has a value, or return 1 if `page` is null.</span></span>

### <a name="add-paging-links-to-the-student-index-view"></a><span data-ttu-id="4ed2e-213">Student インデックスビューにページングリンクを追加する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-213">Add Paging Links to the Student Index View</span></span>

<span data-ttu-id="4ed2e-214">*Views\Student\Index.cshtml*で、既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-214">In *Views\Student\Index.cshtml*, replace the existing code with the following code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample12.cshtml?highlight=6,9,14-20,56-58)]

<span data-ttu-id="4ed2e-215">ページの上部にある `@model` ステートメントは、ビューが `List` オブジェクトの代わりに `PagedList` オブジェクトを取得するようになったことを指定します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-215">The `@model` statement at the top of the page specifies that the view now gets a `PagedList` object instead of a `List` object.</span></span>

<span data-ttu-id="4ed2e-216">`PagedList.Mvc` の `using` ステートメントを使用すると、[ページング] ボタンの MVC ヘルパーにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-216">The `using` statement for `PagedList.Mvc` gives access to the MVC helper for the paging buttons.</span></span>

<span data-ttu-id="4ed2e-217">このコードでは、 [Beginform](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx)のオーバーロードを使用して、 [Formmethod. Get](https://msdn.microsoft.com/library/system.web.mvc.formmethod(v=vs.100).aspx/css)を指定できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-217">The code uses an overload of [BeginForm](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) that allows it to specify [FormMethod.Get](https://msdn.microsoft.com/library/system.web.mvc.formmethod(v=vs.100).aspx/css).</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample13.cshtml?highlight=1)]

<span data-ttu-id="4ed2e-218">既定の[Beginform](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx)は POST を使用してフォームデータを送信します。つまり、パラメーターは URL ではなく、クエリ文字列として渡されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-218">The default [BeginForm](https://msdn.microsoft.com/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) submits form data with a POST, which means that parameters are passed in the HTTP message body and not in the URL as query strings.</span></span> <span data-ttu-id="4ed2e-219">HTTP GET を指定すると、フォーム データがクエリ文字列として URL で渡され、ユーザーが URL をブックマークできるようになります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-219">When you specify HTTP GET, the form data is passed in the URL as query strings, which enables users to bookmark the URL.</span></span> <span data-ttu-id="4ed2e-220">[HTTP get を使用する場合の W3C ガイドライン](http://www.w3.org/2001/tag/doc/whenToUseGet.html)では、アクションによって更新が行われない場合に GET を使用する必要があることを指定しています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-220">The [W3C guidelines for the use of HTTP GET](http://www.w3.org/2001/tag/doc/whenToUseGet.html) specify that you should use GET when the action does not result in an update.</span></span>

<span data-ttu-id="4ed2e-221">テキストボックスは現在の検索文字列で初期化されるため、新しいページをクリックすると、現在の検索文字列を確認できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-221">The text box is initialized with the current search string so when you click a new page you can see the current search string.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample14.cshtml?highlight=1)]

<span data-ttu-id="4ed2e-222">列ヘッダーへのリンクは、フィルターの結果内でユーザーが並べ替えられるように、クエリ文字列を使用してコントローラーに現在の検索文字列を渡します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-222">The column header links use the query string to pass the current search string to the controller so that the user can sort within filter results:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample15.cshtml?highlight=1)]

<span data-ttu-id="4ed2e-223">現在のページとページの合計数が表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-223">The current page and total number of pages are displayed.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample16.cshtml)]

<span data-ttu-id="4ed2e-224">表示するページがない場合は、"Page 0 of 0" が表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-224">If there are no pages to display, "Page 0 of 0" is shown.</span></span> <span data-ttu-id="4ed2e-225">(この場合、ページ番号はページ数よりも大きくなります。 `Model.PageNumber` が1で、`Model.PageCount` が0であるためです)。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-225">(In that case the page number is greater than the page count because `Model.PageNumber` is 1, and `Model.PageCount` is 0.)</span></span>

<span data-ttu-id="4ed2e-226">ページングボタンは `PagedListPager` ヘルパーによって表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-226">The paging buttons are displayed by the `PagedListPager` helper:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample17.cshtml)]

<span data-ttu-id="4ed2e-227">`PagedListPager` helper には、Url やスタイルなど、カスタマイズできるさまざまなオプションが用意されています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-227">The `PagedListPager` helper provides a number of options that you can customize, including URLs and styling.</span></span> <span data-ttu-id="4ed2e-228">詳細については、GitHub サイトの「 [TroyGoode/PagedList](https://github.com/TroyGoode/PagedList) 」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-228">For more information, see [TroyGoode / PagedList](https://github.com/TroyGoode/PagedList) on the GitHub site.</span></span>

<span data-ttu-id="4ed2e-229">ページを実行します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-229">Run the page.</span></span>

![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image8.png)

<span data-ttu-id="4ed2e-231">異なる並べ替え順でページングのリンクをクリックし、ページングが機能することを確認します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-231">Click the paging links in different sort orders to make sure paging works.</span></span> <span data-ttu-id="4ed2e-232">その後で、検索文字列を入力して、ページングをもう一度試し、並べ替えとフィルター処理を使用してもページングが正しく機能することを確認します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-232">Then enter a search string and try paging again to verify that paging also works correctly with sorting and filtering.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image9.png)

## <a name="create-an-about-page-that-shows-student-statistics"></a><span data-ttu-id="4ed2e-233">学生の統計情報を表示する About ページを作成する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-233">Create an About Page That Shows Student Statistics</span></span>

<span data-ttu-id="4ed2e-234">Contoso 大学の web サイトの [About] ページには、登録日ごとに登録された学生の数が表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-234">For the Contoso University website's About page, you'll display how many students have enrolled for each enrollment date.</span></span> <span data-ttu-id="4ed2e-235">これには、グループ化とグループに関する簡単な計算が必要です。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-235">This requires grouping and simple calculations on the groups.</span></span> <span data-ttu-id="4ed2e-236">これを実行するためには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-236">To accomplish this, you'll do the following:</span></span>

- <span data-ttu-id="4ed2e-237">ビューに渡す必要があるデータのビュー モデル クラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-237">Create a view model class for the data that you need to pass to the view.</span></span>
- <span data-ttu-id="4ed2e-238">`Home` コントローラーの `About` メソッドを変更します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-238">Modify the `About` method in the `Home` controller.</span></span>
- <span data-ttu-id="4ed2e-239">`About` ビューを変更します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-239">Modify the `About` view.</span></span>

### <a name="create-the-view-model"></a><span data-ttu-id="4ed2e-240">ビューモデルを作成する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-240">Create the View Model</span></span>

<span data-ttu-id="4ed2e-241">*Viewmodel*フォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-241">Create a *ViewModels* folder.</span></span> <span data-ttu-id="4ed2e-242">そのフォルダーで、クラスファイル*EnrollmentDateGroup.cs*を追加し、既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-242">In that folder, add a class file *EnrollmentDateGroup.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample18.cs)]

### <a name="modify-the-home-controller"></a><span data-ttu-id="4ed2e-243">Home コントローラーを変更する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-243">Modify the Home Controller</span></span>

<span data-ttu-id="4ed2e-244">*HomeController.cs*で、ファイルの先頭に次の `using` ステートメントを追加します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-244">In *HomeController.cs*, add the following `using` statements at the top of the file:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample19.cs)]

<span data-ttu-id="4ed2e-245">クラスの左中かっこの直後に、データベースコンテキストのクラス変数を追加します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-245">Add a class variable for the database context immediately after the opening curly brace for the class:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample20.cs?highlight=3)]

<span data-ttu-id="4ed2e-246">`About` メソッドを次のコードで置き換えます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-246">Replace the `About` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample21.cs)]

<span data-ttu-id="4ed2e-247">LINQ ステートメントは、登録日で受講者エンティティをグループ化し、各グループ内のエンティティの数を計算して、結果を `EnrollmentDateGroup` ビュー モデル オブジェクトのコレクションに格納します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-247">The LINQ statement groups the student entities by enrollment date, calculates the number of entities in each group, and stores the results in a collection of `EnrollmentDateGroup` view model objects.</span></span>

<span data-ttu-id="4ed2e-248">`Dispose` メソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-248">Add a `Dispose` method:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample22.cs)]

### <a name="modify-the-about-view"></a><span data-ttu-id="4ed2e-249">About ビューを変更する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-249">Modify the About View</span></span>

<span data-ttu-id="4ed2e-250">*Views\Home\About.cshtml*ファイルのコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-250">Replace the code in the *Views\Home\About.cshtml* file with the following code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample23.cshtml)]

<span data-ttu-id="4ed2e-251">アプリを実行し、 **[バージョン情報]** リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-251">Run the app and click the **About** link.</span></span> <span data-ttu-id="4ed2e-252">登録の日付ごとの学生の数が、テーブルに表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-252">The count of students for each enrollment date is displayed in a table.</span></span>

![About_page](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

## <a name="optional-deploy-the-app-to-windows-azure"></a><span data-ttu-id="4ed2e-254">省略可能: Windows Azure にアプリを展開する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-254">Optional: Deploy the app to Windows Azure</span></span>

<span data-ttu-id="4ed2e-255">これまでは、アプリケーションは開発用コンピューターの IIS Express でローカルに実行されていました。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-255">So far your application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="4ed2e-256">他のユーザーがインターネット経由で使用できるようにするには、それを web ホスティングプロバイダーに展開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-256">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="4ed2e-257">このチュートリアルの省略可能なセクションでは、Windows Azure の Web サイトに展開します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-257">In this optional section of the tutorial you'll deploy it to a Windows Azure Web Site.</span></span>

### <a name="using-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="4ed2e-258">Code First Migrations を使用したデータベースの配置</span><span class="sxs-lookup"><span data-stu-id="4ed2e-258">Using Code First Migrations to Deploy the Database</span></span>

<span data-ttu-id="4ed2e-259">データベースを配置するには、Code First Migrations を使用します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-259">To deploy the database you'll use Code First Migrations.</span></span> <span data-ttu-id="4ed2e-260">Visual Studio からデプロイするための設定を構成するために使用する発行プロファイルを作成する場合は、 **[Execute Code First Migrations (アプリケーションの起動時に実行)]** というラベルのチェックボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-260">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box that is labeled **Execute Code First Migrations (runs on application start)**.</span></span> <span data-ttu-id="4ed2e-261">この設定により、配置プロセスでは、Code First が `MigrateDatabaseToLatestVersion` 初期化子クラスを使用するように、移行先サーバー上のアプリケーションの*web.config*ファイルが自動的に構成されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-261">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="4ed2e-262">Visual Studio は、配置プロセス中にデータベースに対して何も実行しません。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-262">Visual Studio does not do anything with the database during the deployment process.</span></span> <span data-ttu-id="4ed2e-263">配置後に配置されたアプリケーションがデータベースに初めてアクセスすると、Code First によってデータベースが自動的に作成されるか、データベーススキーマが最新バージョンに更新されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-263">When the deployed application accesses the database for the first time after deployment, Code First automatically creates the database or updates the database schema to the latest version.</span></span> <span data-ttu-id="4ed2e-264">アプリケーションが移行 `Seed` 方法を実装している場合、メソッドは、データベースが作成された後、またはスキーマが更新された後に実行されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-264">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="4ed2e-265">移行 `Seed` 方法によって、テストデータが挿入されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-265">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="4ed2e-266">運用環境に配置する場合は、実稼働データベースに挿入するデータのみが挿入されるように `Seed` 方法を変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-266">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="4ed2e-267">たとえば、現在のデータモデルでは、開発用データベースに架空のコースを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-267">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="4ed2e-268">`Seed` メソッドを作成して、両方の開発で読み込み、架空の学生をコメントアウトしてから、運用環境にデプロイすることができます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-268">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="4ed2e-269">または、`Seed` メソッドを記述してコースのみを読み込み、アプリケーションの UI を使用して、テストデータベースに架空の学生を手動で入力することもできます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-269">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-a-windows-azure-account"></a><span data-ttu-id="4ed2e-270">Windows Azure アカウントを取得する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-270">Get a Windows Azure account</span></span>

<span data-ttu-id="4ed2e-271">Windows Azure アカウントが必要です。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-271">You'll need a Windows Azure account.</span></span> <span data-ttu-id="4ed2e-272">まだお持ちでない場合は、無料試用版アカウントを数分で作成できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-272">If you don't already have one, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="4ed2e-273">詳細については、「 [Windows Azure 無料評価版](https://azure.microsoft.com/free/?WT.mc_id=A443DD604)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-273">For details, see [Windows Azure Free Trial](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-windows-azure"></a><span data-ttu-id="4ed2e-274">Windows Azure で web サイトと SQL データベースを作成する</span><span class="sxs-lookup"><span data-stu-id="4ed2e-274">Create a web site and a SQL database in Windows Azure</span></span>

<span data-ttu-id="4ed2e-275">Windows Azure の Web サイトは、共有ホスティング環境で実行されます。これは、他の Windows Azure クライアントと共有されている仮想マシン (Vm) 上で実行されることを意味します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-275">Your Windows Azure Web Site will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Windows Azure clients.</span></span> <span data-ttu-id="4ed2e-276">共有ホスティング環境は、クラウドでの使い始めるための低コストな方法です。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-276">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="4ed2e-277">その後、web トラフィックが増加した場合は、専用の Vm でを実行することで、ニーズに合わせてアプリケーションを拡張できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-277">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="4ed2e-278">より複雑なアーキテクチャが必要な場合は、Windows Azure クラウドサービスに移行できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-278">If you need a more complex architecture, you can migrate to a Windows Azure Cloud Service.</span></span> <span data-ttu-id="4ed2e-279">クラウドサービスは、必要に応じて構成できる専用 Vm 上で実行されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-279">Cloud services run on dedicated VMs that you can configure according to your needs.</span></span>

<span data-ttu-id="4ed2e-280">Windows Azure SQL Database は、SQL Server のテクノロジに基づいて構築されたクラウドベースのリレーショナルデータベースサービスです。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-280">Windows Azure SQL Database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="4ed2e-281">SQL Server と連携するツールとアプリケーションも SQL Database で動作します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-281">Tools and applications that work with SQL Server also work with SQL Database.</span></span>

1. <span data-ttu-id="4ed2e-282">[Windows Azure 管理ポータル](https://manage.windowsazure.com/)の左側のタブで **[Web サイト]** をクリックし、 **[新規]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-282">In the [Windows Azure Management Portal](https://manage.windowsazure.com/), click **Web Sites** in the left tab, and then click **New**.</span></span>

    ![管理ポータルの [新規] ボタン](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image11.png)
2. <span data-ttu-id="4ed2e-284">**[カスタム作成]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-284">Click **CUSTOM CREATE**.</span></span>

    ![管理ポータルでデータベースリンクを使用して作成する](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image12.png)

   <span data-ttu-id="4ed2e-286">**新しい Web サイト-カスタム作成**ウィザードが開きます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-286">The **New Web Site - Custom Create** wizard opens.</span></span>
3. <span data-ttu-id="4ed2e-287">ウィザードの **[新しい Web サイト]** ステップで、アプリケーションの一意の url として使用する文字列を **[URL]** ボックスに入力します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-287">In the **New Web Site** step of the wizard, enter a string in the **URL** box to use as the unique URL for your application.</span></span> <span data-ttu-id="4ed2e-288">完全な URL は、ここで入力した内容に、テキストボックスの横に表示されるサフィックスを加えたものになります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-288">The complete URL will consist of what you enter here plus the suffix that you see next to the text box.</span></span> <span data-ttu-id="4ed2e-289">この図には "ConU" が示されていますが、その URL は別のものを選択する必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-289">The illustration shows "ConU", but that URL is probably taken so you will have to choose a different one.</span></span>

    ![管理ポータルでデータベースリンクを使用して作成する](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image13.png)
4. <span data-ttu-id="4ed2e-291">**[リージョン]** ドロップダウンリストで、近くのリージョンを選択します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-291">In the **Region** drop-down list, choose a region close to you.</span></span> <span data-ttu-id="4ed2e-292">この設定では、web サイトが実行されるデータセンターを指定します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-292">This setting specifies which data center your web site will run in.</span></span>
5. <span data-ttu-id="4ed2e-293">**[データベース]** ボックスの一覧で、 **[無料の 20 MB の SQL データベースを作成する]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-293">In the **Database** drop-down list, choose **Create a free 20 MB SQL database**.</span></span>

    ![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image14.png)
6. <span data-ttu-id="4ed2e-294">**[DB 接続文字列名]** に「 *schoolcontext.cs*」と入力します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-294">In the **DB CONNECTION STRING NAME**, enter *SchoolContext*.</span></span>

    ![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image15.png)
7. <span data-ttu-id="4ed2e-295">ボックスの下部にある右矢印をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-295">Click the arrow that points to the right at the bottom of the box.</span></span> <span data-ttu-id="4ed2e-296">ウィザードの [データベースの**設定**] 手順に進みます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-296">The wizard advances to the **Database Settings** step.</span></span>
8. <span data-ttu-id="4ed2e-297">**[名前]** ボックスに、「コンテキストを指定する」と*入力します*。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-297">In the **Name** box, enter *ContosoUniversityDB*.</span></span>
9. <span data-ttu-id="4ed2e-298">**[サーバー]** ボックスで、 **[新しい SQL Database サーバー]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-298">In the **Server** box, select **New SQL Database server**.</span></span> <span data-ttu-id="4ed2e-299">または、サーバーを既に作成してある場合は、ドロップダウンリストからそのサーバーを選択できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-299">Alternatively, if you previously created a server, you can select that server from the drop-down list.</span></span>
10. <span data-ttu-id="4ed2e-300">管理者の**ログイン名**と**パスワード**を入力します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-300">Enter an administrator **LOGIN NAME** and **PASSWORD**.</span></span> <span data-ttu-id="4ed2e-301">**[新しい SQL Database サーバー]** を選択した場合は、ここで既存の名前とパスワードを入力していないので、後でデータベースにアクセスするときに使用する新しい名前とパスワードを入力します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-301">If you selected **New SQL Database server** you aren't entering an existing name and password here, you're entering a new name and password that you're defining now to use later when you access the database.</span></span> <span data-ttu-id="4ed2e-302">以前に作成したサーバーを選択した場合は、そのサーバーの資格情報を入力します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-302">If you selected a server that you created previously, you'll enter credentials for that server.</span></span> <span data-ttu-id="4ed2e-303">このチュートリアルでは、[***詳細設定***] チェックボックスはオンにしません。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-303">For this tutorial, you won't select the ***Advanced*** check box.</span></span> <span data-ttu-id="4ed2e-304">***[詳細***設定] オプションを使用すると、データベースの[照合順序](https://msdn.microsoft.com/library/aa174903(v=SQL.80).aspx)を設定できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-304">The ***Advanced*** options enable you to set the database [collation](https://msdn.microsoft.com/library/aa174903(v=SQL.80).aspx).</span></span>
11. <span data-ttu-id="4ed2e-305">Web サイト用に選択したものと同じ**リージョン**を選択します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-305">Choose the same **Region** that you chose for the web site.</span></span>
12. <span data-ttu-id="4ed2e-306">終了したことを示すには、ボックスの右下にあるチェックマークをクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-306">Click the check mark at the bottom right of the box to indicate that you're finished.</span></span>   
  
    ![新しい Web サイト-データベースを使用した作成ウィザードの [データベースの設定] 手順](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image16.png)  

    <span data-ttu-id="4ed2e-308">次の図は、既存の SQL Server とログインの使用方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-308">The following image shows using an existing SQL Server and Login.</span></span>   
  
    ![新しい Web サイト-データベースを使用した作成ウィザードの [データベースの設定] 手順](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image17.png)  
  
    <span data-ttu-id="4ed2e-310">管理ポータルが Web サイト ページに戻り、**状態** 列にサイトが作成されていることが示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-310">The Management Portal returns to the Web Sites page, and the **Status** column shows that the site is being created.</span></span> <span data-ttu-id="4ed2e-311">しばらくすると (通常は1分未満)、サイトが正常に作成されたことが **[状態]** 列に表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-311">After a while (typically less than a minute), the **Status** column shows that the site was successfully created.</span></span> <span data-ttu-id="4ed2e-312">左側のナビゲーションバーで、アカウント内のサイトの数**が [websites] アイコン**の横に表示され、 **[SQL データベース]** アイコンの横にデータベースの数が表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-312">In the navigation bar at the left, the number of sites you have in your account appears next to the **Web Sites** icon, and the number of databases appears next to the **SQL Databases** icon.</span></span>

## <a name="deploy-the-application-to-windows-azure"></a><span data-ttu-id="4ed2e-313">Windows Azure にアプリケーションをデプロイする</span><span class="sxs-lookup"><span data-stu-id="4ed2e-313">Deploy the application to Windows Azure</span></span>

1. <span data-ttu-id="4ed2e-314">Visual Studio で**ソリューションエクスプローラー**でプロジェクトを右クリックし、コンテキストメニューから **[発行]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-314">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>  
  
    ![プロジェクトのコンテキストメニューの [発行]](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image18.png)
2. <span data-ttu-id="4ed2e-316">**Web の発行**ウィザードの **[プロファイル]** タブで、 **[インポート]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-316">In the **Profile** tab of the **Publish Web** wizard, click **Import**.</span></span>  
  
    ![発行設定のインポート](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image19.png)
3. <span data-ttu-id="4ed2e-318">Visual Studio で Windows Azure サブスクリプションをまだ追加していない場合は、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-318">If you have not previously added your Windows Azure subscription in Visual Studio, perform the following steps.</span></span> <span data-ttu-id="4ed2e-319">この手順では、サブスクリプションを追加して、 **[Windows Azure web サイトからのインポート]** の下にあるドロップダウンリストに web サイトが含まれるようにします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-319">In these steps you add your subscription so that the drop-down list under **Import from a Windows Azure web site** will include your web site.</span></span>

    <span data-ttu-id="4ed2e-320">キーを押します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-320">a.</span></span> <span data-ttu-id="4ed2e-321">**[発行プロファイルのインポート]** ダイアログボックスで、 **[windows azure web サイトからのインポート]** をクリックし、 **[windows azure サブスクリプションの追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-321">In the **Import Publish Profile** dialog box, click **Import from a Windows Azure web site**, and then click **Add Windows Azure subscription**.</span></span>

    ![Windows Azure サブスクリプションの追加](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image20.png)

    <span data-ttu-id="4ed2e-323">b.</span><span class="sxs-lookup"><span data-stu-id="4ed2e-323">b.</span></span> <span data-ttu-id="4ed2e-324">**[Windows Azure サブスクリプションのインポート]** ダイアログボックスで、 **[サブスクリプションファイルのダウンロード]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-324">In the **Import Windows Azure Subscriptions** dialog box, click **Download subscription file**.</span></span>

    ![サブスクリプションファイルのダウンロード](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image21.png)

    <span data-ttu-id="4ed2e-326">c.</span><span class="sxs-lookup"><span data-stu-id="4ed2e-326">c.</span></span> <span data-ttu-id="4ed2e-327">ブラウザーウィンドウで、 *.publishsettings*ファイルを保存します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-327">In your browser window, save the *.publishsettings* file.</span></span>

    ![.publishsettings ファイルをダウンロードします。](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image22.png)

    > [!WARNING]
    > <span data-ttu-id="4ed2e-329">セキュリティ- *.publishsettings*ファイルには、Windows Azure のサブスクリプションとサービスの管理に使用される資格情報 (エンコードされていません) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-329">Security - The *publishsettings* file contains your credentials (unencoded) that are used to administer your Windows Azure subscriptions and services.</span></span> <span data-ttu-id="4ed2e-330">このファイルのセキュリティのベストプラクティスは、ソースディレクトリの外部 (たとえば、[*ライブラリ*] フォルダー内) に一時的に保存し、インポートが完了した後に削除することです。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-330">The security best practice for this file is to store it temporarily outside your source directories (for example in the *Libraries\Documents* folder), and then delete it once the import has completed.</span></span> <span data-ttu-id="4ed2e-331">悪意のあるユーザーが `.publishsettings` ファイルにアクセスすると、Windows Azure サービスを編集、作成、および削除できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-331">A malicious user who gains access to the `.publishsettings` file can edit, create, and delete your Windows Azure services.</span></span>

    <span data-ttu-id="4ed2e-332">d.</span><span class="sxs-lookup"><span data-stu-id="4ed2e-332">d.</span></span> <span data-ttu-id="4ed2e-333">**[Windows Azure サブスクリプションのインポート]** ダイアログボックスで **[参照]** をクリックし、 *.publishsettings*ファイルに移動します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-333">In the **Import Windows Azure Subscriptions** dialog box, click **Browse** and navigate to the *.publishsettings* file.</span></span>

    ![サブのダウンロード](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image23.png)

    <span data-ttu-id="4ed2e-335">e.</span><span class="sxs-lookup"><span data-stu-id="4ed2e-335">e.</span></span> <span data-ttu-id="4ed2e-336">**[インポート]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-336">Click **Import**.</span></span>

    ![取り込み](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image24.png)
4. <span data-ttu-id="4ed2e-338">**[発行プロファイルのインポート]** ダイアログボックスで、 **[Windows Azure Web サイトからインポートする]** を選択し、ドロップダウンリストから web サイトを選択して、[ **OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-338">In the **Import Publish Profile** dialog box, select **Import from a Windows Azure web site**, select your web site from the drop-down list, and then click **OK**.</span></span>  
  
    ![発行プロファイルのインポート](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image25.png)
5. <span data-ttu-id="4ed2e-340">**[接続]** タブで、 **[接続の検証]** をクリックして、設定が正しいことを確認します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-340">In the **Connection** tab, click **Validate Connection** to make sure that the settings are correct.</span></span>  
  
    ![接続の検証](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)
6. <span data-ttu-id="4ed2e-342">接続が検証されると、 **[接続の検証]** ボタンの横に緑色のチェックマークが表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-342">When the connection has been validated, a green check mark is shown next to the **Validate Connection** button.</span></span> <span data-ttu-id="4ed2e-343">[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-343">Click **Next**.</span></span>  
  
    ![接続が正常に検証されました](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image27.png)
7. <span data-ttu-id="4ed2e-345">**[Schoolcontext.cs]** の下の **[リモート接続文字列]** ドロップダウンリストを開き、作成したデータベースの接続文字列を選択します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-345">Open the **Remote connection string** drop-down list under **SchoolContext** and select the connection string for the database you created.</span></span>
8. <span data-ttu-id="4ed2e-346">**[Code First Migrations の実行 (アプリケーションの起動時に実行)]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-346">Select **Execute Code First Migrations (runs on application start)**.</span></span>
9. <span data-ttu-id="4ed2e-347">このアプリケーションではメンバーシップデータベースが使用されていないため、[UserContext の**実行時にこの接続文字列を使用する** **(defaultconnection)** ] チェックボックスをオフにします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-347">Uncheck **Use this connection string at runtime** for the **UserContext (DefaultConnection)**, since this application is not using the membership database.</span></span>   
  
    ![[設定] タブ](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image28.png)
10. <span data-ttu-id="4ed2e-349">[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-349">Click **Next**.</span></span>
11. <span data-ttu-id="4ed2e-350">**[プレビュー]** タブで、 **[プレビューの開始]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-350">In the **Preview** tab, click **Start Preview**.</span></span>  
  
    ![[プレビュー] タブの [StartPreview] ボタン](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image29.png)  
  
    <span data-ttu-id="4ed2e-352">このタブには、サーバーにコピーされるファイルの一覧が表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-352">The tab displays a list of the files that will be copied to the server.</span></span> <span data-ttu-id="4ed2e-353">アプリケーションの発行にはプレビューの表示は必要ありませんが、注意すべき便利な機能です。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-353">Displaying the preview isn't required to publish the application but is a useful function to be aware of.</span></span> <span data-ttu-id="4ed2e-354">この場合、表示されるファイルの一覧を使用して何もする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-354">In this case, you don't need to do anything with the list of files that is displayed.</span></span> <span data-ttu-id="4ed2e-355">次回このアプリケーションを展開するときに、変更されたファイルだけがこの一覧に表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-355">The next time you deploy this application, only the files that have changed will be in this list.</span></span>  
  
    ![StartPreview ファイルの出力](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image30.png)
12. <span data-ttu-id="4ed2e-357">**[発行]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-357">Click **Publish**.</span></span>  
    <span data-ttu-id="4ed2e-358">Visual Studio によって、ファイルを Windows Azure サーバーにコピーする処理が開始されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-358">Visual Studio begins the process of copying the files to the Windows Azure server.</span></span>
13. <span data-ttu-id="4ed2e-359">**[出力]** ウィンドウには、実行された配置アクションが表示され、デプロイが正常に完了したことがレポートされます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-359">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>  
  
    ![成功した配置を報告する出力ウィンドウ](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image31.png)
14. <span data-ttu-id="4ed2e-361">デプロイが成功すると、既定のブラウザーが自動的に開き、デプロイされた web サイトの URL が表示されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-361">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>  
    <span data-ttu-id="4ed2e-362">これで、作成したアプリケーションがクラウドで実行されます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-362">The application you created is now running in the cloud.</span></span> <span data-ttu-id="4ed2e-363">[Students] タブをクリックします。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-363">Click the Students tab.</span></span>  
  
    ![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image32.png)

<span data-ttu-id="4ed2e-365">この時点で、 **[Code First Migrations の実行 (アプリの起動時に実行)]** を選択したため、 *Schoolcontext.cs*データベースが Windows Azure SQL Database に作成されました。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-365">At this point your *SchoolContext* database has been created in the Windows Azure SQL Database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="4ed2e-366">デプロイされた web サイトの*web.config ファイルが*変更され、コードでデータベース内のデータの読み取りまたは書き込みが初めて実行されるようになりました ( **[Students]** タブを選択したときに[発生しまし](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx)た)。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-366">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer would run the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image33.png)

<span data-ttu-id="4ed2e-367">また、配置プロセスでは、データベーススキーマの更新とデータベースのシード処理に使用する Code First Migrations 用の新しい接続文字列 *(schoolcontext.cs\_DatabasePublish*) も作成されています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-367">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Database_Publish 接続文字列](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image34.png)

<span data-ttu-id="4ed2e-369">*Defaultconnection*接続文字列はメンバーシップデータベース用です (このチュートリアルでは使用しません)。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-369">The *DefaultConnection* connection string is for the membership database (which we are not using in this tutorial).</span></span> <span data-ttu-id="4ed2e-370">*Schoolcontext.cs*接続文字列は ContosoUniversity データベース用です。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-370">The *SchoolContext* connection string is for the ContosoUniversity database.</span></span>

<span data-ttu-id="4ed2e-371">配置された web.config ファイルのバージョンは、自分のコンピューターのユーザーのコンピューターに配置されていることがわかります。詳細については、 *「」を*参照してください。配置された*web.config*ファイル自体には、FTP を使用してアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-371">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="4ed2e-372">手順については、「 [ASP.NET Web Deployment Using Visual Studio: Code Update のデプロイ](../../../../web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-372">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](../../../../web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update.md).</span></span> <span data-ttu-id="4ed2e-373">「FTP ツールを使用するには」で始まる指示に従って、FTP URL、ユーザー名、およびパスワードの3つが必要になります。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-373">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="4ed2e-374">Web アプリはセキュリティを実装していないので、URL を見つけたすべてのユーザーがデータを変更できます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-374">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="4ed2e-375">Web サイトをセキュリティで保護する方法については、「 [Windows Azure の Web サイトにメンバーシップ、OAuth、および SQL Database を使用する secure ASP.NET MVC アプリをデプロイ](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-375">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL Database to a Windows Azure Web Site](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="4ed2e-376">Windows Azure 管理ポータルを使用するか、Visual Studio で**サーバーエクスプローラー**してサイトを停止することで、他のユーザーがサイトを使用できないようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-376">You can prevent other people from using the site by using the Windows Azure Management Portal or **Server Explorer** in Visual Studio to stop the site.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image35.png)

## <a name="code-first-initializers"></a><span data-ttu-id="4ed2e-377">Code First 初期化子</span><span class="sxs-lookup"><span data-stu-id="4ed2e-377">Code First Initializers</span></span>

<span data-ttu-id="4ed2e-378">[デプロイ] セクションでは、Migrateに使用されている、 [Migrateasetolatestversion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx)初期化子があることを確認しました。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-378">In the deployment section you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="4ed2e-379">Code First には、 [Createdatabaseifnotexists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (既定)、 [Dropcreatedatabaseifmodelchanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) 、 [dropcreatedatabasealways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx)など、使用できるその他の初期化子も用意されています。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-379">Code First also provides other initializers that you can use, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="4ed2e-380">`DropCreateAlways` 初期化子は、単体テストの条件を設定する場合に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-380">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="4ed2e-381">独自の初期化子を記述することもできます。また、アプリケーションがデータベースに対して読み取りまたは書き込みを行うまで待機しない場合は、初期化子を明示的に呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-381">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span> <span data-ttu-id="4ed2e-382">初期化子の包括的な説明については、「 [Entity Framework:](http://shop.oreilly.com/product/0636920022220.do)ジュリー Lerman と Rowan 明美による Code First」の「本プログラミングの第6章」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-382">For a comprehensive explanation of initializers, see chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="summary"></a><span data-ttu-id="4ed2e-383">要約</span><span class="sxs-lookup"><span data-stu-id="4ed2e-383">Summary</span></span>

<span data-ttu-id="4ed2e-384">このチュートリアルでは、データモデルを作成し、基本的な CRUD、並べ替え、フィルター処理、ページング、およびグループ化の機能を実装する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-384">In this tutorial you've seen how to create a data model and implement basic CRUD, sorting, filtering, paging, and grouping functionality.</span></span> <span data-ttu-id="4ed2e-385">次のチュートリアルでは、データモデルを拡張することで、さらに高度なトピックを見ていきます。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-385">In the next tutorial you'll begin looking at more advanced topics by expanding the data model.</span></span>

<span data-ttu-id="4ed2e-386">その他の Entity Framework リソースへのリンクについては、「 [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4ed2e-386">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4ed2e-387">[前へ](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application.md)
> [次へ](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)</span><span class="sxs-lookup"><span data-stu-id="4ed2e-387">[Previous](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application.md)
[Next](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)</span></span>
