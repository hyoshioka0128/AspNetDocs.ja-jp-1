---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
title: 障害に耐えられるように設計される (Azure を使用した実際のクラウドアプリの構築) |Microsoft Docs
author: MikeWasson
description: Azure 電子ブックを使用した実際のクラウドアプリの構築は、Scott Guthrie によって開発されたプレゼンテーションに基づいています。 13のパターンとベストプラクティスについて説明します。
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 364ce84e-5af8-4e08-afc9-75a512b01f84
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
msc.type: authoredcontent
ms.openlocfilehash: 348232af531b5d53dc3cb46d6d2c7931d95a572d
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457129"
---
# <a name="design-to-survive-failures-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="c85c9-104">障害に耐えられるように設計する (Azure を使用した実際のクラウドアプリの構築)</span><span class="sxs-lookup"><span data-stu-id="c85c9-104">Design to Survive Failures (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="c85c9-105">[Mike Wasson](https://github.com/MikeWasson)、 [Rick Anderson](https://twitter.com/RickAndMSFT)、 [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="c85c9-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://twitter.com/RickAndMSFT), [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="c85c9-106">[修正 It プロジェクトをダウンロード](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)するか[、電子書籍をダウンロード](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)します</span><span class="sxs-lookup"><span data-stu-id="c85c9-106">[Download Fix It Project](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) or [Download E-book](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span></span>

> <span data-ttu-id="c85c9-107">Azure 電子ブック**を使用した実際のクラウドアプリの構築**は、Scott Guthrie によって開発されたプレゼンテーションに基づいています。</span><span class="sxs-lookup"><span data-stu-id="c85c9-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="c85c9-108">ここでは、クラウド用の web アプリの開発を成功させるのに役立つ13のパターンとプラクティスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="c85c9-109">電子書籍の詳細については、[最初の章](introduction.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c85c9-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="c85c9-110">どのような種類のアプリケーションを構築する場合でも、特に、多くの人がそのアプリケーションを使用する場合は、アプリを設計して、エラーを適切に処理し、次のように価値を提供することができます。得る.</span><span class="sxs-lookup"><span data-stu-id="c85c9-110">One of the things you have to think about when you build any type of application, but especially one that will run in the cloud where lots of people will be using it, is how to design the app so that it can gracefully handle failures and continue to deliver value as much as possible.</span></span> <span data-ttu-id="c85c9-111">十分な時間があれば、環境やソフトウェアシステムによっては問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-111">Given enough time, things are going to go wrong in any environment or any software system.</span></span> <span data-ttu-id="c85c9-112">アプリでこのような状況がどのように処理されるかによって、顧客がどのように問題を分析して解決する必要があるかが決まります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-112">How your app handles those situations determines how upset your customers will get and how much time you have to spend analyzing and fixing problems.</span></span>

## <a name="types-of-failures"></a><span data-ttu-id="c85c9-113">エラーの種類</span><span class="sxs-lookup"><span data-stu-id="c85c9-113">Types of failures</span></span>

<span data-ttu-id="c85c9-114">処理するエラーには、次の2つの基本的なカテゴリがあります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-114">There are two basic categories of failures that you'll want to handle differently:</span></span>

- <span data-ttu-id="c85c9-115">断続的なネットワーク接続の問題など、一時的な自己復旧エラー。</span><span class="sxs-lookup"><span data-stu-id="c85c9-115">Transient, self-healing failures such as intermittent network connectivity issues.</span></span>
- <span data-ttu-id="c85c9-116">永続的による介入が必要なエラー。</span><span class="sxs-lookup"><span data-stu-id="c85c9-116">Enduring failures that require intervention.</span></span>

<span data-ttu-id="c85c9-117">一時的な障害については、再試行ポリシーを実装することで、アプリのほとんどの時間をすばやく自動的に復旧できます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-117">For transient failures, you can implement a retry policy to ensure that most of the time the app recovers quickly and automatically.</span></span> <span data-ttu-id="c85c9-118">お客様は、応答時間が少し長くなることがありますが、それ以外の場合は影響を受けません。</span><span class="sxs-lookup"><span data-stu-id="c85c9-118">Your customers might notice slightly longer response time, but otherwise they won't be affected.</span></span> <span data-ttu-id="c85c9-119">これらのエラーを処理する方法については、「一時的なエラー処理」の[章](transient-fault-handling.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c85c9-119">We'll show some ways to handle these errors in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

<span data-ttu-id="c85c9-120">永続的の障害については、問題が発生したときにすぐに通知する監視機能とログ機能を実装して、根本原因の分析を容易にすることができます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-120">For enduring failures, you can implement monitoring and logging functionality that notifies you promptly when issues arise and that facilitates root cause analysis.</span></span> <span data-ttu-id="c85c9-121">[監視とテレメトリ](monitoring-and-telemetry.md)に関する章で、この種のエラーを確認するためのいくつかの方法を紹介します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-121">We'll show some ways to help you stay on top of these kinds of errors in the [Monitoring and Telemetry chapter](monitoring-and-telemetry.md).</span></span>

## <a name="failure-scope"></a><span data-ttu-id="c85c9-122">エラーの範囲</span><span class="sxs-lookup"><span data-stu-id="c85c9-122">Failure scope</span></span>

<span data-ttu-id="c85c9-123">また、障害の範囲 (1 台のコンピューターに影響があるかどうか、SQL Database やストレージなどのサービス全体、またはリージョン全体を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-123">You also have to think about failure scope – whether a single machine is affected, a whole service such as SQL Database or Storage, or an entire region.</span></span>

![エラーの範囲](design-to-survive-failures/_static/image1.png)

### <a name="machine-failures"></a><span data-ttu-id="c85c9-125">コンピューターの障害</span><span class="sxs-lookup"><span data-stu-id="c85c9-125">Machine failures</span></span>

<span data-ttu-id="c85c9-126">Azure では、障害が発生したサーバーは自動的に新しいものに置き換えられ、適切に設計されたクラウドアプリは、この種の障害から自動的に迅速に復旧します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-126">In Azure, a failed server is automatically replaced by a new one, and a well-designed cloud app recovers from this kind of failure automatically and quickly.</span></span> <span data-ttu-id="c85c9-127">前述のように、ステートレスな web 層のスケーラビリティの利点は、状態のもう1つの利点として、障害が発生したサーバーからの回復が簡単です。</span><span class="sxs-lookup"><span data-stu-id="c85c9-127">Earlier we stressed the scalability benefits of a stateless web tier, and ease of recovery from a failed server is another benefit of statelessness.</span></span> <span data-ttu-id="c85c9-128">回復の容易さは、SQL Database や Azure App Service Web Apps など、サービスとしてのプラットフォーム (PaaS) 機能の利点の1つでもあります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-128">Ease of recovery is also one of the benefits of platform-as-a-service (PaaS) features such as SQL Database and Azure App Service Web Apps.</span></span> <span data-ttu-id="c85c9-129">ハードウェア障害はめったに発生しませんが、これらのサービスが発生すると自動的に処理されます。これらのサービスのいずれかを使用しているときに、コンピューターの障害を処理するコードを記述する必要もありません。</span><span class="sxs-lookup"><span data-stu-id="c85c9-129">Hardware failures are rare, but when they occur these services handle them automatically; you don't even have to write code to handle machine failures when you're using one of these services.</span></span>

### <a name="service-failures"></a><span data-ttu-id="c85c9-130">サービスエラー</span><span class="sxs-lookup"><span data-stu-id="c85c9-130">Service failures</span></span>

<span data-ttu-id="c85c9-131">クラウドアプリは、通常、複数のサービスを使用します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-131">Cloud apps typically use multiple services.</span></span> <span data-ttu-id="c85c9-132">たとえば、[It アプリの修正] を使用すると、SQL Database サービス、ストレージサービス、および web アプリが Azure App Service にデプロイされます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-132">For example, the Fix It app uses the SQL Database service, the Storage service, and the web app is deployed to Azure App Service.</span></span> <span data-ttu-id="c85c9-133">依存しているサービスの1つが失敗した場合、アプリはどうなりますか。</span><span class="sxs-lookup"><span data-stu-id="c85c9-133">What will your app do if one of the services you depend on fails?</span></span> <span data-ttu-id="c85c9-134">サービスエラーによっては、"申し訳ございません。後でもう一度やり直してください" というメッセージが表示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-134">For some service failures a friendly "sorry, try again later" message might be the best you can do.</span></span> <span data-ttu-id="c85c9-135">しかし、多くのシナリオでは、パフォーマンスを向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-135">But in many scenarios you can do better.</span></span> <span data-ttu-id="c85c9-136">たとえば、バックエンドのデータストアがダウンしている場合は、ユーザーの入力を受け入れ、"要求が受信されました" と表示して、入力場所を一時的に保存することができます。その後、必要なサービスが再び動作するようになったら、入力を取得して処理することができます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-136">For example, when your back-end data store is down, you can accept user input, display "your request has been received," and store the input someplace else temporarily; then when the service you need is operational again, you can retrieve the input and process it.</span></span>

<span data-ttu-id="c85c9-137">[キュー中心の作業パターン](queue-centric-work-pattern.md)の章では、このシナリオを処理する1つの方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="c85c9-137">The [Queue-centric Work Pattern](queue-centric-work-pattern.md) chapter shows one way to handle this scenario.</span></span> <span data-ttu-id="c85c9-138">Fix It app は SQL Database にタスクを保存しますが、SQL Database がダウンしているときは作業を終了する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="c85c9-138">The Fix It app stores tasks in SQL Database, but it doesn't have to quit working when SQL Database is down.</span></span> <span data-ttu-id="c85c9-139">この章では、タスクのユーザー入力をキューに格納し、ワーカープロセスを使用してキューを読み取り、タスクを更新する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-139">In that chapter we'll see how to store user input for a task in a queue, and use a worker process to read the queue and update the task.</span></span> <span data-ttu-id="c85c9-140">SQL がダウンしても、修正プログラムの It タスクを作成する機能に影響はありません。SQL Database が使用可能な場合、ワーカープロセスは新しいタスクを待機して処理できます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-140">If SQL is down, the ability to create Fix It tasks is unaffected; the worker process can wait and process new tasks when SQL Database is available.</span></span>

### <a name="region-failures"></a><span data-ttu-id="c85c9-141">リージョンの障害</span><span class="sxs-lookup"><span data-stu-id="c85c9-141">Region failures</span></span>

<span data-ttu-id="c85c9-142">リージョン全体で障害が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-142">Entire regions may fail.</span></span> <span data-ttu-id="c85c9-143">自然災害によってデータセンターが破壊される可能性があります。これは、meteor によってフラット化される可能性があります。データセンターへのトランク回線は、farmer によって急増しています。アプリが stricken データセンターでホストされている場合は、どうすればよいでしょうか。</span><span class="sxs-lookup"><span data-stu-id="c85c9-143">A natural disaster might destroy a data center, it might get flattened by a meteor, the trunk line into the datacenter could be cut by a farmer burying a cow with a backhoe, etc. If your app is hosted in the stricken datacenter what do you do?</span></span> <span data-ttu-id="c85c9-144">Azure でアプリを複数のリージョンで同時に実行するように設定することができます。これにより、障害が発生した場合でも、別のリージョンで実行し続けることができます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-144">It's possible to set up your app in Azure to run in multiple regions simultaneously so that if there's a disaster in one, you continue running in another region.</span></span> <span data-ttu-id="c85c9-145">このようなエラーは非常にまれであり、ほとんどのアプリは、この種の障害によってサービスが中断されないようにするために必要なやっかいを飛ばしません。</span><span class="sxs-lookup"><span data-stu-id="c85c9-145">Such failures are extremely rare occurrences, and most apps don't jump through the hoops necessary to ensure uninterrupted service through failures of this sort.</span></span> <span data-ttu-id="c85c9-146">リージョンで障害が発生してもアプリを使用できるようにする方法については、章の最後の「リソース」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c85c9-146">See the Resources section at the end of the chapter for information about how to keep your app available even through a region failure.</span></span>

<span data-ttu-id="c85c9-147">Azure の目標は、このようなすべてのエラーをより簡単に処理できるようにすることです。次の章では、その方法の例をいくつか紹介します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-147">A goal of Azure is to make handling all of these kinds of failures a lot easier, and you'll see some examples of how we're doing that in the following chapters.</span></span>

## <a name="slas"></a><span data-ttu-id="c85c9-148">SLA</span><span class="sxs-lookup"><span data-stu-id="c85c9-148">SLAs</span></span>

<span data-ttu-id="c85c9-149">多くの場合、クラウド環境でのサービスレベルアグリーメント (Sla) について話します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-149">People often hear about service-level agreements (SLAs) in the cloud environment.</span></span> <span data-ttu-id="c85c9-150">基本的に、これらは、企業がサービスの信頼性を確保することを約束します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-150">Basically these are promises that companies make about how reliable their service is.</span></span> <span data-ttu-id="c85c9-151">99.9% の SLA は、サービスが正常に動作していることを、99.9% の時間において期待する必要があることを意味します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-151">A 99.9% SLA means you should expect the service to be working correctly 99.9% of the time.</span></span> <span data-ttu-id="c85c9-152">これは SLA の非常に一般的な値であり、非常に高い数値のように聞こえますが、実際にどれだけダウンタイムが発生しているかわからない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-152">That's a fairly typical value for an SLA and it sounds like a very high number, but you might not realize how much down time .1% actually amounts to.</span></span> <span data-ttu-id="c85c9-153">次の表では、1年、1か月、および1週間にわたって、さまざまな SLA の割合がどの程度に増加しているかを示しています。</span><span class="sxs-lookup"><span data-stu-id="c85c9-153">Here's a table that shows how much downtime various SLA percentages amount to over a year, a month, and a week.</span></span>

![SLA テーブル](design-to-survive-failures/_static/image2.png)

<span data-ttu-id="c85c9-155">そのため、99.9% の SLA は、サービスが1年間または43.2 分のうちに8.76 時間ダウンする可能性があることを意味します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-155">So a 99.9% SLA means your service could be down 8.76 hours a year or 43.2 minutes a month.</span></span> <span data-ttu-id="c85c9-156">これは、ほとんどの方よりもダウンタイムが高くなります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-156">That's more down time than most people realize.</span></span> <span data-ttu-id="c85c9-157">開発者は、ある程度のダウンタイムが発生し、それを適切な方法で処理できることを知っておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-157">So as a developer you want to be aware that a certain amount of down time is possible and handle it in a graceful way.</span></span> <span data-ttu-id="c85c9-158">ある時点で、だれかがアプリを使用しようとしていて、サービスが停止しているときに、顧客に対する悪影響を最小限に抑えたいと考えています。</span><span class="sxs-lookup"><span data-stu-id="c85c9-158">At some point someone is going to be using your app, and a service is going to be down, and you want to minimize the negative impact of that on the customer.</span></span>

<span data-ttu-id="c85c9-159">SLA について理解しておくべき点の1つは、どのタイムフレームが参照するかということです。時計は毎週、毎月、または毎年リセットされますか。</span><span class="sxs-lookup"><span data-stu-id="c85c9-159">One thing you should know about an SLA is what time-frame it refers to: does the clock get reset every week, every month, or every year?</span></span> <span data-ttu-id="c85c9-160">Azure では、毎年の sla よりも月ごとに時計をリセットします。これは、毎年の SLA によって、一連の適切な月にその月がずれてしまう可能性があるためです。</span><span class="sxs-lookup"><span data-stu-id="c85c9-160">In Azure we reset the clock every month, which is better for you than a yearly SLA, since a yearly SLA could hide bad months by offsetting them with a series of good months.</span></span>

<span data-ttu-id="c85c9-161">もちろん、SLA よりも常に優れた目指しがあります。通常は、これよりもはるかに少なくなります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-161">Of course we always aspire to do better than the SLA; usually you'll be down much less than that.</span></span> <span data-ttu-id="c85c9-162">約束は、ダウンタイムの最大値よりも長い時間が経過すると、返金を求めることができるということです。</span><span class="sxs-lookup"><span data-stu-id="c85c9-162">The promise is that if we're ever down for longer than the maximum down time you can ask for money back.</span></span> <span data-ttu-id="c85c9-163">返される金額は、超過したダウンタイムのビジネスへの影響を完全に補正することはできませんが、SLA の側面は実施ポリシーとして機能し、非常に真剣であることを知ることができます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-163">The amount of money you get back probably wouldn't fully compensate you for the business impact of the excess down time, but that aspect of the SLA acts as an enforcement policy and lets you know that we do take it very seriously.</span></span>

### <a name="composite-slas"></a><span data-ttu-id="c85c9-164">複合 SLA</span><span class="sxs-lookup"><span data-stu-id="c85c9-164">Composite SLAs</span></span>

<span data-ttu-id="c85c9-165">Sla を検討する際に考慮すべき重要な点は、アプリで複数のサービスを使用することによる影響です。各サービスには個別の SLA があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-165">An important thing to think about when you're looking at SLAs is the impact of using multiple services in an app, with each service having a separate SLA.</span></span> <span data-ttu-id="c85c9-166">たとえば、It アプリの修正プログラムでは、Web Apps、Azure Storage、および SQL Database Azure App Service 使用します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-166">For example, the Fix It app uses Azure App Service Web Apps, Azure Storage, and SQL Database.</span></span> <span data-ttu-id="c85c9-167">次に示すのは、この電子書籍が2013年12月に作成された日からの SLA 番号です。</span><span class="sxs-lookup"><span data-stu-id="c85c9-167">Here are their SLA numbers as of the date this e-book is being written in December, 2013:</span></span>

![SLA Web サイト、ストレージ、SQL Database](design-to-survive-failures/_static/image3.png)

<span data-ttu-id="c85c9-169">これらのサービス Sla に基づいてアプリに期待される最大ダウンタイムは何ですか?</span><span class="sxs-lookup"><span data-stu-id="c85c9-169">What is the maximum down time you would expect for the app based on these service SLAs?</span></span> <span data-ttu-id="c85c9-170">ダウンタイムは、SLA の最低パーセント値、または99.9% の場合と同じであると考えられます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-170">You might think that your down time would be equal to the worst SLA percentage, or 99.9% in this case.</span></span> <span data-ttu-id="c85c9-171">これは、3つのサービスすべてが同時に失敗した場合にも当てはまりますが、実際には必ずしも失敗します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-171">That would be true if all three services always failed at the same time, but that isn't necessarily what actually happens.</span></span> <span data-ttu-id="c85c9-172">各サービスは異なるタイミングで個別に失敗する可能性があるため、個々の SLA 番号を乗算して複合 SLA を計算する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-172">Each service may fail independently at different times, so you have to calculate the composite SLA by multiplying the individual SLA numbers.</span></span>

![複合 SLA](design-to-survive-failures/_static/image4.png)

<span data-ttu-id="c85c9-174">そのため、アプリは1か月に43.2 分しかなく、1か月では108分、引き続き Azure SLA の制限内にある可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-174">So your app could be down not just 43.2 minutes a month but 3 times that amount, 108 minutes a month – and still be within the Azure SLA limits.</span></span>

<span data-ttu-id="c85c9-175">この問題は、Azure に固有のものではありません。</span><span class="sxs-lookup"><span data-stu-id="c85c9-175">This issue is not unique to Azure.</span></span> <span data-ttu-id="c85c9-176">実際には、利用可能なクラウドサービスの最高のクラウド Sla が提供されます。また、ベンダーのクラウドサービスを使用する場合は、同様の問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-176">We actually provide the best cloud SLAs of any cloud service available, and you'll have similar issues to deal with if you use any vendor's cloud services.</span></span> <span data-ttu-id="c85c9-177">ここでは、顧客またはユーザーに影響が及ぶ可能性が高いため、不可避のサービスエラーを適切に処理するようにアプリを設計する方法を検討することが重要です。</span><span class="sxs-lookup"><span data-stu-id="c85c9-177">What this highlights is the importance of thinking about how you can design your app to handle the inevitable service failures gracefully, because they might happen often enough to impact your customers or users.</span></span>

### <a name="cloud-slas-compared-to-enterprise-down-time-experience"></a><span data-ttu-id="c85c9-178">エンタープライズのダウンタイムエクスペリエンスと比較したクラウド Sla</span><span class="sxs-lookup"><span data-stu-id="c85c9-178">Cloud SLAs compared to enterprise down-time experience</span></span>

<span data-ttu-id="c85c9-179">"私のエンタープライズアプリでは、これらの問題は発生しません" ということがあります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-179">People sometimes say, "In my enterprise app I never have these problems."</span></span> <span data-ttu-id="c85c9-180">月のどれだけのダウンタイムが発生したかを確認すると、通常は "それはときどき発生します。" と言います。</span><span class="sxs-lookup"><span data-stu-id="c85c9-180">If you ask how much down time a month they actually have, they usually say, "Well, it happens occasionally."</span></span> <span data-ttu-id="c85c9-181">また、その頻度をたずねると、"新しいサーバーのバックアップまたはインストールやソフトウェアの更新が必要になることがあります" というメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-181">And if you ask how often, they admit that "Sometimes we do need to back up or install a new server or update software."</span></span> <span data-ttu-id="c85c9-182">もちろん、これはダウンタイムとしてカウントされます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-182">Of course, that counts as down time.</span></span> <span data-ttu-id="c85c9-183">特にミッションクリティカルでない限り、ほとんどのエンタープライズアプリは、サービスの Sla によって許容される時間を超えて実際にダウンします。</span><span class="sxs-lookup"><span data-stu-id="c85c9-183">Most enterprise apps unless they are especially mission-critical are actually down for more than the amount of time allowed by our service SLAs.</span></span> <span data-ttu-id="c85c9-184">しかし、お客様のサーバーとインフラストラクチャがあり、it 担当者が責任を持っている場合、ダウンタイムについての判断が少なくなる傾向があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-184">But when it's your server and your infrastructure and you're responsible for it and in control of it, you tend to feel less angst about down times.</span></span> <span data-ttu-id="c85c9-185">クラウド環境では、他のユーザーに依存しており、何が起こっているかがわかりません。そのため、心配が増える傾向があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-185">In a cloud environment you're dependent on someone else and you don't know what's going on, so you might tend to get more worried about it.</span></span>

<span data-ttu-id="c85c9-186">企業は、クラウドの SLA から得られるよりも長い時間の割合を達成すると、ハードウェアに対してはるかに多くの費用をかけて処理を行います。</span><span class="sxs-lookup"><span data-stu-id="c85c9-186">When an enterprise achieves a greater up-time percentage than you get from a cloud SLA, they do it by spending a lot more money on hardware.</span></span> <span data-ttu-id="c85c9-187">クラウドサービスはこれを行うことができますが、そのサービスに対してさらに多くの課金を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-187">A cloud service could do that but would have to charge much more for its services.</span></span> <span data-ttu-id="c85c9-188">代わりに、コスト効率に優れたサービスを利用し、ソフトウェアを設計して、避けられない障害によって顧客の中断が最小限に抑えられるようにします。</span><span class="sxs-lookup"><span data-stu-id="c85c9-188">Instead, you take advantage of a cost-effective service and design your software so that the inevitable failures cause minimum disruption to your customers.</span></span> <span data-ttu-id="c85c9-189">クラウドアプリデザイナーとしてのジョブは、障害を回避するためにはあまり多くありません。これは、ハードウェアではなく、ソフトウェアに焦点を当てることによって行われます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-189">Your job as a cloud app designer is not so much to avoid failure as to avoid catastrophe, and you do that by focusing on software, not on hardware.</span></span> <span data-ttu-id="c85c9-190">エンタープライズアプリでは、障害が発生するまでの平均時間を最大化することに努めていますが、クラウドアプリは回復の平均時間を最小限に抑えるよう努めています</span><span class="sxs-lookup"><span data-stu-id="c85c9-190">Whereas enterprise apps strive to maximize mean time between failures, cloud apps strive to minimize mean time to recover.</span></span>

### <a name="not-all-cloud-services-have-slas"></a><span data-ttu-id="c85c9-191">すべてのクラウドサービスに Sla があるわけではありません</span><span class="sxs-lookup"><span data-stu-id="c85c9-191">Not all cloud services have SLAs</span></span>

<span data-ttu-id="c85c9-192">また、すべてのクラウドサービスに SLA があるわけではないことにも注意してください。</span><span class="sxs-lookup"><span data-stu-id="c85c9-192">Be aware also that not every cloud service even has an SLA.</span></span> <span data-ttu-id="c85c9-193">アプリがサービスに依存していて、時間の保証がない場合は、想像以上に長くなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-193">If your app is dependent on a service with no up-time guarantee, you could be down far longer than you might imagine.</span></span> <span data-ttu-id="c85c9-194">たとえば、Facebook や Twitter などのソーシャルプロバイダーを使用してサイトへのログインを有効にした場合は、サービスプロバイダーに確認して SLA があるかどうかを確認し、存在しないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-194">For example, if you enable log-in to your site using a social provider such as Facebook or Twitter, check with the service provider to find out if there is an SLA, and you might find out there isn't one.</span></span> <span data-ttu-id="c85c9-195">ただし、認証サービスがダウンした場合、または認証サービスがスローした要求の量をサポートできない場合、顧客はアプリからロックアウトされます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-195">But if the authentication service goes down or is unable to support the volume of requests you throw at it, your customers are locked out of your app.</span></span> <span data-ttu-id="c85c9-196">数日またはそれ以上の時間がかかる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-196">You could be down for days or longer.</span></span> <span data-ttu-id="c85c9-197">1つの新しいアプリの作成者は、何百ものダウンロードを必要とし、Facebook 認証に依存していましたが、そのサービスに対する SLA がないということがわかったので、Facebook とは通信しませんでした。</span><span class="sxs-lookup"><span data-stu-id="c85c9-197">The creators of one new app expected hundreds of millions of downloads and took a dependency on Facebook authentication – but didn't talk to Facebook before going live and discovered too late that there was no SLA for that service.</span></span>

### <a name="not-all-downtime-counts-toward-slas"></a><span data-ttu-id="c85c9-198">すべてのダウンタイムが Sla に対してカウントされない</span><span class="sxs-lookup"><span data-stu-id="c85c9-198">Not all downtime counts toward SLAs</span></span>

<span data-ttu-id="c85c9-199">一部のクラウドサービスは、アプリで過剰に使用されている場合にサービスを意図的に拒否することがあります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-199">Some cloud services may deliberately deny service if your app over-uses them.</span></span> <span data-ttu-id="c85c9-200">これは "*調整*" と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-200">This is called *throttling*.</span></span> <span data-ttu-id="c85c9-201">サービスに SLA が適用されている場合は、調整される可能性がある条件を指定する必要があります。また、アプリの設計では、これらの条件を回避し、発生した場合に調整に適切に対応する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-201">If a service has an SLA, it should state the conditions under which you might be throttled, and your app design should avoid those conditions and react appropriately to the throttling if it happens.</span></span> <span data-ttu-id="c85c9-202">たとえば、1秒あたりに特定の数を超えたときにサービスへの要求が失敗し始めた場合、自動再試行が行われないようにして、調整が続行されるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-202">For example, if requests to a service start to fail when you exceed a certain number per second, you want to make sure automatic retries don't happen so fast that they cause the throttling to continue.</span></span> <span data-ttu-id="c85c9-203">[一時的なエラー処理の章](transient-fault-handling.md)では、スロットルについてさらに説明します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-203">We'll have more to say about throttling in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

## <a name="summary"></a><span data-ttu-id="c85c9-204">要約</span><span class="sxs-lookup"><span data-stu-id="c85c9-204">Summary</span></span>

<span data-ttu-id="c85c9-205">この章では、障害を適切に維持するために、実際のクラウドアプリを設計する必要がある理由について説明しました。</span><span class="sxs-lookup"><span data-stu-id="c85c9-205">This chapter has tried to help you realize why a real world cloud app has to be designed to survive failures gracefully.</span></span> <span data-ttu-id="c85c9-206">[次の章](monitoring-and-telemetry.md)から、このシリーズの残りのパターンは、そのために使用できるいくつかの方法についてさらに詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-206">Starting with the [next chapter](monitoring-and-telemetry.md), the remaining patterns in this series go into more detail about some strategies you can use to do that:</span></span>

- <span data-ttu-id="c85c9-207">適切な[監視とテレメトリ](monitoring-and-telemetry.md)を用意することで、介入が必要な障害について迅速に把握し、問題を解決するのに十分な情報が得られます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-207">Have good [monitoring and telemetry](monitoring-and-telemetry.md), so that you find out quickly about failures that require intervention, and you have sufficient information to resolve them.</span></span>
- <span data-ttu-id="c85c9-208">インテリジェントな再試行ロジックを実装することによって[一時的なエラーを処理](transient-fault-handling.md)します。これにより、アプリは、できないときに自動的に復旧され、[サーキットブレーカー](transient-fault-handling.md#circuitbreakers)ロジックにフォールバックできます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-208">[Handle transient faults](transient-fault-handling.md) by implementing intelligent retry logic, so that your app recovers automatically when it can and falls back to [circuit breaker](transient-fault-handling.md#circuitbreakers) logic when it can't.</span></span>
- <span data-ttu-id="c85c9-209">[分散キャッシュ](distributed-caching.md)を使用すると、データベースアクセスのスループット、待機時間、および接続の問題を最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-209">Use [distributed caching](distributed-caching.md) in order to minimize throughput, latency, and connection problems with database access.</span></span>
- <span data-ttu-id="c85c9-210">[キュー中心の作業パターン](queue-centric-work-pattern.md)を介して疎結合を実装します。これにより、バックエンドがダウンしてもアプリのフロントエンドが引き続き動作するようになります。</span><span class="sxs-lookup"><span data-stu-id="c85c9-210">Implement loose coupling via the [queue-centric work pattern](queue-centric-work-pattern.md), so that your app front end can continue to work when the back end is down.</span></span>

## <a name="resources"></a><span data-ttu-id="c85c9-211">リソース</span><span class="sxs-lookup"><span data-stu-id="c85c9-211">Resources</span></span>

<span data-ttu-id="c85c9-212">詳細については、この電子ブックの後の章と次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c85c9-212">For more information, see later chapters in this e-book and the following resources.</span></span>

<span data-ttu-id="c85c9-213">ドキュメント:</span><span class="sxs-lookup"><span data-stu-id="c85c9-213">Documentation:</span></span>

- <span data-ttu-id="c85c9-214">[フェイルセーフ: 回復力のあるクラウドアーキテクチャに関するガイダンス](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-214">[Failsafe: Guidance for Resilient Cloud Architectures](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx).</span></span> <span data-ttu-id="c85c9-215">ホワイトペーパー (Marc Mercuri、Ulrich Homann、Andrew Townhill)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-215">White paper by Marc Mercuri, Ulrich Homann, and Andrew Townhill.</span></span> <span data-ttu-id="c85c9-216">フェールセーフビデオシリーズの Web ページバージョン。</span><span class="sxs-lookup"><span data-stu-id="c85c9-216">Web page version of the FailSafe video series.</span></span>
- <span data-ttu-id="c85c9-217">[Azure Cloud Services で大規模なサービスを設計するためのベストプラクティス](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-217">[Best Practices for the Design of Large-Scale Services on Azure Cloud Services](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx).</span></span> <span data-ttu-id="c85c9-218">マーク Simm と Michael Thomassy によるホワイトペーパー。</span><span class="sxs-lookup"><span data-stu-id="c85c9-218">White paper by Mark Simms and Michael Thomassy.</span></span>
- <span data-ttu-id="c85c9-219">[Azure のビジネス継続性に関する技術ガイダンス](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-219">[Azure Business Continuity Technical Guidance](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx).</span></span> <span data-ttu-id="c85c9-220">ホワイトペーパー (パトリック Wickline と Jason Roth)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-220">White paper by Patrick Wickline and Jason Roth.</span></span>
- <span data-ttu-id="c85c9-221">[Azure アプリケーションのディザスターリカバリーと高可用性](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-221">[Disaster Recovery and High Availability for Azure Applications](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx).</span></span> <span data-ttu-id="c85c9-222">Michael McKeown、Jason、Roth、およびその他のホワイトペーパー。</span><span class="sxs-lookup"><span data-stu-id="c85c9-222">White paper by Michael McKeown, Hanu Kommalapati, and Jason Roth.</span></span>
- <span data-ttu-id="c85c9-223">[Microsoft のパターンとプラクティス-Azure のガイダンス](https://msdn.microsoft.com/library/dn568099.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-223">[Microsoft Patterns and Practices - Azure Guidance](https://msdn.microsoft.com/library/dn568099.aspx).</span></span> <span data-ttu-id="c85c9-224">「マルチデータセンターのデプロイに関するガイダンス」、「サーキットブレーカーパターン」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c85c9-224">See Multi Data Center Deployment guidance, Circuit breaker pattern.</span></span>
- <span data-ttu-id="c85c9-225">[Azure サポート-サービスレベルアグリーメント](https://azure.microsoft.com/support/legal/sla/)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-225">[Azure Support - Service Level Agreements](https://azure.microsoft.com/support/legal/sla/).</span></span>
- <span data-ttu-id="c85c9-226">[Azure SQL Database でのビジネス継続性](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-226">[Business Continuity in Azure SQL Database](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx).</span></span> <span data-ttu-id="c85c9-227">SQL Database の高可用性とディザスターリカバリーの機能について説明します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-227">Documentation about SQL Database high availability and disaster recovery features.</span></span>
- <span data-ttu-id="c85c9-228">[Azure Virtual Machines での SQL Server の高可用性とディザスターリカバリー](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-228">[High Availability and Disaster Recovery for SQL Server in Azure Virtual Machines](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx).</span></span>

<span data-ttu-id="c85c9-229">ビデオ:</span><span class="sxs-lookup"><span data-stu-id="c85c9-229">Videos:</span></span>

- <span data-ttu-id="c85c9-230">[フェイルセーフ: スケーラブルで回復力のある Cloud Services を構築](https://channel9.msdn.com/Series/FailSafe)します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-230">[FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe).</span></span> <span data-ttu-id="c85c9-231">Ulrich Homann、Marc Mercuri、Mark Simm による9パートシリーズ。</span><span class="sxs-lookup"><span data-stu-id="c85c9-231">Nine-part series by Ulrich Homann, Marc Mercuri, and Mark Simms.</span></span> <span data-ttu-id="c85c9-232">高度な概念とアーキテクチャの原則を、非常にアクセスしやすく興味深い方法で紹介します。実際の顧客との Microsoft カスタマーアドバイザリチーム (CAT) エクスペリエンスによってストーリーが描画されます。</span><span class="sxs-lookup"><span data-stu-id="c85c9-232">Presents high-level concepts and architectural principles in a very accessible and interesting way, with stories drawn from Microsoft Customer Advisory Team (CAT) experience with actual customers.</span></span> <span data-ttu-id="c85c9-233">エピソード1と8では、障害が発生しないようにクラウドアプリを設計する理由について詳しく取り上げています。</span><span class="sxs-lookup"><span data-stu-id="c85c9-233">Episodes 1 and 8 go in depth into the reasons for designing cloud apps to survive failures.</span></span> <span data-ttu-id="c85c9-234">また、49:57 以降のエピソード2でのスロットルに関するフォローアップの説明、56:05 から始まるエピソード2の障害点と障害モードの説明、およびエピソード3の40:55 におけるサーキットブレーカーの説明も参照してください。</span><span class="sxs-lookup"><span data-stu-id="c85c9-234">See also the follow-up discussion of throttling in episode 2 starting at 49:57, the discussion of failure points and failure modes in episode 2 starting at 56:05, and the discussion of circuit breakers in episode 3 starting at 40:55.</span></span>
- <span data-ttu-id="c85c9-235">[大規模な構築: Azure のお客様から学んだ教訓-パート II](https://channel9.msdn.com/Events/Build/2012/3-030)。</span><span class="sxs-lookup"><span data-stu-id="c85c9-235">[Building Big: Lessons learned from Azure customers - Part II](https://channel9.msdn.com/Events/Build/2012/3-030).</span></span> <span data-ttu-id="c85c9-236">Simm マークは、エラーの設計とすべてのインストルメント化について話します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-236">Mark Simms talks about designing for failure and instrumenting everything.</span></span> <span data-ttu-id="c85c9-237">フェイルセーフシリーズに似ていますが、さらに詳細な方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c85c9-237">Similar to the Failsafe series but goes into more how-to details.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c85c9-238">[前へ](unstructured-blob-storage.md)
> [次へ](monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="c85c9-238">[Previous](unstructured-blob-storage.md)
[Next](monitoring-and-telemetry.md)</span></span>
