---
uid: web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
title: ロールの作成と管理 (VB) |Microsoft Docs
author: rick-anderson
description: このチュートリアルでは、ロールフレームワークを構成するために必要な手順について説明します。 ここでは、ロールを作成および削除するための web ページを作成します。
ms.author: riande
ms.date: 03/24/2008
ms.assetid: 83af9f5f-9a00-4f83-8afc-e98bdd49014e
msc.legacyurl: /web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
msc.type: authoredcontent
ms.openlocfilehash: 825e2afb750925637d308b7ceb35e1b02b708c1d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74586267"
---
# <a name="creating-and-managing-roles-vb"></a><span data-ttu-id="c7599-104">ロールを作成し、管理する (VB)</span><span class="sxs-lookup"><span data-stu-id="c7599-104">Creating and Managing Roles (VB)</span></span>

<span data-ttu-id="c7599-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c7599-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c7599-106">[コードのダウンロード](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip)または[PDF のダウンロード](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="c7599-106">[Download Code](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip) or [Download PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span></span>

> <span data-ttu-id="c7599-107">このチュートリアルでは、ロールフレームワークを構成するために必要な手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="c7599-107">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="c7599-108">ここでは、ロールを作成および削除するための web ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="c7599-108">Following that, we will build web pages to create and delete roles.</span></span>

## <a name="introduction"></a><span data-ttu-id="c7599-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="c7599-109">Introduction</span></span>

<span data-ttu-id="c7599-110"><a id="_msoanchor_1"> </a>[*ユーザーベースの承認*](../membership/user-based-authorization-vb.md)に関するチュートリアルでは、URL 承認を使用して、ページのセットから特定のユーザーを制限する方法について説明しました。また、訪問しているユーザーに基づいて ASP.NET ページの機能を調整するための宣言型およびプログラム的な手法についても説明しました。</span><span class="sxs-lookup"><span data-stu-id="c7599-110">In the <a id="_msoanchor_1"></a>[*User-Based Authorization*](../membership/user-based-authorization-vb.md) tutorial we looked at using URL authorization to restrict certain users from a set of pages and explored declarative and programmatic techniques for adjusting an ASP.NET page's functionality based on the visiting user.</span></span> <span data-ttu-id="c7599-111">ただし、ユーザーごとにページアクセスまたは機能に対するアクセス許可を付与すると、ユーザーアカウントが多数存在する場合や、ユーザーの特権が頻繁に変更された場合に、メンテナンスが困難になることがあります。</span><span class="sxs-lookup"><span data-stu-id="c7599-111">Granting permission for page access or functionality on a user-by-user basis, however, can become a maintenance nightmare in scenarios where there are many user accounts or when users' privileges change often.</span></span> <span data-ttu-id="c7599-112">ユーザーが特定のタスクを実行するための承認を取得したり、許可を失ったりするたびに、管理者は適切な URL 承認規則、宣言型マークアップ、およびコードを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-112">Any time a user gains or loses authorization to perform a particular task, the administrator needs to update the appropriate URL authorization rules, declarative markup, and code.</span></span>

<span data-ttu-id="c7599-113">これは通常、ユーザーをグループまたは*ロール*に分類し、ロールごとにアクセス許可を適用するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c7599-113">It usually helps to classify users into groups or *roles* and then to apply permissions on a role-by-role basis.</span></span> <span data-ttu-id="c7599-114">たとえば、ほとんどの web アプリケーションには、管理ユーザー専用に予約されている特定のページまたはタスクのセットがあります。</span><span class="sxs-lookup"><span data-stu-id="c7599-114">For example, most web applications have a certain set of pages or tasks that are reserved only for administrative users.</span></span> <span data-ttu-id="c7599-115">*ユーザーベースの承認*のチュートリアルで学習した手法を使用して、適切な URL 承認規則、宣言型マークアップ、およびコードを追加して、指定したユーザーアカウントが管理タスクを実行できるようにします。</span><span class="sxs-lookup"><span data-stu-id="c7599-115">Using the techniques learned in the *User-Based Authorization* tutorial, we would add the appropriate URL authorization rules, declarative markup, and code to allow the specified user accounts to perform administrative tasks.</span></span> <span data-ttu-id="c7599-116">ただし、新しい管理者が追加された場合、または既存の管理者が自分の管理権限を取り消す必要がある場合は、構成ファイルと web ページを戻って更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-116">But if a new administrator was added or if an existing administrator needed to have her administration rights revoked, we would have to return and update the configuration files and web pages.</span></span> <span data-ttu-id="c7599-117">ただし、ロールを使用すると、Administrators というロールを作成し、それらの信頼されたユーザーを管理者ロールに割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="c7599-117">With roles, however, we could create a role called Administrators and assign those trusted users to the Administrators role.</span></span> <span data-ttu-id="c7599-118">次に、適切な URL 承認規則、宣言型マークアップ、およびコードを追加して、管理者ロールがさまざまな管理タスクを実行できるようにします。</span><span class="sxs-lookup"><span data-stu-id="c7599-118">Next, we would add the appropriate URL authorization rules, declarative markup, and code to allow the Administrators role to perform the various administrative tasks.</span></span> <span data-ttu-id="c7599-119">このインフラストラクチャが整備されていれば、新しい管理者をサイトに追加したり、既存の管理者を削除したりするだけで、管理者ロールのユーザーを追加したり削除したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="c7599-119">With this infrastructure in place, adding new administrators to the site or removing existing ones is as simple as including or removing the user from the Administrators role.</span></span> <span data-ttu-id="c7599-120">構成、宣言型のマークアップ、またはコードの変更は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="c7599-120">No configuration, declarative markup, or code changes are necessary.</span></span>

<span data-ttu-id="c7599-121">ASP.NET には、ロールを定義し、それらをユーザーアカウントに関連付けるためのロールフレームワークが用意されています。</span><span class="sxs-lookup"><span data-stu-id="c7599-121">ASP.NET offers a Roles framework for defining roles and associating them with user accounts.</span></span> <span data-ttu-id="c7599-122">ロールフレームワークを使用すると、ロールの作成と削除、ロールに対するユーザーの追加または削除、特定のロールに属するユーザーのセットの特定、およびユーザーが特定のロールに属しているかどうかの確認を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="c7599-122">With the Roles framework we can create and delete roles, add users to or remove users from a role, determine the set of users that belong to a particular role, and tell whether a user belongs to a particular role.</span></span> <span data-ttu-id="c7599-123">ロールフレームワークを構成したら、URL 承認規則によってロールごとのページへのアクセスを制限し、現在ログオンしているユーザーのロールに基づいてページの追加情報や機能を表示または非表示にすることができます。</span><span class="sxs-lookup"><span data-stu-id="c7599-123">Once the Roles framework has been configured, we can limit access to pages on a role-by-role basis through URL authorization rules and show or hide additional information or functionality on a page based on the currently logged on user's roles.</span></span>

<span data-ttu-id="c7599-124">このチュートリアルでは、ロールフレームワークを構成するために必要な手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="c7599-124">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="c7599-125">ここでは、ロールを作成および削除するための web ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="c7599-125">Following that, we will build web pages to create and delete roles.</span></span> <span data-ttu-id="c7599-126"><a id="_msoanchor_2"> </a>[*ユーザーへのロールの割り当て*](assigning-roles-to-users-vb.md)に関するチュートリアルでは、ロールのユーザーを追加および削除する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c7599-126">In the <a id="_msoanchor_2"></a>[*Assigning Roles to Users*](assigning-roles-to-users-vb.md) tutorial we will look at how to add and remove users from roles.</span></span> <span data-ttu-id="c7599-127">ロールベースの<a id="_msoanchor_3"> </a>[*承認*](role-based-authorization-vb.md)のチュートリアルでは、ロールごとのページへのアクセスを制限する方法に加えて、訪問ユーザーのロールに応じてページの機能を調整する方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="c7599-127">And in the <a id="_msoanchor_3"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will see how to limit access to pages on a role-by-role basis along with how to adjust page functionality depending on the visiting user's role.</span></span> <span data-ttu-id="c7599-128">では、始めましょう。</span><span class="sxs-lookup"><span data-stu-id="c7599-128">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="c7599-129">手順 1: 新しい ASP.NET ページを追加する</span><span class="sxs-lookup"><span data-stu-id="c7599-129">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="c7599-130">このチュートリアルと次の2つでは、さまざまなロールに関連する関数と機能を調べます。</span><span class="sxs-lookup"><span data-stu-id="c7599-130">In this tutorial and the next two we will be examining various roles-related functions and capabilities.</span></span> <span data-ttu-id="c7599-131">これらのチュートリアル全体で検討したトピックを実装するには、一連の ASP.NET ページが必要です。</span><span class="sxs-lookup"><span data-stu-id="c7599-131">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="c7599-132">これらのページを作成し、サイトマップを更新してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c7599-132">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="c7599-133">まず、`Roles`という名前のプロジェクトに新しいフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="c7599-133">Start by creating a new folder in the project named `Roles`.</span></span> <span data-ttu-id="c7599-134">次に、4つの新しい ASP.NET ページを `Roles` フォルダーに追加し、各ページを `Site.master` マスターページとリンクします。</span><span class="sxs-lookup"><span data-stu-id="c7599-134">Next, add four new ASP.NET pages to the `Roles` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="c7599-135">ページに名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="c7599-135">Name the pages:</span></span>

- `ManageRoles.aspx`
- `UsersAndRoles.aspx`
- `CreateUserWizardWithRoles.aspx`
- `RoleBasedAuthorization.aspx`

<span data-ttu-id="c7599-136">この時点で、プロジェクトのソリューションエクスプローラーは、図1に示すスクリーンショットのようになります。</span><span class="sxs-lookup"><span data-stu-id="c7599-136">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>

<span data-ttu-id="c7599-137">[![4 つの新しいページが Roles フォルダーに追加されました](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c7599-137">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span></span>

<span data-ttu-id="c7599-138">**図 1**: `Roles` フォルダーに4つの新しいページが追加されました ([クリックしてフルサイズの画像を表示](creating-and-managing-roles-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="c7599-138">**Figure 1**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image3.png))</span></span>

<span data-ttu-id="c7599-139">各ページには、この時点で2つのコンテンツコントロールが含まれている必要があります。1つは、`MainContent` と `LoginContent`の各マスターページの ContentPlaceHolders です。</span><span class="sxs-lookup"><span data-stu-id="c7599-139">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample1.aspx)]

<span data-ttu-id="c7599-140">`LoginContent` ContentPlaceHolder の既定のマークアップによって、ユーザーが認証されているかどうかに応じて、サイトへのログオンまたはログオフを行うためのリンクが表示されることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="c7599-140">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="c7599-141">ただし、ASP.NET ページの `Content2` コンテンツコントロールの存在は、マスターページの既定のマークアップよりも優先されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-141">The presence of the `Content2` Content control in the ASP.NET page, however, overrides the master page's default markup.</span></span> <span data-ttu-id="c7599-142"><a id="_msoanchor_4"> </a> [ *「フォーム認証チュートリアルの概要*](../introduction/an-overview-of-forms-authentication-vb.md)」で説明したように、既定のマークアップのオーバーライドは、ログイン関連のオプションを左の列に表示しないページで役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c7599-142">As we discussed in <a id="_msoanchor_4"></a>[*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, overriding the default markup is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="c7599-143">ただし、この4つのページでは、`LoginContent` ContentPlaceHolder のマスターページの既定のマークアップを表示します。</span><span class="sxs-lookup"><span data-stu-id="c7599-143">For these four pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="c7599-144">そのため、`Content2` コンテンツコントロールの宣言型マークアップを削除します。</span><span class="sxs-lookup"><span data-stu-id="c7599-144">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="c7599-145">その後、4ページの各マークアップには、コンテンツコントロールを1つだけ含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-145">After doing so, each of the four page's markup should contain just one Content control.</span></span>

<span data-ttu-id="c7599-146">最後に、サイトマップ (`Web.sitemap`) を更新して、これらの新しい web ページを追加してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c7599-146">Finally, let's update the site map (`Web.sitemap`) to include these new web pages.</span></span> <span data-ttu-id="c7599-147">メンバーシップのチュートリアル用に追加した `<siteMapNode>` の後に、次の XML を追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-147">Add the following XML after the `<siteMapNode>` we added for the Membership tutorials.</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample2.xml)]

<span data-ttu-id="c7599-148">サイトマップが更新されたら、ブラウザーを使用してサイトにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="c7599-148">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="c7599-149">図2に示すように、左側のナビゲーションには、ロールのチュートリアルの項目が含まれています。</span><span class="sxs-lookup"><span data-stu-id="c7599-149">As Figure 2 shows, the navigation on the left now includes items for the Roles tutorials.</span></span>

<span data-ttu-id="c7599-150">[![4 つの新しいページが Roles フォルダーに追加されました](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c7599-150">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span></span>

<span data-ttu-id="c7599-151">**図 2**: `Roles` フォルダーに4つの新しいページが追加されました ([クリックしてフルサイズの画像を表示](creating-and-managing-roles-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c7599-151">**Figure 2**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image6.png))</span></span>

## <a name="step-2-specifying-and-configuring-the-roles-framework-provider"></a><span data-ttu-id="c7599-152">手順 2: Roles Framework プロバイダーの指定と構成</span><span class="sxs-lookup"><span data-stu-id="c7599-152">Step 2: Specifying and Configuring the Roles Framework Provider</span></span>

<span data-ttu-id="c7599-153">メンバーシップフレームワークと同様に、ロールフレームワークはプロバイダーモデルの上に構築されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-153">Like the Membership framework, the Roles framework is built atop the provider model.</span></span> <span data-ttu-id="c7599-154"><a id="_msoanchor_5"> </a>[*セキュリティの基本と ASP.NET のサポート*](../introduction/security-basics-and-asp-net-support-vb.md)のチュートリアルで説明したように、.NET Framework には、 [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx)、 [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx)、および[`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx)の3つの組み込みのロールプロバイダーが付属しています。</span><span class="sxs-lookup"><span data-stu-id="c7599-154">As discussed in the <a id="_msoanchor_5"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-vb.md) tutorial, the .NET Framework ships with three built-in Roles providers: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx), and [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span></span> <span data-ttu-id="c7599-155">このチュートリアルシリーズでは、ロールストアとして Microsoft SQL Server データベースを使用する `SqlRoleProvider`について説明します。</span><span class="sxs-lookup"><span data-stu-id="c7599-155">This tutorial series focuses on the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span>

<span data-ttu-id="c7599-156">の下には、ロールフレームワークと `SqlRoleProvider` が含まれており、メンバーシップフレームワークや `SqlMembershipProvider`と同じように動作します。</span><span class="sxs-lookup"><span data-stu-id="c7599-156">Underneath the covers the Roles framework and `SqlRoleProvider` work just like the Membership framework and `SqlMembershipProvider`.</span></span> <span data-ttu-id="c7599-157">.NET Framework には、ロールフレームワークの API として機能する `Roles` クラスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="c7599-157">The .NET Framework contains a `Roles` class that serves as the API to the Roles framework.</span></span> <span data-ttu-id="c7599-158">`Roles` クラスには、`CreateRole`、`DeleteRole`、`GetAllRoles`、`AddUserToRole`、`IsUserInRole`などの共有メソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="c7599-158">The `Roles` class has shared methods like `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, and so forth.</span></span> <span data-ttu-id="c7599-159">これらのメソッドのいずれかが呼び出されると、`Roles` クラスによって、構成されたプロバイダーへの呼び出しがデリゲートされます。</span><span class="sxs-lookup"><span data-stu-id="c7599-159">When one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="c7599-160">`SqlRoleProvider` は、応答でロール固有のテーブル (`aspnet_Roles` と `aspnet_UsersInRoles`) と連携します。</span><span class="sxs-lookup"><span data-stu-id="c7599-160">The `SqlRoleProvider` works with the role-specific tables (`aspnet_Roles` and `aspnet_UsersInRoles`) in response.</span></span>

<span data-ttu-id="c7599-161">アプリケーションで `SqlRoleProvider` プロバイダーを使用するには、ストアとして使用するデータベースを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-161">In order to use the `SqlRoleProvider` provider in our application, we need to specify what database to use as the store.</span></span> <span data-ttu-id="c7599-162">`SqlRoleProvider` では、指定されたロールストアに特定のデータベーステーブル、ビュー、およびストアドプロシージャが含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-162">The `SqlRoleProvider` expects the specified role store to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="c7599-163">これらの必要なデータベースオブジェクトは、 [`aspnet_regsql.exe` ツール](https://msdn.microsoft.com/library/ms229862.aspx)を使用して追加できます。</span><span class="sxs-lookup"><span data-stu-id="c7599-163">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/library/ms229862.aspx).</span></span> <span data-ttu-id="c7599-164">この時点で、`SqlRoleProvider`に必要なスキーマを持つデータベースが既に存在します。</span><span class="sxs-lookup"><span data-stu-id="c7599-164">At this point we already have a database with the schema necessary for the `SqlRoleProvider`.</span></span> <span data-ttu-id="c7599-165">「SQL Server の<a id="_msoanchor_6"> </a>[*メンバーシップスキーマの作成」* ](../membership/creating-the-membership-schema-in-sql-server-vb.md)チュートリアルに戻り、`SecurityTutorials.mdf` という名前のデータベースを作成し、`aspnet_regsql.exe` を使用してアプリケーションサービスを追加しました。これには、`SqlRoleProvider`に必要なデータベースオブジェクトが含まれていました。</span><span class="sxs-lookup"><span data-stu-id="c7599-165">Back in the <a id="_msoanchor_6"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial we created a database named `SecurityTutorials.mdf` and used `aspnet_regsql.exe` to add the application services, which included the database objects required by the `SqlRoleProvider`.</span></span> <span data-ttu-id="c7599-166">そのため、ロールのサポートを有効にし、`SecurityTutorials.mdf` データベースでロールストアとして `SqlRoleProvider` を使用するようにロールフレームワークに指示するだけです。</span><span class="sxs-lookup"><span data-stu-id="c7599-166">Therefore we just need to tell the Roles framework to enable role support and to use the `SqlRoleProvider` with the `SecurityTutorials.mdf` database as the role store.</span></span>

<span data-ttu-id="c7599-167">ロールフレームワークは、アプリケーションの `Web.config` ファイル内の `<roleManager>` 要素を使用して構成されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-167">The Roles framework is configured via the `<roleManager>` element in the application's `Web.config` file.</span></span> <span data-ttu-id="c7599-168">既定では、ロールのサポートは無効になっています。</span><span class="sxs-lookup"><span data-stu-id="c7599-168">By default, role support is disabled.</span></span> <span data-ttu-id="c7599-169">有効にするには、次のように[`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx)要素の `enabled` 属性を `true` に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-169">To enable it, you must set the [`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx) element's `enabled` attribute to `true` like so:</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample3.xml)]

<span data-ttu-id="c7599-170">既定では、すべての web アプリケーションに `SqlRoleProvider`型の `AspNetSqlRoleProvider` という名前のロールプロバイダーがあります。</span><span class="sxs-lookup"><span data-stu-id="c7599-170">By default, all web applications have a Roles provider named `AspNetSqlRoleProvider` of type `SqlRoleProvider`.</span></span> <span data-ttu-id="c7599-171">この既定のプロバイダーは `machine.config` (`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`にあります) に登録されています。</span><span class="sxs-lookup"><span data-stu-id="c7599-171">This default provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample4.xml)]

<span data-ttu-id="c7599-172">プロバイダーの `connectionStringName` 属性は、使用するロールストアを指定します。</span><span class="sxs-lookup"><span data-stu-id="c7599-172">The provider's `connectionStringName` attribute specifies the role store that is used.</span></span> <span data-ttu-id="c7599-173">`AspNetSqlRoleProvider` プロバイダーは、この属性を `LocalSqlServer`に設定します。これは、既定では `machine.config` とポイントで `App_Data` という名前の `aspnet.mdf`フォルダー内の SQL Server 2005 Express Edition データベースにも定義されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-173">The `AspNetSqlRoleProvider` provider sets this attribute to `LocalSqlServer`, which is also defined in `machine.config` and points, by default, to a SQL Server 2005 Express Edition database in the `App_Data` folder named `aspnet.mdf`.</span></span>

<span data-ttu-id="c7599-174">そのため、アプリケーションの `Web.config` ファイルでプロバイダー情報を指定せずにロールフレームワークを有効にするだけであれば、アプリケーションは既定の登録済みロールプロバイダーである `AspNetSqlRoleProvider`を使用します。</span><span class="sxs-lookup"><span data-stu-id="c7599-174">Consequently, if we simply enable the Roles framework without specifying any provider information in our application's `Web.config` file, the application uses the default registered Roles provider, `AspNetSqlRoleProvider`.</span></span> <span data-ttu-id="c7599-175">`~/App_Data/aspnet.mdf` データベースが存在しない場合は、ASP.NET ランタイムによって自動的に作成され、アプリケーションサービススキーマが追加されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-175">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="c7599-176">ただし、`aspnet.mdf` データベースは使用しません。ここでは、既に作成した `SecurityTutorials.mdf` データベースを使用して、アプリケーションサービススキーマをに追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-176">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database that we have already created and added the application services schema to.</span></span> <span data-ttu-id="c7599-177">この変更は、次の2つの方法のいずれかで行うことができます。</span><span class="sxs-lookup"><span data-stu-id="c7599-177">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="c7599-178"><strong>`Web.config`</strong>で、<strong>`LocalSqlServer`</strong><strong>接続文字列名</strong><strong>の値を指定</strong>し<strong>ます。</strong></span><span class="sxs-lookup"><span data-stu-id="c7599-178"><strong>Specify a value for the</strong><strong>`LocalSqlServer`</strong><strong>connection string name in</strong><strong>`Web.config`</strong><strong>.</strong></span></span> <span data-ttu-id="c7599-179">`Web.config`の `LocalSqlServer` 接続文字列名の値を上書きすることで、既定の登録済みロールプロバイダー (`AspNetSqlRoleProvider`) を使用して、`SecurityTutorials.mdf` データベースと正しく連携させることができます。</span><span class="sxs-lookup"><span data-stu-id="c7599-179">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Roles provider (`AspNetSqlRoleProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="c7599-180">この手法の詳細については、 [Scott Guthrie](https://weblogs.asp.net/scottgu/)のブログ記事「 [SQL Server 2000 または SQL Server 2005 を使用するように ASP.NET 2.0 アプリケーションサービスを構成する](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7599-180">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="c7599-181"><strong>`SqlRoleProvider`</strong><strong>種類の新しい登録済みプロバイダーを追加</strong>し、<strong>`SecurityTutorials.mdf`</strong>データベース<strong>を指すようにその`connectionStringName`設定を</strong><strong>構成し</strong><strong>ます。</strong></span><span class="sxs-lookup"><span data-stu-id="c7599-181"><strong>Add a new registered provider of type</strong><strong>`SqlRoleProvider`</strong><strong>and configure its</strong><strong>`connectionStringName`</strong><strong>setting to point to the</strong><strong>`SecurityTutorials.mdf`</strong><strong>database.</strong></span></span> <span data-ttu-id="c7599-182">これは、 <a id="_msoanchor_7"> </a> [*SQL Server チュートリアルでメンバーシップスキーマを作成*](../membership/creating-the-membership-schema-in-sql-server-vb.md)するために推奨されているアプローチであり、このチュートリアルで使用するアプローチです。</span><span class="sxs-lookup"><span data-stu-id="c7599-182">This is the approach I recommended and used in the <a id="_msoanchor_7"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial, and it is the approach I will use in this tutorial as well.</span></span>

<span data-ttu-id="c7599-183">次のロールの構成マークアップを `Web.config` ファイルに追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-183">Add the following Roles configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="c7599-184">このマークアップは、という名前の新しいプロバイダーを登録 `SecurityTutorialsSqlRoleProvider.`</span><span class="sxs-lookup"><span data-stu-id="c7599-184">This markup registers a new provider named `SecurityTutorialsSqlRoleProvider.`</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample5.xml)]

<span data-ttu-id="c7599-185">上のマークアップでは、(`<roleManager>` 要素の `defaultProvider` 属性を使用して) 既定のプロバイダーとして `SecurityTutorialsSqlRoleProvider` が定義されています。</span><span class="sxs-lookup"><span data-stu-id="c7599-185">The above markup defines the `SecurityTutorialsSqlRoleProvider` as the default provider (via the `defaultProvider` attribute in the `<roleManager>` element).</span></span> <span data-ttu-id="c7599-186">また、`SecurityTutorialsSqlRoleProvider`の `applicationName` 設定を `SecurityTutorials`に設定します。これは、メンバーシッププロバイダー (`SecurityTutorialsSqlMembershipProvider`) によって使用されるのと同じ `applicationName` 設定です。</span><span class="sxs-lookup"><span data-stu-id="c7599-186">It also sets the `SecurityTutorialsSqlRoleProvider`'s `applicationName` setting to `SecurityTutorials`, which is the same `applicationName` setting used by the Membership provider (`SecurityTutorialsSqlMembershipProvider`).</span></span> <span data-ttu-id="c7599-187">ここには示されていませんが、`SqlRoleProvider` の[`<add>` 要素](https://msdn.microsoft.com/library/ms164662.aspx)には、データベースのタイムアウト期間を秒単位で指定するための `commandTimeout` 属性が含まれている場合もあります。</span><span class="sxs-lookup"><span data-stu-id="c7599-187">While not shown here, the [`<add>` element](https://msdn.microsoft.com/library/ms164662.aspx) for the `SqlRoleProvider` may also contain a `commandTimeout` attribute to specify the database timeout duration, in seconds.</span></span> <span data-ttu-id="c7599-188">既定値は、30 です。</span><span class="sxs-lookup"><span data-stu-id="c7599-188">The default value is 30.</span></span>

<span data-ttu-id="c7599-189">この構成マークアップを使用すると、アプリケーション内でロール機能の使用を開始する準備が整います。</span><span class="sxs-lookup"><span data-stu-id="c7599-189">With this configuration markup in place, we are ready to start using role functionality within our application.</span></span>

> [!NOTE]
> <span data-ttu-id="c7599-190">上記の構成マークアップは、`<roleManager>` 要素の `enabled` 属性と `defaultProvider` 属性の使用方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="c7599-190">The above configuration markup illustrates using the `<roleManager>` element's `enabled` and `defaultProvider` attributes.</span></span> <span data-ttu-id="c7599-191">ロールフレームワークがユーザーごとにロール情報を関連付ける方法に影響する属性は他にも多数あります。</span><span class="sxs-lookup"><span data-stu-id="c7599-191">There are a number of other attributes that affect how the Roles framework associates role information on a user-by-user basis.</span></span> <span data-ttu-id="c7599-192">これらの設定については<a id="_msoanchor_8"> </a>、[*ロールベースの承認*](role-based-authorization-vb.md)に関するチュートリアルで確認します。</span><span class="sxs-lookup"><span data-stu-id="c7599-192">We will examine these settings in the <a id="_msoanchor_8"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial.</span></span>

## <a name="step-3-examining-the-roles-api"></a><span data-ttu-id="c7599-193">手順 3: Roles API を調べる</span><span class="sxs-lookup"><span data-stu-id="c7599-193">Step 3: Examining the Roles API</span></span>

<span data-ttu-id="c7599-194">ロールフレームワークの機能は[`Roles` クラス](https://msdn.microsoft.com/library/system.web.security.roles.aspx)を介して公開されます。このクラスには、ロールベースの操作を実行するための13個の共有メソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="c7599-194">The Roles framework's functionality is exposed via the [`Roles` class](https://msdn.microsoft.com/library/system.web.security.roles.aspx), which contains thirteen shared methods for performing role-based operations.</span></span> <span data-ttu-id="c7599-195">手順 4. と 6. でロールを作成および削除することを検討している場合は、システムにロールを追加または削除する[`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx)および[`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx)メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="c7599-195">When we look at creating and deleting roles in Steps 4 and 6 we will use the [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) and [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) methods, which add or remove a role from the system.</span></span>

<span data-ttu-id="c7599-196">システム内のすべてのロールの一覧を取得するには、 [`GetAllRoles` メソッド](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx)を使用します (手順 5. を参照)。</span><span class="sxs-lookup"><span data-stu-id="c7599-196">To get a list of all of the roles in the system, use the [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (see Step 5).</span></span> <span data-ttu-id="c7599-197">[`RoleExists` メソッド](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx)は、指定されたロールが存在するかどうかを示すブール値を返します。</span><span class="sxs-lookup"><span data-stu-id="c7599-197">The [`RoleExists` method](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) returns a Boolean value indicating whether a specified role exists.</span></span>

<span data-ttu-id="c7599-198">次のチュートリアルでは、ユーザーをロールに関連付ける方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c7599-198">In the next tutorial we will examine how to associate users with roles.</span></span> <span data-ttu-id="c7599-199">`Roles` クラスの[`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx)、 [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx)、 [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx)、および[`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx)の各メソッドは、1人以上のユーザーを1つ以上のロールに追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-199">The `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx), and [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) methods add one or more users to one or more roles.</span></span> <span data-ttu-id="c7599-200">ロールからユーザーを削除するには、 [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx)、 [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx)、 [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx)、または[`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx)メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="c7599-200">To remove users from roles, use the [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx), or [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) methods.</span></span>

<span data-ttu-id="c7599-201"><a id="_msoanchor_9"> </a>[*ロールベースの承認*](role-based-authorization-vb.md)のチュートリアルでは、現在ログインしているユーザーのロールに基づいて機能をプログラムで表示または非表示にする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c7599-201">In the <a id="_msoanchor_9"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will look at ways to programmatically show or hide functionality based on the currently logged in user's role.</span></span> <span data-ttu-id="c7599-202">これを実現するには、ロールクラスの[`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx)、 [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx)、 [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx)、または[`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx)メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="c7599-202">To accomplish this, we can use the Role class's [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx), or [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) methods.</span></span>

> [!NOTE]
> <span data-ttu-id="c7599-203">これらのメソッドのいずれかが呼び出されるたびに、`Roles` クラスによって、構成されたプロバイダーへの呼び出しがデリゲートされることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c7599-203">Keep in mind that any time one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="c7599-204">この場合は、呼び出しが `SqlRoleProvider`に送信されていることを意味します。</span><span class="sxs-lookup"><span data-stu-id="c7599-204">In our case, this means that the call is being sent to the `SqlRoleProvider`.</span></span> <span data-ttu-id="c7599-205">`SqlRoleProvider` は、呼び出されたメソッドに基づいて適切なデータベース操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="c7599-205">The `SqlRoleProvider` then performs the appropriate database operation based on the invoked method.</span></span> <span data-ttu-id="c7599-206">たとえば、コード `Roles.CreateRole("Administrators")` は `aspnet_Roles_CreateRole` ストアドプロシージャを実行し `SqlRoleProvider` します。これにより、管理者という名前の `aspnet_Roles` テーブルに新しいレコードが挿入されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-206">For example, the code `Roles.CreateRole("Administrators")` results in the `SqlRoleProvider` executing the `aspnet_Roles_CreateRole` stored procedure, which inserts a new record into the `aspnet_Roles` table named Administrators .</span></span>

<span data-ttu-id="c7599-207">このチュートリアルの残りの部分では、`Roles` クラスの `CreateRole`、`GetAllRoles`、および `DeleteRole` の各メソッドを使用して、システムのロールを管理する方法について見ていきます。</span><span class="sxs-lookup"><span data-stu-id="c7599-207">The remainder of this tutorial looks at using the `Roles` class's `CreateRole`, `GetAllRoles`, and `DeleteRole` methods to manage the roles in the system.</span></span>

## <a name="step-4-creating-new-roles"></a><span data-ttu-id="c7599-208">手順 4: 新しいロールの作成</span><span class="sxs-lookup"><span data-stu-id="c7599-208">Step 4: Creating New Roles</span></span>

<span data-ttu-id="c7599-209">ロールはユーザーを任意にグループ化する手段を提供します。通常、このグループ化は、承認規則を適用するためのより便利な方法として使用されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-209">Roles offer a way to arbitrarily group users, and most commonly this grouping is used for a more convenient way to apply authorization rules.</span></span> <span data-ttu-id="c7599-210">ただし、承認メカニズムとしてロールを使用するには、まず、アプリケーションにどのロールが存在するかを定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-210">But in order to use roles as an authorization mechanism we first need to define what roles exist in the application.</span></span> <span data-ttu-id="c7599-211">残念ながら、ASP.NET には CreateRoleWizard コントロールは含まれていません。</span><span class="sxs-lookup"><span data-stu-id="c7599-211">Unfortunately, ASP.NET does not include a CreateRoleWizard control.</span></span> <span data-ttu-id="c7599-212">新しいロールを追加するには、適切なユーザーインターフェイスを作成し、ロール API を自分で呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-212">In order to add new roles we need to create a suitable user interface and invoke the Roles API ourselves.</span></span> <span data-ttu-id="c7599-213">すばらしいのは、これは非常に簡単な方法です。</span><span class="sxs-lookup"><span data-stu-id="c7599-213">The good news is that this is very easy to accomplish.</span></span>

> [!NOTE]
> <span data-ttu-id="c7599-214">CreateRoleWizard Web コントロールはありませんが、 [ASP.NET Web サイト管理ツール](https://msdn.microsoft.com/library/ms228053.aspx)があります。これは、web アプリケーションの構成の表示と管理を支援するように設計されたローカル ASP.NET アプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="c7599-214">While there is no CreateRoleWizard Web control, there is the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/ms228053.aspx), which is a local ASP.NET application designed to assist with viewing and managing your web application's configuration.</span></span> <span data-ttu-id="c7599-215">ただし、2つの理由から、ASP.NET Web サイト管理ツールの大きなファンではありません。</span><span class="sxs-lookup"><span data-stu-id="c7599-215">However, I am not a big fan of the ASP.NET Web Site Administration Tool for two reasons.</span></span> <span data-ttu-id="c7599-216">まず、少しのバグが発生し、ユーザーエクスペリエンスが必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="c7599-216">First, it is a bit buggy and the user experience leaves a lot to be desired.</span></span> <span data-ttu-id="c7599-217">次に、ASP.NET Web サイト管理ツールは、ローカルでのみ機能するように設計されています。つまり、ライブサイトでロールをリモート管理する必要がある場合は、独自のロール管理 Web ページを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-217">Second, the ASP.NET Web Site Administration Tool is designed to only work locally, meaning that you will have to build your own role management web pages if you need to manage roles on a live site remotely.</span></span> <span data-ttu-id="c7599-218">このチュートリアルと次の2つの理由により、ASP.NET Web サイト管理ツールを使用するのではなく、web ページで必要なロール管理ツールを構築することに重点を置いています。</span><span class="sxs-lookup"><span data-stu-id="c7599-218">For these two reasons, this tutorial and the next will focus on building the necessary role management tools in a web page rather than relying on the ASP.NET Web Site Administration Tool.</span></span>

<span data-ttu-id="c7599-219">`Roles` フォルダーの [`ManageRoles.aspx`] ページを開き、テキストボックスとボタン Web コントロールをページに追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-219">Open the `ManageRoles.aspx` page in the `Roles` folder and add a TextBox and a Button Web control to the page.</span></span> <span data-ttu-id="c7599-220">TextBox コントロールの `ID` プロパティを `RoleName` に設定し、ボタンの `ID` と `Text` プロパティをそれぞれ `CreateRoleButton` に設定して、ロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="c7599-220">Set the TextBox control's `ID` property to `RoleName` and the Button's `ID` and `Text` properties to `CreateRoleButton` and Create Role, respectively.</span></span> <span data-ttu-id="c7599-221">この時点で、ページの宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c7599-221">At this point, your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample6.aspx)]

<span data-ttu-id="c7599-222">次に、デザイナーの [`CreateRoleButton`] ボタンコントロールをダブルクリックして、`Click` イベントハンドラーを作成し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-222">Next, double-click the `CreateRoleButton` Button control in the Designer to create a `Click` event handler and then add the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample7.vb)]

<span data-ttu-id="c7599-223">上記のコードでは、最初に、[`RoleName`] ボックスに入力したトリミングされたロール名を `newRoleName` 変数に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="c7599-223">The above code starts by assigning the trimmed role name entered in the `RoleName` TextBox to the `newRoleName` variable.</span></span> <span data-ttu-id="c7599-224">次に、`Roles` クラスの `RoleExists` メソッドを呼び出して、ロール `newRoleName` がシステムに既に存在するかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="c7599-224">Next, the `Roles` class's `RoleExists` method is called to determine if the role `newRoleName` already exists in the system.</span></span> <span data-ttu-id="c7599-225">ロールが存在しない場合は、`CreateRole` メソッドの呼び出しを使用して作成されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-225">If the role does not exist, it is created via a call to the `CreateRole` method.</span></span> <span data-ttu-id="c7599-226">`CreateRole` メソッドに、システムに既に存在するロール名が渡されると、`ProviderException` 例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="c7599-226">If the `CreateRole` method is passed a role name that already exists in the system, a `ProviderException` exception is thrown.</span></span> <span data-ttu-id="c7599-227">このため、このコードでは、`CreateRole`を呼び出す前に、ロールがシステムに存在していないことを最初に確認します。</span><span class="sxs-lookup"><span data-stu-id="c7599-227">This is why the code first checks to ensure that the role does not already exist in the system before calling `CreateRole`.</span></span> <span data-ttu-id="c7599-228">`Click` イベントハンドラーは、`RoleName` テキストボックスの `Text` プロパティをクリアすることによって終了します。</span><span class="sxs-lookup"><span data-stu-id="c7599-228">The `Click` event handler concludes by clearing out the `RoleName` TextBox's `Text` property.</span></span>

> [!NOTE]
> <span data-ttu-id="c7599-229">ユーザーが [`RoleName`] ボックスに値を入力しないとどうなるか疑問に思うかもしれません。</span><span class="sxs-lookup"><span data-stu-id="c7599-229">You may be wondering what will happen if the user doesn't enter any value into the `RoleName` TextBox.</span></span> <span data-ttu-id="c7599-230">`CreateRole` メソッドに渡された値が `Nothing` または空の文字列の場合は、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="c7599-230">If the value passed into the `CreateRole` method is `Nothing` or an empty string, an exception is raised.</span></span> <span data-ttu-id="c7599-231">同様に、ロール名にコンマが含まれている場合は、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="c7599-231">Likewise, if the role name contains a comma an exception is raised.</span></span> <span data-ttu-id="c7599-232">そのため、ユーザーがロールを入力し、それにコンマが含まれていないことを確認するために、ページに検証コントロールが含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-232">Consequently, the page should contain validation controls to ensure that the user enters a role and that it does not contain any commas.</span></span> <span data-ttu-id="c7599-233">閲覧者のための演習を残しておきます。</span><span class="sxs-lookup"><span data-stu-id="c7599-233">I leave as an exercise for the reader.</span></span>

<span data-ttu-id="c7599-234">管理者という名前のロールを作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c7599-234">Let's create a role named Administrators.</span></span> <span data-ttu-id="c7599-235">ブラウザーを使用して `ManageRoles.aspx` ページにアクセスし、テキストボックスに管理者を入力し (図3を参照)、[ロールの作成] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="c7599-235">Visit the `ManageRoles.aspx` page through a browser, type in Administrators into the textbox (see Figure 3), and then click the Create Role button.</span></span>

<span data-ttu-id="c7599-236">[管理者ロールを作成 ![には](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c7599-236">[![Create an Administrators Role](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span></span>

<span data-ttu-id="c7599-237">**図 3**: 管理者ロールを作成[する (クリックすると、フルサイズの画像が表示](creating-and-managing-roles-vb/_static/image9.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c7599-237">**Figure 3**: Create an Administrators Role  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image9.png))</span></span>

<span data-ttu-id="c7599-238">どうしたらよいでしょうか。</span><span class="sxs-lookup"><span data-stu-id="c7599-238">What happens?</span></span> <span data-ttu-id="c7599-239">ポストバックが発生しますが、ロールが実際にシステムに追加されたことを示す視覚的な手掛かりはありません。</span><span class="sxs-lookup"><span data-stu-id="c7599-239">A postback occurs, but there's no visual cue that the role has actually been added to the system.</span></span> <span data-ttu-id="c7599-240">ここでは、手順 5. でこのページを更新して、視覚的なフィードバックを含めます。</span><span class="sxs-lookup"><span data-stu-id="c7599-240">We will update this page in Step 5 to include visual feedback.</span></span> <span data-ttu-id="c7599-241">ただし現時点では、ロールが作成されたことを確認するには、`SecurityTutorials.mdf` データベースに移動し、`aspnet_Roles` テーブルのデータを表示します。</span><span class="sxs-lookup"><span data-stu-id="c7599-241">For now, however, you can verify that the role was created by going to the `SecurityTutorials.mdf` database and displaying the data from the `aspnet_Roles` table.</span></span> <span data-ttu-id="c7599-242">図4に示すように、`aspnet_Roles` テーブルには、追加された管理者ロールのレコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="c7599-242">As Figure 4 shows, the `aspnet_Roles` table contains a record for the just-added Administrators roles.</span></span>

<span data-ttu-id="c7599-243">[aspnet_Roles テーブルに管理者の行がある ![](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c7599-243">[![The aspnet_Roles Table has a Row for the Administrators](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span></span>

<span data-ttu-id="c7599-244">**図 4**: `aspnet_Roles` テーブルに管理者用の行がある ([クリックすると、フルサイズの画像が表示](creating-and-managing-roles-vb/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c7599-244">**Figure 4**: The `aspnet_Roles` Table has a Row for the Administrators  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image12.png))</span></span>

## <a name="step-5-displaying-the-roles-in-the-system"></a><span data-ttu-id="c7599-245">手順 5: システムでのロールの表示</span><span class="sxs-lookup"><span data-stu-id="c7599-245">Step 5: Displaying the Roles in the System</span></span>

<span data-ttu-id="c7599-246">`ManageRoles.aspx` ページを拡張して、システム内の現在のロールの一覧を追加してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c7599-246">Let's augment the `ManageRoles.aspx` page to include a list of the current roles in the system.</span></span> <span data-ttu-id="c7599-247">これを行うには、GridView コントロールをページに追加し、その `ID` プロパティを `RoleList`に設定します。</span><span class="sxs-lookup"><span data-stu-id="c7599-247">To accomplish this, add a GridView control to the page and set its `ID` property to `RoleList`.</span></span> <span data-ttu-id="c7599-248">次に、次のコードを使用して、`DisplayRolesInGrid` という名前のページの分離コードクラスにメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-248">Next, add a method to the page's code-behind class named `DisplayRolesInGrid` using the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample8.vb)]

<span data-ttu-id="c7599-249">`Roles` クラスの `GetAllRoles` メソッドは、システム内のすべてのロールを文字列の配列として返します。</span><span class="sxs-lookup"><span data-stu-id="c7599-249">The `Roles` class's `GetAllRoles` method returns all of the roles in the system as an array of strings.</span></span> <span data-ttu-id="c7599-250">この文字列配列は、GridView にバインドされます。</span><span class="sxs-lookup"><span data-stu-id="c7599-250">This string array is then bound to the GridView.</span></span> <span data-ttu-id="c7599-251">ページが最初に読み込まれたときにロールの一覧を GridView にバインドするには、ページの `Page_Load` イベントハンドラーから `DisplayRolesInGrid` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-251">In order to bind the list of roles to the GridView when the page is first loaded, we need to call the `DisplayRolesInGrid` method from the page's `Page_Load` event handler.</span></span> <span data-ttu-id="c7599-252">次のコードは、ページが最初にアクセスされたときにこのメソッドを呼び出しますが、後続のポストバックでは呼び出されません。</span><span class="sxs-lookup"><span data-stu-id="c7599-252">The following code calls this method when the page is first visited, but not on subsequent postbacks.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample9.vb)]

<span data-ttu-id="c7599-253">このコードを配置したら、ブラウザーを使用してページにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="c7599-253">With this code in place, visit the page through a browser.</span></span> <span data-ttu-id="c7599-254">図5に示すように、"Item" というラベルが付いた1列のグリッドが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-254">As Figure 5 shows, you should see a grid with a single column labeled Item.</span></span> <span data-ttu-id="c7599-255">グリッドには、手順 4. で追加した管理者ロールの行が含まれています。</span><span class="sxs-lookup"><span data-stu-id="c7599-255">The grid includes a row for the Administrators role we added in Step 4.</span></span>

<span data-ttu-id="c7599-256">[GridView によってロールが1つの列に表示される ![](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c7599-256">[![The GridView Displays the Roles in a Single Column](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span></span>

<span data-ttu-id="c7599-257">**図 5**: GridView によってロールが1つの列に表示される ([クリックすると、フルサイズの画像が表示](creating-and-managing-roles-vb/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c7599-257">**Figure 5**: The GridView Displays the Roles in a Single Column  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image15.png))</span></span>

<span data-ttu-id="c7599-258">Gridview の [`AutoGenerateColumns`] プロパティが True (既定値) に設定されているため、gridview では、[Item] というラベルの付いた列のみが表示されます。これにより、GridView は、`DataSource`の各プロパティに対して自動的に列を作成します。</span><span class="sxs-lookup"><span data-stu-id="c7599-258">The GridView displays a lone column labeled Item because the GridView's `AutoGenerateColumns` property is set to True (the default), which causes the GridView to automatically create a column for each property in its `DataSource`.</span></span> <span data-ttu-id="c7599-259">配列には、配列内の要素を表す1つのプロパティがあります。したがって、GridView の単一の列です。</span><span class="sxs-lookup"><span data-stu-id="c7599-259">An array has a single property that represents the elements in the array, hence the single column in the GridView.</span></span>

<span data-ttu-id="c7599-260">GridView を使用してデータを表示する場合は、GridView によって暗黙的に生成されるのではなく、列を明示的に定義します。</span><span class="sxs-lookup"><span data-stu-id="c7599-260">When displaying data with a GridView, I prefer to explicitly define my columns rather than have them implicitly generated by the GridView.</span></span> <span data-ttu-id="c7599-261">列を明示的に定義することにより、データの書式設定、列の再配置、およびその他の一般的なタスクをより簡単に実行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="c7599-261">By explicitly defining the columns it is much easier to format the data, rearrange the columns, and perform other common tasks.</span></span> <span data-ttu-id="c7599-262">そのため、GridView の宣言型マークアップを更新して、その列が明示的に定義されるようにしましょう。</span><span class="sxs-lookup"><span data-stu-id="c7599-262">Therefore, let's update the GridView's declarative markup so that its columns are explicitly defined.</span></span>

<span data-ttu-id="c7599-263">まず、GridView の `AutoGenerateColumns` プロパティを False に設定します。</span><span class="sxs-lookup"><span data-stu-id="c7599-263">Start by setting the GridView's `AutoGenerateColumns` property to False.</span></span> <span data-ttu-id="c7599-264">次に、グリッドに TemplateField を追加し、その `HeaderText` プロパティを Roles に設定し、配列の内容が表示されるように `ItemTemplate` を構成します。</span><span class="sxs-lookup"><span data-stu-id="c7599-264">Next, add a TemplateField to the grid, set its `HeaderText` property to Roles, and configure its `ItemTemplate` so that it displays the contents of the array.</span></span> <span data-ttu-id="c7599-265">これを行うには、`RoleNameLabel` という名前のラベル Web コントロールを `ItemTemplate` に追加し、その `Text` プロパティをにバインド `Container.DataItem.`</span><span class="sxs-lookup"><span data-stu-id="c7599-265">To accomplish this, add a Label Web control named `RoleNameLabel` to the `ItemTemplate` and bind its `Text` property to `Container.DataItem.`</span></span>

<span data-ttu-id="c7599-266">これらのプロパティと `ItemTemplate`の内容は、宣言によって、または GridView の [フィールド] ダイアログボックスとテンプレートの編集インターフェイスを使用して設定できます。</span><span class="sxs-lookup"><span data-stu-id="c7599-266">These properties and the `ItemTemplate`'s contents can be set declaratively or through the GridView's Fields dialog box and Edit Templates interface.</span></span> <span data-ttu-id="c7599-267">[フィールド] ダイアログボックスに移動するには、GridView のスマートタグの [列の編集] リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="c7599-267">To reach the Fields dialog box, click the Edit Columns link in the GridView's Smart Tag.</span></span> <span data-ttu-id="c7599-268">次に、[フィールドの自動生成] チェックボックスをオフにして `AutoGenerateColumns` プロパティを False に設定し、GridView に TemplateField を追加して、その `HeaderText` プロパティを Role に設定します。</span><span class="sxs-lookup"><span data-stu-id="c7599-268">Next, uncheck the Auto-generate fields checkbox to set the `AutoGenerateColumns` property to False, and add a TemplateField to the GridView, setting its `HeaderText` property to Role.</span></span> <span data-ttu-id="c7599-269">`ItemTemplate`の内容を定義するには、GridView のスマートタグから [テンプレートの編集] オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="c7599-269">To define the `ItemTemplate`'s contents, choose the Edit Templates option from the GridView's Smart Tag.</span></span> <span data-ttu-id="c7599-270">Label Web コントロールを `ItemTemplate`にドラッグし、その `ID` プロパティを `RoleNameLabel`に設定し、その `Text` プロパティが `Container.DataItem`にバインドされるようにデータバインド設定を構成します。</span><span class="sxs-lookup"><span data-stu-id="c7599-270">Drag a Label Web control onto the `ItemTemplate`, set its `ID` property to `RoleNameLabel`, and configure its databinding settings so that its `Text` property is bound to `Container.DataItem`.</span></span>

<span data-ttu-id="c7599-271">使用する方法に関係なく、GridView の結果の宣言型マークアップは、完了すると次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c7599-271">Regardless of what approach you use, the GridView's resulting declarative markup should look similar to the following when you are done.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample10.aspx)]

> [!NOTE]
> <span data-ttu-id="c7599-272">配列の内容は、`<%# Container.DataItem %>`データバインド構文を使用して表示されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-272">The array's contents are displayed using the databinding syntax `<%# Container.DataItem %>`.</span></span> <span data-ttu-id="c7599-273">GridView にバインドされた配列の内容を表示するときにこの構文を使用する理由の詳細については、このチュートリアルでは説明しません。</span><span class="sxs-lookup"><span data-stu-id="c7599-273">A thorough description of why this syntax is used when displaying the contents of an array bound to the GridView is beyond the scope of this tutorial.</span></span> <span data-ttu-id="c7599-274">詳細については、「[データ Web コントロールへのスカラー配列のバインド](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7599-274">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="c7599-275">現時点では、`RoleList` GridView は、ページが最初にアクセスされたときにのみロールの一覧にバインドされます。</span><span class="sxs-lookup"><span data-stu-id="c7599-275">Currently, the `RoleList` GridView is only bound to the list of roles when the page is first visited.</span></span> <span data-ttu-id="c7599-276">新しいロールが追加されるたびにグリッドを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-276">We need to refresh the grid whenever a new role is added.</span></span> <span data-ttu-id="c7599-277">これを実現するには、新しいロールが作成された場合に `DisplayRolesInGrid` メソッドを呼び出すように、`CreateRoleButton` ボタンの `Click` イベントハンドラーを更新します。</span><span class="sxs-lookup"><span data-stu-id="c7599-277">To accomplish this, update the `CreateRoleButton` Button's `Click` event handler so that it calls the `DisplayRolesInGrid` method if a new role is created.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample11.vb)]

<span data-ttu-id="c7599-278">これで、ユーザーが新しいロールを追加すると、`RoleList` GridView によってポストバック時に追加されたロールが表示され、ロールが正常に作成されたことを視覚的にフィードバックできます。</span><span class="sxs-lookup"><span data-stu-id="c7599-278">Now when the user adds a new role the `RoleList` GridView shows the just-added role on postback, providing visual feedback that the role was successfully created.</span></span> <span data-ttu-id="c7599-279">これを説明するには、ブラウザーを使用して `ManageRoles.aspx` のページにアクセスし、スーパーバイザーという名前のロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-279">To illustrate this, visit the `ManageRoles.aspx` page through a browser and add a role named Supervisors.</span></span> <span data-ttu-id="c7599-280">[Create Role] \ (ロールの作成 \) ボタンをクリックすると、ポストバックが議論され、新しいロールであるスーパーバイザーに加えて、管理者と共にグリッドが更新されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-280">Upon clicking the Create Role button, a postback will ensue and the grid will update to include Administrators as well as the new role, Supervisors.</span></span>

<span data-ttu-id="c7599-281">[スーパーバイザーロールが追加され ![](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c7599-281">[![The Supervisors Role has Been Added](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span></span>

<span data-ttu-id="c7599-282">**図 6**: スーパーバイザーロールが追加されました ([クリックすると、フルサイズの画像が表示](creating-and-managing-roles-vb/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c7599-282">**Figure 6**: The Supervisors Role has Been Added  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image18.png))</span></span>

## <a name="step-6-deleting-roles"></a><span data-ttu-id="c7599-283">手順 6: 役割を削除する</span><span class="sxs-lookup"><span data-stu-id="c7599-283">Step 6: Deleting Roles</span></span>

<span data-ttu-id="c7599-284">この時点で、ユーザーは `ManageRoles.aspx` ページから新しいロールを作成し、すべての既存のロールを表示できます。</span><span class="sxs-lookup"><span data-stu-id="c7599-284">At this point a user can create a new role and view all existing roles from the `ManageRoles.aspx` page.</span></span> <span data-ttu-id="c7599-285">ユーザーがロールを削除できるようにしましょう。</span><span class="sxs-lookup"><span data-stu-id="c7599-285">Let's allow users to also delete roles.</span></span> <span data-ttu-id="c7599-286">`Roles.DeleteRole` メソッドには、次の2つのオーバーロードがあります。</span><span class="sxs-lookup"><span data-stu-id="c7599-286">The `Roles.DeleteRole` method has two overloads:</span></span>

- <span data-ttu-id="c7599-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) -ロール*roleName*を削除します。</span><span class="sxs-lookup"><span data-stu-id="c7599-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="c7599-288">ロールに1つ以上のメンバーが含まれている場合は、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="c7599-288">An exception is thrown if the role contains one or more members.</span></span>
- <span data-ttu-id="c7599-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) -ロール*roleName*を削除します。</span><span class="sxs-lookup"><span data-stu-id="c7599-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="c7599-290">*ThrowOnPopulateRole*が `True`場合、ロールに1つ以上のメンバーが含まれていると、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="c7599-290">If *throwOnPopulateRole* is `True`, then an exception is thrown if the role contains one or more members.</span></span> <span data-ttu-id="c7599-291">*ThrowOnPopulateRole*が `False`場合、メンバーが含まれているかどうかにかかわらず、ロールが削除されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-291">If *throwOnPopulateRole* is `False`, then the role is deleted whether it contains any members or not.</span></span> <span data-ttu-id="c7599-292">内部的には、`DeleteRole(roleName)` メソッドは `DeleteRole(roleName, True)`を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="c7599-292">Internally, the `DeleteRole(roleName)` method calls `DeleteRole(roleName, True)`.</span></span>

<span data-ttu-id="c7599-293">`DeleteRole` メソッドは、 *rolename*が `Nothing` または空の文字列の場合、または*rolename*にコンマが含まれている場合にも例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="c7599-293">The `DeleteRole` method will also throw an exception if *roleName* is `Nothing` or an empty string or if *roleName* contains a comma.</span></span> <span data-ttu-id="c7599-294">*RoleName*がシステムに存在しない場合、`DeleteRole` は、例外を発生させることなく、サイレントモードで失敗します。</span><span class="sxs-lookup"><span data-stu-id="c7599-294">If *roleName* does not exist in the system, `DeleteRole` fails silently, without raising an exception.</span></span>

<span data-ttu-id="c7599-295">クリックすると選択したロールを削除する [削除] ボタンを含めるように、`ManageRoles.aspx` の GridView を増やしてみましょう。</span><span class="sxs-lookup"><span data-stu-id="c7599-295">Let's augment the GridView in `ManageRoles.aspx` to include a Delete button that, when clicked, deletes the selected role.</span></span> <span data-ttu-id="c7599-296">まず、[フィールド] ダイアログボックスに移動し、[CommandField] オプションの下にある [削除] ボタンを追加して、GridView に Delete ボタンを追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-296">Start by adding a Delete button to the GridView by going to the Fields dialog box and adding a Delete button, which is located under the CommandField option.</span></span> <span data-ttu-id="c7599-297">[削除] ボタンを左端の列にして、その `DeleteText` プロパティを [ロールの削除] に設定します。</span><span class="sxs-lookup"><span data-stu-id="c7599-297">Make the Delete button the far left column and set its `DeleteText` property to Delete Role .</span></span>

<span data-ttu-id="c7599-298">[RoleList GridView に Delete ボタンを追加 ![には](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c7599-298">[![Add a Delete Button to the RoleList GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span></span>

<span data-ttu-id="c7599-299">**図 7**: `RoleList` GridView に Delete ボタンを追加する ([クリックすると、フルサイズの画像が表示](creating-and-managing-roles-vb/_static/image21.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c7599-299">**Figure 7**: Add a Delete Button to the `RoleList` GridView  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image21.png))</span></span>

<span data-ttu-id="c7599-300">[削除] ボタンを追加した後、GridView の宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c7599-300">After adding the Delete button, your GridView's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample12.aspx)]

<span data-ttu-id="c7599-301">次に、GridView の `RowDeleting` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="c7599-301">Next, create an event handler for the GridView's `RowDeleting` event.</span></span> <span data-ttu-id="c7599-302">これは、[ロールの削除] ボタンをクリックしたときにポストバック時に発生するイベントです。</span><span class="sxs-lookup"><span data-stu-id="c7599-302">This is the event that is raised on postback when the Delete Role button is clicked.</span></span> <span data-ttu-id="c7599-303">イベント ハンドラーに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="c7599-303">Add the following code to the event handler.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample13.vb)]

<span data-ttu-id="c7599-304">このコードは、[ロールの削除] ボタンがクリックされた行の `RoleNameLabel` Web コントロールをプログラムで参照することによって開始します。</span><span class="sxs-lookup"><span data-stu-id="c7599-304">The code starts by programmatically referencing the `RoleNameLabel` Web control in the row whose Delete Role button was clicked.</span></span> <span data-ttu-id="c7599-305">次に、`Roles.DeleteRole` メソッドが呼び出され、`RoleNameLabel` と `False`の `Text` を渡して、ロールに関連付けられているユーザーがいないかどうかに関係なく、ロールを削除します。</span><span class="sxs-lookup"><span data-stu-id="c7599-305">The `Roles.DeleteRole` method is then invoked, passing in the `Text` of the `RoleNameLabel` and `False`, thereby deleting the role regardless of whether there are any users associated with the role.</span></span> <span data-ttu-id="c7599-306">最後に、削除したロールがグリッドに表示されなくなるように、`RoleList` GridView が更新されます。</span><span class="sxs-lookup"><span data-stu-id="c7599-306">Finally, the `RoleList` GridView is refreshed so that the just-deleted role no longer appears in the grid.</span></span>

> [!NOTE]
> <span data-ttu-id="c7599-307">[ロールの削除] ボタンでは、ロールを削除する前に、ユーザーからの確認を行う必要はありません。</span><span class="sxs-lookup"><span data-stu-id="c7599-307">The Delete Role button does not require any sort of confirmation from the user before deleting the role.</span></span> <span data-ttu-id="c7599-308">アクションを確認する最も簡単な方法の1つは、クライアント側の [確認] ダイアログボックスを使用することです。</span><span class="sxs-lookup"><span data-stu-id="c7599-308">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="c7599-309">この手法の詳細については、「[削除時にクライアント側の確認を追加](https://asp.net/learn/data-access/tutorial-42-vb.aspx)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7599-309">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="c7599-310">要約</span><span class="sxs-lookup"><span data-stu-id="c7599-310">Summary</span></span>

<span data-ttu-id="c7599-311">多くの web アプリケーションには、特定のクラスのユーザーのみが使用できる特定の承認規則またはページレベルの機能があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-311">Many web applications have certain authorization rules or page-level functionality that is only available to certain classes of users.</span></span> <span data-ttu-id="c7599-312">たとえば、管理者のみがアクセスできる web ページのセットがある場合があります。</span><span class="sxs-lookup"><span data-stu-id="c7599-312">For example, there may be a set of web pages that only administrators can access.</span></span> <span data-ttu-id="c7599-313">ユーザーごとにこれらの承認規則を定義するのではなく、ロールに基づいて規則を定義する方が便利な場合がよくあります。</span><span class="sxs-lookup"><span data-stu-id="c7599-313">Rather than defining these authorization rules on a user-by-user basis, oftentimes it is more useful to define the rules based on a role.</span></span> <span data-ttu-id="c7599-314">つまり、Scott と Jisun ユーザーに管理 web ページへのアクセスを明示的に許可するのではなく、管理者ロールのメンバーにこれらのページへのアクセスを許可したうえで、ユーザーに属しているユーザーとして Scott と Jisun を示すという方法があります。管理者ロール。</span><span class="sxs-lookup"><span data-stu-id="c7599-314">That is, rather than explicitly allowing users Scott and Jisun to access the administrative web pages, a more maintainable approach is to permit members of the Administrators role to access these pages, and then to denote Scott and Jisun as users belonging to the Administrators role.</span></span>

<span data-ttu-id="c7599-315">ロールフレームワークを使用すると、ロールの作成と管理を簡単に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="c7599-315">The Roles framework makes it easy to create and manage roles.</span></span> <span data-ttu-id="c7599-316">このチュートリアルでは、Microsoft SQL Server データベースをロールストアとして使用する、`SqlRoleProvider`を使用するようにロールフレームワークを構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c7599-316">In this tutorial we examined how to configure the Roles framework to use the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span> <span data-ttu-id="c7599-317">また、システム内の既存のロールを一覧表示する web ページを作成し、新しいロールを作成したり、既存のロールを削除したりできるようにしました。</span><span class="sxs-lookup"><span data-stu-id="c7599-317">We also created a web page that lists the existing roles in the system and allows for new roles to be created and existing ones to be deleted.</span></span> <span data-ttu-id="c7599-318">以降のチュートリアルでは、ユーザーをロールに割り当てる方法と、ロールベースの承認を適用する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="c7599-318">In subsequent tutorials we will see how to assign users to roles and how to apply role-based authorization.</span></span>

<span data-ttu-id="c7599-319">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="c7599-319">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="c7599-320">関連項目</span><span class="sxs-lookup"><span data-stu-id="c7599-320">Further Reading</span></span>

<span data-ttu-id="c7599-321">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c7599-321">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c7599-322">ASP.NET 2.0 のメンバーシップ、ロール、およびプロファイルを調べています</span><span class="sxs-lookup"><span data-stu-id="c7599-322">Examining ASP.NET 2.0's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="c7599-323">方法: ASP.NET 2.0 でロールマネージャーを使用する</span><span class="sxs-lookup"><span data-stu-id="c7599-323">How To: Use Role Manager in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998314.aspx)
- [<span data-ttu-id="c7599-324">ロールプロバイダー</span><span class="sxs-lookup"><span data-stu-id="c7599-324">Role Providers</span></span>](https://msdn.microsoft.com/library/aa478950.aspx)
- [<span data-ttu-id="c7599-325">独自の Web サイト管理ツールのロール</span><span class="sxs-lookup"><span data-stu-id="c7599-325">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="c7599-326">`<roleManager>` 要素の技術ドキュメント</span><span class="sxs-lookup"><span data-stu-id="c7599-326">Technical documentation for the `<roleManager>` Element</span></span>](https://msdn.microsoft.com/library/ms164660.aspx)
- [<span data-ttu-id="c7599-327">メンバーシップ Api とロールマネージャー Api の使用</span><span class="sxs-lookup"><span data-stu-id="c7599-327">Using the Membership and Role Manager APIs</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/security/membership.aspx)

### <a name="about-the-author"></a><span data-ttu-id="c7599-328">作成者について</span><span class="sxs-lookup"><span data-stu-id="c7599-328">About the Author</span></span>

<span data-ttu-id="c7599-329">1998以降、Microsoft の Web テクノロジを使用して、Scott Mitchell (複数の ASP/創設者4GuysFromRolla.com の執筆者) が Microsoft の Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="c7599-329">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c7599-330">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="c7599-330">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c7599-331">彼の最新の書籍は *[、ASP.NET 2.0 を24時間以内に教え](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* ています。</span><span class="sxs-lookup"><span data-stu-id="c7599-331">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="c7599-332">Scott は、 [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com)またはブログで[http://ScottOnWriting.NET](http://scottonwriting.net/)にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c7599-332">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="c7599-333">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="c7599-333">Special Thanks To</span></span>

<span data-ttu-id="c7599-334">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="c7599-334">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c7599-335">このチュートリアルのリードレビュー担当者には、Alicja Maziarz、Suchi Erjee、および Teresa Murphy が含まれています。</span><span class="sxs-lookup"><span data-stu-id="c7599-335">Lead reviewers for this tutorial include Alicja Maziarz, Suchi Banerjee, and Teresa Murphy.</span></span> <span data-ttu-id="c7599-336">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="c7599-336">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c7599-337">その場合は、 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)の行を削除します。</span><span class="sxs-lookup"><span data-stu-id="c7599-337">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c7599-338">[前へ](role-based-authorization-cs.md)
> [次へ](assigning-roles-to-users-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c7599-338">[Previous](role-based-authorization-cs.md)
[Next](assigning-roles-to-users-vb.md)</span></span>
