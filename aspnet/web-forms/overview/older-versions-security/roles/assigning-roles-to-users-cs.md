---
uid: web-forms/overview/older-versions-security/roles/assigning-roles-to-users-cs
title: ユーザーにロールを割り当てるC#() |Microsoft Docs
author: rick-anderson
description: このチュートリアルでは、ユーザーがどのロールに属しているかを管理するのに役立つ2つの ASP.NET ページを作成します。 最初のページには、表示する機能が含まれています...
ms.author: riande
ms.date: 03/24/2008
ms.assetid: d522639a-5aca-421e-9a76-d73f95607f57
msc.legacyurl: /web-forms/overview/older-versions-security/roles/assigning-roles-to-users-cs
msc.type: authoredcontent
ms.openlocfilehash: 3346e47cf604ed1d4003ca83203116666e37cb1b
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78461386"
---
# <a name="assigning-roles-to-users-c"></a><span data-ttu-id="5c1c0-104">ユーザーにロールを割り当てる (C#)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-104">Assigning Roles to Users (C#)</span></span>

<span data-ttu-id="5c1c0-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5c1c0-106">[コードのダウンロード](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.10.zip)または[PDF のダウンロード](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-106">[Download Code](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.10.zip) or [Download PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_cs.pdf)</span></span>

> <span data-ttu-id="5c1c0-107">このチュートリアルでは、ユーザーがどのロールに属しているかを管理するのに役立つ2つの ASP.NET ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-107">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="5c1c0-108">最初のページには、特定のロールに属しているユーザー、特定のユーザーが属するロール、特定のロールから特定のユーザーを割り当てたり削除したりする機能が含まれます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-108">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="5c1c0-109">2番目のページでは、CreateUserWizard コントロールを拡張して、新しく作成されたユーザーが所属するロールを指定する手順が含まれるようにします。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-109">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="5c1c0-110">これは、管理者が新しいユーザーアカウントを作成できる場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-110">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>

## <a name="introduction"></a><span data-ttu-id="5c1c0-111">はじめに</span><span class="sxs-lookup"><span data-stu-id="5c1c0-111">Introduction</span></span>

<span data-ttu-id="5c1c0-112"><a id="_msoanchor_1"> </a>[前のチュートリアル](creating-and-managing-roles-cs.md)では、ロールフレームワークと `SqlRoleProvider`を検証しています。`Roles` クラスを使用して、ロールを作成、取得、および削除する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-112">The <a id="_msoanchor_1"></a>[previous tutorial](creating-and-managing-roles-cs.md) examined the Roles framework and the `SqlRoleProvider`; we saw how to use the `Roles` class to create, retrieve, and delete roles.</span></span> <span data-ttu-id="5c1c0-113">ロールの作成と削除に加えて、ロールのユーザーを割り当てたり、削除したりできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-113">In addition to creating and deleting roles, we need to be able to assign or remove users from a role.</span></span> <span data-ttu-id="5c1c0-114">残念ながら、ASP.NET には、どのロールに属しているかを管理するための Web コントロールは付属していません。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-114">Unfortunately, ASP.NET does not ship with any Web controls for managing what users belong to what roles.</span></span> <span data-ttu-id="5c1c0-115">代わりに、これらの関連付けを管理するには、独自の ASP.NET ページを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-115">Instead, we must create our own ASP.NET pages to manage these associations.</span></span> <span data-ttu-id="5c1c0-116">ユーザーをロールに追加したり削除したりするのは非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-116">The good news is that adding and removing users to roles is quite easy.</span></span> <span data-ttu-id="5c1c0-117">`Roles` クラスには、1つまたは複数のロールに1人以上のユーザーを追加するためのメソッドが多数含まれています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-117">The `Roles` class contains a number of methods for adding one or more users to one or more roles.</span></span>

<span data-ttu-id="5c1c0-118">このチュートリアルでは、ユーザーがどのロールに属しているかを管理するのに役立つ2つの ASP.NET ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-118">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="5c1c0-119">最初のページには、特定のロールに属しているユーザー、特定のユーザーが属するロール、特定のロールから特定のユーザーを割り当てたり削除したりする機能が含まれます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-119">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="5c1c0-120">2番目のページでは、CreateUserWizard コントロールを拡張して、新しく作成されたユーザーが所属するロールを指定する手順が含まれるようにします。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-120">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="5c1c0-121">これは、管理者が新しいユーザーアカウントを作成できる場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-121">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>

<span data-ttu-id="5c1c0-122">作業開始</span><span class="sxs-lookup"><span data-stu-id="5c1c0-122">Let's get started!</span></span>

## <a name="listing-what-users-belong-to-what-roles"></a><span data-ttu-id="5c1c0-123">ユーザーがどのロールに属しているかを一覧表示する</span><span class="sxs-lookup"><span data-stu-id="5c1c0-123">Listing What Users Belong To What Roles</span></span>

<span data-ttu-id="5c1c0-124">このチュートリアルの最初のビジネスの順序は、ユーザーをロールに割り当てることができる web ページを作成することです。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-124">The first order of business for this tutorial is to create a web page from which users can be assigned to roles.</span></span> <span data-ttu-id="5c1c0-125">ユーザーをロールに割り当てる方法については、まず、ユーザーがどのロールに属しているかを判断する方法について重点的に説明します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-125">Before we concern ourselves with how to assign users to roles, let's first concentrate on how to determine what users belong to what roles.</span></span> <span data-ttu-id="5c1c0-126">この情報を表示するには、"ロール別" または "ユーザー別" の2つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-126">There are two ways to display this information: "by role" or "by user."</span></span> <span data-ttu-id="5c1c0-127">ユーザーがロールを選択して、そのロールに属しているすべてのユーザー ("ロール" 表示) を表示できるようにするか、ユーザーに割り当てられたロールをユーザーに表示するようにビジターに要求することができます ("ユーザー" 表示)。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-127">We could allow the visitor to select a role and then show them all of the users that belong to the role (the "by role" display), or we could prompt the visitor to select a user and then show them the roles assigned to that user (the "by user" display).</span></span>

<span data-ttu-id="5c1c0-128">"ロール別" ビューは、ビジターが特定のロールに属しているユーザーのセットを知りたい場合に便利です。"ユーザーごと" のビューは、ビジターが特定のユーザーのロールを知る必要がある場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-128">The "by role" view is useful in circumstances where the visitor wants to know the set of users that belong to a particular role; the "by user" view is ideal when the visitor needs to know a particular user's role(s).</span></span> <span data-ttu-id="5c1c0-129">ページに "ロール別" と "ユーザー別" の両方のインターフェイスが含まれていることを見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-129">Let's have our page include both "by role" and "by user" interfaces.</span></span>

<span data-ttu-id="5c1c0-130">まず、"ユーザー" インターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-130">We will start with creating the "by user" interface.</span></span> <span data-ttu-id="5c1c0-131">このインターフェイスは、ドロップダウンリストとチェックボックスの一覧で構成されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-131">This interface will consist of a drop-down list and a list of checkboxes.</span></span> <span data-ttu-id="5c1c0-132">ドロップダウンリストには、システム内の一連のユーザーが表示されます。チェックボックスをオンにすると、ロールが列挙されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-132">The drop-down list will be populated with the set of users in the system; the checkboxes will enumerate the roles.</span></span> <span data-ttu-id="5c1c0-133">ドロップダウンリストからユーザーを選択すると、ユーザーが属するロールがチェックされます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-133">Selecting a user from the drop-down list will check those roles the user belongs to.</span></span> <span data-ttu-id="5c1c0-134">ページにアクセスするユーザーは、チェックボックスをオンまたはオフにして、選択したユーザーを対応するロールから追加または削除することができます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-134">The person visiting the page can then check or uncheck the checkboxes to add or remove the selected user from the corresponding roles.</span></span>

> [!NOTE]
> <span data-ttu-id="5c1c0-135">ドロップダウンリストを使用してユーザーアカウントを一覧表示することは、数百のユーザーアカウントが存在する可能性のある web サイトには適していません。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-135">Using a drop-down list to list the user accounts is not an ideal choice for websites where there may be hundreds of user accounts.</span></span> <span data-ttu-id="5c1c0-136">ドロップダウンリストは、ユーザーが比較的短いオプションの一覧から1つの項目を選択できるように設計されています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-136">A drop-down list is designed to allow a user to pick one item from a relatively short list of options.</span></span> <span data-ttu-id="5c1c0-137">リスト項目の数が増えるにつれて、すぐに扱いにくくなります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-137">It quickly becomes unwieldy as the number of list items grows.</span></span> <span data-ttu-id="5c1c0-138">多くのユーザーアカウントを持つ可能性のある web サイトを構築する場合は、ページング可能な GridView や、文字を選択するようにビジターに要求するように設定されたフィルター可能なインターフェイスなど、代替のユーザーインターフェイスの使用を検討してください。ユーザー名が選択した文字で始まるユーザーを表示します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-138">If you are building a website that will have potentially large numbers of user accounts, you may want to consider using an alternative user interface, such as a pageable GridView or a filterable interface that lists prompts the visitor to choose a letter and then only shows those users whose username starts with the selected letter.</span></span>

## <a name="step-1-building-the-by-user-user-interface"></a><span data-ttu-id="5c1c0-139">手順 1: "ユーザー" ユーザーインターフェイスを作成する</span><span class="sxs-lookup"><span data-stu-id="5c1c0-139">Step 1: Building the "By User" User Interface</span></span>

<span data-ttu-id="5c1c0-140">[`UsersAndRoles.aspx`] ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-140">Open the `UsersAndRoles.aspx` page.</span></span> <span data-ttu-id="5c1c0-141">ページの上部で、`ActionStatus` という名前のラベル Web コントロールを追加し、その `Text` プロパティをオフにします。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-141">At the top of the page, add a Label Web control named `ActionStatus` and clear out its `Text` property.</span></span> <span data-ttu-id="5c1c0-142">このラベルを使用して、実行された操作に関するフィードバックを提供します。 "ユーザー Tito は管理者ロールに追加されました"、"ユーザー Jisun はスーパーバイザーロールから削除されました。" などのメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-142">We will use this Label to provide feedback on the actions performed, displaying messages like, "User Tito has been added to the Administrators role," or "User Jisun has been removed from the Supervisors role."</span></span> <span data-ttu-id="5c1c0-143">これらのメッセージを目立たせるために、ラベルの `CssClass` プロパティを "Important" に設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-143">In order to make these messages stand out, set the Label's `CssClass` property to "Important".</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample1.aspx)]

<span data-ttu-id="5c1c0-144">次に、次の CSS クラス定義を `Styles.css` スタイルシートに追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-144">Next, add the following CSS class definition to the `Styles.css` stylesheet:</span></span>

[!code-css[Main](assigning-roles-to-users-cs/samples/sample2.css)]

<span data-ttu-id="5c1c0-145">この CSS 定義は、大きな赤いフォントを使用してラベルを表示するようにブラウザーに指示します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-145">This CSS definition instructs the browser to display the Label using a large, red font.</span></span> <span data-ttu-id="5c1c0-146">図1は、Visual Studio デザイナーを使用したこの効果を示しています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-146">Figure 1 shows this effect through the Visual Studio Designer.</span></span>

<span data-ttu-id="5c1c0-147">[ラベルの CssClass プロパティを ![と、大きな赤いフォントになります。](assigning-roles-to-users-cs/_static/image2.png)](assigning-roles-to-users-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-147">[![The Label's CssClass Property Results in a Large, Red Font](assigning-roles-to-users-cs/_static/image2.png)](assigning-roles-to-users-cs/_static/image1.png)</span></span>

<span data-ttu-id="5c1c0-148">**図 1**: ラベルの `CssClass` プロパティによって大きなフォントが生成される ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-148">**Figure 1**: The Label's `CssClass` Property Results in a Large, Red Font  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image3.png))</span></span>

<span data-ttu-id="5c1c0-149">次に、DropDownList をページに追加し、その `ID` プロパティを `UserList`に設定し、その `AutoPostBack` プロパティを True に設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-149">Next, add a DropDownList to the page, set its `ID` property to `UserList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="5c1c0-150">この DropDownList を使用して、システム内のすべてのユーザーが一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-150">We will use this DropDownList to list all of the users in the system.</span></span> <span data-ttu-id="5c1c0-151">この DropDownList は、MembershipUser オブジェクトのコレクションにバインドされます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-151">This DropDownList will be bound to a collection of MembershipUser objects.</span></span> <span data-ttu-id="5c1c0-152">DropDownList で MembershipUser オブジェクトの UserName プロパティを表示し、それをリスト項目の値として使用するため、DropDownList の `DataTextField` と `DataValueField` のプロパティを "UserName" に設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-152">Because we want the DropDownList to display the UserName property of the MembershipUser object (and use it as the value of the list items), set the DropDownList's `DataTextField` and `DataValueField` properties to "UserName".</span></span>

<span data-ttu-id="5c1c0-153">DropDownList の下に、`UsersRoleList`という名前のリピータを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-153">Underneath the DropDownList, add a Repeater named `UsersRoleList`.</span></span> <span data-ttu-id="5c1c0-154">このリピータには、システム内のすべてのロールが一連のチェックボックスとして一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-154">This Repeater will list all of the roles in the system as a series of checkboxes.</span></span> <span data-ttu-id="5c1c0-155">次の宣言型マークアップを使用して、リピータの `ItemTemplate` を定義します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-155">Define the Repeater's `ItemTemplate` using the following declarative markup:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample3.aspx)]

<span data-ttu-id="5c1c0-156">`ItemTemplate` マークアップには、`RoleCheckBox`という1つのチェックボックス Web コントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-156">The `ItemTemplate` markup includes a single CheckBox Web control named `RoleCheckBox`.</span></span> <span data-ttu-id="5c1c0-157">チェックボックスの `AutoPostBack` プロパティは True に設定され、`Text` プロパティは `Container.DataItem`にバインドされます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-157">The CheckBox's `AutoPostBack` property is set to True and the `Text` property is bound to `Container.DataItem`.</span></span> <span data-ttu-id="5c1c0-158">Databinding 構文が単に `Container.DataItem` のは、ロールフレームワークがロール名のリストを文字列配列として返すためです。この文字列配列は、リピータにバインドされます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-158">The reason the databinding syntax is simply `Container.DataItem` is because the Roles framework returns the list of role names as a string array, and it is this string array that we will be binding to the Repeater.</span></span> <span data-ttu-id="5c1c0-159">データ Web コントロールにバインドされた配列の内容を表示するためにこの構文を使用する理由の詳細については、このチュートリアルでは説明しません。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-159">A thorough description of why this syntax is used to display the contents of an array bound to a data Web control is beyond the scope of this tutorial.</span></span> <span data-ttu-id="5c1c0-160">詳細については、「[データ Web コントロールへのスカラー配列のバインド](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-160">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="5c1c0-161">この時点で、"ユーザー別" インターフェイスの宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-161">At this point your "by user" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample4.aspx)]

<span data-ttu-id="5c1c0-162">これで、ユーザーアカウントのセットを DropDownList および一連のロールにバインドするコードを作成する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-162">We are now ready to write the code to bind the set of user accounts to the DropDownList and the set of roles to the Repeater.</span></span> <span data-ttu-id="5c1c0-163">ページの分離コードクラスで、次のコードを使用して、`BindUsersToUserList` という名前のメソッドと、別の名前付き `BindRolesList`を追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-163">In the page's code-behind class, add a method named `BindUsersToUserList` and another named `BindRolesList`, using the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample5.cs)]

<span data-ttu-id="5c1c0-164">`BindUsersToUserList` メソッドは、 [`Membership.GetAllUsers` メソッド](https://msdn.microsoft.com/library/dy8swhya.aspx)を使用して、システム内のすべてのユーザーアカウントを取得します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-164">The `BindUsersToUserList` method retrieves all of the user accounts in the system via the [`Membership.GetAllUsers` method](https://msdn.microsoft.com/library/dy8swhya.aspx).</span></span> <span data-ttu-id="5c1c0-165">これにより、 [`MembershipUser` インスタンス](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx)のコレクションである[`MembershipUserCollection` オブジェクト](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx)が返されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-165">This returns a [`MembershipUserCollection` object](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx), which is a collection of [`MembershipUser` instances](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx).</span></span> <span data-ttu-id="5c1c0-166">このコレクションは `UserList` DropDownList にバインドされます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-166">This collection is then bound to the `UserList` DropDownList.</span></span> <span data-ttu-id="5c1c0-167">コレクションを構成する `MembershipUser` インスタンスには、`UserName`、`Email`、`CreationDate`、`IsOnline`などのさまざまなプロパティが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-167">The `MembershipUser` instances that makeup the collection contain a variety of properties, like `UserName`, `Email`, `CreationDate`, and `IsOnline`.</span></span> <span data-ttu-id="5c1c0-168">DropDownList に `UserName` プロパティの値を表示するように指示するには、`UserList` DropDownList の `DataTextField` プロパティと `DataValueField` プロパティが "UserName" に設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-168">In order to instruct the DropDownList to display the value of the `UserName` property, ensure that the `UserList` DropDownList's `DataTextField` and `DataValueField` properties have been set to "UserName".</span></span>

> [!NOTE]
> <span data-ttu-id="5c1c0-169">`Membership.GetAllUsers` メソッドには、2つのオーバーロードがあります。1つは入力パラメーターを受け取り、すべてのユーザーを返します。もう1つは、ページインデックスとページサイズの整数値を受け取り、指定されたユーザーのサブセットのみを返します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-169">The `Membership.GetAllUsers` method has two overloads: one that accepts no input parameters and returns all of the users, and one that takes in integer values for the page index and page size, and returns only the specified subset of the users.</span></span> <span data-ttu-id="5c1c0-170">ページング可能なユーザーインターフェイス要素に大量のユーザーアカウントが表示されている場合は、2番目のオーバーロードを使用して、すべてのユーザーアカウントではなくユーザーアカウントの正確なサブセットだけを返すため、ユーザーをより効率的にページングできます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-170">When there are large amounts of user accounts being displayed in a pageable user interface element, the second overload can be used to more efficiently page through the users since it returns just the precise subset of user accounts rather than all of them.</span></span>

<span data-ttu-id="5c1c0-171">`BindRolesToList` メソッドは、`Roles` クラスの[`GetAllRoles` メソッド](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx)を呼び出すことによって開始されます。このメソッドは、システム内のロールを格納する文字列配列を返します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-171">The `BindRolesToList` method starts by calling the `Roles` class's [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx), which returns a string array containing the roles in the system.</span></span> <span data-ttu-id="5c1c0-172">その後、この文字列配列はリピータにバインドされます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-172">This string array is then bound to the Repeater.</span></span>

<span data-ttu-id="5c1c0-173">最後に、ページが最初に読み込まれるときに、これらの2つのメソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-173">Finally, we need to call these two methods when the page is first loaded.</span></span> <span data-ttu-id="5c1c0-174">`Page_Load` イベント ハンドラーに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-174">Add the following code to the `Page_Load` event handler:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample6.cs)]

<span data-ttu-id="5c1c0-175">このコードが用意されているので、ブラウザーを使用してページにアクセスします。画面は図2のようになります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-175">With this code in place, take a moment to visit the page through a browser; your screen should look similar to Figure 2.</span></span> <span data-ttu-id="5c1c0-176">すべてのユーザーアカウントがドロップダウンリストに入力され、その下に各ロールがチェックボックスとして表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-176">All of the user accounts are populated in the drop-down list and, underneath that, each role appears as a checkbox.</span></span> <span data-ttu-id="5c1c0-177">DropDownList とチェックボックスの `AutoPostBack` のプロパティを True に設定すると、選択したユーザーを変更したり、ロールを確認またはオフにしたりするとポストバックが発生します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-177">Because we set the `AutoPostBack` properties of the DropDownList and CheckBoxes to True, changing the selected user or checking or unchecking a role causes a postback.</span></span> <span data-ttu-id="5c1c0-178">ただし、これらのアクションを処理するコードを記述していないため、アクションは実行されません。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-178">No action is performed, however, because we have yet to write code to handle these actions.</span></span> <span data-ttu-id="5c1c0-179">これらのタスクについては、次の2つのセクションで説明します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-179">We'll tackle these tasks in the next two sections.</span></span>

<span data-ttu-id="5c1c0-180">[![ページにユーザーとロールが表示されます。](assigning-roles-to-users-cs/_static/image5.png)](assigning-roles-to-users-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-180">[![The Page Displays the Users and Roles](assigning-roles-to-users-cs/_static/image5.png)](assigning-roles-to-users-cs/_static/image4.png)</span></span>

<span data-ttu-id="5c1c0-181">**図 2**: ページにユーザーとロールが表示される ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image6.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-181">**Figure 2**: The Page Displays the Users and Roles  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image6.png))</span></span>

### <a name="checking-the-roles-the-selected-user-belongs-to"></a><span data-ttu-id="5c1c0-182">選択したユーザーが属しているロールを確認しています</span><span class="sxs-lookup"><span data-stu-id="5c1c0-182">Checking the Roles the Selected User Belongs To</span></span>

<span data-ttu-id="5c1c0-183">ページが最初に読み込まれるとき、またはユーザーがドロップダウンリストから新しいユーザーを選択するたびに、選択したユーザーがそのロールに属している場合にのみ、特定のロールチェックボックスがオンになるように、`UsersRoleList`のチェックボックスを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-183">When the page is first loaded, or whenever the visitor selects a new user from the drop-down list, we need to update the `UsersRoleList`'s checkboxes so that a given role checkbox is checked only if the selected user belongs to that role.</span></span> <span data-ttu-id="5c1c0-184">これを実現するには、次のコードを使用して、`CheckRolesForSelectedUser` という名前のメソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-184">To accomplish this, create a method named `CheckRolesForSelectedUser` with the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample7.cs)]

<span data-ttu-id="5c1c0-185">上記のコードは、選択したユーザーを特定することによって開始されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-185">The above code starts by determining who the selected user is.</span></span> <span data-ttu-id="5c1c0-186">次に、Roles クラスの[`GetRolesForUser(userName)` メソッド](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx)を使用して、指定されたユーザーのロールセットを文字列配列として返します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-186">It then uses the Roles class's [`GetRolesForUser(userName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx) to return the specified user's set of roles as a string array.</span></span> <span data-ttu-id="5c1c0-187">次に、リピータの項目が列挙され、各項目の `RoleCheckBox` チェックボックスがプログラムによって参照されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-187">Next, the Repeater's items are enumerated and each item's `RoleCheckBox` CheckBox is programmatically referenced.</span></span> <span data-ttu-id="5c1c0-188">チェックボックスがオンになっているのは、対応するロールが `selectedUsersRoles` string 配列内に含まれている場合のみです。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-188">The CheckBox is checked only if the role it corresponds to is contained within the `selectedUsersRoles` string array.</span></span>

> [!NOTE]
> <span data-ttu-id="5c1c0-189">ASP.NET バージョン2.0 を使用している場合、`selectedUserRoles.Contains<string>(...)` 構文はコンパイルされません。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-189">The `selectedUserRoles.Contains<string>(...)` syntax will not compile if you are using ASP.NET version 2.0.</span></span> <span data-ttu-id="5c1c0-190">`Contains<string>` メソッドは、ASP.NET 3.5 の新しい[LINQ ライブラリ](http://en.wikipedia.org/wiki/Language_Integrated_Query)の一部です。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-190">The `Contains<string>` method is part of the [LINQ library](http://en.wikipedia.org/wiki/Language_Integrated_Query), which is new to ASP.NET 3.5.</span></span> <span data-ttu-id="5c1c0-191">ASP.NET バージョン2.0 をまだ使用している場合は、代わりに[`Array.IndexOf<string>` メソッド](https://msdn.microsoft.com/library/eha9t187.aspx)を使用します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-191">If you are still using ASP.NET version 2.0, use the [`Array.IndexOf<string>` method](https://msdn.microsoft.com/library/eha9t187.aspx) instead.</span></span>

<span data-ttu-id="5c1c0-192">`CheckRolesForSelectedUser` メソッドは、ページが最初に読み込まれたときと、`UserList` DropDownList の選択されたインデックスが変更されたときの2つの場合に呼び出される必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-192">The `CheckRolesForSelectedUser` method needs to be called in two cases: when the page is first loaded and whenever the `UserList` DropDownList's selected index is changed.</span></span> <span data-ttu-id="5c1c0-193">したがって、`Page_Load` イベントハンドラーからこのメソッドを呼び出します (`BindUsersToUserList` と `BindRolesToList`を呼び出した後)。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-193">Therefore, call this method from the `Page_Load` event handler (after the calls to `BindUsersToUserList` and `BindRolesToList`).</span></span> <span data-ttu-id="5c1c0-194">また、DropDownList の `SelectedIndexChanged` イベントのイベントハンドラーを作成し、そこからこのメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-194">Also, create an event handler for the DropDownList's `SelectedIndexChanged` event and call this method from there.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample8.cs)]

<span data-ttu-id="5c1c0-195">このコードを配置すると、ブラウザーでページをテストできます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-195">With this code in place, you can test the page through the browser.</span></span> <span data-ttu-id="5c1c0-196">ただし、`UsersAndRoles.aspx` のページには現在、ユーザーをロールに割り当てる機能がないため、ロールを持つユーザーはいません。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-196">However, since the `UsersAndRoles.aspx` page currently lacks the ability to assign users to roles, no users have roles.</span></span> <span data-ttu-id="5c1c0-197">ここでは、ユーザーをロールに割り当てるためのインターフェイスを作成します。このコードが動作することを確認し、後で実行することを確認します。または、この機能を今すぐテストするために、`aspnet_UsersInRoles` テーブルにレコードを挿入してユーザーを手動でロールに追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-197">We will create the interface for assigning users to roles in a moment, so you can either take my word that this code works and verify that it does so later, or you can manually add users to roles by inserting records into the `aspnet_UsersInRoles` table in order to test this functionality now.</span></span>

### <a name="assigning-and-removing-users-from-roles"></a><span data-ttu-id="5c1c0-198">ロールへのユーザーの割り当てと削除</span><span class="sxs-lookup"><span data-stu-id="5c1c0-198">Assigning and Removing Users from Roles</span></span>

<span data-ttu-id="5c1c0-199">ビジターが `UsersRoleList` リピータのチェックボックスをオンまたはオフにしたときに、対応するロールから選択したユーザーを追加または削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-199">When the visitor checks or unchecks a CheckBox in the `UsersRoleList` Repeater we need to add or remove the selected user from the corresponding role.</span></span> <span data-ttu-id="5c1c0-200">現在、チェックボックスの `AutoPostBack` プロパティは True に設定されています。これにより、Repeater のチェックボックスがオンまたはオフになるたびにポストバックが発生します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-200">The CheckBox's `AutoPostBack` property is currently set to True, which causes a postback anytime a CheckBox in the Repeater is checked or unchecked.</span></span> <span data-ttu-id="5c1c0-201">つまり、CheckBox の `CheckChanged` イベントのイベントハンドラーを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-201">In short, we need to create an event handler for the CheckBox's `CheckChanged` event.</span></span> <span data-ttu-id="5c1c0-202">このチェックボックスは Repeater コントロールにあるため、イベントハンドラーの組み込みを手動で追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-202">Since the CheckBox is in a Repeater control, we need to manually add the event handler plumbing.</span></span> <span data-ttu-id="5c1c0-203">まず、次のように、コードビハインドクラスに `protected` メソッドとしてイベントハンドラーを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-203">Start by adding the event handler to the code-behind class as a `protected` method, like so:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample9.cs)]

<span data-ttu-id="5c1c0-204">このイベントハンドラーのコードをすぐに記述するために、を返します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-204">We will return to write the code for this event handler in a moment.</span></span> <span data-ttu-id="5c1c0-205">では、最初にイベント処理の組み込みを完了してみましょう。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-205">But first let's complete the event handling plumbing.</span></span> <span data-ttu-id="5c1c0-206">リピータの `ItemTemplate`内のチェックボックスで、`OnCheckedChanged="RoleCheckBox_CheckChanged"`を追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-206">From the CheckBox within the Repeater's `ItemTemplate`, add `OnCheckedChanged="RoleCheckBox_CheckChanged"`.</span></span> <span data-ttu-id="5c1c0-207">この構文は、`RoleCheckBox_CheckChanged` イベントハンドラーを `RoleCheckBox`の `CheckedChanged` イベントに配線します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-207">This syntax wires the `RoleCheckBox_CheckChanged` event handler to the `RoleCheckBox`'s `CheckedChanged` event.</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample10.aspx)]

<span data-ttu-id="5c1c0-208">最後に、`RoleCheckBox_CheckChanged` イベントハンドラーを完成させます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-208">Our final task is to complete the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="5c1c0-209">この CheckBox インスタンスは、`Text` と `Checked` のプロパティを使用してチェックされたロールまたはチェック解除されたロールを示すので、イベントを発生させた CheckBox コントロールを参照することから始める必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-209">We need to start by referencing the CheckBox control that raised the event because this CheckBox instance tells us what role was checked or unchecked via its `Text` and `Checked` properties.</span></span> <span data-ttu-id="5c1c0-210">この情報を選択したユーザーのユーザー名と共に使用して、`Roles` クラスの[`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx)または[`RemoveUserFromRole` メソッド](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx)を使用して、ロールのユーザーを追加または削除します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-210">Using this information along with the UserName of the selected user, we add or remove the user from the role via the `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx) or [`RemoveUserFromRole` method](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx).</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample11.cs)]

<span data-ttu-id="5c1c0-211">上のコードは、イベントを発生させたチェックボックスをプログラムによって参照することから始まります。これは、`sender` 入力パラメーターを通じて利用できます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-211">The above code starts by programmatically referencing the CheckBox that raised the event, which is available via the `sender` input parameter.</span></span> <span data-ttu-id="5c1c0-212">チェックボックスをオンにすると、選択したユーザーが指定したロールに追加されます。それ以外の場合は、ロールから削除されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-212">If the CheckBox is checked, the selected user is added to the specified role, otherwise they are removed from the role.</span></span> <span data-ttu-id="5c1c0-213">どちらの場合も、`ActionStatus` ラベルには、実行されたアクションの概要を示したメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-213">In either case, the `ActionStatus` Label displays a message summarizing the action just performed.</span></span>

<span data-ttu-id="5c1c0-214">ブラウザーでこのページをテストしてみましょう。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-214">Take a moment to test out this page through a browser.</span></span> <span data-ttu-id="5c1c0-215">[ユーザー Tito] を選択してから、[管理者] ロールと [スーパーバイザー] ロールの両方に Tito を追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-215">Select user Tito and then add Tito to both the Administrators and Supervisors roles.</span></span>

<span data-ttu-id="5c1c0-216">[![Tito が Administrators ロールと監修者ロールに追加されました](assigning-roles-to-users-cs/_static/image8.png)](assigning-roles-to-users-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-216">[![Tito Has Been Added to the Administrators and Supervisors Roles](assigning-roles-to-users-cs/_static/image8.png)](assigning-roles-to-users-cs/_static/image7.png)</span></span>

<span data-ttu-id="5c1c0-217">**図 3**: [管理者] と [スーパーバイザー] のロールに Tito が追加されました ([クリックしてフルサイズの画像を表示し](assigning-roles-to-users-cs/_static/image9.png)ます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-217">**Figure 3**: Tito Has Been Added to the Administrators and Supervisors Roles  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image9.png))</span></span>

<span data-ttu-id="5c1c0-218">次に、ドロップダウンリストから [ユーザー] を選択します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-218">Next, select user Bruce from the drop-down list.</span></span> <span data-ttu-id="5c1c0-219">ポストバックが存在し、リピータのチェックボックスが `CheckRolesForSelectedUser`によって更新されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-219">There is a postback and the Repeater's CheckBoxes are updated via the `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="5c1c0-220">まだロールに属していないため、2つのチェックボックスはオフになっています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-220">Since Bruce does not yet belong to any roles, the two checkboxes are unchecked.</span></span> <span data-ttu-id="5c1c0-221">次に、監督者ロールにを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-221">Next, add Bruce to the Supervisors role.</span></span>

<span data-ttu-id="5c1c0-222">[![が監修者ロールに追加されました](assigning-roles-to-users-cs/_static/image11.png)](assigning-roles-to-users-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-222">[![Bruce Has Been Added to the Supervisors Role](assigning-roles-to-users-cs/_static/image11.png)](assigning-roles-to-users-cs/_static/image10.png)</span></span>

<span data-ttu-id="5c1c0-223">**図 4**: スーパーバイザーロールに追加されました ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-223">**Figure 4**: Bruce Has Been Added to the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image12.png))</span></span>

<span data-ttu-id="5c1c0-224">`CheckRolesForSelectedUser` メソッドの機能をさらに確認するには、Tito またはをクリックしたユーザー以外のユーザーを選択します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-224">To further verify the functionality of the `CheckRolesForSelectedUser` method, select a user other than Tito or Bruce.</span></span> <span data-ttu-id="5c1c0-225">チェックボックスがどのロールにも属していないことを示すチェックボックスが自動的にオフになっていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-225">Note how the checkboxes are automatically unchecked, denoting that they do not belong to any roles.</span></span> <span data-ttu-id="5c1c0-226">Tito に戻ります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-226">Return to Tito.</span></span> <span data-ttu-id="5c1c0-227">[管理者] チェックボックスと [スーパーバイザー] チェックボックスの両方をオンにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-227">Both the Administrators and Supervisors checkboxes should be checked.</span></span>

## <a name="step-2-building-the-by-roles-user-interface"></a><span data-ttu-id="5c1c0-228">手順 2: "ロールによる" ユーザーインターフェイスの構築</span><span class="sxs-lookup"><span data-stu-id="5c1c0-228">Step 2: Building the "By Roles" User Interface</span></span>

<span data-ttu-id="5c1c0-229">この時点で、"ユーザー" インターフェイスが完成し、"ロール別" インターフェイスに取り組む準備が整いました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-229">At this point we have completed the "by users" interface and are ready to start tackling the "by roles" interface.</span></span> <span data-ttu-id="5c1c0-230">"ロール別" インターフェイスは、ドロップダウンリストからロールを選択するようにユーザーに要求し、GridView でそのロールに属するユーザーのセットを表示します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-230">The "by roles" interface prompts the user to select a role from a drop-down list and then displays the set of users that belong to that role in a GridView.</span></span>

<span data-ttu-id="5c1c0-231">`UsersAndRoles.aspx` ページに別の DropDownList コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-231">Add another DropDownList control to the `UsersAndRoles.aspx` page.</span></span> <span data-ttu-id="5c1c0-232">Repeater コントロールの下に配置し、`RoleList`という名前を設定して、その `AutoPostBack` プロパティを True に設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-232">Place this one beneath the Repeater control, name it `RoleList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="5c1c0-233">その下に、GridView を追加し、`RolesUserList`という名前を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-233">Underneath that, add a GridView and name it `RolesUserList`.</span></span> <span data-ttu-id="5c1c0-234">この GridView には、選択したロールに属しているユーザーが一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-234">This GridView will list the users that belong to the selected role.</span></span> <span data-ttu-id="5c1c0-235">GridView の `AutoGenerateColumns` プロパティを False に設定し、グリッドの `Columns` コレクションに TemplateField を追加し、その `HeaderText` プロパティを "Users" に設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-235">Set the GridView's `AutoGenerateColumns` property to False, add a TemplateField to the grid's `Columns` collection, and set its `HeaderText` property to "Users".</span></span> <span data-ttu-id="5c1c0-236">TemplateField の `ItemTemplate` を定義して、`UserNameLabel`という名前のラベルの `Text` プロパティに `Container.DataItem` データバインド式の値が表示されるようにします。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-236">Define the TemplateField's `ItemTemplate` so that it displays the value of the databinding expression `Container.DataItem` in the `Text` property of a Label named `UserNameLabel`.</span></span>

<span data-ttu-id="5c1c0-237">GridView を追加して構成すると、"ロール別" インターフェイスの宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-237">After adding and configuring the GridView, your "by role" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample12.aspx)]

<span data-ttu-id="5c1c0-238">`RoleList` DropDownList にシステムの一連のロールを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-238">We need to populate the `RoleList` DropDownList with the set of roles in the system.</span></span> <span data-ttu-id="5c1c0-239">これを実現するには、`BindRolesToList` メソッドを更新して、`Roles.GetAllRoles` メソッドによって返された文字列配列を `RolesList` DropDownList (および `UsersRoleList` リピータ) にバインドするようにします。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-239">To accomplish this, update the `BindRolesToList` method so that is binds the string array returned by the `Roles.GetAllRoles` method to the `RolesList` DropDownList (as well as the `UsersRoleList` Repeater).</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample13.cs)]

<span data-ttu-id="5c1c0-240">`BindRolesToList` メソッドの最後の2行が追加され、一連のロールを `RoleList` DropDownList コントロールにバインドするようになりました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-240">The last two lines in the `BindRolesToList` method have been added to bind the set of roles to the `RoleList` DropDownList control.</span></span> <span data-ttu-id="5c1c0-241">図5に、ブラウザーで表示した場合の最終的な結果を示します。このドロップダウンリストには、システムのロールが設定されています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-241">Figure 5 shows the end result when viewed through a browser – a drop-down list populated with the system's roles.</span></span>

<span data-ttu-id="5c1c0-242">[ロールが RoleList DropDownList に表示さ ![](assigning-roles-to-users-cs/_static/image14.png)](assigning-roles-to-users-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-242">[![The Roles are Displayed in the RoleList DropDownList](assigning-roles-to-users-cs/_static/image14.png)](assigning-roles-to-users-cs/_static/image13.png)</span></span>

<span data-ttu-id="5c1c0-243">**図 5**: ロールが `RoleList` DropDownList に表示される ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-243">**Figure 5**: The Roles are Displayed in the `RoleList` DropDownList  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image15.png))</span></span>

### <a name="displaying-the-users-that-belong-to-the-selected-role"></a><span data-ttu-id="5c1c0-244">選択したロールに属するユーザーを表示する</span><span class="sxs-lookup"><span data-stu-id="5c1c0-244">Displaying the Users That Belong To the Selected Role</span></span>

<span data-ttu-id="5c1c0-245">ページが最初に読み込まれたとき、または `RoleList` DropDownList から新しいロールが選択されたときに、GridView でそのロールに属しているユーザーの一覧を表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-245">When the page is first loaded, or when a new role is selected from the `RoleList` DropDownList, we need to display the list of users that belong to that role in the GridView.</span></span> <span data-ttu-id="5c1c0-246">次のコードを使用して、`DisplayUsersBelongingToRole` という名前のメソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-246">Create a method named `DisplayUsersBelongingToRole` using the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample14.cs)]

<span data-ttu-id="5c1c0-247">このメソッドは、選択したロールを `RoleList` DropDownList から取得することによって開始します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-247">This method starts by getting the selected role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="5c1c0-248">次に、 [`Roles.GetUsersInRole(roleName)` メソッド](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx)を使用して、そのロールに属するユーザーのユーザー名の文字列配列を取得します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-248">It then uses the [`Roles.GetUsersInRole(roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx) to retrieve a string array of the UserNames of the users that belong to that role.</span></span> <span data-ttu-id="5c1c0-249">この配列は `RolesUserList` GridView にバインドされます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-249">This array is then bound to the `RolesUserList` GridView.</span></span>

<span data-ttu-id="5c1c0-250">このメソッドは、ページが最初に読み込まれたときと `RoleList` DropDownList で選択したロールが変更されたときの2つの状況で呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-250">This method needs to be called in two circumstances: when the page is initially loaded and when the selected role in the `RoleList` DropDownList changes.</span></span> <span data-ttu-id="5c1c0-251">したがって、`CheckRolesForSelectedUser`の呼び出しの後にこのメソッドが呼び出されるように、`Page_Load` イベントハンドラーを更新します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-251">Therefore, update the `Page_Load` event handler so that this method is invoked after the call to `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="5c1c0-252">次に、`RoleList`の `SelectedIndexChanged` イベントのイベントハンドラーを作成し、そこからこのメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-252">Next, create an event handler for the `RoleList`'s `SelectedIndexChanged` event, and call this method from there, too.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample15.cs)]

<span data-ttu-id="5c1c0-253">このコードを配置すると、`RolesUserList` GridView には、選択したロールに属しているユーザーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-253">With this code in place, the `RolesUserList` GridView should display those users that belong to the selected role.</span></span> <span data-ttu-id="5c1c0-254">図6に示すように、監修者ロールは2つのメンバーで構成されています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-254">As Figure 6 shows, the Supervisors role consists of two members: Bruce and Tito.</span></span>

<span data-ttu-id="5c1c0-255">[GridView に ![、選択したロールに属しているユーザーが一覧表示されます。](assigning-roles-to-users-cs/_static/image17.png)](assigning-roles-to-users-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-255">[![The GridView Lists Those Users That Belong to the Selected Role](assigning-roles-to-users-cs/_static/image17.png)](assigning-roles-to-users-cs/_static/image16.png)</span></span>

<span data-ttu-id="5c1c0-256">**図 6**: GridView には、選択したロールに属しているユーザーが一覧表示されます ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-256">**Figure 6**: The GridView Lists Those Users That Belong to the Selected Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image18.png))</span></span>

### <a name="removing-users-from-the-selected-role"></a><span data-ttu-id="5c1c0-257">選択したロールからユーザーを削除しています</span><span class="sxs-lookup"><span data-stu-id="5c1c0-257">Removing Users from the Selected Role</span></span>

<span data-ttu-id="5c1c0-258">`RolesUserList` GridView を拡張して、[削除] ボタンの列が含まれるようにしましょう。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-258">Let's augment the `RolesUserList` GridView so that it includes a column of "Remove" buttons.</span></span> <span data-ttu-id="5c1c0-259">特定のユーザーの [削除] ボタンをクリックすると、そのユーザーがそのロールから削除されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-259">Clicking the "Remove" button for a particular user will remove them from that role.</span></span>

<span data-ttu-id="5c1c0-260">まず、GridView に [削除] ボタンフィールドを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-260">Start by adding a Delete button field to the GridView.</span></span> <span data-ttu-id="5c1c0-261">このフィールドを一番左に表示されるようにして、その `DeleteText` プロパティを "Delete" (既定値) から "Remove" に変更します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-261">Make this field appear as the left most filed and change its `DeleteText` property from "Delete" (the default) to "Remove".</span></span>

<span data-ttu-id="5c1c0-262">[![追加します。](assigning-roles-to-users-cs/_static/image20.png)](assigning-roles-to-users-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-262">[![Add the](assigning-roles-to-users-cs/_static/image20.png)](assigning-roles-to-users-cs/_static/image19.png)</span></span>

<span data-ttu-id="5c1c0-263">**図 7**: GridView に [削除] ボタンを追加する ([クリックすると、フルサイズのイメージが表示](assigning-roles-to-users-cs/_static/image21.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-263">**Figure 7**: Add the "Remove" Button to the GridView  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image21.png))</span></span>

<span data-ttu-id="5c1c0-264">[Remove] ボタンをクリックすると、ポストバック ensues がクリックされ、GridView の `RowDeleting` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-264">When the "Remove" button is clicked a postback ensues and the GridView's `RowDeleting` event is raised.</span></span> <span data-ttu-id="5c1c0-265">このイベントのイベントハンドラーを作成し、選択したロールからユーザーを削除するコードを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-265">We need to create an event handler for this event and write code that removes the user from the selected role.</span></span> <span data-ttu-id="5c1c0-266">イベントハンドラーを作成し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-266">Create the event handler and then add the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample16.cs)]

<span data-ttu-id="5c1c0-267">このコードは、選択したロール名を決定することによって開始されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-267">The code starts by determining the selected role name.</span></span> <span data-ttu-id="5c1c0-268">次に、削除するユーザーのユーザー名を決定するために [削除] ボタンがクリックされた行から、プログラムによって `UserNameLabel` コントロールを参照します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-268">It then programmatically references the `UserNameLabel` control from the row whose "Remove" button was clicked in order to determine the UserName of the user to remove.</span></span> <span data-ttu-id="5c1c0-269">次に、`Roles.RemoveUserFromRole` メソッドの呼び出しを使用して、ユーザーをロールから削除します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-269">The user is then removed from the role via a call to the `Roles.RemoveUserFromRole` method.</span></span> <span data-ttu-id="5c1c0-270">`RolesUserList` GridView が更新され、`ActionStatus` Label コントロールを使用してメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-270">The `RolesUserList` GridView is then refreshed and a message is displayed via the `ActionStatus` Label control.</span></span>

> [!NOTE]
> <span data-ttu-id="5c1c0-271">[削除] ボタンをクリックしても、ロールからユーザーを削除する前に、ユーザーからの確認は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-271">The "Remove" button does not require any sort of confirmation from the user before removing the user from the role.</span></span> <span data-ttu-id="5c1c0-272">いくつかのレベルのユーザー確認を追加するように依頼します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-272">I invite you to add some level of user confirmation.</span></span> <span data-ttu-id="5c1c0-273">アクションを確認する最も簡単な方法の1つは、クライアント側の [確認] ダイアログボックスを使用することです。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-273">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="5c1c0-274">この手法の詳細については、「[削除時にクライアント側の確認を追加](https://asp.net/learn/data-access/tutorial-42-cs.aspx)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-274">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-cs.aspx).</span></span>

<span data-ttu-id="5c1c0-275">図8は、ユーザー Tito が監修者グループから削除された後のページを示しています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-275">Figure 8 shows the page after user Tito has been removed from the Supervisors group.</span></span>

<span data-ttu-id="5c1c0-276">[![悲しい、Tito は上司ではなくなりました。](assigning-roles-to-users-cs/_static/image23.png)](assigning-roles-to-users-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-276">[![Alas, Tito is No Longer a Supervisor](assigning-roles-to-users-cs/_static/image23.png)](assigning-roles-to-users-cs/_static/image22.png)</span></span>

<span data-ttu-id="5c1c0-277">**図 8**: 悲しい。 Tito は上司ではなくなりました ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image24.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-277">**Figure 8**: Alas, Tito is No Longer a Supervisor  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image24.png))</span></span>

### <a name="adding-new-users-to-the-selected-role"></a><span data-ttu-id="5c1c0-278">選択したロールに新しいユーザーを追加しています</span><span class="sxs-lookup"><span data-stu-id="5c1c0-278">Adding New Users to the Selected Role</span></span>

<span data-ttu-id="5c1c0-279">選択したロールからユーザーを削除するだけでなく、このページのビジターは、選択したロールにユーザーを追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-279">Along with removing users from the selected role, the visitor to this page should also be able to add a user to the selected role.</span></span> <span data-ttu-id="5c1c0-280">選択したロールにユーザーを追加するための最適なインターフェイスは、予想されるユーザーアカウントの数によって異なります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-280">The best interface for adding a user to the selected role depends on the number of user accounts you expect to have.</span></span> <span data-ttu-id="5c1c0-281">Web サイトのユーザーアカウントが数十以下である場合は、DropDownList を使用できます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-281">If your website will house just a few dozen user accounts or less, you could use a DropDownList here.</span></span> <span data-ttu-id="5c1c0-282">数千人のユーザーアカウントがある場合は、ユーザーがアカウントを使用してページを表示したり、特定のアカウントを検索したり、他の方法でユーザーアカウントをフィルター処理したりすることを許可するユーザーインターフェイスを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-282">If there might be thousands of user accounts, you would want to include a user interface that permits the visitor to page through the accounts, search for a particular account, or filter the user accounts in some other fashion.</span></span>

<span data-ttu-id="5c1c0-283">このページでは、システム内のユーザーアカウントの数に関係なく機能する非常にシンプルなインターフェイスを使用します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-283">For this page let's use a very simple interface that works regardless of the number of user accounts in the system.</span></span> <span data-ttu-id="5c1c0-284">ここでは、テキストボックスを使用して、選択したロールに追加するユーザーのユーザー名を入力するようにビジターに要求します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-284">Namely, we will use a TextBox, prompting the visitor to type in the username of the user she wants to add to the selected role.</span></span> <span data-ttu-id="5c1c0-285">その名前のユーザーが存在しない場合、またはユーザーが既にロールのメンバーである場合、`ActionStatus` ラベルにメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-285">If no user with that name exists, or if the user is already a member of the role, we'll display a message in `ActionStatus` Label.</span></span> <span data-ttu-id="5c1c0-286">ただし、ユーザーが存在し、ロールのメンバーでない場合は、ロールに追加してグリッドを更新します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-286">But if the user exists and is not a member of the role, we'll add them to the role and refresh the grid.</span></span>

<span data-ttu-id="5c1c0-287">GridView の下にテキストボックスとボタンを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-287">Add a TextBox and Button beneath the GridView.</span></span> <span data-ttu-id="5c1c0-288">テキストボックスの `ID` を `UserNameToAddToRole` に設定し、ボタンの `ID` および `Text` プロパティを `AddUserToRoleButton` に設定し、[ユーザーをロールに追加] をそれぞれ設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-288">Set the TextBox's `ID` to `UserNameToAddToRole` and set the Button's `ID` and `Text` properties to `AddUserToRoleButton` and "Add User to Role", respectively.</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample17.aspx)]

<span data-ttu-id="5c1c0-289">次に、`AddUserToRoleButton` の `Click` イベントハンドラーを作成し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-289">Next, create a `Click` event handler for the `AddUserToRoleButton` and add the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample18.cs)]

<span data-ttu-id="5c1c0-290">`Click` イベントハンドラーのコードの大部分は、さまざまな検証チェックを実行します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-290">The majority of the code in the `Click` event handler performs various validation checks.</span></span> <span data-ttu-id="5c1c0-291">これにより、ビジターが [`UserNameToAddToRole`] ボックスにユーザー名を入力したこと、ユーザーがシステムに存在すること、および選択したロールに属していないことが確認されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-291">It ensures that the visitor supplied a username in the `UserNameToAddToRole` TextBox, that the user exists in the system, and that they don't already belong to the selected role.</span></span> <span data-ttu-id="5c1c0-292">これらのチェックのいずれかが失敗すると、適切なメッセージが `ActionStatus` に表示され、イベントハンドラーが終了します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-292">If any of these checks fails, an appropriate message is displayed in `ActionStatus` and the event handler is exited.</span></span> <span data-ttu-id="5c1c0-293">すべてのチェックに合格した場合、ユーザーは `Roles.AddUserToRole` メソッドを使用してロールに追加されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-293">If all of the checks pass, the user is added to the role via the `Roles.AddUserToRole` method.</span></span> <span data-ttu-id="5c1c0-294">その後、テキストボックスの `Text` プロパティがクリアされ、GridView が更新され、`ActionStatus` ラベルに、指定したユーザーが選択したロールに正常に追加されたことを示すメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-294">Following that, the TextBox's `Text` property is cleared out, the GridView is refreshed, and the `ActionStatus` Label displays a message indicating that the specified user was successfully added to the selected role.</span></span>

> [!NOTE]
> <span data-ttu-id="5c1c0-295">指定されたユーザーがまだ選択されたロールに属していないことを確認するには、 [`Roles.IsUserInRole(userName, roleName)` メソッド](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx)を使用します。このメソッドは、 *userName*が*roleName*のメンバーであるかどうかを示すブール値を返します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-295">To ensure that the specified user does not already belong to the selected role, we use the [`Roles.IsUserInRole(userName, roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx), which returns a Boolean value indicating whether *userName* is a member of *roleName*.</span></span> <span data-ttu-id="5c1c0-296">このメソッドは、ロールベースの承認<a id="_msoanchor_2"></a>を確認するときに、[次のチュートリアル](role-based-authorization-cs.md)でもう一度使用します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-296">We will use this method again in the <a id="_msoanchor_2"></a>[next tutorial](role-based-authorization-cs.md) when we look at role-based authorization.</span></span>

<span data-ttu-id="5c1c0-297">ブラウザーを使用してページを参照し、`RoleList` DropDownList からスーパーバイザーロールを選択します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-297">Visit the page through a browser and select the Supervisors role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="5c1c0-298">無効なユーザー名を入力してみてください。ユーザーがシステムに存在しないことを示すメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-298">Try entering an invalid username – you should see a message explaining that the user does not exist in the system.</span></span>

<span data-ttu-id="5c1c0-299">[![存在しないユーザーをロールに追加することはできません](assigning-roles-to-users-cs/_static/image26.png)](assigning-roles-to-users-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-299">[![You Cannot Add a Non-Existent User to a Role](assigning-roles-to-users-cs/_static/image26.png)](assigning-roles-to-users-cs/_static/image25.png)</span></span>

<span data-ttu-id="5c1c0-300">**図 9**: 存在しないユーザーをロールに追加することはできません ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image27.png)される)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-300">**Figure 9**: You Cannot Add a Non-Existent User to a Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image27.png))</span></span>

<span data-ttu-id="5c1c0-301">次に、有効なユーザーを追加してみます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-301">Now try adding a valid user.</span></span> <span data-ttu-id="5c1c0-302">先に進んで、"上司" ロールに追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-302">Go ahead and re-add Tito to the Supervisors role.</span></span>

<span data-ttu-id="5c1c0-303">[![Tito はもう一度上司になります。](assigning-roles-to-users-cs/_static/image29.png)](assigning-roles-to-users-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-303">[![Tito Is Once Again a Supervisor!](assigning-roles-to-users-cs/_static/image29.png)](assigning-roles-to-users-cs/_static/image28.png)</span></span>

<span data-ttu-id="5c1c0-304">**図 10**: もう一度スーパーバイザーになる tito</span><span class="sxs-lookup"><span data-stu-id="5c1c0-304">**Figure 10**: Tito Is Once Again a Supervisor!</span></span>  <span data-ttu-id="5c1c0-305">([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image30.png)される)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-305">([Click to view full-size image](assigning-roles-to-users-cs/_static/image30.png))</span></span>

## <a name="step-3-cross-updating-the-by-user-and-by-role-interfaces"></a><span data-ttu-id="5c1c0-306">手順 3: "ユーザー" および "ロール別" のインターフェイスをクロス更新する</span><span class="sxs-lookup"><span data-stu-id="5c1c0-306">Step 3: Cross-Updating the "By User" and "By Role" Interfaces</span></span>

<span data-ttu-id="5c1c0-307">`UsersAndRoles.aspx` のページには、ユーザーとロールを管理するための2つの異なるインターフェイスが用意されています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-307">The `UsersAndRoles.aspx` page offers two distinct interfaces for managing users and roles.</span></span> <span data-ttu-id="5c1c0-308">現時点では、これら2つのインターフェイスは相互に独立して動作するため、1つのインターフェイスで行われた変更がすぐには反映されない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-308">Currently, these two interfaces act independently of one another so it is possible that a change made in one interface will not be reflected immediately in the other.</span></span> <span data-ttu-id="5c1c0-309">たとえば、ページへの訪問者が `RoleList` DropDownList からスーパーバイザーロールを選択したとします。これは、メンバーとして表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-309">For example, imagine that the visitor to the page selects the Supervisors role from the `RoleList` DropDownList, which lists Bruce and Tito as its members.</span></span> <span data-ttu-id="5c1c0-310">次に、ビジターは `UserList` DropDownList から Tito を選択します。これにより、`UsersRoleList` リピータの [管理者] チェックボックスと [スーパーバイザー] チェックボックスがオンになります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-310">Next, the visitor selects Tito from the `UserList` DropDownList, which checks the Administrators and Supervisors checkboxes in the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="5c1c0-311">その後、訪問者がリピータからスーパーバイザーロールをオフにすると、スーパーバイザーロールから Tito が削除されますが、この変更は "ロールごと" のインターフェイスには反映されません。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-311">If the visitor then unchecks the Supervisor role from the Repeater, Tito is removed from the Supervisors role, but this modification is not reflected in the "by role" interface.</span></span> <span data-ttu-id="5c1c0-312">GridView は、スーパーバイザーロールのメンバーであるとしても表示されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-312">The GridView will still show Tito as being a member of the Supervisors role.</span></span>

<span data-ttu-id="5c1c0-313">この問題を解決するには、`UsersRoleList` リピータからロールがオンまたはオフになったときに、GridView を更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-313">To fix this we need to refresh the GridView whenever a role is checked or unchecked from the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="5c1c0-314">同様に、ユーザーが削除されるか、ロールに "by role" インターフェイスから追加されるたびに、リピータを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-314">Likewise, we need to refresh the Repeater whenever a user is removed or added to a role from the "by role" interface.</span></span>

<span data-ttu-id="5c1c0-315">"ユーザー" インターフェイスのリピータは、`CheckRolesForSelectedUser` メソッドを呼び出すことによって更新されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-315">The Repeater in the "by user" interface is refreshed by calling the `CheckRolesForSelectedUser` method.</span></span> <span data-ttu-id="5c1c0-316">"ロール別" インターフェイスは `RolesUserList` GridView の `RowDeleting` イベントハンドラーと、`AddUserToRoleButton` ボタンの `Click` イベントハンドラーで変更できます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-316">The "by role" interface can be modified in the `RolesUserList` GridView's `RowDeleting` event handler and the `AddUserToRoleButton` Button's `Click` event handler.</span></span> <span data-ttu-id="5c1c0-317">そのため、これらの各メソッドから `CheckRolesForSelectedUser` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-317">Therefore, we need to call the `CheckRolesForSelectedUser` method from each of these methods.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample19.cs)]

<span data-ttu-id="5c1c0-318">同様に、"by role" インターフェイスの GridView は、`DisplayUsersBelongingToRole` メソッドを呼び出すことによって更新され、"user" インターフェイスが `RoleCheckBox_CheckChanged` イベントハンドラーによって変更されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-318">Similarly, the GridView in the "by role" interface is refreshed by calling the `DisplayUsersBelongingToRole` method and the "by user" interface is modified through the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="5c1c0-319">したがって、このイベントハンドラーから `DisplayUsersBelongingToRole` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-319">Therefore, we need to call the `DisplayUsersBelongingToRole` method from this event handler.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample20.cs)]

<span data-ttu-id="5c1c0-320">これらの軽微なコード変更により、"by user" インターフェイスと "role" インターフェイスが正常にクロス更新されるようになりました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-320">With these minor code changes, the "by user" and "by role" interfaces now correctly cross-update.</span></span> <span data-ttu-id="5c1c0-321">これを確認するには、ブラウザーを使用してページにアクセスし、[`UserList`] と [`RoleList`] の各リストから [Tito] と [スーパーバイザー] をそれぞれ選択します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-321">To verify this, visit the page through a browser and select Tito and Supervisors from the `UserList` and `RoleList` DropDownLists, respectively.</span></span> <span data-ttu-id="5c1c0-322">"ユーザー" インターフェイスでリピータから Tito のスーパーバイザーロールをオフにすると、"by role" インターフェイスの GridView から Tito が自動的に削除されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-322">Note that as you uncheck the Supervisors role for Tito from the Repeater in the "by user" interface, Tito is automatically removed from the GridView in the "by role" interface.</span></span> <span data-ttu-id="5c1c0-323">"ロール別" インターフェイスからスーパーバイザーロールに Tito を追加すると、"ユーザー" インターフェイスのスーパーバイザーチェックボックスが自動的に再チェックされます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-323">Adding Tito back to the Supervisors role from the "by role" interface automatically re-checks the Supervisors checkbox in the "by user" interface.</span></span>

## <a name="step-4-customizing-the-createuserwizard-to-include-a-specify-roles-step"></a><span data-ttu-id="5c1c0-324">手順 4: "ロールの指定" 手順を含むように CreateUserWizard をカスタマイズする</span><span class="sxs-lookup"><span data-stu-id="5c1c0-324">Step 4: Customizing the CreateUserWizard to Include a "Specify Roles" Step</span></span>

<span data-ttu-id="5c1c0-325"><a id="_msoanchor_3"> </a>「[*ユーザーアカウントの作成*](../membership/creating-user-accounts-cs.md)」チュートリアルでは、CreateUserWizard Web コントロールを使用して、新しいユーザーアカウントを作成するためのインターフェイスを提供する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-325">In the <a id="_msoanchor_3"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial we saw how to use the CreateUserWizard Web control to provide an interface for creating a new user account.</span></span> <span data-ttu-id="5c1c0-326">CreateUserWizard コントロールは、次の2つの方法のいずれかで使用できます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-326">The CreateUserWizard control can be used in one of two ways:</span></span>

- <span data-ttu-id="5c1c0-327">訪問者がサイトで独自のユーザーアカウントを作成するための手段として、</span><span class="sxs-lookup"><span data-stu-id="5c1c0-327">As a means for visitors to create their own user account on the site, and</span></span>
- <span data-ttu-id="5c1c0-328">管理者が新しいアカウントを作成するための手段として</span><span class="sxs-lookup"><span data-stu-id="5c1c0-328">As a means for administrators to create new accounts</span></span>

<span data-ttu-id="5c1c0-329">最初のユースケースでは、ビジターはサイトに入力し、CreateUserWizard に入力して、サイトに登録するための情報を入力します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-329">In the first use case, a visitor comes to the site and fills out the CreateUserWizard, entering their information in order to register on the site.</span></span> <span data-ttu-id="5c1c0-330">2番目のケースでは、管理者が別のユーザーの新しいアカウントを作成します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-330">In the second case, an administrator creates a new account for another person.</span></span>

<span data-ttu-id="5c1c0-331">他のユーザーの管理者によってアカウントが作成されている場合は、新しいユーザーアカウントが属するロールを管理者が指定できるようにすると便利な場合があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-331">When an account is being created by an administrator for some other person, it might be helpful to allow the administrator to specify what roles the new user account belongs to.</span></span> <span data-ttu-id="5c1c0-332"><a id="_msoanchor_4"> </a> [ *追加のユーザー情報*の格納に関する](../membership/storing-additional-user-information-cs.md)チュートリアルでは、`WizardSteps`を追加して CreateUserWizard をカスタマイズする方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-332">In the <a id="_msoanchor_4"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-cs.md) tutorial we saw how to customize the CreateUserWizard by adding additional `WizardSteps`.</span></span> <span data-ttu-id="5c1c0-333">新しいユーザーのロールを指定するために、CreateUserWizard に追加の手順を追加する方法を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-333">Let's look at how to add an additional step to the CreateUserWizard in order to specify the new user's roles.</span></span>

<span data-ttu-id="5c1c0-334">`CreateUserWizardWithRoles.aspx` ページを開き、`RegisterUserWithRoles`という名前の CreateUserWizard コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-334">Open the `CreateUserWizardWithRoles.aspx` page and add a CreateUserWizard control named `RegisterUserWithRoles`.</span></span> <span data-ttu-id="5c1c0-335">コントロールの `ContinueDestinationPageUrl` プロパティを "~/Default.aspx" に設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-335">Set the control's `ContinueDestinationPageUrl` property to "~/Default.aspx".</span></span> <span data-ttu-id="5c1c0-336">ここでの考え方は、管理者がこの CreateUserWizard コントロールを使用して新しいユーザーアカウントを作成することであるため、コントロールの `LoginCreatedUser` プロパティを False に設定するということです。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-336">Because the idea here is that an administrator will be using this CreateUserWizard control to create new user accounts, set the control's `LoginCreatedUser` property to False.</span></span> <span data-ttu-id="5c1c0-337">この `LoginCreatedUser` プロパティは、ビジターが作成されたユーザーとして自動的にログオンするかどうかを指定します。既定値は True です。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-337">This `LoginCreatedUser` property specifies whether the visitor is automatically logged on as the just-created user, and it defaults to True.</span></span> <span data-ttu-id="5c1c0-338">管理者が新しいアカウントを作成するときに、サインインしたままにしておきたいので、False に設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-338">We set it to False because when an administrator creates a new account we want to keep him signed in as himself.</span></span>

<span data-ttu-id="5c1c0-339">次に、[`WizardSteps`の追加と削除] を選択します。CreateUserWizard のスマートタグからオプションを選択し、新しい `WizardStep`を追加して、`ID` を `SpecifyRolesStep`に設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-339">Next, select the "Add/Remove `WizardSteps`…" option from the CreateUserWizard's Smart Tag and add a new `WizardStep`, setting its `ID` to `SpecifyRolesStep`.</span></span> <span data-ttu-id="5c1c0-340">"新しいアカウントにサインアップする" 手順の後、"Complete" 手順の前に、`SpecifyRolesStep WizardStep` を移動します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-340">Move the `SpecifyRolesStep WizardStep` so that it comes after the "Sign Up for Your New Account" step, but before the "Complete" step.</span></span> <span data-ttu-id="5c1c0-341">`WizardStep`の `Title` プロパティを "Roles" を指定し、その `StepType` プロパティを `Step`に、その `AllowReturn` プロパティを False に設定します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-341">Set the `WizardStep`'s `Title` property to "Specify Roles", its `StepType` property to `Step`, and its `AllowReturn` property to False.</span></span>

<span data-ttu-id="5c1c0-342">[![追加します。](assigning-roles-to-users-cs/_static/image32.png)](assigning-roles-to-users-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-342">[![Add the](assigning-roles-to-users-cs/_static/image32.png)](assigning-roles-to-users-cs/_static/image31.png)</span></span>

<span data-ttu-id="5c1c0-343">**図 11**: [ロールの指定 `WizardStep`] を CreateUserWizard に追加する ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image33.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-343">**Figure 11**: Add the "Specify Roles" `WizardStep` to the CreateUserWizard  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image33.png))</span></span>

<span data-ttu-id="5c1c0-344">この変更を行った後、CreateUserWizard の宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-344">After this change your CreateUserWizard's declarative markup should look like the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-cs/samples/sample21.aspx)]

<span data-ttu-id="5c1c0-345">[ロールの指定] `WizardStep`で、`RoleList`という名前の CheckBoxList を追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-345">In the "Specify Roles" `WizardStep`, add a CheckBoxList named `RoleList`.</span></span> <span data-ttu-id="5c1c0-346">この CheckBoxList には、使用可能なロールが一覧表示されます。これにより、ページにアクセスしたユーザーは、新しく作成されたユーザーが属するロールを確認できます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-346">This CheckBoxList will list the available roles, enabling the person visiting the page to check what roles the newly created user belongs to.</span></span>

<span data-ttu-id="5c1c0-347">ここでは、2つのコーディングタスクを行います。最初に、`RoleList` CheckBoxList にシステムのロールを設定する必要があります。次に、ユーザーが "ロールの指定" 手順から "完了" 手順に移動したときに、作成したユーザーを選択したロールに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-347">We are left with two coding tasks: first we must populate the `RoleList` CheckBoxList with the roles in the system; second, we need to add the created user to the selected roles when the user moves from the "Specify Roles" step to the "Complete" step.</span></span> <span data-ttu-id="5c1c0-348">`Page_Load` イベントハンドラーの最初のタスクを実行できます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-348">We can accomplish the first task in the `Page_Load` event handler.</span></span> <span data-ttu-id="5c1c0-349">次のコードは、ページに最初にアクセスしたときに、`RoleList` チェックボックスをプログラムによって参照し、システム内のロールをバインドします。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-349">The following code programmatically references the `RoleList` CheckBox on the first visit to the page and binds the roles in the system to it.</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample22.cs)]

<span data-ttu-id="5c1c0-350">上記のコードはよく知られています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-350">The above code should look familiar.</span></span> <span data-ttu-id="5c1c0-351">「 <a id="_msoanchor_5"> </a> [*追加のユーザー情報*の*格納*](../membership/storing-additional-user-information-cs.md) 」チュートリアルでは、2つの `FindControl` ステートメントを使用して、カスタム `WizardStep`内から Web コントロールを参照します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-351">In the <a id="_msoanchor_5"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-cs.md) tutorial we used two `FindControl` statements to reference a Web control from within a custom `WizardStep`.</span></span> <span data-ttu-id="5c1c0-352">ロールを CheckBoxList にバインドするコードは、このチュートリアルの前半で作成したものです。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-352">And the code that binds the roles to the CheckBoxList was taken from earlier in this tutorial.</span></span>

<span data-ttu-id="5c1c0-353">2番目のプログラミングタスクを実行するには、"ロールの指定" 手順が完了したことを把握しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-353">In order to perform the second programming task we need to know when the "Specify Roles" step has been completed.</span></span> <span data-ttu-id="5c1c0-354">CreateUserWizard には `ActiveStepChanged` イベントがあることを思い出してください。これは、ビジターがあるステップから別のステップに移動するたびに発生します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-354">Recall that the CreateUserWizard has an `ActiveStepChanged` event, which fires each time the visitor navigates from one step to another.</span></span> <span data-ttu-id="5c1c0-355">ここで、ユーザーが "Complete" 手順に到達したかどうかを確認できます。その場合は、選択したロールにユーザーを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-355">Here we can determine if the user has reached the "Complete" step; if so, we need to add the user to the selected roles.</span></span>

<span data-ttu-id="5c1c0-356">`ActiveStepChanged` イベントのイベントハンドラーを作成し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-356">Create an event handler for the `ActiveStepChanged` event and add the following code:</span></span>

[!code-csharp[Main](assigning-roles-to-users-cs/samples/sample23.cs)]

<span data-ttu-id="5c1c0-357">ユーザーが "Completed" 手順に到達した場合は、イベントハンドラーによって `RoleList` CheckBoxList の項目が列挙され、先ほど作成したユーザーが選択したロールに割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-357">If the user has just reached the "Completed" step, the event handler enumerates the items of the `RoleList` CheckBoxList and the just-created user is assigned to the selected roles.</span></span>

<span data-ttu-id="5c1c0-358">ブラウザーを使用してこのページにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-358">Visit this page through a browser.</span></span> <span data-ttu-id="5c1c0-359">CreateUserWizard の最初の手順は、新しいユーザーのユーザー名、パスワード、電子メール、その他の重要な情報の入力を求める標準の "新しいアカウントにサインアップする" 手順です。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-359">The first step in the CreateUserWizard is the standard "Sign Up for Your New Account" step, which prompts for the new user's username, password, email, and other key information.</span></span> <span data-ttu-id="5c1c0-360">情報を入力して、Wanda という名前の新しいユーザーを作成します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-360">Enter the information to create a new user named Wanda.</span></span>

<span data-ttu-id="5c1c0-361">[Wanda という名前の新しいユーザーを作成 ![には](assigning-roles-to-users-cs/_static/image35.png)](assigning-roles-to-users-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-361">[![Create a New User Named Wanda](assigning-roles-to-users-cs/_static/image35.png)](assigning-roles-to-users-cs/_static/image34.png)</span></span>

<span data-ttu-id="5c1c0-362">**図 12**: Wanda という名前の新しいユーザーを作成[する (クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image36.png)される)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-362">**Figure 12**: Create a New User Named Wanda  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image36.png))</span></span>

<span data-ttu-id="5c1c0-363">[Create User] \ (ユーザーの作成 \) ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-363">Click the "Create User" button.</span></span> <span data-ttu-id="5c1c0-364">CreateUserWizard は、内部で `Membership.CreateUser` メソッドを呼び出し、新しいユーザーアカウントを作成した後、次の「ロールの指定」に進みます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-364">The CreateUserWizard internally calls the `Membership.CreateUser` method, creating the new user account, and then progresses to the next step, "Specify Roles."</span></span> <span data-ttu-id="5c1c0-365">ここでは、システムの役割について説明します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-365">Here the system roles are listed.</span></span> <span data-ttu-id="5c1c0-366">[スーパーバイザー] チェックボックスをオンにし、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-366">Check the Supervisors checkbox and click Next.</span></span>

<span data-ttu-id="5c1c0-367">[Wanda をスーパーバイザーロールのメンバーにする ![](assigning-roles-to-users-cs/_static/image38.png)](assigning-roles-to-users-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-367">[![Make Wanda a Member of the Supervisors Role](assigning-roles-to-users-cs/_static/image38.png)](assigning-roles-to-users-cs/_static/image37.png)</span></span>

<span data-ttu-id="5c1c0-368">**図 13**: Wanda をスーパーバイザーロールのメンバーにする ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image39.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-368">**Figure 13**: Make Wanda a Member of the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image39.png))</span></span>

<span data-ttu-id="5c1c0-369">[次へ] をクリックするとポストバックが実行され、`ActiveStep` が "Complete" 手順に更新されます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-369">Clicking Next causes a postback and updates the `ActiveStep` to the "Complete" step.</span></span> <span data-ttu-id="5c1c0-370">`ActiveStepChanged` イベントハンドラーでは、最近作成されたユーザーアカウントがスーパーバイザーロールに割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-370">In the `ActiveStepChanged` event handler, the recently-created user account is assigned to the Supervisors role.</span></span> <span data-ttu-id="5c1c0-371">これを確認するには、`UsersAndRoles.aspx` ページに戻り、`RoleList` DropDownList から [スーパーバイザー] を選択します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-371">To verify this, return to the `UsersAndRoles.aspx` page and select Supervisors from the `RoleList` DropDownList.</span></span> <span data-ttu-id="5c1c0-372">図14に示すように、上司は、Wanda、Tito、およびの3人のユーザーで構成されています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-372">As Figure 14 shows, the Supervisors are now made up of three users: Bruce, Tito, and Wanda.</span></span>

<span data-ttu-id="5c1c0-373">[Wanda、Tito、は全員が監督 ![](assigning-roles-to-users-cs/_static/image41.png)](assigning-roles-to-users-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-373">[![Bruce, Tito, and Wanda are All Supervisors](assigning-roles-to-users-cs/_static/image41.png)](assigning-roles-to-users-cs/_static/image40.png)</span></span>

<span data-ttu-id="5c1c0-374">**図 14**: すべてのスーパーバイザーが表示されます ([クリックすると、フルサイズの画像が表示](assigning-roles-to-users-cs/_static/image42.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-374">**Figure 14**: Bruce, Tito, and Wanda are All Supervisors  ([Click to view full-size image](assigning-roles-to-users-cs/_static/image42.png))</span></span>

## <a name="summary"></a><span data-ttu-id="5c1c0-375">まとめ</span><span class="sxs-lookup"><span data-stu-id="5c1c0-375">Summary</span></span>

<span data-ttu-id="5c1c0-376">ロールフレームワークには、特定のユーザーのロールに関する情報を取得するメソッドと、指定したロールに属するユーザーを決定するためのメソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-376">The Roles framework offers methods for retrieving information about a particular user's roles and methods for determining what users belong to a specified role.</span></span> <span data-ttu-id="5c1c0-377">さらに、1人以上のユーザーを1つ以上のロールに追加したり、削除したりするための方法がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-377">Furthermore, there are a number of methods for adding and removing one or more users to one or more roles.</span></span> <span data-ttu-id="5c1c0-378">このチュートリアルでは、`AddUserToRole` と `RemoveUserFromRole`の2つの方法に焦点を絞っています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-378">In this tutorial we focused on just two of these methods: `AddUserToRole` and `RemoveUserFromRole`.</span></span> <span data-ttu-id="5c1c0-379">1つのロールに複数のユーザーを追加し、1人のユーザーに複数のロールを割り当てるように設計された追加のバリエーションがあります。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-379">There are additional variants designed to add multiple users to a single role and to assign multiple roles to a single user.</span></span>

<span data-ttu-id="5c1c0-380">このチュートリアルでは、新しく作成したユーザーのロールを指定する `WizardStep` を含むように、CreateUserWizard コントロールを拡張する方法についても説明しました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-380">This tutorial also included a look at extending the CreateUserWizard control to include a `WizardStep` to specify the newly-created user's roles.</span></span> <span data-ttu-id="5c1c0-381">このような手順は、管理者が新しいユーザーのユーザーアカウントを作成するプロセスを効率化するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-381">Such a step could help an administrator streamline the process of creating user accounts for new users.</span></span>

<span data-ttu-id="5c1c0-382">この時点で、ロールを作成および削除する方法と、ロールにユーザーを追加および削除する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-382">At this point we have seen how to create and delete roles and how to add and remove users from roles.</span></span> <span data-ttu-id="5c1c0-383">しかし、ロールベースの承認の適用についてはまだ説明していません。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-383">But we have yet to look at applying role-based authorization.</span></span> <span data-ttu-id="5c1c0-384"><a id="_msoanchor_6"> </a>[次のチュートリアル](role-based-authorization-cs.md)では、ロールごとに URL 承認規則を定義すると共に、現在ログインしているユーザーのロールに基づいてページレベルの機能を制限する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-384">In the <a id="_msoanchor_6"></a>[following tutorial](role-based-authorization-cs.md) we will look at defining URL authorization rules on a role-by-role basis, as well as how to limit page-level functionality based on the currently logged in user's roles.</span></span>

<span data-ttu-id="5c1c0-385">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-385">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="5c1c0-386">参考資料</span><span class="sxs-lookup"><span data-stu-id="5c1c0-386">Further Reading</span></span>

<span data-ttu-id="5c1c0-387">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-387">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="5c1c0-388">ASP.NET Web サイト管理ツールの概要</span><span class="sxs-lookup"><span data-stu-id="5c1c0-388">ASP.NET Web Site Administration Tool Overview</span></span>](https://msdn.microsoft.com/library/ms228053.aspx)
- [<span data-ttu-id="5c1c0-389">ASP を調べています。NET のメンバーシップ、ロール、およびプロファイル</span><span class="sxs-lookup"><span data-stu-id="5c1c0-389">Examining ASP.NET's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="5c1c0-390">独自の Web サイト管理ツールのロール</span><span class="sxs-lookup"><span data-stu-id="5c1c0-390">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="5c1c0-391">著者について</span><span class="sxs-lookup"><span data-stu-id="5c1c0-391">About the Author</span></span>

<span data-ttu-id="5c1c0-392">1998以降、Microsoft の Web テクノロジを使用して、Scott Mitchell (複数の ASP/創設者4GuysFromRolla.com の執筆者) が Microsoft の Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-392">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5c1c0-393">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-393">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5c1c0-394">彼の最新の書籍は *[、ASP.NET 2.0 を24時間以内に教え](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* ています。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-394">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="5c1c0-395">Scott は、 [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com)またはブログで[http://ScottOnWriting.NET](http://scottonwriting.net/)にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-395">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="5c1c0-396">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-396">Special Thanks To…</span></span>

<span data-ttu-id="5c1c0-397">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-397">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5c1c0-398">このチュートリアルのリードレビュー担当者は、Teresa Murphy でした。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-398">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="5c1c0-399">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="5c1c0-399">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5c1c0-400">その場合は、 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)の行を削除します。</span><span class="sxs-lookup"><span data-stu-id="5c1c0-400">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5c1c0-401">[前へ](creating-and-managing-roles-cs.md)
> [次へ](role-based-authorization-cs.md)</span><span class="sxs-lookup"><span data-stu-id="5c1c0-401">[Previous](creating-and-managing-roles-cs.md)
[Next](role-based-authorization-cs.md)</span></span>
