---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-vb
title: パスワードの回復と変更 (VB) |Microsoft Docs
author: rick-anderson
description: ASP.NET には、パスワードの回復と変更を支援する2つの Web コントロールが含まれています。 PasswordRecovery コントロールを使用すると、ビジターが紛失した pa を回復できます...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: f9adcb5d-6d70-4885-a3bf-ed95efb4da1a
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-vb
msc.type: authoredcontent
ms.openlocfilehash: 0ed1df9455af94a86ce59ecc06c55846a4880596
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74618763"
---
# <a name="recovering-and-changing-passwords-vb"></a><span data-ttu-id="c01a7-104">パスワードを復元し、変更する (VB)</span><span class="sxs-lookup"><span data-stu-id="c01a7-104">Recovering and Changing Passwords (VB)</span></span>

<span data-ttu-id="c01a7-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c01a7-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c01a7-106">[コードのダウンロード](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.13.zip)または[PDF のダウンロード](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="c01a7-106">[Download Code](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.13.zip) or [Download PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_vb.pdf)</span></span>

> <span data-ttu-id="c01a7-107">ASP.NET には、パスワードの回復と変更を支援する2つの Web コントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="c01a7-108">PasswordRecovery コントロールを使用すると、ビジターが紛失したパスワードを回復することができます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="c01a7-109">ChangePassword コントロールを使用すると、ユーザーは自分のパスワードを更新できます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="c01a7-110">このチュートリアルシリーズ全体で見てきた他のログイン関連 Web コントロールと同様に、PasswordRecovery と ChangePassword コントロールは、ユーザーのパスワードをリセットまたは変更するための背後でメンバーシップフレームワークと連携します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

## <a name="introduction"></a><span data-ttu-id="c01a7-111">はじめに</span><span class="sxs-lookup"><span data-stu-id="c01a7-111">Introduction</span></span>

<span data-ttu-id="c01a7-112">銀行、公益事業、電話会社、電子メールアカウント、およびパーソナライズされた web ポータルの web サイトでは、ほとんどのユーザーと同じように、多数のパスワードを覚えておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="c01a7-113">多くの資格情報を使用すると、ユーザーがパスワードを忘れてしまうことは珍しくありません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="c01a7-114">このことを考慮するために、ユーザーアカウントを提供する web サイトには、ユーザーがパスワードを回復する方法を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="c01a7-115">通常、このプロセスでは、新しいランダムなパスワードを生成し、ファイルのユーザーの電子メールアドレスに電子メールで送信します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="c01a7-116">新しいパスワードを受け取った場合、ほとんどのユーザーはサイトに戻り、ランダムに生成されたパスワードを、より覚えやすいものに変更します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="c01a7-117">ASP.NET には、パスワードの回復と変更を支援する2つの Web コントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="c01a7-118">PasswordRecovery コントロールを使用すると、ビジターが紛失したパスワードを回復することができます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="c01a7-119">ChangePassword コントロールを使用すると、ユーザーは自分のパスワードを更新できます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="c01a7-120">このチュートリアルシリーズ全体で見てきた他のログイン関連 Web コントロールと同様に、PasswordRecovery と ChangePassword コントロールは、ユーザーのパスワードをリセットまたは変更するための背後でメンバーシップフレームワークと連携します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="c01a7-121">このチュートリアルでは、これら2つのコントロールを使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="c01a7-122">また、`MembershipUser` クラスの `ChangePassword` メソッドと `ResetPassword` メソッドを使用して、ユーザーのパスワードをプログラムで変更およびリセットする方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="c01a7-123">手順 1: ユーザーが紛失したパスワードを回復できるようにする</span><span class="sxs-lookup"><span data-stu-id="c01a7-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="c01a7-124">ユーザーアカウントをサポートするすべての web サイトは、忘れたパスワードを回復するためのメカニズムをユーザーに提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="c01a7-125">ASP.NET にこのような機能を実装することは、PasswordRecovery Web コントロールに感謝します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="c01a7-126">PasswordRecovery コントロールは、ユーザーにユーザー名の入力を求めるインターフェイスをレンダリングし、必要に応じて、セキュリティの質問に対する回答を表示します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="c01a7-127">その後、ユーザーにパスワードを電子メールで入力します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-128">電子メールメッセージは、プレーンテキストでネットワーク経由で送信されるため、電子メールでユーザーのパスワードを送信することにはセキュリティ上のリスクが伴います。</span><span class="sxs-lookup"><span data-stu-id="c01a7-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>

<span data-ttu-id="c01a7-129">PasswordRecovery コントロールは、次の3つのビューで構成されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="c01a7-130">**Username** -ビジターにユーザー名の入力を求めます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="c01a7-131">これは最初のビューです。</span><span class="sxs-lookup"><span data-stu-id="c01a7-131">This is the initial view.</span></span>
- <span data-ttu-id="c01a7-132">**質問**-ユーザーのユーザー名とセキュリティの質問をテキストとして表示し、ユーザーがセキュリティの質問に答えを入力するためのテキストボックスを表示します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="c01a7-133">**成功**-パスワードが電子メールで送信されたことをユーザーに通知するメッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="c01a7-134">PasswordRecovery コントロールによって実行されるビューとアクションは、次のメンバーシップ構成設定によって異なります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="c01a7-135">メンバーシップフレームワークの `RequiresQuestionAndAnswer` 設定は、ユーザーがアカウントの登録時にセキュリティの質問と回答を指定する必要があるかどうかを示します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="c01a7-136">「 <a id="_msoanchor_1"> </a>[*ユーザーアカウントの作成*](../membership/creating-user-accounts-vb.md)」チュートリアルで説明したように、`RequiresQuestionAndAnswer` が True (既定値) の場合、CreateUserWizard のインターフェイスには、新しいユーザーのセキュリティの質問と回答のテキストボックスコントロールが含まれています。`RequiresQuestionAndAnswer` が False の場合、そのような情報は収集されません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-vb.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="c01a7-137">同様に `RequiresQuestionAndAnswer` が True の場合、ユーザーがユーザー名を入力した後に、PasswordRecovery コントロールによって質問ビューが表示されます。パスワードは、ユーザーが正しいセキュリティの回答を入力した場合にのみ回復されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="c01a7-138">ただし `RequiresQuestionAndAnswer` が False の場合、PasswordRecovery コントロールはユーザー名ビューから [成功] ビューに直接移動します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="c01a7-139">ユーザーが自分のユーザー名、または自分のユーザー名とセキュリティの回答を入力した後、`RequiresQuestionAndAnswer` が True の場合は、PasswordRecovery によってユーザーのパスワードが電子メールで送られます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="c01a7-140">`EnablePasswordRetrieval` オプションが True に設定されている場合、ユーザーは現在のパスワードを電子メールで送信します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="c01a7-141">False に設定されていて `EnablePasswordReset` が True に設定されている場合は、PasswordRecovery コントロールによってユーザーに対して新しいランダムなパスワードが生成され、このパスワードに新しいパスワードが電子メールで送られます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="c01a7-142">`EnablePasswordRetrieval` と `EnablePasswordReset` の両方が False の場合、PasswordRecovery コントロールは例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-143">`SqlMembershipProvider` は、クリア、ハッシュ (既定)、または暗号化された3つの形式のいずれかでユーザーのパスワードを格納していることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="c01a7-144">使用されるストレージメカニズムは、メンバーシップの構成設定によって異なります。デモアプリケーションでは、ハッシュされたパスワード形式を使用します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="c01a7-145">ハッシュされたパスワード形式を使用する場合は、`EnablePasswordRetrieval` オプションを False に設定する必要があります。これは、システムが、データベースに格納されているハッシュされたバージョンからユーザーの実際のパスワードを特定できないためです。</span><span class="sxs-lookup"><span data-stu-id="c01a7-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>

<span data-ttu-id="c01a7-146">図1は、PasswordRecovery のインターフェイスと動作がメンバーシップの構成によってどのように影響を受けるかを示しています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>

<span data-ttu-id="c01a7-147">[RequiresQuestionAndAnswer、Enablepasswordretrieval、Enablepasswordretrieval が PasswordRecovery コントロールの外観と動作に影響を与える ![](recovering-and-changing-passwords-vb/_static/image2.png)](recovering-and-changing-passwords-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c01a7-147">[![The RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior](recovering-and-changing-passwords-vb/_static/image2.png)](recovering-and-changing-passwords-vb/_static/image1.png)</span></span>

<span data-ttu-id="c01a7-148">**図 1**: `RequiresQuestionAndAnswer`、`EnablePasswordRetrieval`、および `EnablePasswordReset` は、passwordrecovery コントロールの外観と動作に影響を及ぼします ([クリックすると、フルサイズの画像が表示](recovering-and-changing-passwords-vb/_static/image3.png)されます)。</span><span class="sxs-lookup"><span data-stu-id="c01a7-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image3.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-149">SQL Server チュートリアル<a id="_msoanchor_2"> </a>[*でメンバーシップスキーマを作成*](../membership/creating-the-membership-schema-in-sql-server-vb.md)するには、`RequiresQuestionAndAnswer` を true に設定してメンバーシッププロバイダーを構成し、False に `EnablePasswordRetrieval` し、を true に `EnablePasswordReset` します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>

### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="c01a7-150">PasswordRecovery コントロールの使用</span><span class="sxs-lookup"><span data-stu-id="c01a7-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="c01a7-151">ASP.NET ページで PasswordRecovery コントロールを使用する方法を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="c01a7-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="c01a7-152">`RecoverPassword.aspx` を開き、[ツールボックス] から PasswordRecovery コントロールをデザイナーにドラッグアンドドロップします。`ID` を `RecoverPwd`に設定します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="c01a7-153">Login および CreateUserWizard Web コントロールと同様に、PasswordRecovery コントロールのビューには、ラベル、テキストボックス、ボタン、および検証コントロールを含む、豊富な複合インターフェイスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="c01a7-154">ビューの外観をカスタマイズするには、コントロールのスタイルプロパティを使用するか、ビューをテンプレートに変換します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="c01a7-155">これは関心のある読者のための演習として残されています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="c01a7-156">ユーザーがこのページにアクセスすると、自分のユーザー名を入力し、[送信] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="c01a7-157">メンバーシップの構成設定で [`RequiresQuestionAndAnswer`] プロパティを True に設定しているので、PasswordRecovery コントロールでは質問ビューが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="c01a7-158">ユーザーが適切なセキュリティの回答を入力して [送信] をクリックすると、PasswordRecovery コントロールはユーザーのパスワードをランダムに生成されたパスワードに更新し、このパスワードをファイルの電子メールアドレスに電子メールで送信します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="c01a7-159">1行のコードを記述しなくても、すべてのことが可能でした。</span><span class="sxs-lookup"><span data-stu-id="c01a7-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="c01a7-160">このページをテストする前に、構成の最終的な構成要素が1つあります。 `Web.config`でメール配信の設定を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="c01a7-161">PasswordRecovery コントロールは、これらの設定に基づいて電子メールを送信します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="c01a7-162">メール配信の構成は、 [`<system.net>` 要素](https://msdn.microsoft.com/library/6484zdc1.aspx)の[`<mailSettings>` 要素](https://msdn.microsoft.com/library/w355a94k.aspx)によって指定されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/library/w355a94k.aspx).</span></span> <span data-ttu-id="c01a7-163">[`<smtp>` 要素](https://msdn.microsoft.com/library/ms164240.aspx)を使用して、配信方法と既定の差出人アドレスを指定します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-163">Use the [`<smtp>` element](https://msdn.microsoft.com/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="c01a7-164">次のマークアップは、ポート25で `smtp.example.com` という名前のネットワーク SMTP サーバーと、ユーザー名とパスワードのユーザー名/パスワードの資格情報を使用するように、メールの設定を構成します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-165">`<system.net>` は、ルート `<configuration>` 要素の子要素であり、`<system.web>`の兄弟です。</span><span class="sxs-lookup"><span data-stu-id="c01a7-165">`<system.net>` is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="c01a7-166">したがって、`<system.web>` 要素内に `<system.net>` 要素を配置しないでください。代わりに、同じレベルに配置します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>

[!code-xml[Main](recovering-and-changing-passwords-vb/samples/sample1.xml)]

<span data-ttu-id="c01a7-167">ネットワーク上の SMTP サーバーを使用するだけでなく、送信する電子メールメッセージが格納されるピックアップディレクトリを指定することもできます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="c01a7-168">SMTP 設定を構成したら、ブラウザーを使用して `RecoverPassword.aspx` のページにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="c01a7-169">まず、ユーザーストアに存在しないユーザー名を入力してください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="c01a7-170">図2に示すように、PasswordRecovery コントロールには、ユーザー情報にアクセスできなかったことを示すメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="c01a7-171">メッセージのテキストは、コントロールの[`UserNameFailureText` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx)を使用してカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>

<span data-ttu-id="c01a7-172">[無効なユーザー名が入力された場合にエラーメッセージが表示される ![](recovering-and-changing-passwords-vb/_static/image5.png)](recovering-and-changing-passwords-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c01a7-172">[![An Error Message is Displayed if an Invalid Username is Entered](recovering-and-changing-passwords-vb/_static/image5.png)](recovering-and-changing-passwords-vb/_static/image4.png)</span></span>

<span data-ttu-id="c01a7-173">**図 2**: 無効なユーザー名が入力された場合にエラーメッセージが表示される ([クリックしてフルサイズの画像を表示](recovering-and-changing-passwords-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c01a7-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image6.png))</span></span>

<span data-ttu-id="c01a7-174">ここで、ユーザー名を入力します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-174">Now enter a username.</span></span> <span data-ttu-id="c01a7-175">システム内のアカウントのユーザー名を使用して、アクセスできる電子メールアドレスと、そのセキュリティの回答を確認します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="c01a7-176">ユーザー名を入力して [送信] をクリックすると、PasswordRecovery コントロールにその質問ビューが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="c01a7-177">ユーザー名ビューの場合と同様に、間違った回答を入力すると、PasswordRecovery コントロールでエラーメッセージが表示されます (図3を参照)。</span><span class="sxs-lookup"><span data-stu-id="c01a7-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="c01a7-178">このエラーメッセージをカスタマイズするには、 [`QuestionFailureText` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx)を使用します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>

<span data-ttu-id="c01a7-179">[ユーザーが無効なセキュリティの回答を入力すると、エラーメッセージが表示される ![](recovering-and-changing-passwords-vb/_static/image8.png)](recovering-and-changing-passwords-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c01a7-179">[![An Error Message is Displayed if the User Enters an Invalid Security Answer](recovering-and-changing-passwords-vb/_static/image8.png)](recovering-and-changing-passwords-vb/_static/image7.png)</span></span>

<span data-ttu-id="c01a7-180">**図 3**: ユーザーが無効なセキュリティの回答を入力した場合にエラーメッセージが表示される ([クリックすると、フルサイズの画像が表示](recovering-and-changing-passwords-vb/_static/image9.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c01a7-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image9.png))</span></span>

<span data-ttu-id="c01a7-181">最後に、正しいセキュリティの回答を入力し、[送信] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="c01a7-182">バックグラウンドでは、PasswordRecovery コントロールによってランダムなパスワードが生成され、ユーザーアカウントに割り当てられ、新しいパスワードをユーザーに通知する電子メールが送信されます (図4を参照)。その後、[成功] ビューが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>

<span data-ttu-id="c01a7-183">[ユーザーに新しいパスワードを使用して電子メールを送信 ![](recovering-and-changing-passwords-vb/_static/image11.png)](recovering-and-changing-passwords-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c01a7-183">[![The User is Sent an Email with His New Password](recovering-and-changing-passwords-vb/_static/image11.png)](recovering-and-changing-passwords-vb/_static/image10.png)</span></span>

<span data-ttu-id="c01a7-184">**図 4**: ユーザーに新しいパスワードを使用して電子メールが送信される ([クリックすると、フルサイズの画像が表示](recovering-and-changing-passwords-vb/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c01a7-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image12.png))</span></span>

### <a name="customizing-the-email"></a><span data-ttu-id="c01a7-185">電子メールのカスタマイズ</span><span class="sxs-lookup"><span data-stu-id="c01a7-185">Customizing the Email</span></span>

<span data-ttu-id="c01a7-186">PasswordRecovery コントロールによって送信された既定の電子メールは、代わりに退屈です (図4を参照)。</span><span class="sxs-lookup"><span data-stu-id="c01a7-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="c01a7-187">メッセージは、`<smtp>` 要素の `from` 属性で指定されたアカウントから、サブジェクトパスワードとプレーンテキストの本文で送信されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="c01a7-188">サイトに戻り、次の情報を使用してログインしてください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="c01a7-189">ユーザー*名: ユーザー名*</span><span class="sxs-lookup"><span data-stu-id="c01a7-189">User Name: *username*</span></span>

<span data-ttu-id="c01a7-190">パスワード:*パスワード*</span><span class="sxs-lookup"><span data-stu-id="c01a7-190">Password: *password*</span></span>

<span data-ttu-id="c01a7-191">このメッセージは、PasswordRecovery コントロールの[`SendingMail` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx)のイベントハンドラーを通じて、または[`MailDefinition` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx)を使用して宣言によってカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="c01a7-192">これら両方のオプションを見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="c01a7-192">Let's explore both of these options.</span></span>

<span data-ttu-id="c01a7-193">`SendingMail` イベントは、電子メールメッセージが送信される直前に発生し、電子メールメッセージをプログラムによって調整する最後の機会になります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="c01a7-194">このイベントが発生すると、イベントハンドラーには[`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx)型のオブジェクトが渡され、`Message` プロパティには、送信される電子メールへの参照が含まれます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="c01a7-195">`SendingMail` イベントのイベントハンドラーを作成し、次のコードを追加します。このコードは、プログラムを使用して `webmaster@example.com` を CC リストに追加します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-vb[Main](recovering-and-changing-passwords-vb/samples/sample2.vb)]

<span data-ttu-id="c01a7-196">また、宣言的な方法で電子メールメッセージを構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="c01a7-197">PasswordRecovery の `MailDefinition` プロパティは、 [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx)型のオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="c01a7-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="c01a7-198">`MailDefinition` クラスは、`From`、`CC`、`Priority`、`Subject`、`IsBodyHtml`、`BodyFileName`など、電子メール関連のプロパティのホストを提供します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="c01a7-199">まず、[`Subject`][プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx)に、パスワードがリセットされたなど、既定 (パスワード) で使用されているものよりもわかりやすい値を設定します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="c01a7-200">電子メールメッセージの本文をカスタマイズするには、本文の内容を含む別の電子メールテンプレートファイルを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="c01a7-201">まず、`EmailTemplates`という名前の web サイトに新しいフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="c01a7-202">次に、`PasswordRecovery.txt` という名前のこのフォルダーに新しいテキストファイルを追加し、次の内容を追加します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-vb/samples/sample3.aspx)]

<span data-ttu-id="c01a7-203">プレースホルダー `<%UserName%>` と `<%Password%>`を使用することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="c01a7-204">PasswordRecovery コントロールは、電子メールを送信する前に、これら2つのプレースホルダーをユーザーのユーザー名と回復したパスワードに自動的に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="c01a7-205">最後に、`MailDefinition`の[`BodyFileName` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx)を、先ほど作成した電子メールテンプレート (`~/EmailTemplates/PasswordRecovery.txt`) にポイントします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="c01a7-206">これらの変更を行った後、[`RecoverPassword.aspx`] ページに戻って、ユーザー名とセキュリティの回答を入力します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="c01a7-207">図5に示すような電子メールが届きます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="c01a7-208">`webmaster@example.com` が CC に設定されており、件名と本文が更新されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>

<span data-ttu-id="c01a7-209">[件名、本文、および CC の一覧が更新された ![](recovering-and-changing-passwords-vb/_static/image14.png)](recovering-and-changing-passwords-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c01a7-209">[![The Subject, Body, and CC List Have Been Updated](recovering-and-changing-passwords-vb/_static/image14.png)](recovering-and-changing-passwords-vb/_static/image13.png)</span></span>

<span data-ttu-id="c01a7-210">**図 5**: 件名、本文、および CC の一覧が更新されました ([クリックすると、フルサイズの画像が表示](recovering-and-changing-passwords-vb/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c01a7-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image15.png))</span></span>

<span data-ttu-id="c01a7-211">HTML 形式の電子メールセットを[`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) True に送信するには (既定値は False)、電子メールテンプレートを更新して html を含めます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="c01a7-212">`MailDefinition` プロパティは、PasswordRecovery クラスに固有のものではありません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="c01a7-213">手順 2. で説明したように、ChangePassword コントロールには `MailDefinition` プロパティも用意されています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="c01a7-214">さらに、CreateUserWizard コントロールには、新しいユーザーに自動的にようこそ電子メールメッセージを送信するように構成できるプロパティが含まれています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-215">現在、`RecoverPassword.aspx` ページに到達するための左側のナビゲーションにリンクはありません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="c01a7-216">ユーザーは、サイトに正常にログオンできなかった場合にのみ、このページにアクセスすることを目的としています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="c01a7-217">そのため、[`Login.aspx`] ページを更新して、[`RecoverPassword.aspx`] ページへのリンクを追加します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>

### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="c01a7-218">プログラムによるユーザーのパスワードのリセット</span><span class="sxs-lookup"><span data-stu-id="c01a7-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="c01a7-219">ユーザーのパスワードをリセットすると、PasswordRecovery コントロールは `MembershipUser` オブジェクトの[`ResetPassword` メソッド](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx)を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="c01a7-220">このメソッドには、次の2つのオーバーロードがあります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-220">This method has two overloads:</span></span>

- <span data-ttu-id="c01a7-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** -ユーザーのパスワードをリセットします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="c01a7-222">`RequiresQuestionAndAnswer` が False の場合は、このオーバーロードを使用します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="c01a7-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** -指定した*securityanswer*が正しい場合にのみ、ユーザーのパスワードをリセットします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="c01a7-224">`RequiresQuestionAndAnswer` が True の場合は、このオーバーロードを使用します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="c01a7-225">どちらのオーバーロードも、ランダムに生成された新しいパスワードを返します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="c01a7-226">メンバーシップフレームワークの他のメソッドと同様に、`ResetPassword` メソッドは構成されたプロバイダーにデリゲートします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="c01a7-227">`SqlMembershipProvider` は、ユーザーのユーザー名、新しいパスワード、および指定されたパスワードの解答を他のフィールドに渡して、`aspnet_Membership_ResetPassword` ストアドプロシージャを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="c01a7-228">このストアドプロシージャにより、パスワードの解答が確実に一致し、ユーザーのパスワードが更新されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="c01a7-229">低レベルの実装に関する注意事項をいくつか次に示します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="c01a7-230">ロックアウトされたユーザーは、自分のパスワードをリセットできません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="c01a7-231">ただし、未承認のユーザーがいる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-231">However, an unapproved user may.</span></span> <span data-ttu-id="c01a7-232">ロックアウトと承認された状態については、「 <a id="_msoanchor_3"> </a>[*ユーザーアカウントのロック解除と承認*](unlocking-and-approving-user-accounts-vb.md)」チュートリアルで詳細に説明します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-vb.md) Accounts tutorial.</span></span>
- <span data-ttu-id="c01a7-233">パスワードの解答が正しくない場合、ユーザーのパスワードの解答試行回数が増加します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="c01a7-234">指定された期間内に指定された無効なセキュリティ回答の試行回数が発生した場合、ユーザーはロックアウトされます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="c01a7-235">ランダムなパスワードが生成される方法に関する単語</span><span class="sxs-lookup"><span data-stu-id="c01a7-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="c01a7-236">図4および5の電子メールメッセージに表示されるランダムに生成されたパスワードは、メンバーシップクラスの[`GeneratePassword` メソッド](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx)によって作成されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="c01a7-237">このメソッドは、2つの整数入力のパラメーター*長*と*numberOfNonAlphanumericCharacters*を受け取り、少なくとも*numberOfNonAlphanumericCharacters*の数字以外の文字を含む*長さ*が長い文字列を返します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="c01a7-238">このメソッドがメンバーシップクラスまたはログイン関連の Web コントロール内から呼び出された場合、これら2つのパラメーターの値は、メンバーシップ構成の `MinRequiredPasswordLength` と `MinRequiredNonalphanumericCharacters` プロパティによって決定されます。これらの値はそれぞれ7と1に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="c01a7-239">`GeneratePassword` メソッドは、暗号強度の高い乱数ジェネレーターを使用して、選択されているランダム文字にバイアスがないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="c01a7-240">さらに、ランダムな文字列またはパスワードを生成する必要がある場合は、`GeneratePassword` が `Public`ます。つまり、ASP.NET アプリケーションから直接使用できます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-240">Furthermore, `GeneratePassword` is `Public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-241">`SqlMembershipProvider` クラスでは、常に14文字以上のランダムなパスワードが生成されます。そのため、`MinRequiredPasswordLength` が14文字未満の場合、その値は無視されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>

## <a name="step-2-changing-passwords"></a><span data-ttu-id="c01a7-242">手順 2: パスワードの変更</span><span class="sxs-lookup"><span data-stu-id="c01a7-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="c01a7-243">ランダムに生成されたパスワードは覚えにくいものです。</span><span class="sxs-lookup"><span data-stu-id="c01a7-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="c01a7-244">図4に示すパスワードを考えてみます。 `WWGUZv(f2yM:Bd`を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="c01a7-245">メモリへのコミットを試行してください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-245">Try committing that to memory!</span></span> <span data-ttu-id="c01a7-246">言うまでもありませんが、この種のランダムに生成されたパスワードをユーザーに送信した後は、より覚えやすいパスワードに変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="c01a7-247">パスワードを変更するためのインターフェイスをユーザーに対して作成するには、ChangePassword コントロールを使用します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="c01a7-248">PasswordRecovery コントロールと同様に、ChangePassword コントロールは、パスワードの変更と成功の2つのビューで構成されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="c01a7-249">パスワードの変更ビューでは、ユーザーは古いパスワードと新しいパスワードを入力するように求められます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="c01a7-250">正しい古いパスワードと、最小文字数と英数字以外の文字の要件を満たす新しいパスワードを指定すると、ChangePassword コントロールによってユーザーのパスワードが更新され、[成功] ビューが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-251">ChangePassword コントロールは、`MembershipUser` オブジェクトの[`ChangePassword` メソッド](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx)を呼び出すことによって、ユーザーのパスワードを変更します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="c01a7-252">ChangePassword メソッドは、 *oldpassword*と*newPassword*という2つの `String` 入力パラメーターを受け取り、指定された*oldpassword*が正しいことを前提として、ユーザーのアカウントを*newPassword*で更新します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-252">The ChangePassword method accepts two `String` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>

<span data-ttu-id="c01a7-253">[`ChangePassword.aspx`] ページを開き、[ChangePassword] コントロールをページに追加して `ChangePwd`名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="c01a7-254">この時点で、デザインビューにパスワードの変更ビューが表示されます (図6を参照)。</span><span class="sxs-lookup"><span data-stu-id="c01a7-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="c01a7-255">PasswordRecovery コントロールと同様に、コントロールのスマートタグを使用してビューを切り替えることができます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="c01a7-256">さらに、これらのビューの外観は、さまざまなスタイルプロパティまたはテンプレートに変換することによってカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>

<span data-ttu-id="c01a7-257">[![ChangePassword コントロールをページに追加するには](recovering-and-changing-passwords-vb/_static/image17.png)](recovering-and-changing-passwords-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c01a7-257">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-vb/_static/image17.png)](recovering-and-changing-passwords-vb/_static/image16.png)</span></span>

<span data-ttu-id="c01a7-258">**図 6**: ChangePassword コントロールをページに追加する ([クリックすると、フルサイズの画像が表示](recovering-and-changing-passwords-vb/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c01a7-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image18.png))</span></span>

<span data-ttu-id="c01a7-259">ChangePassword コントロールでは、現在ログインしているユーザーのパスワード、*または*別の指定されたユーザーのパスワードを更新できます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="c01a7-260">図6に示すように、既定のパスワードの変更ビューでは、3つのテキストボックスコントロールが表示されます。1つは古いパスワード用で、もう1つは新しいパスワード用です。</span><span class="sxs-lookup"><span data-stu-id="c01a7-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="c01a7-261">この既定のインターフェイスは、現在ログオンしているユーザーのパスワードを更新するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="c01a7-262">ChangePassword コントロールを使用して別のユーザーのパスワードを更新するには、コントロールの[`DisplayUserName` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx)を True に設定します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="c01a7-263">このようにすると、ページに4番目のテキストボックスが追加され、パスワードを変更するユーザーのユーザー名の入力を求められます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="c01a7-264">`DisplayUserName` を True に設定すると、ログアウトしたユーザーがログインしなくてもパスワードを変更できるようにする場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="c01a7-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="c01a7-265">個人的には、パスワードの変更を許可する前に、ユーザーにログインを要求しても問題はありません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="c01a7-266">そのため、`DisplayUserName` は False (既定値) のままにしておきます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="c01a7-267">ただし、この決定を行う際、基本的に、匿名ユーザーがこのページにアクセスできないようにしています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="c01a7-268">匿名ユーザーが `ChangePassword.aspx`にアクセスするのを拒否するように、サイトの URL 承認規則を更新します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="c01a7-269">URL 承認規則の構文でメモリを更新する必要がある場合は、 <a id="_msoanchor_4"> </a>[*ユーザーベースの承認*](../membership/user-based-authorization-vb.md)に関するチュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-vb.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-270">`DisplayUserName` プロパティは、管理者が他のユーザーのパスワードを変更できるようにするのに便利な場合があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="c01a7-271">ただし、`DisplayUserName` が True に設定されている場合でも、正しい古いパスワードを認識して入力する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="c01a7-272">手順3で管理者がユーザーのパスワードを変更できるようにするための手法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>

<span data-ttu-id="c01a7-273">ブラウザーを使用して `ChangePassword.aspx` のページにアクセスし、パスワードを変更します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="c01a7-274">メンバーシップの構成で指定されているパスワードの長さと英数字以外の文字の要件を満たしていない新しいパスワードを入力すると、エラーメッセージが表示されることに注意してください (図7を参照)。</span><span class="sxs-lookup"><span data-stu-id="c01a7-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>

<span data-ttu-id="c01a7-275">[![ChangePassword コントロールをページに追加するには](recovering-and-changing-passwords-vb/_static/image20.png)](recovering-and-changing-passwords-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c01a7-275">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-vb/_static/image20.png)](recovering-and-changing-passwords-vb/_static/image19.png)</span></span>

<span data-ttu-id="c01a7-276">**図 7**: ChangePassword コントロールをページに追加する ([クリックすると、フルサイズの画像が表示](recovering-and-changing-passwords-vb/_static/image21.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c01a7-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image21.png))</span></span>

<span data-ttu-id="c01a7-277">正しい古いパスワードと有効な新しいパスワードを入力すると、ログオンしたユーザーのパスワードが変更され、[成功] ビューが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="c01a7-278">確認メールの送信</span><span class="sxs-lookup"><span data-stu-id="c01a7-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="c01a7-279">既定では、ChangePassword コントロールは、パスワードが更新されたばかりのユーザーに電子メールメッセージを送信しません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="c01a7-280">電子メールを送信する場合は、コントロールの `MailDefinition` プロパティを構成するだけです。</span><span class="sxs-lookup"><span data-stu-id="c01a7-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="c01a7-281">新しいパスワードを含む HTML 形式の電子メールがユーザーに送信されるように、ChangePassword コントロールを構成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c01a7-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="c01a7-282">まず、`ChangePassword.htm`という名前の `EmailTemplates` フォルダーに新しいファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="c01a7-283">次のマークアップを追加します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-vb/samples/sample4.html)]

<span data-ttu-id="c01a7-284">次に、ChangePassword コントロールの `MailDefinition` プロパティの `BodyFileName`、`IsBodyHtml`、および `Subject` プロパティを ~/EmailTemplates/ChangePassword.htm、True に設定します。パスワードはそれぞれ変更されています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="c01a7-285">これらの変更を行った後、ページを再入力して、もう一度パスワードを変更します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="c01a7-286">このとき、ChangePassword コントロールは、カスタマイズされた HTML 形式の電子メールをファイルのユーザーの電子メールアドレスに送信します (図8を参照)。</span><span class="sxs-lookup"><span data-stu-id="c01a7-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>

<span data-ttu-id="c01a7-287">[パスワードが変更されたことをユーザーに通知する電子メールメッセージを ![する](recovering-and-changing-passwords-vb/_static/image23.png)](recovering-and-changing-passwords-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c01a7-287">[![An Email Message Informs the User That Their Password has Changed](recovering-and-changing-passwords-vb/_static/image23.png)](recovering-and-changing-passwords-vb/_static/image22.png)</span></span>

<span data-ttu-id="c01a7-288">**図 8**: 電子メールメッセージによって、パスワードが変更されたことがユーザーに通知される ([クリックすると、フルサイズの画像が表示](recovering-and-changing-passwords-vb/_static/image24.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c01a7-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image24.png))</span></span>

## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="c01a7-289">手順 3: 管理者がユーザーのパスワードを変更できるようにする</span><span class="sxs-lookup"><span data-stu-id="c01a7-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="c01a7-290">ユーザーアカウントをサポートするアプリケーションの一般的な機能は、管理ユーザーが他のユーザーのパスワードを変更できるようにする機能です。</span><span class="sxs-lookup"><span data-stu-id="c01a7-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="c01a7-291">場合によっては、ユーザーが自分のパスワードを変更する機能がないため、この機能が必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="c01a7-292">このような場合、ユーザーが忘れたパスワードを回復する唯一の方法は、管理者が新しいパスワードを割り当てることです。</span><span class="sxs-lookup"><span data-stu-id="c01a7-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="c01a7-293">ただし、PasswordRecovery と ChangePassword コントロールでは、管理ユーザーがユーザーのパスワードを変更する必要があります。ユーザーはこの操作を行うことができるためです。</span><span class="sxs-lookup"><span data-stu-id="c01a7-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="c01a7-294">しかし、クライアントが他のユーザーのパスワードを変更できるようにする必要がある場合はどうでしょうか。</span><span class="sxs-lookup"><span data-stu-id="c01a7-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="c01a7-295">残念ながら、この機能の追加には少しの作業が必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="c01a7-296">ユーザーのパスワードを変更するには、古いパスワードと新しいパスワードの両方を `MembershipUser` オブジェクトの `ChangePassword` 方法に指定する必要がありますが、管理者は変更するためにユーザーのパスワードを知らなければなりません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="c01a7-297">回避策の1つとして、まずユーザーのパスワードをリセットし、次のようなコードを使用して新しいパスワードに変更します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-vb[Main](recovering-and-changing-passwords-vb/samples/sample5.vb)]

<span data-ttu-id="c01a7-298">このコードでは、まず*ユーザー名*に関する情報を取得します。これは、管理者が変更するパスワードを持つユーザーです。</span><span class="sxs-lookup"><span data-stu-id="c01a7-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="c01a7-299">次に、`ResetPassword` メソッドが呼び出されます。これにより、とユーザーに新しいランダムなパスワードが割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="c01a7-300">このランダムに生成されたパスワードは、メソッドによって返され、`resetPwd`変数に格納されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="c01a7-301">これで、ユーザーのパスワードがわかったので、`ChangePassword`を呼び出すことで変更できます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="c01a7-302">問題は、`RequiresQuestionAndAnswer` が False になるようにメンバーシップシステムの構成が設定されている場合にのみ、このコードが機能することです。</span><span class="sxs-lookup"><span data-stu-id="c01a7-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="c01a7-303">`RequiresQuestionAndAnswer` が True の場合、アプリケーションの場合と同じように、`ResetPassword` メソッドにセキュリティの解答を渡す必要があります。そうしないと、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="c01a7-304">メンバーシップフレームワークがセキュリティの質問と回答を要求するように構成されているにもかかわらず、管理者がユーザーのパスワードを変更できることをクライアントが主張する場合は、次の3つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="c01a7-305">空中を捨てて、このことを行うことができないことをクライアントに通知します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="c01a7-306">`RequiresQuestionAndAnswer` を False に設定します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="c01a7-307">これにより、安全性の低いアプリケーションが生成されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-307">This results in a less secure application.</span></span> <span data-ttu-id="c01a7-308">不正ユーザーが別のユーザーの電子メールの受信トレイにアクセスしたとします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="c01a7-309">侵害されたユーザーが、昼食にアクセスしたり、ワークステーションをロックしたりしなかったか、公共のターミナルからメールにアクセスした可能性があり、サインアウトしていない可能性があります。どちらの場合も、不正ユーザーは `RecoverPassword.aspx` のページにアクセスして、ユーザーのユーザー名を入力できます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="c01a7-310">その後、システムは、回復されたパスワードを、セキュリティの回答を求めるメッセージを表示せずに電子メールで送信します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="c01a7-311">メンバーシップフレームワークによって作成された抽象化レイヤーをバイパスし、SQL Server データベースを直接操作します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="c01a7-312">メンバーシップスキーマには、ユーザーのパスワードを設定する `aspnet_Membership_SetPassword` という名前のストアドプロシージャが含まれており、そのタスクを実行するためにセキュリティの答えや古いパスワードは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="c01a7-313">これらのオプションはどれも特に魅力的なものではありませんが、開発者の生活がどのように行われるかということがあります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="c01a7-314">3番目のアプローチを実装し、`Membership` と `MembershipUser` クラスをバイパスし、`SecurityTutorials` データベースに対して直接操作するコードを記述しました。</span><span class="sxs-lookup"><span data-stu-id="c01a7-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-315">データベースを直接操作することにより、メンバーシップフレームワークによって提供されるカプセル化が砕かれます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="c01a7-316">この決定により、`SqlMembershipProvider`に結び付け、コードの移植性が低下します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="c01a7-317">さらに、メンバーシップスキーマが変更された場合、ASP.NET の将来のバージョンでは、このコードが期待どおりに動作しないことがあります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="c01a7-318">この方法は回避策であり、ほとんどの回避策と同様に、ベストプラクティスの例ではありません。</span><span class="sxs-lookup"><span data-stu-id="c01a7-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>

<span data-ttu-id="c01a7-319">コードにはいくつかの魅力的ビットがあり、非常に時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="c01a7-320">このため、このチュートリアルを詳しく見ていくことは避けたいと思います。</span><span class="sxs-lookup"><span data-stu-id="c01a7-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="c01a7-321">詳細については、このチュートリアルのコードをダウンロードし、`~/Administration/ManageUsers.aspx` のページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="c01a7-322"><a id="_msoanchor_5"> </a>[前のチュートリアル](building-an-interface-to-select-one-user-account-from-many-vb.md)で作成したこのページには、各ユーザーの一覧が表示されています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-vb.md), lists each user.</span></span> <span data-ttu-id="c01a7-323">GridView を更新して、`UserInformation.aspx` ページへのリンクを含め、選択したユーザーのユーザー名を querystring で渡しました。</span><span class="sxs-lookup"><span data-stu-id="c01a7-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="c01a7-324">[`UserInformation.aspx`] ページには、選択したユーザーとパスワードを変更するためのテキストボックスに関する情報が表示されます (図9を参照)。</span><span class="sxs-lookup"><span data-stu-id="c01a7-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="c01a7-325">新しいパスワードを入力し、2番目のテキストボックスで確認し、[ユーザーの更新] ボタンをクリックすると、ポストバック ensues と `aspnet_Membership_SetPassword` ストアドプロシージャが呼び出され、ユーザーのパスワードが更新されます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="c01a7-326">この機能に関心を持っている読者は、コードについて理解を深め、パスワードが変更されたユーザーに電子メールを送信するように機能を拡張することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c01a7-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>

<span data-ttu-id="c01a7-327">[管理者がユーザーのパスワードを変更する ![](recovering-and-changing-passwords-vb/_static/image26.png)](recovering-and-changing-passwords-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c01a7-327">[![An Administrator May Change a User's Password](recovering-and-changing-passwords-vb/_static/image26.png)](recovering-and-changing-passwords-vb/_static/image25.png)</span></span>

<span data-ttu-id="c01a7-328">**図 9**: 管理者がユーザーのパスワードを変更[する (クリックすると、フルサイズの画像が表示](recovering-and-changing-passwords-vb/_static/image27.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c01a7-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image27.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c01a7-329">現在、`UserInformation.aspx` ページは、パスワードをクリアまたはハッシュ形式で格納するようにメンバーシップフレームワークが構成されている場合にのみ機能します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="c01a7-330">新しいパスワードを暗号化するためのコードは不足していますが、この機能を追加するように招待されています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="c01a7-331">必要なコードを追加する方法は、デコンパイラのようなを使用して、.NET Framework 内のメソッドのソース[コードを調べる](http://www.aisto.com/roeder/dotnet/)ことです。まず、`SqlMembershipProvider` クラスの `ChangePassword` メソッドを調べます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="c01a7-332">これは、パスワードのハッシュを作成するためのコードを記述するために使用した手法です。</span><span class="sxs-lookup"><span data-stu-id="c01a7-332">This is the technique I used to write the code for creating a hash of the password.</span></span>

## <a name="summary"></a><span data-ttu-id="c01a7-333">要約</span><span class="sxs-lookup"><span data-stu-id="c01a7-333">Summary</span></span>

<span data-ttu-id="c01a7-334">ASP.NET には、ユーザーがパスワードを管理するのに役立つ2つのコントロールが用意されています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="c01a7-335">PasswordRecovery コントロールは、パスワードを忘れたユーザーに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="c01a7-336">メンバーシップフレームワークの構成によっては、ユーザーは既存のパスワードまたはランダムに生成された新しいパスワードを電子メールで送信することになります。</span><span class="sxs-lookup"><span data-stu-id="c01a7-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="c01a7-337">ChangePassword コントロールを使用すると、ユーザーは自分のパスワードを更新できます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="c01a7-338">Login および CreateUserWizard コントロールと同様に、PasswordRecovery と ChangePassword コントロールは、宣言型マークアップやコード行を記述しなくても、豊富なユーザーインターフェイスを表示します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="c01a7-339">既定のユーザーインターフェイスがニーズを満たさない場合は、さまざまなスタイルのプロパティを使用してカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="c01a7-340">もう1つの方法として、コントロールのインターフェイスをテンプレートに変換して、さらに細かく制御することもできます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="c01a7-341">バックグラウンドでは、これらのコントロールは Membership API を使用して、`MembershipUser` オブジェクトの `ResetPassword` と `ChangePassword` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="c01a7-342">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="c01a7-343">関連項目</span><span class="sxs-lookup"><span data-stu-id="c01a7-343">Further Reading</span></span>

<span data-ttu-id="c01a7-344">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c01a7-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c01a7-345">ChangePassword コントロールのクイックスタート</span><span class="sxs-lookup"><span data-stu-id="c01a7-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="c01a7-346">PasswordRecovery コントロールのクイックスタート</span><span class="sxs-lookup"><span data-stu-id="c01a7-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="c01a7-347">ASP.NET で電子メールを送信しています</span><span class="sxs-lookup"><span data-stu-id="c01a7-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="c01a7-348">`System.Net.Mail` Faq</span><span class="sxs-lookup"><span data-stu-id="c01a7-348">`System.Net.Mail` FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="c01a7-349">作成者について</span><span class="sxs-lookup"><span data-stu-id="c01a7-349">About the Author</span></span>

<span data-ttu-id="c01a7-350">1998以降、Microsoft の Web テクノロジを使用して、Scott Mitchell (複数の ASP/創設者4GuysFromRolla.com の執筆者) が Microsoft の Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c01a7-351">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c01a7-352">彼の最新の書籍は *[、ASP.NET 2.0 を24時間以内に教え](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* ています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="c01a7-353">Scott は、 [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com)またはブログで[http://ScottOnWriting.NET](http://scottonwriting.net/)にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c01a7-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="c01a7-354">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="c01a7-354">Special Thanks To</span></span>

<span data-ttu-id="c01a7-355">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="c01a7-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c01a7-356">このチュートリアルのリードレビュー担当者には、Michael Emmings と Suchi Erjee が含まれています。</span><span class="sxs-lookup"><span data-stu-id="c01a7-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="c01a7-357">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="c01a7-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c01a7-358">その場合は、 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)の行を削除します。</span><span class="sxs-lookup"><span data-stu-id="c01a7-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c01a7-359">[前へ](building-an-interface-to-select-one-user-account-from-many-vb.md)
> [次へ](unlocking-and-approving-user-accounts-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c01a7-359">[Previous](building-an-interface-to-select-one-user-account-from-many-vb.md)
[Next](unlocking-and-approving-user-accounts-vb.md)</span></span>
