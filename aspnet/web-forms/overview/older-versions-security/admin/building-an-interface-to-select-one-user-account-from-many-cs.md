---
uid: web-forms/overview/older-versions-security/admin/building-an-interface-to-select-one-user-account-from-many-cs
title: 多くの (C#) から1つのユーザーアカウントを選択するインターフェイスを構築するMicrosoft Docs
author: rick-anderson
description: このチュートリアルでは、ページ分割されたフィルター可能なグリッドを使用してユーザーインターフェイスを作成します。 特に、ユーザーインターフェイスは、一連のリンクボタンで構成されています。
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 9e4e687c-b4ec-434f-a4ef-edb0b8f365e4
msc.legacyurl: /web-forms/overview/older-versions-security/admin/building-an-interface-to-select-one-user-account-from-many-cs
msc.type: authoredcontent
ms.openlocfilehash: 8057cfbcd33c74376076363bc27940cebd522c08
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78522028"
---
# <a name="building-an-interface-to-select-one-user-account-from-many-c"></a><span data-ttu-id="82c7a-104">多くの中からユーザー アカウントを 1 つ選択するインターフェイスを構築する (C#)</span><span class="sxs-lookup"><span data-stu-id="82c7a-104">Building an Interface to Select One User Account from Many (C#)</span></span>

<span data-ttu-id="82c7a-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="82c7a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="82c7a-106">[コードのダウンロード](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.12.zip)または[PDF のダウンロード](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial12_SelectUser_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="82c7a-106">[Download Code](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.12.zip) or [Download PDF](https://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial12_SelectUser_cs.pdf)</span></span>

> <span data-ttu-id="82c7a-107">このチュートリアルでは、ページ分割されたフィルター可能なグリッドを使用してユーザーインターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-107">In this tutorial we will build a user interface with a paged, filterable grid.</span></span> <span data-ttu-id="82c7a-108">特に、ユーザーインターフェイスは、ユーザー名の開始文字に基づいて結果をフィルター処理するための一連のリンクボタンと、一致するユーザーを表示する GridView コントロールで構成されています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-108">In particular, our user interface will consist of a series of LinkButtons for filtering the results based on the starting letter of the username, and a GridView control to show the matching users.</span></span> <span data-ttu-id="82c7a-109">まず、GridView のすべてのユーザーアカウントを一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-109">We'll start by listing all of the user accounts in a GridView.</span></span> <span data-ttu-id="82c7a-110">次に、手順3では、[LinkButtons] フィルターを追加します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-110">Then, in Step 3, we will add the filter LinkButtons.</span></span> <span data-ttu-id="82c7a-111">手順 4. では、フィルター処理された結果がページングされます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-111">Step 4 looks at paging the filtered results.</span></span> <span data-ttu-id="82c7a-112">手順 2. ~ 4. で作成したインターフェイスは、その後のチュートリアルで特定のユーザーアカウントの管理タスクを実行するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-112">The interface constructed in Steps 2 through 4 will be used in the subsequent tutorials to perform administrative tasks for a particular user account.</span></span>

## <a name="introduction"></a><span data-ttu-id="82c7a-113">はじめに</span><span class="sxs-lookup"><span data-stu-id="82c7a-113">Introduction</span></span>

<span data-ttu-id="82c7a-114"><a id="_msoanchor_1"> </a>[*ユーザーへのロールの割り当て*](../roles/assigning-roles-to-users-cs.md)に関するチュートリアルでは、管理者がユーザーを選択してロールを管理するための基本的なインターフェイスを作成しました。</span><span class="sxs-lookup"><span data-stu-id="82c7a-114">In the <a id="_msoanchor_1"></a>[*Assigning Roles to Users*](../roles/assigning-roles-to-users-cs.md) tutorial, we created a rudimentary interface for an administrator to select a user and manage her roles.</span></span> <span data-ttu-id="82c7a-115">具体的には、インターフェイスは、すべてのユーザーのドロップダウンリストを管理者に提示します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-115">Specifically, the interface presented the administrator with a drop-down list of all of the users.</span></span> <span data-ttu-id="82c7a-116">このようなインターフェイスは、ユーザーアカウントが1つしかない場合に適していますが、数百または数千のアカウントを持つサイトでは扱いにくいものです。</span><span class="sxs-lookup"><span data-stu-id="82c7a-116">Such an interface is suitable when there are but a dozen or so user accounts, but is unwieldy for sites with hundreds or thousands of accounts.</span></span> <span data-ttu-id="82c7a-117">ページ分割されたフィルター可能なグリッドは、大規模なユーザーベースを持つ web サイトに適したユーザーインターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="82c7a-117">A paged, filterable grid is more suitable user interface for websites with large user bases.</span></span>

<span data-ttu-id="82c7a-118">このチュートリアルでは、このようなユーザーインターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-118">In this tutorial we will build such a user interface.</span></span> <span data-ttu-id="82c7a-119">特に、ユーザーインターフェイスは、ユーザー名の開始文字に基づいて結果をフィルター処理するための一連のリンクボタンと、一致するユーザーを表示する GridView コントロールで構成されています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-119">In particular, our user interface will consist of a series of LinkButtons for filtering the results based on the starting letter of the username, and a GridView control to show the matching users.</span></span> <span data-ttu-id="82c7a-120">まず、GridView のすべてのユーザーアカウントを一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-120">We'll start by listing all of the user accounts in a GridView.</span></span> <span data-ttu-id="82c7a-121">次に、手順3では、[LinkButtons] フィルターを追加します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-121">Then, in Step 3, we will add the filter LinkButtons.</span></span> <span data-ttu-id="82c7a-122">手順 4. では、フィルター処理された結果がページングされます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-122">Step 4 looks at paging the filtered results.</span></span> <span data-ttu-id="82c7a-123">手順 2. ~ 4. で作成したインターフェイスは、その後のチュートリアルで特定のユーザーアカウントの管理タスクを実行するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-123">The interface constructed in Steps 2 through 4 will be used in the subsequent tutorials to perform administrative tasks for a particular user account.</span></span>

<span data-ttu-id="82c7a-124">作業開始</span><span class="sxs-lookup"><span data-stu-id="82c7a-124">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="82c7a-125">手順 1: 新しい ASP.NET ページを追加する</span><span class="sxs-lookup"><span data-stu-id="82c7a-125">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="82c7a-126">このチュートリアルと次の2つでは、管理に関連するさまざまな機能について説明します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-126">In this tutorial and the next two we will be examining various administration-related functions and capabilities.</span></span> <span data-ttu-id="82c7a-127">これらのチュートリアル全体で検討したトピックを実装するには、一連の ASP.NET ページが必要です。</span><span class="sxs-lookup"><span data-stu-id="82c7a-127">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="82c7a-128">これらのページを作成し、サイトマップを更新してみましょう。</span><span class="sxs-lookup"><span data-stu-id="82c7a-128">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="82c7a-129">まず、`Administration`という名前のプロジェクトに新しいフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-129">Start by creating a new folder in the project named `Administration`.</span></span> <span data-ttu-id="82c7a-130">次に、2つの新しい ASP.NET ページをフォルダーに追加し、各ページを `Site.master` マスターページとリンクします。</span><span class="sxs-lookup"><span data-stu-id="82c7a-130">Next, add two new ASP.NET pages to the folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="82c7a-131">ページに名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-131">Name the pages:</span></span>

- `ManageUsers.aspx`
- `UserInformation.aspx`

<span data-ttu-id="82c7a-132">また、web サイトのルートディレクトリに2つのページを追加します。 `ChangePassword.aspx` と `RecoverPassword.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="82c7a-132">Also add two pages to the website's root directory: `ChangePassword.aspx` and `RecoverPassword.aspx`.</span></span>

<span data-ttu-id="82c7a-133">この4つのページには、この時点で2つのコンテンツコントロールが含まれている必要があります。1つは、`MainContent` と `LoginContent`の各マスターページの ContentPlaceHolders です。</span><span class="sxs-lookup"><span data-stu-id="82c7a-133">These four pages should, at this point, have two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample1.aspx)]

<span data-ttu-id="82c7a-134">これらのページの `LoginContent` ContentPlaceHolder のマスターページの既定のマークアップを表示します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-134">We want to show the master page's default markup for the `LoginContent` ContentPlaceHolder for these pages.</span></span> <span data-ttu-id="82c7a-135">そのため、`Content2` コンテンツコントロールの宣言型マークアップを削除します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-135">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="82c7a-136">その後、ページのマークアップにはコンテンツコントロールを1つだけ含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-136">After doing so, the pages' markup should contain just one Content control.</span></span>

<span data-ttu-id="82c7a-137">`Administration` フォルダー内の ASP.NET ページは、管理ユーザー専用です。</span><span class="sxs-lookup"><span data-stu-id="82c7a-137">The ASP.NET pages in the `Administration` folder are intended solely for administrative users.</span></span> <span data-ttu-id="82c7a-138"><a id="_msoanchor_2"> </a>[*ロールの作成と管理*](../roles/creating-and-managing-roles-cs.md)に関するチュートリアルで、システムに管理者ロールを追加しました。このロールに対して、これら2つのページへのアクセスを制限します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-138">We added an Administrators role to the system in the <a id="_msoanchor_2"></a>[*Creating and Managing Roles*](../roles/creating-and-managing-roles-cs.md) tutorial; restrict access to these two pages to this role.</span></span> <span data-ttu-id="82c7a-139">これを行うには、`Administration` フォルダーに `Web.config` ファイルを追加し、管理者ロールのユーザーを許可し、他のユーザーを拒否するように `<authorization>` 要素を構成します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-139">To accomplish this, add a `Web.config` file to the `Administration` folder and configure its `<authorization>` element to admit users in the Administrators role and to deny all others.</span></span>

[!code-xml[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample2.xml)]

<span data-ttu-id="82c7a-140">この時点で、プロジェクトのソリューションエクスプローラーは、図1に示すスクリーンショットのようになります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-140">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>

<span data-ttu-id="82c7a-141">[![4 つの新しいページと web.config ファイルが web サイトに追加されました。](building-an-interface-to-select-one-user-account-from-many-cs/_static/image2.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="82c7a-141">[![Four New Pages and a Web.config File Have Been Added to the Website](building-an-interface-to-select-one-user-account-from-many-cs/_static/image2.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image1.png)</span></span>

<span data-ttu-id="82c7a-142">**図 1**: 4 つの新しいページと `Web.config` ファイルが web サイトに追加された ([クリックすると、フルサイズの画像が表示](building-an-interface-to-select-one-user-account-from-many-cs/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="82c7a-142">**Figure 1**: Four New Pages and a `Web.config` File Have Been Added to the Website  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image3.png))</span></span>

<span data-ttu-id="82c7a-143">最後に、[`ManageUsers.aspx`] ページにエントリを含めるようにサイトマップ (`Web.sitemap`) を更新します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-143">Finally, update the site map (`Web.sitemap`) to include an entry to the `ManageUsers.aspx` page.</span></span> <span data-ttu-id="82c7a-144">ロールのチュートリアル用に追加した `<siteMapNode>` の後に、次の XML を追加します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-144">Add the following XML after the `<siteMapNode>` we added for the Roles tutorials.</span></span>

[!code-xml[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample3.xml)]

<span data-ttu-id="82c7a-145">サイトマップが更新されたら、ブラウザーを使用してサイトにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="82c7a-145">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="82c7a-146">図2に示すように、左側のナビゲーションには管理チュートリアルの項目が含まれるようになりました。</span><span class="sxs-lookup"><span data-stu-id="82c7a-146">As Figure 2 shows, the navigation on the left now includes items for the Administration tutorials.</span></span>

<span data-ttu-id="82c7a-147">[サイトマップに、ユーザーの管理者という名前のノードが含まれている ![](building-an-interface-to-select-one-user-account-from-many-cs/_static/image5.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="82c7a-147">[![The Site Map Includes a Node Titled User Administration](building-an-interface-to-select-one-user-account-from-many-cs/_static/image5.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image4.png)</span></span>

<span data-ttu-id="82c7a-148">**図 2**: サイトマップに、[ユーザーの管理] という名前のノードが含まれている ([クリックしてフルサイズの画像を表示する](building-an-interface-to-select-one-user-account-from-many-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="82c7a-148">**Figure 2**: The Site Map Includes a Node Titled User Administration  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image6.png))</span></span>

## <a name="step-2-listing-all-user-accounts-in-a-gridview"></a><span data-ttu-id="82c7a-149">手順 2: GridView 内のすべてのユーザーアカウントを一覧表示する</span><span class="sxs-lookup"><span data-stu-id="82c7a-149">Step 2: Listing All User Accounts in a GridView</span></span>

<span data-ttu-id="82c7a-150">このチュートリアルの最終的な目的は、管理者が管理対象のユーザーアカウントを選択できる、ページングされたフィルター処理されたグリッドを作成することです。</span><span class="sxs-lookup"><span data-stu-id="82c7a-150">Our end goal for this tutorial is to create a paged, filterable grid through which an administrator can select a user account to manage.</span></span> <span data-ttu-id="82c7a-151">まず、GridView の*すべて*のユーザーを一覧表示しましょう。</span><span class="sxs-lookup"><span data-stu-id="82c7a-151">Let's start by listing *all* users in a GridView.</span></span> <span data-ttu-id="82c7a-152">この操作が完了したら、フィルター処理とページングのインターフェイスと機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-152">Once this is complete, we will add the filtering and paging interfaces and functionality.</span></span>

<span data-ttu-id="82c7a-153">`Administration` フォルダーの [`ManageUsers.aspx`] ページを開き、GridView を追加して、`ID` を `UserAccounts`に設定します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-153">Open the `ManageUsers.aspx` page in the `Administration` folder and add a GridView, setting its `ID` to `UserAccounts`.</span></span> <span data-ttu-id="82c7a-154">現時点では、`Membership` クラスの `GetAllUsers` メソッドを使用して、ユーザーアカウントのセットを GridView にバインドするコードを記述します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-154">In a moment, we will write code to bind the set of user accounts to the GridView using the `Membership` class's `GetAllUsers` method.</span></span> <span data-ttu-id="82c7a-155">前のチュートリアルで説明したように、GetAllUsers メソッドは、`MembershipUser` オブジェクトのコレクションである `MembershipUserCollection` オブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-155">As discussed in earlier tutorials, the GetAllUsers method returns a `MembershipUserCollection` object, which is a collection of `MembershipUser` objects.</span></span> <span data-ttu-id="82c7a-156">コレクション内の各 `MembershipUser` には、`UserName`、`Email`、`IsApproved`などのプロパティが含まれます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-156">Each `MembershipUser` in the collection includes properties like `UserName`, `Email`, `IsApproved`, and so on.</span></span>

<span data-ttu-id="82c7a-157">GridView で目的のユーザーアカウント情報を表示するには、GridView の `AutoGenerateColumns` プロパティを False に設定し、`IsApproved`、`IsLockedOut`、および `IsOnline` の各プロパティに対して `UserName`、`Email`、および `Comment` のプロパティと CheckBoxFields の連結フィールドを追加します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-157">In order to display the desired user account information in the GridView, set the GridView's `AutoGenerateColumns` property to False and add BoundFields for the `UserName`, `Email`, and `Comment` properties and CheckBoxFields for the `IsApproved`, `IsLockedOut`, and `IsOnline` properties.</span></span> <span data-ttu-id="82c7a-158">この構成は、コントロールの宣言型マークアップまたは [フィールド] ダイアログボックスを使用して適用できます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-158">This configuration can be applied through the control's declarative markup or via the Fields dialog box.</span></span> <span data-ttu-id="82c7a-159">図3は、[フィールドの自動生成] チェックボックスがオフになっていて、BoundFields と CheckBoxFields が追加および構成された後の [フィールド] ダイアログボックスのスクリーンショットを示しています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-159">Figure 3 shows a screen shot of the Fields dialog box after the Auto-generate fields checkbox has been unchecked and the BoundFields and CheckBoxFields have been added and configured.</span></span>

<span data-ttu-id="82c7a-160">[![3 つの BoundFields と3つの CheckBoxFields を GridView に追加します。](building-an-interface-to-select-one-user-account-from-many-cs/_static/image8.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="82c7a-160">[![Add Three BoundFields and Three CheckBoxFields to the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image8.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image7.png)</span></span>

<span data-ttu-id="82c7a-161">**図 3**: 3 つの boundfields と3つの CheckBoxFields を GridView に追加[する (クリックすると、フルサイズの画像が表示](building-an-interface-to-select-one-user-account-from-many-cs/_static/image9.png)されます)</span><span class="sxs-lookup"><span data-stu-id="82c7a-161">**Figure 3**: Add Three BoundFields and Three CheckBoxFields to the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image9.png))</span></span>

<span data-ttu-id="82c7a-162">GridView を構成した後、その宣言型マークアップが次のようになっていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-162">After configuring your GridView, ensure that its declarative markup resembles the following:</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample4.aspx)]

<span data-ttu-id="82c7a-163">次に、ユーザーアカウントを GridView にバインドするコードを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-163">Next, we need to write code that binds the user accounts to the GridView.</span></span> <span data-ttu-id="82c7a-164">このタスクを実行する `BindUserAccounts` という名前のメソッドを作成し、最初のページにアクセスしたときに `Page_Load` イベントハンドラーから呼び出します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-164">Create a method named `BindUserAccounts` to perform this task and then call it from the `Page_Load` event handler on the first page visit.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample5.cs)]

<span data-ttu-id="82c7a-165">ブラウザーでページをテストしてみましょう。</span><span class="sxs-lookup"><span data-stu-id="82c7a-165">Take a moment to test the page through a browser.</span></span> <span data-ttu-id="82c7a-166">図4に示すように、`UserAccounts` GridView は、システム内のすべてのユーザーのユーザー名、電子メールアドレス、およびその他の関連するアカウント情報を一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-166">As Figure 4 shows, the `UserAccounts` GridView lists the username, email address, and other pertinent account information for all users in the system.</span></span>

<span data-ttu-id="82c7a-167">[GridView にユーザーアカウントが表示される ![](building-an-interface-to-select-one-user-account-from-many-cs/_static/image11.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="82c7a-167">[![The User Accounts are Listed in the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image11.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image10.png)</span></span>

<span data-ttu-id="82c7a-168">**図 4**: GridView にユーザーアカウントが表示される ([クリックすると、フルサイズの画像が表示](building-an-interface-to-select-one-user-account-from-many-cs/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="82c7a-168">**Figure 4**: The User Accounts are Listed in the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image12.png))</span></span>

## <a name="step-3-filtering-the-results-by-the-first-letter-of-the-username"></a><span data-ttu-id="82c7a-169">手順 3: ユーザー名の最初の文字で結果をフィルター処理する</span><span class="sxs-lookup"><span data-stu-id="82c7a-169">Step 3: Filtering the Results by the First Letter of the Username</span></span>

<span data-ttu-id="82c7a-170">現在 `UserAccounts` GridView には、*すべて*のユーザーアカウントが表示されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-170">Currently the `UserAccounts` GridView shows *all* of the user accounts.</span></span> <span data-ttu-id="82c7a-171">数百または数千のユーザーアカウントを持つ web サイトでは、表示されているアカウントをユーザーがすばやく省いできるようにすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="82c7a-171">For websites with hundreds or thousands of user accounts, it is imperative that user be able to quickly pare down the displayed accounts.</span></span> <span data-ttu-id="82c7a-172">これは、ページにフィルターリンクボタンを追加することによって実現できます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-172">This can be accomplished by adding filtering LinkButtons to the page.</span></span> <span data-ttu-id="82c7a-173">ページに 27 LinkButtons を追加してみましょう。1つはアルファベットの各文字につき1つの LinkButton です。</span><span class="sxs-lookup"><span data-stu-id="82c7a-173">Let's add 27 LinkButtons to the page: one titled All along with one LinkButton for each letter of the alphabet.</span></span> <span data-ttu-id="82c7a-174">ビジターが All LinkButton をクリックすると、GridView にすべてのユーザーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-174">If a visitor clicks the All LinkButton, the GridView will show all of the users.</span></span> <span data-ttu-id="82c7a-175">ユーザーが特定の文字をクリックすると、ユーザー名が選択した文字で始まるユーザーのみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-175">If they click a particular letter, only those users whose username starts with the selected letter will be displayed.</span></span>

<span data-ttu-id="82c7a-176">最初のタスクでは、27 LinkButton コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-176">Our first task is to add the 27 LinkButton controls.</span></span> <span data-ttu-id="82c7a-177">1つの方法として、27リンクボタンを宣言によって一度に1つ作成する方法があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-177">One option would be to create the 27 LinkButtons declaratively, one at a time.</span></span> <span data-ttu-id="82c7a-178">より柔軟な方法は、LinkButton をレンダリングする `ItemTemplate` で Repeater コントロールを使用し、その後、フィルターオプションを `string` 配列としてリピータにバインドすることです。</span><span class="sxs-lookup"><span data-stu-id="82c7a-178">A more flexible approach is to use a Repeater control with an `ItemTemplate` that renders a LinkButton and then binds the filtering options to the Repeater as a `string` array.</span></span>

<span data-ttu-id="82c7a-179">まず、`UserAccounts` GridView の上のページに Repeater コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-179">Start by adding a Repeater control to the page above the `UserAccounts` GridView.</span></span> <span data-ttu-id="82c7a-180">リピータの `ID` プロパティを `FilteringUI`に設定します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-180">Set the Repeater's `ID` property to `FilteringUI`.</span></span> <span data-ttu-id="82c7a-181">リピータのテンプレートを構成して、`Text` と `CommandName` プロパティが現在の配列要素にバインドされている LinkButton を `ItemTemplate` にレンダリングするようにします。</span><span class="sxs-lookup"><span data-stu-id="82c7a-181">Configure the Repeater's templates so that its `ItemTemplate` renders a LinkButton whose `Text` and `CommandName` properties are bound to the current array element.</span></span> <span data-ttu-id="82c7a-182"><a id="_msoanchor_3"> </a>[*ユーザーへのロールの割り当て*](../roles/assigning-roles-to-users-cs.md)に関するチュートリアルで説明したように、これは `Container.DataItem` databinding 構文を使用して実現できます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-182">As we saw in the <a id="_msoanchor_3"></a>[*Assigning Roles to Users*](../roles/assigning-roles-to-users-cs.md) tutorial, this can be accomplished using the `Container.DataItem` databinding syntax.</span></span> <span data-ttu-id="82c7a-183">リピータの `SeparatorTemplate` を使用して、各リンクの間に垂直線を表示します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-183">Use the Repeater's `SeparatorTemplate` to display a vertical line between each link.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample6.aspx)]

<span data-ttu-id="82c7a-184">このリピータに必要なフィルター処理オプションを設定するには、`BindFilteringUI`という名前のメソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-184">To populate this Repeater with the desired filtering options, create a method named `BindFilteringUI`.</span></span> <span data-ttu-id="82c7a-185">最初のページの読み込み時に、`Page_Load` イベントハンドラーからこのメソッドを呼び出すようにしてください。</span><span class="sxs-lookup"><span data-stu-id="82c7a-185">Be sure to call this method from the `Page_Load` event handler on the first page load.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample7.cs)]

<span data-ttu-id="82c7a-186">このメソッドは、`string` 配列 `filterOptions`の要素としてフィルター処理オプションを指定します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-186">This method specifies the filtering options as elements in the `string` array `filterOptions`.</span></span> <span data-ttu-id="82c7a-187">リピータは、配列内の要素ごとに、`Text` を持つ LinkButton と、配列要素の値に割り当てられた `CommandName` プロパティを表示します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-187">For each element in the array, the Repeater will render a LinkButton with its `Text` and `CommandName` properties assigned to the value of the array element.</span></span>

<span data-ttu-id="82c7a-188">図5は、ブラウザーを使用して表示するときの `ManageUsers.aspx` ページを示しています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-188">Figure 5 shows the `ManageUsers.aspx` page when viewed through a browser.</span></span>

<span data-ttu-id="82c7a-189">[リピータ ![リンクボタンの一覧27](building-an-interface-to-select-one-user-account-from-many-cs/_static/image14.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="82c7a-189">[![The Repeater Lists 27 Filtering LinkButtons](building-an-interface-to-select-one-user-account-from-many-cs/_static/image14.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image13.png)</span></span>

<span data-ttu-id="82c7a-190">**図 5**: リピータは、27フィルターリンクボタンを一覧表示しています ([クリックすると、フルサイズの画像が表示](building-an-interface-to-select-one-user-account-from-many-cs/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="82c7a-190">**Figure 5**: The Repeater Lists 27 Filtering LinkButtons  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="82c7a-191">ユーザー名は、数字や句読点を含む任意の文字で始めることができます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-191">Usernames may start with any character, including numbers and punctuation.</span></span> <span data-ttu-id="82c7a-192">これらのアカウントを表示するために、管理者は All LinkButton オプションを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-192">In order to view these accounts, the administrator will have to use the All LinkButton option.</span></span> <span data-ttu-id="82c7a-193">または、LinkButton を追加して、番号で始まるすべてのユーザーアカウントを返すこともできます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-193">Alternatively, you could add a LinkButton to return all user accounts that start with a number.</span></span> <span data-ttu-id="82c7a-194">この作業をリーダーの演習として残しておきます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-194">I leave this as an exercise for the reader.</span></span>

<span data-ttu-id="82c7a-195">フィルターリンクボタンのいずれかをクリックすると、ポストバックが発生し、リピータの `ItemCommand` イベントが発生しますが、結果をフィルター処理するコードをまだ記述していないため、グリッドは変わりません。</span><span class="sxs-lookup"><span data-stu-id="82c7a-195">Clicking any of the filtering LinkButtons causes a postback and raises the Repeater's `ItemCommand` event, but there's no change in the grid because we've yet to write any code to filter the results.</span></span> <span data-ttu-id="82c7a-196">`Membership` クラスには、ユーザー名が指定した検索パターンに一致するユーザーアカウントを返す[`FindUsersByName` メソッド](https://technet.microsoft.com/library/system.web.security.membership.findusersbyname.aspx)が含まれています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-196">The `Membership` class includes a [`FindUsersByName` method](https://technet.microsoft.com/library/system.web.security.membership.findusersbyname.aspx) that returns those user accounts whose username matches a specified search pattern.</span></span> <span data-ttu-id="82c7a-197">このメソッドを使用すると、ユーザー名が、クリックされたフィルター選択された LinkButton の `CommandName` で指定された文字で始まるユーザーアカウントだけを取得できます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-197">We can use this method to retrieve just those user accounts whose usernames start with the letter specified by the `CommandName` of the filtered LinkButton that was clicked.</span></span>

<span data-ttu-id="82c7a-198">まず、`UsernameToMatch`という名前のプロパティが含まれるように、`ManageUser.aspx` ページの分離コードクラスを更新します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-198">Start by updating the `ManageUser.aspx` page's code-behind class so that it includes a property named `UsernameToMatch`.</span></span> <span data-ttu-id="82c7a-199">このプロパティは、ポストバック間でユーザー名フィルター文字列を永続化します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-199">This property persists the username filter string across postbacks:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample8.cs)]

<span data-ttu-id="82c7a-200">`UsernameToMatch` プロパティは、キー UsernameToMatch を使用して、`ViewState` コレクションに割り当てられている値を格納します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-200">The `UsernameToMatch` property stores its value it is assigned into the `ViewState` collection using the key UsernameToMatch.</span></span> <span data-ttu-id="82c7a-201">このプロパティの値が読み込まれると、`ViewState` コレクションに値が存在するかどうかが確認されます。そうでない場合は、既定値である空の文字列が返されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-201">When this property's value is read, it checks to see if a value exists in the `ViewState` collection; if not, it returns the default value, an empty string.</span></span> <span data-ttu-id="82c7a-202">`UsernameToMatch` プロパティは、共通のパターンを示しています。つまり、プロパティに対する変更がポストバック間で保持されるように、状態を表示するための値を保持します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-202">The `UsernameToMatch` property exhibits a common pattern, namely persisting a value to view state so that any changes to the property are persisted across postbacks.</span></span> <span data-ttu-id="82c7a-203">このパターンの詳細については、「 [ASP.NET ビューステート](https://msdn.microsoft.com/library/ms972976.aspx)について」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="82c7a-203">For more information on this pattern, read [Understanding ASP.NET View State](https://msdn.microsoft.com/library/ms972976.aspx).</span></span>

<span data-ttu-id="82c7a-204">次に、`BindUserAccounts` メソッドを更新して、`Membership.GetAllUsers`を呼び出すのではなく、`Membership.FindUsersByName`を呼び出し、SQL のワイルドカード文字% で追加された `UsernameToMatch` プロパティの値を渡します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-204">Next, update the `BindUserAccounts` method so that instead of calling `Membership.GetAllUsers`, it calls `Membership.FindUsersByName`, passing in the value of the `UsernameToMatch` property appended with the SQL wildcard character, %.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample9.cs)]

<span data-ttu-id="82c7a-205">ユーザー名が A で始まるユーザーだけを表示するには、`UsernameToMatch` プロパティをに設定し、`BindUserAccounts`を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-205">To display just those users whose username starts with the letter A, set the `UsernameToMatch` property to A and then call `BindUserAccounts`.</span></span> <span data-ttu-id="82c7a-206">この場合、`Membership.FindUsersByName("A%")`が呼び出されます。これにより、ユーザー名がで始まるすべてのユーザーが返されます。同様に、*すべて*のユーザーを返すには、`UsernameToMatch` プロパティに空の文字列を割り当てて、`BindUserAccounts` メソッドが `Membership.FindUsersByName("%")`を呼び出し、その結果、すべてのユーザーアカウントを返すようにします。</span><span class="sxs-lookup"><span data-stu-id="82c7a-206">This would result in a call to `Membership.FindUsersByName("A%")`, which will return all users whose username starts with A. Likewise, to return *all* users, assign an empty string to the `UsernameToMatch` property so that the `BindUserAccounts` method will invoke `Membership.FindUsersByName("%")`, thereby returning all user accounts.</span></span>

<span data-ttu-id="82c7a-207">リピータの `ItemCommand` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-207">Create an event handler for the Repeater's `ItemCommand` event.</span></span> <span data-ttu-id="82c7a-208">このイベントは、フィルターリンクボタンの1つがクリックされたときに発生します。クリックされた LinkButton の `CommandName` 値が `RepeaterCommandEventArgs` オブジェクトを介して渡されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-208">This event is raised whenever one of the filter LinkButtons is clicked; it is passed the clicked LinkButton's `CommandName` value through the `RepeaterCommandEventArgs` object.</span></span> <span data-ttu-id="82c7a-209">`UsernameToMatch` プロパティに適切な値を割り当て、`BindUserAccounts` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-209">We need to assign the appropriate value to the `UsernameToMatch` property and then call the `BindUserAccounts` method.</span></span> <span data-ttu-id="82c7a-210">`CommandName` が All の場合は、すべてのユーザーアカウントが表示されるように、`UsernameToMatch` に空の文字列を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-210">If the `CommandName` is All, assign an empty string to `UsernameToMatch` so that all user accounts are displayed.</span></span> <span data-ttu-id="82c7a-211">それ以外の場合は、`CommandName` 値を `UsernameToMatch`に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-211">Otherwise, assign the `CommandName` value to `UsernameToMatch`.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample10.cs)]

<span data-ttu-id="82c7a-212">このコードを使用して、フィルター処理機能をテストします。</span><span class="sxs-lookup"><span data-stu-id="82c7a-212">With this code in place, test out the filtering functionality.</span></span> <span data-ttu-id="82c7a-213">ページに最初にアクセスしたときに、すべてのユーザーアカウントが表示されます (図5を参照)。</span><span class="sxs-lookup"><span data-stu-id="82c7a-213">When the page is first visited, all user accounts are displayed (refer back to Figure 5).</span></span> <span data-ttu-id="82c7a-214">A LinkButton をクリックすると、ポストバックが発生し、結果がフィルター処理されて、で始まるユーザーアカウントのみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-214">Clicking the A LinkButton causes a postback and filters the results, displaying only those user accounts that start with A .</span></span>

<span data-ttu-id="82c7a-215">[[フィルターリンク] ボタンを使用して、ユーザー名が特定の文字で始まるユーザーを表示 ![](building-an-interface-to-select-one-user-account-from-many-cs/_static/image17.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="82c7a-215">[![Use the Filtering LinkButtons to Display those Users Whose Username Starts with a Certain Letter](building-an-interface-to-select-one-user-account-from-many-cs/_static/image17.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image16.png)</span></span>

<span data-ttu-id="82c7a-216">**図 6**: [フィルターリンク] ボタンを使用して、ユーザー名が特定の文字で始まるユーザーを表示する ([クリックすると、フルサイズの画像が表示](building-an-interface-to-select-one-user-account-from-many-cs/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="82c7a-216">**Figure 6**: Use the Filtering LinkButtons to Display those Users Whose Username Starts with a Certain Letter  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image18.png))</span></span>

## <a name="step-4-updating-the-gridview-to-use-paging"></a><span data-ttu-id="82c7a-217">手順 4: ページングを使用するように GridView を更新する</span><span class="sxs-lookup"><span data-stu-id="82c7a-217">Step 4: Updating the GridView to Use Paging</span></span>

<span data-ttu-id="82c7a-218">図5および6に示されている GridView は、`FindUsersByName` メソッドから返されるすべてのレコードを一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-218">The GridView shown in Figures 5 and 6 lists all of the records returned from the `FindUsersByName` method.</span></span> <span data-ttu-id="82c7a-219">数百または数千のユーザーアカウントがある場合は、すべてのアカウントを表示すると情報が過負荷になる可能性があります (すべての LinkButton をクリックした場合や、最初にページにアクセスしたときに発生した場合のように)。</span><span class="sxs-lookup"><span data-stu-id="82c7a-219">If there are hundreds or thousands of user accounts this can lead to information overload when viewing all of the accounts (as is the case when clicking the All LinkButton or when initially visiting the page).</span></span> <span data-ttu-id="82c7a-220">より管理しやすいチャンクでユーザーアカウントを表示するには、一度に10個のユーザーアカウントを表示するように GridView を構成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="82c7a-220">To help present the user accounts in more manageable chunks, let's configure the GridView to display 10 user accounts at a time.</span></span>

<span data-ttu-id="82c7a-221">GridView コントロールでは、次の2種類のページングが提供されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-221">The GridView control offers two types of paging:</span></span>

- <span data-ttu-id="82c7a-222">**既定のページング**-実装は簡単ですが、非効率的です。</span><span class="sxs-lookup"><span data-stu-id="82c7a-222">**Default paging** - easy to implement, but inefficient.</span></span> <span data-ttu-id="82c7a-223">簡単に言うと、既定のページングでは、GridView はデータソースの*すべて*のレコードを想定しています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-223">In a nutshell, with default paging the GridView expects *all* of the records from its data source.</span></span> <span data-ttu-id="82c7a-224">次に、適切なレコードのページのみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-224">It then only displays the appropriate page of records.</span></span>
- <span data-ttu-id="82c7a-225">**カスタムページング**-実装にはより多くの作業が必要ですが、既定のページングよりも効率的です。これは、カスタムページングでは、表示するレコードの正確なセットのみを返すためです。</span><span class="sxs-lookup"><span data-stu-id="82c7a-225">**Custom paging** - requires more work to implement, but is more efficient than default paging because with custom paging the data source returns only the precise set of records to display.</span></span>

<span data-ttu-id="82c7a-226">既定のページングとカスタムページングのパフォーマンスの違いは、何千ものレコードをページングする場合に非常に大きくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-226">The performance difference between default and custom paging can be quite substantial when paging through thousands of records.</span></span> <span data-ttu-id="82c7a-227">このインターフェイスは、数百または数千のユーザーアカウントがあると仮定して構築されているため、カスタムページングを使用します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-227">Because we are building this interface assuming that there may be hundreds or thousands of user accounts, let's use custom paging.</span></span>

> [!NOTE]
> <span data-ttu-id="82c7a-228">既定のページングとカスタムページングの違い、およびカスタムページングの実装に関連する課題の詳細については、「[大量のデータを効率的にページング](https://asp.net/learn/data-access/tutorial-25-cs.aspx)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="82c7a-228">For a more thorough discussion on the differences between default and custom paging, as well as the challenges involved in implementing custom paging, refer to [Efficiently Paging Through Large Amounts of Data](https://asp.net/learn/data-access/tutorial-25-cs.aspx).</span></span> <span data-ttu-id="82c7a-229">既定のページングとカスタムページングのパフォーマンスの違いの分析については、「 [SQL Server 2005 を使用した ASP.NET のカスタムページング](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="82c7a-229">For some analysis of the performance difference between default and custom paging, see [Custom Paging in ASP.NET with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx).</span></span>

<span data-ttu-id="82c7a-230">カスタムページングを実装するには、まず、GridView によって表示されるレコードの正確なサブセットを取得するためのメカニズムが必要です。</span><span class="sxs-lookup"><span data-stu-id="82c7a-230">To implement custom paging we first need some mechanism by which to retrieve the precise subset of records being displayed by the GridView.</span></span> <span data-ttu-id="82c7a-231">優れたニュースとして、`Membership` クラスの `FindUsersByName` メソッドには、ページインデックスとページサイズを指定できるオーバーロードがあり、その範囲内にあるユーザーアカウントのみが返されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-231">The good news is that the `Membership` class's `FindUsersByName` method has an overload that allows us to specify the page index and page size, and returns only those user accounts that fall within that range of records.</span></span>

<span data-ttu-id="82c7a-232">特に、このオーバーロードには、 [`FindUsersByName(usernameToMatch, pageIndex, pageSize, totalRecords)`](https://msdn.microsoft.com/library/fa5st8b2.aspx)というシグネチャがあります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-232">In particular, this overload has the following signature: [`FindUsersByName(usernameToMatch, pageIndex, pageSize, totalRecords)`](https://msdn.microsoft.com/library/fa5st8b2.aspx).</span></span>

<span data-ttu-id="82c7a-233">*PageIndex*パラメーターは、返されるユーザーアカウントのページを指定します。*pageSize*は、1ページあたりに表示するレコードの数を示します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-233">The *pageIndex* parameter specifies the page of user accounts to return; *pageSize* indicates how many records to display per page.</span></span> <span data-ttu-id="82c7a-234">*Totalrecords*パラメーターは、ユーザーストア内のユーザーアカウントの合計数を返す `out` パラメーターです。</span><span class="sxs-lookup"><span data-stu-id="82c7a-234">The *totalRecords* parameter is an `out` parameter that returns the number of total user accounts in the user store.</span></span>

> [!NOTE]
> <span data-ttu-id="82c7a-235">`FindUsersByName` によって返されるデータはユーザー名で並べ替えられます。並べ替え条件をカスタマイズすることはできません。</span><span class="sxs-lookup"><span data-stu-id="82c7a-235">The data returned by `FindUsersByName` is sorted by username; the sort criteria cannot be customized.</span></span>

<span data-ttu-id="82c7a-236">GridView は、ObjectDataSource コントロールにバインドされている場合にのみ、カスタムページングを使用するように構成できます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-236">The GridView can be configured to utilize custom paging, but only when bound to an ObjectDataSource control.</span></span> <span data-ttu-id="82c7a-237">ObjectDataSource コントロールでカスタムページングを実装するには、開始行インデックスと表示するレコードの最大数を渡す2つの方法が必要です。また、そのスパン内に含まれるレコードの詳細なサブセットを返します。およびは、ページングされているレコードの合計数を返すメソッドです。</span><span class="sxs-lookup"><span data-stu-id="82c7a-237">For the ObjectDataSource control to implement custom paging, it requires two methods: one that is passed a start row index and the maximum number of records to display, and returns the precise subset of records that fall within that span; and a method that returns the total number of records being paged through.</span></span> <span data-ttu-id="82c7a-238">`FindUsersByName` のオーバーロードは、ページインデックスとページサイズを受け入れ、`out` パラメーターを使用してレコードの合計数を返します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-238">The `FindUsersByName` overload accepts a page index and page size, and returns the total number of records through an `out` parameter.</span></span> <span data-ttu-id="82c7a-239">ここでは、インターフェイスが一致していません。</span><span class="sxs-lookup"><span data-stu-id="82c7a-239">So there is an interface mismatch here.</span></span>

<span data-ttu-id="82c7a-240">1つの方法として、ObjectDataSource が想定しているインターフェイスを公開するプロキシクラスを作成し、`FindUsersByName` メソッドを内部的に呼び出します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-240">One option would be to create a proxy class that exposes the interface the ObjectDataSource expects, and then internally calls the `FindUsersByName` method.</span></span> <span data-ttu-id="82c7a-241">この記事で使用するもう1つの方法として、独自のページングインターフェイスを作成し、GridView の組み込みページングインターフェイスではなくそれを使用する方法があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-241">Another option - and the one we'll use for this article - is to create our own paging interface and use that instead of the GridView's built-in paging interface.</span></span>

### <a name="creating-a-first-previous-next-last-paging-interface"></a><span data-ttu-id="82c7a-242">最初、前、次、最後のページングインターフェイスを作成する</span><span class="sxs-lookup"><span data-stu-id="82c7a-242">Creating a First, Previous, Next, Last Paging Interface</span></span>

<span data-ttu-id="82c7a-243">最初、前、次のリンクボタンと最後のリンクボタンを使用して、ページングインターフェイスを作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="82c7a-243">Let's build a paging interface with First, Previous, Next, and Last LinkButtons.</span></span> <span data-ttu-id="82c7a-244">最初の LinkButton がクリックされると、ユーザーはデータの最初のページに移動しますが、Previous は前のページに戻ります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-244">The First LinkButton, when clicked, will take the user to the first page of data, whereas Previous will return him to the previous page.</span></span> <span data-ttu-id="82c7a-245">同様に、[次へ] と [最後] では、ユーザーをそれぞれ次のページと最後のページに移動します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-245">Likewise, Next and Last will move the user to the next and last page, respectively.</span></span> <span data-ttu-id="82c7a-246">`UserAccounts` GridView の下に4つの LinkButton コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-246">Add the four LinkButton controls beneath the `UserAccounts` GridView.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample11.aspx)]

<span data-ttu-id="82c7a-247">次に、LinkButton の `Click` イベントごとにイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-247">Next, create an event handler for each of the LinkButton's `Click` events.</span></span>

<span data-ttu-id="82c7a-248">図7は、Visual Web Developer デザインビューを通じて表示する場合の4つの LinkButtons を示しています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-248">Figure 7 shows the four LinkButtons when viewed through the Visual Web Developer Design view.</span></span>

<span data-ttu-id="82c7a-249">[GridView の下に First、Previous、Next、および Last LinkButtons を追加 ![には](building-an-interface-to-select-one-user-account-from-many-cs/_static/image20.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="82c7a-249">[![Add First, Previous, Next, and Last LinkButtons Beneath the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image20.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image19.png)</span></span>

<span data-ttu-id="82c7a-250">**図 7**: GridView の下に First、Previous、Next、および Last linkbuttons を追加[する (クリックすると、フルサイズのイメージが表示](building-an-interface-to-select-one-user-account-from-many-cs/_static/image21.png)されます)</span><span class="sxs-lookup"><span data-stu-id="82c7a-250">**Figure 7**: Add First, Previous, Next, and Last LinkButtons Beneath the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image21.png))</span></span>

### <a name="keeping-track-of-the-current-page-index"></a><span data-ttu-id="82c7a-251">現在のページインデックスを追跡する</span><span class="sxs-lookup"><span data-stu-id="82c7a-251">Keeping Track of the Current Page Index</span></span>

<span data-ttu-id="82c7a-252">ユーザーが最初に [`ManageUsers.aspx`] ページにアクセスしたとき、またはいずれかのフィルターボタンをクリックしたときに、GridView に最初のデータページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-252">When a user first visits the `ManageUsers.aspx` page or clicks one of the filtering buttons, we want to display the first page of data in the GridView.</span></span> <span data-ttu-id="82c7a-253">ただし、ユーザーがナビゲーションリンクボタンのいずれかをクリックしたときに、ページインデックスを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-253">When the user clicks one of the navigation LinkButtons, however, we need to update the page index.</span></span> <span data-ttu-id="82c7a-254">ページインデックスとページごとに表示するレコード数を維持するには、次の2つのプロパティをページの分離コードクラスに追加します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-254">To maintain the page index and the number of records to display per page, add the following two properties to the page's code-behind class:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample12.cs)]

<span data-ttu-id="82c7a-255">`UsernameToMatch` プロパティと同様に、`PageIndex` プロパティはその値をビューステートに永続化します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-255">Like the `UsernameToMatch` property, the `PageIndex` property persists its value to view state.</span></span> <span data-ttu-id="82c7a-256">読み取り専用の `PageSize` プロパティは、ハードコーディングされた値10を返します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-256">The read-only `PageSize` property returns a hard-coded value, 10.</span></span> <span data-ttu-id="82c7a-257">このプロパティを更新して `PageIndex`と同じパターンを使用するように、関心のある読者を招待します。次に、ページにアクセスするユーザーがページごとに表示するユーザーアカウントの数を指定できるように `ManageUsers.aspx` ページを拡張します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-257">I invite the interested reader to update this property to use the same pattern as `PageIndex`, and then to augment the `ManageUsers.aspx` page such that the person visiting the page can specify how many user accounts to display per page.</span></span>

### <a name="retrieving-just-the-current-pages-records-updating-the-page-index-and-enabling-and-disabling-the-paging-interface-linkbuttons"></a><span data-ttu-id="82c7a-258">現在のページのレコードだけを取得し、ページインデックスを更新し、ページングインターフェイスリンクボタンを有効または無効にします。</span><span class="sxs-lookup"><span data-stu-id="82c7a-258">Retrieving Just the Current Page's Records, Updating the Page Index, and Enabling and Disabling the Paging Interface LinkButtons</span></span>

<span data-ttu-id="82c7a-259">ページングインターフェイスが配置され、`PageIndex` と `PageSize` のプロパティが追加されたので、適切な `FindUsersByName` オーバーロードを使用するように `BindUserAccounts` メソッドを更新する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="82c7a-259">With the paging interface in place and the `PageIndex` and `PageSize` properties added, we are ready to update the `BindUserAccounts` method so that it uses the appropriate `FindUsersByName` overload.</span></span> <span data-ttu-id="82c7a-260">また、表示されるページに応じて、このメソッドでページングインターフェイスを有効または無効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-260">Additionally, we need to have this method enable or disable the paging interface depending on what page is being displayed.</span></span> <span data-ttu-id="82c7a-261">データの最初のページを表示する場合は、最初のリンクと前のリンクを無効にする必要があります。最後のページを表示する場合は、[次へ] と [最後] を無効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-261">When viewing the first page of data, the First and Previous links should be disabled; Next and Last should be disabled when viewing the last page.</span></span>

<span data-ttu-id="82c7a-262">`BindUserAccounts` メソッドを次のコードで更新します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-262">Update the `BindUserAccounts` method with the following code:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample13.cs)]

<span data-ttu-id="82c7a-263">ページングされるレコードの合計数は、`FindUsersByName` メソッドの最後のパラメーターによって決定されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="82c7a-263">Note that the total number of records being paged through is determined by the last parameter of the `FindUsersByName` method.</span></span> <span data-ttu-id="82c7a-264">これは `out` パラメーターであるため、まずこの値 (`totalRecords`) を保持する変数を宣言し、次に `out` キーワードでプレフィックスを付ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-264">This is an `out` parameter, so we need to first declare a variable to hold this value (`totalRecords`) and then prefix it with the `out` keyword.</span></span>

<span data-ttu-id="82c7a-265">指定されたページのユーザーアカウントが返された後、データの最初のページまたは最後のページが表示されているかどうかに応じて、4つのリンクボタンが有効または無効になります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-265">After the specified page of user accounts are returned, the four LinkButtons are either enabled or disabled, depending on whether the first or last page of data is being viewed.</span></span>

<span data-ttu-id="82c7a-266">最後の手順では、4つの LinkButtons `Click` イベントハンドラーのコードを記述します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-266">The last step is to write the code for the four LinkButtons' `Click` event handlers.</span></span> <span data-ttu-id="82c7a-267">これらのイベントハンドラーは、`PageIndex` プロパティを更新し、`BindUserAccounts`の呼び出しを使用してデータを GridView に再バインドする必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-267">These event handlers need to update the `PageIndex` property and then rebind the data to the GridView via a call to `BindUserAccounts`.</span></span> <span data-ttu-id="82c7a-268">1つ目、前のイベント、および次のイベントハンドラーは非常に単純です。</span><span class="sxs-lookup"><span data-stu-id="82c7a-268">The First, Previous, and Next event handlers are very simple.</span></span> <span data-ttu-id="82c7a-269">ただし、最後の LinkButton の `Click` イベントハンドラーは少し複雑になります。これは、最後のページインデックスを判別するために、表示されているレコードの数を確認する必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="82c7a-269">The `Click` event handler for the Last LinkButton, however, is a bit more complex because we need to determine how many records are being displayed in order to determine the last page index.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample14.cs)]

<span data-ttu-id="82c7a-270">図8と9は、カスタムページングインターフェイスが動作していることを示しています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-270">Figures 8 and 9 show the custom paging interface in action.</span></span> <span data-ttu-id="82c7a-271">図8は、すべてのユーザーアカウントの最初のデータページを表示するときの `ManageUsers.aspx` ページを示しています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-271">Figure 8 shows the `ManageUsers.aspx` page when viewing the first page of data for all user accounts.</span></span> <span data-ttu-id="82c7a-272">表示されるのは、13個のアカウントのうち10個だけであることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="82c7a-272">Note that only 10 of the 13 accounts are displayed.</span></span> <span data-ttu-id="82c7a-273">次のリンクまたは最後のリンクをクリックすると、ポストバックが発生し、`PageIndex` が1に更新され、ユーザーアカウントの2番目のページがグリッドにバインドされます (図9を参照)。</span><span class="sxs-lookup"><span data-stu-id="82c7a-273">Clicking the Next or Last link causes a postback, updates the `PageIndex` to 1, and binds the second page of user accounts to the grid (see Figure 9).</span></span>

<span data-ttu-id="82c7a-274">[最初の10個のユーザーアカウントが表示される ![](building-an-interface-to-select-one-user-account-from-many-cs/_static/image23.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="82c7a-274">[![The First 10 User Accounts are Displayed](building-an-interface-to-select-one-user-account-from-many-cs/_static/image23.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image22.png)</span></span>

<span data-ttu-id="82c7a-275">**図 8**: 最初の10個のユーザーアカウントが表示される ([クリックすると、フルサイズの画像が表示](building-an-interface-to-select-one-user-account-from-many-cs/_static/image24.png)されます)</span><span class="sxs-lookup"><span data-stu-id="82c7a-275">**Figure 8**: The First 10 User Accounts are Displayed  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image24.png))</span></span>

<span data-ttu-id="82c7a-276">[次のリンクをクリック ![と、ユーザーアカウントの2ページ目が表示されます。](building-an-interface-to-select-one-user-account-from-many-cs/_static/image26.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="82c7a-276">[![Clicking the Next Link Displays the Second Page of User Accounts](building-an-interface-to-select-one-user-account-from-many-cs/_static/image26.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image25.png)</span></span>

<span data-ttu-id="82c7a-277">**図 9**: 次のリンクをクリックすると、ユーザーアカウントの2ページ目が表示されます ([クリックすると、フルサイズの画像が表示](building-an-interface-to-select-one-user-account-from-many-cs/_static/image27.png)されます)</span><span class="sxs-lookup"><span data-stu-id="82c7a-277">**Figure 9**: Clicking the Next Link Displays the Second Page of User Accounts  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image27.png))</span></span>

## <a name="summary"></a><span data-ttu-id="82c7a-278">まとめ</span><span class="sxs-lookup"><span data-stu-id="82c7a-278">Summary</span></span>

<span data-ttu-id="82c7a-279">管理者は、多くの場合、アカウントの一覧からユーザーを選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82c7a-279">Administrators often need to select a user from the list of accounts.</span></span> <span data-ttu-id="82c7a-280">前のチュートリアルでは、ユーザーに設定されたドロップダウンリストの使用について説明しましたが、この方法はうまくいきません。</span><span class="sxs-lookup"><span data-stu-id="82c7a-280">In previous tutorials we looked at using a drop-down list populated with the users, but this approach does not scale well.</span></span> <span data-ttu-id="82c7a-281">このチュートリアルでは、結果がページングされた GridView に表示されるフィルター可能なインターフェイスである、より優れた代替方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-281">In this tutorial we explored a better alternative: a filterable interface whose results are displayed in a paged GridView.</span></span> <span data-ttu-id="82c7a-282">このユーザーインターフェイスを使用すると、管理者は数千単位で1つのユーザーアカウントをすばやく効率的に検索して選択できます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-282">With this user interface, administrators can quickly and efficiently locate and select one user account among thousands.</span></span>

<span data-ttu-id="82c7a-283">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="82c7a-283">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="82c7a-284">参考資料</span><span class="sxs-lookup"><span data-stu-id="82c7a-284">Further Reading</span></span>

<span data-ttu-id="82c7a-285">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="82c7a-285">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="82c7a-286">SQL Server 2005 を使用した ASP.NET のカスタムページング</span><span class="sxs-lookup"><span data-stu-id="82c7a-286">Custom Paging in ASP.NET with SQL Server 2005</span></span>](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx)
- [<span data-ttu-id="82c7a-287">大量のデータを効率的にページングする</span><span class="sxs-lookup"><span data-stu-id="82c7a-287">Efficiently Paging Through Large Amounts of Data</span></span>](https://asp.net/learn/data-access/tutorial-25-cs.aspx)
- [<span data-ttu-id="82c7a-288">独自の Web サイト管理ツールのロール</span><span class="sxs-lookup"><span data-stu-id="82c7a-288">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="82c7a-289">著者について</span><span class="sxs-lookup"><span data-stu-id="82c7a-289">About the Author</span></span>

<span data-ttu-id="82c7a-290">1998以降、Microsoft の Web テクノロジを使用して、Scott Mitchell (複数の ASP/創設者4GuysFromRolla.com の執筆者) が Microsoft の Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-290">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="82c7a-291">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-291">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="82c7a-292">彼の最新の書籍は *[、ASP.NET 2.0 を24時間以内に教え](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* ています。</span><span class="sxs-lookup"><span data-stu-id="82c7a-292">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="82c7a-293">Scott は、 [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com)またはブログで[http://ScottOnWriting.NET](http://scottonwriting.net/)にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="82c7a-293">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="82c7a-294">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="82c7a-294">Special Thanks To</span></span>

<span data-ttu-id="82c7a-295">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="82c7a-295">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="82c7a-296">このチュートリアルのリードレビューアーは Alicja Maziarz でした。</span><span class="sxs-lookup"><span data-stu-id="82c7a-296">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="82c7a-297">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="82c7a-297">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="82c7a-298">その場合は、 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)の行を削除します。</span><span class="sxs-lookup"><span data-stu-id="82c7a-298">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="82c7a-299">Next</span><span class="sxs-lookup"><span data-stu-id="82c7a-299">Next</span></span>](recovering-and-changing-passwords-cs.md)
