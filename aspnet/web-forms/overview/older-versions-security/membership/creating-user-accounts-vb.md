---
uid: web-forms/overview/older-versions-security/membership/creating-user-accounts-vb
title: ユーザーアカウントを作成する (VB) |Microsoft Docs
author: rick-anderson
description: このチュートリアルでは、(SqlMembershipProvider を使用して) メンバーシップフレームワークを使用して新しいユーザーアカウントを作成する方法について説明します。 新しいお客様を作成する方法については、
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 9ef3e893-bebe-4b13-9fe5-8b71720dd85e
msc.legacyurl: /web-forms/overview/older-versions-security/membership/creating-user-accounts-vb
msc.type: authoredcontent
ms.openlocfilehash: 01be198c329f372ddcd529ad8a369f2d3426a9fc
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74628460"
---
# <a name="creating-user-accounts-vb"></a><span data-ttu-id="66858-104">ユーザー アカウントを作成する (VB)</span><span class="sxs-lookup"><span data-stu-id="66858-104">Creating User Accounts (VB)</span></span>

<span data-ttu-id="66858-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="66858-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="66858-106">[コードのダウンロード](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_05_VB.zip)または[PDF のダウンロード](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial05_CreatingUsers_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="66858-106">[Download Code](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_05_VB.zip) or [Download PDF](https://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial05_CreatingUsers_vb.pdf)</span></span>

> <span data-ttu-id="66858-107">このチュートリアルでは、(SqlMembershipProvider を使用して) メンバーシップフレームワークを使用して新しいユーザーアカウントを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="66858-107">In this tutorial we will explore using the Membership framework (via the SqlMembershipProvider) to create new user accounts.</span></span> <span data-ttu-id="66858-108">プログラムおよび ASP を使用して、新しいユーザーを作成する方法について説明します。NET の組み込みの CreateUserWizard コントロール。</span><span class="sxs-lookup"><span data-stu-id="66858-108">We will see how to create new users programmatically and through ASP.NET's built-in CreateUserWizard control.</span></span>

## <a name="introduction"></a><span data-ttu-id="66858-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="66858-109">Introduction</span></span>

<span data-ttu-id="66858-110">前の<a id="_msoanchor_1"> </a>[チュートリアル](creating-the-membership-schema-in-sql-server-vb.md)では、データベースにアプリケーションサービススキーマをインストールしました。これにより、`SqlMembershipProvider` と `SqlRoleProvider`に必要なテーブル、ビュー、およびストアドプロシージャが追加されました。</span><span class="sxs-lookup"><span data-stu-id="66858-110">In the <a id="_msoanchor_1"></a>[preceding tutorial](creating-the-membership-schema-in-sql-server-vb.md) we installed the application services schema in a database, which added the tables, views, and stored procedures needed by the `SqlMembershipProvider` and `SqlRoleProvider`.</span></span> <span data-ttu-id="66858-111">これにより、このシリーズのチュートリアルの残りの部分に必要なインフラストラクチャが作成されました。</span><span class="sxs-lookup"><span data-stu-id="66858-111">This created the infrastructure we will need for the remainder of the tutorials in this series.</span></span> <span data-ttu-id="66858-112">このチュートリアルでは、(`SqlMembershipProvider`を使用して) メンバーシップフレームワークを使用して新しいユーザーアカウントを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="66858-112">In this tutorial we will explore using the Membership framework (via the `SqlMembershipProvider`) to create new user accounts.</span></span> <span data-ttu-id="66858-113">プログラムおよび ASP を使用して、新しいユーザーを作成する方法について説明します。NET の組み込みの CreateUserWizard コントロール。</span><span class="sxs-lookup"><span data-stu-id="66858-113">We will see how to create new users programmatically and through ASP.NET's built-in CreateUserWizard control.</span></span>

<span data-ttu-id="66858-114">新しいユーザーアカウントを作成する方法を学習するだけでなく、フォーム認証 *<a id="_msoanchor_2"></a>[の概要](../introduction/an-overview-of-forms-authentication-vb.md)* に関するチュートリアルで最初に作成したデモ web サイトを更新し、 *<a id="_msoanchor_3"></a>[フォーム認証の構成と高度なトピック](../introduction/forms-authentication-configuration-and-advanced-topics-vb.md)* のチュートリアルで強化する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="66858-114">In addition to learning how to create new user accounts, we will also need to update the demo website we first created in the *<a id="_msoanchor_2"></a>[An Overview of Forms Authentication](../introduction/an-overview-of-forms-authentication-vb.md)* tutorial and then enhanced in the *<a id="_msoanchor_3"></a>[Forms Authentication Configuration and Advanced Topics](../introduction/forms-authentication-configuration-and-advanced-topics-vb.md)* tutorial.</span></span> <span data-ttu-id="66858-115">デモ web アプリケーションには、ハードコーディングされたユーザー名とパスワードのペアに対してユーザーの資格情報を検証するログインページがあります。</span><span class="sxs-lookup"><span data-stu-id="66858-115">Our demo web application has a login page that validates users' credentials against hard-coded username/password pairs.</span></span> <span data-ttu-id="66858-116">さらに、`Global.asax` には、認証されたユーザーのカスタム `IPrincipal` と `IIdentity` オブジェクトを作成するコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="66858-116">Moreover, `Global.asax` includes code that creates custom `IPrincipal` and `IIdentity` objects for authenticated users.</span></span> <span data-ttu-id="66858-117">ログインページを更新して、メンバーシップフレームワークに対してユーザーの資格情報を検証し、カスタムプリンシパルと id ロジックを削除します。</span><span class="sxs-lookup"><span data-stu-id="66858-117">We will update the login page to validate users' credentials against the Membership framework and remove the custom principal and identity logic.</span></span>

<span data-ttu-id="66858-118">では、始めましょう。</span><span class="sxs-lookup"><span data-stu-id="66858-118">Let's get started!</span></span>

## <a name="the-forms-authentication-and-membership-checklist"></a><span data-ttu-id="66858-119">フォーム認証とメンバーシップのチェックリスト</span><span class="sxs-lookup"><span data-stu-id="66858-119">The Forms Authentication and Membership Checklist</span></span>

<span data-ttu-id="66858-120">メンバーシップフレームワークの使用を開始する前に、この時点までに実行した重要な手順を確認してみましょう。</span><span class="sxs-lookup"><span data-stu-id="66858-120">Before we begin working with the Membership framework, let's take a moment to review the important steps we have taken to reach this point.</span></span> <span data-ttu-id="66858-121">フォームベースの認証シナリオでメンバーシップフレームワークを `SqlMembershipProvider` と共に使用する場合、web アプリケーションにメンバーシップ機能を実装する前に、次の手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-121">When using the Membership framework with the `SqlMembershipProvider` in a forms-based authentication scenario, the following steps need to be performed prior to implementing Membership functionality in your web application:</span></span>

1. <span data-ttu-id="66858-122">**フォームベースの認証を有効にします。**</span><span class="sxs-lookup"><span data-stu-id="66858-122">**Enable forms-based authentication.**</span></span> <span data-ttu-id="66858-123">*<a id="_msoanchor_4"></a>[フォーム認証の概要](../introduction/an-overview-of-forms-authentication-vb.md)* で説明したように、フォーム認証を有効にするには、`Web.config` を編集し、`<authentication>` 要素の `mode` 属性を `Forms`に設定します。</span><span class="sxs-lookup"><span data-stu-id="66858-123">As we discussed in *<a id="_msoanchor_4"></a>[An Overview of Forms Authentication](../introduction/an-overview-of-forms-authentication-vb.md)*, forms authentication is enabled by editing `Web.config` and setting the `<authentication>` element's `mode` attribute to `Forms`.</span></span> <span data-ttu-id="66858-124">フォーム認証を有効にすると、受信した各要求が*フォーム認証チケット*(存在する場合) について確認され、要求元が識別されます。</span><span class="sxs-lookup"><span data-stu-id="66858-124">With forms authentication enabled, each incoming request is examined for a *forms authentication ticket*, which, if present, identifies the requestor.</span></span>
2. <span data-ttu-id="66858-125">**アプリケーションサービススキーマを適切なデータベースに追加します。**</span><span class="sxs-lookup"><span data-stu-id="66858-125">**Add the application services schema to the appropriate database.**</span></span> <span data-ttu-id="66858-126">`SqlMembershipProvider` を使用する場合は、アプリケーションサービススキーマをデータベースにインストールする必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-126">When using the `SqlMembershipProvider` we need to install the application services schema to a database.</span></span> <span data-ttu-id="66858-127">通常、このスキーマは、アプリケーションのデータモデルを保持する同じデータベースに追加されます。</span><span class="sxs-lookup"><span data-stu-id="66858-127">Usually this schema is added to the same database that holds the application's data model.</span></span> <span data-ttu-id="66858-128">*<a id="_msoanchor_5"></a>[SQL Server チュートリアルでメンバーシップスキーマを作成](creating-the-membership-schema-in-sql-server-vb.md)* する方法については、「`aspnet_regsql.exe` ツールを使用してこれを実現する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="66858-128">The *<a id="_msoanchor_5"></a>[Creating the Membership Schema in SQL Server](creating-the-membership-schema-in-sql-server-vb.md)* tutorial looked at using the `aspnet_regsql.exe` tool to accomplish this.</span></span>
3. <span data-ttu-id="66858-129">**手順 2. のデータベースを参照するように Web アプリケーションの設定をカスタマイズします。**</span><span class="sxs-lookup"><span data-stu-id="66858-129">**Customize the Web Application's Settings to reference the database from step 2.**</span></span> <span data-ttu-id="66858-130">*SQL Server チュートリアルでメンバーシップスキーマを作成*するには、「手順 2: `LocalSqlServer` 接続文字列名を変更することによって、`SqlMembershipProvider` が選択したデータベースを使用するように web アプリケーションを構成する2つの方法を説明しました。または、新しい登録済みプロバイダーをメンバーシップフレームワークプロバイダーの一覧に追加し、手順2で作成したデータベースを使用するように新しいプロバイダーをカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="66858-130">The *Creating the Membership Schema in SQL Server* tutorial showed two ways to configure the web application so that the `SqlMembershipProvider` would use the database selected in step 2: by modifying the `LocalSqlServer` connection string name; or by adding a new registered provider to the list of Membership framework providers and customizing that new provider to use the database from step 2.</span></span>

<span data-ttu-id="66858-131">`SqlMembershipProvider` とフォームベースの認証を使用する web アプリケーションを構築する場合は、`Membership` クラスまたは ASP.NET Login Web コントロールを使用する前に、次の3つの手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-131">When building a web application that uses the `SqlMembershipProvider` and forms-based authentication, you will need to perform these three steps before using the `Membership` class or the ASP.NET Login Web controls.</span></span> <span data-ttu-id="66858-132">前のチュートリアルでこれらの手順を既に実行していたため、メンバーシップフレームワークの使用を開始する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="66858-132">Since we already performed these steps in previous tutorials, we are ready to start using the Membership framework!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="66858-133">手順 1:新しい ASP.NET ページの追加</span><span class="sxs-lookup"><span data-stu-id="66858-133">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="66858-134">このチュートリアルと次の3つでは、メンバーシップに関連するさまざまな関数と機能について説明します。</span><span class="sxs-lookup"><span data-stu-id="66858-134">In this tutorial and the next three we will be examining various Membership-related functions and capabilities.</span></span> <span data-ttu-id="66858-135">これらのチュートリアル全体で検討したトピックを実装するには、一連の ASP.NET ページが必要です。</span><span class="sxs-lookup"><span data-stu-id="66858-135">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="66858-136">これらのページを作成し、サイトマップファイル `(Web.sitemap)`を作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="66858-136">Let's create those pages and then a site map file `(Web.sitemap)`.</span></span>

<span data-ttu-id="66858-137">まず、`Membership`という名前のプロジェクトに新しいフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="66858-137">Start by creating a new folder in the project named `Membership`.</span></span> <span data-ttu-id="66858-138">次に、5つの新しい ASP.NET ページを `Membership` フォルダーに追加し、各ページを `Site.master` マスターページとリンクします。</span><span class="sxs-lookup"><span data-stu-id="66858-138">Next, add five new ASP.NET pages to the `Membership` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="66858-139">ページに名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="66858-139">Name the pages:</span></span>

- `CreatingUserAccounts.aspx`
- `UserBasedAuthorization.aspx`
- `EnhancedCreateUserWizard.aspx`
- `AdditionalUserInfo.aspx`
- `Guestbook.aspx`

<span data-ttu-id="66858-140">この時点で、プロジェクトのソリューションエクスプローラーは、図1に示すスクリーンショットのようになります。</span><span class="sxs-lookup"><span data-stu-id="66858-140">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>

<span data-ttu-id="66858-141">[![5 つの新しいページがメンバーシップフォルダーに追加されました](creating-user-accounts-vb/_static/image2.png)](creating-user-accounts-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="66858-141">[![Five New Pages Have Been Added to the Membership Folder](creating-user-accounts-vb/_static/image2.png)](creating-user-accounts-vb/_static/image1.png)</span></span>

<span data-ttu-id="66858-142">**図 1**:`Membership` フォルダーに新しいページが5つ追加されました ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-142">**Figure 1**: Five New Pages Have Been Added to the `Membership` Folder ([Click to view full-size image](creating-user-accounts-vb/_static/image3.png))</span></span>

<span data-ttu-id="66858-143">各ページには、この時点で2つのコンテンツコントロールが含まれている必要があります。1つは、`MainContent` と `LoginContent`の各マスターページの ContentPlaceHolders です。</span><span class="sxs-lookup"><span data-stu-id="66858-143">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-user-accounts-vb/samples/sample1.aspx)]

<span data-ttu-id="66858-144">`LoginContent` ContentPlaceHolder の既定のマークアップによって、ユーザーが認証されているかどうかに応じて、サイトへのログオンまたはログオフを行うためのリンクが表示されることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="66858-144">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="66858-145">ただし、`Content2` コンテンツコントロールの存在は、マスターページの既定のマークアップよりも優先されます。</span><span class="sxs-lookup"><span data-stu-id="66858-145">The presence of the `Content2` Content control, however, overrides the master page's default markup.</span></span> <span data-ttu-id="66858-146">*<a id="_msoanchor_6"></a>[「フォーム認証チュートリアルの概要](../introduction/an-overview-of-forms-authentication-vb.md)* 」で説明したように、これは、左の列にログイン関連のオプションを表示しないページで役立ちます。</span><span class="sxs-lookup"><span data-stu-id="66858-146">As we discussed in *<a id="_msoanchor_6"></a>[An Overview of Forms Authentication](../introduction/an-overview-of-forms-authentication-vb.md)* tutorial, this is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="66858-147">ただし、この5つのページでは、`LoginContent` ContentPlaceHolder のマスターページの既定のマークアップを表示します。</span><span class="sxs-lookup"><span data-stu-id="66858-147">For these five pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="66858-148">そのため、`Content2` コンテンツコントロールの宣言型マークアップを削除します。</span><span class="sxs-lookup"><span data-stu-id="66858-148">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="66858-149">その後、5ページの各マークアップには、コンテンツコントロールを1つだけ含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-149">After doing so, each of the five page's markup should contain just one Content control.</span></span>

## <a name="step-2-creating-the-site-map"></a><span data-ttu-id="66858-150">手順 2:サイトマップの作成</span><span class="sxs-lookup"><span data-stu-id="66858-150">Step 2: Creating the Site Map</span></span>

<span data-ttu-id="66858-151">最も単純な web サイト以外はすべて、何らかの形のナビゲーションユーザーインターフェイスを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-151">All but the most trivial websites need to implement some form of a navigational user interface.</span></span> <span data-ttu-id="66858-152">ナビゲーションユーザーインターフェイスは、サイトのさまざまなセクションへのリンクの単純なリストである場合があります。</span><span class="sxs-lookup"><span data-stu-id="66858-152">The navigation user interface may be a simple list of links to the various sections of the site.</span></span> <span data-ttu-id="66858-153">または、これらのリンクをメニューまたはツリービューに配置することもできます。</span><span class="sxs-lookup"><span data-stu-id="66858-153">Alternatively, these links may be arranged into menus or tree views.</span></span> <span data-ttu-id="66858-154">ページ開発者として、ナビゲーションユーザーインターフェイスを作成するのは、そのストーリーの半分にすぎません。</span><span class="sxs-lookup"><span data-stu-id="66858-154">As page developers, creating the navigational user interface is only half of the story.</span></span> <span data-ttu-id="66858-155">また、保守しやすく更新可能な方法でサイトの論理構造を定義するためにもいくつかの手段が必要です。</span><span class="sxs-lookup"><span data-stu-id="66858-155">We also need some means to define the site's logical structure in a maintainable and updateable fashion.</span></span> <span data-ttu-id="66858-156">新しいページを追加したり、既存のページを削除したりすると、1つのソース (サイトマップ) を更新して、サイトのナビゲーションユーザーインターフェイス全体にその変更を反映させることができます。</span><span class="sxs-lookup"><span data-stu-id="66858-156">As new pages are added or existing pages removed, we want to be able to update a single source - the site map - and have those modifications reflected across the site's navigational user interface.</span></span>

<span data-ttu-id="66858-157">サイトマップの定義とサイトマップに基づくナビゲーションユーザーインターフェイスの実装という2つのタスクは、サイトマップフレームワークや、ASP.NET バージョン2.0 で追加されたナビゲーション Web コントロールによって簡単に実現できます。</span><span class="sxs-lookup"><span data-stu-id="66858-157">These two tasks - defining the site map and implementing a navigational user interface based on the site map - are easy to accomplish thanks to the Site Map framework and the Navigation Web controls added in ASP.NET version 2.0.</span></span> <span data-ttu-id="66858-158">サイトマップフレームワークを使用すると、開発者はサイトマップを定義してから、プログラム API ( [`SiteMap` クラス](https://msdn.microsoft.com/library/system.web.sitemap.aspx)) を使用してアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="66858-158">The Site Map framework allows for a developer to define a site map and then to access it through a programmatic API (the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx)).</span></span> <span data-ttu-id="66858-159">組み込みのナビゲーション Web コントロールには、[メニューコントロール](https://msdn.microsoft.com/library/bz09dy46.aspx)、 [TreeView コントロール](https://msdn.microsoft.com/library/3eafky27.aspx)、および[SiteMapPath コントロール](https://msdn.microsoft.com/library/3eafky27.aspx)が含まれています。</span><span class="sxs-lookup"><span data-stu-id="66858-159">The built-in Navigation Web controls include a [Menu control](https://msdn.microsoft.com/library/bz09dy46.aspx), the [TreeView control](https://msdn.microsoft.com/library/3eafky27.aspx), and the [SiteMapPath control](https://msdn.microsoft.com/library/3eafky27.aspx).</span></span>

<span data-ttu-id="66858-160">メンバーシップとロールのフレームワークと同様に、サイトマップフレームワークは[プロバイダーモデル](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)の上に構築されています。</span><span class="sxs-lookup"><span data-stu-id="66858-160">Like the Membership and Roles frameworks, the Site Map framework is built atop the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx).</span></span> <span data-ttu-id="66858-161">サイトマッププロバイダークラスのジョブでは、XML ファイルやデータベーステーブルなどの永続データストアから `SiteMap` クラスによって使用されるメモリ内の構造を生成します。</span><span class="sxs-lookup"><span data-stu-id="66858-161">The job of the Site Map provider class is to generate the in-memory structure used by the `SiteMap` class from a persistent data store, such as an XML file or a database table.</span></span> <span data-ttu-id="66858-162">.NET Framework には、XML ファイル ([`XmlSiteMapProvider`](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx)) からサイトマップデータを読み取る既定のサイトマッププロバイダーが付属しています。これは、このチュートリアルで使用するプロバイダーです。</span><span class="sxs-lookup"><span data-stu-id="66858-162">The .NET Framework ships with a default Site Map provider that reads the site map data from an XML file ([`XmlSiteMapProvider`](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx)), and this is the provider we will be using in this tutorial.</span></span> <span data-ttu-id="66858-163">代替のサイトマッププロバイダーの実装については、このチュートリアルの最後にある「参考資料」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="66858-163">For some alternate Site Map provider implementations, refer to the Further Readings section at the end of this tutorial.</span></span>

<span data-ttu-id="66858-164">既定のサイトマッププロバイダーでは、`Web.sitemap` という名前の適切な形式の XML ファイルがルートディレクトリに存在することを想定しています。</span><span class="sxs-lookup"><span data-stu-id="66858-164">The default Site Map provider expects a properly-formatted XML file named `Web.sitemap` to exist the root directory.</span></span> <span data-ttu-id="66858-165">この既定のプロバイダーを使用するため、このようなファイルを追加し、サイトマップの構造を適切な XML 形式で定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-165">Since we are using this default provider, we need to add such a file and define the site map's structure in the appropriate XML format.</span></span> <span data-ttu-id="66858-166">ファイルを追加するには、ソリューションエクスプローラーでプロジェクト名を右クリックし、[新しい項目の追加] を選択します。</span><span class="sxs-lookup"><span data-stu-id="66858-166">To add the file, right-click on the project name in Solution Explorer and choose Add New Item.</span></span> <span data-ttu-id="66858-167">ダイアログボックスで、`Web.sitemap`という名前のサイトマップの種類のファイルを追加することを選択します。</span><span class="sxs-lookup"><span data-stu-id="66858-167">From the dialog box, opt to add a file of type Site Map named `Web.sitemap`.</span></span>

<span data-ttu-id="66858-168">[Web.config という名前のファイルをプロジェクトのルートディレクトリに追加 ![ます。](creating-user-accounts-vb/_static/image5.png)](creating-user-accounts-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="66858-168">[![Add a File Named Web.sitemap to the Project's Root Directory](creating-user-accounts-vb/_static/image5.png)](creating-user-accounts-vb/_static/image4.png)</span></span>

<span data-ttu-id="66858-169">**図 2**:`Web.sitemap` という名前のファイルをプロジェクトのルートディレクトリに追加します ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image6.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-169">**Figure 2**: Add a File Named `Web.sitemap` to the Project's Root Directory ([Click to view full-size image](creating-user-accounts-vb/_static/image6.png))</span></span>

<span data-ttu-id="66858-170">XML サイトマップファイルは、web サイトの構造を階層として定義します。</span><span class="sxs-lookup"><span data-stu-id="66858-170">The XML site map file defines the website's structure as a hierarchy.</span></span> <span data-ttu-id="66858-171">この階層関係は、`<siteMapNode>` 要素の先祖を通じて XML ファイルでモデル化されています。</span><span class="sxs-lookup"><span data-stu-id="66858-171">This hierarchical relationship is modeled in the XML file via the ancestry of the `<siteMapNode>` elements.</span></span> <span data-ttu-id="66858-172">`Web.sitemap` は、正確に1つの `<siteMapNode>` 子を持つ `<siteMap>` 親ノードで始める必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-172">The `Web.sitemap` must start with a `<siteMap>` parent node that has precisely one `<siteMapNode>` child.</span></span> <span data-ttu-id="66858-173">この最上位の `<siteMapNode>` 要素は、階層のルートを表し、任意の数の子孫ノードを持つことができます。</span><span class="sxs-lookup"><span data-stu-id="66858-173">This top-level `<siteMapNode>` element represents the root of the hierarchy, and may have an arbitrary number of descendent nodes.</span></span> <span data-ttu-id="66858-174">各 `<siteMapNode>` 要素には、`title` 属性を含める必要があります。また、必要に応じて、`url` と `description` の属性を含めることもできます。空ではない `url` 属性はそれぞれ一意である必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-174">Each `<siteMapNode>` element must include a `title` attribute and may optionally include `url` and `description` attributes, among others; each non-empty `url` attribute must be unique.</span></span>

<span data-ttu-id="66858-175">`Web.sitemap` ファイルに次の XML を入力します。</span><span class="sxs-lookup"><span data-stu-id="66858-175">Enter the following XML into the `Web.sitemap` file:</span></span>

[!code-xml[Main](creating-user-accounts-vb/samples/sample2.xml)]

<span data-ttu-id="66858-176">上記のサイトマップマークアップでは、図3に示す階層を定義します。</span><span class="sxs-lookup"><span data-stu-id="66858-176">The above site map markup defines the hierarchy shown in Figure 3.</span></span>

<span data-ttu-id="66858-177">[サイトマップが階層ナビゲーション構造を表す ![](creating-user-accounts-vb/_static/image8.png)](creating-user-accounts-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="66858-177">[![The Site Map Represents a Hierarchical Navigational Structure](creating-user-accounts-vb/_static/image8.png)](creating-user-accounts-vb/_static/image7.png)</span></span>

<span data-ttu-id="66858-178">**図 3**:サイトマップは階層ナビゲーション構造を表します ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image9.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-178">**Figure 3**: The Site Map Represents a Hierarchical Navigational Structure ([Click to view full-size image](creating-user-accounts-vb/_static/image9.png))</span></span>

## <a name="step-3-updating-the-master-page-to-include-a-navigational-user-interface"></a><span data-ttu-id="66858-179">手順 3:ナビゲーションユーザーインターフェイスを含むようにマスターページを更新する</span><span class="sxs-lookup"><span data-stu-id="66858-179">Step 3: Updating the Master Page to Include a Navigational User Interface</span></span>

<span data-ttu-id="66858-180">ASP.NET には、ユーザーインターフェイスを設計するためのナビゲーション関連のさまざまな Web コントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="66858-180">ASP.NET includes a number of navigation-related Web controls for designing a user interface.</span></span> <span data-ttu-id="66858-181">これには、メニュー、TreeView、および SiteMapPath コントロールが含まれます。</span><span class="sxs-lookup"><span data-stu-id="66858-181">These include the Menu, TreeView, and the SiteMapPath controls.</span></span> <span data-ttu-id="66858-182">メニューコントロールと TreeView コントロールは、それぞれ1つのメニューまたはツリーにサイトマップ構造を表示します。一方、SiteMapPath には、現在アクセスしているノードとその先祖を示す階層リンクが表示されます。</span><span class="sxs-lookup"><span data-stu-id="66858-182">The Menu and TreeView controls render the site map structure in a menu or a tree, respectively, whereas the SiteMapPath displays a breadcrumb that shows the current node being visited as well as its ancestors.</span></span> <span data-ttu-id="66858-183">サイトマップデータは、SiteMapDataSource を使用して他のデータ Web コントロールにバインドすることができ、`SiteMap` クラスを使用してプログラムからアクセスすることができます。</span><span class="sxs-lookup"><span data-stu-id="66858-183">The site map data can be bound to other data Web controls using the SiteMapDataSource and can be accessed programmatically via the `SiteMap` class.</span></span>

<span data-ttu-id="66858-184">このチュートリアルシリーズでは、サイトマップフレームワークとナビゲーションコントロールの詳細については説明しません。そのため、独自のナビゲーションユーザーインターフェイスを作成するのではなく、「 *[ASP.NET 2.0](../../data-access/index.md)* チュートリアルシリーズのデータの操作」で使用されているものを借用します。このシリーズでは、図4に示すように、Repeater コントロールを使用して、</span><span class="sxs-lookup"><span data-stu-id="66858-184">Since a thorough discussion of the Site Map framework and the Navigation controls is beyond the scope of this tutorial series, rather than spend time crafting our own navigational user interface let's instead borrow the one used in my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series, which uses a Repeater control to display a two-deep bulleted list of navigation links, as shown in Figure 4.</span></span>

### <a name="adding-a-two-level-list-of-links-in-the-left-column"></a><span data-ttu-id="66858-185">左の列に2レベルのリンクの一覧を追加する</span><span class="sxs-lookup"><span data-stu-id="66858-185">Adding a Two-Level List of Links in the Left Column</span></span>

<span data-ttu-id="66858-186">このインターフェイスを作成するには、次の宣言型マークアップを `Site.master` マスターページの左の列に追加します。このテキストは TODO:メニューがここに表示されます...現在は存在します。</span><span class="sxs-lookup"><span data-stu-id="66858-186">To create this interface, add the following declarative markup to the `Site.master` master page's left column where the text TODO: Menu will go here... currently resides.</span></span>

[!code-aspx[Main](creating-user-accounts-vb/samples/sample3.aspx)]

<span data-ttu-id="66858-187">上のマークアップは、`menu` という名前のリピータコントロールを、`Web.sitemap`で定義されたサイトマップ階層を返す SiteMapDataSource にバインドします。</span><span class="sxs-lookup"><span data-stu-id="66858-187">The above markup binds a Repeater control named `menu` to a SiteMapDataSource, which returns the site map hierarchy defined in `Web.sitemap`.</span></span> <span data-ttu-id="66858-188">SiteMapDataSource コントロールの[`ShowStartingNode` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemapdatasource.showstartingnode.aspx)は False に設定されているため、ホームノードの子孫で始まるサイトマップの階層が返され始めます。</span><span class="sxs-lookup"><span data-stu-id="66858-188">Since the SiteMapDataSource control's [`ShowStartingNode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemapdatasource.showstartingnode.aspx) is set to False it starts returning the site map's hierarchy starting with the descendents of the Home node.</span></span> <span data-ttu-id="66858-189">リピータは、これらの各ノード (現時点ではメンバーシップ) を `<li>` 要素に表示します。</span><span class="sxs-lookup"><span data-stu-id="66858-189">The Repeater displays each of these nodes (currently just Membership ) in an `<li>` element.</span></span> <span data-ttu-id="66858-190">もう1つの内部リピータは、入れ子になった順序なしリストに現在のノードの子を表示します。</span><span class="sxs-lookup"><span data-stu-id="66858-190">Another, inner Repeater then displays the current node's children in a nested unordered list.</span></span>

<span data-ttu-id="66858-191">図4に、上記のマークアップのレンダリング出力と、手順2で作成したサイトマップ構造を示します。</span><span class="sxs-lookup"><span data-stu-id="66858-191">Figure 4 shows the above markup's rendered output with the site map structure we created in Step 2.</span></span> <span data-ttu-id="66858-192">リピータは、バニラの順序なしリストマークアップをレンダリングします。`Styles.css` で定義されているカスケードスタイルシートルールは、見た目のあるレイアウトを担当します。</span><span class="sxs-lookup"><span data-stu-id="66858-192">The Repeater renders vanilla unordered list markup; the cascading style sheet rules defined in `Styles.css` are responsible for the aesthetically-pleasing layout.</span></span> <span data-ttu-id="66858-193">上記のマークアップの動作の詳細については、「[マスターページとサイトナビゲーション](https://asp.net/learn/data-access/tutorial-03-vb.aspx)のチュートリアル」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="66858-193">For a more detailed description of how the above markup works, refer to the [Master Pages and Site Navigation](https://asp.net/learn/data-access/tutorial-03-vb.aspx) tutorial.</span></span>

<span data-ttu-id="66858-194">[ナビゲーションユーザーインターフェイスが、入れ子になった順序なしリストを使用して表示される ![](creating-user-accounts-vb/_static/image11.png)](creating-user-accounts-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="66858-194">[![The Navigational User Interface is Rendered Using Nested Unordered Lists](creating-user-accounts-vb/_static/image11.png)](creating-user-accounts-vb/_static/image10.png)</span></span>

<span data-ttu-id="66858-195">**図 4**:ナビゲーションユーザーインターフェイスは、入れ子になった順序なしリストを使用してレンダリングされます ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-195">**Figure 4**: The Navigational User Interface is Rendered Using Nested Unordered Lists ([Click to view full-size image](creating-user-accounts-vb/_static/image12.png))</span></span>

### <a name="adding-breadcrumb-navigation"></a><span data-ttu-id="66858-196">階層リンクナビゲーションの追加</span><span class="sxs-lookup"><span data-stu-id="66858-196">Adding Breadcrumb Navigation</span></span>

<span data-ttu-id="66858-197">左の列のリンクの一覧に加えて、各ページに[階層リンク](http://en.wikipedia.org/wiki/Breadcrumb_%28navigation%29)が表示されます。</span><span class="sxs-lookup"><span data-stu-id="66858-197">In addition to the list of links in the left column, let's also have each page display a [breadcrumb](http://en.wikipedia.org/wiki/Breadcrumb_%28navigation%29).</span></span> <span data-ttu-id="66858-198">階層リンクとは、ユーザーがサイト階層内の現在の位置をすばやく表示するナビゲーションユーザーインターフェイス要素です。</span><span class="sxs-lookup"><span data-stu-id="66858-198">A breadcrumb is a navigational user interface element that quickly shows users their current position within the site hierarchy.</span></span> <span data-ttu-id="66858-199">SiteMapPath コントロールは、サイトマップフレームワークを使用して、サイトマップ内の現在のページの場所を判断し、この情報に基づいて階層リンクを表示します。</span><span class="sxs-lookup"><span data-stu-id="66858-199">The SiteMapPath control uses the Site Map framework to determine the current page's location in the site map and then displays a breadcrumb based on this information.</span></span>

<span data-ttu-id="66858-200">具体的には、`<span>` 要素をマスターページのヘッダー `<div>` 要素に追加し、新しい `<span>` 要素の `class` 属性を階層リンクに設定します。</span><span class="sxs-lookup"><span data-stu-id="66858-200">Specifically, add a `<span>` element to the master page's header `<div>` element, and set the new `<span>` element's `class` attribute to breadcrumb.</span></span> <span data-ttu-id="66858-201">(`Styles.css` クラスには、階層リンククラスの規則が含まれています)。次に、この新しい `<span>` 要素に SiteMapPath を追加します。</span><span class="sxs-lookup"><span data-stu-id="66858-201">(The `Styles.css` class contains a rule for a breadcrumb class.) Next, add a SiteMapPath to this new `<span>` element.</span></span>

[!code-aspx[Main](creating-user-accounts-vb/samples/sample4.aspx)]

<span data-ttu-id="66858-202">図5に、`~/Membership/CreatingUserAccounts.aspx`にアクセスしたときの SiteMapPath の出力を示します。</span><span class="sxs-lookup"><span data-stu-id="66858-202">Figure 5 shows the output of the SiteMapPath when visiting `~/Membership/CreatingUserAccounts.aspx`.</span></span>

<span data-ttu-id="66858-203">[階層リンクの ![、現在のページとその先祖がサイトマップに表示されます。](creating-user-accounts-vb/_static/image14.png)](creating-user-accounts-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="66858-203">[![The Breadcrumb Displays the Current Page and its Ancestors in the Site Map](creating-user-accounts-vb/_static/image14.png)](creating-user-accounts-vb/_static/image13.png)</span></span>

<span data-ttu-id="66858-204">**図 5**:階層リンクには、現在のページとその先祖がサイトマップに表示されます ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-204">**Figure 5**: The Breadcrumb Displays the Current Page and its Ancestors in the Site Map ([Click to view full-size image](creating-user-accounts-vb/_static/image15.png))</span></span>

## <a name="step-4-removing-the-custom-principal-and-identity-logic"></a><span data-ttu-id="66858-205">手順 4:カスタムプリンシパルと Id ロジックの削除</span><span class="sxs-lookup"><span data-stu-id="66858-205">Step 4: Removing the Custom Principal and Identity Logic</span></span>

<span data-ttu-id="66858-206">*<a id="_msoanchor_7"></a>[フォーム認証構成と高度なトピック](../introduction/forms-authentication-configuration-and-advanced-topics-vb.md)* のチュートリアルでは、カスタムプリンシパルオブジェクトと id オブジェクトを認証されたユーザーに関連付ける方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="66858-206">In the *<a id="_msoanchor_7"></a>[Forms Authentication Configuration and Advanced Topics](../introduction/forms-authentication-configuration-and-advanced-topics-vb.md)* tutorial we saw how to associate custom principal and identity objects to the authenticated user.</span></span> <span data-ttu-id="66858-207">これを実現するには、アプリケーションの `PostAuthenticateRequest` イベントのイベントハンドラーを `Global.asax` で作成します。これは、`FormsAuthenticationModule` がユーザーを認証した後に発生します。</span><span class="sxs-lookup"><span data-stu-id="66858-207">We accomplished this by creating an event handler in `Global.asax` for the application's `PostAuthenticateRequest` event, which fires after the `FormsAuthenticationModule` has authenticated the user.</span></span> <span data-ttu-id="66858-208">このイベントハンドラーでは、`FormsAuthenticationModule` によって追加された `GenericPrincipal` と `FormsIdentity` オブジェクトを、そのチュートリアルで作成した `CustomPrincipal` および `CustomIdentity` のオブジェクトに置き換えました。</span><span class="sxs-lookup"><span data-stu-id="66858-208">In this event handler we replaced the `GenericPrincipal` and `FormsIdentity` objects added by the `FormsAuthenticationModule` with the `CustomPrincipal` and `CustomIdentity` objects we created in that tutorial.</span></span>

<span data-ttu-id="66858-209">カスタムプリンシパルオブジェクトと id オブジェクトは特定のシナリオで役に立ちますが、ほとんどの場合、`GenericPrincipal` オブジェクトと `FormsIdentity` オブジェクトで十分です。</span><span class="sxs-lookup"><span data-stu-id="66858-209">While custom principal and identity objects are useful in certain scenarios, in most cases the `GenericPrincipal` and `FormsIdentity` objects are sufficient.</span></span> <span data-ttu-id="66858-210">そのため、既定の動作に戻すことができると思います。</span><span class="sxs-lookup"><span data-stu-id="66858-210">Consequently, I think it would be worthwhile to return to the default behavior.</span></span> <span data-ttu-id="66858-211">この変更を行うには、`PostAuthenticateRequest` イベントハンドラーを削除するかコメントアウトするか、`Global.asax` ファイルを完全に削除します。</span><span class="sxs-lookup"><span data-stu-id="66858-211">Make this change by either removing or commenting out the `PostAuthenticateRequest` event handler or by deleting the `Global.asax` file entirely.</span></span>

> [!NOTE]
> <span data-ttu-id="66858-212">`Global.asax`のコードをコメント化または削除したら、`User.Identity` プロパティを `CustomIdentity` インスタンスにキャストする `Default.aspx's` コードビハインドクラスのコードをコメントアウトする必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-212">Once you've commented or removed the code in `Global.asax`, you will need to comment out the code in `Default.aspx's` code-behind class that casts the `User.Identity` property to a `CustomIdentity` instance.</span></span>

## <a name="step-5-programmatically-creating-a-new-user"></a><span data-ttu-id="66858-213">手順 5:プログラムによる新しいユーザーの作成</span><span class="sxs-lookup"><span data-stu-id="66858-213">Step 5: Programmatically Creating a New User</span></span>

<span data-ttu-id="66858-214">メンバーシップフレームワークを使用して新しいユーザーアカウントを作成するには、`Membership` クラスの[`CreateUser` メソッド](https://msdn.microsoft.com/library/system.web.security.membership.createuser.aspx)を使用します。</span><span class="sxs-lookup"><span data-stu-id="66858-214">To create a new user account through the Membership framework use the `Membership` class's [`CreateUser` method](https://msdn.microsoft.com/library/system.web.security.membership.createuser.aspx).</span></span> <span data-ttu-id="66858-215">このメソッドには、ユーザー名、パスワード、およびその他のユーザー関連フィールドの入力パラメーターがあります。</span><span class="sxs-lookup"><span data-stu-id="66858-215">This method has input parameters for the username, password, and other user-related fields.</span></span> <span data-ttu-id="66858-216">呼び出し時に、構成されたメンバーシッププロバイダーに新しいユーザーアカウントの作成を委任した後、作成されたユーザーアカウントのみを表す[`MembershipUser` オブジェクト](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx)を返します。</span><span class="sxs-lookup"><span data-stu-id="66858-216">On invocation, it delegates the creation of the new user account to the configured Membership provider and then returns a [`MembershipUser` object](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) representing the just-created user account.</span></span>

<span data-ttu-id="66858-217">`CreateUser` メソッドには4つのオーバーロードがあり、それぞれが異なる数の入力パラメーターを受け入れます。</span><span class="sxs-lookup"><span data-stu-id="66858-217">The `CreateUser` method has four overloads, each accepting a different number of input parameters:</span></span>

- [`CreateUser(username, password)`](https://msdn.microsoft.com/library/d8t4h2es.aspx)
- [`CreateUser(username, password, email)`](https://msdn.microsoft.com/library/t8yy6w3h.aspx)
- [`CreateUser(username, password, email, passwordQuestion, passwordAnswer, isApproved, MembershipCreateStatus)`](https://msdn.microsoft.com/library/82xx2e62.aspx)
- [`CreateUser(username, password, email, passwordQuestion, passwordAnswer, isApproved, providerUserKey, MembershipCreateStatus)`](https://msdn.microsoft.com/library/ms152012.aspx)

<span data-ttu-id="66858-218">これらの4つのオーバーロードは、収集される情報の量によって異なります。</span><span class="sxs-lookup"><span data-stu-id="66858-218">These four overloads differ on the amount of information that is collected.</span></span> <span data-ttu-id="66858-219">たとえば、最初のオーバーロードでは、新しいユーザーアカウントのユーザー名とパスワードのみが必要ですが、2つ目のオーバーロードでは、ユーザーの電子メールアドレスも必要です。</span><span class="sxs-lookup"><span data-stu-id="66858-219">The first overload, for example, requires just the username and password for the new user account, whereas the second one also requires the user's email address.</span></span>

<span data-ttu-id="66858-220">新しいユーザーアカウントを作成するために必要な情報は、メンバーシッププロバイダーの構成設定によって異なるため、これらのオーバーロードが存在します。</span><span class="sxs-lookup"><span data-stu-id="66858-220">These overloads exist because the information needed to create a new user account depends on the Membership provider's configuration settings.</span></span> <span data-ttu-id="66858-221">SQL Server チュートリアル *<a id="_msoanchor_8"></a>[でメンバーシップスキーマを作成する方法](creating-the-membership-schema-in-sql-server-vb.md)* については、`Web.config`でメンバーシッププロバイダーの構成設定を指定する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="66858-221">In the *<a id="_msoanchor_8"></a>[Creating the Membership Schema in SQL Server](creating-the-membership-schema-in-sql-server-vb.md)* tutorial we examined specifying Membership provider configuration settings in `Web.config`.</span></span> <span data-ttu-id="66858-222">表2に、構成設定の完全な一覧を示します。</span><span class="sxs-lookup"><span data-stu-id="66858-222">Table 2 included a complete list of the configuration settings.</span></span>

<span data-ttu-id="66858-223">使用できる `CreateUser` のオーバーロードに影響を与えるメンバーシッププロバイダーの構成設定の1つに、`requiresQuestionAndAnswer` の設定があります。</span><span class="sxs-lookup"><span data-stu-id="66858-223">One such Membership provider configuration setting that impacts what `CreateUser` overloads may be used is the `requiresQuestionAndAnswer` setting.</span></span> <span data-ttu-id="66858-224">`requiresQuestionAndAnswer` が `true` (既定値) に設定されている場合は、新しいユーザーアカウントを作成するときに、セキュリティの質問と回答を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-224">If `requiresQuestionAndAnswer` is set to `true` (the default), then when creating a new user account we must specify a security question and answer.</span></span> <span data-ttu-id="66858-225">この情報は、ユーザーがパスワードをリセットまたは変更する必要がある場合に、後で使用されます。</span><span class="sxs-lookup"><span data-stu-id="66858-225">This information is later used if the user needs to reset or change their password.</span></span> <span data-ttu-id="66858-226">具体的には、その時点でセキュリティの質問が表示され、パスワードをリセットまたは変更するために正しい回答を入力する必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-226">Specifically, at that time they are shown the security question and they must enter the correct answer in order to reset or change their password.</span></span> <span data-ttu-id="66858-227">その結果、`requiresQuestionAndAnswer` が `true` に設定されている場合、最初の2つの `CreateUser` オーバーロードのいずれかを呼び出すと、セキュリティの質問と回答がないため、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="66858-227">Consequently, if the `requiresQuestionAndAnswer` is set to `true` then calling either of the first two `CreateUser` overloads results in an exception because the security question and answer are missing.</span></span> <span data-ttu-id="66858-228">現在、アプリケーションはセキュリティの質問と回答を要求するように構成されているため、プログラムでユーザーを作成する場合は、後者の2つのオーバーロードのいずれかを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-228">Since our application is currently configured to require a security question and answer, we will need to use one of the latter two overloads when creating user's programmatically.</span></span>

<span data-ttu-id="66858-229">`CreateUser` メソッドの使用方法を示すために、ユーザーインターフェイスを作成して、ユーザーに名前、パスワード、電子メール、事前定義されたセキュリティの質問への回答を入力するように指示します。</span><span class="sxs-lookup"><span data-stu-id="66858-229">To illustrate using the `CreateUser` method, let's create a user interface where we prompt the user for their name, password, email, and an answer to a pre-defined security question.</span></span> <span data-ttu-id="66858-230">`Membership` フォルダーの [`CreatingUserAccounts.aspx`] ページを開き、次の Web コントロールをコンテンツコントロールに追加します。</span><span class="sxs-lookup"><span data-stu-id="66858-230">Open the `CreatingUserAccounts.aspx` page in the `Membership` folder and add the following Web controls to the Content control:</span></span>

- <span data-ttu-id="66858-231">`Username` という名前のテキストボックス</span><span class="sxs-lookup"><span data-stu-id="66858-231">A TextBox named `Username`</span></span>
- <span data-ttu-id="66858-232">`TextMode` プロパティがに設定されている `Password`という名前のテキストボックス `Password`</span><span class="sxs-lookup"><span data-stu-id="66858-232">A TextBox named `Password`, whose `TextMode` property is set to `Password`</span></span>
- <span data-ttu-id="66858-233">`Email` という名前のテキストボックス</span><span class="sxs-lookup"><span data-stu-id="66858-233">A TextBox named `Email`</span></span>
- <span data-ttu-id="66858-234">`Text` プロパティがクリアされた `SecurityQuestion` という名前のラベル</span><span class="sxs-lookup"><span data-stu-id="66858-234">A Label named `SecurityQuestion` with its `Text` property cleared out</span></span>
- <span data-ttu-id="66858-235">`SecurityAnswer` という名前のテキストボックス</span><span class="sxs-lookup"><span data-stu-id="66858-235">A TextBox named `SecurityAnswer`</span></span>
- <span data-ttu-id="66858-236">`Text` プロパティがユーザーアカウントを作成するように設定されている `CreateAccountButton` という名前のボタン</span><span class="sxs-lookup"><span data-stu-id="66858-236">A Button named `CreateAccountButton` whose `Text` property is set to Create the User Account</span></span>
- <span data-ttu-id="66858-237">`Text` プロパティがクリアされた `CreateAccountResults` という名前のラベルコントロール</span><span class="sxs-lookup"><span data-stu-id="66858-237">A Label control named `CreateAccountResults` with its `Text` property cleared out</span></span>

<span data-ttu-id="66858-238">この時点で、画面は図6に示すスクリーンショットのようになります。</span><span class="sxs-lookup"><span data-stu-id="66858-238">At this point your screen should look similar to the screen shot shown in Figure 6.</span></span>

<span data-ttu-id="66858-239">[[![] ページにさまざまな Web コントロールを追加する](creating-user-accounts-vb/_static/image17.png)](creating-user-accounts-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="66858-239">[![Add the Various Web Controls to the CreatingUserAccounts.aspx Page](creating-user-accounts-vb/_static/image17.png)](creating-user-accounts-vb/_static/image16.png)</span></span>

<span data-ttu-id="66858-240">**図 6**:さまざまな Web コントロールを `CreatingUserAccounts.aspx Page` に追加します ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-240">**Figure 6**: Add the Various Web Controls to the `CreatingUserAccounts.aspx Page` ([Click to view full-size image](creating-user-accounts-vb/_static/image18.png))</span></span>

<span data-ttu-id="66858-241">`SecurityQuestion` ラベルと `SecurityAnswer` テキストボックスは、事前に定義されたセキュリティの質問を表示し、ユーザーの回答を収集することを目的としています。</span><span class="sxs-lookup"><span data-stu-id="66858-241">The `SecurityQuestion` Label and `SecurityAnswer` TextBox are intended to display a pre-defined security question and collect the user's answer.</span></span> <span data-ttu-id="66858-242">セキュリティの質問と回答はユーザーごとに保存されるので、各ユーザーが独自のセキュリティの質問を定義できるようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="66858-242">Note that both the security question and answer are stored on a user-by-user basis, so it is possible to allow each user to define their own security question.</span></span> <span data-ttu-id="66858-243">ただし、この例では、ユニバーサルセキュリティの質問を使用することにしました。好きな色は何ですか?</span><span class="sxs-lookup"><span data-stu-id="66858-243">However, for this example I have decided to use a universal security question, namely: What is your favorite color?</span></span>

<span data-ttu-id="66858-244">この事前定義されたセキュリティの質問を実装するには、`passwordQuestion`という名前のページの分離コードクラスに定数を追加し、それにセキュリティの質問を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="66858-244">To implement this pre-defined security question, add a constant to the page's code-behind class named `passwordQuestion`, assigning it the security question.</span></span> <span data-ttu-id="66858-245">次に、`Page_Load` イベントハンドラーで、この定数を `SecurityQuestion` ラベルの `Text` プロパティに割り当てます。</span><span class="sxs-lookup"><span data-stu-id="66858-245">Then, in the `Page_Load` event handler, assign this constant to the `SecurityQuestion` Label's `Text` property:</span></span>

[!code-vb[Main](creating-user-accounts-vb/samples/sample5.vb)]

<span data-ttu-id="66858-246">次に、`CreateAccountButton'` s `Click` イベントのイベントハンドラーを作成し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="66858-246">Next, create an event handler for the `CreateAccountButton'` s `Click` event and add the following code:</span></span>

[!code-vb[Main](creating-user-accounts-vb/samples/sample6.vb)]

<span data-ttu-id="66858-247">`Click` イベントハンドラーは、 [`MembershipCreateStatus`](https://msdn.microsoft.com/library/system.web.security.membershipcreatestatus.aspx)型の `createStatus` という名前の変数を定義することによって開始されます。</span><span class="sxs-lookup"><span data-stu-id="66858-247">The `Click` event handler starts by defining a variable named `createStatus` of type [`MembershipCreateStatus`](https://msdn.microsoft.com/library/system.web.security.membershipcreatestatus.aspx).</span></span> <span data-ttu-id="66858-248">`MembershipCreateStatus` は、`CreateUser` 操作の状態を示す列挙体です。</span><span class="sxs-lookup"><span data-stu-id="66858-248">`MembershipCreateStatus` is an enumeration that indicates the status of the `CreateUser` operation.</span></span> <span data-ttu-id="66858-249">たとえば、ユーザーアカウントが正常に作成された場合、結果の `MembershipCreateStatus` インスタンスは `Success;` の値に設定されます。ただし、同じユーザー名を持つユーザーが既に存在するために操作が失敗した場合は、`DuplicateUserName`の値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="66858-249">For example, if the user account is created successfully, the resulting `MembershipCreateStatus` instance will be set to a value of `Success;` on the other hand, if the operation fails because there already exists a user with the same username, it will be set to a value of `DuplicateUserName`.</span></span> <span data-ttu-id="66858-250">使用する `CreateUser` オーバーロードでは、`MembershipCreateStatus` インスタンスをメソッドに渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-250">In the `CreateUser` overload we use, we need to pass a `MembershipCreateStatus` instance into the method.</span></span> <span data-ttu-id="66858-251">このパラメーターは `CreateUser` メソッド内の適切な値に設定され、メソッド呼び出しの後でその値を調べて、ユーザーアカウントが正常に作成されたかどうかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="66858-251">This parameter is set to the appropriate value within the `CreateUser` method, and we can examine its value after the method call to determine whether the user account was successfully created.</span></span>

<span data-ttu-id="66858-252">`createStatus`を渡して `CreateUser`を呼び出した後、`Select Case` ステートメントを使用して、`createStatus`に割り当てられた値に応じて適切なメッセージを出力します。</span><span class="sxs-lookup"><span data-stu-id="66858-252">After calling `CreateUser`, passing in `createStatus`, a `Select Case` statement is used to output an appropriate message depending on the value assigned to `createStatus`.</span></span> <span data-ttu-id="66858-253">図7は、新しいユーザーが正常に作成されたときの出力を示しています。</span><span class="sxs-lookup"><span data-stu-id="66858-253">Figures 7 shows the output when a new user has successfully been created.</span></span> <span data-ttu-id="66858-254">図8と9は、ユーザーアカウントが作成されていない場合の出力を示しています。</span><span class="sxs-lookup"><span data-stu-id="66858-254">Figures 8 and 9 show the output when the user account is not created.</span></span> <span data-ttu-id="66858-255">図8では、ビジターは5文字のパスワードを入力しました。このパスワードは、メンバーシッププロバイダーの構成設定に記載されているパスワードの強度の要件を満たしていません。</span><span class="sxs-lookup"><span data-stu-id="66858-255">In Figure 8, the visitor entered a five-letter password, which does not meet the password strength requirements spelled out in the Membership provider's configuration settings.</span></span> <span data-ttu-id="66858-256">図9では、ビジターが既存のユーザー名 (図7で作成したもの) を使用してユーザーアカウントを作成しようとしています。</span><span class="sxs-lookup"><span data-stu-id="66858-256">In Figure 9, the visitor is attempting to create a user account with an existing username (the one created in Figure 7).</span></span>

<span data-ttu-id="66858-257">[新しいユーザーアカウントが正常に作成された ![](creating-user-accounts-vb/_static/image20.png)](creating-user-accounts-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="66858-257">[![A New User Account is Successfully Created](creating-user-accounts-vb/_static/image20.png)](creating-user-accounts-vb/_static/image19.png)</span></span>

<span data-ttu-id="66858-258">**図 7**:新しいユーザーアカウントが正常に作成されました ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image21.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-258">**Figure 7**: A New User Account is Successfully Created  ([Click to view full-size image](creating-user-accounts-vb/_static/image21.png))</span></span>

<span data-ttu-id="66858-259">[指定されたパスワードが不十分であるため、ユーザーアカウントが作成され ![](creating-user-accounts-vb/_static/image23.png)](creating-user-accounts-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="66858-259">[![The User Account is Not Created Because the Supplied Password is Too Weak](creating-user-accounts-vb/_static/image23.png)](creating-user-accounts-vb/_static/image22.png)</span></span>

<span data-ttu-id="66858-260">**図 8**:指定されたパスワードが不十分なため、ユーザーアカウントは作成されません ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image24.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-260">**Figure 8**: The User Account is Not Created Because the Supplied Password is Too Weak ([Click to view full-size image](creating-user-accounts-vb/_static/image24.png))</span></span>

<span data-ttu-id="66858-261">[ユーザー名が既に使用されているため、ユーザーアカウントが作成され ![](creating-user-accounts-vb/_static/image26.png)](creating-user-accounts-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="66858-261">[![The User Account is Not Created Because the Username is Already in Use](creating-user-accounts-vb/_static/image26.png)](creating-user-accounts-vb/_static/image25.png)</span></span>

<span data-ttu-id="66858-262">**図 9**:ユーザー名が既に使用されているため、ユーザーアカウントは作成されません ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image27.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-262">**Figure 9**: The User Account is Not Created Because the Username is Already in Use ([Click to view full-size image](creating-user-accounts-vb/_static/image27.png))</span></span>

> [!NOTE]
> <span data-ttu-id="66858-263">最初の2つの `CreateUser` メソッドオーバーロードのいずれかを使用した場合に成功または失敗を判断する方法について疑問があるかもしれませんが、どちらも `MembershipCreateStatus`型のパラメーターを持っていません。</span><span class="sxs-lookup"><span data-stu-id="66858-263">You may be wondering how to determine success or failure when using one of the first two `CreateUser` method overloads, neither of which has a parameter of type `MembershipCreateStatus`.</span></span> <span data-ttu-id="66858-264">これらの最初の2つのオーバーロードは、エラー発生時に[`MembershipCreateUserException` 例外](https://msdn.microsoft.com/library/system.web.security.membershipcreateuserexception.aspx)をスローします。これには `MembershipCreateStatus`型の[`StatusCode` プロパティ](https://msdn.microsoft.com/library/system.web.security.membershipcreateuserexception.statuscode.aspx)が含まれます。</span><span class="sxs-lookup"><span data-stu-id="66858-264">These first two overloads throw a [`MembershipCreateUserException` exception](https://msdn.microsoft.com/library/system.web.security.membershipcreateuserexception.aspx) in the face of a failure, which includes a [`StatusCode` property](https://msdn.microsoft.com/library/system.web.security.membershipcreateuserexception.statuscode.aspx) of type `MembershipCreateStatus`.</span></span>

<span data-ttu-id="66858-265">いくつかのユーザーアカウントを作成した後、`SecurityTutorials.mdf` データベースの `aspnet_Users` テーブルと `aspnet_Membership` テーブルの内容を一覧表示して、アカウントが作成されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="66858-265">After creating a few user accounts, verify that the accounts have been created by listing the contents of the `aspnet_Users` and `aspnet_Membership` tables in the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="66858-266">図10に示すように、`CreatingUserAccounts.aspx` のページを使用して2人のユーザーを追加しました。Tito としています。</span><span class="sxs-lookup"><span data-stu-id="66858-266">As Figure 10 shows, I have added two users via the `CreatingUserAccounts.aspx` page: Tito and Bruce.</span></span>

<span data-ttu-id="66858-267">メンバーシップユーザーストアに2人のユーザーがいる ![[ます。Tito および](creating-user-accounts-vb/_static/image29.png)](creating-user-accounts-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="66858-267">[![There are Two Users in the Membership User Store: Tito and Bruce](creating-user-accounts-vb/_static/image29.png)](creating-user-accounts-vb/_static/image28.png)</span></span>

<span data-ttu-id="66858-268">**図 10**:メンバーシップユーザーストアには、次の2人のユーザーがいます。Tito および ([クリックしてフルサイズの画像を表示](creating-user-accounts-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="66858-268">**Figure 10**: There are Two Users in the Membership User Store: Tito and Bruce ([Click to view full-size image](creating-user-accounts-vb/_static/image30.png))</span></span>

<span data-ttu-id="66858-269">メンバーシップユーザーストアには、お客様のアカウント情報が含まれるようになりましたが、サイトへのログオンを可能にする機能をまだ実装していません。</span><span class="sxs-lookup"><span data-stu-id="66858-269">While the Membership user store now includes Bruce and Tito's account information, we have yet to implement functionality that allows for Bruce or Tito to log on to the site.</span></span> <span data-ttu-id="66858-270">現時点では、`Login.aspx` ユーザーの資格情報をハードコーディングされたユーザー名とパスワードの組み合わせに対して検証します。メンバーシップフレームワークに対して指定された資格情報を検証し*ません*。</span><span class="sxs-lookup"><span data-stu-id="66858-270">Currently, `Login.aspx` validates the user's credentials against a hard-coded set of username/password pairs - it does *not* validate the supplied credentials against the Membership framework.</span></span> <span data-ttu-id="66858-271">ここでは、`aspnet_Users` テーブルと `aspnet_Membership` テーブルの新しいユーザーアカウントに十分な権限があることを確認します。</span><span class="sxs-lookup"><span data-stu-id="66858-271">For now seeing the new user accounts in the `aspnet_Users` and `aspnet_Membership` tables will have to suffice.</span></span> <span data-ttu-id="66858-272">次のチュートリアル「 *<a id="_msoanchor_9"></a>[メンバーシップユーザーストアに対してユーザー資格情報を検証](validating-user-credentials-against-the-membership-user-store-vb.md)* する」では、メンバーシップストアに対して検証するためにログインページを更新します。</span><span class="sxs-lookup"><span data-stu-id="66858-272">In the next tutorial, *<a id="_msoanchor_9"></a>[Validating User Credentials Against the Membership User Store](validating-user-credentials-against-the-membership-user-store-vb.md)*, we will update the login page to validate against the Membership store.</span></span>

> [!NOTE]
> <span data-ttu-id="66858-273">`SecurityTutorials.mdf` データベースにユーザーが表示されない場合は、web アプリケーションが既定のメンバーシッププロバイダーである `AspNetSqlMembershipProvider`を使用していることが原因である可能性があります。このプロバイダーは、`ASPNETDB.mdf` データベースをユーザーストアとして使用しています。</span><span class="sxs-lookup"><span data-stu-id="66858-273">If you do not see any users in your `SecurityTutorials.mdf` database, it may be because your web application is using the default Membership provider, `AspNetSqlMembershipProvider`, which uses the `ASPNETDB.mdf` database as its user store.</span></span> <span data-ttu-id="66858-274">これが問題かどうかを判断するには、ソリューションエクスプローラーの [更新] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="66858-274">To determine if this is the problem, click the Refresh button in the Solution Explorer.</span></span> <span data-ttu-id="66858-275">`ASPNETDB.mdf` という名前のデータベースが `App_Data` フォルダーに追加されている場合は、この問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="66858-275">If a database named `ASPNETDB.mdf` has been added to the `App_Data` folder, this is the problem.</span></span> <span data-ttu-id="66858-276">メンバーシッププロバイダーを適切に構成する方法については、 *<a id="_msoanchor_10"></a>[SQL Server チュートリアルの「メンバーシップスキーマの作成」](creating-the-membership-schema-in-sql-server-vb.md)* の手順4に戻ります。</span><span class="sxs-lookup"><span data-stu-id="66858-276">Return to Step 4 of the *<a id="_msoanchor_10"></a>[Creating the Membership Schema in SQL Server](creating-the-membership-schema-in-sql-server-vb.md)* tutorial for instructions on how to properly configure the Membership provider.</span></span>

<span data-ttu-id="66858-277">ほとんどのユーザーアカウントの作成シナリオでは、ユーザー名、パスワード、電子メール、その他の重要な情報を入力するためのインターフェイスがビジターに提示され、その時点で新しいアカウントが作成されます。</span><span class="sxs-lookup"><span data-stu-id="66858-277">In most create user account scenarios, the visitor is presented with some interface to enter their username, password, email, and other essential information, at which point a new account is created.</span></span> <span data-ttu-id="66858-278">このステップでは、このようなインターフェイスを手動で構築し、`Membership.CreateUser` メソッドを使用して、ユーザーの入力に基づいて新しいユーザーアカウントをプログラムで追加する方法を見てきました。</span><span class="sxs-lookup"><span data-stu-id="66858-278">In this step we looked at building such an interface by hand and then saw how to use the `Membership.CreateUser` method to programmatically add the new user account based on the user's inputs.</span></span> <span data-ttu-id="66858-279">ただし、このコードは新しいユーザーアカウントを作成しただけです。</span><span class="sxs-lookup"><span data-stu-id="66858-279">Our code, however, just created the new user account.</span></span> <span data-ttu-id="66858-280">作成したユーザーアカウントでのサイトへのユーザーのログイン、ユーザーへの確認メールの送信など、フォローアップのアクションは実行されませんでした。</span><span class="sxs-lookup"><span data-stu-id="66858-280">It did not perform any follow up actions, like logging in the user to the site under the just-created user account, or sending a confirmation email to the user.</span></span> <span data-ttu-id="66858-281">これらの追加の手順では、ボタンの `Click` イベントハンドラーに追加のコードが必要になります。</span><span class="sxs-lookup"><span data-stu-id="66858-281">These additional steps would require additional code in the Button's `Click` event handler.</span></span>

<span data-ttu-id="66858-282">ASP.NET には CreateUserWizard コントロールが付属しています。このコントロールは、新しいユーザーアカウントを作成するためのユーザーインターフェイスを表示したり、メンバーシップフレームワークでアカウントを作成したり、後でアカウントを実行したりするために、ユーザーアカウントの作成プロセスを処理するように設計されています。作成タスク。確認メールを送信し、作成したユーザーをサイトに記録します。</span><span class="sxs-lookup"><span data-stu-id="66858-282">ASP.NET ships with the CreateUserWizard control, which is designed to handle the user account creation process, from rendering a user interface for creating new user accounts, to creating the account in the Membership framework and performing post-account creation tasks, such as sending a confirmation email and logging the just-created user into the site.</span></span> <span data-ttu-id="66858-283">CreateUserWizard コントロールの使用は、CreateUserWizard コントロールをツールボックスからページにドラッグし、いくつかのプロパティを設定するだけで簡単に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="66858-283">Using the CreateUserWizard control is as simple as dragging the CreateUserWizard control from the Toolbox onto a page, and then setting a few properties.</span></span> <span data-ttu-id="66858-284">ほとんどの場合、1行のコードを記述する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="66858-284">In most cases, you won't need to write a single line of code.</span></span> <span data-ttu-id="66858-285">この素晴らしいコントロールについては、手順 6. で詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="66858-285">We will explore this nifty control in detail in Step 6.</span></span>

<span data-ttu-id="66858-286">新しいユーザーアカウントが通常のアカウント作成 web ページでのみ作成されている場合は、CreateUserWizard コントロールがニーズを満たす可能性があるため、`CreateUser` メソッドを使用するコードを記述することが必要になる可能性はほとんどありません。</span><span class="sxs-lookup"><span data-stu-id="66858-286">If new user accounts are only created through a typical Create Account web page, it is unlikely that you will ever need to write code that uses the `CreateUser` method, as the CreateUserWizard control will likely meet your needs.</span></span> <span data-ttu-id="66858-287">ただし、`CreateUser` 方法は、高度にカスタマイズされたアカウントのユーザーエクスペリエンスが必要な場合や、別のインターフェイスを使用してプログラムによって新しいユーザーアカウントを作成する必要がある場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="66858-287">However, the `CreateUser` method is handy in scenarios where you need a highly customized Create Account user experience or when you need to programmatically create new user accounts through an alternative interface.</span></span> <span data-ttu-id="66858-288">たとえば、ユーザーが他のアプリケーションからのユーザー情報を含む XML ファイルをアップロードできるページがあるとします。</span><span class="sxs-lookup"><span data-stu-id="66858-288">For example, you might have a page that allows a user to upload an XML file that contains user information from some other application.</span></span> <span data-ttu-id="66858-289">このページでは、アップロードされた XML ファイルの内容を解析し、`CreateUser` メソッドを呼び出すことによって、XML で表されるユーザーごとに新しいアカウントを作成できます。</span><span class="sxs-lookup"><span data-stu-id="66858-289">The page might parses the contents of the uploaded XML file and create a new account for each user represented in the XML by calling the `CreateUser` method.</span></span>

## <a name="step-6-creating-a-new-user-with-the-createuserwizard-control"></a><span data-ttu-id="66858-290">手順 6:CreateUserWizard コントロールを使用して新しいユーザーを作成する</span><span class="sxs-lookup"><span data-stu-id="66858-290">Step 6: Creating a New User with the CreateUserWizard Control</span></span>

<span data-ttu-id="66858-291">ASP.NET には、多数のログイン Web コントロールが付属しています。</span><span class="sxs-lookup"><span data-stu-id="66858-291">ASP.NET ships with a number of Login Web controls.</span></span> <span data-ttu-id="66858-292">これらのコントロールは、多くの一般的なユーザーアカウントおよびログイン関連のシナリオに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="66858-292">These controls aid in many common user account- and login-related scenarios.</span></span> <span data-ttu-id="66858-293">[CreateUserWizard コントロール](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/createuserwizard.aspx)は、メンバーシップフレームワークに新しいユーザーアカウントを追加するためのユーザーインターフェイスを提供するように設計されたコントロールの1つです。</span><span class="sxs-lookup"><span data-stu-id="66858-293">The [CreateUserWizard control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/createuserwizard.aspx) is one such control that is designed to present a user interface for adding a new user account to the Membership framework.</span></span>

<span data-ttu-id="66858-294">他の多くのログイン関連 Web コントロールと同様に、1行のコードも記述せずに CreateUserWizard を使用できます。</span><span class="sxs-lookup"><span data-stu-id="66858-294">Like many of the other Login-related Web controls, the CreateUserWizard can be used without writing a single line of code.</span></span> <span data-ttu-id="66858-295">直感的には、メンバーシッププロバイダーの構成設定に基づいてユーザーインターフェイスを提供し、ユーザーが必要な情報を入力して [ユーザーの作成] ボタンをクリックした後に `Membership` クラスの `CreateUser` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="66858-295">It intuitively provides a user interface based on the Membership provider's configuration settings and internally calls the `Membership` class's `CreateUser` method after the user enters the necessary information and clicks the Create User button.</span></span> <span data-ttu-id="66858-296">CreateUserWizard コントロールは、非常にカスタマイズが可能です。</span><span class="sxs-lookup"><span data-stu-id="66858-296">The CreateUserWizard control is extremely customizable.</span></span> <span data-ttu-id="66858-297">アカウント作成プロセスのさまざまな段階で発生するイベントのホストがあります。</span><span class="sxs-lookup"><span data-stu-id="66858-297">There are a host of events that fire during various stages of the account creation process.</span></span> <span data-ttu-id="66858-298">必要に応じてイベントハンドラーを作成して、アカウント作成ワークフローにカスタムロジックを挿入できます。</span><span class="sxs-lookup"><span data-stu-id="66858-298">We can create event handlers, as needed, to inject custom logic into the account creation workflow.</span></span> <span data-ttu-id="66858-299">さらに、CreateUserWizard の外観は非常に柔軟です。</span><span class="sxs-lookup"><span data-stu-id="66858-299">Furthermore, the CreateUserWizard's appearance is very flexible.</span></span> <span data-ttu-id="66858-300">既定のインターフェイスの外観を定義するプロパティがいくつかあります。必要に応じて、コントロールをテンプレートに変換したり、追加のユーザー登録手順を追加したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="66858-300">There are a number of properties that define the appearance of the default interface; if necessary, the control can be converted into a template or additional user registration steps may be added.</span></span>

<span data-ttu-id="66858-301">まず、CreateUserWizard コントロールの既定のインターフェイスと動作の使用方法を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="66858-301">Let's start with a look at using the CreateUserWizard control's default interface and behavior.</span></span> <span data-ttu-id="66858-302">次に、コントロールのプロパティとイベントを使用して外観をカスタマイズする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="66858-302">We'll then explore how to customize the appearance via the control's properties and events.</span></span>

### <a name="examining-the-createuserwizards-default-interface-and-behavior"></a><span data-ttu-id="66858-303">CreateUserWizard の既定のインターフェイスと動作を調べる</span><span class="sxs-lookup"><span data-stu-id="66858-303">Examining the CreateUserWizard's Default Interface and Behavior</span></span>

<span data-ttu-id="66858-304">`Membership` フォルダーの [`CreatingUserAccounts.aspx`] ページに戻り、デザインモードまたは分割モードに切り替えて、ページの上部に CreateUserWizard コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="66858-304">Return to the `CreatingUserAccounts.aspx` page in the `Membership` folder, switch to the Design or Split mode, and then add a CreateUserWizard control to the top of the page.</span></span> <span data-ttu-id="66858-305">CreateUserWizard コントロールは、ツールボックスの [ログインコントロール] セクションに登録されています。</span><span class="sxs-lookup"><span data-stu-id="66858-305">The CreateUserWizard control is filed under the Toolbox's Login controls section.</span></span> <span data-ttu-id="66858-306">コントロールを追加した後、その `ID` プロパティを `RegisterUser`に設定します。</span><span class="sxs-lookup"><span data-stu-id="66858-306">After adding the control, set its `ID` property to `RegisterUser`.</span></span> <span data-ttu-id="66858-307">図11のスクリーンショットに示すように、CreateUserWizard は、新しいユーザーのユーザー名、パスワード、電子メールアドレス、およびセキュリティの質問と回答のテキストボックスを含むインターフェイスをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="66858-307">As the screen shot in Figure 11 shows, the CreateUserWizard renders an interface with textboxes for the new user's username, password, email address, and security question and answer.</span></span>

<span data-ttu-id="66858-308">[CreateUserWizard コントロールが汎用作成ユーザーインターフェイスをレンダリング ![](creating-user-accounts-vb/_static/image32.png)](creating-user-accounts-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="66858-308">[![The CreateUserWizard Control Renders a Generic Create User Interface](creating-user-accounts-vb/_static/image32.png)](creating-user-accounts-vb/_static/image31.png)</span></span>

<span data-ttu-id="66858-309">**図 11**:CreateUserWizard コントロールは、汎用の作成ユーザーインターフェイスを表示します ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image33.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-309">**Figure 11**: The CreateUserWizard Control Renders a Generic Create User Interface ([Click to view full-size image](creating-user-accounts-vb/_static/image33.png))</span></span>

<span data-ttu-id="66858-310">CreateUserWizard コントロールによって生成される既定のユーザーインターフェイスと、手順 5. で作成したインターフェイスを比較してみましょう。</span><span class="sxs-lookup"><span data-stu-id="66858-310">Let's take a moment to compare the default user interface generated by the CreateUserWizard control with the interface we created in Step 5.</span></span> <span data-ttu-id="66858-311">初心者は、CreateUserWizard コントロールを使用して、ビジターがセキュリティの質問と回答の両方を指定できるようになります。一方、手動で作成されたインターフェイスでは、事前に定義されたセキュリティの質問が使用されていました。</span><span class="sxs-lookup"><span data-stu-id="66858-311">For starters, the CreateUserWizard control allows the visitor to specify both the security question and answer, whereas our manually-created interface used a pre-defined security question.</span></span> <span data-ttu-id="66858-312">CreateUserWizard コントロールのインターフェイスには検証コントロールも含まれていますが、インターフェイスのフォームフィールドに検証を実装しています。</span><span class="sxs-lookup"><span data-stu-id="66858-312">The CreateUserWizard control's interface also includes validation controls, whereas we had yet to implement validation on our interface's form fields.</span></span> <span data-ttu-id="66858-313">また、CreateUserWizard コントロールインターフェイスには、[パスワードの確認入力] テキストボックスと [パスワードの比較] ボックスが同じであることを確認するための CompareValidator が含まれています。</span><span class="sxs-lookup"><span data-stu-id="66858-313">And the CreateUserWizard control interface includes a Confirm Password textbox (along with a CompareValidator to ensure that the text entered the Password and Compare Password textboxes are equal).</span></span>

<span data-ttu-id="66858-314">興味深いのは、CreateUserWizard コントロールは、ユーザーインターフェイスをレンダリングするときに、メンバーシッププロバイダーの構成設定を調べることです。</span><span class="sxs-lookup"><span data-stu-id="66858-314">What's interesting is that the CreateUserWizard control consults the Membership provider's configuration settings when rendering its user interface.</span></span> <span data-ttu-id="66858-315">たとえば、セキュリティの質問と回答のテキストボックスは、`requiresQuestionAndAnswer` が True に設定されている場合にのみ表示されます。</span><span class="sxs-lookup"><span data-stu-id="66858-315">For example, the security question and answer textboxes are only displayed if `requiresQuestionAndAnswer` is set to True.</span></span> <span data-ttu-id="66858-316">同様に、CreateUserWizard は RegularExpressionValidator コントロールを自動的に追加して、パスワードの強度の要件が満たされていることを確認し、`minRequiredPasswordLength`、`minRequiredNonalphanumericCharacters`、および `passwordStrengthRegularExpression` の構成設定に基づいて、`ErrorMessage` と `ValidationExpression` のプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="66858-316">Likewise, CreateUserWizard automatically adds a RegularExpressionValidator control to ensure that the password strength requirements are met, and sets its `ErrorMessage` and `ValidationExpression` properties based on the `minRequiredPasswordLength`, `minRequiredNonalphanumericCharacters`, and `passwordStrengthRegularExpression` configuration settings.</span></span>

<span data-ttu-id="66858-317">CreateUserWizard コントロールは、その名前が示すように、[ウィザードコントロール](https://msdn.microsoft.com/library/s2etd1ek.aspx)から派生します。</span><span class="sxs-lookup"><span data-stu-id="66858-317">The CreateUserWizard control, as its name implies, is derived from the [Wizard control](https://msdn.microsoft.com/library/s2etd1ek.aspx).</span></span> <span data-ttu-id="66858-318">ウィザードコントロールは、複数ステップのタスクを完了するためのインターフェイスを提供するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="66858-318">Wizard controls are designed to provide an interface for completing multi-step tasks.</span></span> <span data-ttu-id="66858-319">ウィザードコントロールには、任意の数の `WizardSteps`を含めることができます。各テンプレートは、その手順の HTML コントロールと Web コントロールを定義するテンプレートです。</span><span class="sxs-lookup"><span data-stu-id="66858-319">A Wizard control may have an arbitrary number of `WizardSteps`, each of which is a template that defines the HTML and Web controls for that step.</span></span> <span data-ttu-id="66858-320">ウィザードコントロールは、最初の `WizardStep`と、ユーザーが1つのステップから次のステップに進むことができるナビゲーションコントロール、または前の手順に戻ることを許可するナビゲーションコントロールを最初に表示します。</span><span class="sxs-lookup"><span data-stu-id="66858-320">The Wizard control initially displays the first `WizardStep`, along with navigation controls that permit the user to proceed from one step to the next, or to return to previous steps.</span></span>

<span data-ttu-id="66858-321">図11の宣言型マークアップが示すように、CreateUserWizard コントロールの既定のインターフェイスには2つの `WizardStep` が含まれています。</span><span class="sxs-lookup"><span data-stu-id="66858-321">As the declarative markup in Figure 11 shows, the CreateUserWizard control's default interface includes two `WizardStep` s:</span></span>

- <span data-ttu-id="66858-322">[`CreateUserWizardStep`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizardstep.aspx) ?</span><span class="sxs-lookup"><span data-stu-id="66858-322">[`CreateUserWizardStep`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizardstep.aspx) ?</span></span> <span data-ttu-id="66858-323">新しいユーザーアカウントを作成するための情報を収集するためのインターフェイスをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="66858-323">renders the interface to collect information for creating the new user account.</span></span> <span data-ttu-id="66858-324">これは、図11に示す手順です。</span><span class="sxs-lookup"><span data-stu-id="66858-324">This is the step shown in Figure 11.</span></span>
- <span data-ttu-id="66858-325">[`CompleteWizardStep`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.completewizardstep.aspx) ?</span><span class="sxs-lookup"><span data-stu-id="66858-325">[`CompleteWizardStep`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.completewizardstep.aspx) ?</span></span> <span data-ttu-id="66858-326">アカウントが正常に作成されたことを示すメッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="66858-326">renders a message indicating that the account has successfully been created.</span></span>

<span data-ttu-id="66858-327">CreateUserWizard の外観と動作は、これらの手順のいずれかをテンプレートに変換するか、独自の `WizardStep` を追加することによって変更できます。</span><span class="sxs-lookup"><span data-stu-id="66858-327">The CreateUserWizard's appearance and behavior can be modified by converting either of these steps to templates, or by adding your own `WizardStep` s.</span></span> <span data-ttu-id="66858-328">*追加のユーザー情報を格納*するチュートリアルでは、登録インターフェイスに `WizardStep` を追加する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="66858-328">We will look at adding a `WizardStep` to the registration interface in the *Storing Additional User Information* tutorial.</span></span>

<span data-ttu-id="66858-329">CreateUserWizard コントロールの動作を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="66858-329">Let's see the CreateUserWizard control in action.</span></span> <span data-ttu-id="66858-330">ブラウザーを使用して `CreatingUserAccounts.aspx` のページにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="66858-330">Visit the `CreatingUserAccounts.aspx` page through a browser.</span></span> <span data-ttu-id="66858-331">まず、CreateUserWizard のインターフェイスに無効な値を入力します。</span><span class="sxs-lookup"><span data-stu-id="66858-331">Start by entering some invalid values into the CreateUserWizard's interface.</span></span> <span data-ttu-id="66858-332">パスワードの強度の要件に準拠していないパスワードを入力するか、[ユーザー名] ボックスを空のままにしてください。</span><span class="sxs-lookup"><span data-stu-id="66858-332">Try entering a password that doesn't conform to the password strength requirements, or leaving the User Name textbox empty.</span></span> <span data-ttu-id="66858-333">CreateUserWizard に、適切なエラーメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="66858-333">The CreateUserWizard will display an appropriate error message.</span></span> <span data-ttu-id="66858-334">図12は、強力なパスワードを使用してユーザーを作成しようとした場合の出力を示しています。</span><span class="sxs-lookup"><span data-stu-id="66858-334">Figure 12 shows the output when attempting to create a user with an insufficiently strong password.</span></span>

<span data-ttu-id="66858-335">[CreateUserWizard が検証コントロールを自動的に挿入する ![](creating-user-accounts-vb/_static/image35.png)](creating-user-accounts-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="66858-335">[![The CreateUserWizard Automatically Injects Validation Controls](creating-user-accounts-vb/_static/image35.png)](creating-user-accounts-vb/_static/image34.png)</span></span>

<span data-ttu-id="66858-336">**図 12**:CreateUserWizard は、自動的に検証コントロールを挿入します ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image36.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-336">**Figure 12**: The CreateUserWizard Automatically Injects Validation Controls ([Click to view full-size image](creating-user-accounts-vb/_static/image36.png))</span></span>

<span data-ttu-id="66858-337">次に、CreateUserWizard に適切な値を入力し、[ユーザーの作成] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="66858-337">Next, enter appropriate values into the CreateUserWizard and click the Create User button.</span></span> <span data-ttu-id="66858-338">必須フィールドが入力され、パスワードの強度が十分であると仮定すると、CreateUserWizard はメンバーシップフレームワークを使用して新しいユーザーアカウントを作成し、`CompleteWizardStep`のインターフェイスを表示します (図13を参照)。</span><span class="sxs-lookup"><span data-stu-id="66858-338">Assuming the required fields have been entered and the password's strength is sufficient, the CreateUserWizard will create a new user account through the Membership framework and then display the `CompleteWizardStep`'s interface (see Figure 13).</span></span> <span data-ttu-id="66858-339">CreateUserWizard は、バックグラウンドで、手順5で行ったのと同じように `Membership.CreateUser` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="66858-339">Behind the scenes, the CreateUserWizard calls the `Membership.CreateUser` method, just like we did in Step 5.</span></span>

<span data-ttu-id="66858-340">[新しいユーザーアカウントが正常に作成された ![](creating-user-accounts-vb/_static/image38.png)](creating-user-accounts-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="66858-340">[![A New User Account has Successfully Been Created](creating-user-accounts-vb/_static/image38.png)](creating-user-accounts-vb/_static/image37.png)</span></span>

<span data-ttu-id="66858-341">**図 13**:新しいユーザーアカウントが正常に作成されました ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image39.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-341">**Figure 13**: A New User Account has Successfully Been Created ([Click to view full-size image](creating-user-accounts-vb/_static/image39.png))</span></span>

> [!NOTE]
> <span data-ttu-id="66858-342">図13に示すように、`CompleteWizardStep`のインターフェイスには [続行] ボタンがあります。</span><span class="sxs-lookup"><span data-stu-id="66858-342">As Figure 13 shows, the `CompleteWizardStep`'s interface includes a Continue button.</span></span> <span data-ttu-id="66858-343">ただし、この時点でクリックするだけでポストバックが実行され、ビジターは同じページに残ります。</span><span class="sxs-lookup"><span data-stu-id="66858-343">However, at this point clicking it just performs a postback, leaving the visitor on the same page.</span></span> <span data-ttu-id="66858-344">「CreateUserWizard の外観と動作をカスタマイズする」セクションでは、このボタンを使用して訪問者を `Default.aspx` (またはその他のページ) に送信する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="66858-344">In the Customizing the CreateUserWizard's Appearance and Behavior Through Its Properties section we will look at how you can have this button send the visitor to `Default.aspx` (or some other page).</span></span>

<span data-ttu-id="66858-345">新しいユーザーアカウントを作成した後、Visual Studio に戻り、図10のような `aspnet_Users` と `aspnet_Membership` のテーブルを調べて、アカウントが正常に作成されたことを確認します。</span><span class="sxs-lookup"><span data-stu-id="66858-345">After creating a new user account, return to Visual Studio and examine the `aspnet_Users` and `aspnet_Membership` tables like we did in Figure 10 to verify that the account was successfully created.</span></span>

### <a name="customizing-the-createuserwizards-behavior-and-appearance-through-its-properties"></a><span data-ttu-id="66858-346">プロパティを使用して CreateUserWizard の動作と外観をカスタマイズする</span><span class="sxs-lookup"><span data-stu-id="66858-346">Customizing the CreateUserWizard's Behavior and Appearance Through Its Properties</span></span>

<span data-ttu-id="66858-347">CreateUserWizard は、プロパティ、`WizardStep` s、イベントハンドラーなど、さまざまな方法でカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="66858-347">The CreateUserWizard can be customized in a variety of ways, through properties, `WizardStep` s, and event handlers.</span></span> <span data-ttu-id="66858-348">このセクションでは、プロパティを使用してコントロールの外観をカスタマイズする方法について説明します。次のセクションでは、イベントハンドラーによってコントロールの動作を拡張する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="66858-348">In this section we will look at how to customize the control's appearance through its properties; the next section looks at extending the control's behavior through event handlers.</span></span>

<span data-ttu-id="66858-349">CreateUserWizard コントロールの既定のユーザーインターフェイスに表示されるテキストは、事実上、大量のプロパティを使用してカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="66858-349">Virtually all of the text displayed in the CreateUserWizard control's default user interface can be customized through its plethora of properties.</span></span> <span data-ttu-id="66858-350">たとえば、テキストボックスの左側に表示される [ユーザー名]、[パスワード]、[パスワードの確認]、[電子メール]、[セキュリティの質問]、および [セキュリティの回答] のラベルは、それぞれ[`UserNameLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.usernamelabeltext.aspx)、 [`PasswordLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.passwordlabeltext.aspx)、 [`ConfirmPasswordLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.confirmpasswordlabeltext.aspx)、 [`EmailLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.emaillabeltext.aspx)、 [`QuestionLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.questionlabeltext.aspx)、および[`AnswerLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.answerlabeltext.aspx)の各プロパティでカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="66858-350">For example, the User Name, Password, Confirm Password, E-mail, Security Question, and Security Answer labels displayed to the left of the textboxes can be customized by the [`UserNameLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.usernamelabeltext.aspx), [`PasswordLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.passwordlabeltext.aspx), [`ConfirmPasswordLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.confirmpasswordlabeltext.aspx), [`EmailLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.emaillabeltext.aspx), [`QuestionLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.questionlabeltext.aspx), and [`AnswerLabelText`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.answerlabeltext.aspx) properties, respectively.</span></span> <span data-ttu-id="66858-351">同様に、`CreateUserWizardStep` と `CompleteWizardStep`で [ユーザーの作成] および [続行] ボタンのテキストを指定するためのプロパティと、これらのボタンがボタン、リンクボタン、または ImageButtons として表示されるかどうかも指定されています。</span><span class="sxs-lookup"><span data-stu-id="66858-351">Likewise, there are properties for specifying the text for the Create User and Continue buttons in the `CreateUserWizardStep` and `CompleteWizardStep`, as well as if these buttons are rendered as Buttons, LinkButtons, or ImageButtons.</span></span>

<span data-ttu-id="66858-352">色、罫線、フォント、およびその他のビジュアル要素は、スタイルプロパティのホストを使用して構成できます。</span><span class="sxs-lookup"><span data-stu-id="66858-352">The colors, borders, fonts, and other visual elements are configurable through a host of style properties.</span></span> <span data-ttu-id="66858-353">CreateUserWizard コントロール自体には、一般的な Web コントロールスタイルプロパティ (`BackColor`、`BorderStyle`、`CssClass`、`Font`など) があります。また、CreateUserWizard のインターフェイスの特定のセクションの外観を定義するためのスタイルプロパティがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="66858-353">The CreateUserWizard control itself has the common Web control style properties - `BackColor`, `BorderStyle`, `CssClass`, `Font`, and so on - and there are a number of style properties for defining the appearance for particular sections of the CreateUserWizard's interface.</span></span> <span data-ttu-id="66858-354">たとえば、 [`TextBoxStyle` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.textboxstyle.aspx)は `CreateUserWizardStep`内のテキストボックスのスタイルを定義し、 [`TitleTextStyle` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.titletextstyle.aspx)はタイトルのスタイルを定義します (新しいアカウントにサインアップします)。</span><span class="sxs-lookup"><span data-stu-id="66858-354">The [`TextBoxStyle` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.textboxstyle.aspx), for instance, defines the styles for the textboxes in the `CreateUserWizardStep`, while the [`TitleTextStyle` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.titletextstyle.aspx) defines the style for the title ( Sign Up for Your New Account ).</span></span>

<span data-ttu-id="66858-355">外観に関連するプロパティに加えて、CreateUserWizard コントロールの動作に影響を与えるプロパティがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="66858-355">In addition to the appearance-related properties, there are a number of properties that affect the CreateUserWizard control's behavior.</span></span> <span data-ttu-id="66858-356">[ `DisplayCancelButton`プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.displaycancelbutton.aspx)場合、true の場合、表示する (既定値は False)、ユーザーの作成ボタンの横の [キャンセル] ボタンを設定します。</span><span class="sxs-lookup"><span data-stu-id="66858-356">The [`DisplayCancelButton` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.displaycancelbutton.aspx), if set to True, displays a Cancel button next to the Create User button (the default value is False).</span></span> <span data-ttu-id="66858-357">[キャンセル] ボタンを表示する場合は、[キャンセル] をクリックした後にユーザーが送信されるページを指定する[`CancelDestinationPageUrl` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx)も設定してください。</span><span class="sxs-lookup"><span data-stu-id="66858-357">If you display the Cancel button, be sure to also set the [`CancelDestinationPageUrl` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx), which specifies the page the user is sent to after clicking Cancel.</span></span> <span data-ttu-id="66858-358">前のセクションで説明したように、`CompleteWizardStep`のインターフェイスの [続行] ボタンをクリックするとポストバックが発生しますが、ビジターは同じページに残ります。</span><span class="sxs-lookup"><span data-stu-id="66858-358">As noted in the previous section, the Continue button in the `CompleteWizardStep`'s interface causes a postback, but leaves the visitor on the same page.</span></span> <span data-ttu-id="66858-359">[続行] ボタンをクリックした後に他のページにビジターを送信するには、 [`ContinueDestinationPageUrl` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx)で URL を指定するだけです。</span><span class="sxs-lookup"><span data-stu-id="66858-359">To send the visitor to some other page after clicking the Continue button, simply specify the URL in the [`ContinueDestinationPageUrl` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span></span>

<span data-ttu-id="66858-360">[キャンセル] ボタンまたは [続行] ボタンがクリックされたときに `Default.aspx` を表示するように `RegisterUser` CreateUserWizard コントロールを更新してみましょう。</span><span class="sxs-lookup"><span data-stu-id="66858-360">Let's update the `RegisterUser` CreateUserWizard control to show a Cancel button and to send the visitor to `Default.aspx` when the Cancel or Continue buttons are clicked.</span></span> <span data-ttu-id="66858-361">これを行うには、`DisplayCancelButton` プロパティを True に設定し、`CancelDestinationPageUrl` と `ContinueDestinationPageUrl` の両方のプロパティを ~/Default. aspxに設定します。</span><span class="sxs-lookup"><span data-stu-id="66858-361">To accomplish this, set the `DisplayCancelButton` property to True and both the `CancelDestinationPageUrl` and `ContinueDestinationPageUrl` properties to ~/Default.aspx.</span></span> <span data-ttu-id="66858-362">図14に、ブラウザーで表示したときの更新された CreateUserWizard を示します。</span><span class="sxs-lookup"><span data-stu-id="66858-362">Figure 14 shows the updated CreateUserWizard when viewed through a browser.</span></span>

<span data-ttu-id="66858-363">[Createuserwizardstep.contenttemplate はに [キャンセル] ボタンが含まれている ![](creating-user-accounts-vb/_static/image41.png)](creating-user-accounts-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="66858-363">[![The CreateUserWizardStep Includes a Cancel Button](creating-user-accounts-vb/_static/image41.png)](creating-user-accounts-vb/_static/image40.png)</span></span>

<span data-ttu-id="66858-364">**図 14**:`CreateUserWizardStep` には [キャンセル] ボタンが含まれています ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image42.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-364">**Figure 14**: The `CreateUserWizardStep` Includes a Cancel Button ([Click to view full-size image](creating-user-accounts-vb/_static/image42.png))</span></span>

<span data-ttu-id="66858-365">ビジターがユーザー名、パスワード、電子メールアドレス、およびセキュリティの質問と回答を入力し、[ユーザーの作成] をクリックすると、新しいユーザーアカウントが作成され、そのユーザーが新しく作成したユーザーとしてログインします。</span><span class="sxs-lookup"><span data-stu-id="66858-365">When a visitor enters a username, password, email address, and security question and answer and clicks Create User, a new user account is created and the visitor is logged in as that newly created user.</span></span> <span data-ttu-id="66858-366">ページにアクセスしているユーザーが自分用の新しいアカウントを作成していると仮定した場合、これは望ましい動作です。</span><span class="sxs-lookup"><span data-stu-id="66858-366">Assuming that the person visiting the page is creating a new account for themselves, this is likely the desired behavior.</span></span> <span data-ttu-id="66858-367">ただし、管理者が新しいユーザーアカウントを追加できるようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="66858-367">However, you may want to allow Administrators to add new user accounts.</span></span> <span data-ttu-id="66858-368">これにより、ユーザーアカウントが作成されますが、管理者は管理者としてログインしたままになります (新しく作成されたアカウントとしてではありません)。</span><span class="sxs-lookup"><span data-stu-id="66858-368">In doing so, the user account would be created, but the Administrator would remain logged in as an Administrator (and not as the newly created account).</span></span> <span data-ttu-id="66858-369">この動作は、ブール値の[`LoginCreatedUser` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx)を使用して変更できます。</span><span class="sxs-lookup"><span data-stu-id="66858-369">This behavior can be modified through the Boolean [`LoginCreatedUser` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).</span></span>

<span data-ttu-id="66858-370">メンバーシップフレームワークのユーザーアカウントには、承認済みフラグが含まれています。承認されていないユーザーは、サイトにログインできません。</span><span class="sxs-lookup"><span data-stu-id="66858-370">User accounts in the Membership framework contain an approved flag; users who are not approved are unable to log into the site.</span></span> <span data-ttu-id="66858-371">既定では、新しく作成されたアカウントは承認済みとしてマークされ、ユーザーはすぐにサイトにログインできます。</span><span class="sxs-lookup"><span data-stu-id="66858-371">By default, a newly created account is marked as approved, allowing the user to log into the site immediately.</span></span> <span data-ttu-id="66858-372">ただし、新しいユーザーアカウントを未承認としてマークすることもできます。</span><span class="sxs-lookup"><span data-stu-id="66858-372">It is possible, however, to have new user accounts marked as unapproved.</span></span> <span data-ttu-id="66858-373">場合によっては、ログインする前に、管理者が手動で新しいユーザーを承認しなければならないことがあります。または、サインアップ時に入力した電子メールアドレスが有効であることを確認してから、ユーザーにログオンを許可することもできます。</span><span class="sxs-lookup"><span data-stu-id="66858-373">Perhaps you want an Administrator to manually approve new users before they can log in; or maybe you want to verify that the email address entered at signup is valid before permitting a user to log on.</span></span> <span data-ttu-id="66858-374">どのような場合でも、CreateUserWizard コントロールの[`DisableCreatedUser` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx)を True (既定値は False) に設定することで、新しく作成されたユーザーアカウントを未承認としてマークすることができます。</span><span class="sxs-lookup"><span data-stu-id="66858-374">Whatever the case may be, you can have the newly created user account marked as unapproved by setting the CreateUserWizard control's [`DisableCreatedUser` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx) to True (the default is False).</span></span>

<span data-ttu-id="66858-375">その他の動作関連のプロパティには、`AutoGeneratePassword` および `MailDefinition`が含まれます。</span><span class="sxs-lookup"><span data-stu-id="66858-375">Other behavior-related properties of note include `AutoGeneratePassword` and `MailDefinition`.</span></span> <span data-ttu-id="66858-376">場合、 [ `AutoGeneratePassword`プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.autogeneratepassword.aspx)を True に設定されている、`CreateUserWizardStep`パスワードとパスワードの確認テキスト ボックスで; には表示されません代わりに、新しく作成したユーザーのパスワードが自動的に生成を使用して、 `Membership`クラスの[`GeneratePassword`メソッド](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="66858-376">If the [`AutoGeneratePassword` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.autogeneratepassword.aspx) is set to True, the `CreateUserWizardStep` does not display the Password and Confirm Password textboxes; instead, the newly-created user's password is automatically generated using the `Membership` class's [`GeneratePassword` method](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="66858-377">`GeneratePassword` メソッドは、指定された長さのパスワードを作成し、構成されているパスワード強度要件を満たすのに十分な数の英数字以外の文字を作成します。</span><span class="sxs-lookup"><span data-stu-id="66858-377">The `GeneratePassword` method constructs a password of a specified length and with a sufficient number of non-alphanumeric characters to satisfy the configured password strength requirements.</span></span>

<span data-ttu-id="66858-378">[`MailDefinition` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx)は、アカウントの作成処理中に指定された電子メールアドレスに電子メールを送信する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="66858-378">The [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) is useful if you want to send an email to the email address specified during the account creation process.</span></span> <span data-ttu-id="66858-379">`MailDefinition` プロパティには、構築された電子メールメッセージに関する情報を定義するための一連のサブプロパティが含まれています。</span><span class="sxs-lookup"><span data-stu-id="66858-379">The `MailDefinition` property includes a series of subproperties for defining information about the constructed email message.</span></span> <span data-ttu-id="66858-380">これらのサブプロパティには、`Subject`、`Priority`、`IsBodyHtml`、`From`、`CC`、`BodyFileName`などのオプションが含まれます。</span><span class="sxs-lookup"><span data-stu-id="66858-380">These subproperties include options like `Subject`, `Priority`, `IsBodyHtml`, `From`, `CC`, and `BodyFileName`.</span></span> <span data-ttu-id="66858-381">[`BodyFileName` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx)は、電子メールメッセージの本文を含むテキストまたは HTML ファイルを指します。</span><span class="sxs-lookup"><span data-stu-id="66858-381">The [`BodyFileName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) points to a text or HTML file that contains the body for the email message.</span></span> <span data-ttu-id="66858-382">本文は、`<%UserName%>` と `<%Password%>`の2つの定義済みプレースホルダーをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="66858-382">The body supports two pre-defined placeholders: `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="66858-383">これらのプレースホルダーは、`BodyFileName` ファイルに存在する場合は、作成されたユーザーの名前とパスワードに置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="66858-383">These placeholders, if present in the `BodyFileName` file, will be replaced with the just-created user's name and password.</span></span>

> [!NOTE]
> <span data-ttu-id="66858-384">`CreateUserWizard` コントロールの `MailDefinition` プロパティは、新しいアカウントが作成されたときに送信される電子メールメッセージの詳細を指定するだけです。</span><span class="sxs-lookup"><span data-stu-id="66858-384">The `CreateUserWizard` control's `MailDefinition` property just specifies details about the email message that is sent when a new account is created.</span></span> <span data-ttu-id="66858-385">これには、電子メールメッセージの実際の送信方法 (SMTP サーバーまたはメールドロップディレクトリが使用されているかどうか、認証情報など) に関する詳細は含まれません。</span><span class="sxs-lookup"><span data-stu-id="66858-385">It does not include any details on how the email message is actually sent (that is, whether an SMTP server or mail drop directory is used, any authentication information, and so on).</span></span> <span data-ttu-id="66858-386">これらの低レベルの詳細は、`Web.config`の `<system.net>` セクションで定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-386">These low-level details need to be defined in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="66858-387">これらの構成設定の詳細および ASP.NET 2.0 からの電子メールの送信の詳細については、 [SystemNetMail.com](http://www.systemnetmail.com/)と my の記事「 [ASP.NET 2.0 で電子メールを送信](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="66858-387">For more information on these configuration settings and on sending email from ASP.NET 2.0 in general, refer to the [FAQs at SystemNetMail.com](http://www.systemnetmail.com/) and my article, [Sending Email in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).</span></span>

### <a name="extending-the-createuserwizards-behavior-using-event-handlers"></a><span data-ttu-id="66858-388">イベントハンドラーを使用した CreateUserWizard の動作の拡張</span><span class="sxs-lookup"><span data-stu-id="66858-388">Extending the CreateUserWizard's Behavior Using Event Handlers</span></span>

<span data-ttu-id="66858-389">CreateUserWizard コントロールは、ワークフローの実行中に多数のイベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="66858-389">The CreateUserWizard control raises a number of events during its workflow.</span></span> <span data-ttu-id="66858-390">たとえば、ビジターがユーザー名、パスワード、およびその他の関連情報を入力し、[Create User] ボタンをクリックすると、CreateUserWizard コントロールによって[`CreatingUser` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx)が発生します。</span><span class="sxs-lookup"><span data-stu-id="66858-390">For example, after a visitor enters their username, password, and other pertinent information and clicks the Create User button, the CreateUserWizard control raises its [`CreatingUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span></span> <span data-ttu-id="66858-391">作成プロセス中に問題が発生した場合は、 [`CreateUserError` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx)が発生します。ただし、ユーザーが正常に作成された場合は、 [`CreatedUser` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx)が発生します。</span><span class="sxs-lookup"><span data-stu-id="66858-391">If there is a problem during the create process, the [`CreateUserError` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) is fired; however, if the user is successfully created, then the [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) is raised.</span></span> <span data-ttu-id="66858-392">CreateUserWizard コントロールイベントが発生することがありますが、これらは3つの最も連動があります。</span><span class="sxs-lookup"><span data-stu-id="66858-392">There are additional CreateUserWizard control events that get raised, but these are the three most germane ones.</span></span>

<span data-ttu-id="66858-393">特定のシナリオでは、CreateUserWizard ワークフローを使用することもできます。これは、適切なイベントのイベントハンドラーを作成することによって行うことができます。</span><span class="sxs-lookup"><span data-stu-id="66858-393">In certain scenarios we may want to tap into the CreateUserWizard workflow, which we can do by creating an event handler for the appropriate event.</span></span> <span data-ttu-id="66858-394">これを説明するために、ユーザー名とパスワードにカスタム検証を含めるように `RegisterUser` CreateUserWizard コントロールを強化しましょう。</span><span class="sxs-lookup"><span data-stu-id="66858-394">To illustrate this, let's enhance the `RegisterUser` CreateUserWizard control to include some custom validation on the username and password.</span></span> <span data-ttu-id="66858-395">特に、CreateUserWizard を拡張して、ユーザー名に先頭または末尾のスペースを含めることはできず、ユーザー名はパスワード内の任意の場所に置くことができません。</span><span class="sxs-lookup"><span data-stu-id="66858-395">In particular, let's enhance our CreateUserWizard so that usernames cannot contain leading or trailing spaces and the username cannot appear anywhere in the password.</span></span> <span data-ttu-id="66858-396">簡潔に言えば、"Scott" のようなユーザー名を作成したり、Scott や Scott. 1234 などのユーザー名とパスワードの組み合わせを作成したりできないようにしたいと考えています。</span><span class="sxs-lookup"><span data-stu-id="66858-396">In short, we want to prevent someone from creating a username like "Scott ", or having a username/password combination like Scott and Scott.1234 .</span></span>

<span data-ttu-id="66858-397">これを実現するには、追加の検証チェックを実行するために、`CreatingUser` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="66858-397">To accomplish this we will create an event handler for the `CreatingUser` event to perform our extra validation checks.</span></span> <span data-ttu-id="66858-398">指定されたデータが有効でない場合は、作成プロセスを取り消す必要があります。</span><span class="sxs-lookup"><span data-stu-id="66858-398">If the supplied data is not valid we need to cancel the creation process.</span></span> <span data-ttu-id="66858-399">また、ラベル Web コントロールをページに追加して、ユーザー名またはパスワードが無効であることを示すメッセージを表示する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="66858-399">We also need to add a Label Web control to the page to display a message explaining that the username or password is invalid.</span></span> <span data-ttu-id="66858-400">まず、CreateUserWizard コントロールの下にラベルコントロールを追加し、その `ID` プロパティを `InvalidUserNameOrPasswordMessage` に設定し、その `ForeColor` プロパティを `Red`に設定します。</span><span class="sxs-lookup"><span data-stu-id="66858-400">Start by adding a Label control beneath the CreateUserWizard control, setting its `ID` property to `InvalidUserNameOrPasswordMessage` and its `ForeColor` property to `Red`.</span></span> <span data-ttu-id="66858-401">`Text` プロパティをオフにし、その `EnableViewState` と `Visible` プロパティを False に設定します。</span><span class="sxs-lookup"><span data-stu-id="66858-401">Clear out its `Text` property and set its `EnableViewState` and `Visible` properties to False.</span></span>

[!code-aspx[Main](creating-user-accounts-vb/samples/sample7.aspx)]

<span data-ttu-id="66858-402">次に、CreateUserWizard コントロールの `CreatingUser` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="66858-402">Next, create an event handler for the CreateUserWizard control's `CreatingUser` event.</span></span> <span data-ttu-id="66858-403">イベントハンドラーを作成するには、デザイナーでコントロールを選択し、プロパティウィンドウにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="66858-403">To create an event handler, select the control in the Designer and then go to the Properties window.</span></span> <span data-ttu-id="66858-404">そこから、稲妻のアイコンをクリックし、該当するイベントをダブルクリックしてイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="66858-404">From there, click on the lightning bolt icon and then double-click the appropriate event to create the event handler.</span></span>

<span data-ttu-id="66858-405">`CreatingUser` イベント ハンドラーに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="66858-405">Add the following code to the `CreatingUser` event handler:</span></span>

[!code-vb[Main](creating-user-accounts-vb/samples/sample8.vb)]

<span data-ttu-id="66858-406">CreateUserWizard コントロールに入力したユーザー名とパスワードは、それぞれ[`UserName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx)と[`Password` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.password.aspx)で使用できます。</span><span class="sxs-lookup"><span data-stu-id="66858-406">Note that the username and password entered into the CreateUserWizard control are available through its [`UserName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx) and [`Password` properties](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.password.aspx), respectively.</span></span> <span data-ttu-id="66858-407">上記のイベントハンドラーでこれらのプロパティを使用して、指定したユーザー名に先頭または末尾のスペースが含まれているかどうか、およびユーザー名がパスワード内にあるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="66858-407">We use these properties in the above event handler to determine whether the supplied username contains leading or trailing spaces and whether the username is found within the password.</span></span> <span data-ttu-id="66858-408">これらのいずれかの条件が満たされると、エラーメッセージが `InvalidUserNameOrPasswordMessage` ラベルに表示され、イベントハンドラーの `e.Cancel` プロパティが `True`に設定されます。</span><span class="sxs-lookup"><span data-stu-id="66858-408">If either of these conditions is met, an error message is displayed in the `InvalidUserNameOrPasswordMessage` Label and the event handler's `e.Cancel` property is set to `True`.</span></span> <span data-ttu-id="66858-409">`e.Cancel` が `True`に設定されている場合、CreateUserWizard はそのワークフローをショートサーキットし、ユーザーアカウントの作成プロセスを効果的に取り消します。</span><span class="sxs-lookup"><span data-stu-id="66858-409">If `e.Cancel` is set to `True`, the CreateUserWizard short-circuits its workflow, effectively cancelling the user account creation process.</span></span>

<span data-ttu-id="66858-410">図15は、ユーザーが先頭のスペースを持つユーザー名を入力したときに `CreatingUserAccounts.aspx` のスクリーンショットを示しています。</span><span class="sxs-lookup"><span data-stu-id="66858-410">Figure 15 shows a screen shot of `CreatingUserAccounts.aspx` when the user enters a username with leading spaces.</span></span>

<span data-ttu-id="66858-411">[先頭または末尾にスペースが含まれているユーザー名は使用できません ![](creating-user-accounts-vb/_static/image44.png)](creating-user-accounts-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="66858-411">[![Usernames with Leading or Trailing Spaces are not Permitted](creating-user-accounts-vb/_static/image44.png)](creating-user-accounts-vb/_static/image43.png)</span></span>

<span data-ttu-id="66858-412">**図 15**:先頭または末尾にスペースが含まれているユーザー名は使用できません ([クリックすると、フルサイズの画像が表示](creating-user-accounts-vb/_static/image45.png)されます)</span><span class="sxs-lookup"><span data-stu-id="66858-412">**Figure 15**: Usernames with Leading or Trailing Spaces are not Permitted ([Click to view full-size image](creating-user-accounts-vb/_static/image45.png))</span></span>

> [!NOTE]
> <span data-ttu-id="66858-413">CreateUserWizard コントロールの `CreatedUser` イベントを使用する例については、 *<a id="_msoanchor_11"></a>[「追加のユーザー情報の格納](storing-additional-user-information-vb.md)* 」のチュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="66858-413">We will see an example of using the CreateUserWizard control's `CreatedUser` event in the *<a id="_msoanchor_11"></a>[Storing Additional User Information](storing-additional-user-information-vb.md)* tutorial.</span></span>

## <a name="summary"></a><span data-ttu-id="66858-414">まとめ</span><span class="sxs-lookup"><span data-stu-id="66858-414">Summary</span></span>

<span data-ttu-id="66858-415">`Membership` クラスの `CreateUser` メソッドによって、メンバーシップフレームワークに新しいユーザーアカウントが作成されます。</span><span class="sxs-lookup"><span data-stu-id="66858-415">The `Membership` class's `CreateUser` method creates a new user account in the Membership framework.</span></span> <span data-ttu-id="66858-416">これは、構成されたメンバーシッププロバイダーの呼び出しを委任することによって行われます。</span><span class="sxs-lookup"><span data-stu-id="66858-416">It does so by delegating the call to the configured Membership provider.</span></span> <span data-ttu-id="66858-417">`SqlMembershipProvider`の場合、`CreateUser` メソッドは `aspnet_Users` および `aspnet_Membership` データベーステーブルにレコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="66858-417">In the case of the `SqlMembershipProvider`, the `CreateUser` method adds a record to the `aspnet_Users` and `aspnet_Membership` database tables.</span></span>

<span data-ttu-id="66858-418">新しいユーザーアカウントはプログラムで作成できますが (手順 5. で説明したように)、CreateUserWizard コントロールを使用する方法がより高速で簡単です。</span><span class="sxs-lookup"><span data-stu-id="66858-418">While new user accounts can be created programmatically (as we saw in Step 5), a faster and easier approach is to use the CreateUserWizard control.</span></span> <span data-ttu-id="66858-419">このコントロールは、ユーザー情報を収集し、メンバーシップフレームワークで新しいユーザーを作成するための複数ステップのユーザーインターフェイスをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="66858-419">This control renders a multi-step user interface for collecting user information and creating a new user in the Membership framework.</span></span> <span data-ttu-id="66858-420">内部的には、このコントロールは手順 5. と同じ `Membership.CreateUser` メソッドを使用しますが、コントロールはユーザーインターフェイスと検証コントロールを作成し、ユーザーアカウントの作成エラーに応答します。コードを記述する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="66858-420">Underneath the covers, this control uses the same `Membership.CreateUser` method as examined in Step 5, but the control creates the user interface, validation controls, and responds to user account creation errors without having to write a lick of code.</span></span>

<span data-ttu-id="66858-421">この時点で、新しいユーザーアカウントを作成するための機能が用意されています。</span><span class="sxs-lookup"><span data-stu-id="66858-421">At this point we have the functionality in place to create new user accounts.</span></span> <span data-ttu-id="66858-422">ただし、ログインページでは、2番目のチュートリアルで指定したハードコーディングされた資格情報に対して検証が行われます。</span><span class="sxs-lookup"><span data-stu-id="66858-422">However, the login page still is validating against those hard-coded credentials we specified back in the second tutorial.</span></span> <span data-ttu-id="66858-423"><a id="_msoanchor_12"> </a>[次のチュートリアル](validating-user-credentials-against-the-membership-user-store-vb.md)では、メンバーシップフレームワークに対してユーザーが指定した資格情報を検証するために `Login.aspx` を更新します。</span><span class="sxs-lookup"><span data-stu-id="66858-423">In the <a id="_msoanchor_12"></a>[next tutorial](validating-user-credentials-against-the-membership-user-store-vb.md) we will update `Login.aspx` to validate the user's supplied credentials against the Membership framework.</span></span>

<span data-ttu-id="66858-424">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="66858-424">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="66858-425">関連項目</span><span class="sxs-lookup"><span data-stu-id="66858-425">Further Reading</span></span>

<span data-ttu-id="66858-426">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="66858-426">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="66858-427">`CreateUser` 技術ドキュメント</span><span class="sxs-lookup"><span data-stu-id="66858-427">`CreateUser` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.membershipprovider.createuser.aspx)
- [<span data-ttu-id="66858-428">CreateUserWizard コントロールの概要</span><span class="sxs-lookup"><span data-stu-id="66858-428">CreateUserWizard Control Overview</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/createuserwizard.aspx)
- [<span data-ttu-id="66858-429">ファイルシステムベースのサイトマッププロバイダーの作成</span><span class="sxs-lookup"><span data-stu-id="66858-429">Creating a File System-Based Site Map Provider</span></span>](http://aspnet.4guysfromrolla.com/articles/020106-1.aspx)
- [<span data-ttu-id="66858-430">ASP.NET 2.0 Wizard コントロールを使用したステップバイステップのユーザーインターフェイスの作成</span><span class="sxs-lookup"><span data-stu-id="66858-430">Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [<span data-ttu-id="66858-431">ASP.NET 2.0 のサイトナビゲーションを調べる</span><span class="sxs-lookup"><span data-stu-id="66858-431">Examining ASP.NET 2.0's Site Navigation</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)
- [<span data-ttu-id="66858-432">マスターページとサイトナビゲーション</span><span class="sxs-lookup"><span data-stu-id="66858-432">Master Pages and Site Navigation</span></span>](https://asp.net/learn/data-access/tutorial-03-vb.aspx)
- [<span data-ttu-id="66858-433">待機している SQL サイトマッププロバイダー</span><span class="sxs-lookup"><span data-stu-id="66858-433">The SQL Site Map Provider You've Been Waiting For</span></span>](https://msdn.microsoft.com/msdnmag/issues/06/02/WickedCode/default.aspx)

### <a name="about-the-author"></a><span data-ttu-id="66858-434">作成者について</span><span class="sxs-lookup"><span data-stu-id="66858-434">About the Author</span></span>

<span data-ttu-id="66858-435">1998以降、Microsoft の Web テクノロジを使用して、Scott Mitchell (複数の ASP/創設者4GuysFromRolla.com の執筆者) が Microsoft の Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="66858-435">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="66858-436">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="66858-436">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="66858-437">彼の最新の書籍は *[、ASP.NET 2.0 を24時間以内に教え](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* ています。</span><span class="sxs-lookup"><span data-stu-id="66858-437">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="66858-438">Scott は、 [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com)またはブログで[http://ScottOnWriting.NET](http://scottonwriting.net/)にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="66858-438">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="66858-439">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="66858-439">Special Thanks To</span></span>

<span data-ttu-id="66858-440">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="66858-440">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="66858-441">このチュートリアルのリードレビュー担当者は、Teresa Murphy でした。</span><span class="sxs-lookup"><span data-stu-id="66858-441">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="66858-442">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="66858-442">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="66858-443">その場合は、 [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com)の行を削除します。</span><span class="sxs-lookup"><span data-stu-id="66858-443">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="66858-444">[前へ](creating-the-membership-schema-in-sql-server-vb.md)
> [次へ](validating-user-credentials-against-the-membership-user-store-vb.md)</span><span class="sxs-lookup"><span data-stu-id="66858-444">[Previous](creating-the-membership-schema-in-sql-server-vb.md)
[Next](validating-user-credentials-against-the-membership-user-store-vb.md)</span></span>
