---
uid: web-forms/overview/moving-to-aspnet-20/data-source-controls
title: データソースコントロール |Microsoft Docs
author: microsoft
description: ASP.NET 1.x の DataGrid コントロールは、Web アプリケーションでのデータアクセスの大幅な向上をマークしました。 ただし、これはユーザーにとってわかりやすいということではありませんでした。
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 78fd0e92-f9c6-4e96-a5e9-0375b307a828
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-source-controls
msc.type: authoredcontent
ms.openlocfilehash: a2e2cfbec3e5aebf42a2de30bab7d45b4b610298
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78519352"
---
# <a name="data-source-controls"></a><span data-ttu-id="82e2d-104">データ ソース コントロール</span><span class="sxs-lookup"><span data-stu-id="82e2d-104">Data Source Controls</span></span>

<span data-ttu-id="82e2d-105">[Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="82e2d-105">by [Microsoft](https://github.com/microsoft)</span></span>

> <span data-ttu-id="82e2d-106">ASP.NET 1.x の DataGrid コントロールは、Web アプリケーションでのデータアクセスの大幅な向上をマークしました。</span><span class="sxs-lookup"><span data-stu-id="82e2d-106">The DataGrid control in ASP.NET 1.x marked a great improvement in data access in Web applications.</span></span> <span data-ttu-id="82e2d-107">ただし、これはユーザーにとってわかりやすいものではありませんでした。</span><span class="sxs-lookup"><span data-stu-id="82e2d-107">However, it wasn't as user-friendly as it could have been.</span></span> <span data-ttu-id="82e2d-108">それでも、はるかに便利な機能を取得するには、かなりの量のコードが必要です。</span><span class="sxs-lookup"><span data-stu-id="82e2d-108">It still required a considerable amount of code to obtain much useful functionality from it.</span></span> <span data-ttu-id="82e2d-109">このようなモデルは、すべてのデータアクセスにおける 1. x のモデルです。</span><span class="sxs-lookup"><span data-stu-id="82e2d-109">Such is the model in all data access endeavors in 1.x.</span></span>

<span data-ttu-id="82e2d-110">ASP.NET 1.x の DataGrid コントロールは、Web アプリケーションでのデータアクセスの大幅な向上をマークしました。</span><span class="sxs-lookup"><span data-stu-id="82e2d-110">The DataGrid control in ASP.NET 1.x marked a great improvement in data access in Web applications.</span></span> <span data-ttu-id="82e2d-111">ただし、これはユーザーにとってわかりやすいものではありませんでした。</span><span class="sxs-lookup"><span data-stu-id="82e2d-111">However, it wasn't as user-friendly as it could have been.</span></span> <span data-ttu-id="82e2d-112">それでも、はるかに便利な機能を取得するには、かなりの量のコードが必要です。</span><span class="sxs-lookup"><span data-stu-id="82e2d-112">It still required a considerable amount of code to obtain much useful functionality from it.</span></span> <span data-ttu-id="82e2d-113">このようなモデルは、すべてのデータアクセスにおける 1. x のモデルです。</span><span class="sxs-lookup"><span data-stu-id="82e2d-113">Such is the model in all data access endeavors in 1.x.</span></span>

<span data-ttu-id="82e2d-114">ASP.NET 2.0 では、データソースコントロールを使用して、これをで扱います。</span><span class="sxs-lookup"><span data-stu-id="82e2d-114">ASP.NET 2.0 addresses this with in part with data source controls.</span></span> <span data-ttu-id="82e2d-115">ASP.NET 2.0 のデータソースコントロールは、データの取得、データの表示、データの編集を行うための宣言型モデルを開発者に提供します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-115">The data source controls in ASP.NET 2.0 provide developers with a declarative model for retrieving data, displaying data, and editing data.</span></span> <span data-ttu-id="82e2d-116">データソースコントロールの目的は、データのソースに関係なく、データバインドコントロールに一貫性のあるデータ表現を提供することです。</span><span class="sxs-lookup"><span data-stu-id="82e2d-116">The purpose of data source controls is to provide a consistent representation of data to data-bound controls regardless of the source of those data.</span></span> <span data-ttu-id="82e2d-117">ASP.NET 2.0 のデータソースコントロールの中核となるのは、DataSourceControl 抽象クラスです。</span><span class="sxs-lookup"><span data-stu-id="82e2d-117">At the heart of the data source controls in ASP.NET 2.0 is the DataSourceControl abstract class.</span></span> <span data-ttu-id="82e2d-118">DataSourceControl クラスは、IDataSource インターフェイスと IListSource インターフェイスの基本実装を提供します。後者の場合は、新しい DataSourceId プロパティを使用して、データバインドコントロールの DataSource としてデータソースコントロールを割り当てることができます。後で説明します) と、そのデータをリストとして公開します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-118">The DataSourceControl class provides a base implementation of the IDataSource interface and the IListSource interface, the latter of which allows you to assign the data source control as the DataSource of a data-bound control (via the new DataSourceId property discussed later) and expose the data therein as a list.</span></span> <span data-ttu-id="82e2d-119">データソースコントロールのデータの各リストは、DataSourceView オブジェクトとして公開されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-119">Each list of data from a data source control is exposed as a DataSourceView object.</span></span> <span data-ttu-id="82e2d-120">DataSourceView インスタンスへのアクセスは、IDataSource インターフェイスによって提供されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-120">Access to the DataSourceView instances is provided by the IDataSource interface.</span></span> <span data-ttu-id="82e2d-121">たとえば、GetViewNames メソッドは、特定のデータソースコントロールに関連付けられている DataSourceViews を列挙できる ICollection を返します。また、GetView メソッドを使用すると、特定の DataSourceView インスタンスに名前でアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-121">For example, the GetViewNames method returns an ICollection that allows you to enumerate the DataSourceViews associated with a particular data source control, and the GetView method allows you to access a particular DataSourceView instance by name.</span></span>

<span data-ttu-id="82e2d-122">データソースコントロールには、ユーザーインターフェイスはありません。</span><span class="sxs-lookup"><span data-stu-id="82e2d-122">Data source controls have no user-interface.</span></span> <span data-ttu-id="82e2d-123">これらはサーバーコントロールとして実装されるため、宣言構文をサポートし、必要に応じてページの状態にアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-123">They are implemented as server controls so that they can support declarative syntax and so that they have access to page state if desired.</span></span> <span data-ttu-id="82e2d-124">データソースコントロールは、HTML マークアップをクライアントに表示しません。</span><span class="sxs-lookup"><span data-stu-id="82e2d-124">Data source controls do not render any HTML markup to the client.</span></span>

> [!NOTE]
> <span data-ttu-id="82e2d-125">後で説明するように、データソースコントロールを使用して得られるキャッシュの利点もあります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-125">As you'll see later, there are also caching benefits obtained by using data source controls.</span></span>

## <a name="storing-connection-strings"></a><span data-ttu-id="82e2d-126">保存 (接続文字列を)</span><span class="sxs-lookup"><span data-stu-id="82e2d-126">Storing Connection Strings</span></span>

<span data-ttu-id="82e2d-127">データソースコントロールの構成方法を確認する前に、接続文字列に関する ASP.NET 2.0 の新機能について説明します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-127">Before we get into looking at how to configure data source controls, we should cover a new capability in ASP.NET 2.0 concerning connection strings.</span></span> <span data-ttu-id="82e2d-128">ASP.NET 2.0 では、実行時に動的に読み取ることができる接続文字列を簡単に格納できるようにする新しいセクションが構成ファイルに導入されています。</span><span class="sxs-lookup"><span data-stu-id="82e2d-128">ASP.NET 2.0 introduces a new section in the configuration file that allows you to easily store connection strings that can be read dynamically at runtime.</span></span> <span data-ttu-id="82e2d-129">&lt;connectionStrings&gt; セクションを使用すると、接続文字列を簡単に格納できます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-129">The &lt;connectionStrings&gt; section makes it easy to store connection strings.</span></span>

<span data-ttu-id="82e2d-130">次のスニペットは、新しい接続文字列を追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-130">The snippet below adds a new connection string.</span></span>

[!code-xml[Main](data-source-controls/samples/sample1.xml)]

> [!NOTE]
> <span data-ttu-id="82e2d-131">&lt;appSettings&gt; セクションと同様に、&lt;connectionStrings&gt; セクションは、構成ファイルの &lt;system.web&gt; セクションの外側に表示されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-131">Just as with the &lt;appSettings&gt; section, the &lt;connectionStrings&gt; section appears outside of the &lt;system.web&gt; section in the configuration file.</span></span>

<span data-ttu-id="82e2d-132">この接続文字列を使用するには、サーバーコントロールの ConnectionString 属性を設定するときに、次の構文を使用します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-132">To use this connection string, you can use the following syntax when setting the ConnectionString attribute of a server control.</span></span>

[!code-aspx[Main](data-source-controls/samples/sample2.aspx)]

<span data-ttu-id="82e2d-133">&lt;connectionStrings&gt; セクションを暗号化して、機密情報が公開されないようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-133">The &lt;connectionStrings&gt; section can also be encrypted so that sensitive information is not exposed.</span></span> <span data-ttu-id="82e2d-134">その機能については、後のモジュールで説明します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-134">That ability will be covered in a later module.</span></span>

## <a name="caching-data-sources"></a><span data-ttu-id="82e2d-135">データソースのキャッシュ</span><span class="sxs-lookup"><span data-stu-id="82e2d-135">Caching Data Sources</span></span>

<span data-ttu-id="82e2d-136">各 DataSourceControl には、キャッシュを構成するための4つのプロパティがあります。EnableCaching、CacheDuration、CacheExpirationPolicy、および CacheKeyDependency。</span><span class="sxs-lookup"><span data-stu-id="82e2d-136">Each DataSourceControl provides four properties for configuring caching; EnableCaching, CacheDuration, CacheExpirationPolicy, and CacheKeyDependency.</span></span>

## <a name="enablecaching"></a><span data-ttu-id="82e2d-137">EnableCaching</span><span class="sxs-lookup"><span data-stu-id="82e2d-137">EnableCaching</span></span>

<span data-ttu-id="82e2d-138">EnableCaching は、データソースコントロールのキャッシュを有効にするかどうかを決定するブール型プロパティです。</span><span class="sxs-lookup"><span data-stu-id="82e2d-138">EnableCaching is a Boolean property that determines whether or not caching is enabled for the data source control.</span></span>

## <a name="cacheduration-property"></a><span data-ttu-id="82e2d-139">CacheDuration プロパティ</span><span class="sxs-lookup"><span data-stu-id="82e2d-139">CacheDuration Property</span></span>

<span data-ttu-id="82e2d-140">CacheDuration プロパティは、キャッシュを有効なままにする秒数を設定します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-140">The CacheDuration property sets the number of seconds that the cache remains valid.</span></span> <span data-ttu-id="82e2d-141">このプロパティを**0**に設定すると、明示的に無効になるまでキャッシュが有効のままになります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-141">Setting this property to **0** causes the cache to remain valid until explicitly invalidated.</span></span>

## <a name="cacheexpirationpolicy-property"></a><span data-ttu-id="82e2d-142">CacheExpirationPolicy プロパティ</span><span class="sxs-lookup"><span data-stu-id="82e2d-142">CacheExpirationPolicy Property</span></span>

<span data-ttu-id="82e2d-143">CacheExpirationPolicy プロパティは、**絶対**または**スライディング**に設定できます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-143">The CacheExpirationPolicy property can be set to either **Absolute** or **Sliding**.</span></span> <span data-ttu-id="82e2d-144">このオプションを [絶対] に設定すると、データがキャッシュされる最大時間は、CacheDuration プロパティで指定された秒数になります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-144">Setting it to Absolute means that the maximum amount of time that the data will be cached is the number of seconds specified by the CacheDuration property.</span></span> <span data-ttu-id="82e2d-145">[スライディング] に設定すると、各操作の実行時に有効期限がリセットされます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-145">By setting it to Sliding, the expiration time is reset when each operation is performed.</span></span>

## <a name="cachekeydependency-property"></a><span data-ttu-id="82e2d-146">CacheKeyDependency プロパティ</span><span class="sxs-lookup"><span data-stu-id="82e2d-146">CacheKeyDependency Property</span></span>

<span data-ttu-id="82e2d-147">CacheKeyDependency プロパティに文字列値が指定されている場合、ASP.NET はその文字列に基づいて新しいキャッシュ依存関係を設定します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-147">If a string value is specified for the CacheKeyDependency property, ASP.NET will set up a new cache dependency based on that string.</span></span> <span data-ttu-id="82e2d-148">これにより、CacheKeyDependency を変更または削除するだけで、キャッシュを明示的に無効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-148">This allows you to explicitly invalidate the cache by simply changing or removing the CacheKeyDependency.</span></span>

<span data-ttu-id="82e2d-149">**重要**: 権限借用が有効になっており、データソースやデータのコンテンツへのアクセスがクライアント id に基づいている場合は、EnableCaching を False に設定することにより、キャッシュを無効にすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-149">**Important**: If impersonation is enabled and access to the data source and/or content of data are based upon client identity, it is recommended that caching be disabled by setting EnableCaching to False.</span></span> <span data-ttu-id="82e2d-150">このシナリオでキャッシュが有効になっていて、最初にデータを要求したユーザー以外のユーザーが要求を発行した場合、データソースへの承認は適用されません。</span><span class="sxs-lookup"><span data-stu-id="82e2d-150">If caching is enabled in this scenario and a user other than the user who originally requested the data issues a request, authorization to the data source is not enforced.</span></span> <span data-ttu-id="82e2d-151">データは、単にキャッシュから提供されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-151">The data will simply be served from cache.</span></span>

## <a name="the-sqldatasource-control"></a><span data-ttu-id="82e2d-152">SqlDataSource コントロール</span><span class="sxs-lookup"><span data-stu-id="82e2d-152">The SqlDataSource Control</span></span>

<span data-ttu-id="82e2d-153">SqlDataSource コントロールを使用すると、開発者は、ADO.NET をサポートする任意のリレーショナルデータベースに格納されているデータにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-153">The SqlDataSource control allows a developer to access data stored in any relational database that supports ADO.NET.</span></span> <span data-ttu-id="82e2d-154">System.data.oracleclient プロバイダーを使用すると、Oracle にアクセスするために、プロバイダー、または、system.string プロバイダー、またはプロバイダーに SQL Server アクセスすることができますが、このプロバイダーを使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-154">It can use the System.Data.SqlClient provider to access a SQL Server database, the System.Data.OleDb provider, the System.Data.Odbc provider, or the System.Data.OracleClient provider to access Oracle.</span></span> <span data-ttu-id="82e2d-155">そのため、SqlDataSource は、SQL Server データベースのデータにアクセスするためだけに使用されるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="82e2d-155">Therefore, the SqlDataSource is certainly not only used for accessing data in a SQL Server database.</span></span>

<span data-ttu-id="82e2d-156">SqlDataSource を使用するには、単に ConnectionString プロパティの値を指定し、SQL コマンドまたはストアドプロシージャを指定します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-156">In order to use the SqlDataSource, you simply provide a value for the ConnectionString property and specify a SQL command or stored procedure.</span></span> <span data-ttu-id="82e2d-157">SqlDataSource コントロールは、基になる ADO.NET アーキテクチャを操作します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-157">The SqlDataSource control takes care of working with the underlying ADO.NET architecture.</span></span> <span data-ttu-id="82e2d-158">接続を開くか、データソースにクエリを実行するか、ストアドプロシージャを実行してデータを返し、接続を閉じます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-158">It opens the connection, queries the data source or executes the stored procedure, returns the data, and then closes the connection for you.</span></span>

> [!NOTE]
> <span data-ttu-id="82e2d-159">DataSourceControl クラスは自動的に接続を閉じるため、データベース接続のリークによって生成される顧客呼び出しの数を減らす必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-159">Because the DataSourceControl class automatically closes the connection for you, it should reduce the number of customer calls generated by leaking database connections.</span></span>

<span data-ttu-id="82e2d-160">次のコードスニペットでは、前に示したように、構成ファイルに格納されている接続文字列を使用して、DropDownList コントロールを SqlDataSource コントロールにバインドしています。</span><span class="sxs-lookup"><span data-stu-id="82e2d-160">The code snippet below binds a DropDownList control to a SqlDataSource control using the connection string that is stored in the configuration file as shown above.</span></span>

[!code-aspx[Main](data-source-controls/samples/sample3.aspx)]

<span data-ttu-id="82e2d-161">上に示したように、SqlDataSource の DataSourceMode プロパティは、データソースのモードを指定します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-161">As illustrated above, the DataSourceMode property of the SqlDataSource specifies the mode for the data source.</span></span> <span data-ttu-id="82e2d-162">上記の例では、DataSourceMode は DataReader に設定されています。</span><span class="sxs-lookup"><span data-stu-id="82e2d-162">In the example above, the DataSourceMode is set to DataReader.</span></span> <span data-ttu-id="82e2d-163">この場合、SqlDataSource は、順方向専用および読み取り専用のカーソルを使用して、IDataReader オブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-163">In that case, the SqlDataSource will return an IDataReader object using a forward-only and read-only cursor.</span></span> <span data-ttu-id="82e2d-164">返される指定された型のオブジェクトは、使用されるプロバイダーによって制御されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-164">The specified type of object that is returned is controlled by the provider that is used.</span></span> <span data-ttu-id="82e2d-165">この例では、web.config ファイルの &lt;connectionStrings&gt; セクションで指定されているように、system.string プロバイダーを使用します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-165">In this case, I'm using the System.Data.SqlClient provider as specified in the &lt;connectionStrings&gt; section of the web.config file.</span></span> <span data-ttu-id="82e2d-166">したがって、返されるオブジェクトは、SqlDataReader 型になります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-166">Therefore, the object that is returned will be of type SqlDataReader.</span></span> <span data-ttu-id="82e2d-167">データセットの DataSourceMode 値を指定することにより、データをサーバー上のデータセットに格納できます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-167">By specifying a DataSourceMode value of DataSet, the data can be stored in a DataSet on the server.</span></span> <span data-ttu-id="82e2d-168">このモードでは、並べ替え、ページングなどの機能を追加できます。SqlDataSource を GridView コントロールにデータバインドしていた場合は、データセットモードを選択します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-168">This mode allows you to add features such as sorting, paging, etc. If I had been data-binding the SqlDataSource to a GridView control, I would have chosen the DataSet mode.</span></span> <span data-ttu-id="82e2d-169">ただし、DropDownList の場合は、DataReader モードが適切な選択です。</span><span class="sxs-lookup"><span data-stu-id="82e2d-169">However, in the case of a DropDownList, the DataReader mode is the correct choice.</span></span>

> [!NOTE]
> <span data-ttu-id="82e2d-170">SqlDataSource または AccessDataSource をキャッシュする場合は、DataSourceMode プロパティを DataSet に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-170">When caching a SqlDataSource or an AccessDataSource, the DataSourceMode property must be set to DataSet.</span></span> <span data-ttu-id="82e2d-171">DataReader の DataSourceMode でキャッシュを有効にすると、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-171">An exception will occur if you enable caching with a DataSourceMode of DataReader.</span></span>

## <a name="sqldatasource-properties"></a><span data-ttu-id="82e2d-172">SqlDataSource プロパティ</span><span class="sxs-lookup"><span data-stu-id="82e2d-172">SqlDataSource Properties</span></span>

<span data-ttu-id="82e2d-173">次に、SqlDataSource コントロールのプロパティの一部を示します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-173">The following are some of the properties of the SqlDataSource control.</span></span>

### <a name="cancelselectonnullparameter"></a><span data-ttu-id="82e2d-174">CancelSelectOnNullParameter</span><span class="sxs-lookup"><span data-stu-id="82e2d-174">CancelSelectOnNullParameter</span></span>

<span data-ttu-id="82e2d-175">パラメーターのいずれかが null の場合に select コマンドを取り消すかどうかを指定するブール値です。</span><span class="sxs-lookup"><span data-stu-id="82e2d-175">A Boolean value that specifies whether a select command is canceled if one of the parameters is null.</span></span> <span data-ttu-id="82e2d-176">既定では true です。</span><span class="sxs-lookup"><span data-stu-id="82e2d-176">True by default.</span></span>

### <a name="conflictdetection"></a><span data-ttu-id="82e2d-177">ConflictDetection</span><span class="sxs-lookup"><span data-stu-id="82e2d-177">ConflictDetection</span></span>

<span data-ttu-id="82e2d-178">複数のユーザーが同時にデータソースを更新している場合は、ConflictDetection プロパティによって SqlDataSource コントロールの動作が決定されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-178">In a situation where multiple users may be updating a data source at the same time, the ConflictDetection property determines the behavior of the SqlDataSource control.</span></span> <span data-ttu-id="82e2d-179">このプロパティは、ConflictOptions 列挙値のいずれかに評価されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-179">This property evaluates to one of the values of the ConflictOptions enumeration.</span></span> <span data-ttu-id="82e2d-180">これらの値は、 **Compareallvalues**および**overwritechanges**内容です。</span><span class="sxs-lookup"><span data-stu-id="82e2d-180">Those values are **CompareAllValues** and **OverwriteChanges**.</span></span> <span data-ttu-id="82e2d-181">オーバー書き込みが設定されている場合、データソースに最後にデータを書き込んだユーザーが以前の変更を上書きします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-181">If set to OverwriteChanges, the last person to write data to the data source overwrites any previous changes.</span></span> <span data-ttu-id="82e2d-182">ただし、ConflictDetection プロパティが CompareAllValues に設定されている場合は、SelectCommand によって返される列に対してパラメーターが作成され、それらの列の元の値が保持されます。SelectCommand が実行されてから値が変更されたかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-182">However, if the ConflictDetection property is set to CompareAllValues, parameters get created for the columns returned by the SelectCommand and parameters are also created to hold the original values in each of those columns allowing the SqlDataSource to determine whether or not the values have changed since the SelectCommand was executed.</span></span>

### <a name="deletecommand"></a><span data-ttu-id="82e2d-183">DeleteCommand</span><span class="sxs-lookup"><span data-stu-id="82e2d-183">DeleteCommand</span></span>

<span data-ttu-id="82e2d-184">データベースから行を削除するときに使用する SQL 文字列を設定または取得します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-184">Sets or gets the SQL string used when deleting rows from the database.</span></span> <span data-ttu-id="82e2d-185">SQL クエリまたはストアドプロシージャ名のいずれかを指定できます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-185">This can either be a SQL query or a stored procedure name.</span></span>

### <a name="deletecommandtype"></a><span data-ttu-id="82e2d-186">DeleteCommandType</span><span class="sxs-lookup"><span data-stu-id="82e2d-186">DeleteCommandType</span></span>

<span data-ttu-id="82e2d-187">SQL クエリ (テキスト) またはストアドプロシージャ (StoredProcedure) のいずれかである、delete コマンドの種類を設定または取得します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-187">Sets or gets the type of delete command, either a SQL query (Text) or a stored procedure (StoredProcedure).</span></span>

### <a name="deleteparameters"></a><span data-ttu-id="82e2d-188">DeleteParameters</span><span class="sxs-lookup"><span data-stu-id="82e2d-188">DeleteParameters</span></span>

<span data-ttu-id="82e2d-189">SqlDataSource コントロールに関連付けられている SqlDataSourceView オブジェクトの DeleteCommand によって使用されるパラメーターを返します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-189">Returns the parameters that are used by the DeleteCommand of the SqlDataSourceView object associated with the SqlDataSource control.</span></span>

### <a name="oldvaluesparameterformatstring"></a><span data-ttu-id="82e2d-190">OldValuesParameterFormatString</span><span class="sxs-lookup"><span data-stu-id="82e2d-190">OldValuesParameterFormatString</span></span>

<span data-ttu-id="82e2d-191">このプロパティは、ConflictDetection プロパティが CompareAllValues に設定されている場合に、元の値パラメーターの形式を指定するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-191">This property is used to specify the format of the original value parameters in cases where the ConflictDetection property is set to CompareAllValues.</span></span> <span data-ttu-id="82e2d-192">既定値は {0} 元の値のパラメーターが元のパラメーターと同じ名前であることを意味します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-192">The default is {0} which means that original value parameters will take the same name as the original parameter.</span></span> <span data-ttu-id="82e2d-193">つまり、フィールド名が EmployeeID の場合、元の値パラメーターは @EmployeeIDになります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-193">In other words, if the field name is EmployeeID, the original value parameter would be @EmployeeID.</span></span>

### <a name="selectcommand"></a><span data-ttu-id="82e2d-194">SelectCommand</span><span class="sxs-lookup"><span data-stu-id="82e2d-194">SelectCommand</span></span>

<span data-ttu-id="82e2d-195">データベースからデータを取得するために使用される SQL 文字列を設定または取得します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-195">Sets or gets the SQL string that is used to retrieve data from the database.</span></span> <span data-ttu-id="82e2d-196">SQL クエリまたはストアドプロシージャ名のいずれかを指定できます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-196">This can either be a SQL query or a stored procedure name.</span></span>

### <a name="selectcommandtype"></a><span data-ttu-id="82e2d-197">SelectCommandType</span><span class="sxs-lookup"><span data-stu-id="82e2d-197">SelectCommandType</span></span>

<span data-ttu-id="82e2d-198">SQL クエリ (テキスト) またはストアドプロシージャ (StoredProcedure) のいずれかの select コマンドの種類を設定または取得します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-198">Sets or gets the type of select command, either a SQL query (Text) or a stored procedure (StoredProcedure).</span></span>

### <a name="selectparameters"></a><span data-ttu-id="82e2d-199">SelectParameters</span><span class="sxs-lookup"><span data-stu-id="82e2d-199">SelectParameters</span></span>

<span data-ttu-id="82e2d-200">SqlDataSource コントロールに関連付けられている SqlDataSourceView オブジェクトの SelectCommand によって使用されるパラメーターを返します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-200">Returns the parameters that are used by the SelectCommand of the SqlDataSourceView object associated with the SqlDataSource control.</span></span>

### <a name="sortparametername"></a><span data-ttu-id="82e2d-201">SortParameterName</span><span class="sxs-lookup"><span data-stu-id="82e2d-201">SortParameterName</span></span>

<span data-ttu-id="82e2d-202">データソースコントロールによって取得されるデータを並べ替えるときに使用されるストアドプロシージャパラメーターの名前を取得します。値の設定もできます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-202">Gets or sets the name of a stored procedure parameter that is used when sorting data retrieved by the data source control.</span></span> <span data-ttu-id="82e2d-203">SelectCommandType が StoredProcedure に設定されている場合にのみ有効です。</span><span class="sxs-lookup"><span data-stu-id="82e2d-203">Valid only when SelectCommandType is set to StoredProcedure.</span></span>

### <a name="sqlcachedependency"></a><span data-ttu-id="82e2d-204">SqlCacheDependency</span><span class="sxs-lookup"><span data-stu-id="82e2d-204">SqlCacheDependency</span></span>

<span data-ttu-id="82e2d-205">SQL Server キャッシュの依存関係で使用されるデータベースとテーブルを指定する、セミコロンで区切られた文字列。</span><span class="sxs-lookup"><span data-stu-id="82e2d-205">A semi-colon delimited string specifying the databases and tables used in a SQL Server cache dependency.</span></span> <span data-ttu-id="82e2d-206">(SQL キャッシュの依存関係については、後のモジュールで説明します)。</span><span class="sxs-lookup"><span data-stu-id="82e2d-206">(SQL cache dependencies will be discussed in a later module.)</span></span>

### <a name="updatecommand"></a><span data-ttu-id="82e2d-207">UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="82e2d-207">UpdateCommand</span></span>

<span data-ttu-id="82e2d-208">データベース内のデータを更新するときに使用される SQL 文字列を設定または取得します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-208">Sets or gets the SQL string that is used when updating data in the database.</span></span> <span data-ttu-id="82e2d-209">SQL クエリまたはストアドプロシージャ名のいずれかを指定できます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-209">This can either be a SQL query or a stored procedure name.</span></span>

### <a name="updatecommandtype"></a><span data-ttu-id="82e2d-210">UpdateCommandType</span><span class="sxs-lookup"><span data-stu-id="82e2d-210">UpdateCommandType</span></span>

<span data-ttu-id="82e2d-211">Update コマンドの種類 (SQL クエリ (テキスト) またはストアドプロシージャ (StoredProcedure)) を設定または取得します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-211">Sets or gets the type of update command, either a SQL query (Text) or a stored procedure (StoredProcedure).</span></span>

### <a name="updateparameters"></a><span data-ttu-id="82e2d-212">UpdateParameters</span><span class="sxs-lookup"><span data-stu-id="82e2d-212">UpdateParameters</span></span>

<span data-ttu-id="82e2d-213">SqlDataSource コントロールに関連付けられている SqlDataSourceView オブジェクトの UpdateCommand によって使用されるパラメーターを返します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-213">Returns the parameters that are used by the UpdateCommand of the SqlDataSourceView object associated with the SqlDataSource control.</span></span>

## <a name="the-accessdatasource-control"></a><span data-ttu-id="82e2d-214">AccessDataSource コントロール</span><span class="sxs-lookup"><span data-stu-id="82e2d-214">The AccessDataSource Control</span></span>

<span data-ttu-id="82e2d-215">AccessDataSource コントロールは、SqlDataSource クラスから派生し、Microsoft Access データベースにデータをバインドするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-215">The AccessDataSource control derives from the SqlDataSource class and is used to data-bind to a Microsoft Access database.</span></span> <span data-ttu-id="82e2d-216">AccessDataSource コントロールの ConnectionString プロパティは、読み取り専用プロパティです。</span><span class="sxs-lookup"><span data-stu-id="82e2d-216">The ConnectionString property for the AccessDataSource control is a read-only property.</span></span> <span data-ttu-id="82e2d-217">ConnectionString プロパティを使用する代わりに、次に示すように、Access データベースを指すようにデータファイルプロパティを使用します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-217">Instead of using the ConnectionString property, the DataFile property is used to point to the Access Database as shown below.</span></span>

[!code-aspx[Main](data-source-controls/samples/sample4.aspx)]

<span data-ttu-id="82e2d-218">AccessDataSource は常に、ベース SqlDataSource の ProviderName をに設定し、OLE DB Microsoft のプロバイダーを使用してデータベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-218">The AccessDataSource will always set the ProviderName of the base SqlDataSource to System.Data.OleDb and connects to the database using the Microsoft.Jet.OLEDB.4.0 OLE DB provider.</span></span> <span data-ttu-id="82e2d-219">AccessDataSource コントロールを使用して、パスワードで保護された Access データベースに接続することはできません。</span><span class="sxs-lookup"><span data-stu-id="82e2d-219">You cannot use the AccessDataSource control to connect to a password-protected Access database.</span></span> <span data-ttu-id="82e2d-220">パスワードで保護されたデータベースに接続する必要がある場合は、SqlDataSource コントロールを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-220">If you have to connect to a password protected database, you should use the SqlDataSource control.</span></span>

> [!NOTE]
> <span data-ttu-id="82e2d-221">Web サイト内に格納されているデータベースへのアクセスは、アプリの\_データディレクトリに配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-221">Access databases stored within the Web site should be placed in the App\_Data directory.</span></span> <span data-ttu-id="82e2d-222">ASP.NET では、このディレクトリ内のファイルを参照することはできません。</span><span class="sxs-lookup"><span data-stu-id="82e2d-222">ASP.NET does not allow files in this directory to be browsed.</span></span> <span data-ttu-id="82e2d-223">Access データベースを使用する場合は、アプリ\_データディレクトリに対する読み取りと書き込みのアクセス許可をプロセスアカウントに付与する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-223">You will need to grant the process account Read and Write permissions to the App\_Data directory when using Access databases.</span></span>

## <a name="the-xmldatasource-control"></a><span data-ttu-id="82e2d-224">XmlDataSource コントロール</span><span class="sxs-lookup"><span data-stu-id="82e2d-224">The XmlDataSource Control</span></span>

<span data-ttu-id="82e2d-225">XmlDataSource は、XML データをデータバインドコントロールにデータバインドするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-225">The XmlDataSource is used to data-bind XML data to data-bound controls.</span></span> <span data-ttu-id="82e2d-226">データファイルプロパティを使用して XML ファイルにバインドすることも、Data プロパティを使用して XML 文字列にバインドすることもできます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-226">You can bind to an XML file using the DataFile property or you can bind to an XML string using the Data property.</span></span> <span data-ttu-id="82e2d-227">XmlDataSource は、バインド可能フィールドとして XML 属性を公開します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-227">The XmlDataSource exposes XML attributes as bindable fields.</span></span> <span data-ttu-id="82e2d-228">属性として表されない値にバインドする必要がある場合は、XSL 変換を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-228">In cases where you need to bind to values that are not represented as attributes, you will need to use an XSL transform.</span></span> <span data-ttu-id="82e2d-229">XPath 式を使用して XML データをフィルター処理することもできます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-229">You can also use XPath expressions to filter XML data.</span></span>

<span data-ttu-id="82e2d-230">次の XML ファイルについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-230">Consider the following XML file:</span></span>

[!code-xml[Main](data-source-controls/samples/sample5.xml)]

<span data-ttu-id="82e2d-231">XmlDataSource は、Person */person*の XPath プロパティを使用して、&lt;Person&gt; ノードのみをフィルター処理することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="82e2d-231">Notice that the XmlDataSource uses an XPath property of *People/Person* in order to filter on just the &lt;Person&gt; nodes.</span></span> <span data-ttu-id="82e2d-232">DropDownList は、DataTextField プロパティを使用して、LastName 属性にデータをバインドします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-232">The DropDownList then data-binds to the LastName attribute using the DataTextField property.</span></span>

<span data-ttu-id="82e2d-233">XmlDataSource コントロールは、主に読み取り専用の XML データにデータバインドするために使用されますが、XML データファイルを編集することもできます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-233">While the XmlDataSource control is primarily used to data-bind to read-only XML data, it is possible to edit the XML data file.</span></span> <span data-ttu-id="82e2d-234">このような場合、XML ファイル内の情報の自動挿入、更新、および削除は、他のデータソースコントロールと同様に自動的には行われないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="82e2d-234">Note that in such cases, automatic insertion, updating, and deletion of information in the XML file does not happen automatically as it does with other data source controls.</span></span> <span data-ttu-id="82e2d-235">代わりに、XmlDataSource コントロールの次のメソッドを使用してデータを手動で編集するコードを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-235">Instead, you will have to write code to manually edit the data using the following methods of the XmlDataSource control.</span></span>

### <a name="getxmldocument"></a><span data-ttu-id="82e2d-236">GetXmlDocument</span><span class="sxs-lookup"><span data-stu-id="82e2d-236">GetXmlDocument</span></span>

<span data-ttu-id="82e2d-237">XmlDataSource によって取得された XML コードを含む XmlDocument オブジェクトを取得します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-237">Retrieves an XmlDocument object containing the XML code retrieved by the XmlDataSource.</span></span>

### <a name="save"></a><span data-ttu-id="82e2d-238">保存</span><span class="sxs-lookup"><span data-stu-id="82e2d-238">Save</span></span>

<span data-ttu-id="82e2d-239">メモリ内の XmlDocument をデータソースに保存します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-239">Saves the in-memory XmlDocument back to the data source.</span></span>

<span data-ttu-id="82e2d-240">Save メソッドは、次の2つの条件が満たされている場合にのみ機能することを認識しておくことが重要です。</span><span class="sxs-lookup"><span data-stu-id="82e2d-240">It's important to realize that the Save method will only work when the following two conditions are met:</span></span>

1. <span data-ttu-id="82e2d-241">XmlDataSource は、データプロパティではなく XML ファイルにバインドするためにデータファイルプロパティを使用して、インメモリ XML データにバインドしています。</span><span class="sxs-lookup"><span data-stu-id="82e2d-241">The XmlDataSource is using the DataFile property to bind to an XML file instead of the Data property to bind to in-memory XML data.</span></span>
2. <span data-ttu-id="82e2d-242">Transform または TransformFile プロパティを使用して変換を指定することはできません。</span><span class="sxs-lookup"><span data-stu-id="82e2d-242">No transformation is specified via the Transform or TransformFile property.</span></span>

<span data-ttu-id="82e2d-243">また、Save メソッドでは、複数のユーザーによって同時に呼び出された場合に予期しない結果が生成されることもあります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-243">Note also that the Save method can yield unexpected results when called by multiple users concurrently.</span></span>

## <a name="the-objectdatasource-control"></a><span data-ttu-id="82e2d-244">ObjectDataSource コントロール</span><span class="sxs-lookup"><span data-stu-id="82e2d-244">The ObjectDataSource Control</span></span>

<span data-ttu-id="82e2d-245">この時点までに説明したデータソースコントロールは、データソースコントロールがデータストアと直接通信する2層アプリケーションに適しています。</span><span class="sxs-lookup"><span data-stu-id="82e2d-245">The data source controls that we have covered up to this point are excellent choices for two-tier applications where the data source control communicates directly to the data store.</span></span> <span data-ttu-id="82e2d-246">ただし、多くの実際のアプリケーションは多階層アプリケーションであり、データソースコントロールは、データレイヤーと通信するビジネスオブジェクトと通信する必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-246">However, many real-world applications are multi-tier applications where a data source control might need to communicate to a business object which, in turn, communicates with the data layer.</span></span> <span data-ttu-id="82e2d-247">このような状況では、ObjectDataSource によって請求書が適切に入力されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-247">In these situations, the ObjectDataSource fills the bill nicely.</span></span> <span data-ttu-id="82e2d-248">ObjectDataSource は、ソースオブジェクトと連携して動作します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-248">The ObjectDataSource works in conjunction with a source object.</span></span> <span data-ttu-id="82e2d-249">ObjectDataSource コントロールは、ソースオブジェクトのインスタンスを作成し、指定されたメソッドを呼び出します。また、オブジェクトに静的メソッドではなくインスタンスメソッド (Visual Basic で共有) がある場合は、1つの要求のスコープ内でオブジェクトインスタンスをすべて破棄します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-249">The ObjectDataSource control will create an instance of the source object, call the specified method, and dispose of the object instance all within the scope of a single request, if your object has instance methods instead of static methods (Shared in Visual Basic).</span></span> <span data-ttu-id="82e2d-250">そのため、オブジェクトはステートレスである必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-250">Therefore, your object must be stateless.</span></span> <span data-ttu-id="82e2d-251">つまり、オブジェクトは、1つの要求の範囲内で必要なすべてのリソースを取得して解放する必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-251">That is, your object should acquire and release all required resources within the span of a single request.</span></span> <span data-ttu-id="82e2d-252">ObjectDataSource コントロールの ObjectCreating イベントを処理することによって、ソースオブジェクトの作成方法を制御できます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-252">You can control how the source object is created by handling the ObjectCreating event of the ObjectDataSource control.</span></span> <span data-ttu-id="82e2d-253">ソースオブジェクトのインスタンスを作成し、そのインスタンスに対して ObjectDataSourceEventArgs クラスの ObjectInstance プロパティを設定できます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-253">You can create an instance of the source object, and then set the ObjectInstance property of the ObjectDataSourceEventArgs class to that instance.</span></span> <span data-ttu-id="82e2d-254">ObjectDataSource コントロールは、独自のインスタンスを作成するのではなく、ObjectCreating イベントで作成されたインスタンスを使用します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-254">The ObjectDataSource control will use the instance that is created in the ObjectCreating event instead of creating an instance on its own.</span></span>

<span data-ttu-id="82e2d-255">ObjectDataSource コントロールのソースオブジェクトが、データを取得および変更するために呼び出すことができるパブリック静的メソッド (Visual Basic で共有) を公開する場合、ObjectDataSource コントロールはこれらのメソッドを直接呼び出します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-255">If the source object for an ObjectDataSource control exposes public static methods (Shared in Visual Basic) that can be called to retrieve and modify data, an ObjectDataSource control will call those methods directly.</span></span> <span data-ttu-id="82e2d-256">ObjectDataSource コントロールで、メソッド呼び出しを行うためにソースオブジェクトのインスタンスを作成する必要がある場合、オブジェクトにはパラメーターをとらないパブリックコンストラクターを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="82e2d-256">If an ObjectDataSource control must create an instance of the source object in order to make method calls, the object must include a public constructor that takes no parameters.</span></span> <span data-ttu-id="82e2d-257">ObjectDataSource コントロールは、ソースオブジェクトの新しいインスタンスを作成するときに、このコンストラクターを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-257">The ObjectDataSource control will call this constructor when it creates a new instance of the source object.</span></span>

<span data-ttu-id="82e2d-258">ソースオブジェクトに、パラメーターのないパブリックコンストラクターが含まれていない場合は、ObjectCreating イベントの ObjectDataSource コントロールによって使用されるソースオブジェクトのインスタンスを作成できます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-258">If the source object does not contain a public constructor without parameters, you can create an instance of the source object that will be used by the ObjectDataSource control in the ObjectCreating event.</span></span>

## <a name="specifying-object-methods"></a><span data-ttu-id="82e2d-259">オブジェクトメソッドの指定</span><span class="sxs-lookup"><span data-stu-id="82e2d-259">Specifying Object Methods</span></span>

<span data-ttu-id="82e2d-260">ObjectDataSource コントロールのソースオブジェクトには、データの選択、挿入、更新、または削除に使用される任意の数のメソッドを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-260">The source object for an ObjectDataSource control can contain any number of methods that are used to select, insert, update, or delete data.</span></span> <span data-ttu-id="82e2d-261">これらのメソッドは、ObjectDataSource コントロールの SelectMethod、InsertMethod、UpdateMethod、または DeleteMethod プロパティのいずれかを使用して識別されるように、メソッドの名前に基づいて ObjectDataSource コントロールによって呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-261">These methods are called by the ObjectDataSource control based on the name of the method, as identified by using either the SelectMethod, InsertMethod, UpdateMethod, or DeleteMethod property of the ObjectDataSource control.</span></span> <span data-ttu-id="82e2d-262">ソースオブジェクトには、省略可能な SelectCount メソッドを含めることもできます。これは、データソースのオブジェクトの合計数を返す SelectCountMethod プロパティを使用して ObjectDataSource コントロールによって識別されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-262">The source object can also include an optional SelectCount method, which is identified by the ObjectDataSource control using the SelectCountMethod property, that returns the count of the total number of objects at the data source.</span></span> <span data-ttu-id="82e2d-263">ObjectDataSource コントロールは、ページング時に使用するデータソースのレコードの合計数を取得するために、Select メソッドが呼び出された後に SelectCount メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-263">The ObjectDataSource control will call the SelectCount method after a Select method has been called to retrieve the total number of records at the data source for use when paging.</span></span>

## <a name="lab-using-data-source-controls"></a><span data-ttu-id="82e2d-264">データソースコントロールを使用するラボ</span><span class="sxs-lookup"><span data-stu-id="82e2d-264">Lab Using Data Source Controls</span></span>

## <a name="exercise-1---displaying-data-with-the-sqldatasource-control"></a><span data-ttu-id="82e2d-265">演習 1-SqlDataSource コントロールを使用したデータの表示</span><span class="sxs-lookup"><span data-stu-id="82e2d-265">Exercise 1 - Displaying Data with the SqlDataSource Control</span></span>

<span data-ttu-id="82e2d-266">次の演習では、SqlDataSource コントロールを使用して Northwind データベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-266">The following exercise uses the SqlDataSource control to connect to the Northwind database.</span></span> <span data-ttu-id="82e2d-267">SQL Server 2000 インスタンスで Northwind データベースにアクセスできることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="82e2d-267">It assumes that you have access to the Northwind database on a SQL Server 2000 instance.</span></span>

1. <span data-ttu-id="82e2d-268">新しい ASP.NET Web サイトの作成</span><span class="sxs-lookup"><span data-stu-id="82e2d-268">Create a new ASP.NET Web site.</span></span>
2. <span data-ttu-id="82e2d-269">新しい web.config ファイルを追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-269">Add a new web.config file.</span></span>

    1. <span data-ttu-id="82e2d-270">ソリューションエクスプローラーでプロジェクトを右クリックし、[新しい項目の追加] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-270">Right-click on the project in Solution Explorer and click Add New Item.</span></span>
    2. <span data-ttu-id="82e2d-271">テンプレートの一覧から [Web 構成ファイル] を選択し、[追加] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-271">Choose Web Configuration File from the list of templates and click Add.</span></span>
3. <span data-ttu-id="82e2d-272">次のように &lt;connectionStrings&gt; セクションを編集します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-272">Edit the &lt;connectionStrings&gt; section as follows:</span></span> 

    [!code-aspx[Main](data-source-controls/samples/sample6.aspx)]
4. <span data-ttu-id="82e2d-273">次のように、コードビューに切り替えて、ConnectionString 属性と SelectCommand 属性を &lt;asp: SqlDataSource&gt; コントロールに追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-273">Switch to Code view and add a ConnectionString attribute and a SelectCommand attribute to the &lt;asp:SqlDataSource&gt; control as follows:</span></span> 

    [!code-aspx[Main](data-source-controls/samples/sample7.aspx)]
5. <span data-ttu-id="82e2d-274">デザインビューから、新しい GridView コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-274">From Design view, add a new GridView control.</span></span>
6. <span data-ttu-id="82e2d-275">[GridView タスク] メニューの [データソースの選択] ドロップダウンで、[SqlDataSource1] を選択します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-275">From the Choose Data Source dropdown in the GridView Tasks menu, choose SqlDataSource1.</span></span>
7. <span data-ttu-id="82e2d-276">Default.aspx を右クリックし、メニューから [ブラウザーで表示] を選択します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-276">Right-click on Default.aspx and choose View in Browser from the menu.</span></span> <span data-ttu-id="82e2d-277">保存を求めるメッセージが表示されたら、[はい] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-277">Click Yes when prompted to save.</span></span>
8. <span data-ttu-id="82e2d-278">GridView には、Products テーブルのデータが表示されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-278">The GridView displays the data from the Products table.</span></span>

## <a name="exercise-2---editing-data-with-the-sqldatasource-control"></a><span data-ttu-id="82e2d-279">演習 2-SqlDataSource コントロールを使用したデータの編集</span><span class="sxs-lookup"><span data-stu-id="82e2d-279">Exercise 2 - Editing Data with the SqlDataSource Control</span></span>

<span data-ttu-id="82e2d-280">次の演習では、宣言構文を使用して DropDownList コントロールをデータバインドし、DropDownList コントロールに表示されるデータを編集できるようにする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-280">The following exercise demonstrates how to data bind a DropDownList control using the declarative syntax and allows you to edit the data presented in the DropDownList control.</span></span>

1. <span data-ttu-id="82e2d-281">デザインビューで、GridView コントロールを default.aspx から削除します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-281">In Design view, delete the GridView control from Default.aspx.</span></span> 

    <span data-ttu-id="82e2d-282">**重要**: ページの SqlDataSource コントロールはそのままにしておきます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-282">**Important**: Leave the SqlDataSource control on the page.</span></span>
2. <span data-ttu-id="82e2d-283">DropDownList コントロールを default.aspx に追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-283">Add a DropDownList control to Default.aspx.</span></span>
3. <span data-ttu-id="82e2d-284">ソースビューに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-284">Switch to Source view.</span></span>
4. <span data-ttu-id="82e2d-285">次のように、DataSourceId、DataTextField、および DataValueField 属性を &lt;asp: DropDownList&gt; コントロールに追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-285">Add a DataSourceId, DataTextField, and DataValueField attribute to the &lt;asp:DropDownList&gt; control as follows:</span></span> 

    [!code-aspx[Main](data-source-controls/samples/sample8.aspx)]
5. <span data-ttu-id="82e2d-286">Default.aspx を保存し、ブラウザーで表示します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-286">Save Default.aspx and view it in the browser.</span></span> <span data-ttu-id="82e2d-287">DropDownList には Northwind データベースのすべての製品が含まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="82e2d-287">Note that the DropDownList contains all of the products from the Northwind database.</span></span>
6. <span data-ttu-id="82e2d-288">ブラウザーを閉じます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-288">Close the browser.</span></span>
7. <span data-ttu-id="82e2d-289">Default.aspx のソースビューで、DropDownList コントロールの下に新しい TextBox コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-289">In Source view of Default.aspx, add a new TextBox control below the DropDownList control.</span></span> <span data-ttu-id="82e2d-290">テキストボックスの ID プロパティを txtProductName に変更します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-290">Change the ID property of the TextBox to txtProductName.</span></span>
8. <span data-ttu-id="82e2d-291">TextBox コントロールの下に、新しいボタンコントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-291">Under the TextBox control, add a new Button control.</span></span> <span data-ttu-id="82e2d-292">ボタンの ID プロパティを btnUpdate に変更し、Text プロパティを**Product Name に更新**します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-292">Change the ID property of the Button to btnUpdate and the Text property to **Update Product Name**.</span></span>
9. <span data-ttu-id="82e2d-293">Default.aspx のソースビューで、次のように、UpdateCommand プロパティと2つの新しい UpdateParameters を SqlDataSource タグに追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-293">In Source view of Default.aspx, add an UpdateCommand property and two new UpdateParameters to the SqlDataSource tag as follows:</span></span> 

    [!code-aspx[Main](data-source-controls/samples/sample9.aspx)]

    > [!NOTE]
    > <span data-ttu-id="82e2d-294">このコードには、2つの更新パラメーター (ProductName と ProductID) が追加されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="82e2d-294">Note that there are two update parameters (ProductName and ProductID) added in this code.</span></span> <span data-ttu-id="82e2d-295">これらのパラメーターは、txtProductName テキストボックスの Text プロパティと ddlProducts DropDownList の SelectedValue プロパティにマップされます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-295">These parameters are mapped to the Text property of the txtProductName TextBox and the SelectedValue property of the ddlProducts DropDownList.</span></span>
10. <span data-ttu-id="82e2d-296">デザインビューに切り替えて、ボタンコントロールをダブルクリックし、イベントハンドラーを追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-296">Switch to Design view and double-click on the Button control to add an event handler.</span></span>
11. <span data-ttu-id="82e2d-297">次のコードを btnUpdate\_クリックしてコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-297">Add the following code to the btnUpdate\_Click code:</span></span> 

    [!code-csharp[Main](data-source-controls/samples/sample10.cs)]
12. <span data-ttu-id="82e2d-298">Default.aspx を右クリックし、ブラウザーで表示するように選択します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-298">Right-click on Default.aspx and choose to view it in the browser.</span></span> <span data-ttu-id="82e2d-299">すべての変更を保存するように求められたら、[はい] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-299">Click Yes when prompted to save all changes.</span></span>
13. <span data-ttu-id="82e2d-300">ASP.NET 2.0 部分クラスでは、実行時にコンパイルを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-300">ASP.NET 2.0 partial classes allow for compilation at runtime.</span></span> <span data-ttu-id="82e2d-301">コードの変更が有効になるようにアプリケーションを構築する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="82e2d-301">It is not necessary to build an application in order to see code changes take effect.</span></span>
14. <span data-ttu-id="82e2d-302">DropDownList から製品を選択します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-302">Select a product from the DropDownList.</span></span>
15. <span data-ttu-id="82e2d-303">テキストボックスに選択した製品の新しい名前を入力し、[更新] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-303">Enter a new name for the selected product in the TextBox and then click the Update button.</span></span>
16. <span data-ttu-id="82e2d-304">製品名はデータベースで更新されます。</span><span class="sxs-lookup"><span data-stu-id="82e2d-304">The product name is updated in the database.</span></span>

## <a name="exercise-3-using-the-objectdatasource-control"></a><span data-ttu-id="82e2d-305">手順 3. ObjectDataSource コントロールの使用</span><span class="sxs-lookup"><span data-stu-id="82e2d-305">Exercise 3 Using the ObjectDataSource Control</span></span>

<span data-ttu-id="82e2d-306">この演習では、ObjectDataSource コントロールとソースオブジェクトを使用して Northwind データベースと対話する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-306">This exercise will demonstrate how to use the ObjectDataSource control and a source object to interact with the Northwind database.</span></span>

1. <span data-ttu-id="82e2d-307">ソリューションエクスプローラーでプロジェクトを右クリックし、[新しい項目の追加] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-307">Right-click on the project in Solution Explorer and click on Add New Item.</span></span>
2. <span data-ttu-id="82e2d-308">[テンプレート] ボックスの一覧で [Web フォーム] を選択します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-308">Select Web Form in the templates list.</span></span> <span data-ttu-id="82e2d-309">名前を「オブジェクト .aspx」に変更し、[追加] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-309">Change the name to object.aspx and click Add.</span></span>
3. <span data-ttu-id="82e2d-310">ソリューションエクスプローラーでプロジェクトを右クリックし、[新しい項目の追加] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-310">Right-click on the project in Solution Explorer and click on Add New Item.</span></span>
4. <span data-ttu-id="82e2d-311">[テンプレート] ボックスの一覧で [クラス] を選択します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-311">Select Class in the templates list.</span></span> <span data-ttu-id="82e2d-312">クラスの名前を NorthwindData.cs に変更し、[追加] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-312">Change the name of the class to NorthwindData.cs and click Add.</span></span>
5. <span data-ttu-id="82e2d-313">アプリ\_コードフォルダーにクラスを追加するように求めるメッセージが表示されたら、[はい] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="82e2d-313">Click Yes when prompted to add the class to the App\_Code folder.</span></span>
6. <span data-ttu-id="82e2d-314">NorthwindData.cs ファイルに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-314">Add the following code to the NorthwindData.cs file:</span></span> 

    [!code-csharp[Main](data-source-controls/samples/sample11.cs)]
7. <span data-ttu-id="82e2d-315">オブジェクト .aspx のソースビューに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-315">Add the following code to the Source view of object.aspx:</span></span> 

    [!code-aspx[Main](data-source-controls/samples/sample12.aspx)]
8. <span data-ttu-id="82e2d-316">すべてのファイルを保存し、オブジェクト .aspx を参照します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-316">Save all files and browse object.aspx.</span></span>
9. <span data-ttu-id="82e2d-317">詳細を表示したり、従業員を編集したり、従業員を追加したり、従業員を削除したりして、インターフェイスを操作します。</span><span class="sxs-lookup"><span data-stu-id="82e2d-317">Interact with the interface by viewing details, editing employees, adding employees, and deleting employees.</span></span>
