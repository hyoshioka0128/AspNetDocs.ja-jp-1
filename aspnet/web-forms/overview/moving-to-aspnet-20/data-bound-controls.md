---
uid: web-forms/overview/moving-to-aspnet-20/data-bound-controls
title: データ バインド コントロール |マイクロソフトドキュメント
author: rick-anderson
description: ほとんどのASP.NETアプリケーションは、バックエンド データ ソースからある程度のデータ表示を使用します。 データ バインド コントロールは、対話の重要な部分となっています。
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 0e23ff32-646d-43f3-8bec-6b2313d3abd6
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-bound-controls
msc.type: authoredcontent
ms.openlocfilehash: 941e2ed15b3da28991e7b06cbab570eb1b5b8899
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543081"
---
# <a name="data-bound-controls"></a>データ バインドされたコントロール

[マイクロソフト](https://github.com/microsoft)

> ほとんどのASP.NETアプリケーションは、バックエンド データ ソースからある程度のデータ表示を使用します。 データ バインド コントロールは、動的な Web アプリケーションでデータを操作するうえで極めて重要な部分を持っています。 ASP.NET 2.0 では、新しい BaseDataBoundControl クラスと宣言構文など、データ バインド コントロールの大幅な機能強化が導入されています。

ほとんどのASP.NETアプリケーションは、バックエンド データ ソースからある程度のデータ表示を使用します。 データ バインド コントロールは、動的な Web アプリケーションでデータを操作するうえで極めて重要な部分を持っています。 ASP.NET 2.0 では、新しい BaseDataBoundControl クラスと宣言構文など、データ バインド コントロールの大幅な機能強化が導入されています。

クラスと階層データバインド コントロール クラスの基本クラスとして機能します。 このモジュールでは、次のクラスから派生するデータバインド コントロールについて説明します。

- AdRotator
- リスト コントロール
- GridView
- Formview
- Detailsview

クラスから派生する次のクラスについても説明します。

- TreeView
- メニュー
- Sitemappath

## <a name="databoundcontrol-class"></a>データバインド コントロール クラス

クラスは、テーブル形式またはリスト スタイルのデータを操作するために使用される抽象クラス (VB で MustInherit とマーク) です。 次のコントロールは、データバインド コントロールから派生するコントロールの一部です。

## <a name="adrotator"></a>AdRotator

AdRotator コントロールを使用すると、特定の URL にリンクされている Web ページにグラフィック バナーを表示できます。 表示されるグラフィックは、コントロールのプロパティを使用して回転されます。 ページに表示される特定の広告の頻度は **、インプレッション**プロパティを使用して設定でき、キーワードフィルタリングを使用して広告をフィルタリングできます。

AdRotator コントロールは、XML ファイルまたはデータベース内のテーブルをデータに使用します。 次の属性は、ADRotator コントロールを構成するために XML ファイルで使用されます。

### <a name="imageurl"></a>ImageUrl
広告に表示する画像の URL。

### <a name="navigateurl"></a>Navigateurl
広告がクリックされたときにユーザーが取得する URL。 これは URL エンコードする必要があります。

### <a name="alternatetext"></a>AlternateText
ツールヒントに表示され、スクリーン リーダーによって読み上げされる代替テキスト。 また、ImageUrl で指定されたイメージが使用できない場合にも表示されます。

### <a name="keyword"></a>キーワード
キーワード フィルターを使用するときに使用できるキーワードを定義します。 指定した場合、キーワードフィルターに一致するキーワードを持つ広告のみが表示されます。

### <a name="impressions"></a>インプレッション数
特定の広告が表示される可能性が高い頻度を決定する重み付け番号。 同じファイル内の他の広告の印象に対して相対的です。 XML ファイル内のすべての広告の総インプレッション数の最大値は 2,048,000,000 1 です。

### <a name="height"></a>[高さ]
広告の高さ (ピクセル単位)。

### <a name="width"></a>幅
広告の幅 (ピクセル単位)。

> [!NOTE]
> 高さと幅の属性は、AdRotator コントロール自体の高さと幅をオーバーライドします。

一般的な XML ファイルは、次のようになります。

[!code-xml[Main](data-bound-controls/samples/sample1.xml)]

上記の例では、Contoso の広告は、インプレッション属性の値のために、ASP.NET Web サイトの広告の 2 倍の可能性があります。

上記の XML ファイルから広告を表示するには、AdRotator コントロールをページに追加し、次のように、XML ファイルを指すように **[広告ファイル]** プロパティを設定します。

[!code-aspx[Main](data-bound-controls/samples/sample2.aspx)]

AdRotator コントロールのデータソースとしてデータベーステーブルを使用する場合は、まず、次のスキーマを使用してデータベースを設定する必要があります。

| **列名** | **データ型** | **説明** |
| --- | --- | --- |
| id | INT | 主キー この列には任意の名前を指定できます。 |
| ImageUrl | nvarchar(*長さ*) | 広告に表示するイメージの相対 URL または絶対 URL。 |
| Navigateurl | nvarchar(*長さ*) | 広告のターゲット URL。 値を指定しない場合、広告はハイパーリンクではありません。 |
| AlternateText | nvarchar(*長さ*) | イメージが見つからない場合に表示されるテキスト。 一部のブラウザーでは、テキストはツールヒントとして表示されます。 代替テキストは、グラフィックを見ることができないユーザーが、その説明を声に出して読み上げることができるように、アクセシビリティにも使用されます。 |
| キーワード | nvarchar(*長さ*) | ページがフィルタ処理できる広告のカテゴリ。 |
| インプレッション数 | int(4) | 広告が表示される頻度を示す数値。 数値が大きいほど、広告の表示頻度が高くなります。 XML ファイル内のすべてのインプレッション値の合計は、2,048,000,000 - 1 を超えることはできません。 |
| 幅 | int(4) | イメージの幅 (ピクセル単位)。 |
| [高さ] | int(4) | イメージの高さ (ピクセル単位)。 |

既に別のスキーマを持つデータベースがある場合は、**代替テキスト フィールド****、ImageUrlField**、および**NavigateUrlField**プロパティを使用して、AdRotator 属性を既存のデータベースにマップできます。 AdRotator コントロールにデータベースからデータを表示するには、ページにデータ ソース コントロールを追加し、データベースを指すデータ ソース コントロールの接続文字列を構成し、AdRotator コントロールの**DataSourceID**プロパティをデータ ソース コントロールの ID に設定します。 プログラムで AdRotator 広告を設定する必要がある場合は、AdCreated イベントを使用します。 AdCreated イベントは 2 つのパラメータを受け取ります。1 つのオブジェクトと、もう 1 つのインスタンスが AdCreatedEventArgs です。 AdCreatedEventArgs は、作成される広告への参照です。

次のコード スニペットでは、プログラムによって広告の ImageUrl、NavigateUrl、および代替テキストを設定します。

[!code-csharp[Main](data-bound-controls/samples/sample3.cs)]

## <a name="list-controls"></a>リスト コントロール

リスト コントロールには、リスト ボックス、ドロップダウン リスト、チェック ボックス リスト、ラジオ ボタンリスト、箇条書きリストなどがあります。 これらの各コントロールは、データ ソースにデータ バインドできます。 表示テキストとしてデータ ソース内の 1 つのフィールドを使用し、オプションで 2 番目のフィールドを項目の値として使用できます。 また、デザイン時に静的に項目を追加したり、静的な項目とデータ ソースから追加した動的アイテムを混在させることもできます。

リスト コントロールをデータ バインドするには、ページにデータ ソース コントロールを追加します。 データ ソース コントロールの SELECT コマンドを指定し、リスト コントロールの DataSourceID プロパティをデータ ソース コントロールの ID に設定します。 コントロールの表示テキストと値を定義するには **、DataTextField**プロパティと**DataValueField**プロパティを使用します。 また、**次**のように表示テキストの外観を制御するのにプロパティを使用できます。

| **式** | **説明** |
| --- | --- |
| 価格：{0:C} | 数値/10 進データの場合。 リテラルの "Price:" の後に、通貨形式の数値を表示します。 通貨形式は **、Page**ディレクティブまたは Web.config ファイルのカルチャ属性で指定されたカルチャ設定によって異なります。 |
| {0:D4} | 整数データの場合。 10 進数では使用できません。 整数は、4 文字幅のゼロパッドフィールドに表示されます。 |
| {0:N2}% | 数値データの場合。 小数点以下の桁数が 2 桁の数値の後にリテラル "%" が続く数値を表示します。 |
| {0:000.0} | 数値/10 進データの場合。 数値は小数点以下 1 桁に丸められます。 3 桁に満たない場合はゼロで埋めます。 |
| {0:D} | 日付/時刻データの場合。 長い日付形式を表示します (「1996 年 8 月 6 日木曜日」)。 使用される日付の形式は、ページまたは Web.config ファイルのカルチャ設定によって決まります。 |
| {0:d} | 日付/時刻データの場合。 短い日付形式を表示します ("12/31/99")。 |
| {0:yy-MM-dd} | 日付/時刻データの場合。 日付を数値の年月日形式で表示します (96-08-06) |

## <a name="gridview"></a>GridView

GridView コントロールは、表形式のデータの表示と、宣言型のアプローチを使用して編集を可能にし、DataGrid コントロールの後継です。 次の機能は、GridView コントロールで使用できます。

- データ ソース コントロールへのバインド (SqlDataSource など)。
- 組み込みの並べ替え機能。
- 組み込みの更新機能と削除機能。
- 組み込みのページング機能。
- 組み込みの行選択機能。
- プロパティの動的な設定、イベントの処理などを行う GridView オブジェクト モデルへのプログラムによるアクセス。
- 複数のキー フィールド。
- ハイパーリンク列の複数のデータ フィールド。
- テーマやスタイルを通じてカスタマイズ可能な外観。

**列フィールド**

コントロール内の各列は、データコントロール フィールドオブジェクトによって表されます。 既定では、AutoGenerateColumns プロパティは**true**に設定され、データ ソースの各フィールドに対して AutoGeneratedField オブジェクトが作成されます。 各フィールドは、データ ソースに表示される順序で GridView コントロールの列として表示されます。 また **、"AutoGenerateColumns/自動生成列"** プロパティを**false**に設定し、独自の列フィールド コレクションを定義することで **、GridView**コントロールに表示する列フィールドを手動で制御することもできます。 さまざまな列フィールドの種類によって、コントロール内の列の動作が決まります。

次の表は、使用できるさまざまな列フィールドの種類を示しています。

| **列フィールドの種類** | **説明** |
| --- | --- |
| BoundField | データ ソース内のフィールドの値を表示します。 これは、GridView コントロールの既定の列の種類です。 |
| ButtonField | GridView コントロール内の各項目のコマンド ボタンを表示します。 これにより、追加ボタンや削除ボタンなどのカスタムボタンコントロールの列を作成できます。 |
| CheckBoxField | GridView コントロール内の各項目のチェック ボックスを表示します。 この列フィールド型は、通常、ブール値を持つフィールドを表示するために使用されます。 |
| CommandField | 選択、編集、または削除操作を実行する定義済みのコマンド ボタンを表示します。 |
| HyperLinkField | データ ソース内のフィールドの値をハイパーリンクとして表示します。 この列フィールドの種類を使用すると、2 番目のフィールドをハイパーリンクの URL にバインドできます。 |
| ImageField | GridView コントロール内の各項目のイメージを表示します。 |
| Templatefield | 指定したテンプレートに従って、GridView コントロール内の各項目のユーザー定義のコンテンツを表示します。 この列フィールドの種類を使用すると、ユーザー設定の列フィールドを作成できます。 |

列フィールド コレクションを宣言によって定義するには、最初に、GridView コントロールの開始タグと終了タグの間に開始**&lt;および終了の列&gt;** タグを追加します。 次に、開始と終了の列タグの間に含める**&lt;列フィールドを&gt;一覧表示します**。 指定された列は、リストされた順序で Columns コレクションに追加されます。 **Columns**コレクションは、コントロール内のすべての列フィールドを格納し、GridView コントロール内の列フィールドをプログラムで管理できます。

明示的に宣言された列フィールドは、自動的に生成された列フィールドと組み合わせて表示できます。 両方を使用する場合は、明示的に宣言された列フィールドが最初にレンダリングされ、次に自動的に生成された列フィールドがレンダリングされます。

## <a name="binding-to-data"></a>データへのバインド

コントロールは、データ ソース コントロール **(SqlDataSource、ObjectDataSource**など**ObjectDataSource**) と、System.Collections.IEnumerable インターフェイスを実装する任意のデータ ソース (システム.データ.データビュー、システム コレクション.配列リスト、またはシステム.コレクション.ハッシュテーブルなど) にバインドできます。 GridView コントロールを適切なデータ ソースの種類にバインドするには、次のいずれかのメソッドを使用します。

- データ ソース コントロールにバインドするには、GridView コントロールの DataSourceID プロパティをデータ ソース コントロールの ID 値に設定します。 GridView コントロールは、指定されたデータ ソース コントロールに自動的にバインドし、並べ替え、更新、削除、およびページングの機能を実行するデータ ソース コントロールの機能を利用できます。 これは、データにバインドする場合に推奨される方法です。
- インターフェイスを実装するデータ ソースにバインドするには、プログラムによって GridView コントロールのデータ ソース プロパティをデータ ソースに設定し、DataBind メソッドを呼び出します。 このメソッドを使用する場合、GridView コントロールには、並べ替え、更新、削除、およびページングの組み込みの機能は用意されていません。 この機能は、自分で提供する必要があります。

## <a name="data-operations"></a>データ操作

GridView コントロールには、ユーザーが並べ替え、更新、削除、選択、およびコントロール内の項目をページ処理できる多くの組み込み機能が用意されています。 GridView コントロールがデータ ソース コントロールにバインドされている場合、GridView コントロールは、データ ソース コントロールの機能を利用して、自動的に並べ替え、更新、および削除機能を提供できます。

> [!NOTE]
> GridView コントロールは、並べ替え、更新、および他の種類のデータ ソースを使用して削除をサポートできます。ただし、これらの操作の実装に適切なイベント ハンドラーを提供する必要があります。

並べ替えを使用すると、ユーザーは列のヘッダーをクリックして、特定の列に対して GridView コントロール内の項目を並べ替えることができます。 並べ替えを有効にするには、"AllowSorting/並べ替えの許可" プロパティを**true**に設定します。

ボタン**フィールド**列または**TemplateField**列フィールドのボタンで、コマンド名がそれぞれ「編集」、「削除」、「選択」のボタンがクリックされると、自動更新、削除、および選択機能が有効になります。 コントロールは、それぞれ [編集]ボタン、削除ボタン、または [選択] ボタンを持つ**コマンド フィールド**列**フィールドを自動的**に追加できます。

> [!NOTE]
> データ ソースへのレコードの挿入は、GridView コントロールで直接サポートされていません。 ただし、GridView コントロールを使用して、レコードを挿入することができます、 DetailsViewまたはフォーム ビュー コントロールを使用します。

GridView コントロールは、データ ソース内のすべてのレコードを同時に表示する代わりに、自動的にレコードをページに分割できます。 ページングを有効にするには、AllowPaging プロパティを**true**に設定します。

## <a name="customizing-the-user-interface"></a>ユーザー インターフェイスのカスタマイズ

コントロールのさまざまな部分のスタイル プロパティを設定することで、GridView コントロールの外観をカスタマイズできます。 次の表は、さまざまなスタイル プロパティの一覧です。

| **スタイル プロパティ** | **説明** |
| --- | --- |
| オルタニングロウスタイル | GridView コントロール内の交互のデータ行のスタイル設定。 このプロパティを設定すると、データ行が行スタイル設定と**代替行スタイル**設定の間で交互に表示されます。 |
| 編集行スタイル | GridView コントロールで編集されている行のスタイル設定。 |
| 空のデータ行スタイル | データ ソースにレコードが含まれていない場合に、GridView コントロールに表示される空のデータ行のスタイル設定。 |
| フッタースタイル | コントロールのフッター行のスタイル設定。 |
| Headerstyle | コントロールのヘッダー行のスタイル設定。 |
| Pagerstyle | コントロールのページャー行のスタイル設定。 |
| 行スタイル | コントロール内のデータ行のスタイル設定。 **プロパティも**設定されている場合、データ行は **、行スタイル**の設定と**代替行スタイル**の設定の間で交互に表示されます。 |
| 選択された行スタイル | コントロール内の選択した行のスタイル設定。 |

コントロールの各部分の表示と非表示を切り替えることもできます。 次の表に、表示または非表示のパーツを制御するプロパティを示します。

| **プロパティ** | **説明** |
| --- | --- |
| フッターを表示する | コントロールのフッター セクションを表示または非表示にします。 |
| Showheader | コントロールのヘッダー セクションを表示または非表示にします。 |

### <a name="events"></a>イベント

GridView コントロールには、プログラミングできるいくつかのイベントが用意されています。 これにより、イベントが発生するたびにカスタム ルーチンを実行できます。 次の表は、GridView コントロールでサポートされるイベントの一覧です。

| **event** | **説明** |
| --- | --- |
| ページインデックスが変更されました | いずれかのページャー ボタンがクリックされたときに、GridView コントロールがページング操作を処理した後に発生します。 このイベントは、通常、ユーザーがコントロール内の別のページに移動した後にタスクを実行する必要がある場合に使用されます。 |
| ページインデックスの変更 | いずれかのページャー ボタンがクリックされたときに、GridView コントロールがページング操作を処理する前に発生します。 このイベントは、ページング操作をキャンセルするためによく使用されます。 |
| 行キャンセル編集 | 行の [キャンセル] ボタンがクリックされた後、GridView コントロールが編集モードを終了する前に発生します。 このイベントは、キャンセル操作を停止するためによく使用されます。 |
| Rowcommand | GridView コントロール内でボタンがクリックされたときに発生します。 このイベントは、コントロール内でボタンがクリックされたときにタスクを実行するためによく使用されます。 |
| 行作成 | コントロールに新しい行が作成されたときに発生します。 このイベントは、行の作成時に行の内容を変更するためによく使用されます。 |
| 行データバインド | データ行が GridView コントロールのデータにバインドされると発生します。 このイベントは、行がデータにバインドされている場合に、行の内容を変更するためによく使用されます。 |
| 行削除済み | 行の削除ボタンがクリックされた後、GridView コントロールがデータ ソースからレコードを削除した後に発生します。 このイベントは、削除操作の結果を確認するためによく使用されます。 |
| 行削除 | 行の [削除] ボタンがクリックされた後、GridView コントロールがデータ ソースからレコードを削除する前に発生します。 このイベントは、削除操作をキャンセルするためによく使用されます。 |
| 行編集 | 行の [編集] ボタンがクリックされたときに、GridView コントロールが編集モードになる前に発生します。 このイベントは、編集操作をキャンセルするためによく使用されます。 |
| 行更新 | 行の更新ボタンがクリックされたときに発生しますが、GridView コントロールが行を更新します。 このイベントは、更新操作の結果をチェックするためによく使用されます。 |
| 行更新 | 行の更新ボタンがクリックされたときに発生しますが、GridView コントロールが行を更新する前に発生します。 このイベントは、更新操作をキャンセルするためによく使用されます。 |
| SelectedIndexChanged | 行の [選択] ボタンがクリックされた後、GridView コントロールが選択操作を処理した後に発生します。 このイベントは、コントロールで行が選択された後にタスクを実行するためによく使用されます。 |
| 選択したインデックスの変更 | 行の [選択] ボタンがクリックされたときに、GridView コントロールが選択操作を処理する前に発生します。 このイベントは、選択操作をキャンセルするためによく使用されます。 |
| 並べ替え | 列を並べ替えるハイパーリンクがクリックされたときに、GridView コントロールが並べ替え操作を処理した後に発生します。 このイベントは、ユーザーがハイパーリンクをクリックして列を並べ替えた後にタスクを実行するためによく使用されます。 |
| 並べ替え | 列を並べ替えるハイパーリンクがクリックされたときに、GridView コントロールが並べ替え操作を処理する前に発生します。 このイベントは、並べ替え操作をキャンセルしたり、カスタムの並べ替えルーチンを実行するためによく使用されます。 |

## <a name="formview"></a>Formview

FormView コントロールは、データ ソースから 1 つのレコードを表示するために使用されます。 これは DetailsView コントロールに似ていますが、行フィールドではなくユーザー定義のテンプレートを表示する点が異なります。 独自のテンプレートを作成すると、データの表示方法を柔軟に制御できます。 フォーム ビュー コントロールは、次の機能をサポートしています。

- データ ソース コントロールへのバインディング (SqlDataSource やオブジェクトデータ ソースなど)。
- 組み込みの挿入機能。
- 組み込みの更新機能と削除機能。
- 組み込みのページング機能。
- プロパティの動的な設定、イベントの処理などを行う FormView オブジェクト モデルへのプログラムによるアクセス。
- ユーザー定義のテンプレート、テーマ、およびスタイルを使用してカスタマイズ可能な外観。

## <a name="templates"></a>テンプレート

FormView コントロールでコンテンツを表示するには、コントロールのさまざまな部分のテンプレートを作成する必要があります。 ほとんどのテンプレートはオプションです。ただし、コントロールが構成されているモード用のテンプレートを作成する必要があります。 たとえば、レコードの挿入をサポートする FormView コントロールには、挿入項目テンプレートが定義されている必要があります。 次の表は、作成できるさまざまなテンプレートの一覧です。

| **テンプレートの種類** | **説明** |
| --- | --- |
| アイテムテンプレートを編集します。 | FormView コントロールが編集モードの場合のデータ行の内容を定義します。 このテンプレートには、通常、ユーザーが既存のレコードを編集できる入力コントロールとコマンド ボタンが含まれています。 |
| データテンプレート | FormView コントロールがレコードを含まないデータ ソースにバインドされている場合に表示される空のデータ行の内容を定義します。 このテンプレートには、通常、データ ソースにレコードが含まれていないことをユーザーに通知するコンテンツが含まれています。 |
| フッターテンプレート | フッター行の内容を定義します。 このテンプレートには、フッター行に表示する追加コンテンツが含まれています。 フッター行に表示するテキストを指定するには、FooterText プロパティを設定します。 |
| ヘッダーテンプレート | ヘッダー行の内容を定義します。 このテンプレートには、通常、ヘッダー行に表示する追加のコンテンツが含まれています。 代わりに、HeaderText プロパティを設定することで、ヘッダー行に表示するテキストを指定することもできます。 |
| ItemTemplate | FormView コントロールが読み取り専用モードの場合のデータ行の内容を定義します。 このテンプレートには、通常、既存のレコードの値を表示するコンテンツが含まれています。 |
| アイテムテンプレートを挿入します。 | FormView コントロールが挿入モードの場合のデータ行の内容を定義します。 このテンプレートには、通常、ユーザーが新しいレコードを追加できる入力コントロールとコマンド ボタンが含まれています。 |
| ポケットベルテンプレート | ページング機能が有効になっている場合 (AllowPaging プロパティが**true**に設定されている場合)、ページング機能が有効になっているときに表示されるページ行の内容を定義します。 このテンプレートには、通常、ユーザーが別のレコードに移動できるコントロールが含まれています。 |

編集項目テンプレートおよび挿入項目テンプレートの入力コントロールは、双方向のバインド式を使用してデータ ソースのフィールドにバインドできます。 これにより、FormView コントロールは、更新操作または挿入操作の入力コントロールの値を自動的に抽出できます。 双方向のバインド式を使用すると、編集項目テンプレートの入力コントロールで元のフィールド値を自動的に表示することもできます。

### <a name="binding-to-data"></a>データへのバインド

フォームビュー コントロールは、データ ソース コントロール **(SqlDataSource、AccessDataSource、****オブジェクトデータソース**など) または System.Collections.IEnumerable インターフェイスを実装する任意のデータ ソース (システム.データ.データビュー、システム コレクション.配列リスト、システム.コレクション.ハッシュテーブルなど) にバインドできます。 FormView コントロールを適切なデータ ソースの種類にバインドするには、次のいずれかの方法を使用します。

- データ ソース コントロールにバインドするには、FormView コントロールの DataSourceID プロパティをデータ ソース コントロールの ID 値に設定します。 FormView コントロールは、指定されたデータ ソース コントロールに自動的にバインドし、挿入、更新、削除、およびページング機能を実行するデータ ソース コントロールの機能を利用できます。 これは、データにバインドする場合に推奨される方法です。
- **インターフェイス**を実装するデータ ソースにバインドするには、プログラムによって FormView コントロールのデータ ソース プロパティをデータ ソースに設定し、DataBind メソッドを呼び出します。 このメソッドを使用する場合、FormView コントロールには、挿入、更新、削除、およびページングの組み込みの機能は用意されていません。 適切なイベントを使用して、この機能を提供する必要があります。

## <a name="data-operations"></a>データ操作

FormView コントロールには、ユーザーがコントロール内の項目を更新、削除、挿入、およびページを作成できる、多くの組み込み機能が用意されています。 FormView コントロールがデータ ソース コントロールにバインドされている場合、FormView コントロールは、データ ソース コントロールの機能を利用して、自動更新、削除、挿入、およびページング機能を提供できます。 FormView コントロールは、他の種類のデータ ソースとの更新、削除、挿入、およびページング操作をサポートできます。ただし、これらの操作の実装に適切なイベント ハンドラーを提供する必要があります。

FormView コントロールはテンプレートを使用するため、更新、削除、または挿入操作を実行するコマンド ボタンを自動的に生成する方法を提供しません。 これらのコマンド ボタンは、適切なテンプレートに手動で含める必要があります。 コントロールは、特定の値に設定されている**コマンド名**のプロパティを持つ特定のボタンを認識します。 次の表は、FormView コントロールが認識するコマンド ボタンの一覧です。

| **ボタン** | **コマンド名の値** | **説明** |
| --- | --- | --- |
| Cancel | "キャンセル" | 操作をキャンセルし、ユーザーが入力した値を破棄するために、更新または挿入操作で使用されます。 その後、コントロールは、DefaultMode プロパティで指定されたモードに戻ります。 |
| 削除 | "削除" | データ ソースから表示されているレコードを削除する操作を削除するときに使用します。 イベントを発生させます。 |
| [編集] | "編集" | FormView コントロールを編集モードにするための更新操作で使用されます。 **プロパティで**指定されたコンテンツがデータ行に表示されます。 |
| 挿入 | "挿入" | ユーザーが指定した値を使用して、データ ソースに新しいレコードを挿入しようとする操作を挿入するときに使用します。 アイテム挿入イベントとアイテム挿入イベントを発生させます。 |
| 新規作成 | 「新しい」 | FormView コントロールを挿入モードにするための挿入操作で使用されます。 **プロパティで**指定された内容がデータ行に表示されます。 |
| ページ | 「ページ」 | ページング操作で使用され、ページングを実行するページ行のボタンを表します。 ページング操作を指定するには、ボタンの**CommandArgument**プロパティを "Next" ""前へ" """"最初"、"Last"、または移動先のページのインデックスに設定します。 イベントを発生させます。 |
| 更新 | "更新" | 更新操作で、ユーザーが指定した値を使用してデータ ソースに表示されているレコードを更新するために使用されます。 イベントを発生させます。 |

[削除] ボタン (表示されているレコードをすぐに削除する) とは異なり、[編集] または [新規作成] ボタンをクリックすると、FormView コントロールはそれぞれ編集モードまたは挿入モードになります。 編集モードでは、現在のデータ項目に対して**EditItemTemplate**プロパティに含まれるコンテンツが表示されます。 通常、編集項目テンプレートは、[編集] ボタンが [更新] ボタンと [キャンセル] ボタンに置き換えられるような定義になります。 フィールドのデータ型 (TextBox や CheckBox コントロールなど) に適した入力コントロールも、通常はユーザーが変更するフィールドの値と共に表示されます。 [更新] ボタンをクリックするとデータ ソースのレコードが更新されますが、[キャンセル] ボタンをクリックすると変更は破棄されます。

同様に、コントロールが挿入モードの場合は **、InsertItemTemplate**プロパティに含まれるコンテンツがデータ項目に対して表示されます。 項目の挿入テンプレートは通常、新規ボタンが挿入ボタンとキャンセルボタンに置き換えられ、ユーザーが新しいレコードの値を入力するための空の入力コントロールが表示されるように定義されます。 [挿入] ボタンをクリックするとデータ ソースにレコードが挿入され、[キャンセル] ボタンをクリックすると変更が破棄されます。

FormView コントロールには、ユーザーがデータ ソース内の他のレコードに移動できるようにするページング機能が用意されています。 有効にすると、ページ ナビゲーション コントロールを含む FormView コントロールにページャー行が表示されます。 ページングを有効にするには **、AllowPaging**プロパティを**true**に設定します。 PagerStyle プロパティおよび PagerSettings プロパティに含まれるオブジェクトのプロパティを設定することで、ページャー行をカスタマイズできます。 組み込みのページャー行 UI を使用する代わりに **、PagerTemplate**プロパティを使用して独自の UI を作成できます。

## <a name="customizing-the-user-interface"></a>ユーザー インターフェイスのカスタマイズ

FormView コントロールの外観をカスタマイズするには、コントロールのさまざまな部分のスタイル プロパティを設定します。 次の表は、さまざまなスタイル プロパティの一覧です。

| **スタイル プロパティ** | **説明** |
| --- | --- |
| 編集行スタイル | FormView コントロールが編集モードの場合のデータ行のスタイル設定。 |
| 空のデータ行スタイル | データ ソースにレコードが含まれていない場合に FormView コントロールに表示される空のデータ行のスタイル設定。 |
| フッタースタイル | FormView コントロールのフッター行のスタイル設定。 |
| Headerstyle | FormView コントロールのヘッダー行のスタイル設定。 |
| 挿入行スタイル | FormView コントロールが挿入モードの場合のデータ行のスタイル設定。 |
| Pagerstyle | ページング機能が有効な場合に FormView コントロールに表示されるページ行のスタイル設定。 |
| 行スタイル | FormView コントロールが読み取り専用モードの場合のデータ行のスタイル設定。 |

## <a name="events"></a>イベント

FormView コントロールには、プログラミングできるいくつかのイベントが用意されています。 これにより、イベントが発生するたびにカスタム ルーチンを実行できます。 次の表は、FormView コントロールでサポートされるイベントの一覧です。

| **event** | **説明** |
| --- | --- |
| Itemcommand | FormView コントロール内のボタンがクリックされたときに発生します。 このイベントは、コントロール内でボタンがクリックされたときにタスクを実行するためによく使用されます。 |
| Itemcreated | すべての FormViewRow オブジェクトがフォームビュー コントロールに作成された後に発生します。 このイベントは、レコードが表示される前にレコードの値を変更するためによく使用されます。 |
| アイテム削除済み | 削除ボタン **(CommandName**プロパティが "Delete" に設定されているボタン) がクリックされた後に発生します。 このイベントは、削除操作の結果を確認するためによく使用されます。 |
| アイテムの削除 | [削除] ボタンがクリックされた後、FormView コントロールがデータ ソースからレコードを削除する前に発生します。 このイベントは、削除操作をキャンセルするためによく使用されます。 |
| アイテム挿入済み | 挿入ボタン **(CommandName**プロパティが "Insert" に設定されているボタン) がクリックされた後に、FormView コントロールによってレコードが挿入された後に発生します。 このイベントは、挿入操作の結果をチェックするためによく使用されます。 |
| アイテム挿入 | 挿入ボタンがクリックされたときに、FormView コントロールがレコードを挿入する前に発生します。 このイベントは、挿入操作をキャンセルするためによく使用されます。 |
| Itemupdated | 更新ボタン **(CommandName**プロパティが "Update" に設定されているボタン) がクリックされた後に発生しますが、FormView コントロールが行を更新します。 このイベントは、更新操作の結果をチェックするためによく使用されます。 |
| アイテム更新 | 更新ボタンがクリックされたときに発生しますが、FormView コントロールがレコードを更新する前に発生します。 このイベントは、更新操作をキャンセルするためによく使用されます。 |
| モード変更 | FormView コントロールがモードを変更した後 (編集、挿入、または読み取り専用モード) した後に発生します。 このイベントは、FormView コントロールがモードを変更するときにタスクを実行するためによく使用されます。 |
| モード変更 | FormView コントロールがモードを変更する前に発生します (編集、挿入、または読み取り専用モード)。 このイベントは、モードの変更をキャンセルするためによく使用されます。 |
| ページインデックスが変更されました | いずれかのページャー ボタンがクリックされたときに発生しますが、FormView コントロールがページング操作を処理します。 このイベントは、通常、ユーザーがコントロール内の別のレコードに移動した後にタスクを実行する必要がある場合に使用されます。 |
| ページインデックスの変更 | いずれかのページャー ボタンがクリックされたときに発生しますが、FormView コントロールがページング操作を処理する前に発生します。 このイベントは、ページング操作をキャンセルするためによく使用されます。 |

## <a name="detailsview"></a>Detailsview

DetailsView コントロールは、テーブル内のデータ ソースから 1 つのレコードを表示するために使用され、レコードの各フィールドは、テーブルの行に表示されます。 マスター/詳細シナリオの GridView コントロールと組み合わせて使用できます。 DetailsView コントロールは、次の機能をサポートしています。

- データ ソース コントロールへのバインド (SqlDataSource など)。
- 組み込みの挿入機能。
- 組み込みの更新機能と削除機能。
- 組み込みのページング機能。
- プロパティの動的な設定、イベントの処理などを行う DetailsView オブジェクト モデルへのプログラムによるアクセス。
- テーマやスタイルを通じてカスタマイズ可能な外観。

## <a name="row-fields"></a>行フィールド

DetailsView コントロールの各データ行は、フィールド コントロールを宣言することによって作成されます。 コントロール内の行の動作は、さまざまな行フィールドの種類によって決まります。 フィールド コントロールは、データコントロール フィールドから派生します。 次の表は、使用できるさまざまな行フィールドの種類を示しています。

| **列フィールドの種類** | **説明** |
| --- | --- |
| BoundField | データ ソース内のフィールドの値をテキストとして表示します。 |
| ButtonField | コントロールにコマンド ボタンを表示します。 これにより、追加ボタンや削除ボタンなどのカスタムボタンコントロールを含む行を表示できます。 |
| CheckBoxField | コントロールにチェック ボックスを表示します。 この行フィールド型は、通常、ブール値を持つフィールドを表示するために使用されます。 |
| CommandField | DetailsView コントロールで編集、挿入、または削除操作を実行する組み込みのコマンド ボタンを表示します。 |
| HyperLinkField | データ ソース内のフィールドの値をハイパーリンクとして表示します。 この行フィールドの種類を使用すると、2 番目のフィールドをハイパーリンクの URL にバインドできます。 |
| ImageField | DetailsView コントロールにイメージを表示します。 |
| Templatefield | 指定したテンプレートに従って DetailsView コントロールの行のユーザー定義コンテンツを表示します。 この行フィールドの種類を使用すると、ユーザー設定の行フィールドを作成できます。 |

既定では、AutoGenerateRows プロパティは**true**に設定され、データ ソース内のバインド可能な型の各フィールドに対してバインドされた行フィールド オブジェクトが自動的に生成されます。 有効なバインド可能な型は、文字列、日付時刻、10 進数、GUID、およびプリミティブ型のセットです。 各フィールドは、データ ソース内の各フィールドの表示順に、テキストとして行に表示されます。

行を自動的に生成すると、レコード内のすべてのフィールドをすばやく簡単に表示できます。 ただし、DetailsView コントロールの高度な機能を使用するには、DetailsView コントロールに含める行フィールドを明示的に宣言する必要があります。 行フィールドを宣言するには、まず**AutoGenerateRows**プロパティを**false**に設定します。 次に、DetailsView**&lt;コントロール&gt;** の開始タグと終了タグの間に開始フィールド タグと終了フィールド タグを追加します。 最後に、開始フィールド タグと終了フィールド タグの間に含める行**&lt;フィールド&gt;** を一覧表示します。 指定された行フィールドは、一覧の順序で Fields コレクションに追加されます。 **Fields**コレクションを使用すると、DetailsView コントロールの行フィールドをプログラムで管理できます。

> [!NOTE]
> 自動的に生成された行フィールドは、Fields コレクションに追加されません。

## <a name="binding-to-data"></a>データへのバインド

コントロールは **、SqlDataSource**や AccessDataSource などのデータ ソース コントロール、または System.Data.DataView、システム コレクション.配列リスト、システム.コレクション.ハッシュテーブルなどのインターフェイスを実装する任意のデータ ソースにバインドできます。

DetailsView コントロールを適切なデータ ソースの種類にバインドするには、次のいずれかの方法を使用します。

- データ ソース コントロールにバインドするには、DetailsView コントロールの DataSourceID プロパティをデータ ソース コントロールの ID 値に設定します。 DetailsView コントロールは、指定したデータ ソース コントロールに自動的にバインドします。 これは、データにバインドする場合に推奨される方法です。
- **インターフェイス**を実装するデータ ソースにバインドするには、プログラムによって、DetailsView コントロールの DataSource プロパティをデータ ソースに設定し、DataBind メソッドを呼び出します。

## <a name="security"></a>セキュリティ

このコントロールを使用して、悪意のあるクライアント スクリプトを含むユーザー入力を表示できます。 実行可能スクリプト、SQL ステートメント、またはその他のコードがアプリケーションで表示される前に、クライアントから送信される情報を確認します。 ASP.NETは、ユーザー入力でスクリプトと HTML をブロックする入力要求検証機能を提供します。

## <a name="data-operations"></a>データ操作

DetailsView コントロールには、ユーザーがコントロール内の項目を更新、削除、挿入、およびページを作成できる組み込み機能が用意されています。 DetailsView コントロールがデータ ソース コントロールにバインドされている場合、DetailsView コントロールは、データ ソース コントロールの機能を利用して、自動更新、削除、挿入、およびページング機能を提供できます。

DetailsView コントロールは、他の種類のデータ ソースとの更新、削除、挿入、およびページング操作をサポートできます。ただし、これらの操作の実装は、適切なイベント ハンドラーで提供する必要があります。

コントロールは、それぞれ True に設定して、編集、削除、または新規作成ボタンを持つ**コマンド フィールド**行**フィールドを追加**できます。 [削除] ボタン (選択したレコードを直ちに削除する) とは異なり、[編集] または [新規作成] ボタンをクリックすると、DetailsView コントロールはそれぞれ編集モードまたは挿入モードに切り替わります。 編集モードでは、[編集] ボタンが [更新] ボタンと [キャンセル] ボタンに置き換えられます。 フィールドのデータ型 (TextBox や CheckBox コントロールなど) に適した入力コントロールが、ユーザーが変更できるようにフィールドの値と共に表示されます。 [更新] ボタンをクリックするとデータ ソースのレコードが更新されますが、[キャンセル] ボタンをクリックすると変更は破棄されます。 同様に、挿入モードでは、[新規] ボタンが [挿入] ボタンと [キャンセル] ボタンに置き換えられ、ユーザーが新しいレコードの値を入力するための空の入力コントロールが表示されます。

DetailsView コントロールは、ユーザーがデータ ソース内の他のレコードに移動できるようにするページング機能を提供します。 有効にすると、ページ ナビゲーション コントロールがページ行に表示されます。 ページングを有効にするには、AllowPaging プロパティを**true**に設定します。 ページャー行は、PagerStyle プロパティと PagerSettings プロパティを使用してカスタマイズできます。

## <a name="customizing-the-user-interface"></a>ユーザー インターフェイスのカスタマイズ

DetailsView コントロールの外観をカスタマイズするには、コントロールのさまざまな部分のスタイル プロパティを設定します。 次の表は、さまざまなスタイル プロパティの一覧です。

| **スタイル プロパティ** | **説明** |
| --- | --- |
| オルタニングロウスタイル | DetailsView コントロール内の交互のデータ行のスタイル設定。 このプロパティを設定すると、データ行が行スタイル設定と**代替行スタイル**設定の間で交互に表示されます。 |
| コマンド行スタイル | DetailsView コントロールの組み込みコマンド ボタンを含む行のスタイル設定。 |
| 編集行スタイル | DetailsView コントロールが編集モードの場合のデータ行のスタイル設定。 |
| 空のデータ行スタイル | データ ソースにレコードが含まれていないときに DetailsView コントロールに表示される空のデータ行のスタイル設定。 |
| フッタースタイル | DetailsView コントロールのフッター行のスタイル設定。 |
| Headerstyle | DetailsView コントロールのヘッダー行のスタイル設定。 |
| 挿入行スタイル | DetailsView コントロールが挿入モードの場合のデータ行のスタイル設定。 |
| Pagerstyle | DetailsView コントロールのページャー行のスタイル設定。 |
| 行スタイル | コントロール内のデータ行のスタイル設定。 **プロパティも**設定されている場合、データ行は **、行スタイル**の設定と**代替行スタイル**の設定の間で交互に表示されます。 |
| フィールドヘッダースタイル | コントロールのヘッダー列のスタイル設定。 |

## <a name="events"></a>イベント

DetailsView コントロールには、プログラミングできるいくつかのイベントが用意されています。 これにより、イベントが発生するたびにカスタム ルーチンを実行できます。 次の表は、DetailsView コントロールでサポートされるイベントの一覧です。 DetailsView コントロールは、基本クラスからこれらのイベントを継承します。

| **event** | **説明** |
| --- | --- |
| Itemcommand | DetailsView コントロールでボタンがクリックされたときに発生します。 |
| Itemcreated | すべての DetailsViewRow オブジェクトが DetailsView コントロールに作成された後に発生します。 このイベントは、レコードが表示される前にレコードの値を変更するためによく使用されます。 |
| アイテム削除済み | [削除] ボタンがクリックされた後に発生しますが、DetailsView コントロールがデータ ソースからレコードを削除します。 このイベントは、削除操作の結果を確認するためによく使用されます。 |
| アイテムの削除 | [削除] ボタンがクリックされた後、DetailsView コントロールがデータ ソースからレコードを削除する前に発生します。 このイベントは、削除操作をキャンセルするためによく使用されます。 |
| アイテム挿入済み | 挿入ボタンがクリックされたときに発生しますが、DetailsView コントロールがレコードを挿入します。 このイベントは、挿入操作の結果をチェックするためによく使用されます。 |
| アイテム挿入 | 挿入ボタンがクリックされたときに発生しますが、DetailsView コントロールがレコードを挿入する前に発生します。 このイベントは、挿入操作をキャンセルするためによく使用されます。 |
| Itemupdated | 更新ボタンがクリックされたときに発生しますが、DetailsView コントロールが行を更新します。 このイベントは、更新操作の結果をチェックするためによく使用されます。 |
| アイテム更新 | 更新ボタンがクリックされたときに発生しますが、DetailsView コントロールがレコードを更新する前に発生します。 このイベントは、更新操作をキャンセルするためによく使用されます。 |
| モード変更 | DetailsView コントロールがモード (編集、挿入、または読み取り専用モード) を変更した後に発生します。 このイベントは、DetailsView コントロールがモードを変更するときにタスクを実行するためによく使用されます。 |
| モード変更 | DetailsView コントロールがモード (編集、挿入、または読み取り専用モード) を変更する前に発生します。 このイベントは、モードの変更をキャンセルするためによく使用されます。 |
| ページインデックスが変更されました | いずれかのページャー ボタンがクリックされたときに発生しますが、DetailsView コントロールがページング操作を処理します。 このイベントは、通常、ユーザーがコントロール内の別のレコードに移動した後にタスクを実行する必要がある場合に使用されます。 |
| ページインデックスの変更 | いずれかのページャー ボタンがクリックされたときに発生しますが、DetailsView コントロールがページング操作を処理する前に発生します。 このイベントは、ページング操作をキャンセルするためによく使用されます。 |

## <a name="the-menu-control"></a>メニュー コントロール

ASP.NET 2.0 の Menu コントロールは、フル機能のナビゲーション システムとして設計されています。 これは、サイトマップデータ ソースなどの階層データ ソースに簡単にデータ バインドできます。

Menu コントロール構造は、宣言的または動的に定義でき、1 つのルート ノードと任意の数のサブノードで構成されます。 次のコードは、Menu コントロールのメニューを宣言によって定義します。

[!code-aspx[Main](data-bound-controls/samples/sample4.aspx)]

上の例では、ホーム.aspx ノードがルート ノードです。 他のすべてのノードは、さまざまなレベルでルート ノード内にネストされます。

Menu コントロールで表示できるメニューには、次の 2 種類があります。静的メニューと動的メニュー。 静的メニューは、常に表示されるメニュー項目で構成されます。 動的メニューは、ユーザーがマウスでメニュー項目の上に置いたときにだけ表示されるメニュー項目で構成されます。 静的メニューは、宣言的に定義されたメニューや動的メニューと実行時にデータバインドされるメニューと混同することがよくあります。 実際、動的メニューと静的メニューは、人口の方法とは無関係です。 *静的*および*動的*という用語は、メニューがデフォルトで静的に表示されるか、ユーザーが何らかのアクションを実行したときにのみ表示されるかどうかを示します。

**StaticDisplayLevels**プロパティは、メニューのレベルが静的で、既定で表示されるレベルの数を構成するために使用されます。 上の例では **、StaticDisplayLevels**プロパティを 2 の値に設定すると、メニューにホーム ノード、ミュージック ノード、および Movies ノードが静的に表示されます。 他のすべてのノードは、ユーザーが親ノードにカーソルを合わせると動的に表示されます。

プロパティ**は**、メニューが表示できる動的レベルの最大数を構成します。 **プロパティ**で指定された値より高いレベルの動的メニューは破棄されます。

> [!NOTE]
> "MaximumDynamicDisplayLevels/最大動的表示レベル" プロパティが原因でメニューが表示されない状況が発生する可能性があることは、ほぼ確実です。 このような場合は、顧客メニューの表示を可能にするプロパティが十分に設定されていることを確認します。

## <a name="data-binding-the-menu-control"></a>メニュー コントロールのデータ バインディング

メニュー コントロールは、サイトマップ データ ソースや XML データ ソースなどの任意の階層データ ソースにバインドできます。 SiteMapDataSource は、Web.sitemap ファイルからフィードオフし、そのスキーマがメニュー コントロールに既知の API を提供するため、メニュー コントロールにデータ バインディングの最も一般的な方法です。 以下のリストは、単純な Web.sitemap ファイルを示しています。

[!code-xml[Main](data-bound-controls/samples/sample5.xml)]

ルート要素が 1 つだけであることに注意してください。 各サイトマップノードに対して、いくつかの属性を設定できます。 最も一般的に使用される属性は次のとおりです。

- **url**ユーザーがメニュー項目をクリックしたときに表示する URL を指定します。 この属性が存在しない場合、ノードはクリックされたときにポストバックします。
- **タイトル**メニュー項目に表示されるテキストを指定します。
- **説明**ノードのドキュメントとして使用されます。 マウスをノード上に置くと、ツールチップとしても表示されます。
- **ファイル**ネストされたサイトマップを許可します。 この属性は、整形式のASP.NETサイトマップ ファイルを指している必要があります。
- **役割**セキュリティ トリミングをASP.NETして、ノードの外観を制御できます。

これらの属性はすべてオプションですが、メニューの動作が指定されていない場合は期待できない場合があることに注意してください。 たとえば *、url*属性が指定されているが *、説明*属性が指定されていない場合、ノードは表示されず、指定された URL に移動する方法はありません。

## <a name="controlling-a-menus-operation"></a>メニュー操作の制御

ASP.NET Menu コントロールの操作に影響を与えるプロパティはいくつかあります。プロパティ **、****消し後**のプロパティ、**プロパティ**、および**プロパティ**は、これらのほんの一部です。

- **方向**は *、水平*または*垂直*のいずれかに設定でき、静的メニュー項目を水平に配置するか、縦に並べて、互いに積み重ねるかを制御します。 このプロパティは、動的メニューには影響しません。
- **"消える"** プロパティは、マウスを移動した後に動的メニューを表示したままにする期間を設定します。 この値はミリ秒単位で指定され、デフォルトは 500 です。 このプロパティに値 -1 を設定すると、メニューが自動的に消えることはありません。 その場合、ユーザーがメニューの外側をクリックした場合にのみ、メニューが表示されなくなります。
- プロパティ**を**使用すると、メニュー システムで一貫した動詞を簡単に維持できます。 このプロパティを指定する場合*{0}* は、データ ソースに表示される説明の代わりに入力する必要があります。 たとえば、練習 1 のメニュー項目に「製品ページの訪問」と表示するには、静的アイテムの書式文字列に{0}[ページを表示] を指定します。 実行時に、ASP.NETは、すべての出現箇所{0}をメニュー項目の正しい説明に置き換えます。
- プロパティ**は**、特定のメニュー ノードに、その上にマウス ポインターを置いてアクセスできる子ノードがあることを示すために使用されるイメージを指定します。 動的メニューは、引き続きデフォルトイメージを使用します。

## <a name="templated-menu-controls"></a>テンプレート化されたメニュー コントロール

Menu コントロールはテンプレート コントロールであり、2 つの異なる ItemTemplates を使用できます。をクリックします。 これらのテンプレートを使用すると、サーバー コントロールやユーザー コントロールをメニューに簡単に追加できます。

Visual Studio .NET でテンプレートを編集するには、メニューの [スマート タグ] ボタンをクリックし、[テンプレートの編集] を選択します。 その後、編集するか、または動的アイテム テンプレートを編集するかを選択できます。

ページが読み込まれると、StaticItemTemplate に追加されたコントロールが静的メニューに表示されます。 DynamicItemTemplate に追加されたコントロールは、すべてのポップアップ メニューに表示されます。

## <a name="menu-events"></a>メニューイベント

Menu コントロールには、そのコントロールに固有の 2 つのイベントがあります。**イベントをクリックします**。 **MenuItemDatabound**

メニュー項目がクリックされると、MenuItemClicked イベントが発生します。 メニュー項目がデータバインドされると、MenuItemDatabound イベントが発生します。 イベント ハンドラーに渡される**MenuEventArgs**は、Item プロパティを介してメニュー項目へのアクセスを提供します。

## <a name="controlling-a-menus-appearance"></a>メニューの外観をコントロールする

メニューコントロールの外観は、メニューの書式設定に使用できる 1 つ以上のスタイルを使用して変更することもできます。 これらの中には、**静的メニュースタイル**、**ダイナミックメニュースタイル**、**ダイナミックメニュースタイル**、**ダイナミック選択スタイル**、および**ダイナミックホバースタイルがあります**。 これらのプロパティは、標準の HTML スタイル文字列を使用して構成されます。 たとえば、次の例は動的メニューのスタイルに影響します。

[!code-aspx[Main](data-bound-controls/samples/sample6.aspx)]

> [!NOTE]
> いずれかのホバー スタイルを使用している場合は *、runat*要素を&lt;&gt; *server*に設定したページに head 要素を追加する必要があります。

メニュー コントロールは、2.0 テーマASP.NET使用もサポートしています。

## <a name="the-treeview-control"></a>ツリー ビュー コントロール

TreeView コントロールは、ツリーのような構造でデータを表示します。 Menu コントロールと同様に、サイトマップ データ ソースなどの階層データ ソースに簡単にデータをバインドできます。

ASP.NET 2.0 で TreeView コントロールについて最初に質問される質問は、ASP.NET 1.x で利用可能であった TreeView IE WebControl に関連しているかどうかです。 そうじゃないです。 ASP.NET 2.0 TreeView コントロールは、最初から書き込まれ、以前に利用可能だった IE ツリービュー Web コントロールよりも大幅に改善されています。

TreeView コントロールをサイト マップにバインドする方法については、Menu コントロールとまったく同じ方法で実行する方法については詳しく説明しません。 ただし、TreeView コントロールは、動作方法にはいくつかの明確な違いがあります。

既定では、ツリー ビュー コントロールは完全に展開されて表示されます。 最初の読み込み時に展開のレベルを変更するには、コントロールの**ExpandDepth**プロパティを変更します。 これは、TreeView が特定のノードを展開したときにデータ バインドされる場合に特に重要です。

## <a name="databinding-the-treeview-control"></a>ツリー ビュー コントロールのデータバインド

Menu コントロールとは異なり、TreeView は大量のデータを処理するのに適しています。 したがって、サイトマップデータ ソースまたは XML データ ソースへのデータバインディングに加えて、多くの場合、ツリー ビューはデータセットまたはその他のリレーショナル データにデータバインドされます。 TreeView コントロールが大量のデータにバインドされている場合は、コントロール内で実際に表示されるデータにのみバインドすることをお勧めします。 その後、TreeView ノードが展開されると、追加データにデータをバインドできます。

このような場合は、ツリー ビューの**PopulateOnDemand**プロパティを*true*に設定する必要があります。 その後 **、メソッドの**実装を指定する必要があります。

## <a name="data-binding-without-postback"></a>ポストバックなしのデータ バインディング

前の例でノードを初めて展開すると、ページがポストバックされ、更新されます。 この例では問題ありませんが、大量のデータを持つ運用環境にある可能性があります。 より良いシナリオは、TreeView がノードを動的に読み込むが、サーバーへのポストがない場合です。

**プロパティ**を true に設定すると、ASP.NET TreeView コントロールはポスト バックなしでノードを動的に設定します。 **PopulateOnDemand** 親ノードが展開されると、クライアントから XMLHttp 要求が行われ、OnTreeNodePopulate イベントが発生します。 サーバーは XML データ アイランドで応答し、子ノードのデータ バインドに使用されます。

ASP.NETは、この機能を実装するクライアント コードを動的に作成します。 スクリプト&lt;を&gt;含むスクリプト タグは、AXD ファイルを指して生成されます。 たとえば、次のリストは、XMLHttp 要求を生成するスクリプト コードのスクリプト リンクを示しています。

[!code-html[Main](data-bound-controls/samples/sample7.html)]

上記の AXD ファイルをブラウザーで参照して開くと、XMLHttp 要求を実装するコードが表示されます。 この方法により、ユーザーはスクリプト ファイルを変更できなくなります。

## <a name="controlling-the-operation-of-the-treeview-control"></a>ツリー ビュー コントロールの操作の制御

TreeView コントロールには、コントロールの操作に影響を与えるいくつかのプロパティがあります。 最も明白なプロパティは、チェック ボックスの表示、 **[折りたたみの****表示**] 、および [**行の表示**] です。

**ShowCheckBoxes**プロパティは、レンダリング時にノードにチェック ボックスを表示するかどうかに影響します。 このプロパティの有効な値は、[**なし]、[****ルート**]、[**親**]、[**リーフ**]、[**すべて**] です。 これらは、次のようにツリー ビュー コントロールに影響します。

| **プロパティ値** | **結果** |
| --- | --- |
| なし | チェックボックスはどのノードにも表示されません。 これが既定の設定です。 |
| Root | チェックボックスはルートノードにのみ表示されます。 |
| Parent | チェックボックスは、子ノードを持つノードにのみ表示されます。 これらの子ノードは、親ノードまたはリーフ ノードにすることができます。 |
| リーフ | チェックボックスは、子ノードを持たないノードにのみ表示されます。 |
| All | チェックボックスはすべてのノードに表示されます。 |

チェック ボックスが使用されている場合 **、CheckedNodes**プロパティはポストバック時にチェックされるツリー ビュー ノードのコレクションを返します。

**"ShowExpandExpandExpand/展開の折りたたみ**" プロパティは、ルート ノードと親ノードの横にある展開/折りたたみイメージの外観を制御します。 このプロパティが**false**に設定されている場合、TreeView ノードはハイパーリンクとして表示され、リンクをクリックして展開/折りたたみされます。

**ShowLines**プロパティは、親ノードと子ノードを接続する線を表示するかどうかを制御します。 **false** (既定値) の場合、行は表示されません。 **true**の場合、コントロールは **、プロパティ**で指定されたフォルダー内の線のイメージを使用します。

ツリー ビューの行の外観をカスタマイズするには、Visual Studio .NET 2005 には、ライン デザイナー ツールが含まれています。 このツールには、次のように TreeView コントロールの [スマート タグ] ボタンを使用してアクセスできます。

![](data-bound-controls/_static/image1.jpg)

**図 1**

[ライン**イメージのカスタマイズ]** メニュー オプションを選択すると、ライン デザイナー ツールが起動され、TreeView ラインの外観を構成できます。

## <a name="treeview-events"></a>ツリービューイベント

ツリー ビュー コントロールには、次の一意のイベントがあります。

- SelectNodeChanged は **、SelectAction**プロパティに基づいてノードが選択されたときに発生します。
- ノードのチェックボックスの状態が変更されると発生します。
- ノードが**SelectAction**プロパティに基づいて展開されると発生します。
- ノードが折りたたまれたときに折りたたまれた状態になります。
- ノードがデータ バインドされている場合に発生します。
- ノードが設定されると発生します。

**SelectAction**プロパティを使用すると、ノードが選択されたときに発生するイベントを構成できます。 プロパティは、次のアクションを提供します。

- ノードが選択されているときに展開ツリーノードを展開展開展開展開展開します。
- ノードが選択されている場合は、イベントを発生しません。
- ノードが選択されると、選択されたノードの変更イベントが発生します。
- ノードが選択されているときに、選択されたノードの変更イベントとツリーノード展開イベントの両方を発生させます。

## <a name="controlling-appearance-with-styles"></a>スタイルを使用した外観のコントロール

TreeView コントロールには、スタイルを使用してコントロールの外観を制御するための多くのプロパティが用意されています。 使用できるプロパティは次のとおりです。

| **プロパティ名** | **コントロール** |
| --- | --- |
| ホバーノードスタイル | マウスをノードの上に置いたときにノードのスタイルをコントロールします。 |
| リーフノードスタイル | リーフ ノードのスタイルをコントロールします。 |
| Nodestyle | すべてのノードのスタイルをコントロールします。 特定のノード スタイル(リーフノードスタイルなど)は、このスタイルをオーバーライドします。 |
| 親ノードスタイル | すべての親ノードのスタイルをコントロールします。 |
| ルートノードスタイル | ルート ノードのスタイルを制御します。 |
| 選択されたノードスタイル | 選択したノードのスタイルをコントロールします。 |

これらの各プロパティは読み取り専用です。 ただし、それぞれ**TreeNodeStyle**オブジェクトを返し、プロパティサブ*プロパティ*形式を使用してそのオブジェクトのプロパティを変更できます。 たとえば、次の構文を使用して **、SelectedNodeStyle**の**ForeColor**プロパティを設定します。

[!code-aspx[Main](data-bound-controls/samples/sample8.aspx)]

上記のタグが閉じられていないことに注意してください。 これは、ここで示す宣言構文を使用する場合、Html コードにも TreeViews ノードを含めるためです。

スタイル プロパティは、コード内で*property.subproperty*形式を使用して指定することもできます。 たとえば、コードで**ルートノードスタイル**の**ForeColor**プロパティを設定するには、次の構文を使用します。

[!code-csharp[Main](data-bound-controls/samples/sample9.cs)]

> [!NOTE]
> さまざまなスタイル プロパティの包括的な一覧については、オブジェクトの MSDN ドキュメントを参照してください。

## <a name="the-sitemappath-control"></a>サイトマップパス コントロール

SiteMapPath コントロールは、ASP.NET開発者向けのパンくずナビゲーション コントロールを提供します。 他のナビゲーション コントロールと同様に、サイトマップデータ ソースや XmlDataSource などの階層データ ソースに簡単にデータバインドできます。

コントロールは、オブジェクトから構成されます。 ノードには 3 つのタイプがあります。ルート ノード、親ノード、および現在のノード。 ルート ノードは、階層構造の最上位にあるノードです。 現在のノードは、現在のページを表します。 他のすべてのノードは親ノードです。

## <a name="controlling-the-operation-of-the-sitemappath-control"></a>サイトマップパスコントロールの操作の制御

コントロールの操作を制御するプロパティは次のとおりです。

| **プロパティ** | **プロパティの説明** |
| --- | --- |
| 親レベル表示 | 表示される親ノードの数を制御します。 デフォルトは -1 で、表示される親ノードの数に制限はありません。 |
| パスディレクション | サイトマップパスの方向を制御します。 有効な値は、ルート電流 (デフォルト) と CurrentToRoot です。 |
| パスセパレータ | コントロール内のノードを区切る文字を制御する文字列です。 デフォルト値は :. |
| レンダリングカレントノードアスリンク | 現在のノードをリンクとしてレンダリングするかどうかを制御するブール値。 既定値は False です。 |
| Skiplinktext | スクリーン リーダーがページを表示するときのアクセシビリティを向上させます。 このプロパティを使用すると、スクリーン リーダーは SiteMapPath コントロールをスキップできます。 この機能を無効にするには、プロパティを String.Empty に設定します。 |

## <a name="templated-sitemappath-controls"></a>テンプレート化されたサイトマップ パス コントロール

SiteMapControl はテンプレート コントロールであるため、コントロールの表示に使用するさまざまなテンプレートを定義できます。 SiteMapPath コントロールのテンプレートを編集するには、コントロールの [スマート タグ] ボタンをクリックし、メニューから [テンプレートの編集] を選択します。 次に示すように、[サイトマップタスク] メニューが表示され、使用可能なさまざまなテンプレートを選択できます。

![](data-bound-controls/_static/image2.jpg)

**図 2**

**ノード テンプレート テンプレート**は、サイトマップ パス内の任意のノードを参照します。 ノードがルート ノードまたは現在のノードで、ルート**ノード テンプレート**または**現在のノード テンプレート**が構成されている場合、ノード テンプレートはオーバーライドされます。

## <a name="sitemappath-events"></a>サイトマップパスイベント

コントロールには、コントロール クラスから派生していない 2 つのイベントがあります。イベント**と****アイテムデータバインド**イベント。 イベントは、サイトマップパス アイテムが作成されるときに発生します。 項目データバインドは、データバインドメソッドがサイトマップパス ノードのデータ バインディング中に呼び出されたときに発生します。 オブジェクトは **、** アイテム プロパティを介して特定のサイトマップノードアイテムへのアクセスを提供します。

## <a name="controlling-appearance-with-styles"></a>スタイルを使用した外観のコントロール

次のスタイルは、サイトマップパス コントロールの書式設定に使用できます。

| **プロパティ名** | **コントロール** |
| --- | --- |
| 現在のノードスタイル | 現在のノードのテキストのスタイルをコントロールします。 |
| ルートノードスタイル | ルート ノードのテキストのスタイルをコントロールします。 |
| Nodestyle | CurrentNodeStyle またはルートノードスタイルが適用されないと仮定して、すべてのノードのテキストのスタイルを制御します。 |

プロパティは、現在のノードスタイルまたはルートノードスタイルによってオーバーライドされます。 これらの各プロパティは読み取り専用で **、Style**オブジェクトを返します。 これらのプロパティのいずれかを使用してノードの外観を変更するには、返される Style オブジェクトのプロパティを設定する必要があります。 たとえば、次のコードは、現在のノードの forecolor プロパティを変更します。

[!code-aspx[Main](data-bound-controls/samples/sample10.aspx)]

このプロパティは、次のようにプログラムで適用することもできます。

[!code-csharp[Main](data-bound-controls/samples/sample11.cs)]

> [!NOTE]
> テンプレートが適用されている場合、スタイルは適用されません。

## <a name="lab-1-configuring-an-aspnet-menu-control"></a>演習 1: ASP.NET メニュー コントロールの構成

1. 新しい Web サイトを作成します。
2. [ファイル]、[新規作成]、[ファイル]を選択し、ファイル テンプレートの一覧から [サイト マップ] を選択して、サイト マップ ファイルを追加します。
3. サイト マップ (既定では Web.sitemap) を開き、次の一覧のように変更します。 サイト マップ ファイル内でリンクしているページは実際には存在しませんが、この演習では問題ありません。

    [!code-xml[Main](data-bound-controls/samples/sample12.xml)]
4. デザイン ビューで既定の Web フォームを開きます。
5. ツールボックスの [ナビゲーション] セクションから、新しい Menu コントロールをページに追加します。
6. ツールボックスの [データ] セクションから、新しいサイトマップデータ ソースを追加します。 サイトマップデータ ソースは、サイト内の Web.sitemap ファイルを自動的に使用します。 (Web.sitemap ファイルはサイトのルート フォルダに含まれている*必要があります*)。
7. Menu コントロールをクリックし、[スマート タグ] ボタンをクリックして[メニュー タスク]ダイアログ を表示します。
8. [データ ソースの選択] ドロップダウンで、[サイトマップデータソース1] を選択します。
9. [オートフォーマット] リンクをクリックし、メニューの書式を選択します。
10. [プロパティ] ウィンドウで、**プロパティ**を 2 に設定します。 これで、メニュー コントロールは、デザイナーでホーム、製品、およびサービス ノードを表示する必要があります。
11. ブラウザでページを参照し、メニューを使用します。 (サイト マップに追加したページは実際には存在しないため、サイト マップを参照しようとするとエラーが表示されます)。

静的表示レベルと最大動的表示レベルのプロパティを変更し、メニューのレンダリング方法に影響を与える方法を確認します。

## <a name="lab-2-dynamically-binding-a-treeview-control"></a>ラボ 2: ツリー ビュー コントロールを動的にバインドする

この演習では、ローカルで実行されている SQL Server があり、ノースウィンド データベースが SQL Server インスタンスに存在することを前提としています。 これらの条件が満たされない場合は、サンプルの接続文字列を変更してください。 また、信頼関係接続ではなく、SQL Server 認証を指定する必要がある場合もあります。

1. 新しい Web サイトを作成します。
2. Default.aspx のコード ビューに切り替え、すべてのコードを次のコードに置き換えます。 

    [!code-aspx[Main](data-bound-controls/samples/sample13.aspx)]
3. ページを treeview.aspx として保存します。
4. ページを参照します。
5. ページが最初に表示されたら、ブラウザでページのソースを表示します。 表示可能なノードだけがクライアントに送信されることに注意してください。
6. ノードの横にあるプラス記号をクリックします。
7. ページ上のソースを再度表示します。 新しく表示されたノードが表示されます。

## <a name="lab-3-details-view-and-editing-data-using-a-gridview-and-detailsview"></a>ラボ 3: グリッド ビューと詳細ビューを使用してデータの詳細を表示および編集します。

1. 新しい Web サイトを作成します。
2. 新しい web.config を Web サイトに追加します。
3. 次に示すように、web.config ファイルに接続文字列を追加します。 

    [!code-xml[Main](data-bound-controls/samples/sample14.xml)]

    > [!NOTE]
    > 環境に基づいて接続文字列を変更する必要がある場合があります。
4. web.config ファイルを保存して閉じます。
5. 既定の.aspx を開き、新しい SqlDataSource コントロールを追加します。
6. コントロールの ID を **[製品]** に変更します。
7. **[SqlDataSource タスク]** メニューの [**データ ソースの構成**] をクリックします。
8. 接続ドロップダウンで**Northwind**を選択し、[次へ] をクリックします。
9. [**製品名]** ドロップダウンから **[製品**] を選択し、次に示すように、[**商品コード**]、[**商品名**]、[**単価**]、[**ユニットインストック**] の各チェック ボックスをオンにします。 

![](data-bound-controls/_static/image3.jpg)

    **Figure 3**
10. **[次へ]** をクリックします。
11. **[完了]** をクリックします。
12. ソース ビューに切り替えて、生成されたコードを確認します。 コントロールに追加された**コマンドの選択**コマンド、**削除コマンド**、**挿入コマンド**、および**更新コマンド**に注意してください。 追加されたパラメーターも確認してください。
13. デザイン ビューに切り替えて、新しい GridView コントロールをページに追加します。
14. [データ ソースの選択] ドロップダウンから **[製品****] を選択**します。
15. 以下に示すように **、[ページングを有効にする**] と **[選択を有効にする] を**オンにします。 

![](data-bound-controls/_static/image4.jpg)

    **Figure 4**
16. [**列の編集]** リンクをクリックし、[**フィールドの自動生成]** がオンになっていることを確認します。
17. **[OK]** をクリックします。
18. GridView コントロールを選択した状態で、プロパティ ウィンドウで**DataKeyNames**プロパティの横にあるボタンをクリックします。
19. **[使用可能なデータ フィールド**] リストから**&gt;****[商品 ID]** を選択し、ボタンをクリックして追加します。
20. [OK] をクリックします。
21. 新しい SqlDataSource コントロールをページに追加します。
22. コントロールの ID を **[詳細]** に変更します。
23. [SqlDataSource タスク] メニューの [**データ ソースの構成**] をクリックします。
24. ドロップダウンから **[Northwind]** を選択し、[**次へ**] をクリックします。
25. [<strong>名前]</strong>ドロップダウンから<strong>[製品</strong>]<strong>\<を選択し、[<strong>列]</strong>ボックスの [/強い>* チェック ボックスをオンにします。
26. **[WHERE]** ボタンをクリックします。
27. **[列**] ドロップダウンから [商品**ID]** を選択します。
28. [**=** 演算子] ドロップダウンで選択します。
29. **[ソース**] ドロップダウンから [**コントロール**] を選択します。
30. **[コントロール ID]** ドロップダウンから **[GridView1]** を選択します。
31. [**追加**] ボタンをクリックして WHERE 句を追加します。
32. **[OK]** をクリックします。
33. [**詳細設定**] ボタンをクリックし **、[INSERT、更新、および DELETE ステートメントの生成**] チェックボックスをオンにします。
34. **[OK]** をクリックします。
35. [**次へ**] をクリックし、[**完了**] をクリックします。
36. ページに DetailsView コントロールを追加します。
37. [**データ ソースの選択**] ドロップダウンで、[**詳細**] を選択します。
38. 以下に示すように、[**編集を有効にする**]チェックボックスをオンにします。 

![](data-bound-controls/_static/image1.gif)

    **Figure 5**
39. ページを保存し、Default.aspx を参照します。
40. 詳細ビューの更新を自動的に表示するには、別のレコードの横にある **[選択**] リンクをクリックします。
41. DetailsView コントロールの **[編集]** リンクをクリックします。
42. レコードを変更し、[**更新**] をクリックします。
