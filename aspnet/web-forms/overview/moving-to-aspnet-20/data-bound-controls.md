---
uid: web-forms/overview/moving-to-aspnet-20/data-bound-controls
title: データバインドコントロール |Microsoft Docs
author: microsoft
description: ほとんどの ASP.NET アプリケーションは、バックエンドデータソースからのデータ表示に依存しています。 データバインドコントロールは、相互作用の重要な部分です...
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 0e23ff32-646d-43f3-8bec-6b2313d3abd6
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-bound-controls
msc.type: authoredcontent
ms.openlocfilehash: 1154b38e0fa3d9d56cb407ae659c3b0d69871fda
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78488872"
---
# <a name="data-bound-controls"></a>データ バインドされたコントロール

[Microsoft](https://github.com/microsoft)

> ほとんどの ASP.NET アプリケーションは、バックエンドデータソースからのデータ表示に依存しています。 データバインドコントロールは、動的 Web アプリケーションのデータを操作するための非常に重要な要素です。 ASP.NET 2.0 では、新しい BaseDataBoundControl クラスや宣言構文など、データバインドコントロールの大幅な改善点が導入されています。

ほとんどの ASP.NET アプリケーションは、バックエンドデータソースからのデータ表示に依存しています。 データバインドコントロールは、動的 Web アプリケーションのデータを操作するための非常に重要な要素です。 ASP.NET 2.0 では、新しい BaseDataBoundControl クラスや宣言構文など、データバインドコントロールの大幅な改善点が導入されています。

BaseDataBoundControl は、Databoundcontrol でクラスと HierarchicalDataBoundControl クラスの基本クラスとして機能します。 このモジュールでは、Databoundcontrol でから派生した次のクラスについて説明します。

- AdRotator
- リストコントロール
- GridView
- FormView
- DetailsView

また、HierarchicalDataBoundControl クラスから派生する次のクラスについても説明します。

- TreeView
- メニュー
- SiteMapPath

## <a name="databoundcontrol-class"></a>Databoundcontrol でクラス

Databoundcontrol でクラスは、表形式またはリスト形式のデータを操作するために使用される抽象クラス (VB では MustInherit としてマークされます) です。 次のコントロールは、Databoundcontrol でから派生するコントロールの一部です。

## <a name="adrotator"></a>AdRotator

AdRotator コントロールを使用すると、特定の URL にリンクされている Web ページにグラフィックバナーを表示できます。 表示されるグラフィックは、コントロールのプロパティを使用して回転されます。 ページに表示される特定の広告の頻度は、**インプレッション**プロパティを使用して構成できます。また、広告は、キーワードフィルターを使用してフィルター処理できます。

AdRotator コントロールは、データの XML ファイルまたはデータベース内のテーブルを使用します。 次の属性は、XML ファイルで、AdRotator コントロールを構成するために使用されます。

### <a name="imageurl"></a>ImageUrl
広告に表示するイメージの URL。

### <a name="navigateurl"></a>NavigateUrl
広告がクリックされたときにユーザーが実行する URL。 これは URL エンコードされている必要があります。

### <a name="alternatetext"></a>AlternateText
ツールヒントに表示され、スクリーンリーダーによって読み込まれる代替テキスト。 また、ImageUrl によって指定されたイメージが使用できない場合にも表示されます。

### <a name="keyword"></a>Keyword
キーワードフィルター処理を使用するときに使用できるキーワードを定義します。 指定した場合、キーワード filter に一致するキーワードを持つ広告のみが表示されます。

### <a name="impressions"></a>印象
特定の広告が表示される頻度を決定する重み付け番号。 これは、同じファイル内の他の広告の印象に対する相対値です。 XML ファイル内のすべての広告の全体的なインプレッションの最大値は 20億4800万1です。

### <a name="height"></a>[高さ]
広告の高さ (ピクセル単位)。

### <a name="width"></a>幅
広告の幅 (ピクセル単位)。

> [!NOTE]
> Height 属性と Width 属性は、AdRotator コントロール自体の高さと幅よりも優先されます。

一般的な XML ファイルは次のようになります。

[!code-xml[Main](data-bound-controls/samples/sample1.xml)]

上の例では、Contoso の ad は、インプレッション属性の値によって ASP.NET Web サイトの広告として表示される可能性が2倍になっています。

上記の XML ファイルから広告を表示するには、次に示すように、AdRotator コントロールをページに追加し、XML ファイルを指すように**AdvertisementFile**プロパティを設定します。

[!code-aspx[Main](data-bound-controls/samples/sample2.aspx)]

データベーステーブルを AdRotator コントロールのデータソースとして使用する場合は、まず、次のスキーマを使用してデータベースを設定する必要があります。

| **列名** | **データの種類** | **説明** |
| --- | --- | --- |
| id | INT | 主キー この列には任意の名前を付けることができます。 |
| ImageUrl | nvarchar (*長さ*) | 広告に表示するイメージの相対 URL または絶対 URL。 |
| NavigateUrl | nvarchar (*長さ*) | Ad のターゲット URL。 値を指定しない場合、広告はハイパーリンクではありません。 |
| AlternateText | nvarchar (*長さ*) | イメージが見つからない場合に表示されるテキスト。 ブラウザーによっては、テキストがツールヒントとして表示される場合があります。 代替テキストは、ユーザー補助にも使用されます。これにより、グラフィックを表示できないユーザーは、その説明が読み上げられないようにすることができます。 |
| Keyword | nvarchar (*長さ*) | ページがフィルター処理できる広告のカテゴリ。 |
| 印象 | int(4) | 広告を表示する頻度を示す数値。 数値が大きいほど、広告が表示される頻度が高くなります。 XML ファイル内のすべてのインプレッション値の合計が 20億4800万-1 を超えることはできません。 |
| 幅 | int(4) | イメージの幅 (ピクセル単位)。 |
| [高さ] | int(4) | イメージの高さ (ピクセル単位)。 |

別のスキーマを持つデータベースが既に存在する場合は、 **Alternatetextfield**、 **Imageurlfield**、 **NavigateUrlField**の各プロパティを使用して、既存のデータベースに AdRotator 属性をマップできます。 データベースのデータを AdRotator コントロールに表示するには、データソースコントロールをページに追加し、データベースをポイントするようにデータソースコントロールの接続文字列を構成して、AdRotator コントロールの**DataSourceID**プロパティをデータソースコントロールの ID に設定します。 プログラムを使用して AdRotator の広告を構成する必要がある場合は、AdCreated イベントを使用します。 AdCreated イベントは2つのパラメーターを受け取ります。1つはオブジェクト、もう1つは AdCreatedEventArgs のインスタンスです。 AdCreatedEventArgs は、作成される広告への参照です。

次のコードスニペットでは、プログラムを使用して、ad の ImageUrl、NavigateUrl、および AlternateText を設定します。

[!code-csharp[Main](data-bound-controls/samples/sample3.cs)]

## <a name="list-controls"></a>リストコントロール

リストコントロールには、ListBox、DropDownList、CheckBoxList、RadioButtonList、および BulletedList が含まれます。 これらの各コントロールは、データソースにデータをバインドできます。 データソース内の1つのフィールドを表示テキストとして使用し、必要に応じて、2番目のフィールドを項目の値として使用できます。 アイテムは、デザイン時に静的に追加することもできます。また、データソースから追加された静的アイテムと動的アイテムを混在させることもできます。

リストコントロールをデータバインドするには、データソースコントロールをページに追加します。 データソースコントロールの SELECT コマンドを指定し、リストコントロールの DataSourceID プロパティをデータソースコントロールの ID に設定します。 **Datatextfield**プロパティと**DataValueField**プロパティを使用して、コントロールの表示テキストと値を定義します。 さらに、 **Datatextformatstring**プロパティを使用して、表示テキストの外観を次のように制御できます。

| **[式]** | **説明** |
| --- | --- |
| Price: {0:C} | 数値/10 進数データの場合。 リテラルの "Price:" の後に通貨形式の数値が表示されます。 通貨の形式は、**ページ**ディレクティブまたは web.config ファイルの culture 属性で指定されているカルチャ設定によって異なります。 |
| {0:D4} | 整数データの場合。 10進数と共に使用することはできません。 整数は、4文字の幅で、ゼロで埋められたフィールドに表示されます。 |
| {0:N2}% | 数値データの場合。 2桁の小数点以下桁数とリテラル "%" が続く数値を表示します。 |
| {0:000.0} | 数値/10 進数データの場合。 数値は小数点以下1桁に丸められます。 3 桁に満たない場合はゼロで埋めます。 |
| {0:D} | 日付/時刻データの場合。 長い日付形式 ("木曜日, 06 年8月 1996") を表示します。 使用される日付の形式は、ページまたは Web.config ファイルのカルチャ設定によって決まります。 |
| {0:d} | 日付/時刻データの場合。 短い日付形式 ("12/31/99") を表示します。 |
| {0:yy-MM-dd} | 日付/時刻データの場合。 日付を年-月-日形式で表示します (96-08-06) |

## <a name="gridview"></a>GridView

GridView コントロールでは、宣言型の方法を使用して表形式のデータの表示と編集を行うことができ、DataGrid コントロールの後継となります。 GridView コントロールでは、次の機能を使用できます。

- データソースコントロールへのバインド (SqlDataSource など)。
- 組み込みの並べ替え機能。
- 組み込みの更新および削除機能。
- 組み込みのページング機能。
- 組み込みの行選択機能。
- GridView オブジェクトモデルへのプログラムによるアクセス。プロパティの動的な設定、イベントの処理などを行います。
- 複数のキーフィールド。
- ハイパーリンク列に複数のデータフィールドがあります。
- テーマとスタイルによるカスタマイズ可能な外観。

**列フィールド**

GridView コントロールの各列は、DataControlField オブジェクトによって表されます。 既定では、AutoGenerateColumns プロパティは**true**に設定されています。これにより、データソースの各フィールドに対して自動生成されたフィールドオブジェクトが作成されます。 各フィールドは、データソースに各フィールドが表示される順序で、GridView コントロールの列としてレンダリングされます。 また、 **AutoGenerateColumns**プロパティを**false**に設定し、独自の列フィールドコレクションを定義することで、 **GridView**コントロールに表示される列フィールドを手動で制御することもできます。 さまざまな列フィールド型によって、コントロール内の列の動作が決まります。

次の表に、使用できるさまざまな列フィールドの種類を示します。

| **列フィールドの型** | **説明** |
| --- | --- |
| BoundField | データソース内のフィールドの値を表示します。 GridView コントロールの既定の列型です。 |
| ButtonField | GridView コントロールの各項目に対してコマンドボタンを表示します。 これにより、[追加] や [削除] などのカスタムボタンコントロールの列を作成できます。 |
| CheckBoxField | GridView コントロールの各項目のチェックボックスを表示します。 この列フィールド型は、通常、ブール値を持つフィールドを表示するために使用されます。 |
| CommandField | 選択、編集、または削除操作を実行するための定義済みコマンドボタンを表示します。 |
| HyperLinkField | データソース内のフィールドの値をハイパーリンクとして表示します。 この列のフィールドの種類を使用すると、2番目のフィールドをハイパーリンクの URL にバインドできます。 |
| ImageField | GridView コントロールの各項目のイメージを表示します。 |
| TemplateField | 指定されたテンプレートに従って、GridView コントロールの各項目について、ユーザー定義のコンテンツを表示します。 この列フィールドの種類を使用すると、カスタム列フィールドを作成できます。 |

列フィールドコレクションを宣言によって定義するには、最初に、GridView コントロールの開始タグと終了タグの間に&gt;タグを開始および終了 **&lt;** 追加します。 次に、開始と終了の **&lt;列&gt;** タグの間に含める列フィールドを一覧表示します。 指定された列は、表示されている順序で Columns コレクションに追加されます。 **Columns**コレクションは、コントロール内のすべての列フィールドを格納し、GridView コントロールの列フィールドをプログラムで管理できるようにします。

明示的に宣言された列フィールドは、自動的に生成された列フィールドと組み合わせて表示できます。 両方を使用する場合は、明示的に宣言された列フィールドが最初に表示され、その後に自動的に生成された列フィールドが続きます。

## <a name="binding-to-data"></a>バインド (データに)

GridView コントロールは、データソースコントロール ( **SqlDataSource**、 **ObjectDataSource**など) と、system.string インターフェイス (system.string、system.string、または system.string など) を実装する任意のデータソースにバインドすることができます。このようなデータソースは、データソースコントロールにバインドすることもできます。 次のいずれかのメソッドを使用して、GridView コントロールを適切なデータソースの種類にバインドします。

- データソースコントロールにバインドするには、GridView コントロールの DataSourceID プロパティをデータソースコントロールの ID 値に設定します。 GridView コントロールは、指定されたデータソースコントロールに自動的にバインドされ、データソースコントロールの機能を利用して、並べ替え、更新、削除、およびページング機能を実行できます。 これは、データにバインドするために推奨される方法です。
- System.string インターフェイスを実装するデータソースにバインドするには、プログラムによって GridView コントロールの DataSource プロパティをデータソースに設定してから、DataBind メソッドを呼び出します。 このメソッドを使用する場合、GridView コントロールは、組み込みの並べ替え、更新、削除、およびページング機能を提供しません。 この機能は、自分で提供する必要があります。

## <a name="data-operations"></a>データ操作

GridView コントロールには、コントロール内の項目の並べ替え、更新、削除、選択、およびページの表示をユーザーに許可する組み込みの機能が多数用意されています。 GridView コントロールがデータソースコントロールにバインドされると、GridView コントロールはデータソースコントロールの機能を活用して、自動的な並べ替え、更新、および削除機能を提供できます。

> [!NOTE]
> GridView コントロールは、他の種類のデータソースでの並べ替え、更新、および削除をサポートしています。ただし、これらの操作の実装には、適切なイベントハンドラーを用意する必要があります。

並べ替えを使用すると、ユーザーは、列のヘッダーをクリックして、GridView コントロール内の項目を特定の列に対して並べ替えることができます。 並べ替えを有効にするには、AllowSorting プロパティを**true**に設定します。

自動更新、削除、および選択の機能は、 **buttonfield**または**TemplateField** column フィールドのボタンのコマンド名が "Edit"、"Delete"、および "Select" である場合に有効になります。 AutoGenerateEditButton、AutoGenerateDeleteButton、または AutoGenerateSelectButton プロパティが**true**に設定されている場合、GridView コントロールは、Edit、Delete、または Select の各ボタンを使用して**commandfield**列フィールドを自動的に追加できます。

> [!NOTE]
> データソースへのレコードの挿入は、GridView コントロールで直接サポートされていません。 ただし、GridView コントロールまたは FormView コントロールと共に GridView コントロールを使用してレコードを挿入することもできます。

GridView コントロールでは、データソース内のすべてのレコードを同時に表示する代わりに、レコードを自動的にページに分割できます。 ページングを有効にするには、AllowPaging プロパティを**true**に設定します。

## <a name="customizing-the-user-interface"></a>ユーザーインターフェイスのカスタマイズ

GridView コントロールの外観をカスタマイズするには、コントロールのさまざまな部分のスタイルプロパティを設定します。 次の表は、さまざまなスタイルプロパティを示しています。

| **Style プロパティ** | **説明** |
| --- | --- |
| AlternatingRowStyle | GridView コントロールの交互のデータ行のスタイル設定。 このプロパティを設定すると、RowStyle 設定と**AlternatingRowStyle**設定の間に、データ行が交互に表示されます。 |
| EditRowStyle | GridView コントロールで編集される行のスタイル設定。 |
| EmptyDataRowStyle | データソースにレコードが含まれていない場合に、GridView コントロールに表示される空のデータ行のスタイル設定。 |
| FooterStyle | GridView コントロールのフッター行のスタイル設定。 |
| HeaderStyle | GridView コントロールのヘッダー行のスタイル設定。 |
| PagerStyle | GridView コントロールのページ行のスタイル設定。 |
| RowStyle | GridView コントロールのデータ行のスタイル設定。 **AlternatingRowStyle**プロパティも設定されている場合、 **Rowstyle**設定と**AlternatingRowStyle**設定の間に、データ行が交互に表示されます。 |
| SelectedRowStyle | GridView コントロールで選択されている行のスタイル設定。 |

コントロールのさまざまな部分の表示と非表示を切り替えることもできます。 表示または非表示にする部分を制御するプロパティを次の表に示します。

| **プロパティ** | **説明** |
| --- | --- |
| ShowFooter | GridView コントロールのフッターセクションの表示と非表示を切り替えます。 |
| ShowHeader | GridView コントロールのヘッダーセクションの表示と非表示を切り替えます。 |

### <a name="events"></a>events

GridView コントロールには、プログラミングできるいくつかのイベントが用意されています。 これにより、イベントが発生するたびにカスタムルーチンを実行できます。 次の表に、GridView コントロールでサポートされるイベントの一覧を示します。

| **イベント** | **説明** |
| --- | --- |
| PageIndexChanged | ページャーボタンの1つがクリックされたときに、GridView コントロールがページング操作を処理した後に発生します。 このイベントは、ユーザーがコントロール内の別のページに移動した後にタスクを実行する必要がある場合によく使用されます。 |
| PageIndexChanging | ページャーボタンの1つがクリックされたときに、GridView コントロールがページング操作を処理する前に発生します。 このイベントは、ページング操作をキャンセルするためによく使用されます。 |
| RowCancelingEdit | 行の [キャンセル] ボタンがクリックされたときに、GridView コントロールが編集モードを終了する前に発生します。 このイベントは、通常、取り消し操作を停止するために使用されます。 |
| RowCommand | GridView コントロールのボタンがクリックされたときに発生します。 このイベントは、コントロールのボタンがクリックされたときにタスクを実行するためによく使用されます。 |
| RowCreated | GridView コントロールに新しい行が作成されたときに発生します。 このイベントは、行の作成時に行の内容を変更するためによく使用されます。 |
| RowDataBound | データ行が GridView コントロールのデータにバインドされたときに発生します。 このイベントは、行がデータにバインドされている場合に、行の内容を変更するためによく使用されます。 |
| RowDeleted | 行の Delete ボタンがクリックされたときに、GridView コントロールによってデータソースからレコードが削除されたときに発生します。 このイベントは、多くの場合、削除操作の結果を確認するために使用されます。 |
| 行の削除 | 行の Delete ボタンがクリックされたときに、GridView コントロールがデータソースからレコードを削除する前に発生します。 このイベントは、多くの場合、削除操作を取り消すために使用されます。 |
| RowEditing | 行の [編集] ボタンがクリックされたときに、GridView コントロールが編集モードに切り替わる前に発生します。 このイベントは、多くの場合、編集操作を取り消すために使用されます。 |
| RowUpdated | 行の Update ボタンがクリックされたときに、GridView コントロールによって行が更新されたときに発生します。 このイベントは、多くの場合、更新操作の結果を確認するために使用されます。 |
| RowUpdating | 行の Update ボタンがクリックされたときに、GridView コントロールによって行が更新される前に発生します。 このイベントは、多くの場合、更新操作をキャンセルするために使用されます。 |
| SelectedIndexChanged | 行の Select ボタンがクリックされたときに、GridView コントロールが選択操作を処理した後に発生します。 このイベントは、コントロールで行が選択された後にタスクを実行するためによく使用されます。 |
| SelectedIndexChanging | 行の Select ボタンがクリックされたときに、GridView コントロールが選択操作を処理する前に発生します。 このイベントは、多くの場合、選択操作を取り消すために使用されます。 |
| 並べ替え | 列を並べ替えるハイパーリンクがクリックされたときに、GridView コントロールが並べ替え操作を処理した後に発生します。 このイベントは、ユーザーがハイパーリンクをクリックして列を並べ替えると、タスクを実行するためによく使用されます。 |
| 並べ替え | 列を並べ替えるハイパーリンクがクリックされたときに、GridView コントロールが並べ替え操作を処理する前に発生します。 このイベントは、並べ替え操作をキャンセルしたり、カスタムの並べ替えルーチンを実行したりするためによく使用されます。 |

## <a name="formview"></a>FormView

FormView コントロールは、データソースから1つのレコードを表示するために使用されます。 これは DetailsView コントロールに似ていますが、行フィールドではなくユーザー定義のテンプレートが表示される点が異なります。 独自のテンプレートを作成することにより、データの表示方法をより柔軟に制御できるようになります。 FormView コントロールは、次の機能をサポートしています。

- データソースコントロールにバインドする (SqlDataSource や ObjectDataSource など)。
- 組み込みの挿入機能。
- 組み込みの更新および削除機能。
- 組み込みのページング機能。
- FormView オブジェクトモデルへのプログラムによるアクセス。プロパティを動的に設定したり、イベントを処理したりします。
- ユーザー定義のテンプレート、テーマ、およびスタイルを使用してカスタマイズ可能な外観。

## <a name="templates"></a>テンプレート

FormView コントロールでコンテンツを表示するには、コントロールのさまざまな部分のテンプレートを作成する必要があります。 ほとんどのテンプレートはオプションです。ただし、コントロールが構成されているモード用のテンプレートを作成する必要があります。 たとえば、レコードの挿入をサポートする FormView コントロールには、挿入項目テンプレートが定義されている必要があります。 次の表に、作成できるさまざまなテンプレートを示します。

| **テンプレートの種類** | **説明** |
| --- | --- |
| EditItemTemplate | FormView コントロールが編集モードの場合に、データ行の内容を定義します。 このテンプレートには、通常、ユーザーが既存のレコードを編集するための入力コントロールとコマンドボタンが含まれています。 |
| EmptyDataTemplate | レコードが含まれていないデータソースに FormView コントロールがバインドされている場合に表示される空のデータ行の内容を定義します。 このテンプレートには、通常、データソースにレコードが含まれていないことをユーザーに警告するためのコンテンツが含まれています。 |
| フッターテンプレート | フッター行のコンテンツを定義します。 このテンプレートには、通常、フッター行に表示する追加のコンテンツが含まれています。 代わりに、フッターテキストプロパティを設定して、フッター行に表示するテキストを指定することもできます。 |
| System.windows.controls.headereditemscontrol.headertemplate | ヘッダー行のコンテンツを定義します。 このテンプレートには、通常、ヘッダー行に表示する追加のコンテンツが含まれています。 代わりに、HeaderText プロパティを設定することによって、ヘッダー行に表示するテキストを指定することもできます。 |
| ItemTemplate | FormView コントロールが読み取り専用モードの場合に、データ行の内容を定義します。 このテンプレートには、通常、既存のレコードの値を表示するためのコンテンツが含まれています。 |
| InsertItemTemplate | FormView コントロールが挿入モードの場合に、データ行の内容を定義します。 このテンプレートには、通常、ユーザーが新しいレコードを追加するための入力コントロールとコマンドボタンが含まれています。 |
| PagerTemplate | ページング機能が有効になっている場合に表示される、ページャー行のコンテンツを定義します (AllowPaging プロパティが**true**に設定されている場合)。 このテンプレートには、通常、ユーザーが別のレコードに移動できるコントロールが含まれています。 |

編集項目テンプレートおよび挿入項目テンプレートの入力コントロールは、双方向のバインド式を使用して、データソースのフィールドにバインドできます。 これにより、FormView コントロールは、更新操作または挿入操作のために入力コントロールの値を自動的に抽出できます。 また、双方向のバインド式を使用すると、編集項目テンプレートの入力コントロールで元のフィールド値を自動的に表示できます。

### <a name="binding-to-data"></a>バインド (データに)

FormView コントロールは、データソースコントロール ( **SqlDataSource**、AccessDataSource、 **ObjectDataSource**など) にバインドすることも、system.object インターフェイス (system.string、system.string など) を実装する任意のデータソースにバインドすることもできます。これは、データソースコントロールにバインドされています。 次のいずれかのメソッドを使用して、FormView コントロールを適切なデータソースの種類にバインドします。

- データソースコントロールにバインドするには、FormView コントロールの DataSourceID プロパティをデータソースコントロールの ID 値に設定します。 FormView コントロールは、指定されたデータソースコントロールに自動的にバインドされ、データソースコントロールの機能を利用して、挿入、更新、削除、およびページング機能を実行できます。 これは、データにバインドするために推奨される方法です。
- System.string インターフェイスを実装するデータソースにバインドするには、FormView コントロールの DataSource プロパティをデータソースにプログラムによって設定してから、DataBind メソッドを呼び出し**ます。** このメソッドを使用する場合、FormView コントロールには組み込みの挿入、更新、削除、およびページングの機能は用意されていません。 この機能を提供するには、適切なイベントを使用する必要があります。

## <a name="data-operations"></a>データ操作

FormView コントロールには、ユーザーがコントロール内の項目を更新、削除、挿入、およびページ表示できるようにする多くの組み込み機能が用意されています。 FormView コントロールがデータソースコントロールにバインドされている場合、FormView コントロールはデータソースコントロールの機能を利用し、自動更新、削除、挿入、およびページング機能を提供できます。 FormView コントロールは、他の種類のデータソースとの間で更新、削除、挿入、ページングなどの操作をサポートできます。ただし、これらの操作の実装には、適切なイベントハンドラーを用意する必要があります。

FormView コントロールはテンプレートを使用するため、更新、削除、または挿入操作を実行するコマンドボタンを自動的に生成する方法は用意されていません。 これらのコマンドボタンは、適切なテンプレートに手動で含める必要があります。 FormView コントロールは、 **CommandName**プロパティが特定の値に設定されている特定のボタンを認識します。 次の表に、FormView コントロールで認識されるコマンドボタンを示します。

| **Button** | **Commandname 値** | **説明** |
| --- | --- | --- |
| Cancel | 中断 | 操作をキャンセルし、ユーザーが入力した値を破棄するために、更新または挿入操作で使用されます。 FormView コントロールは、DefaultMode プロパティによって指定されたモードに戻ります。 |
| 削除 | "削除" | 削除操作で、表示されているレコードをデータソースから削除するために使用されます。 Itemdeleting イベントと Itemdeleting イベントを発生させます。 |
| [編集] | 編集 | 更新操作で FormView コントロールを編集モードにするために使用されます。 **EditItemTemplate**プロパティで指定された内容が、データ行に対して表示されます。 |
| 挿入 | Insert | 挿入操作で、ユーザーによって指定された値を使用してデータソースに新しいレコードを挿入しようとするために使用されます。 Iteminserting イベントと Iteminserting イベントを発生させます。 |
| 新規 | New | 挿入モードで FormView コントロールを配置するために挿入操作で使用されます。 **Insertitemposition**プロパティで指定された内容が、データ行に対して表示されます。 |
| ページ | 改 | ページング操作で、ページングを実行するページャー行のボタンを表すために使用されます。 ページング操作を指定するには、ボタンの**CommandArgument**プロパティを "Next"、"Prev"、"First"、"Last"、または移動先のページのインデックスに設定します。 PageIndexChanging イベントと Pageindexchanging イベントを発生させます。 |
| 更新 | Update | 更新操作で、ユーザーによって指定された値を使用して、データソース内の表示されているレコードを更新しようとするために使用されます。 Itemupdating イベントと Itemupdating イベントを発生させます。 |

[削除] ボタン (表示されているレコードを直ちに削除するボタン) とは異なり、[編集] ボタンまたは [新規作成] ボタンをクリックすると、FormView コントロールはそれぞれ編集モードまたは挿入モードになります。 編集モードでは、 **EditItemTemplate**プロパティに含まれているコンテンツが、現在のデータ項目に対して表示されます。 通常、編集項目テンプレートは、[編集] ボタンが更新と [キャンセル] ボタンに置き換えられるように定義されています。 フィールドのデータ型に適した入力コントロール (テキストボックスや CheckBox コントロールなど) も、通常、ユーザーが変更するフィールドの値と共に表示されます。 [更新] ボタンをクリックすると、データソース内のレコードが更新されます。 [キャンセル] ボタンをクリックすると、すべての変更が破棄されます。

同様に、コントロールが挿入モードの場合、 **insertitemposition**プロパティに含まれるコンテンツがデータ項目に対して表示されます。 挿入項目テンプレートは、通常、[新規] ボタンが挿入ボタンと [キャンセル] ボタンに置き換えられ、ユーザーが新しいレコードの値を入力するために空の入力コントロールが表示されるように定義されています。 [挿入] ボタンをクリックすると、データソースにレコードが挿入されます。 [キャンセル] ボタンをクリックすると、すべての変更が破棄されます。

FormView コントロールは、ユーザーがデータソース内の他のレコードに移動できるようにするページング機能を提供します。 有効にすると、ページナビゲーションコントロールを含む FormView コントロールに、ページャーの行が表示されます。 ページングを有効にするには、 **allowpaging**プロパティを**true**に設定します。 PagerStyle および Pagerstyle プロパティに含まれるオブジェクトのプロパティを設定することによって、ページャー行をカスタマイズできます。 組み込みのページャー行 UI を使用する代わりに、 **Pagertemplate**プロパティを使用して独自の ui を作成することもできます。

## <a name="customizing-the-user-interface"></a>ユーザーインターフェイスのカスタマイズ

FormView コントロールの外観をカスタマイズするには、コントロールのさまざまな部分のスタイルプロパティを設定します。 次の表は、さまざまなスタイルプロパティを示しています。

| **Style プロパティ** | **説明** |
| --- | --- |
| EditRowStyle | FormView コントロールが編集モードの場合のデータ行のスタイル設定。 |
| EmptyDataRowStyle | データソースにレコードが含まれていない場合に、FormView コントロールに表示される空のデータ行のスタイル設定。 |
| FooterStyle | FormView コントロールのフッター行のスタイル設定。 |
| HeaderStyle | FormView コントロールのヘッダー行のスタイル設定。 |
| InsertRowStyle | FormView コントロールが挿入モードの場合のデータ行のスタイル設定。 |
| PagerStyle | ページング機能が有効になっている場合に、FormView コントロールに表示されるページャー行のスタイル設定。 |
| RowStyle | FormView コントロールが読み取り専用モードの場合のデータ行のスタイル設定。 |

## <a name="events"></a>events

FormView コントロールには、プログラミングできるいくつかのイベントが用意されています。 これにより、イベントが発生するたびにカスタムルーチンを実行できます。 次の表は、FormView コントロールでサポートされるイベントの一覧です。

| **イベント** | **説明** |
| --- | --- |
| ItemCommand | FormView コントロール内のボタンがクリックされたときに発生します。 このイベントは、コントロールのボタンがクリックされたときにタスクを実行するためによく使用されます。 |
| ItemCreated | FormView コントロールにすべての FormViewRow オブジェクトが作成された後に発生します。 このイベントは、レコードが表示される前にレコードの値を変更するためによく使用されます。 |
| ItemDeleted | 削除ボタン ( **CommandName**プロパティが "Delete" に設定されたボタン) をクリックしたときに、FormView コントロールによってデータソースからレコードが削除されたときに発生します。 このイベントは、多くの場合、削除操作の結果を確認するために使用されます。 |
| ItemDeleting | [削除] ボタンがクリックされたときに、FormView コントロールによってデータソースからレコードが削除される前に発生します。 このイベントは、多くの場合、削除操作を取り消すために使用されます。 |
| ItemInserted | 挿入ボタン ( **CommandName**プロパティが "Insert" に設定されているボタン) をクリックしたときに、FormView コントロールによってレコードが挿入された後に発生します。 このイベントは、挿入操作の結果を確認するためによく使用されます。 |
| ItemInserting | 挿入ボタンがクリックされたときに、FormView コントロールがレコードを挿入する前に発生します。 このイベントは、挿入操作をキャンセルするためによく使用されます。 |
| ItemUpdated | 更新ボタン ( **CommandName**プロパティが "Update" に設定されているボタン) をクリックしたときに、FormView コントロールによって行が更新されたときに発生します。 このイベントは、多くの場合、更新操作の結果を確認するために使用されます。 |
| ItemUpdating | 更新ボタンがクリックされたときに、FormView コントロールがレコードを更新する前に発生します。 このイベントは、多くの場合、更新操作を取り消すために使用されます。 |
| ModeChanged | FormView コントロールによってモードが変更された後 (編集モード、挿入モード、または読み取り専用モード) に発生します。 このイベントは、FormView コントロールがモードを変更したときにタスクを実行するためによく使用されます。 |
| ModeChanging | FormView コントロールがモードを (編集、挿入、または読み取り専用モードに) 変更する前に発生します。 このイベントは、多くの場合、モードの変更を取り消すために使用されます。 |
| PageIndexChanged | ページャーボタンの1つがクリックされたときに、FormView コントロールがページング操作を処理した後に発生します。 このイベントは、ユーザーがコントロール内の別のレコードに移動した後にタスクを実行する必要がある場合によく使用されます。 |
| PageIndexChanging | ページャーボタンの1つがクリックされたときに、FormView コントロールがページング操作を処理する前に発生します。 このイベントは、ページング操作をキャンセルするためによく使用されます。 |

## <a name="detailsview"></a>DetailsView

DetailsView コントロールは、テーブル内のデータソースから1つのレコードを表示するために使用されます。このテーブルでは、レコードの各フィールドがテーブルの行に表示されます。 これは、マスター/詳細シナリオで GridView コントロールと組み合わせて使用できます。 DetailsView コントロールは、次の機能をサポートしています。

- データソースコントロールへのバインド (SqlDataSource など)。
- 組み込みの挿入機能。
- 組み込みの更新および削除機能。
- 組み込みのページング機能。
- DetailsView オブジェクトモデルにプログラムでアクセスし、プロパティを動的に設定したり、イベントを処理したりします。
- テーマとスタイルによるカスタマイズ可能な外観。

## <a name="row-fields"></a>行フィールド

DetailsView コントロール内の各データ行は、フィールドコントロールを宣言することによって作成されます。 行フィールドの種類が異なると、コントロールの行の動作が決まります。 フィールドコントロールは DataControlField から派生します。 次の表に、使用できるさまざまな行フィールドの種類を示します。

| **列フィールドの型** | **説明** |
| --- | --- |
| BoundField | データソース内のフィールドの値をテキストとして表示します。 |
| ButtonField | DetailsView コントロールにコマンドボタンを表示します。 これにより、[追加] や [削除] などのカスタムボタンコントロールを含む行を表示できます。 |
| CheckBoxField | DetailsView コントロールにチェックボックスを表示します。 この行フィールド型は、通常、ブール値を持つフィールドを表示するために使用されます。 |
| CommandField | DetailsView コントロールで編集、挿入、または削除操作を実行するための組み込みコマンドボタンを表示します。 |
| HyperLinkField | データソース内のフィールドの値をハイパーリンクとして表示します。 この行フィールドの種類を使用すると、2番目のフィールドをハイパーリンクの URL にバインドできます。 |
| ImageField | DetailsView コントロールにイメージを表示します。 |
| TemplateField | 指定されたテンプレートに従って、DetailsView コントロール内の行のユーザー定義コンテンツを表示します。 この行フィールドの種類を使用すると、カスタム行フィールドを作成できます。 |

既定では、AutoGenerateRows プロパティは**true**に設定されています。これにより、データソース内のバインド可能な型の各フィールドに対して、バインドされた行フィールドオブジェクトが自動的に生成されます。 有効なバインド可能な型は、String、DateTime、Decimal、Guid、およびプリミティブ型のセットです。 各フィールドは、データソースに各フィールドが表示される順序で、テキストとして行に表示されます。

行を自動的に生成することで、レコード内のすべてのフィールドをすばやく簡単に表示できます。 ただし、DetailsView コントロールの高度な機能を使用するには、DetailsView コントロールに含める行フィールドを明示的に宣言する必要があります。 行フィールドを宣言するには、まず、 **AutoGenerateRows**プロパティを**false**に設定します。 次に、DetailsView コントロールの開始タグと終了タグの間に、開始と終了の **&lt;フィールド&gt;** タグを追加します。 最後に、開始と終了の **&lt;フィールド&gt;** タグの間に含める行フィールドを一覧表示します。 指定された行フィールドは、一覧の順序で Fields コレクションに追加されます。 **Fields**コレクションを使用すると、DetailsView コントロールの行フィールドをプログラムによって管理できます。

> [!NOTE]
> 自動的に生成された行フィールドは、フィールドコレクションに追加されません。

## <a name="binding-to-data"></a>バインド (データに)

DetailsView コントロールは、 **SqlDataSource**や AccessDataSource などのデータソースコントロールにバインドすることも、system.string インターフェイスを実装する任意のデータソース (たとえば、system.string、system.string、および system.string) にバインドすることもできます。これは、データソースコントロールです。

次のいずれかのメソッドを使用して、DetailsView コントロールを適切なデータソースの種類にバインドします。

- データソースコントロールにバインドするには、DetailsView コントロールの DataSourceID プロパティをデータソースコントロールの ID 値に設定します。 DetailsView コントロールは、指定されたデータソースコントロールに自動的にバインドされます。 これは、データにバインドするために推奨される方法です。
- System.string インターフェイスを実装するデータソースにバインドするには、プログラムで DetailsView コントロールの DataSource プロパティをデータソースに設定してから、DataBind メソッドを呼び出し**ます。**

## <a name="security"></a>Security

このコントロールを使用して、悪意のあるクライアントスクリプトを含む可能性のあるユーザー入力を表示できます。 アプリケーションに表示する前に、実行可能スクリプト、SQL ステートメント、またはその他のコードに対してクライアントから送信された情報を確認してください。 ASP.NET には、ユーザー入力でスクリプトと HTML をブロックする入力要求の検証機能が用意されています。

## <a name="data-operations"></a>データ操作

DetailsView コントロールには、ユーザーがコントロール内の項目を更新、削除、挿入、およびページ表示できるようにする組み込みの機能が用意されています。 DetailsView コントロールがデータソースコントロールにバインドされると、DetailsView コントロールはデータソースコントロールの機能を利用し、自動更新、削除、挿入、およびページング機能を提供できます。

DetailsView コントロールは、他の種類のデータソースとの間で更新、削除、挿入、ページングなどの操作をサポートできます。ただし、適切なイベントハンドラーでこれらの操作の実装を提供する必要があります。

DetailsView コントロールでは、AutoGenerateEditButton、AutoGenerateDeleteButton、または AutoGenerateInsertButton プロパティをそれぞれ**true**に設定することによって、Edit、Delete、または New の各ボタンを使用して**commandfield**行フィールドを自動的に追加できます。 [削除] ボタン (選択したレコードを直ちに削除するボタン) とは異なり、[編集] ボタンまたは [新規作成] ボタンをクリックすると、DetailsView コントロールはそれぞれ編集モードまたは挿入モードになります。 編集モードでは、[編集] ボタンは更新と [キャンセル] ボタンに置き換えられます。 フィールドのデータ型に適した入力コントロール (テキストボックスや CheckBox コントロールなど) には、ユーザーが変更するフィールドの値が表示されます。 [更新] ボタンをクリックすると、データソース内のレコードが更新されます。 [キャンセル] ボタンをクリックすると、すべての変更が破棄されます。 同様に、挿入モードでは、[新規] ボタンが挿入および [キャンセル] ボタンに置き換えられ、ユーザーが新しいレコードの値を入力するための空の入力コントロールが表示されます。

DetailsView コントロールは、ユーザーがデータソース内の他のレコードに移動できるようにするページング機能を提供します。 有効にすると、ページナビゲーションコントロールがポケットベルの行に表示されます。 ページングを有効にするには、AllowPaging プロパティを**true**に設定します。 ページ行は、PagerStyle プロパティと Pagerstyle プロパティを使用してカスタマイズできます。

## <a name="customizing-the-user-interface"></a>ユーザーインターフェイスのカスタマイズ

DetailsView コントロールの外観をカスタマイズするには、コントロールのさまざまな部分のスタイルプロパティを設定します。 次の表は、さまざまなスタイルプロパティを示しています。

| **Style プロパティ** | **説明** |
| --- | --- |
| AlternatingRowStyle | DetailsView コントロールの交互のデータ行のスタイル設定。 このプロパティを設定すると、RowStyle 設定と**AlternatingRowStyle**設定の間に、データ行が交互に表示されます。 |
| CommandRowStyle | DetailsView コントロールの組み込みコマンドボタンを含む行のスタイル設定。 |
| EditRowStyle | DetailsView コントロールが編集モードの場合のデータ行のスタイル設定。 |
| EmptyDataRowStyle | データソースにレコードが含まれていない場合に、DetailsView コントロールに表示される空のデータ行のスタイル設定。 |
| FooterStyle | DetailsView コントロールのフッター行のスタイル設定。 |
| HeaderStyle | DetailsView コントロールのヘッダー行のスタイル設定。 |
| InsertRowStyle | DetailsView コントロールが挿入モードの場合のデータ行のスタイル設定。 |
| PagerStyle | DetailsView コントロールのページ行のスタイル設定。 |
| RowStyle | DetailsView コントロールのデータ行のスタイル設定。 **AlternatingRowStyle**プロパティも設定されている場合、 **Rowstyle**設定と**AlternatingRowStyle**設定の間に、データ行が交互に表示されます。 |
| FieldHeaderStyle | DetailsView コントロールのヘッダー列のスタイル設定。 |

## <a name="events"></a>events

DetailsView コントロールには、プログラミングできるいくつかのイベントが用意されています。 これにより、イベントが発生するたびにカスタムルーチンを実行できます。 次の表に、DetailsView コントロールでサポートされるイベントを示します。 また、DetailsView コントロールは、その基本クラス (DataBinding、DataBinding、破棄、Init、Load、PreRender、Render) からこれらのイベントを継承します。

| **イベント** | **説明** |
| --- | --- |
| ItemCommand | DetailsView コントロールのボタンがクリックされたときに発生します。 |
| ItemCreated | DetailsView コントロールですべてのすべての行オブジェクトが作成された後に発生します。 このイベントは、レコードが表示される前にレコードの値を変更するためによく使用されます。 |
| ItemDeleted | 削除ボタンがクリックされたときに、DetailsView コントロールがデータソースからレコードを削除したときに発生します。 このイベントは、多くの場合、削除操作の結果を確認するために使用されます。 |
| ItemDeleting | 削除ボタンがクリックされたときに、DetailsView コントロールがデータソースからレコードを削除する前に発生します。 このイベントは、多くの場合、削除操作を取り消すために使用されます。 |
| ItemInserted | 挿入ボタンがクリックされたときに、DetailsView コントロールがレコードを挿入した後に発生します。 このイベントは、挿入操作の結果を確認するためによく使用されます。 |
| ItemInserting | 挿入ボタンがクリックされたときに、DetailsView コントロールがレコードを挿入する前に発生します。 このイベントは、挿入操作をキャンセルするためによく使用されます。 |
| ItemUpdated | Update ボタンがクリックされたときに、DetailsView コントロールによって行が更新されたときに発生します。 このイベントは、多くの場合、更新操作の結果を確認するために使用されます。 |
| ItemUpdating | Update ボタンがクリックされたときに、DetailsView コントロールがレコードを更新する前に発生します。 このイベントは、多くの場合、更新操作を取り消すために使用されます。 |
| ModeChanged | DetailsView コントロールがモード (編集、挿入、または読み取り専用モード) を変更した後に発生します。 このイベントは、DetailsView コントロールがモードを変更したときにタスクを実行するためによく使用されます。 |
| ModeChanging | DetailsView コントロールがモード (編集、挿入、または読み取り専用モード) を変更する前に発生します。 このイベントは、多くの場合、モードの変更を取り消すために使用されます。 |
| PageIndexChanged | ページャーボタンの1つがクリックされたときに、DetailsView コントロールがページング操作を処理した後に発生します。 このイベントは、ユーザーがコントロール内の別のレコードに移動した後にタスクを実行する必要がある場合によく使用されます。 |
| PageIndexChanging | ページャーボタンの1つがクリックされたときに、DetailsView コントロールがページング操作を処理する前に発生します。 このイベントは、ページング操作をキャンセルするためによく使用されます。 |

## <a name="the-menu-control"></a>メニューコントロール

ASP.NET 2.0 のメニューコントロールは、すべての機能を備えたナビゲーションシステムとして設計されています。 SiteMapDataSource などの階層データソースに簡単にデータをバインドできます。

メニューコントロールの構造体は、宣言または動的に定義することも、単一のルートノードと任意の数のサブノードで構成することもできます。 次のコードは、宣言によってメニューコントロールのメニューを定義します。

[!code-aspx[Main](data-bound-controls/samples/sample4.aspx)]

上の例では、Home .aspx ノードはルートノードです。 その他のすべてのノードは、ルートノード内でさまざまなレベルで入れ子になっています。

メニューコントロールがレンダリングできるメニューには、次の2種類があります。静的メニューと動的メニュー。 静的メニューは、常に表示されるメニュー項目で構成されます。 動的メニューは、ユーザーがマウスでマウスをポイントしたときにのみ表示されるメニュー項目で構成されます。 場合によっては、静的メニューと、宣言によって定義されたメニューと動的メニューが、実行時にデータバインドされたメニューと混同することがあります。 実際、動的メニューと静的メニューは、作成方法とは関係がありません。 *Static*および*dynamic*という用語は、メニューが既定で静的に表示されるか、ユーザーが何らかの操作を実行したときにのみ表示されるかどうかのみを指します。

**Staticdisplaylevels**プロパティは、静的なメニューのレベルの数を構成するために使用されます。これは既定で表示されます。 上の例では、 **Staticdisplaylevels**プロパティを値2に設定すると、メニューがホームノード、ミュージックノード、およびムービーノードを静的に表示するようになります。 他のすべてのノードは、ユーザーが親ノードの上にマウスを置いたときに動的に表示されます。

**Maximumdynamicdisplaylevels**プロパティは、メニューが表示できる動的レベルの最大数を構成します。 **Maximumdynamicdisplaylevels**プロパティによって指定された値よりも高いレベルの動的メニューは破棄されます。

> [!NOTE]
> MaximumDynamicDisplayLevels プロパティによってメニューがレンダリングされないような状況が発生する場合がほとんどです。 そのような場合は、[customers] メニューが表示されるように、プロパティが十分に設定されていることを確認します。

## <a name="data-binding-the-menu-control"></a>メニューコントロールのデータバインディング

Menu コントロールは、SiteMapDataSource や XMLDataSource などの任意の階層データソースにバインドできます。 SiteMapDataSource は、データをメニューコントロールにバインドするために最も一般的に使用されるメソッドです。このメソッドは、Web サイトのファイルにフィードし、そのスキーマがメニューコントロールに対して既知の API を提供します。 次の表は、単純な Web サイトマップファイルを示しています。

[!code-xml[Main](data-bound-controls/samples/sample5.xml)]

ルート siteMapNode 要素が1つだけ存在することに注意してください (この場合は Home 要素)。 SiteMapNode ごとに、いくつかの属性を構成できます。 最もよく使用される属性は次のとおりです。

- **url**ユーザーがメニュー項目をクリックしたときに表示される URL を指定します。 この属性が存在しない場合は、クリックするとノードがポストバックされます。
- **タイトル**メニュー項目に表示されるテキストを指定します。
- **説明**ノードのドキュメントとして使用されます。 は、マウスがノードの上に置かれたときにツールヒントとしても表示されます。
- **siteMapFile**入れ子になった sitemaps を許可します。 この属性は、適切な形式の ASP.NET sitemap ファイルを指している必要があります。
- **ロール**ノードの外観を ASP.NET セキュリティトリミングで制御できるようにします。

これらの属性はすべて省略可能ですが、指定されていない場合、メニューの動作が期待どおりでない場合があることに注意してください。 たとえば、 *url*属性が指定されていても、 *description*属性が指定されていない場合、ノードは表示されず、指定された url に移動することはできません。

## <a name="controlling-a-menus-operation"></a>メニュー操作の制御

ASP.NET Menu コントロールの操作に影響を与えるいくつかのプロパティがあります。**Orientation**プロパティ、 **disStaticPopoutImageUrl After**プロパティ、 **staticitemformatstring**プロパティ、およびプロパティは、これらのうちのほんの一部です。

- **向き**は、*水平*方向または*垂直*方向に設定することができます。また、静的メニュー項目を水平方向または垂直方向に並べて配置するかどうかを制御します。 このプロパティは動的メニューには影響しません。
- **Disafter**プロパティは、マウスが移動された後も動的メニューを表示したままにする時間を構成します。 値はミリ秒単位で指定し、既定値は500に設定されます。 このプロパティを-1 に設定すると、メニューが自動的に非表示になります。 この場合、メニューは、ユーザーがメニューの外側をクリックしたときにのみ表示されます。
- **Staticitemformatstring**プロパティを使用すると、メニューシステム内の一貫した表現を簡単に維持できます。 このプロパティを指定する場合、データソースに表示される説明の代わりに *{0}* を入力する必要があります。 たとえば、演習1のメニュー項目で [製品] ページにアクセスするには、[StaticItemFormatString の {0}] ページにアクセスするように指定します。 実行時には、ASP.NET によって、{0} の出現箇所がメニュー項目の正しい説明に置き換えられます。
- **StaticPopoutImageUrl**プロパティは、特定のメニューノードに子ノードがあることを示すために使用されるイメージを指定します。これは、そのノードの上にマウスポインターを置くことでアクセスできます。 動的メニューでは、引き続き既定のイメージが使用されます。

## <a name="templated-menu-controls"></a>テンプレート化したメニューコントロール

Menu コントロールは、テンプレート化されたコントロールであり、2つの異なる ItemTemplates を許可します。StaticItemTemplate および DynamicItemTemplate。 これらのテンプレートを使用すると、サーバーコントロールやユーザーコントロールをメニューに簡単に追加できます。

Visual Studio .NET でテンプレートを編集するには、メニューの [スマートタグ] ボタンをクリックし、[テンプレートの編集] を選択します。 次に、StaticItemTemplate または DynamicItemTemplate のどちらを編集するかを選択できます。

StaticItemTemplate に追加されたコントロールは、ページが読み込まれるときに静的メニューに表示されます。 DynamicItemTemplate に追加されたコントロールはすべてのポップアップメニューに表示されます。

## <a name="menu-events"></a>メニューイベント

Menu コントロールには、一意の2つのイベントがあります。**Menuitemclicked クリック**され、 **menuitemclicked バインド**イベント。

メニュー項目がクリックされると、MenuItemClicked イベントが発生します。 メニュー項目がデータバインドされると、MenuItemDatabound バインドイベントが発生します。 イベントハンドラーに渡される**Menueventargs**は、item プロパティを介してメニュー項目へのアクセスを提供します。

## <a name="controlling-a-menus-appearance"></a>メニューの外観の制御

メニューコントロールの外観は、メニューの書式設定に使用できる多くのスタイルを1つ以上使用することによっても変更できます。 これらの中には、 **StaticMenuStyle**、 **DynamicMenuStyle**、 **dynamicmenuitemstyle**、 **dynamicselectedstyle**、および**DynamicHoverStyle**があります。 これらのプロパティは、標準の HTML スタイル文字列を使用して構成されます。 たとえば、次のコードは動的メニューのスタイルに影響します。

[!code-aspx[Main](data-bound-controls/samples/sample6.aspx)]

> [!NOTE]
> ホバースタイルを使用している場合は、 *runat*要素が*server*に設定された &lt;head&gt; 要素をページに追加する必要があります。

メニューコントロールは、ASP.NET 2.0 テーマの使用もサポートしています。

## <a name="the-treeview-control"></a>TreeView コントロール

TreeView コントロールは、データをツリーのような構造で表示します。 メニューコントロールと同様に、SiteMapDataSource などの任意の階層データソースに簡単にデータをバインドできます。

お客様が ASP.NET 2.0 で TreeView コントロールについてたずねる最初の質問は、ASP.NET 1.x で使用できる TreeView IE WebControl に関連付けられているかどうかです。 そうじゃないです。 ASP.NET 2.0 TreeView コントロールは一から作成されており、以前に使用されていた IE TreeView WebControl に対する大幅な改善を提供しています。

メニューコントロールとまったく同じ方法で TreeView コントロールをサイトマップにバインドする方法については詳しく説明しません。 ただし、TreeView コントロールの動作方法には、いくつかの異なる相違点があります。

既定では、TreeView コントロールは完全に展開されています。 初期読み込み時の拡張レベルを変更するには、コントロールの**Expanddepth**プロパティを変更します。 これは、特定のノードを展開したときに TreeView がデータバインドされる場合に特に重要です。

## <a name="databinding-the-treeview-control"></a>TreeView コントロールのデータバインド

メニューコントロールとは異なり、TreeView は大量のデータを処理するのに適しています。 そのため、SiteMapDataSource または XMLDataSource にデータバインドするだけでなく、多くの場合、TreeView はデータセットやその他のリレーショナルデータにデータバインドされます。 TreeView コントロールが大量のデータにバインドされている場合は、コントロールに実際に表示されているデータのみにバインドすることをお勧めします。 これにより、TreeView ノードが展開されたときに、追加データにデータをバインドできます。

このような場合は、TreeView の**PopulateOnDemand**プロパティを*true*に設定する必要があります。 次に、 **TreeNodePopulate**メソッドの実装を指定する必要があります。

## <a name="data-binding-without-postback"></a>ポストバックを使用しないデータバインディング

前の例のノードを初めて展開すると、ページがポストバックされて更新されることに注意してください。 拡張子はこの例では問題ではありませんが、大量のデータが含まれている運用環境に存在する可能性があると考えることができます。 より優れたシナリオとしては、TreeView によってノードが動的に設定されますが、サーバーへのポストバックは行われません。

**PopulateNodesFromClient**プロパティと**PopulateOnDemand**プロパティを true に設定すると、ASP.NET TreeView コントロールはポストバックなしでノードを動的に設定します。 親ノードが展開されると、XMLHttp 要求がクライアントから作成され、OnTreeNodePopulate イベントが発生します。 サーバーは XML データアイランドで応答し、その後、子ノードのデータバインドに使用されます。

ASP.NET は、この機能を実装するクライアントコードを動的に作成します。 スクリプトを含む &lt;スクリプト&gt; のタグは、AXD ファイルを指すように生成されます。 たとえば、次の一覧は、XMLHttp 要求を生成するスクリプトコードのスクリプトリンクを示しています。

[!code-html[Main](data-bound-controls/samples/sample7.html)]

ブラウザーで上記の AXD ファイルを参照して開くと、XMLHttp 要求を実装するコードが表示されます。 このメソッドは、ユーザーがスクリプトファイルを変更できないようにします。

## <a name="controlling-the-operation-of-the-treeview-control"></a>TreeView コントロールの操作の制御

TreeView コントロールには、コントロールの操作に影響を与えるいくつかのプロパティがあります。 最も明白なプロパティは、 **Showcheckboxes**、 **showexpandcollapse**、および**showcheckboxes**です。

**Showcheckboxes**プロパティは、ノードがレンダリング時にチェックボックスを表示するかどうかに影響します。 このプロパティの有効な値は、 **None**、 **Root**、 **Parent**、**リーフ**、および**All**です。 これらは TreeView コントロールに次のように影響します。

| **プロパティ値** | **効果** |
| --- | --- |
| なし | チェックボックスは、どのノードにも表示されません。 これが既定の設定です。 |
| Root | チェックボックスは、ルートノードにのみ表示されます。 |
| Parent | チェックボックスは、子ノードを持つノードにのみ表示されます。 これらの子ノードは、親ノードまたはリーフノードにすることができます。 |
| リーフ | チェックボックスは、子ノードを持たないノードにのみ表示されます。 |
| All | すべてのノードにチェックボックスが表示されます。 |

チェックボックスが使用されている場合、 **CheckedNodes**プロパティは、ポストバック時にチェックされるツリーノードのコレクションを返します。

**Showexpandcollapse**プロパティは、ルートノードと親ノードの横にある展開/折りたたみイメージの外観を制御します。 このプロパティが**false**に設定されている場合、TreeView ノードはハイパーリンクとして表示され、リンクをクリックすると展開または縮小されます。

**Showlines**プロパティは、親ノードを子ノードに接続するときに線を表示するかどうかを制御します。 **False** (既定値) の場合、行は表示されません。 **True**の場合、TreeView コントロールは、 **LineImagesFolder**プロパティで指定されたフォルダー内の線の画像を使用します。

TreeView の線の外観をカスタマイズするために、Visual Studio .NET 2005 にはラインデザイナーツールが含まれています。 このツールには、TreeView コントロールの [スマートタグ] ボタンを使用して次のようにアクセスできます。

![](data-bound-controls/_static/image1.jpg)

**図 1**

**[線イメージのカスタマイズ]** メニューオプションを選択すると、行デザイナーツールが起動し、TreeView の線の外観を構成できます。

## <a name="treeview-events"></a>TreeView イベント

TreeView コントロールには、次の一意のイベントがあります。

- SelectedNodeChanged は、 **Selectaction**プロパティに基づいてノードが選択されたときに発生します。
- TreeNodeCheckChanged は、ノードの checkboxs 状態が変更されたときに発生します。
- TreeNodeExpanded は、 **Selectaction**プロパティに基づいてノードが展開されるときに発生します。
- TreeNodeCollapsed は、ノードが折りたたまれたときに発生します。
- TreeNodeDataBound は、ノードがデータバインドされている場合に発生します。
- TreeNodePopulate は、ノードに値が設定されるときに発生します。

**Selectaction**プロパティを使用すると、ノードが選択されたときに発生するイベントを構成できます。 SelectAction プロパティは、次のアクションを提供します。

- ノードが選択されている場合は、TreeNodeSelectAction によって TreeNodeExpanded が発生します。
- TreeNodeSelectAction は、ノードが選択されている場合にイベントを発生させません。
- TreeNodeSelectAction ノードが選択されると、SelectedNodeChanged イベントが発生します。
- TreeNodeSelectAction は、ノードが選択されたときに、SelectedNodeChanged イベントと TreeNodeExpanded イベントの両方を発生させます。

## <a name="controlling-appearance-with-styles"></a>スタイルを使用した外観の制御

TreeView コントロールには、スタイルを使用したコントロールの外観を制御するための多くのプロパティが用意されています。 使用できるプロパティは次のとおりです。

| **プロパティ名** | **コントロール** |
| --- | --- |
| HoverNodeStyle | マウスポインターを置いたときのノードのスタイルを制御します。 |
| LeafNodeStyle | リーフノードのスタイルを制御します。 |
| NodeStyle | すべてのノードのスタイルを制御します。 特定のノードスタイル (LeafNodeStyle など) は、このスタイルをオーバーライドします。 |
| ParentNodeStyle | すべての親ノードのスタイルを制御します。 |
| RootNodeStyle | ルートノードのスタイルを制御します。 |
| SelectedNodeStyle | 選択したノードのスタイルを制御します。 |

これらの各プロパティは読み取り専用です。 ただし、それぞれが**TreeNodeStyle**オブジェクトを返すため、そのオブジェクトのプロパティは、*プロパティ*のサブプロパティ形式を使用して変更できます。 たとえば、 **Selectednodestyle**の**ForeColor**プロパティを設定するには、次の構文を使用します。

[!code-aspx[Main](data-bound-controls/samples/sample8.aspx)]

上のタグが閉じられていないことに注意してください。 これは、ここに示した宣言型の構文を使用する場合、HTML コードにも TreeViews ノードを含めることができるためです。

スタイルプロパティは、*プロパティ.* サブプロパティ形式を使用してコードで指定することもできます。 たとえば、コードで**Rootnodestyle**の**ForeColor**プロパティを設定するには、次の構文を使用します。

[!code-csharp[Main](data-bound-controls/samples/sample9.cs)]

> [!NOTE]
> さまざまなスタイルプロパティの包括的な一覧については、TreeNodeStyle オブジェクトに関する MSDN のドキュメントを参照してください。

## <a name="the-sitemappath-control"></a>SiteMapPath コントロール

SiteMapPath コントロールは、ASP.NET 開発者向けの階層リンクナビゲーションコントロールを提供します。 他のナビゲーションコントロールと同様に、SiteMapDataSource や XmlDataSource などの階層データソースに簡単にデータをバインドできます。

SiteMapPath コントロールは、SiteMapNodeItem オブジェクトで構成されます。 ノードには次の3つの種類があります。ルートノード、親ノード、および現在のノード。 ルートノードは、階層構造の最上位にあるノードです。 現在のノードは、現在のページを表します。 他のすべてのノードは親ノードです。

## <a name="controlling-the-operation-of-the-sitemappath-control"></a>SiteMapPath コントロールの操作の制御

SiteMapPath コントロールの操作を制御するプロパティは次のとおりです。

| **プロパティ** | **プロパティの説明** |
| --- | --- |
| ParentLevelsDisplayed | 表示する親ノードの数を制御します。 既定値は-1 です。この場合、表示される親ノードの数に制限はありません。 |
| PathDirection | SiteMapPath の方向を制御します。 有効な値は、RootToCurrent (既定値) と CurrentToRoot です。 |
| PathSeparator | SiteMapPath コントロール内のノードを区切る文字を制御する文字列。 既定値はです。 |
| RenderCurrentNodeAsLink | 現在のノードがリンクとして表示されるかどうかを制御するブール値。 既定値は False です。 |
| SkipLinkText | スクリーンリーダーがページを表示するときに、アクセシビリティを支援します。 このプロパティは、スクリーンリーダーが SiteMapPath コントロールをスキップできるようにします。 この機能を無効にするには、プロパティを String. Empty に設定します。 |

## <a name="templated-sitemappath-controls"></a>テンプレート化した SiteMapPath コントロール

SiteMapControl はテンプレート化されたコントロールであるため、コントロールを表示するために使用するさまざまなテンプレートを定義できます。 SiteMapPath コントロールのテンプレートを編集するには、コントロールの [スマートタグ] ボタンをクリックし、メニューの [テンプレートの編集] を選択します。 次に示すように、[SiteMapTasks] メニューが表示されます。このメニューでは、使用可能なさまざまなテンプレートを選択できます。

![](data-bound-controls/_static/image2.jpg)

**図 2**

**Nodetemplate**テンプレートは、SiteMapPath 内の任意のノードを参照します。 ノードがルートノードまたは現在のノードであり、 **Rootnodetemplate**または**currentnodetemplate**が構成されている場合、nodetemplate はオーバーライドされます。

## <a name="sitemappath-events"></a>SiteMapPath イベント

SiteMapPath コントロールには、コントロールクラスから派生していない2つのイベントがあります。**ItemCreated**イベントと**itemdatabound バインド**イベントです。 ItemCreated イベントは、SiteMapPath 項目が作成されるときに発生します。 ItemDataBound は、SiteMapPath ノードのデータバインディング中に DataBind メソッドが呼び出されたときに発生します。 **SiteMapNodeItemEventArgs**オブジェクトを使用すると、Item プロパティを介して特定の SiteMapNodeItem にアクセスできます。

## <a name="controlling-appearance-with-styles"></a>スタイルを使用した外観の制御

次のスタイルは、SiteMapPath コントロールの書式設定に使用できます。

| **プロパティ名** | **コントロール** |
| --- | --- |
| CurrentNodeStyle | 現在のノードのテキストのスタイルを制御します。 |
| RootNodeStyle | ルートノードのテキストのスタイルを制御します。 |
| NodeStyle | CurrentNodeStyle または RootNodeStyle が適用されないことを前提として、すべてのノードのテキストのスタイルを制御します。 |

NodeStyle プロパティは、CurrentNodeStyle または RootNodeStyle によってオーバーライドされます。 これらの各プロパティは読み取り専用で、**スタイル**オブジェクトを返します。 これらのプロパティのいずれかを使用してノードの外観を変更するには、返されるスタイルオブジェクトのプロパティを設定する必要があります。 たとえば、次のコードは、現在のノードの forecolor プロパティを変更します。

[!code-aspx[Main](data-bound-controls/samples/sample10.aspx)]

プロパティは、次のようにプログラムによって適用することもできます。

[!code-csharp[Main](data-bound-controls/samples/sample11.cs)]

> [!NOTE]
> テンプレートが適用されている場合、スタイルは適用されません。

## <a name="lab-1-configuring-an-aspnet-menu-control"></a>ラボ 1: ASP.NET Menu コントロールの構成

1. 新しい Web サイトを作成します。
2. [ファイル]、[新規作成]、[ファイル] の順に選択し、ファイルテンプレートの一覧から [サイトマップ] を選択して、サイトマップファイルを追加します。
3. サイトマップ (既定では Web サイトマップ) を開き、次の一覧のように変更します。 サイトマップファイル内のリンク先のページは実際には存在しませんが、この演習では問題になりません。

    [!code-xml[Main](data-bound-controls/samples/sample12.xml)]
4. デザインビューで既定の Web フォームを開きます。
5. [ツールボックス] の [ナビゲーション] セクションで、新しいメニューコントロールをページに追加します。
6. ツールボックスの [データ] セクションで、新しい SiteMapDataSource を追加します。 SiteMapDataSource は、サイト内の Web サイトファイルを自動的に使用します。 (Web.config ファイルは、サイトのルートフォルダーに存在*する必要があり*ます)。
7. メニューコントロールをクリックし、[スマートタグ] ボタンをクリックして [メニュータスク] ダイアログボックスを表示します。
8. [データソースの選択] ドロップダウンで、[SiteMapDataSource1] を選択します。
9. [オートフォーマット] リンクをクリックし、メニューの形式を選択します。
10. プロパティペインで、 **Staticdisplaylevels**プロパティを2に設定します。 メニューコントロールで、[ホーム]、[製品]、[サービス] の各ノードがデザイナーに表示されるようになります。
11. ブラウザーでページを参照して、メニューを使用します。 (サイトマップに追加したページは実際には存在しないため、操作を試して参照するとエラーが表示されます)。

StaticDisplayLevels プロパティと MaximumDynamicDisplayLevels プロパティを変更し、それらがメニューのレンダリング方法にどのように影響するかを確認します。

## <a name="lab-2-dynamically-binding-a-treeview-control"></a>ラボ 2: TreeView コントロールを動的にバインドする

この演習では、ローカルで実行 SQL Server、Northwind データベースが SQL Server インスタンスに存在することを前提としています。 これらの条件が満たされない場合は、サンプルの接続文字列を変更してください。 また、信頼関係接続ではなく SQL Server 認証を指定することが必要になる場合もあります。

1. 新しい Web サイトを作成します。
2. Default.aspx のコードビューに切り替え、すべてのコードを以下に示すコードに置き換えます。 

    [!code-aspx[Main](data-bound-controls/samples/sample13.aspx)]
3. ページを treeview .aspx として保存します。
4. ページを参照します。
5. ページが最初に表示されたら、ブラウザーでページのソースを表示します。 クライアントに送信されたのは、表示可能なノードのみであることに注意してください。
6. 任意のノードの横にあるプラス記号をクリックします。
7. ページのソースをもう一度表示します。 新しく表示されたノードが現在表示されていることに注意してください。

## <a name="lab-3-details-view-and-editing-data-using-a-gridview-and-detailsview"></a>ラボ 3: GridView と DetailsView を使用したデータの表示と編集

1. 新しい Web サイトを作成します。
2. 新しい web.config を Web サイトに追加します。
3. 次に示すように、web.config ファイルに接続文字列を追加します。 

    [!code-xml[Main](data-bound-controls/samples/sample14.xml)]

    > [!NOTE]
    > 場合によっては、環境に基づいて接続文字列を変更する必要があります。
4. web.config ファイルを保存して閉じます。
5. Default.aspx を開き、新しい SqlDataSource コントロールを追加します。
6. SqlDataSource コントロールの ID を**Products**に変更します。
7. **[SqlDataSource Tasks]** メニューの **[データソースの構成]** をクリックします。
8. 接続 ドロップダウンで  **Northwind** を選択し、次へ をクリックします。
9. **[名前]** ボックスの一覧から**Products**を選択し、次に示すように、 **ProductID**、 **ProductName**、 **UnitPrice**、および**在庫**の各チェックボックスをオンにします。 

![](data-bound-controls/_static/image3.jpg)

    **Figure 3**
10. **[次へ]** をクリックします。
11. **[完了]** をクリックします。
12. ソースビューに切り替えて、生成されたコードを確認します。 SqlDataSource コントロールに追加された**SelectCommand**、 **DeleteCommand**、 **InsertCommand**、および**UpdateCommand**に注意してください。 追加されたパラメーターにも注目してください。
13. デザインビューに切り替えて、新しい GridView コントロールをページに追加します。
14. [**データソースの選択]** ドロップダウンから **[Products]** を選択します。
15. 次のように、[**ページングを有効に**し、**選択を有効にする**] をオンにします 

![](data-bound-controls/_static/image4.jpg)

    **Figure 4**
16. **[列の編集]** リンクをクリックし、 **[フィールドの自動生成]** がオンになっていることを確認します。
17. **[OK]** をクリックします。
18. GridView コントロールを選択した状態で、プロパティ ペインの **いる datakeynames** プロパティの横にあるボタンをクリックします。
19. **[使用できるデータフィールド]** の一覧から **[ProductID]** を選択し、[ **&gt;** ] ボタンをクリックして追加します。
20. [OK] をクリックします。
21. 新しい SqlDataSource コントロールをページに追加します。
22. SqlDataSource コントロールの ID を**Details**に変更します。
23. SqlDataSource Tasks メニューの **データソースの構成** をクリックします。
24. ドロップダウンから **[Northwind]** を選択し、 **[次へ]** をクリックします。
25. <strong>名前</strong> ボックスの一覧から  <strong>Products</strong>  を選択し、<strong>列</strong> ボックスの一覧の <strong>\<strong > * チェックボックスをオンにします。
26. **[WHERE]** ボタンをクリックします。
27. **[列]** ボックスの一覧から **[ProductID]** を選択します。
28. [演算子] ボックスの一覧の [ **=** ] を選択します。
29. **[ソース]** ドロップダウンから **[コントロール]** を選択します。
30. **[コントロール ID]** ドロップダウンから **[GridView1]** を選択します。
31. **[追加]** ボタンをクリックして、where 句を追加します。
32. **[OK]** をクリックします。
33. **[詳細設定]** ボタンをクリックし、 **[INSERT、UPDATE、および DELETE ステートメントの生成]** チェックボックスをオンにします。
34. **[OK]** をクリックします。
35. **[次へ]** をクリックし、 **[完了]** をクリックします。
36. DetailsView コントロールをページに追加します。
37. **[データソースの選択]** ドロップダウンで、 **[詳細]** を選択します。
38. 次に示すように、 **[編集を有効にする]** チェックボックスをオンにします。 

![](data-bound-controls/_static/image1.gif)

    **Figure 5**
39. ページを保存し、default.aspx を参照します。
40. [別のレコード] の横にある **[選択]** リンクをクリックして、DetailsView の更新を自動的に表示します。
41. DetailsView コントロールの **[編集]** リンクをクリックします。
42. レコードに変更を加え、 **[更新]** をクリックします。
