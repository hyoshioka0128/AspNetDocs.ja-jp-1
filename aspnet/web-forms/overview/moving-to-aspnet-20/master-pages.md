---
uid: web-forms/overview/moving-to-aspnet-20/master-pages
title: マスター ページ |マイクロソフトドキュメント
author: rick-anderson
description: Web サイトを成功させるための重要なコンポーネントの 1 つは、一貫した外観です。 ASP.NET 1.x では、開発者はユーザー コントロールを使用して共通のページ elem..
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 9c0cce4d-efd9-4c14-b0e8-a1a140abb3f4
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/master-pages
msc.type: authoredcontent
ms.openlocfilehash: b493feb21d2e3d6429f0a23df5aab66e0c4c5b07
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543185"
---
# <a name="master-pages"></a>マスター ページ

[マイクロソフト](https://github.com/microsoft)

> Web サイトを成功させるための重要なコンポーネントの 1 つは、一貫した外観です。 ASP.NET 1.x では、開発者はユーザー コントロールを使用して、Web アプリケーション全体で共通のページ要素をレプリケートしました。 これは確かに実行可能なソリューションですが、ユーザー コントロールを使用する場合は、いくつかの欠点があります。 たとえば、ユーザー コントロールの位置を変更するには、サイト全体で複数のページを変更する必要があります。 また、ユーザー コントロールは、ページに挿入された後もデザイン ビューに表示されません。

Web サイトを成功させるための重要なコンポーネントの 1 つは、一貫した外観です。 ASP.NET 1.x では、開発者はユーザー コントロールを使用して、Web アプリケーション全体で共通のページ要素をレプリケートしました。 これは確かに実行可能なソリューションですが、ユーザー コントロールを使用する場合は、いくつかの欠点があります。 たとえば、ユーザー コントロールの位置を変更するには、サイト全体で複数のページを変更する必要があります。 また、ユーザー コントロールは、ページに挿入された後もデザイン ビューに表示されません。

ASP.NET 2.0 では、一貫性のある外観を維持する方法としてマスター ページが導入されています。

## <a name="why-master-pages"></a>マスター ページの理由

ASP.NET 2.0 でマスター ページが必要な理由を疑問に思うかもしれません。 結局のところ、Web サイト開発者はすでに ASP.NET 1.x のユーザー コントロールを使用して、ページ間でコンテンツ領域を共有しています。 ユーザー コントロールが、共通のレイアウトを作成するための最適なソリューションではない理由は、実際にはいくつかあります。

ユーザー コントロールは、実際にはページ レイアウトを定義しません。 代わりに、ページの一部のレイアウトと機能を定義します。 この 2 つの区別は、ユーザー コントロール ソリューションの管理性を大幅に難しくするため、重要です。 たとえば、ページ上のユーザー コントロールの位置を変更する場合は、ユーザー コントロールが表示される実際のページを編集する必要があります。 ほんの数ページしかない場合は問題ありませんが、大規模なサイトでは、すぐにサイト管理の悪夢になります!

共通のレイアウトを定義するためにユーザー コントロールを使用するもう 1 つの欠点は、ASP.NET自体のアーキテクチャに根ざしています。 ユーザー コントロールのパブリック メンバーが変更された場合は、そのユーザー コントロールを使用するすべてのページを再コンパイルする必要があります。 次に、ASP.NETは、最初にアクセスしたときにページを再 JIT します。 この場合も、スケーラビリティが高く、大規模なサイトに対するサイト管理の問題が発生します。

これらの問題 (およびそれ以上の問題) は、ASP.NET 2.0 のマスター ページでうまく対処されています。

## <a name="how-master-pages-work"></a>マスター ページの動作

マスターページは、他のページのテンプレートに似ています。 他のページ間で共有する必要があるページ要素 (メニュー、枠など) は、マスター ページに追加されます。 サイトに新しいページを追加すると、マスター ページに関連付けることができます。 マスタ ページに関連付けられているページを**コンテンツ ページ**と呼ばれます。 既定では、コンテンツ ページはマスター ページから外観を取ります。 ただし、マスター ページを作成する場合は、コンテンツ ページを独自のコンテンツに置き換えることができるページの一部を定義できます。 これらの部分は、ASP.NET 2.0 で導入された新しいコントロールを使用して定義されます。**コントロールを配置します**。

マスター ページには、任意の数の ContentPlaceHolder コントロールを含めることができます (またはまったく含まれていません)。コンテンツ ページでは、コンテンツプレース ホルダー コントロールのコンテンツが**コンテンツ**コントロール内 ASP.NETに表示されます。 既定では、コンテンツ ページコンテンツ コントロールは空であるため、独自のコンテンツを提供できます。 コンテンツ コントロール内のマスター ページのコンテンツを使用する場合は、このモジュールの後半で説明するように、そのコンテンツを使用できます。 コンテンツ コントロールは、コンテンツ コントロールのコンテンツプレース ホルダー ID 属性を介してコンテンツプレース ホルダー コントロールにマップされます。 次のコードは、コンテンツ コントロールをマスター ページの mainBody と呼ばれるコンテンツプレース ホルダー コントロールにマップします。

[!code-aspx[Main](master-pages/samples/sample1.aspx)]

> [!NOTE]
> マスター ページは、他のページの基本クラスであると説明されることがよくあります。 それは実際には真実ではありません。 マスター ページとコンテンツ ページの関係は、継承の 1 つではありません。

**図 1**は、マスター ページと関連付けられたコンテンツ ページを Visual Studio 2005 に表示する場合に示しています。 マスター ページに ContentPlaceHolder コントロールを表示し、対応するコンテンツ コントロールをコンテンツ ページに表示できます。 コンテンツ プレース ホルダーの外側にあるマスター ページのコンテンツは表示されますが、コンテンツ ページでは淡色表示されています。 コンテンツ ページに置き換えられるのは、プレースホルダー内のコンテンツのみです。 マスター ページから取得したその他のコンテンツはすべて変更不可です。

![マスター ページと関連付けられたコンテンツ ページ](master-pages/_static/image1.jpg)

**図 1**: マスタ ページと関連付けられたコンテンツ ページ

## <a name="creating-a-master-page"></a>マスター ページの作成

新しいマスター ページを作成するには

1. Visual Studio 2005 を開き、新しい Web サイトを作成します。
2. [ファイル]、[新規作成]、[ファイル] の順にクリックします。
3. **図 2**に示すように、[新しい項目の追加] ダイアログから [マスター ファイル] を選択します。
4. [追加] をクリックします。

![新しいマスタ ページの作成](master-pages/_static/image2.jpg)

**図 2**: 新しいマスタ ページの作成

マスタ ページのファイル拡張子は *.master*です。 これは、マスター ページが通常のページと異なる方法の 1 つです。 もう 1 つの主な違いは、@Pageディレクティブの代わりに、マスター@Masterページにディレクティブが含まれるということです。 作成したマスター ページのソース ビューに切り替えて、コードを確認します。

新しいマスター ページには、既定で 1 つのプレース ホルダー コントロールがあります。 ほとんどの場合、最初に共通のページ要素を作成してから、カスタム コンテンツが必要な場所に ContentPlaceHolder コントロールを挿入する方が理にかなっています。 このような場合、開発者は既定の ContentPlaceHolder コントロールを削除し、ページが開発されると新しいコントロールを挿入する必要があります。 コントロールはサイズ変更ハンドルを表示しているにもかかわらずサイズ変更できません。 コントロールのサイズは、1 つの例外を除いて、含まれているコンテンツに基づいて自動的にサイズが設定されます。テーブル セルなどのブロック要素の内側に配置した場合、コントロールのサイズは要素のサイズに合わせて調整されます。

## <a name="lab-1-working-with-master-pages"></a>演習 1 マスター ページの操作

このラボでは、新しいマスター ページを作成し、3 つのプレース ホルダー コントロールを定義します。 新しいコンテンツ ページを作成し、少なくとも 1 つの ContentPlaceHolder コントロールのコンテンツを置き換えます。

1. マスター ページを作成し、プレース ホルダー コントロールを挿入します。 

    1. 上述の手順に従って、新しいマスター ページを作成します。
    2. 既定のプレース ホルダー コントロールを削除します。
    3. コントロールの上枠の枠線をクリックして ContentPlaceHolder コントロールを選択し、キーボードの Del キーを押してコントロールを削除します。
    4. 図 3 に示すように *、ヘッダーとサイド*テンプレートを使用して新しいテーブルを挿入します。 テーブル全体がデザイナーに表示されるように、幅と高さをそれぞれ 90% に変更します。

![](master-pages/_static/image3.jpg)

**図 3**

1. テーブルの各セルにカーソルを置き *、valign*プロパティを*top*に設定します。
2. ツールボックスから、テーブルの上部のセル (ヘッダー セル) にプレース ホルダー コントロールを挿入します。
3. この PlaceHolder コントロールを挿入すると、図 4 に示すように、行の高さがページのほぼ全体を占めています。 この時点でそれについて心配しないでください。

![空のスペースは、プレース ホルダーと同じセル内にあります。](master-pages/_static/image1.gif)

**図 4**: 空のスペースは、プレース ホルダーと同じセル内にあります

1. 他の 2 つのセルにプレース ホルダー コントロールを配置します。 他の PlaceHolder コントロールが挿入されると、テーブルのセルのサイズは期待どおりに行われます。 これで、図**5**に示すページのようになります。

![すべてのプレース ホルダー コントロールを持つマスター。 ヘッダー セルのセルの高さが、必要な値になっていることに注意してください。](master-pages/_static/image2.gif)

**図 5**: すべてのプレース ホルダー コントロールを持つマスター。 ヘッダー セルのセルの高さが、必要な値になっていることに注意してください。

1. 3 つのプレース ホルダー コントロールのそれぞれに、選択したテキストを入力します。
2. マスター ページを exercise1.master として保存します。
3. 新しい Web フォームを作成し、それを exercise1.master マスター ページに関連付けます。
4. Visual Studio 2005 で [ファイル]、[新規作成]、[ファイル] の順に選択します。
5. [新しい項目の追加] ダイアログで **[Web フォーム**] を選択します。
6. 図 6 に示すように、[マスター ページの選択] チェック ボックスがオンになっていることを確認します。

![新しいコンテンツ ページの追加](master-pages/_static/image3.gif)

**図 6**: 新しいコンテンツ ページの追加

1. [追加] をクリックします。
2. 図 7 に示すように、[マスター ページの選択] ダイアログで [exercise1.master] を選択します。
3. [OK] をクリックして新しいコンテンツ ページを追加します。

新しいコンテンツ ページは、マスター ページの各プレース ホルダー コントロールに対して 1 つのコンテンツ コントロールを持つ Visual Studio に表示されます。 既定では、コンテンツ コントロールは空なので、独自のコンテンツを追加できます。 マスター ページの ContentPlaceHolder コントロールのコンテンツを使用する場合は、図**8**に示すように、スマート タグシンボル (コントロールの右上隅にある小さな黒い矢印) をクリックし、スマート タグから *[既定のマスター コンテンツ*] を選択します。 この操作を行うと、メニュー項目が *[カスタム コンテンツの作成]* に変わります。 この時点でクリックすると、マスター ページからコンテンツが削除され、その特定の Content コントロールのカスタム コンテンツを定義できます。

![コンテンツ コントロールをマスタ ページ コンテンツに既定に設定する](master-pages/_static/image4.gif)

**図 7**: コンテンツ コントロールをマスタ ページ コンテンツに既定で設定する

## <a name="connecting-master-page-and-content-pages"></a>マスター ページとコンテンツ ページの接続

マスター ページとコンテンツ ページの関連付けは、次の 4 つの方法のいずれかで構成できます。

- ディレクティブの<strong>マスターページファイル属性</strong>@Page
- コード内の**プロパティを**設定します。
- アプリケーション構成ファイル (アプリケーションのルート フォルダー内の web.config) 内の**&lt;pages&gt;** 要素
- サブフォルダー構成ファイル (web.config サブフォルダー) 内の**&lt;pages&gt;** 要素

## <a name="masterpagefile-attribute"></a>マスターページファイル属性

属性を使用すると、特定のASP.NET ページにマスター ページを簡単に適用できます。 また、この方法は、演習 1 で行ったように、[マスター ページの選択] チェック ボックスをオンにした場合に**マスター ページ**を適用する方法でもあります。

## <a name="setting-pagemasterpagefile-in-code"></a>コード内のページ.マスターページファイルを設定する

MasterPageFile プロパティをコードで設定すると、実行時に特定のマスター ページをコンテンツに適用できます。 これは、ユーザーロールやその他の条件に基づいて特定のマスターページを適用する必要がある場合に役立ちます。 プロパティは、PreInit メソッドで設定する必要があります。 メソッドの後に設定されている場合は、無効なオペレーション例外がスローされます。 このプロパティが設定されているページには、ページのトップレベル コントロールとして Content コントロールも含まれている必要があります。 それ以外の場合は、プロパティが設定されているときに、HttpException がスローされます。

## <a name="using-the-ltpagesgt-element"></a>ページ&gt;要素&lt;の使用

web.config ファイルの&lt;pages&gt;要素で masterPageFile 属性を設定することで、ページのマスター ページを構成できます。 このメソッドを使用する場合は、アプリケーション構造の下位にある web.config ファイルでこの設定をオーバーライドできることに注意してください。 @Pageディレクティブに設定されている MasterPageFile 属性も、この設定をオーバーライドします。 pages&gt; &lt;要素を使用すると、特定のフォルダーまたはファイルで必要に応じてオーバーライドできる*マスター マスター*ページを簡単に作成できます。

## <a name="properties-in-master-pages"></a>マスタ ページのプロパティ

マスター ページは、そのプロパティをマスター ページ内で公開するだけでプロパティを公開できます。 たとえば、次のコードは SomeProperty というプロパティを定義します。

[!code-csharp[Main](master-pages/samples/sample2.cs)]

コンテンツ ページから SomeProperty プロパティにアクセスするには、次のように Master プロパティを使用する必要があります。

[!code-csharp[Main](master-pages/samples/sample3.cs)]

## <a name="nesting-master-pages"></a>マスター ページのネスト

マスター ページは、大規模な Web アプリケーションで一般的な外観を実現するための最適なソリューションです。 ただし、大規模なサイトの特定の部分が共通のインターフェイスを共有し、他のパーツが異なるインターフェイスを共有することは珍しくありません。 そのニーズに対処するために、複数のマスターページが最適なソリューションです。 ただし、大規模なアプリケーションには、サイトの特定のセクション間でのみ共有されるすべてのページや他のコンポーネント間で共有される特定のコンポーネント (メニューなど) が含まれている可能性があるという事実は解決しません。 この種の状況では、入れ子になったマスター ページがニーズを満たします。 ご覧のとおり、通常のマスター ページは、マスター ページとコンテンツ ページで構成されます。 入れ子になったマスター ページの状況では、2 つのマスター ページがあります。親マスターと子マスター。 子マスター ページもコンテンツ ページであり、そのマスターは親マスター ページです。

一般的なマスター ページのコードを次に示します。

[!code-aspx[Main](master-pages/samples/sample4.aspx)]

入れ子になったマスター シナリオでは、これは親マスターになります。 別のマスタ ページでは、このページをマスター ページとして使用し、そのコードは次のようになります。

[!code-aspx[Main](master-pages/samples/sample5.aspx)]

このシナリオでは、子マスターは親マスターのコンテンツ ページでもあることに注意してください。 子マスターのすべてのコンテンツは、親の ContentPlaceHolder コントロールからコンテンツを取得するコンテンツ コントロールの内部に表示されます。

> [!NOTE]
> 入れ子になったマスター ページでは、デザイナーのサポートは利用できません。 ネストされたマスタを使用して開発する場合は、ソース ビューを使用する必要があります。

このビデオでは、入れ子になったマスター ページの使用方法について説明します。

![](master-pages/_static/image1.png)

[フルスクリーンビデオを開く](master-pages/_static/nested1.wmv)

![マスター ページの選択](master-pages/_static/image4.jpg)

**図 8**: マスタ ページの選択
