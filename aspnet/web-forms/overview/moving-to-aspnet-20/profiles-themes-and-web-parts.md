---
uid: web-forms/overview/moving-to-aspnet-20/profiles-themes-and-web-parts
title: プロファイル、テーマ、および Web パーツ |マイクロソフトドキュメント
author: rick-anderson
description: ASP.NET 2.0 では、構成とインストルメンテーションに大きな変更があります。 新しいASP.NET構成 API を使用すると、構成の変更を行うことができます。
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 92df4051-77c6-492c-bd34-23d24189cea4
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/profiles-themes-and-web-parts
msc.type: authoredcontent
ms.openlocfilehash: 4bc98cca226a0bd9bd766a21e88b0facf2a4b610
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543640"
---
# <a name="profiles-themes-and-web-parts"></a>プロファイル、テーマ、Web パーツ

[マイクロソフト](https://github.com/microsoft)

> ASP.NET 2.0 では、構成とインストルメンテーションに大きな変更があります。 新しいASP.NET構成 API を使用すると、プログラムで構成の変更を行うことができます。 さらに、新しい構成設定が多数存在し、新しい構成とインストルメンテーションを実現できます。

ASP.NET 2.0 は、パーソナライズされた Web サイトの領域が大幅に改善された点を表します。 既に説明したメンバーシップ機能に加えて、ASP.NETプロファイル、テーマ、および Web パーツによって、Web サイトの個人用設定が大幅に強化されています。

## <a name="aspnet-profiles"></a>ASP.NETプロファイル

ASP.NETプロファイルはセッションと似ています。 違いは、プロファイルが永続的であるのに対して、ブラウザーが閉じられたときにセッションが失われる点です。 セッションとプロファイルの別の大きな違いは、プロファイルが厳密に型指定されるため、開発プロセス中に IntelliSense を使用できる点です。

プロファイルは、コンピューター構成ファイルまたはアプリケーションの web.config ファイルで定義されます。 (サブフォルダーの web.config ファイルでプロファイルを定義することはできません。以下のコードは、Web サイトの訪問者の姓と名を格納するプロファイルを定義します。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample1.xml)]

プロファイル プロパティの既定のデータ型は System.String です。 上の例では、データ型が指定されていません。 したがって、名と姓のプロパティは、どちらも文字列型です。 前述のように、プロファイル プロパティは厳密に型指定されます。 次のコードは、Int32 型の age の新しいプロパティを追加します。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample2.xml)]

プロファイルは、通常、ASP.NETフォーム認証で使用されます。 フォーム認証と組み合わせて使用する場合、各ユーザーはユーザー ID に関連付けられた個別のプロファイルを持ちます。 ただし、次に示すように、構成ファイル内の anonymousIdentity&lt;&gt;要素と**allowAnonymous**属性を使用して、匿名アプリケーションでプロファイルを使用することもできます。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample3.xml)]

匿名ユーザーがサイトを参照すると、ASP.NETユーザーの**ProfileCommon**のインスタンスが作成されます。 このプロファイルは、ブラウザの Cookie に格納されている一意の ID を使用して、ユーザーを一意の訪問者として識別します。 このようにして、匿名で参照しているユーザーのプロファイル情報を格納できます。

## <a name="profile-groups"></a>プロファイル グループ

プロファイルのプロパティをグループ化することができます。 プロパティをグループ化することで、特定のアプリケーションに対して複数のプロファイルをシミュレートできます。

次の構成では、2 つのグループの FirstName プロパティと LastName プロパティを構成します。バイヤーと見込み客。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample4.xml)]

次のように、特定のグループにプロパティを設定できます。

[!code-csharp[Main](profiles-themes-and-web-parts/samples/sample5.cs)]

## <a name="storing-complex-objects"></a>複雑なオブジェクトの格納

ここまでの例では、単純なデータ型をプロファイルに格納しました。 **serializeAs**属性を使用してシリアル化のメソッドを指定することにより、複合データ型をプロファイルに格納することもできます。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample6.xml)]

この場合、タイプは仕入請求書です。 PurchaseInvoice クラスはシリアル化可能としてマークする必要があり、任意の数のプロパティを含めることができます。 たとえば、PurchaseInvoice に **"NumItemsPurchased"** というプロパティがある場合、コードでそのプロパティを次のように参照できます。

[!code-css[Main](profiles-themes-and-web-parts/samples/sample7.css)]

## <a name="profile-inheritance"></a>プロファイルの継承

複数のアプリケーションで使用するプロファイルを作成できます。 ProfileBase から派生するプロファイル クラスを作成すると、次に示すように**inherits**属性を使用して、複数のアプリケーションでプロファイルを再利用できます。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample8.xml)]

この場合、クラス**の購買プロファイル**は次のようになります。

[!code-csharp[Main](profiles-themes-and-web-parts/samples/sample9.cs)]

## <a name="profile-providers"></a>プロファイル プロバイダー

ASP.NETプロファイルは、プロバイダー モデルを使用します。 既定のプロバイダーは、SqlProfileProvider プロバイダーを使用して、Web\_アプリケーションのアプリ データ フォルダーに SQL Server Express データベースに情報を格納します。 データベースが存在しない場合、プロファイルが情報を格納しようとすると、ASP.NETによって自動的に作成されます。

ただし、場合によっては、独自のプロファイル プロバイダーを開発する必要があります。 ASP.NET プロファイル機能を使用すると、さまざまなプロバイダーを簡単に使用できます。

カスタム プロファイル プロバイダーは、次の場合に作成します。

- プロファイル情報は、FoxPro データベースや Oracle データベースなど、.NET Framework に含まれているプロファイル プロバイダーでサポートされていないデータ ソースに格納する必要があります。
- .NET Framework に含まれるプロバイダで使用されるデータベース スキーマとは異なるデータベース スキーマを使用して、プロファイル情報を管理する必要があります。 一般的な例として、プロファイル情報を既存の SQL Server データベースのユーザー データと統合する場合があります。

### <a name="required-classes"></a>必要なクラス

プロファイル プロバイダーを実装するには、抽象クラスを継承するクラスを作成します。 次に **、** 抽象クラスは、システム構成.プロバイダー.ProviderBase 抽象クラスを継承する抽象クラスを継承します。 この継承チェーンのため **、ProfileProvider**クラスの必須メンバーに加えて **、SettingsProvider**クラスと**ProviderBase**クラスの必須メンバーを実装する必要があります。

次の表では、プロパティとメソッドを実装する必要がありますを説明します、 **ProviderBase**、**設定プロバイダー**、および**プロファイル プロバイダー抽象**クラス。

### <a name="providerbase-members"></a>プロバイダーベースのメンバー

| **メンバー** | **説明** |
| --- | --- |
| Initialize メソッド | プロバイダー インスタンスの名前と構成設定の NameValueCollection を入力として受け取ります。 コンピューター構成または Web.config ファイルで指定された実装固有の値やオプションなど、プロバイダー インスタンスのオプションとプロパティ値を設定するために使用します。 |

### <a name="settingsprovider-members"></a>設定プロバイダ メンバ

| **メンバー** | **説明** |
| --- | --- |
| プロパティ | 各プロファイルに格納されるアプリケーション名。 プロファイル プロバイダーは、アプリケーション名を使用して、アプリケーションごとにプロファイル情報を個別に格納します。 これにより、異なるアプリケーションで同じユーザー名を作成した場合に、複数のASP.NETアプリケーションで競合なく同じデータ ソースを使用できます。 または、複数のASP.NETアプリケーションが同じアプリケーション名を指定してプロファイル データ ソースを共有できます。 |
| メソッドを取得します。 | オブジェクトを入力として受け取ります。 **設定コンテキスト**は、ユーザーに関する情報を提供します。 この情報を主キーとして使用して、ユーザーのプロファイル プロパティ情報を取得できます。 ユーザー名と、ユーザーが認証されているか匿名であるかを取得するには **、SettingsContext**オブジェクトを使用します。 **プロパティコレクション**には、プロパティオブジェクトのコレクションが含まれています。 各**SettingsProperty**オブジェクトには、プロパティの名前と型のほか、プロパティの既定値やプロパティが読み取り専用かどうかなどの追加情報が用意されています。 メソッド**は**、入力として提供される設定プロパティ オブジェクトに基づいて、設定プロパティ値コレクションに**値**を設定します。 指定したユーザーのデータ ソースの値は、各**SettingsPropertyValue**オブジェクトのプロパティ値プロパティに割り当てられ、コレクション全体が返されます。 このメソッドを呼び出すと、指定したユーザー プロファイルの LastActivityDate 値も現在の日時に更新されます。 |
| メソッドを設定します。 | オブジェクト**を入力**として受け取**ります**。 **設定コンテキスト**は、ユーザーに関する情報を提供します。 この情報を主キーとして使用して、ユーザーのプロファイル プロパティ情報を取得できます。 ユーザー名と、ユーザーが認証されているか匿名であるかを取得するには **、SettingsContext**オブジェクトを使用します。 **オブジェクト****のコレクション**が含まれています。 各**SettingsPropertyValue**オブジェクトには、プロパティの名前、型、値、およびプロパティの既定値やプロパティが読み取り専用かどうかなどの追加情報が用意されています。 **SetPropertyValues**メソッドは、指定したユーザーのデータ ソースのプロファイル プロパティ値を更新します。 このメソッドを呼び出すと、指定したユーザー プロファイルの**LastActivityDate**値と LastUpdatedDate 値も現在の日付と時刻に更新されます。 |

### <a name="profileprovider-members"></a>プロファイル プロバイダ メンバ

| **メンバー** | **説明** |
| --- | --- |
| メソッドを削除します。 | ユーザー名の文字列配列を入力として受け取り、アプリケーション名が**ApplicationName**プロパティ値と一致する指定した名前のすべてのプロファイル情報とプロパティ値をデータ ソースから削除します。 データ ソースがトランザクションをサポートしている場合は、トランザクションにすべての削除操作を含め、トランザクションをロールバックして、削除操作が失敗した場合は例外をスローすることをお勧めします。 |
| メソッドを削除します。 | 入力として ProfileInfo オブジェクトのコレクションを取得し、アプリケーション名が**ApplicationName**プロパティ値と一致する各プロファイルのすべてのプロファイル情報とプロパティ値をデータ ソースから削除します。 データ ソースがトランザクションをサポートしている場合は、トランザクションにすべての削除操作を含め、トランザクションをロールバックして、削除操作が失敗した場合は例外をスローすることをお勧めします。 |
| メソッドを削除します。 | 入力として、ProfileAuthenticationOption 値と DateTime オブジェクトを取得し、最後のアクティビティの日付が指定した日時以下で、アプリケーション名が**ApplicationName**プロパティ値と一致する場合、データ ソースからすべてのプロファイル情報とプロパティ値を削除します。 **ProfileAuthenticationOption**パラメーターは、匿名プロファイルのみ、認証済みプロファイルのみ、またはすべてのプロファイルを削除するかどうかを指定します。 データ ソースがトランザクションをサポートしている場合は、トランザクションにすべての削除操作を含め、トランザクションをロールバックして、削除操作が失敗した場合は例外をスローすることをお勧めします。 |
| メソッドを取得します。 | 入力として取ります、 **ProfileAuthenticationOption**値、ページ インデックスを指定する整数、ページ サイズを指定する整数、およびプロファイルの合計数に設定される整数への参照。 アプリケーション名が**ApplicationName**プロパティ値と一致するデータ ソース内のすべてのプロファイルの**ProfileInfo**オブジェクトを含む ProfileInfoCollection を返します。 **ProfileAuthenticationOption**パラメーターは、匿名プロファイルのみ、認証済みプロファイルのみ、またはすべてのプロファイルを返すかどうかを指定します。 **GetAllProfiles**メソッドによって返される結果は、ページ インデックスとページ サイズの値によって制約されます。 ページ サイズの値は **、ProfileInfoCollection**で返す**ProfileInfo**オブジェクトの最大数を指定します。 ページインデックス値は、返す結果のページを指定します。 合計レコードのパラメーターは、プロファイルの合計数に設定された out パラメーター (Visual Basic では**ByRef**を使用できます) です。 たとえば、データ ストアにアプリケーションのプロファイルが 13 個含まれ、ページ インデックス値がページ サイズが 5 の 2 の場合、返される**ProfileInfoCollection には**6 番目から 10 番目のプロファイルが含まれます。 メソッドが返されるときに、レコードの合計値は 13 に設定されます。 |
| メソッドの取得 | 入力として取ります、 **ProfileAuthenticationOption**値 **、DateTime**オブジェクト、ページインデックスを指定する整数、ページサイズを指定する整数、およびプロファイルの合計数に設定される整数への参照。 最後のアクティビティの日付が指定した**DateTime**以下で、アプリケーション名が**ApplicationName**プロパティ値と一致するデータ ソース内のすべてのプロファイルの**ProfileInfo**オブジェクトを含む**ProfileInfoCollection**を返します。 **ProfileAuthenticationOption**パラメーターは、匿名プロファイルのみ、認証済みプロファイルのみ、またはすべてのプロファイルを返すかどうかを指定します。 **GetAllInactiveProfiles**メソッドによって返される結果は、ページ インデックスとページ サイズの値によって制約されます。 ページ サイズの値は **、ProfileInfoCollection**で返す**ProfileInfo**オブジェクトの最大数を指定します。 ページインデックス値は、返す結果のページを指定します。 合計レコードのパラメーターは、プロファイルの合計数に設定された out パラメーター (Visual Basic では**ByRef**を使用できます) です。 たとえば、データ ストアにアプリケーションのプロファイルが 13 個含まれ、ページ インデックス値がページ サイズが 5 の 2 の場合、返される**ProfileInfoCollection には**6 番目から 10 番目のプロファイルが含まれます。 メソッドが返されるときに、レコードの合計値は 13 に設定されます。 |
| メソッド | 入力として取ります、 **ProfileAuthenticationOption**値、ユーザー名を含む文字列、ページインデックスを指定する整数、ページサイズを指定する整数、およびプロファイルの合計数に設定される整数への参照。 ユーザー名が指定したユーザー名と一致し、アプリケーション名が**ApplicationName**プロパティ値と一致するデータ ソース内のすべてのプロファイルの**ProfileInfo**オブジェクトを含む**ProfileInfoCollection**を返します。 **ProfileAuthenticationOption**パラメーターは、匿名プロファイルのみ、認証済みプロファイルのみ、またはすべてのプロファイルを返すかどうかを指定します。 データ ソースがワイルドカード文字などの追加の検索機能をサポートしている場合は、ユーザー名に対して、より広範な検索機能を提供できます。 **FindProfilesByUserName**メソッドによって返される結果は、ページ インデックスとページ サイズの値によって制約されます。 ページ サイズの値は **、ProfileInfoCollection**で返す**ProfileInfo**オブジェクトの最大数を指定します。 ページインデックス値は、返す結果のページを指定します。 合計レコードのパラメーターは、プロファイルの合計数に設定された out パラメーター (Visual Basic では**ByRef**を使用できます) です。 たとえば、データ ストアにアプリケーションのプロファイルが 13 個含まれ、ページ インデックス値がページ サイズが 5 の 2 の場合、返される**ProfileInfoCollection には**6 番目から 10 番目のプロファイルが含まれます。 メソッドが返されるときに、レコードの合計値は 13 に設定されます。 |
| メソッドをアクティブにします。 | **ProfileAuthenticationOption**値、ユーザー名 **、DateTime**オブジェクト、ページ インデックスを指定する整数、ページ サイズを指定する整数、およびプロファイルの合計数に設定される整数への参照を入力として受け取ります。 ユーザー名が指定されたユーザー名と一致し、最後のアクティビティの日付が指定した**DateTime**以下で、アプリケーション名が**ApplicationName**プロパティ値と一致するデータ ソース内のすべてのプロファイルの**ProfileInfo**オブジェクトを含む**ProfileInfoCollection**を返します。 **ProfileAuthenticationOption**パラメーターは、匿名プロファイルのみ、認証済みプロファイルのみ、またはすべてのプロファイルを返すかどうかを指定します。 データ ソースがワイルドカード文字などの追加の検索機能をサポートしている場合は、ユーザー名に対して、より広範な検索機能を提供できます。 **FindInactiveProfilesByUserName**メソッドによって返される結果は、ページ インデックスとページ サイズの値によって制約されます。 ページ サイズの値は **、ProfileInfoCollection**で返す**ProfileInfo**オブジェクトの最大数を指定します。 ページインデックス値は、返す結果のページを指定します。 合計レコードのパラメーターは、プロファイルの合計数に設定された out パラメーター (Visual Basic では**ByRef**を使用できます) です。 たとえば、データ ストアにアプリケーションのプロファイルが 13 個含まれ、ページ インデックス値がページ サイズが 5 の 2 の場合、返される**ProfileInfoCollection には**6 番目から 10 番目のプロファイルが含まれます。 メソッドが返されるときに、レコードの合計値は 13 に設定されます。 |
| メソッドを取得します。 | **入力として、ProfileAuthenticationOption**値と**DateTime**オブジェクトを取得し、最後のアクティビティの日付が指定した**DateTime**以下で、アプリケーション名が**ApplicationName**プロパティ値と一致するデータ ソース内のすべてのプロファイルの数を返します。 **ProfileAuthenticationOption**パラメーターは、匿名プロファイルのみ、認証済みプロファイルのみ、またはすべてのプロファイルをカウントするかどうかを指定します。 |

### <a name="applicationname"></a>ApplicationName

プロファイル プロバイダーはアプリケーションごとにプロファイル情報を個別に格納するため、データ スキーマにアプリケーション名が含まれ、クエリおよび更新にもアプリケーション名が含まれていることを確認する必要があります。 たとえば、次のコマンドは、ユーザー名とプロファイルが匿名であるかどうかを基にしてデータベースからプロパティ値を取得するために使用され **、ApplicationName**値がクエリに含まれていることを確認します。

[!code-sql[Main](profiles-themes-and-web-parts/samples/sample10.sql)]

## <a name="aspnet-themes"></a>ASP.NETテーマ

## <a name="what-are-aspnet-20-themes"></a>2.0 テーマASP.NET何ですか?

Web アプリケーションの最も重要な側面の 1 つは、サイト全体で一貫した外観と雰囲気を持つ点です。 ASP.NET 1.x 開発者は、通常、カスケード スタイル シート (CSS) を使用して、一貫した外観と雰囲気を実装します。 ASP.NET 2.0 テーマは、ASP.NETの開発者が、ASP.NETサーバー コントロールの外観と HTML 要素の外観を定義できるため、CSS を大幅に改善します。 ASP.NETテーマは、個々のコントロール、特定の Web ページ、または Web アプリケーション全体に適用できます。 テーマは、CSS ファイル、オプションのスキン ファイル、およびイメージが必要な場合は、オプションの Images ディレクトリの組み合わせを使用します。 スキン ファイルは、ASP.NETサーバー コントロールの外観を制御します。

## <a name="where-are-themes-stored"></a>テーマはどこに保存されますか?

テーマが保存される場所は、そのスコープによって異なります。 任意のアプリケーションに適用できるテーマは、次のフォルダに格納されます。

`C:\WINDOWS\Microsoft.NET\Framework\v2.x.xxxxx\ASP.NETClientFiles\Themes\<Theme_Name>`

特定のアプリケーションに固有のテーマは、Web サイトのルート`App\_Themes\<Theme\_Name>`にあるディレクトリに格納されます。

> [!NOTE]
> スキン ファイルは、外観に影響を与えるサーバー コントロールのプロパティのみを変更する必要があります。

グローバル テーマは、Web サーバー上で実行されている任意のアプリケーションまたは Web サイトに適用できるテーマです。 これらのテーマは、既定では、v2.x.xxxxx ディレクトリ内にある ASP.NET クライアント ファイル\テーマ ディレクトリに格納されます。 または、Web サイトのルートにある aspnet\_クライアント/システム\_Web/[バージョン]/テーマ/[テーマ\_名] フォルダーにテーマ ファイルを移動することもできます。

アプリケーション固有のテーマは、ファイルが存在するアプリケーションにのみ適用できます。 これらのファイルは、Web`App\_Themes/<theme\_name>`サイトのルートにあるディレクトリに格納されます。

## <a name="the-components-of-a-theme"></a>テーマの構成要素

テーマは、1 つ以上の CSS ファイル、オプションのスキン ファイル、およびオプションの Images フォルダーで構成されます。 CSS ファイルは、任意の名前 (default.css やテーマ.css など) を指定でき、テーマフォルダのルートになければなりません。 CSS ファイルは、特定のセレクターの通常の CSS クラスと属性を定義するために使用されます。 ページ要素に CSS クラスの 1 つを適用するには **、CSSClass**プロパティを使用します。

スキン ファイルは、ASP.NET サーバー コントロールのプロパティ定義を含む XML ファイルです。 以下のコードはスキンファイルの例です。

[!code-aspx[Main](profiles-themes-and-web-parts/samples/sample11.aspx)]

**下**図 1 は、テーマが適用されずに閲覧された小さなASP.NETページを示しています。 **図 2 は**、テーマが適用された同じファイルを示しています。 背景色とテキストの色は CSS ファイルを介して設定されます。 ボタンとテキストボックスの外観は、上記のスキンファイルを使用して構成されます。

![テーマなし](profiles-themes-and-web-parts/_static/image1.gif)

**図1**: テーマなし

![テーマ適用](profiles-themes-and-web-parts/_static/image2.gif)

**図2**: テーマ適用

上記のスキン ファイルでは、すべての TextBox コントロールと Button コントロールの既定のスキンが定義されています。 つまり、ページに挿入されたすべての TextBox コントロールと Button コントロールは、この外観を使用します。 コントロールの**SkinID**プロパティを使用して、これらのコントロールの特定のインスタンスに適用できるスキンを定義することもできます。

次のコードは、Button コントロールのスキンを定義します。 **goButton**の**SkinID**プロパティを持つ Button コントロールのみが、スキンの外観を取ります。

[!code-aspx[Main](profiles-themes-and-web-parts/samples/sample12.aspx)]

サーバー コントロールの種類ごとに、既定のスキンを 1 つだけ設定できます。 追加のスキンが必要な場合は、SkinID プロパティを使用する必要があります。

## <a name="applying-themes-to-pages"></a>ページへのテーマの適用

テーマは、次のいずれかの方法で適用できます。

- web.config ファイルの&lt;ページ&gt;要素内
- ページの@Pageディレクティブ内
- プログラムを使用する

## <a name="applying-a-theme-in-the-configuration-file"></a>設定ファイルでのテーマの適用

アプリケーション構成ファイルでテーマを適用するには、次の構文を使用します。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample13.xml)]

ここで指定するテーマ名は、テーマ フォルダの名前と一致する必要があります。 このフォルダは、このコースで前述したいずれかの場所に存在できます。 存在しないテーマを適用しようとすると、構成エラーが発生します。

## <a name="applying-a-theme-in-the-page-directive"></a>ページ ディレクティブでのテーマの適用

@ Page ディレクティブでテーマを適用することもできます。 このメソッドを使用すると、特定のページにテーマを使用できます。

@Pageディレクティブでテーマを適用するには、次の構文を使用します。

[!code-aspx[Main](profiles-themes-and-web-parts/samples/sample14.aspx)]

ここで指定したテーマは、前述のようにテーマ フォルダと一致する必要があります。 存在しないテーマを適用しようとすると、ビルドエラーが発生します。 また、この属性が強調表示され、そのようなテーマが存在しない旨が通知されます。

## <a name="applying-a-theme-programmatically"></a>プログラムによるテーマの適用

テーマをプログラムで適用するには **、Page\_PreInit**メソッドでページの**テーマ**プロパティを指定する必要があります。

テーマをプログラムで適用するには、次の構文を使用します。

[!code-csharp[Main](profiles-themes-and-web-parts/samples/sample15.cs)]

ページのライフサイクルのために PreInit メソッドでテーマを適用する必要があります。 その時点以降に適用すると、ページのテーマはランタイムによって既に適用されており、その時点での変更はライフサイクルで遅すぎます。 存在しないテーマを適用すると **、HttpException**が発生します。 テーマがプログラムによって適用されると、サーバー コントロールに SkinID プロパティが指定されている場合、ビルド警告が発生します。 この警告は、テーマが宣言によって適用されず、無視できることを通知するための警告です。

## <a name="exercise-1--applying-a-theme"></a>演習 1 : テーマを適用する

この練習では、web サイトにASP.NETテーマを適用します。

> [!IMPORTANT]
> Word を使用してスキン ファイルに情報を入力する場合は、通常の引用符をスマートな引用符に置き換えないことを確認してください。 スマート引用符は、スキンファイルに問題を引き起こすでしょう。

1. 新しい ASP.NET Web サイトの作成
2. ソリューション エクスプローラーでプロジェクトを右クリックし、[新しい項目の追加] を選択します。
3. ファイルの一覧から [Web 構成ファイル] を選択し、[追加] をクリックします。
4. ソリューション エクスプローラーでプロジェクトを右クリックし、[新しい項目の追加] を選択します。
5. スキンファイルを選択し、[追加]をクリックします。
6. [アプリ\_のテーマ] フォルダー内にファイルを配置するかどうか尋ねられたら、[はい] をクリックします。
7. ソリューション エクスプローラーで [アプリ\_のテーマ] フォルダー内の SkinFile フォルダーを右クリックし、[新しい項目の追加] を選択します。
8. ファイルのリストから「スタイルシート」を選択し、「追加」をクリックします。 これで、新しいテーマを実装するために必要なすべてのファイルが手に入ります。 ただし、Visual Studio では、テーマ フォルダーにスキン ファイルという名前が付けられています。 そのフォルダを右クリックし、名前をCoolThemeに変更します。
9. SkinFile.skin ファイルを開き、ファイルの末尾に次のコードを追加します。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample16.aspx)]
10. スキンファイルファイルを保存します。
11. スタイルシート.css を開きます。
12. その中のすべてのテキストを次のテキストに置き換えます。 

    [!code-css[Main](profiles-themes-and-web-parts/samples/sample17.css)]
13. スタイルシート.css ファイルを保存します。
14. 既定の.aspx ページを開きます。
15. TextBox コントロールとボタン コントロールを追加します。
16. ページを保存します。 次に、Default.aspx ページを参照します。 通常の Web フォームとして表示されます。
17. web.config ファイルを開きます。
18. 開始`<system.web>`タグのすぐ下に次の項目を追加します。 

    [!code-xml[Main](profiles-themes-and-web-parts/samples/sample18.xml)]
19. web.config ファイルを保存します。 次に、Default.aspx ページを参照します。 テーマが適用された画面が表示されます。
20. まだ開いていない場合は、Visual Studio で Default.aspx ページを開きます。
21. ボタンを選択します。
22. **プロパティ**を変更して、ボタンを移動します。 Visual Studio には、ボタン コントロールの有効な SkinID 値を含むドロップダウン が用意されています。
23. ページを保存します。 ブラウザでページをプレビューし直します。 ボタンは今「行く」と言うべきであり、外観が広いはずです。

**SkinID**プロパティを使用すると、特定の種類のサーバー コントロールの異なるインスタンスに対して、さまざまなスキンを簡単に構成できます。

## <a name="the-stylesheettheme-property"></a>スタイルシートのテーマプロパティ

ここまでは、テーマ プロパティを使用したテーマの適用についてのみ説明しました。 Theme プロパティを使用すると、スキン ファイルはサーバー コントロールの宣言設定をオーバーライドします。 たとえば、演習 1 では、ボタン コントロールに "goButton" という SkinID を指定し、ボタンのテキストを "go" に変更しました。 デザイナーのボタンの Text プロパティが "Button" に設定されているのに、テーマが上書きされているのに気づいたかもしれません。 テーマは、デザイナーのプロパティ設定を常にオーバーライドします。

テーマのスキン ファイルで定義されているプロパティをデザイナーで指定されたプロパティでオーバーライドできるようにする場合は、テーマ プロパティの代わりに**StyleSheetTheme**プロパティを使用できます。 StyleSheetTheme プロパティは、テーマ プロパティと同じですが、テーマ プロパティのようにすべての明示的なプロパティ設定をオーバーライドするわけではありません。

この動作を確認するには、演習 1 でプロジェクトから web.config ファイルを開`<pages>`き、要素を次のように変更します。

[!code-xml[Main](profiles-themes-and-web-parts/samples/sample19.xml)]

Default.aspx ページを参照すると、Button コントロールに "ボタン" というテキスト プロパティが再度表示されます。 これは、デザイナーでの明示的なプロパティ設定が、goButton の SkinID によって設定された Text プロパティをオーバーライドしているためです。

## <a name="overriding-themes"></a>テーマの上書き

グローバルテーマは、アプリケーションのApp\_Themesフォルダに同じ名前のテーマを適用することで上書きできます。 ただし、テーマは、実際の上書きシナリオでは適用されません。 ランタイムが App\_Themes フォルダー内のテーマ ファイルを検出すると、それらのファイルを使用してテーマが適用され、グローバル テーマは無視されます。

プロパティはオーバーライド可能で、コード内で次のようにオーバーライドできます。

[!code-csharp[Main](profiles-themes-and-web-parts/samples/sample20.cs)]

## <a name="web-parts"></a>Web パーツ

ASP.NET Web パーツは、Web サイトを作成するための統合されたコントロールセットであり、エンド ユーザーは Web ページのコンテンツ、外観、および動作をブラウザから直接変更できます。 この変更は、サイト上のすべてのユーザーまたは個々のユーザーに適用できます。 ユーザーがページやコントロールを変更すると、設定を保存して、今後のブラウザ セッション (パーソナライゼーションと呼ばれる機能) 間でユーザーの個人設定を保持できます。 これらの Web パーツ機能により、開発者や管理者の介入なしに、エンド ユーザーが Web アプリケーションを動的にパーソナル化できるようになります。

Web パーツ コントロール セットを使用すると、開発者はエンド ユーザーが次の操作を実行できるようにします。

- ページコンテンツをパーソナライズします。 ユーザーは、ページに新しい Web パーツ コントロールを追加したり、削除したり、非表示にしたり、通常のウィンドウのように最小化したりできます。
- ページ レイアウトをパーソナライズします。 ユーザーは、Web パーツ コントロールをページ上の別の領域にドラッグしたり、外観、プロパティ、動作を変更したりできます。
- コントロールのエクスポートとインポート ユーザーは、Web パーツ コントロールの設定をインポートまたはエクスポートして、他のページやサイトで使用できるようにし、プロパティ、外観、およびコントロール内のデータを保持できます。 これにより、エンド ユーザーに対するデータ入力と構成の要求が軽減されます。
- 接続を作成します。 ユーザーは、たとえば、グラフ コントロールが株価チェック コントロールのデータのグラフを表示できるように、コントロール間の接続を確立できます。 ユーザーは、接続自体だけでなく、グラフ コントロールの外観と詳細をカスタマイズできます。
- サイトレベルの設定を管理およびパーソナライズします。 承認されたユーザーは、サイト レベルの設定を構成したり、サイトやページにアクセスできるユーザーを決定したり、コントロールへのロール ベースのアクセスを設定したりできます。 たとえば、管理ロールのユーザーは、Web パーツ コントロールをすべてのユーザーが共有するように設定し、管理者以外のユーザーが共有コントロールをパーソナル化できないようにすることができます。

通常、Web パーツ コントロールを使用するページの作成、個々の Web パーツ コントロールの作成、ポータルなどの完全でパーソナル化可能な Web アプリケーションの作成の 3 つの方法のいずれかで Web パーツを操作します。

## <a name="page-development"></a>ページ開発

ページ開発者は、Visual Studio 2005 などのビジュアル デザイン ツールを使用して、Web パーツを使用するページを作成できます。 Visual Studio などのツールを使用する利点の 1 つは、Web パーツ コントロール セットが、ビジュアル デザイナーで Web パーツ コントロールのドラッグ アンド ドロップの作成と構成を行う機能を提供することです。 たとえば、デザイナーを使用して Web パーツ ゾーンまたは Web パーツ エディター コントロールをデザイン サーフェイスにドラッグし、Web パーツ コントロール セットによって提供される UI を使用してデザイナーでコントロールを構成できます。 これにより、Web パーツ アプリケーションの開発が迅速化され、記述する必要があるコードの量が減ります。

## <a name="control-development"></a>コントロール開発

標準の Web サーバー コントロール、カスタム サーバー コントロール、ユーザー コントロールなど、既存のASP.NET コントロールを Web パーツ コントロールとして使用できます。 環境を最大限にプログラムで制御するには、WebPart クラスから派生するカスタム Web パーツ コントロールを作成することもできます。 Web パーツ コントロールの開発を個別に行う場合、通常はユーザー コントロールを作成して Web パーツ コントロールとして使用するか、カスタム Web パーツ コントロールを開発します。

カスタム Web パーツ コントロールの開発の例として、カスタマイズ可能な Web パーツ コントロールとしてパッケージ化するのに役立つ可能性のある他のASP.NET サーバー コントロールによって提供される機能を提供するコントロールを作成できます。、または天気や旅行情報。 ビジュアル デザイナーをコントロールに提供する場合、Visual Studio を使用するページ開発者は、コントロールを Web パーツ ゾーンにドラッグし、追加のコードを記述しなくてもデザイン時に構成できます。

パーソナル化は、Web パーツ機能の基盤です。 これにより、ユーザーは、ページ上の Web パーツ コントロールのレイアウト、外観、および動作を変更またはカスタマイズできます。 個人用設定は長期間使用され、現在のブラウザー セッション (ビューステートと同様) だけでなく、長期保存でも保持されるため、ユーザーの設定は今後のブラウザー セッション用に保存されます。 Web パーツ ページの既定の個人用設定は有効になっています。

UI 構造コンポーネントはパーソナル化に依存し、すべての Web パーツ コントロールで必要なコア構造とサービスを提供します。 すべての Web パーツ ページで必要な UI 構造コンポーネントの 1 つに、WebPartManager コントロールがあります。 このコントロールは表示されませんが、ページ上のすべての Web パーツ コントロールを調整する重要なタスクを持っています。 たとえば、個々の Web パーツ コントロールをすべて追跡します。 Web パーツ 領域 (ページ上に Web パーツ コントロールを含む領域) と、どのコントロールがどの領域に含まれるかを管理します。 また、ブラウズ、接続、編集、カタログモード、パーソナライゼーションの変更をすべてのユーザまたは個別のユーザに適用するかどうかなど、ページが含まれるさまざまな表示モードを追跡および制御します。 最後に、Web パーツ コントロール間の接続と通信を開始し、追跡します。

2 番目の UI 構造コンポーネントは、ゾーンです。 ゾーンは、Web パーツ ページ上のレイアウト マネージャーとして機能します。 パーツ クラス (パーツ コントロール) から派生するコントロールを含み、整理し、水平方向または垂直方向にモジュールページ レイアウトを実行する機能を提供します。 ゾーンは、含まれている各コントロールに共通の一貫性のある UI 要素 (ヘッダーとフッターのスタイル、タイトル、境界線スタイル、アクション ボタンなど) を提供します。これらの共通要素は、コントロールのクロムと呼ばれます。 さまざまな表示モードやさまざまなコントロールで、いくつかの特殊なタイプのゾーンが使用されます。 さまざまな種類のゾーンについては、以下の「Web パーツの基本コントロール」セクションで説明します。

Web パーツ UI コントロールは、すべて**Part**クラスから派生し、Web パーツ ページのプライマリ UI を構成します。 Web パーツ コントロール セットは、パーツ コントロールの作成に使用できるオプションに柔軟性があり、包括的です。 独自のカスタム Web パーツ コントロールを作成するだけでなく、既存のASP.NETサーバー コントロール、ユーザー コントロール、またはカスタム サーバー コントロールを Web パーツ コントロールとして使用することもできます。 Web パーツ ページの作成に最も一般的に使用される必須のコントロールについては、次のセクションで説明します。

## <a name="web-parts-essential-controls"></a>Web パーツの基本コントロール

Web パーツ コントロール セットは広範ですが、Web パーツが動作するために必要なコントロールや、Web パーツ ページで最も頻繁に使用されるコントロールが必要なコントロールもあります。 Web パーツの使用と基本的な Web パーツ ページの作成を開始する際には、次の表で説明する重要な Web パーツ コントロールについて理解しておくと役に立ちます。

| **Web パーツ コントロール** | **説明** |
| --- | --- |
| Webpartmanager | ページ上のすべての Web パーツ コントロールを管理します。 すべての Web パーツ ページに対して 1 つの (および 1 つの) **WebPartManager**コントロールが必要です。 |
| Catalogzone | カタログ パーツ コントロールが含まれています。 このゾーンを使用して、ページに追加するコントロールをユーザーが選択できる Web パーツ コントロールのカタログを作成します。 |
| Editorzone | エディターパーツ コントロールが含まれています。 この領域を使用して、ユーザーがページ上の Web パーツ コントロールを編集およびパーソナル化できるようにします。 |
| Webpartzone | ページのメイン UI を構成する WebPart コントロールの全体的なレイアウトを含み、レイアウトを提供します。 Web パーツ コントロールを使用してページを作成するときは、このゾーンを使用します。 ページには、1 つ以上のゾーンを含めることができます。 |
| Connectionszone | コントロールが含まれ、接続を管理するための UI が用意されています。 |
| Web パーツ (ジェネリック Web パーツ) | プライマリ UI をレンダリングします。ほとんどの Web パーツ UI コントロールは、このカテゴリに分類されます。 プログラムによる制御を最大限に行う場合は、基本**WebPart**コントロールから派生するカスタム Web パーツ コントロールを作成できます。 既存のサーバー コントロール、ユーザー コントロール、またはカスタム コントロールを Web パーツ コントロールとして使用することもできます。 これらのコントロールのいずれかがゾーンに配置されるたびに **、WebPartManager**コントロールは実行時に**GenericWebPart**コントロールで自動的にラップするので、Web パーツ機能で使用できます。 |
| Catalogpart | ユーザーがページに追加できる Web パーツ コントロールの一覧が含まれます。 |
| ウェブパートコネクション | ページ上の 2 つの Web パーツ コントロール間の接続を作成します。 接続では、Web パーツ コントロールの 1 つを (データのプロバイダー) として定義し、もう 1 つの Web パーツ コントロールをコンシューマーとして定義します。 |
| Editorpart | 専用のエディター コントロールの基本クラスとして機能します。 |
| エディターパーツ コントロール (外観エディタ パーツ、レイアウト エディタ パーツ、ビヘイビア エディタ パーツ、およびプロパティ グリッド エディタ パーツ) | ページ上の Web パーツ UI コントロールのさまざまな側面をユーザーがパーソナル化できるようにする |

## <a name="lab-create-a-web-part-page"></a>演習 : Web パーツ ページを作成する

この演習では、ASP.NET プロファイルを介して情報を保持する Web パーツ ページを作成します。

### <a name="creating-a-simple-page-with-web-parts"></a>Web パーツを使用した単純なページの作成

このチュートリアルでは、Web パーツ コントロールを使用して静的コンテンツを表示するページを作成します。 Web パーツを操作する最初の手順は、2 つの必要な構造要素を含むページを作成することです。 まず、Web パーツ ページでは、すべての Web パーツ コントロールを追跡および調整するための Web パーツ マネージャー コントロールが必要です。 次に、Web パーツ ページには、WebPart またはその他のサーバー コントロールを含み、ページの指定した領域を占有する複合コントロールである 1 つ以上の領域が必要です。

> [!NOTE]
> Web パーツのパーソナル化を有効にするために何もする必要はありません。Web パーツ コントロール セットに対して既定で有効になっています。 サイトで Web パーツ ページを初めて実行すると、ASP.NETユーザーのパーソナル化設定を格納する既定のパーソナル化プロバイダーが設定されます。 パーソナル化の詳細については、「Web パーツのパーソナル化の概要」を参照してください。

### <a name="to-create-a-page-for-containing-web-parts-controls"></a>Web パーツ コントロールを含むページを作成するには

1. 既定のページを閉じ、WebPartsDemo.aspx という名前のサイトに新しいページを追加します。
2. **デザイン**ビューに切り替えます。
3. [**表示**] メニュー**で、[非ビジュアル コントロール**] および [**詳細]** オプションが選択されていることを確認し、UI を持たないレイアウト タグとコントロールを表示できるようにします。
4. デザイン画面でタグの前`<div>`にカーソルを置き、Enter キーを押して新しい行を追加します。 新しい行の文字の前にカーソルを置き、メニューの [**ブロック形式**] ドロップダウン リスト コントロールをクリックして、[**見出し 1]** オプションを選択します。 見出しに、テキスト Web**パーツ デモンストレーション ページ**を追加します。
5. ツールボックスの **[Web パーツ]** タブから**WebPartManager**コントロールをページにドラッグし、新しい行の文字の直後とタグ`<div>`の前に配置します。   
  
   **コントロール**は出力を表示しないため、デザイナー画面に灰色のボックスとして表示されます。
6. タグ内に挿入ポイントを`<div>`置きます。
7. [**レイアウト**] メニューの [**表の挿入**] をクリックし、1 行と 3 列の新しいテーブルを作成します。 [**セルのプロパティ]** ボタンをクリックし、[**上下整列**] ドロップダウン リストから **[上]** を選択し **、[OK]** をクリックして、もう一度 **[OK] を**クリックしてテーブルを作成します。
8. 左のテーブル列に WebPartZone コントロールをドラッグします。 **コントロール**を右クリックし、[**プロパティ**] をクリックして、次のプロパティを設定します。   
  
   ID: サイドバーゾーン   
  
   ヘッダーテキスト: サイドバー
9. 2 番目の**WebPartZone**コントロールを中央のテーブルの列にドラッグし、次のプロパティを設定します。   
  
   ID: メインゾーン   
  
   ヘッダーテキスト: メイン
10. ファイルを保存します。

ページには、別々に制御できる 2 つの異なるゾーンが追加されました。 ただし、どちらのゾーンにもコンテンツが含まれるため、コンテンツの作成は次の手順です。 このチュートリアルでは、静的コンテンツのみを表示する Web パーツ コントロールを操作します。

Web パーツ ゾーンのレイアウトは、ゾーン&lt;テンプレート&gt;要素によって指定されます。 ゾーン テンプレート内には、カスタムの Web パーツ コントロール、ユーザー コントロール、または既存のサーバー コントロールのいずれであっても、任意のASP.NET コントロールを追加できます。 ここでは Label コントロールを使用しており、静的テキストを追加しているだけであることに注意してください。 通常のサーバー コントロールを**WebPartZone**ゾーンに配置すると、ASP.NETは実行時にコントロールを Web パーツ コントロールとして扱います。

**メイン ゾーンのコンテンツを作成するには**

1. **デザイン**ビューで、[ツールボックス] の **[標準**] タブから [**ラベル**] コントロールをドラッグして **、ID**プロパティが MainZone に設定されているゾーンのコンテンツ領域に移動します。
2. **ソース**ビューに切り替えます。 MainZone&lt;のラベル&gt;コントロールをラップするために、**Label**ゾーン テンプレート要素が追加されていることに注意してください。
3. **title**という名前の属性を&lt;asp:label&gt;要素に追加し、その値を Content に設定します。 asp:ラベル&gt;要素から Text="ラベル&lt;" 属性を削除します。 &lt;asp:label&gt;要素の開始タグと終了タグの間に、h2&lt;&gt;要素タグのペア内に「ウェルカム」などのテキストを**追加**します。 コードは次のようになります。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample21.aspx)]
4. ファイルを保存します。

次に、Web パーツ コントロールとしてページに追加できるユーザー コントロールを作成します。

### <a name="to-create-a-user-control"></a>ユーザー コントロールを作成するには

1. 検索コントロールとして機能する新しい Web ユーザー コントロールをサイトに追加します。 [ソース コードを**別のファイルに配置**する] オプションの選択を解除します。 WebPartsDemo.aspx ページと同じディレクトリに追加し、名前を付けます。   
  
    > [!NOTE]
    > このチュートリアルのユーザー コントロールには、実際の検索機能は実装されていません。Web パーツの機能を示すためにのみ使用されます。
2. **デザイン**ビューに切り替えます。 ツールボックスの [**標準**] タブから、TextBox コントロールをページにドラッグします。
3. 追加したテキスト ボックスの後にカーソルを置き、Enter キーを押して新しい行を追加します。
4. 追加したテキスト ボックスの下の新しい行のページに Button コントロールをドラッグします。
5. **ソース**ビューに切り替えます。 ユーザー コントロールのソース コードが次の例のようになっていることを確認します。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample22.aspx)]
6. ファイルを保存して閉じます。

サイドバーゾーンに Web パーツ コントロールを追加できるようになりました。 サイドバーゾーンに 2 つのコントロールを追加します。 リンクは、メイン ゾーンの静的テキストを作成する場合と同様に、標準の**Label**サーバー コントロールとして追加されます。 ただし、ユーザー コントロールに含まれる個々のサーバー コントロールは、ラベル コントロールのようにゾーンに直接含まれる可能性がありますが、この場合は含まれません。 代わりに、前の手順で作成したユーザー コントロールの一部です。 これは、ユーザー コントロールに必要なコントロールや追加機能をパッケージ化し、そのコントロールをゾーン内の Web パーツ コントロールとして参照する一般的な方法を示しています。

実行時に、Web パーツ コントロール セットは、両方のコントロールを GenericWebPart コントロールでラップします。 **GenericWebPart**コントロールが Web サーバー コントロールをラップすると、ジェネリック パーツ コントロールは親コントロールになり、親コントロールの ChildControl プロパティを使用してサーバー コントロールにアクセスできます。 このジェネリックパーツ コントロールを使用すると、標準の Web サーバー コントロールは **、WebPart**クラスから派生する Web パーツ コントロールと同じ基本動作と属性を持つことができます。

### <a name="to-add-web-parts-controls-to-the-sidebar-zone"></a>サイドバー領域に Web パーツ コントロールを追加するには

1. ページを開きます。
2. **デザイン**ビューに切り替えます。
3. 作成したユーザー コントロール ページ SearchUserControl.ascx を**ソリューション エクスプローラー**から **、ID**プロパティが SidebarZone に設定されているゾーンにドラッグし、そこにドロップします。
4. ページを保存します。
5. **ソース**ビューに切り替えます。
6. 次の&lt;例に示すように、&gt;サイドバーゾーンの asp:webpartzone 要素内で、ユーザー コントロール&lt;への参照のすぐ&gt;上に、含まれているリンクを持つ asp:label 要素を追加します。 また、**表に示**すように、Title 属性をユーザー コントロール タグに追加し、値を **"検索**" にします。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample23.aspx)]
7. ファイルを保存して閉じます。

ブラウザでページを参照して、ページをテストできるようになりました。 ページには 2 つのゾーンが表示されます。 次のスクリーン ショットは、ページを示しています。

**2 つの領域を持つ Web パーツ のデモ ページ**

![Web パーツ VS チュートリアル 1 のスクリーンショット](profiles-themes-and-web-parts/_static/image3.gif)

**図 3**: Web パーツ VS チュートリアル 1 のスクリーンショット

各コントロールのタイトル バーには下向きの矢印が表示され、コントロールに対して実行できる操作の動詞メニューにアクセスできます。 いずれかのコントロールの動詞メニューをクリックし、**最小化**動詞をクリックして、コントロールが最小化されていることを確認します。 動詞メニューの [**元に戻す**] をクリックすると、コントロールが通常のサイズに戻ります。

### <a name="enabling-users-to-edit-pages-and-change-layout"></a>ユーザーによるページの編集とレイアウトの変更を有効にする

Web パーツには、ユーザーが Web パーツ コントロールを別の領域にドラッグしてレイアウトを変更する機能が用意されています。 ユーザーが**WebPart**コントロールをあるゾーンから別のゾーンに移動できるようにするだけでなく、ユーザーがコントロールの外観、レイアウト、動作など、さまざまな特性を編集できるようにすることもできます。 Web パーツ コントロール セットには **、WebPart**コントロールの基本的な編集機能が用意されています。 このチュートリアルでは、このチュートリアルでは行いませんが、ユーザーが**WebPart**コントロールの機能を編集できるカスタム エディター コントロールを作成することもできます。 **WebPart**コントロールの場所を変更する場合と同様に、コントロールのプロパティを編集する場合は、ユーザーが行った変更を保存するために、ASP.NETのパーソナル化が必要になります。

チュートリアルのこの部分では、ページ上の任意の**WebPart**コントロールの基本的な特性をユーザーが編集する機能を追加します。 これらの機能を有効にするには、asp:editorzone&lt;&gt;要素と 2 つの編集コントロールと共に、ページに別のカスタム ユーザー コントロールを追加します。

### <a name="to-create-a-user-control-that-enables-changing-page-layout"></a>ページ レイアウトの変更を可能にするユーザー コントロールを作成するには

1. Visual Studio の [**ファイル**] メニューで、[**新規作成**] サブメニューを選択し、[**ファイル**] オプションをクリックします。
2. [**新しい項目の追加]** ダイアログで **、[Web ユーザー コントロール**] を選択します。 新しいファイルに名前を付けます。 [ソース コードを**別のファイルに配置**する] オプションの選択を解除します。
3. [追加] をクリックして、新しいコントロールを作成します。
4. **ソース**ビューに切り替えます。
5. 新しいファイル内の既存のコードをすべて削除し、次のコードを貼り付けます。 このユーザー コントロール コードは、Web パーツ コントロール セットの機能を使用して、ページの表示モードや表示モードを変更できます。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample24.aspx)]
6. ツールバーの保存アイコンをクリックするか、[**ファイル**] メニューの [**保存**] をクリックしてファイルを保存します。

### <a name="to-enable-users-to-change-the-layout"></a>ユーザーがレイアウトを変更できるようにするには

1. WebPartsDemo.aspx ページを開き、**デザイン**ビューに切り替えます。
2. 前に追加した**WebPartManager**コントロールの直後に **、デザイン**ビューにカーソルを置きます。 **コントロールの**後に空白行が表示されるように、テキストの後にハード リターンを追加します。 空白行にカーソルを置きます。
3. 作成したユーザー コントロール (ファイル名は DisplayModeMenu.ascx) を WebPartsDemo.aspx ページにドラッグし、空白行にドロップします。
4. ツールボックスの**WebParts**セクションから WebPartsDemo.aspx ページの残りの開いているテーブル セルにエディター ゾーン コントロールをドラッグします。
5. ツールボックスの **[Web パーツ]** セクションから、アピアランス エディターパーツ コントロールとレイアウト エディター パーツ コントロールを**エディター ゾーン**コントロールにドラッグします。
6. **ソース**ビューに切り替えます。 テーブル セルの結果のコードは、次のコードのようになります。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample25.aspx)]
7. ファイルを保存します。 表示モードの変更とページ レイアウトの変更を可能にするユーザー コントロールを作成し、プライマリ Web ページでそのコントロールを参照しました。

これで、ページを編集してレイアウトを変更する機能をテストできます。

### <a name="to-test-layout-changes"></a>レイアウトの変更をテストするには

1. ブラウザーにページを読み込みます。
2. [**表示モード**] ドロップダウン メニューをクリックし、[**編集**] を選択します。 ゾーンのタイトルが表示されます。
3. サイドバーゾーンからメインゾーンの下部に、タイトルバーを使用して **[マイリンク**]コントロールをドラッグします。 ページは次のスクリーン ショットのようになります。

### <a name="web-parts-demo-page-with-my-links-control-moved"></a>[個人用リンク] コントロールが移動された Web パーツ のデモ ページ

![Web パーツ VS チュートリアル 2 のスクリーンショット](profiles-themes-and-web-parts/_static/image4.gif)

**図 4**: Web パーツ VS チュートリアル 2 スクリーンショット

1. [**表示モード**] ドロップダウン メニューをクリックし、[**参照**] を選択します。 ページが更新され、ゾーン名が消え、マイ**リンク**コントロールが配置された場所に残ります。
2. パーソナル化が機能していることを示すために、ブラウザーを閉じてから、ページを再度読み込みます。 変更内容は、今後のブラウザ セッションのために保存されます。
3. **[表示モード]** メニューの [**編集**] を選択します。   
  
   ページ上の各コントロールは、動詞のドロップダウン メニューを含むタイトル バーに下向きの矢印で表示されます。
4. 矢印をクリックして **、My Links**コントロールの動詞メニューを表示します。 [**編集]** 動詞をクリックします。   
  
   **コントロール**が表示され、追加した EditorPart コントロールが表示されます。
5. エディット コントロールの [**デザイン]** セクションで、[**タイトル**] を [お気に入り] に変更し **、[Chrome の種類]** ドロップダウン リストを使用して **[タイトルのみ**] を選択し、[**適用**] をクリックします。 次のスクリーン ショットは、編集モードのページを示しています。

### <a name="web-parts-demo-page-in-edit-mode"></a>編集モードの Web パーツ デモ ページ

![Web パーツ VS チュートリアル 3 のスクリーンショット](profiles-themes-and-web-parts/_static/image5.gif)

**図 5**: Web パーツ VS チュートリアル 3 のスクリーンショット

1. [**表示モード**]メニューをクリック**し、[参照]** を選択してブラウズモードに戻ります。
2. コントロールのタイトルが更新され、境界線は表示されません(次のスクリーン ショットに示すように)。

### <a name="edited-web-parts-demo-page"></a>編集済みの Web パーツ のデモ ページ

![Web パーツ VS チュートリアル 4 のスクリーンショット](profiles-themes-and-web-parts/_static/image6.gif)

**図 4**: Web パーツ VS チュートリアル 4 のスクリーンショット

### <a name="adding-web-parts-at-run-time"></a>実行時の Web パーツの追加

また、実行時にユーザーが Web パーツ コントロールをページに追加できるようにすることもできます。 これを行うには、Web パーツ カタログを使用してページを構成します。

**実行時にユーザーが Web パーツを追加できるようにするには**

1. WebPartsDemo.aspx ページを開き、**デザイン**ビューに切り替えます。
2. ツールボックスの **[Web パーツ]** タブから、テーブルの右側の列の下の EditorZone コントロールに**CatalogZone**コントロールをドラッグします。   
  
   両方のコントロールが同じテーブル セルに表示される可能性があります。
3. [プロパティ] ウィンドウで **、CatalogZone**コントロールの HeaderText プロパティに文字列 Web**パーツの追加**を割り当てます。
4. ツールボックスの **[Web パーツ]** セクションから **、CatalogCatalog**コントロールのコンテンツ領域に宣言カタログ パーツ コントロールをドラッグします。
5. **コントロール**の右上隅にある矢印をクリックしてタスク メニューを表示し、[**テンプレートの編集**] を選択します。
6. ツールボックスの [**標準**] セクションから、**ファイルアップロード**コントロールと**カレンダー**コントロールを **、コントロール**の**WebPartsTemplate**セクションにドラッグします。
7. **ソース**ビューに切り替えます。 asp:catalog 要素&gt;の&lt;ソース コードを調べます。 **コントロール**には、カタログからページに追加できる&lt;2&gt;つの囲まれたサーバー コントロールを含む Webparts テンプレート要素が含まれていることに注意してください。
8. 次のコード例の各タイトルに表示される文字列値を使用して、カタログに追加した各コントロールに**Title**プロパティを追加します。 タイトルは、通常、デザイン時にこれらの 2 つのサーバー コントロールに設定できるプロパティではありませんが、ユーザーが実行時にこれらのコントロールをカタログから**WebPartZone**ゾーンに追加すると、それぞれ**GenericWebPart**コントロールでラップされます。 これにより、ユーザーは Web パーツ コントロールとして機能し、タイトルを表示できるようになります。   
  
   **コントロール**に含まれる 2 つのコントロールのコードは、次のようになります。 

    [!code-aspx[Main](profiles-themes-and-web-parts/samples/sample26.aspx)]
9. ページを保存します。

これで、カタログをテストできます。

### <a name="to-test-the-web-parts-catalog"></a>Web パーツ カタログをテストするには

1. ブラウザーにページを読み込みます。
2. [**表示モード**] ドロップダウン メニューをクリックし、[**カタログ**] を選択します。   
  
   **[Web パーツの追加]** というタイトルのカタログが表示されます。
3. メインゾーンからサイドバーゾーンの上部に戻る **「お気に入り**」コントロールをドラッグし、そこにドロップします。
4. [Web**パーツの追加**] カタログで、両方のチェック ボックスをオンにし、使用可能なゾーンが含まれているドロップダウン リストから **[Main]** を選択します。
5. カタログの **[追加**] をクリックします。 コントロールがメイン ゾーンに追加されます。 必要に応じて、カタログからコントロールの複数のインスタンスをページに追加できます。   
  
   次のスクリーン ショットは、ファイル アップロード コントロールを含むページとメイン ゾーンの予定表を示しています。 

![カタログからメイン ゾーンに追加されたコントロール](profiles-themes-and-web-parts/_static/image7.gif)

    **Figure 5**: Controls added to Main zone from the catalog
6. [**表示モード**] ドロップダウン メニューをクリックし、[**参照**] を選択します。 カタログが表示されなくなり、ページが更新されます。
7. ブラウザーを閉じます。 ページを再度読み込みます。 変更は保持されます。
