---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
title: ファイルのアップロードC#() |Microsoft Docs
author: rick-anderson
description: ユーザーがバイナリファイル (Word や PDF ドキュメントなど) を Web サイトにアップロードして、サーバーのファイルシステムに保存できるようにする方法について説明します。
ms.author: riande
ms.date: 03/27/2007
ms.assetid: b381b1da-feb3-4776-bc1b-75db53eb90ab
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
msc.type: authoredcontent
ms.openlocfilehash: 4e3e32a829de386a681504c8d5d61dd258b8b2e6
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78441694"
---
# <a name="uploading-files-c"></a><span data-ttu-id="9be36-103">ファイルのアップロード (C#)</span><span class="sxs-lookup"><span data-stu-id="9be36-103">Uploading Files (C#)</span></span>

<span data-ttu-id="9be36-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9be36-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9be36-105">[サンプルアプリのダウンロード](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe)または[PDF のダウンロード](uploading-files-cs/_static/datatutorial54cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9be36-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe) or [Download PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span></span>

> <span data-ttu-id="9be36-106">ユーザーがバイナリファイル (Word や PDF ドキュメントなど) を Web サイトにアップロードして、サーバーのファイルシステムまたはデータベースに格納できるようにする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9be36-106">Learn how to allow users to upload binary files (such as Word or PDF documents) to your Web site where they may be stored in either the server's file system or the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="9be36-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="9be36-107">Introduction</span></span>

<span data-ttu-id="9be36-108">これまでに説明したすべてのチュートリアルでは、テキストデータのみが使用されていました。</span><span class="sxs-lookup"><span data-stu-id="9be36-108">All of the tutorials we ve examined so far have worked exclusively with text data.</span></span> <span data-ttu-id="9be36-109">ただし、多くのアプリケーションには、テキストデータとバイナリデータの両方をキャプチャするデータモデルがあります。</span><span class="sxs-lookup"><span data-stu-id="9be36-109">However, many applications have data models that capture both text and binary data.</span></span> <span data-ttu-id="9be36-110">オンラインのサイトでは、ユーザーが自分のプロファイルに関連付けられた画像をアップロードすることができます。</span><span class="sxs-lookup"><span data-stu-id="9be36-110">An online dating site might allow users to upload a picture to associate with their profile.</span></span> <span data-ttu-id="9be36-111">採用 web サイトでは、ユーザーが Microsoft Word または PDF ドキュメントとして resume をアップロードすることができます。</span><span class="sxs-lookup"><span data-stu-id="9be36-111">A recruiting website might let users upload their resume as a Microsoft Word or PDF document.</span></span>

<span data-ttu-id="9be36-112">バイナリデータを操作すると、新しい一連の課題が加わります。</span><span class="sxs-lookup"><span data-stu-id="9be36-112">Working with binary data adds a new set of challenges.</span></span> <span data-ttu-id="9be36-113">バイナリデータをアプリケーションにどのように格納するかを決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-113">We must decide how the binary data is stored in the application.</span></span> <span data-ttu-id="9be36-114">新しいレコードの挿入に使用されるインターフェイスを更新して、ユーザーが自分のコンピューターからファイルをアップロードできるようにする必要があります。また、レコードに関連付けられているバイナリデータをダウンロードする手段を表示または指定するには、追加の手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-114">The interface used for inserting new records has to be updated to allow the user to upload a file from their computer and extra steps must be taken to display or provide a means for downloading a record s associated binary data.</span></span> <span data-ttu-id="9be36-115">このチュートリアルと次の3つのチュートリアルでは、これらの課題をハードルする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9be36-115">In this tutorial and the next three we'll explore how to hurdle these challenges.</span></span> <span data-ttu-id="9be36-116">これらのチュートリアルの最後に、すべてのカテゴリに画像と PDF のパンフレットを関連付ける、完全に機能するアプリケーションを構築します。</span><span class="sxs-lookup"><span data-stu-id="9be36-116">At the end of these tutorials we'll have built a fully functional application that associates a picture and PDF brochure with each category.</span></span> <span data-ttu-id="9be36-117">このチュートリアルでは、バイナリデータを格納するさまざまな手法について説明し、ユーザーが自分のコンピューターからファイルをアップロードし、web サーバーのファイルシステムに保存する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9be36-117">In this particular tutorial we'll look at different techniques for storing binary data and explore how to enable users to upload a file from their computer and have it saved on the web server s file system.</span></span>

> [!NOTE]
> <span data-ttu-id="9be36-118">アプリケーションのデータモデルの一部であるバイナリデータは、 [BLOB](http://en.wikipedia.org/wiki/Binary_large_object)(バイナリラージオブジェクトの頭字語) と呼ばれることもあります。</span><span class="sxs-lookup"><span data-stu-id="9be36-118">Binary data that is part of an application s data model is sometimes referred to as a [BLOB](http://en.wikipedia.org/wiki/Binary_large_object), an acronym for Binary Large OBject.</span></span> <span data-ttu-id="9be36-119">これらのチュートリアルでは、用語のバイナリデータを使用することを選択しました。ただし、BLOB という用語は同義です。</span><span class="sxs-lookup"><span data-stu-id="9be36-119">In these tutorials I have chosen to use the terminology binary data, although the term BLOB is synonymous.</span></span>

## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a><span data-ttu-id="9be36-120">手順 1: バイナリデータ Web ページの操作を作成する</span><span class="sxs-lookup"><span data-stu-id="9be36-120">Step 1: Creating the Working with Binary Data Web Pages</span></span>

<span data-ttu-id="9be36-121">バイナリデータのサポートの追加に関連する課題の調査を開始する前に、まず、このチュートリアルに必要な ASP.NET ページを web サイトプロジェクトに作成し、次の3つについて説明します。</span><span class="sxs-lookup"><span data-stu-id="9be36-121">Before we begin to explore the challenges associated with adding support for binary data, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="9be36-122">まず、`BinaryData`という名前の新しいフォルダーを追加します。</span><span class="sxs-lookup"><span data-stu-id="9be36-122">Start by adding a new folder named `BinaryData`.</span></span> <span data-ttu-id="9be36-123">次に、次の ASP.NET ページをそのフォルダーに追加します。各ページは `Site.master` マスターページに関連付けられていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="9be36-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`

![バイナリデータ関連のチュートリアルの ASP.NET ページを追加する](uploading-files-cs/_static/image1.gif)

<span data-ttu-id="9be36-125">**図 1**: バイナリデータ関連のチュートリアルの ASP.NET ページを追加する</span><span class="sxs-lookup"><span data-stu-id="9be36-125">**Figure 1**: Add the ASP.NET Pages for the Binary Data-Related Tutorials</span></span>

<span data-ttu-id="9be36-126">他のフォルダーと同様に、`BinaryData` フォルダー内の `Default.aspx` には、そのセクションのチュートリアルが一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-126">Like in the other folders, `Default.aspx` in the `BinaryData` folder will list the tutorials in its section.</span></span> <span data-ttu-id="9be36-127">`SectionLevelTutorialListing.ascx` ユーザーコントロールがこの機能を提供していることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="9be36-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="9be36-128">したがって、ソリューションエクスプローラーからページデザインビューにドラッグして、このユーザーコントロールを `Default.aspx` に追加します。</span><span class="sxs-lookup"><span data-stu-id="9be36-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="9be36-129">[SectionLevelTutorialListing ユーザーコントロールを default.aspx に追加 ![には](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span></span>

<span data-ttu-id="9be36-130">**図 2**: `Default.aspx` に `SectionLevelTutorialListing.ascx` ユーザーコントロールを追加する ([クリックすると、フルサイズの画像が表示](uploading-files-cs/_static/image2.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9be36-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](uploading-files-cs/_static/image2.png))</span></span>

<span data-ttu-id="9be36-131">最後に、これらのページをエントリとして `Web.sitemap` ファイルに追加します。</span><span class="sxs-lookup"><span data-stu-id="9be36-131">Lastly, add these pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="9be36-132">具体的には、GridView `<siteMapNode>`を拡張した後に、次のマークアップを追加します。</span><span class="sxs-lookup"><span data-stu-id="9be36-132">Specifically, add the following markup after the Enhancing the GridView `<siteMapNode>`:</span></span>

[!code-xml[Main](uploading-files-cs/samples/sample1.xml)]

<span data-ttu-id="9be36-133">`Web.sitemap`を更新した後、ブラウザーを使用してチュートリアル web サイトを表示します。</span><span class="sxs-lookup"><span data-stu-id="9be36-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="9be36-134">左側のメニューには、バイナリデータチュートリアルを使用するための項目が含まれるようになりました。</span><span class="sxs-lookup"><span data-stu-id="9be36-134">The menu on the left now includes items for the Working with Binary Data tutorials.</span></span>

![サイトマップに、バイナリデータの操作に関するチュートリアルのエントリが含まれるようになりました。](uploading-files-cs/_static/image3.gif)

<span data-ttu-id="9be36-136">**図 3**: サイトマップにバイナリデータの使用に関するチュートリアルのエントリが含まれるようになりました。</span><span class="sxs-lookup"><span data-stu-id="9be36-136">**Figure 3**: The Site Map Now Includes Entries for the Working with Binary Data Tutorials</span></span>

## <a name="step-2-deciding-where-to-store-the-binary-data"></a><span data-ttu-id="9be36-137">手順 2: バイナリデータを格納する場所の決定</span><span class="sxs-lookup"><span data-stu-id="9be36-137">Step 2: Deciding Where to Store the Binary Data</span></span>

<span data-ttu-id="9be36-138">Application s データモデルに関連付けられているバイナリデータは、web サーバーのファイルシステム上に、データベースに格納されているファイルへの参照が格納されている2か所のいずれかに格納できます。または (図4を参照)。</span><span class="sxs-lookup"><span data-stu-id="9be36-138">Binary data that is associated with the application s data model can be stored in one of two places: on the web server s file system with a reference to the file stored in the database; or directly within the database itself (see Figure 4).</span></span> <span data-ttu-id="9be36-139">それぞれの方法には、独自の長所と短所があり、さらに詳細な説明があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-139">Each approach has its own set of pros and cons and merits a more detailed discussion.</span></span>

<span data-ttu-id="9be36-140">[バイナリデータは、ファイルシステムに格納することも、データベースに直接格納する ![もできます。](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-140">[![Binary Data Can Be Stored On the File System or Directly in the Database](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span></span>

<span data-ttu-id="9be36-141">**図 4**: バイナリデータをファイルシステムに格納することも、データベースに直接格納することもできます ([クリックすると、フルサイズのイメージが表示](uploading-files-cs/_static/image4.png)されます)。</span><span class="sxs-lookup"><span data-stu-id="9be36-141">**Figure 4**: Binary Data Can Be Stored On the File System or Directly in the Database ([Click to view full-size image](uploading-files-cs/_static/image4.png))</span></span>

<span data-ttu-id="9be36-142">たとえば、Northwind データベースを拡張して、各製品に画像を関連付けるとします。</span><span class="sxs-lookup"><span data-stu-id="9be36-142">Imagine that we wanted to extend the Northwind database to associate a picture with each product.</span></span> <span data-ttu-id="9be36-143">1つの方法として、これらのイメージファイルを web サーバーのファイルシステムに格納し、`Products` テーブルにパスを記録することができます。</span><span class="sxs-lookup"><span data-stu-id="9be36-143">One option would be to store these image files on the web server s file system and record the path in the `Products` table.</span></span> <span data-ttu-id="9be36-144">この方法では、`varchar(200)`型の `Products` テーブルに `ImagePath` 列を追加します。</span><span class="sxs-lookup"><span data-stu-id="9be36-144">With this approach, we d add an `ImagePath` column to the `Products` table of type `varchar(200)`, perhaps.</span></span> <span data-ttu-id="9be36-145">ユーザーが Chai 用に画像をアップロードすると、その画像は `~/Images/Tea.jpg`の web サーバーのファイルシステムに保存される可能性があります。 `~` はアプリケーションの物理パスを表します。</span><span class="sxs-lookup"><span data-stu-id="9be36-145">When a user uploaded a picture for Chai, that picture might be stored on the web server s file system at `~/Images/Tea.jpg`, where `~` represents the application s physical path.</span></span> <span data-ttu-id="9be36-146">つまり、web サイトが `C:\Websites\Northwind\`物理パスをルートとしている場合、`~/Images/Tea.jpg` は `C:\Websites\Northwind\Images\Tea.jpg`と同じになります。</span><span class="sxs-lookup"><span data-stu-id="9be36-146">That is, if the web site is rooted at the physical path `C:\Websites\Northwind\`, `~/Images/Tea.jpg` would be equivalent to `C:\Websites\Northwind\Images\Tea.jpg`.</span></span> <span data-ttu-id="9be36-147">イメージファイルをアップロードした後、`Products` テーブルの Chai レコードを更新して、その `ImagePath` 列が新しいイメージのパスを参照するようにします。</span><span class="sxs-lookup"><span data-stu-id="9be36-147">After uploading the image file, we d update the Chai record in the `Products` table so that its `ImagePath` column referenced the path of the new image.</span></span> <span data-ttu-id="9be36-148">`~/Images/Tea.jpg` を使用することも、すべての製品イメージをアプリケーションの `Images` フォルダーに配置することにした場合にのみ `Tea.jpg` することもできます。</span><span class="sxs-lookup"><span data-stu-id="9be36-148">We could use `~/Images/Tea.jpg` or just `Tea.jpg` if we decided that all product images would be placed in the application s `Images` folder.</span></span>

<span data-ttu-id="9be36-149">バイナリデータをファイルシステムに格納する主な利点は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="9be36-149">The main advantages of storing the binary data on the file system are:</span></span>

- <span data-ttu-id="9be36-150">**実装が簡単**になりますが、データベース内に直接格納されているバイナリデータの格納と取得には、ファイルシステムを介してデータを操作する場合よりも少し多くのコードが必要になります。</span><span class="sxs-lookup"><span data-stu-id="9be36-150">**Ease of implementation** as we'll see shortly, storing and retrieving binary data stored directly within the database involves a bit more code than when working with data through the file system.</span></span> <span data-ttu-id="9be36-151">さらに、ユーザーがバイナリデータを表示またはダウンロードするには、そのデータへの URL が表示されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-151">Additionally, in order for a user to view or download binary data they must be presented with a URL to that data.</span></span> <span data-ttu-id="9be36-152">データが web サーバーのファイルシステムに存在する場合、URL は簡単です。</span><span class="sxs-lookup"><span data-stu-id="9be36-152">If the data resides on the web server s file system, the URL is straightforward.</span></span> <span data-ttu-id="9be36-153">ただし、データがデータベースに格納されている場合は、データベースからデータを取得して返す web ページを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-153">If the data is stored in the database, however, a web page needs to be created that will retrieve and return the data from the database.</span></span>
- <span data-ttu-id="9be36-154">バイナリ**データへの広範なアクセス**。バイナリデータは、データベースからデータをプルできない他のサービスやアプリケーションにアクセスできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-154">**Wider access to the binary data** the binary data may need to be accessible to other services or applications, ones that cannot pull the data from the database.</span></span> <span data-ttu-id="9be36-155">たとえば、各製品に関連付けられているイメージをユーザーが[FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol)経由で利用できるようにする必要がある場合は、バイナリデータをファイルシステムに格納します。</span><span class="sxs-lookup"><span data-stu-id="9be36-155">For example, the images associated with each product might also need to be available to users through [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), in which case we d want to store the binary data on the file system.</span></span>
- <span data-ttu-id="9be36-156">**パフォーマンス**バイナリデータがファイルシステムに格納されている場合、データベースサーバーと web サーバー間の要求とネットワークの輻輳は、バイナリデータがデータベース内に直接格納されている場合よりも小さくなります。</span><span class="sxs-lookup"><span data-stu-id="9be36-156">**Performance** if the binary data is stored on the file system, the demand and network congestion between the database server and web server will be less than if the binary data is stored directly within the database.</span></span>

<span data-ttu-id="9be36-157">バイナリデータをファイルシステムに格納する場合の主な欠点は、データベースからデータを分離することです。</span><span class="sxs-lookup"><span data-stu-id="9be36-157">The main disadvantage of storing binary data on the file system is that it decouples the data from the database.</span></span> <span data-ttu-id="9be36-158">レコードが `Products` テーブルから削除された場合、web サーバーのファイルシステム上の関連ファイルは自動的には削除されません。</span><span class="sxs-lookup"><span data-stu-id="9be36-158">If a record is deleted from the `Products` table, the associated file on the web server s file system is not automatically deleted.</span></span> <span data-ttu-id="9be36-159">ファイルを削除するには、追加のコードを記述する必要があります。そうしないと、ファイルシステムが未使用の孤立したファイルによって乱雑になります。</span><span class="sxs-lookup"><span data-stu-id="9be36-159">We must write extra code to delete the file or the file system will become cluttered with unused, orphaned files.</span></span> <span data-ttu-id="9be36-160">さらに、データベースをバックアップするときは、関連付けられているバイナリデータのバックアップもファイルシステムに作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-160">Furthermore, when backing up the database, we must make sure to make backups of the associated binary data on the file system, as well.</span></span> <span data-ttu-id="9be36-161">データベースを別のサイトまたはサーバーに移動すると、同様の問題が生じます。</span><span class="sxs-lookup"><span data-stu-id="9be36-161">Moving the database to another site or server poses similar challenges.</span></span>

<span data-ttu-id="9be36-162">また、`varbinary`型の列を作成することによって、バイナリデータを Microsoft SQL Server 2005 データベースに直接格納することもできます。</span><span class="sxs-lookup"><span data-stu-id="9be36-162">Alternatively, binary data can be stored directly in a Microsoft SQL Server 2005 database by creating a column of type `varbinary`.</span></span> <span data-ttu-id="9be36-163">他の可変長データ型と同様に、この列に保持できるバイナリデータの最大長を指定できます。</span><span class="sxs-lookup"><span data-stu-id="9be36-163">Like with other variable length data types, you can specify a maximum length of the binary data that can be held in this column.</span></span> <span data-ttu-id="9be36-164">たとえば、最大5000バイトを予約するには、`varbinary(5000)`を使用します。`varbinary(MAX)` では、最大ストレージサイズを 2 GB にすることができます。</span><span class="sxs-lookup"><span data-stu-id="9be36-164">For example, to reserve at most 5,000 bytes use `varbinary(5000)`; `varbinary(MAX)` allows for the maximum storage size, about 2 GB.</span></span>

<span data-ttu-id="9be36-165">バイナリデータをデータベースに直接格納する主な利点は、バイナリデータとデータベースレコードの密結合です。</span><span class="sxs-lookup"><span data-stu-id="9be36-165">The main advantage of storing binary data directly in the database is the tight coupling between the binary data and the database record.</span></span> <span data-ttu-id="9be36-166">これにより、バックアップや別のサイトまたはサーバーへのデータベースの移動などのデータベース管理タスクが大幅に簡素化されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-166">This greatly simplifies database administration tasks, like backups or moving the database to a different site or server.</span></span> <span data-ttu-id="9be36-167">また、レコードを削除すると、対応するバイナリデータも自動的に削除されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-167">Also, deleting a record automatically deletes the corresponding binary data.</span></span> <span data-ttu-id="9be36-168">バイナリデータをデータベースに格納すると、さらに微妙な利点もあります。</span><span class="sxs-lookup"><span data-stu-id="9be36-168">There are also more subtle benefits of storing the binary data in the database.</span></span> <span data-ttu-id="9be36-169">詳細については、「 [ASP.NET 2.0 を使用してデータベースにバイナリファイルを直接格納](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9be36-169">See [Storing Binary Files Directly in the Database Using ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) for a more in-depth discussion.</span></span>

> [!NOTE]
> <span data-ttu-id="9be36-170">Microsoft SQL Server 2000 以前のバージョンでは、`varbinary` データ型の上限は8000バイトでした。</span><span class="sxs-lookup"><span data-stu-id="9be36-170">In Microsoft SQL Server 2000 and earlier versions, the `varbinary` data type had a maximum limit of 8,000 bytes.</span></span> <span data-ttu-id="9be36-171">最大 2 GB のバイナリデータを格納するには、代わりに[`image` データ型](https://msdn.microsoft.com/library/ms187993.aspx)を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-171">To store up to 2 GB of binary data the [`image` data type](https://msdn.microsoft.com/library/ms187993.aspx) needs to be used instead.</span></span> <span data-ttu-id="9be36-172">ただし、SQL Server 2005 に `MAX` を追加すると、`image` データ型は非推奨とされます。</span><span class="sxs-lookup"><span data-stu-id="9be36-172">With the addition of `MAX` in SQL Server 2005, however, the `image` data type has been deprecated.</span></span> <span data-ttu-id="9be36-173">旧バージョンとの互換性のためには引き続きサポートされていますが、マイクロソフトは、今後のバージョンの SQL Server で `image` データ型が削除されることを発表しました。</span><span class="sxs-lookup"><span data-stu-id="9be36-173">It s still supported for backwards compatibility, but Microsoft has announced that the `image` data type will be removed in a future version of SQL Server.</span></span>

<span data-ttu-id="9be36-174">古いデータモデルを使用している場合は、`image` データ型が表示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="9be36-174">If you are working with an older data model you may see the `image` data type.</span></span> <span data-ttu-id="9be36-175">Northwind データベースの `Categories` テーブルには、カテゴリのイメージファイルのバイナリデータを格納するために使用できる `Picture` 列があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-175">The Northwind database s `Categories` table has a `Picture` column that can be used to store the binary data of an image file for the category.</span></span> <span data-ttu-id="9be36-176">Northwind データベースには、Microsoft Access およびそれ以前のバージョンの SQL Server のルートがあるため、この列のデータ型は `image`です。</span><span class="sxs-lookup"><span data-stu-id="9be36-176">Since the Northwind database has its roots in Microsoft Access and earlier versions of SQL Server, this column is of type `image`.</span></span>

<span data-ttu-id="9be36-177">このチュートリアルと次の3つの方法では、両方の方法を使用します。</span><span class="sxs-lookup"><span data-stu-id="9be36-177">For this tutorial and the next three, we'll use both approaches.</span></span> <span data-ttu-id="9be36-178">`Categories` テーブルには、カテゴリのイメージのバイナリコンテンツを格納するための `Picture` 列が既に用意されています。</span><span class="sxs-lookup"><span data-stu-id="9be36-178">The `Categories` table already has a `Picture` column for storing the binary content of an image for the category.</span></span> <span data-ttu-id="9be36-179">追加の列 `BrochurePath`を追加して、web サーバーのファイルシステム上の PDF へのパスを格納します。これを使用すると、印刷品質と洗練されたカテゴリの概要を提供できます。</span><span class="sxs-lookup"><span data-stu-id="9be36-179">We'll add an additional column, `BrochurePath`, to store a path to a PDF on the web server s file system that can be used to provide a print-quality, polished overview of the category.</span></span>

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a><span data-ttu-id="9be36-180">手順 3:`Categories`テーブルに`BrochurePath`列を追加する</span><span class="sxs-lookup"><span data-stu-id="9be36-180">Step 3: Adding the`BrochurePath`Column to the`Categories`Table</span></span>

<span data-ttu-id="9be36-181">現在、Categories テーブルには、`CategoryID`、`CategoryName`、`Description`、および `Picture`の4つの列しかありません。</span><span class="sxs-lookup"><span data-stu-id="9be36-181">Currently the Categories table has only four columns: `CategoryID`, `CategoryName`, `Description`, and `Picture`.</span></span> <span data-ttu-id="9be36-182">これらのフィールドに加えて、カテゴリ s パンフレット (存在する場合) を指す新しいものを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-182">In addition to these fields, we need to add a new one that will point to the category s brochure (if one exists).</span></span> <span data-ttu-id="9be36-183">この列を追加するには、サーバーエクスプローラーに移動し、テーブルをドリルダウンします。 `Categories` テーブルを右クリックし、[テーブル定義を開く] を選択します (図5を参照)。</span><span class="sxs-lookup"><span data-stu-id="9be36-183">To add this column, go to the Server Explorer, drill down into the Tables, right-click on the `Categories` table and choose Open Table Definition (see Figure 5).</span></span> <span data-ttu-id="9be36-184">サーバーエクスプローラーが表示されない場合は、[表示] メニューの [サーバーエクスプローラー] オプションを選択して起動するか、Ctrl + Alt + S キーを押します。</span><span class="sxs-lookup"><span data-stu-id="9be36-184">If you do not see the Server Explorer, bring it up by selecting the Server Explorer option from the View menu, or hit Ctrl+Alt+S.</span></span>

<span data-ttu-id="9be36-185">`BrochurePath` という名前の `Categories` テーブルに新しい `varchar(200)` 列を追加し `NULL` s を許可し、[保存] アイコンをクリックします (または Ctrl + S キーを押します)。</span><span class="sxs-lookup"><span data-stu-id="9be36-185">Add a new `varchar(200)` column to the `Categories` table that is named `BrochurePath` and allows `NULL` s and click the Save icon (or hit Ctrl+S).</span></span>

<span data-ttu-id="9be36-186">[BrochurePath 列を Categories テーブルに追加 ![には](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-186">[![Add a BrochurePath Column to the Categories Table](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span></span>

<span data-ttu-id="9be36-187">**図 5**: `Categories` テーブルに `BrochurePath` 列を追加する ([クリックすると、フルサイズの画像が表示](uploading-files-cs/_static/image6.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9be36-187">**Figure 5**: Add a `BrochurePath` Column to the `Categories` Table ([Click to view full-size image](uploading-files-cs/_static/image6.png))</span></span>

## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a><span data-ttu-id="9be36-188">手順 4:`Picture`と`BrochurePath`列を使用するようにアーキテクチャを更新する</span><span class="sxs-lookup"><span data-stu-id="9be36-188">Step 4: Updating the Architecture to Use the`Picture`and`BrochurePath`Columns</span></span>

<span data-ttu-id="9be36-189">現在、データアクセス層 (DAL) の `CategoriesDataTable` には、`CategoryID`、`CategoryName`、`Description`、`NumberOfProducts`という4つの `DataColumn` が定義されています。</span><span class="sxs-lookup"><span data-stu-id="9be36-189">The `CategoriesDataTable` in the Data Access Layer (DAL) currently has four `DataColumn` s defined: `CategoryID`, `CategoryName`, `Description`, and `NumberOfProducts`.</span></span> <span data-ttu-id="9be36-190">[データアクセス層の作成](../introduction/creating-a-data-access-layer-cs.md)チュートリアルでこの DataTable を設計したので、`CategoriesDataTable` には最初の3つの列のみがありました。`NumberOfProducts` 列は、[詳細な DataList チュートリアルが含まれている、マスターレコードの箇条書きリストを使用してマスター/詳細](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)に追加されました。</span><span class="sxs-lookup"><span data-stu-id="9be36-190">When we originally designed this DataTable in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, the `CategoriesDataTable` only had the first three columns; the `NumberOfProducts` column was added in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial.</span></span>

<span data-ttu-id="9be36-191">「*データアクセス層の作成*」で説明したように、型指定されたデータセット内の datatable はビジネスオブジェクトを構成します。</span><span class="sxs-lookup"><span data-stu-id="9be36-191">As discussed in *Creating a Data Access Layer*, the DataTables in the Typed DataSet make up the business objects.</span></span> <span data-ttu-id="9be36-192">Tableadapter は、データベースとの通信を行い、ビジネスオブジェクトにクエリ結果を設定します。</span><span class="sxs-lookup"><span data-stu-id="9be36-192">The TableAdapters are responsible for communicating with the database and populating the business objects with the query results.</span></span> <span data-ttu-id="9be36-193">`CategoriesDataTable` は、次の3つのデータ取得方法を持つ `CategoriesTableAdapter`によって設定されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-193">The `CategoriesDataTable` is populated by the `CategoriesTableAdapter`, which has three data retrieval methods:</span></span>

- <span data-ttu-id="9be36-194">`GetCategories()` では、TableAdapter のメインクエリが実行され、`Categories` テーブル内のすべてのレコードの `CategoryID`、`CategoryName`、および `Description` の各フィールドが返されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-194">`GetCategories()` executes the TableAdapter s main query and returns the `CategoryID`, `CategoryName`, and `Description` fields of all records in the `Categories` table.</span></span> <span data-ttu-id="9be36-195">メインクエリは、自動生成される `Insert` および `Update` メソッドによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-195">The main query is what is used by the auto-generated `Insert` and `Update` methods.</span></span>
- <span data-ttu-id="9be36-196">`GetCategoryByCategoryID(categoryID)` は、`CategoryID` が*categoryID*と等しいカテゴリの `CategoryID`、`CategoryName`、および `Description` の各フィールドを返します。</span><span class="sxs-lookup"><span data-stu-id="9be36-196">`GetCategoryByCategoryID(categoryID)` returns the `CategoryID`, `CategoryName`, and `Description` fields of the category whose `CategoryID` equals *categoryID*.</span></span>
- <span data-ttu-id="9be36-197">`GetCategoriesAndNumberOfProducts()`-`Categories` テーブル内のすべてのレコードの `CategoryID`、`CategoryName`、および `Description` の各フィールドを返します。</span><span class="sxs-lookup"><span data-stu-id="9be36-197">`GetCategoriesAndNumberOfProducts()` - returns the `CategoryID`, `CategoryName`, and `Description` fields for all records in the `Categories` table.</span></span> <span data-ttu-id="9be36-198">また、サブクエリを使用して、各カテゴリに関連付けられている製品の数を返します。</span><span class="sxs-lookup"><span data-stu-id="9be36-198">Also uses a subquery to return the number of products associated with each category.</span></span>

<span data-ttu-id="9be36-199">これらのクエリによって `Categories` table s `Picture` または `BrochurePath` 列が返されないことに注意してください。また、`CategoriesDataTable` は、これらのフィールドに `DataColumn` を提供しません。</span><span class="sxs-lookup"><span data-stu-id="9be36-199">Notice that none of these queries return the `Categories` table s `Picture` or `BrochurePath` columns; nor does the `CategoriesDataTable` provide `DataColumn` s for these fields.</span></span> <span data-ttu-id="9be36-200">Picture プロパティと `BrochurePath` プロパティを操作するには、まずそれらを `CategoriesDataTable` に追加し、次にこれらの列を返すように `CategoriesTableAdapter` クラスを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-200">In order to work with the Picture and `BrochurePath` properties, we need to first add them to the `CategoriesDataTable` and then update the `CategoriesTableAdapter` class to return these columns.</span></span>

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a><span data-ttu-id="9be36-201">`Picture`と`BrochurePath``DataColumn` の追加</span><span class="sxs-lookup"><span data-stu-id="9be36-201">Adding the`Picture`and`BrochurePath``DataColumn` s</span></span>

<span data-ttu-id="9be36-202">まず、これらの2つの列を `CategoriesDataTable`に追加します。</span><span class="sxs-lookup"><span data-stu-id="9be36-202">Start by adding these two columns to the `CategoriesDataTable`.</span></span> <span data-ttu-id="9be36-203">`CategoriesDataTable` s ヘッダーを右クリックし、コンテキストメニューの [追加] をクリックして、[列] オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="9be36-203">Right-click on the `CategoriesDataTable` s header, select Add from the context menu and then choose the Column option.</span></span> <span data-ttu-id="9be36-204">これにより、`Column1`という名前の DataTable に新しい `DataColumn` が作成されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-204">This will create a new `DataColumn` in the DataTable named `Column1`.</span></span> <span data-ttu-id="9be36-205">この列の名前を `Picture`に変更します。</span><span class="sxs-lookup"><span data-stu-id="9be36-205">Rename this column to `Picture`.</span></span> <span data-ttu-id="9be36-206">プロパティウィンドウから、`DataColumn` s `DataType` プロパティを `System.Byte[]` に設定します (これはドロップダウンリストのオプションではなく、に入力する必要があります)。</span><span class="sxs-lookup"><span data-stu-id="9be36-206">From the Properties window, set the `DataColumn` s `DataType` property to `System.Byte[]` (this is not an option in the drop-down list; you need to type it in).</span></span>

<span data-ttu-id="9be36-207">[データ型が system.string [] である DataColumn 名前付き画像を作成 ![には](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-207">[![Create a DataColumn Named Picture whose DataType is System.Byte[]](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span></span>

<span data-ttu-id="9be36-208">**図 6**: `DataType` を `System.Byte[]` する `Picture` という名前の `DataColumn` を作成[する (クリックすると、フルサイズの画像が表示](uploading-files-cs/_static/image8.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9be36-208">**Figure 6**: Create a `DataColumn` Named `Picture` whose `DataType` is `System.Byte[]` ([Click to view full-size image](uploading-files-cs/_static/image8.png))</span></span>

<span data-ttu-id="9be36-209">DataTable に別の `DataColumn` を追加し、既定の `DataType` 値 (`System.String`) を使用して `BrochurePath` 名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="9be36-209">Add another `DataColumn` to the DataTable, naming it `BrochurePath` using the default `DataType` value (`System.String`).</span></span>

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a><span data-ttu-id="9be36-210">TableAdapter から`Picture`と`BrochurePath`の値を返す</span><span class="sxs-lookup"><span data-stu-id="9be36-210">Returning the`Picture`and`BrochurePath`Values from the TableAdapter</span></span>

<span data-ttu-id="9be36-211">これら2つの `DataColumn` が `CategoriesDataTable`に追加されたので、`CategoriesTableAdapter`を更新する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="9be36-211">With these two `DataColumn` s added to the `CategoriesDataTable`, we re ready to update the `CategoriesTableAdapter`.</span></span> <span data-ttu-id="9be36-212">これらの両方の列の値をメインの TableAdapter クエリに返すこともできますが、これにより `GetCategories()` メソッドが呼び出されるたびにバイナリデータが返されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-212">We could have both of these column values returned in the main TableAdapter query, but this would bring back the binary data every time the `GetCategories()` method was invoked.</span></span> <span data-ttu-id="9be36-213">代わりに、を使用して `BrochurePath` を戻し、特定の category s `Picture` 列を返す追加のデータ取得メソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="9be36-213">Instead, let s update the main TableAdapter query to bring back `BrochurePath` and create an additional data retrieval method that returns a particular category s `Picture` column.</span></span>

<span data-ttu-id="9be36-214">TableAdapter のメインクエリを更新するには、`CategoriesTableAdapter` s ヘッダーを右クリックし、コンテキストメニューから [構成] オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="9be36-214">To update the main TableAdapter query, right-click on the `CategoriesTableAdapter` s header and choose the Configure option from the context menu.</span></span> <span data-ttu-id="9be36-215">これにより、テーブルアダプター構成ウィザードが表示されます。これについては、これまでに説明したいくつかのチュートリアルで説明しました。</span><span class="sxs-lookup"><span data-stu-id="9be36-215">This brings up the Table Adapter Configuration Wizard, which we ve seen in a number of past tutorials.</span></span> <span data-ttu-id="9be36-216">クエリを更新して `BrochurePath` を戻し、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9be36-216">Update the query to bring back the `BrochurePath` and click Finish.</span></span>

<span data-ttu-id="9be36-217">[SELECT ステートメントの列リストを ![更新して、BrochurePath も返すようにします。](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-217">[![Update the Column List in the SELECT Statement to Also Return BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span></span>

<span data-ttu-id="9be36-218">**図 7**: `SELECT` ステートメントの列リストを更新して `BrochurePath` も返す ([クリックすると、フルサイズの画像が表示](uploading-files-cs/_static/image10.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9be36-218">**Figure 7**: Update the Column List in the `SELECT` Statement to Also Return `BrochurePath` ([Click to view full-size image](uploading-files-cs/_static/image10.png))</span></span>

<span data-ttu-id="9be36-219">TableAdapter にアドホック SQL ステートメントを使用する場合、メインクエリの列リストを更新すると、TableAdapter 内のすべての `SELECT` クエリメソッドの列リストが更新されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-219">When using ad-hoc SQL statements for the TableAdapter, updating the column list in the main query updates the column list for all of the `SELECT` query methods in the TableAdapter.</span></span> <span data-ttu-id="9be36-220">つまり、`GetCategoryByCategoryID(categoryID)` メソッドが更新され、`BrochurePath` 列が返されることになります。これは、意図したように思われるかもしれません。</span><span class="sxs-lookup"><span data-stu-id="9be36-220">That means the `GetCategoryByCategoryID(categoryID)` method has been updated to return the `BrochurePath` column, which might be what we intended.</span></span> <span data-ttu-id="9be36-221">ただし、`GetCategoriesAndNumberOfProducts()` メソッドの列リストも更新され、各カテゴリの製品数を返すサブクエリが削除されました。</span><span class="sxs-lookup"><span data-stu-id="9be36-221">However, it also updated the column list in the `GetCategoriesAndNumberOfProducts()` method, removing the subquery that returns the number of products for each category!</span></span> <span data-ttu-id="9be36-222">そのため、このメソッドを `SELECT` クエリに更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-222">Therefore, we need to update this method s `SELECT` query.</span></span> <span data-ttu-id="9be36-223">`GetCategoriesAndNumberOfProducts()` メソッドを右クリックし、[構成] を選択して、`SELECT` クエリを元の値に戻します。</span><span class="sxs-lookup"><span data-stu-id="9be36-223">Right-click on the `GetCategoriesAndNumberOfProducts()` method, choose Configure, and revert the `SELECT` query back to its original value:</span></span>

[!code-sql[Main](uploading-files-cs/samples/sample2.sql)]

<span data-ttu-id="9be36-224">次に、特定のカテゴリの `Picture` 列の値を返す新しい TableAdapter メソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="9be36-224">Next, create a new TableAdapter method that returns a particular category s `Picture` column value.</span></span> <span data-ttu-id="9be36-225">`CategoriesTableAdapter` s ヘッダーを右クリックし、[クエリの追加] オプションを選択して、TableAdapter クエリの構成ウィザードを起動します。</span><span class="sxs-lookup"><span data-stu-id="9be36-225">Right-click on the `CategoriesTableAdapter` s header and choose the Add Query option to launch the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="9be36-226">このウィザードの最初の手順では、アドホック SQL ステートメント、新しいストアドプロシージャ、または既存のストアドプロシージャを使用してデータのクエリを実行するかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="9be36-226">The first step of this wizard asks us if we want to query data using an ad-hoc SQL statement, a new stored procedure, or an existing one.</span></span> <span data-ttu-id="9be36-227">[SQL ステートメントを使用する] を選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9be36-227">Select Use SQL statements and click Next.</span></span> <span data-ttu-id="9be36-228">ここでは行を返すため、2番目の手順で [SELECT from rows] (行を返す) オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="9be36-228">Since we will be returning a row, choose the SELECT which returns rows option from the second step.</span></span>

<span data-ttu-id="9be36-229">[![[SQL ステートメントを使用する] オプションを選択する](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-229">[![Select the Use SQL statements Option](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span></span>

<span data-ttu-id="9be36-230">**図 8**: [SQL ステートメントを使用する] オプションを選択[する (クリックすると、フルサイズの画像が表示](uploading-files-cs/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9be36-230">**Figure 8**: Select the Use SQL statements Option ([Click to view full-size image](uploading-files-cs/_static/image12.png))</span></span>

<span data-ttu-id="9be36-231">[![クエリは Categories テーブルからレコードを返すので、[行を返す SELECT] を選択します。](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-231">[![Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span></span>

<span data-ttu-id="9be36-232">**図 9**: クエリは Categories テーブルからレコードを返すため、[行を返す SELECT] を選択します ([クリックすると、フルサイズの画像が表示](uploading-files-cs/_static/image14.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9be36-232">**Figure 9**: Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows ([Click to view full-size image](uploading-files-cs/_static/image14.png))</span></span>

<span data-ttu-id="9be36-233">3番目の手順で、次の SQL クエリを入力し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9be36-233">In the third step, enter the following SQL query and click Next:</span></span>

[!code-sql[Main](uploading-files-cs/samples/sample3.sql)]

<span data-ttu-id="9be36-234">最後の手順では、新しいメソッドの名前を選択します。</span><span class="sxs-lookup"><span data-stu-id="9be36-234">The last step is to choose the name for the new method.</span></span> <span data-ttu-id="9be36-235">`FillCategoryWithBinaryDataByCategoryID` と `GetCategoryWithBinaryDataByCategoryID` を使用して DataTable にデータを格納し、それぞれ DataTable パターンを返します。</span><span class="sxs-lookup"><span data-stu-id="9be36-235">Use `FillCategoryWithBinaryDataByCategoryID` and `GetCategoryWithBinaryDataByCategoryID` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span> <span data-ttu-id="9be36-236">[完了] をクリックしてウィザードを終了します。</span><span class="sxs-lookup"><span data-stu-id="9be36-236">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="9be36-237">[TableAdapter のメソッドの名前を選択 ![には](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-237">[![Choose the Names for the TableAdapter s Methods](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span></span>

<span data-ttu-id="9be36-238">**図 10**: TableAdapter のメソッドの名前を選択する ([クリックすると、フルサイズのイメージが表示](uploading-files-cs/_static/image16.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9be36-238">**Figure 10**: Choose the Names for the TableAdapter s Methods ([Click to view full-size image](uploading-files-cs/_static/image16.png))</span></span>

> [!NOTE]
> <span data-ttu-id="9be36-239">テーブルアダプターのクエリ構成ウィザードを完了すると、新しいコマンドテキストがメインクエリのスキーマとは異なるスキーマを使用してデータを返すことを通知するダイアログボックスが表示される場合があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-239">After completing the Table Adapter Query Configuration Wizard you may see a dialog box informing you that the new command text returns data with schema different from the schema of the main query.</span></span> <span data-ttu-id="9be36-240">つまり、ウィザードでは、TableAdapter のメインクエリ `GetCategories()` が、先ほど作成したものとは異なるスキーマを返すことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="9be36-240">In short, the wizard is noting that the TableAdapter s main query `GetCategories()` returns a different schema than the one we just created.</span></span> <span data-ttu-id="9be36-241">しかし、これが必要なので、このメッセージは無視してかまいません。</span><span class="sxs-lookup"><span data-stu-id="9be36-241">But this is what we want, so you can disregard this message.</span></span>

<span data-ttu-id="9be36-242">また、アドホック SQL ステートメントを使用しているときに、ウィザードを使用して後で TableAdapter のメインクエリを変更する場合は、`GetCategoryWithBinaryDataByCategoryID` method s `SELECT` ステートメント s 列リストが変更され、メインクエリからの列だけが含まれることに注意してください (つまり、クエリから `Picture` 列が削除されます)。</span><span class="sxs-lookup"><span data-stu-id="9be36-242">Also, keep in mind that if you are using ad-hoc SQL statements and use the wizard to change the TableAdapter s main query at some later point in time, it will modify the `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement s column list to include just those columns from the main query (that is, it will remove the `Picture` column from the query).</span></span> <span data-ttu-id="9be36-243">この手順の前の `GetCategoriesAndNumberOfProducts()` 方法と同様に、列リストを手動で更新して `Picture` 列を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-243">You will have to manually update the column list to return the `Picture` column, similar to what we did with the `GetCategoriesAndNumberOfProducts()` method earlier in this step.</span></span>

<span data-ttu-id="9be36-244">2つの `DataColumn` s を `CategoriesDataTable` に追加し、`GetCategoryWithBinaryDataByCategoryID` メソッドを `CategoriesTableAdapter`に追加すると、型指定されたデータセットデザイナーのこれらのクラスは、図11のスクリーンショットのようになります。</span><span class="sxs-lookup"><span data-stu-id="9be36-244">After adding the two `DataColumn` s to the `CategoriesDataTable` and the `GetCategoryWithBinaryDataByCategoryID` method to the `CategoriesTableAdapter`, these classes in the Typed DataSet Designer should look like the screenshot in Figure 11.</span></span>

![データセットデザイナーには、新しい列とメソッドが含まれています。](uploading-files-cs/_static/image11.gif)

<span data-ttu-id="9be36-246">**図 11**: データセットデザイナーに新しい列とメソッドが含まれる</span><span class="sxs-lookup"><span data-stu-id="9be36-246">**Figure 11**: The DataSet Designer Includes the New Columns and Method</span></span>

## <a name="updating-the-business-logic-layer-bll"></a><span data-ttu-id="9be36-247">ビジネスロジック層 (BLL) を更新しています</span><span class="sxs-lookup"><span data-stu-id="9be36-247">Updating the Business Logic Layer (BLL)</span></span>

<span data-ttu-id="9be36-248">DAL を更新すると、新しい `CategoriesTableAdapter` メソッドのメソッドを含むように、ビジネスロジック層 (BLL) が拡張されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-248">With the DAL updated, all that remains is to augment the Business Logic Layer (BLL) to include a method for the new `CategoriesTableAdapter` method.</span></span> <span data-ttu-id="9be36-249">次のメソッドを `CategoriesBLL` クラスに追加します。</span><span class="sxs-lookup"><span data-stu-id="9be36-249">Add the following method to the `CategoriesBLL` class:</span></span>

[!code-csharp[Main](uploading-files-cs/samples/sample4.cs)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a><span data-ttu-id="9be36-250">手順 5: クライアントから Web サーバーにファイルをアップロードする</span><span class="sxs-lookup"><span data-stu-id="9be36-250">Step 5: Uploading a File From the Client to the Web Server</span></span>

<span data-ttu-id="9be36-251">バイナリデータを収集するときは、多くの場合、このデータがエンドユーザーによって提供されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-251">When collecting binary data, oftentimes this data is supplied by an end user.</span></span> <span data-ttu-id="9be36-252">この情報を取得するには、ユーザーが自分のコンピューターから web サーバーにファイルをアップロードできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-252">To capture this information, the user needs to be able to upload a file from their computer to the web server.</span></span> <span data-ttu-id="9be36-253">アップロードされたデータは、データモデルと統合する必要があります。これは、ファイルを web サーバーのファイルシステムに保存し、データベース内のファイルへのパスを追加したり、バイナリコンテンツをデータベースに直接書き込んだりすることを意味します。</span><span class="sxs-lookup"><span data-stu-id="9be36-253">The uploaded data then needs to be integrated with the data model, which may mean saving the file to the web server s file system and adding a path to the file in the database, or writing the binary contents directly into the database.</span></span> <span data-ttu-id="9be36-254">この手順では、ユーザーが自分のコンピューターからサーバーにファイルをアップロードできるようにする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9be36-254">In this step we'll look at how to allow a user to upload files from their computer to the server.</span></span> <span data-ttu-id="9be36-255">次のチュートリアルでは、アップロードしたファイルとデータモデルを統合することに注目します。</span><span class="sxs-lookup"><span data-stu-id="9be36-255">In the next tutorial we'll turn our attention to integrating the uploaded file with data model.</span></span>

<span data-ttu-id="9be36-256">ASP.NET 2.0 s new [FileUpload web control](https://msdn.microsoft.com/library/ms227677(VS.80).aspx)は、ユーザーが自分のコンピューターから web サーバーにファイルを送信するためのメカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="9be36-256">ASP.NET 2.0 s new [FileUpload Web control](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) provides a mechanism for users to send a file from their computer to the web server.</span></span> <span data-ttu-id="9be36-257">FileUpload コントロールは、`type` 属性が file に設定されている `<input>` 要素としてレンダリングされます。この要素は、ブラウザーが [参照] ボタンを持つテキストボックスとして表示されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-257">The FileUpload control renders as an `<input>` element whose `type` attribute is set to file, which browsers display as a textbox with a Browse button.</span></span> <span data-ttu-id="9be36-258">[参照] ボタンをクリックすると、ユーザーがファイルを選択できるダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-258">Clicking the Browse button brings up a dialog box from which the user can select a file.</span></span> <span data-ttu-id="9be36-259">フォームがポストバックされると、選択したファイルの内容がポストバックと共に送信されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-259">When the form is posted back, the selected file s contents are sent along with the postback.</span></span> <span data-ttu-id="9be36-260">サーバー側では、アップロードされたファイルに関する情報には、FileUpload control s プロパティを使用してアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="9be36-260">On the server-side, information about the uploaded file is accessible through the FileUpload control s properties.</span></span>

<span data-ttu-id="9be36-261">ファイルのアップロードをデモンストレーションするには、`BinaryData` フォルダーの `FileUpload.aspx` ページを開き、ツールボックス から FileUpload コントロールをデザイナーにドラッグして、コントロール s `ID` プロパティを `UploadTest`に設定します。</span><span class="sxs-lookup"><span data-stu-id="9be36-261">To demonstrate uploading files, open the `FileUpload.aspx` page in the `BinaryData` folder, drag a FileUpload control from the Toolbox onto the Designer, and set the control s `ID` property to `UploadTest`.</span></span> <span data-ttu-id="9be36-262">次に、ボタン Web コントロールを追加し、その `ID` を設定し `Text` プロパティを `UploadButton` して、選択したファイルをそれぞれアップロードします。</span><span class="sxs-lookup"><span data-stu-id="9be36-262">Next, add a Button Web control setting its `ID` and `Text` properties to `UploadButton` and Upload Selected File, respectively.</span></span> <span data-ttu-id="9be36-263">最後に、ボタンの下にラベル Web コントロールを配置し、その `Text` プロパティをオフにして、`ID` プロパティを `UploadDetails`に設定します。</span><span class="sxs-lookup"><span data-stu-id="9be36-263">Finally, place a Label Web control beneath the Button, clear out its `Text` property and set its `ID` property to `UploadDetails`.</span></span>

<span data-ttu-id="9be36-264">[FileUpload コントロールを ASP.NET ページに追加 ![には](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-264">[![Add a FileUpload Control to the ASP.NET Page](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span></span>

<span data-ttu-id="9be36-265">**図 12**: FileUpload コントロールを ASP.NET ページに追加する ([クリックすると、フルサイズの画像が表示](uploading-files-cs/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9be36-265">**Figure 12**: Add a FileUpload Control to the ASP.NET Page ([Click to view full-size image](uploading-files-cs/_static/image18.png))</span></span>

<span data-ttu-id="9be36-266">図13は、ブラウザーを使用して表示するときにこのページを示しています。</span><span class="sxs-lookup"><span data-stu-id="9be36-266">Figure 13 shows this page when viewed through a browser.</span></span> <span data-ttu-id="9be36-267">[参照] ボタンをクリックすると、[ファイルの選択] ダイアログボックスが表示され、ユーザーは自分のコンピューターからファイルを選択できることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="9be36-267">Note that clicking the Browse button brings up a file selection dialog box, allowing the user to pick a file from their computer.</span></span> <span data-ttu-id="9be36-268">ファイルを選択したら、[選択したファイルのアップロード] ボタンをクリックすると、選択したファイルのバイナリコンテンツを web サーバーに送信するポストバックが発生します。</span><span class="sxs-lookup"><span data-stu-id="9be36-268">Once a file has been selected, clicking the Upload Selected File button causes a postback that sends the selected file s binary content to the web server.</span></span>

<span data-ttu-id="9be36-269">[ユーザーが自分のコンピューターからサーバーにアップロードするファイルを選択できる ![](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-269">[![The User Can Select a File to Upload from their Computer to the Server](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span></span>

<span data-ttu-id="9be36-270">**図 13**: ユーザーは自分のコンピューターからサーバーにアップロードするファイルを選択できます ([クリックすると、フルサイズの画像が表示](uploading-files-cs/_static/image20.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9be36-270">**Figure 13**: The User Can Select a File to Upload from their Computer to the Server ([Click to view full-size image](uploading-files-cs/_static/image20.png))</span></span>

<span data-ttu-id="9be36-271">ポストバック時には、アップロードされたファイルをファイルシステムに保存することも、バイナリデータをストリーム経由で直接操作することもできます。</span><span class="sxs-lookup"><span data-stu-id="9be36-271">On postback, the uploaded file can be saved to the file system or its binary data can be worked with directly through a Stream.</span></span> <span data-ttu-id="9be36-272">この例では、`~/Brochures` フォルダーを作成し、アップロードしたファイルをそこに保存します。</span><span class="sxs-lookup"><span data-stu-id="9be36-272">For this example, let s create a `~/Brochures` folder and save the uploaded file there.</span></span> <span data-ttu-id="9be36-273">まず、ルートディレクトリのサブフォルダーとして `Brochures` フォルダーをサイトに追加します。</span><span class="sxs-lookup"><span data-stu-id="9be36-273">Start by adding the `Brochures` folder to the site as a subfolder of the root directory.</span></span> <span data-ttu-id="9be36-274">次に、`UploadButton` s `Click` イベントのイベントハンドラーを作成し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="9be36-274">Next, create an event handler for the `UploadButton` s `Click` event and add the following code:</span></span>

[!code-csharp[Main](uploading-files-cs/samples/sample5.cs)]

<span data-ttu-id="9be36-275">FileUpload コントロールには、アップロードされたデータを操作するためのさまざまなプロパティが用意されています。</span><span class="sxs-lookup"><span data-stu-id="9be36-275">The FileUpload control provides a variety of properties for working with the uploaded data.</span></span> <span data-ttu-id="9be36-276">たとえば、 [`HasFile` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx)は、ファイルがユーザーによってアップロードされたかどうかを示し、 [`FileBytes` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx)は、アップロードされたバイナリデータへのアクセスをバイト配列として提供します。</span><span class="sxs-lookup"><span data-stu-id="9be36-276">For instance, the [`HasFile` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indicates whether a file was uploaded by the user, while the [`FileBytes` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) provides access to the uploaded binary data as an array of bytes.</span></span> <span data-ttu-id="9be36-277">`Click` イベントハンドラーは、ファイルがアップロードされたことを確認してから開始します。</span><span class="sxs-lookup"><span data-stu-id="9be36-277">The `Click` event handler starts by ensuring that a file has been uploaded.</span></span> <span data-ttu-id="9be36-278">ファイルがアップロードされている場合、ラベルには、アップロードされたファイルの名前、バイト単位のサイズ、およびそのコンテンツタイプが表示されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-278">If a file has been uploaded, the Label shows the name of the uploaded file, its size in bytes, and its content-type.</span></span>

> [!NOTE]
> <span data-ttu-id="9be36-279">ユーザーがファイルをアップロードできるようにするには、`HasFile` プロパティを確認し、`false`の場合は警告を表示するか、代わりに[RequiredFieldValidator コントロール](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx)を使用することができます。</span><span class="sxs-lookup"><span data-stu-id="9be36-279">To ensure that the user uploads a file you can check the `HasFile` property and display a warning if it s `false`, or you may use the [RequiredFieldValidator control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) instead.</span></span>

<span data-ttu-id="9be36-280">FileUpload s `SaveAs(filePath)` は、アップロードされたファイルを指定したファイル*パス*に保存します。</span><span class="sxs-lookup"><span data-stu-id="9be36-280">The FileUpload s `SaveAs(filePath)` saves the uploaded file to the specified *filePath*.</span></span> <span data-ttu-id="9be36-281">*filePath*は、*仮想* *パス*(`/Brochures/SomeFile.pdf`) ではなく、*物理パス*(`C:\Websites\Brochures\SomeFile.pdf`) である必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-281">*filePath* must be a *physical path* (`C:\Websites\Brochures\SomeFile.pdf`) rather than a *virtual* *path* (`/Brochures/SomeFile.pdf`).</span></span> <span data-ttu-id="9be36-282">[`Server.MapPath(virtPath)` メソッド](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx)は、仮想パスを受け取り、対応する物理パスを返します。</span><span class="sxs-lookup"><span data-stu-id="9be36-282">The [`Server.MapPath(virtPath)` method](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) takes a virtual path and returns its corresponding physical path.</span></span> <span data-ttu-id="9be36-283">ここでは、仮想パスが `~/Brochures/fileName`ます。 *fileName*は、アップロードされたファイルの名前です。</span><span class="sxs-lookup"><span data-stu-id="9be36-283">Here, the virtual path is `~/Brochures/fileName`, where *fileName* is the name of the uploaded file.</span></span> <span data-ttu-id="9be36-284">仮想パスと物理パスの詳細および `Server.MapPath`の使用については、「 [using](http://www.4guysfromrolla.com/webtech/121799-1.shtml) 」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9be36-284">See [Using Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) for more information on virtual and physical paths and using `Server.MapPath`.</span></span>

<span data-ttu-id="9be36-285">`Click` イベントハンドラーが完了したら、ブラウザーでページをテストしてみてください。</span><span class="sxs-lookup"><span data-stu-id="9be36-285">After completing the `Click` event handler, take a moment to test out the page in a browser.</span></span> <span data-ttu-id="9be36-286">[参照] ボタンをクリックしてハードドライブからファイルを選択し、[選択したファイルをアップロードします] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="9be36-286">Click the Browse button and select a file from your hard drive and then click the Upload Selected File button.</span></span> <span data-ttu-id="9be36-287">ポストバックは、選択されたファイルの内容を web サーバーに送信します。その後、ファイルに関する情報が表示され、`~/Brochures` フォルダーに保存されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-287">The postback will send the contents of the selected file to the web server, which will then display information about the file before saving it to the `~/Brochures` folder.</span></span> <span data-ttu-id="9be36-288">ファイルをアップロードした後、Visual Studio に戻り、ソリューションエクスプローラーの [更新] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="9be36-288">After uploading the file, return to Visual Studio and click the Refresh button in the Solution Explorer.</span></span> <span data-ttu-id="9be36-289">アップロードしたファイルが、~/パンフレットフォルダーに表示されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-289">You should see the file you just uploaded in the ~/Brochures folder!</span></span>

<span data-ttu-id="9be36-290">[EvolutionValley ファイルが Web サーバーにアップロードされた ![](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="9be36-290">[![The File EvolutionValley.jpg Has Been Uploaded to the Web Server](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span></span>

<span data-ttu-id="9be36-291">**図 14**: ファイル `EvolutionValley.jpg` が Web サーバーにアップロードされている ([クリックしてフルサイズの画像を表示する](uploading-files-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="9be36-291">**Figure 14**: The File `EvolutionValley.jpg` Has Been Uploaded to the Web Server ([Click to view full-size image](uploading-files-cs/_static/image22.png))</span></span>

![EvolutionValley が ~/パンフレットフォルダーに保存されました](uploading-files-cs/_static/image15.gif)

<span data-ttu-id="9be36-293">**図 15**: `EvolutionValley.jpg` が `~/Brochures` フォルダーに保存された</span><span class="sxs-lookup"><span data-stu-id="9be36-293">**Figure 15**: `EvolutionValley.jpg` Was Saved to the `~/Brochures` Folder</span></span>

## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a><span data-ttu-id="9be36-294">ファイルシステムへのアップロードされたファイルの保存との微妙な違い</span><span class="sxs-lookup"><span data-stu-id="9be36-294">Subtleties with Saving Uploaded Files to the File System</span></span>

<span data-ttu-id="9be36-295">Web サーバーのファイルシステムにアップロードするファイルを保存する際には、いくつかの微妙な対処が必要です。</span><span class="sxs-lookup"><span data-stu-id="9be36-295">There are several subtleties that must be addressed when saving uploading files to the web server s file system.</span></span> <span data-ttu-id="9be36-296">まず、セキュリティの問題があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-296">First, there s the issue of security.</span></span> <span data-ttu-id="9be36-297">ファイルをファイルシステムに保存するには、ASP.NET ページを実行しているセキュリティコンテキストに書き込み権限が必要です。</span><span class="sxs-lookup"><span data-stu-id="9be36-297">To save a file to the file system, the security context under which the ASP.NET page is executing must have Write permissions.</span></span> <span data-ttu-id="9be36-298">ASP.NET Development Web サーバーは、現在のユーザーアカウントのコンテキストで実行されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-298">The ASP.NET Development Web Server runs under the context of your current user account.</span></span> <span data-ttu-id="9be36-299">Microsoft インターネットインフォメーションサービス (IIS) を web サーバーとして使用している場合、セキュリティコンテキストは IIS のバージョンとその構成によって異なります。</span><span class="sxs-lookup"><span data-stu-id="9be36-299">If you are using Microsoft s Internet Information Services (IIS) as the web server, the security context depends on the version of IIS and its configuration.</span></span>

<span data-ttu-id="9be36-300">ファイルをファイルシステムに保存するもう1つの課題は、ファイルの名前付けに関するものです。</span><span class="sxs-lookup"><span data-stu-id="9be36-300">Another challenge of saving files to the file system revolves around naming the files.</span></span> <span data-ttu-id="9be36-301">現在、このページでは、クライアントコンピューター上のファイルと同じ名前を使用して、アップロードされたすべてのファイルが `~/Brochures` ディレクトリに保存されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-301">Currently, our page saves all of the uploaded files to the `~/Brochures` directory using the same name as the file on the client s computer.</span></span> <span data-ttu-id="9be36-302">ユーザー A が `Brochure.pdf`という名前のパンフレットをアップロードすると、ファイルは `~/Brochure/Brochure.pdf`として保存されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-302">If User A uploads a brochure with the name `Brochure.pdf`, the file will be saved as `~/Brochure/Brochure.pdf`.</span></span> <span data-ttu-id="9be36-303">しかし、それ以降のユーザー B が同じファイル名 (`Brochure.pdf`) を持つ別のパンフレットファイルをアップロードする場合はどうでしょうか。</span><span class="sxs-lookup"><span data-stu-id="9be36-303">But what if sometime later User B uploads a different brochure file that happens to have the same filename (`Brochure.pdf`)?</span></span> <span data-ttu-id="9be36-304">現在のコードでは、ユーザー A s ファイルはユーザー B がアップロードして上書きされます。</span><span class="sxs-lookup"><span data-stu-id="9be36-304">With the code we have now, User A s file will be overwritten with User B s upload.</span></span>

<span data-ttu-id="9be36-305">ファイル名の競合を解決するには、いくつかの方法があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-305">There are a number of techniques for resolving file name conflicts.</span></span> <span data-ttu-id="9be36-306">1つの方法として、同じ名前のファイルが既に存在する場合に、ファイルのアップロードを禁止することができます。</span><span class="sxs-lookup"><span data-stu-id="9be36-306">One option is to prohibit uploading a file if there already exists one with the same name.</span></span> <span data-ttu-id="9be36-307">この方法では、ユーザー B が `Brochure.pdf`という名前のファイルをアップロードしようとしても、ファイルは保存されず、ユーザー B がファイルの名前を変更して再試行するように指示するメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="9be36-307">With this approach, when User B attempts to upload a file named `Brochure.pdf`, the system would not save their file and instead display a message informing User B to rename the file and try again.</span></span> <span data-ttu-id="9be36-308">別の方法としては、一意のファイル名を使用してファイルを保存する方法があります。これは、[グローバル一意識別子 (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)または対応するデータベースレコードの主キー列の値 (アップロードがデータモデルの特定の行に関連付けられていることを前提とします) です。</span><span class="sxs-lookup"><span data-stu-id="9be36-308">Another approach is to save the file using a unique file name, which could be a [globally unique identifier (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) or the value from the corresponding database record s primary key column(s) (assuming that the upload is associated with a particular row in the data model).</span></span> <span data-ttu-id="9be36-309">次のチュートリアルでは、これらのオプションについて詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="9be36-309">In the next tutorial we'll explore these options in more detail.</span></span>

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a><span data-ttu-id="9be36-310">大量のバイナリデータに関連する課題</span><span class="sxs-lookup"><span data-stu-id="9be36-310">Challenges Involved with Very Large Amounts of Binary Data</span></span>

<span data-ttu-id="9be36-311">これらのチュートリアルでは、キャプチャされるバイナリデータのサイズが適度であることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="9be36-311">These tutorials assume that the binary data captured is modest in size.</span></span> <span data-ttu-id="9be36-312">数 mb 以上の大量のバイナリデータファイルを操作する場合は、これらのチュートリアルの範囲を超えて新しい課題が発生します。</span><span class="sxs-lookup"><span data-stu-id="9be36-312">Working with very large amounts of binary data files that are several megabytes or larger introduces new challenges that are beyond the scope of these tutorials.</span></span> <span data-ttu-id="9be36-313">たとえば、既定では、ASP.NET は 4 MB を超えるアップロードを拒否しますが、`Web.config`の[`<httpRuntime>` 要素](https://msdn.microsoft.com/library/e1f13641.aspx)を使用して構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="9be36-313">For example, by default ASP.NET will reject uploads of more than 4 MB, although this can be configured through the [`<httpRuntime>` element](https://msdn.microsoft.com/library/e1f13641.aspx) in `Web.config`.</span></span> <span data-ttu-id="9be36-314">IIS では、独自のファイルアップロードサイズ制限も設けられています。</span><span class="sxs-lookup"><span data-stu-id="9be36-314">IIS imposes its own file upload size limitations, too.</span></span> <span data-ttu-id="9be36-315">詳細については、「 [IIS Upload File Size](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) 」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9be36-315">See [IIS Upload File Size](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) for more information.</span></span> <span data-ttu-id="9be36-316">さらに、大きなファイルのアップロードにかかる時間は、ASP.NET が要求を待機する既定の110秒を超える場合があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-316">Furthermore, the time taken to upload large files might exceed the default 110 seconds ASP.NET will wait for a request.</span></span> <span data-ttu-id="9be36-317">また、大きなファイルを操作するときに発生するメモリとパフォーマンスの問題もあります。</span><span class="sxs-lookup"><span data-stu-id="9be36-317">There are also memory and performance issues that arise when working with large files.</span></span>

<span data-ttu-id="9be36-318">FileUpload コントロールは、大きなファイルのアップロードには実用的ではありません。</span><span class="sxs-lookup"><span data-stu-id="9be36-318">The FileUpload control is impractical for large file uploads.</span></span> <span data-ttu-id="9be36-319">ファイルの内容がサーバーにポストされている間、エンドユーザーは、アップロードの進行状況を確認せずに待機を我慢強く必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-319">As the file s contents are being posted to the server, the end user must patiently wait without any confirmation that their upload is progressing.</span></span> <span data-ttu-id="9be36-320">これは、数秒でアップロードできる小さなファイルを扱う場合の問題ではありませんが、アップロードに数分かかる可能性のある大きなファイルを処理する場合に問題になることがあります。</span><span class="sxs-lookup"><span data-stu-id="9be36-320">This is not so much an issue when dealing with smaller files that can be uploaded in a few seconds, but can be an issue when dealing with larger files that may take minutes to upload.</span></span> <span data-ttu-id="9be36-321">大規模なアップロードの処理に適したサードパーティ製のファイルアップロードコントロールがいくつかあります。これらのベンダーの多くは、より洗練されたユーザーエクスペリエンスを提供する進行状況インジケーターと ActiveX アップロードマネージャーを提供しています。</span><span class="sxs-lookup"><span data-stu-id="9be36-321">There are a variety of third-party file upload controls that are better suited for handling large uploads and many of these vendors provide progress indicators and ActiveX upload managers that present a much more polished user experience.</span></span>

<span data-ttu-id="9be36-322">アプリケーションで大きなファイルを処理する必要がある場合は、問題を慎重に調査し、特定のニーズに適したソリューションを見つける必要があります。</span><span class="sxs-lookup"><span data-stu-id="9be36-322">If your application needs to handle large files, you'll need to carefully investigate the challenges and find suitable solutions for your particular needs.</span></span>

## <a name="summary"></a><span data-ttu-id="9be36-323">まとめ</span><span class="sxs-lookup"><span data-stu-id="9be36-323">Summary</span></span>

<span data-ttu-id="9be36-324">バイナリデータをキャプチャする必要があるアプリケーションを構築すると、さまざまな課題が生じます。</span><span class="sxs-lookup"><span data-stu-id="9be36-324">Building an application that needs to capture binary data introduces a number of challenges.</span></span> <span data-ttu-id="9be36-325">このチュートリアルでは、最初の2つについて説明します。バイナリデータを格納する場所を決定し、ユーザーが web ページを使用してバイナリコンテンツをアップロードできるようにします。</span><span class="sxs-lookup"><span data-stu-id="9be36-325">In this tutorial we explored the first two: deciding where to store the binary data and allowing a user to upload binary content through a web page.</span></span> <span data-ttu-id="9be36-326">次の3つのチュートリアルでは、アップロードされたデータをデータベース内のレコードに関連付ける方法と、バイナリデータをテキストデータフィールドと共に表示する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9be36-326">Over the next three tutorials, we'll see how to associate the uploaded data with a record in the database as well as how to display the binary data alongside its text data fields.</span></span>

<span data-ttu-id="9be36-327">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="9be36-327">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="9be36-328">参考資料</span><span class="sxs-lookup"><span data-stu-id="9be36-328">Further Reading</span></span>

<span data-ttu-id="9be36-329">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="9be36-329">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="9be36-330">大きな値のデータ型の使用</span><span class="sxs-lookup"><span data-stu-id="9be36-330">Using Large-Value Data Types</span></span>](https://msdn.microsoft.com/library/ms178158.aspx)
- [<span data-ttu-id="9be36-331">FileUpload コントロールのクイックスタート</span><span class="sxs-lookup"><span data-stu-id="9be36-331">FileUpload Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [<span data-ttu-id="9be36-332">ASP.NET 2.0 FileUpload サーバーコントロール</span><span class="sxs-lookup"><span data-stu-id="9be36-332">The ASP.NET 2.0 FileUpload Server Control</span></span>](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [<span data-ttu-id="9be36-333">ファイルのアップロードのダークサイド</span><span class="sxs-lookup"><span data-stu-id="9be36-333">The Dark Side of File Uploads</span></span>](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a><span data-ttu-id="9be36-334">著者について</span><span class="sxs-lookup"><span data-stu-id="9be36-334">About the Author</span></span>

<span data-ttu-id="9be36-335">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="9be36-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9be36-336">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="9be36-336">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9be36-337">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="9be36-337">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9be36-338">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9be36-338">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="9be36-339">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="9be36-339">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="9be36-340">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="9be36-340">Special Thanks To</span></span>

<span data-ttu-id="9be36-341">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="9be36-341">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9be36-342">このチュートリアルのリードレビュー担当者は、Teresa Murphy and Bernadette Leigh でした。</span><span class="sxs-lookup"><span data-stu-id="9be36-342">Lead reviewers for this tutorial were Teresa Murphy and Bernadette Leigh.</span></span> <span data-ttu-id="9be36-343">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="9be36-343">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9be36-344">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9be36-344">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="9be36-345">Next</span><span class="sxs-lookup"><span data-stu-id="9be36-345">Next</span></span>](displaying-binary-data-in-the-data-web-controls-cs.md)
