---
uid: web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-vb
title: データ Web コントロールにバイナリデータを表示する (VB) |Microsoft Docs
author: rick-anderson
description: このチュートリアルでは、Web ページにバイナリデータを表示するためのオプションについて説明します。これには、イメージファイルの表示や、"ダウンロード" リンク (f...) のプロビジョニングなどが含まれます。
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 9201656a-e1c2-4020-824b-18fb632d2925
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-vb
msc.type: authoredcontent
ms.openlocfilehash: 27c901af092aa990f557750dc5d2c42ba2644c02
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74640909"
---
# <a name="displaying-binary-data-in-the-data-web-controls-vb"></a><span data-ttu-id="8ef62-103">データ Web コントロールにバイナリ データを表示する (VB)</span><span class="sxs-lookup"><span data-stu-id="8ef62-103">Displaying Binary Data in the Data Web Controls (VB)</span></span>

<span data-ttu-id="8ef62-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8ef62-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8ef62-105">[サンプルアプリのダウンロード](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_VB.exe)または[PDF のダウンロード](displaying-binary-data-in-the-data-web-controls-vb/_static/datatutorial55vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8ef62-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_VB.exe) or [Download PDF](displaying-binary-data-in-the-data-web-controls-vb/_static/datatutorial55vb1.pdf)</span></span>

> <span data-ttu-id="8ef62-106">このチュートリアルでは、Web ページにバイナリデータを表示するためのオプションについて説明します。これには、画像ファイルの表示や PDF ファイルの ' ダウンロード ' リンクのプロビジョニングなどが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-106">In this tutorial we look at the options to present binary data on a Web page, including the display of an image file and the provision of a 'Download' link for a PDF file.</span></span>

## <a name="introduction"></a><span data-ttu-id="8ef62-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="8ef62-107">Introduction</span></span>

<span data-ttu-id="8ef62-108">前のチュートリアルでは、バイナリデータをアプリケーションの基になるデータモデルに関連付け、FileUpload コントロールを使用してブラウザーから web サーバーのファイルシステムにファイルをアップロードする2つの手法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="8ef62-108">In the preceding tutorial we explored the two techniques for associating binary data with an application s underlying data model and used the FileUpload control to upload files from a browser to the web server s file system.</span></span> <span data-ttu-id="8ef62-109">アップロードしたバイナリデータをデータモデルに関連付ける方法については、まだ説明していません。</span><span class="sxs-lookup"><span data-stu-id="8ef62-109">We ve yet to see how to associate the uploaded binary data with the data model.</span></span> <span data-ttu-id="8ef62-110">つまり、ファイルがアップロードされ、ファイルシステムに保存された後、ファイルへのパスが適切なデータベースレコードに格納されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-110">That is, after a file has been uploaded and saved to the file system, a path to the file must be stored in the appropriate database record.</span></span> <span data-ttu-id="8ef62-111">データがデータベースに直接格納されている場合は、アップロードされたバイナリデータをファイルシステムに保存する必要はありませんが、データベースに挿入する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-111">If the data is being stored directly in the database, then the uploaded binary data need not be saved to the file system, but must be injected into the database.</span></span>

<span data-ttu-id="8ef62-112">データモデルにデータを関連付ける前に、まず、バイナリデータをエンドユーザーに提供する方法を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="8ef62-112">Before we look at associating the data with the data model, though, let s first look at how to provide the binary data to the end user.</span></span> <span data-ttu-id="8ef62-113">テキストデータの表示は簡単ですが、バイナリデータを表示するにはどうすればよいでしょうか。</span><span class="sxs-lookup"><span data-stu-id="8ef62-113">Presenting text data is simple enough, but how should binary data be presented?</span></span> <span data-ttu-id="8ef62-114">もちろん、バイナリデータの種類によって異なります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-114">It depends, of course, on the type of binary data.</span></span> <span data-ttu-id="8ef62-115">イメージの場合、イメージを表示することが必要になることがあります。Pdf、Microsoft Word 文書、ZIP ファイル、およびその他の種類のバイナリデータについては、ダウンロードリンクを提供する方が適しています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-115">For images, we likely want to display the image; for PDFs, Microsoft Word documents, ZIP files, and other types of binary data, providing a Download link is probably more appropriate.</span></span>

<span data-ttu-id="8ef62-116">このチュートリアルでは、GridView や DetailsView などのデータ Web コントロールを使用して、関連するテキストデータと共にバイナリデータを表示する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-116">In this tutorial we will look at how to present the binary data alongside its associated text data using data Web controls like the GridView and DetailsView.</span></span> <span data-ttu-id="8ef62-117">次のチュートリアルでは、アップロードしたファイルをデータベースに関連付けることに注目します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-117">In the next tutorial we'll turn our attention to associating an uploaded file with the database.</span></span>

## <a name="step-1-providingbrochurepathvalues"></a><span data-ttu-id="8ef62-118">手順 1:`BrochurePath`値を指定する</span><span class="sxs-lookup"><span data-stu-id="8ef62-118">Step 1: Providing`BrochurePath`Values</span></span>

<span data-ttu-id="8ef62-119">`Categories` テーブルの `Picture` 列には、さまざまなカテゴリイメージのバイナリデータが既に含まれています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-119">The `Picture` column in the `Categories` table already contains binary data for the various category images.</span></span> <span data-ttu-id="8ef62-120">具体的には、各レコードの `Picture` 列には、粗く、低品質、16色のビットマップイメージのバイナリコンテンツが保持されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-120">Specifically, the `Picture` column for each record holds the binary contents of a grainy, low-quality, 16-color bitmap image.</span></span> <span data-ttu-id="8ef62-121">各カテゴリの画像は172ピクセル幅、高さは120ピクセル、約 11 KB を消費します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-121">Each category image is 172 pixels wide and 120 pixels tall and consumes roughly 11 KB.</span></span> <span data-ttu-id="8ef62-122">さらに、[`Picture`] 列のバイナリコンテンツには、イメージを表示する前に削除する必要がある78バイトの[OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding)ヘッダーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-122">What s more, the binary content in the `Picture` column includes a 78-byte [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) header that must be stripped before displaying the image.</span></span> <span data-ttu-id="8ef62-123">このヘッダー情報は、Northwind データベースのルートが Microsoft Access にあるために存在します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-123">This header information is present because the Northwind database has its roots in Microsoft Access.</span></span> <span data-ttu-id="8ef62-124">Access では、バイナリデータは OLE オブジェクトデータ型を使用して格納されます。このデータ型は、このヘッダーに tacks ます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-124">In Access, binary data is stored using the OLE Object data type, which tacks on this header.</span></span> <span data-ttu-id="8ef62-125">ここでは、画像を表示するために、これらの低品質のイメージからヘッダーを削除する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-125">For now, we'll see how to strip the headers from these low-quality images in order to display the picture.</span></span> <span data-ttu-id="8ef62-126">今後のチュートリアルでは、category s `Picture` 列を更新するためのインターフェイスを作成し、OLE ヘッダーを使用するビットマップイメージを、不要な OLE ヘッダーを含まない同等の JPG イメージに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-126">In a future tutorial we'll build an interface for updating a category s `Picture` column and replace these bitmap images that use OLE headers with equivalent JPG images without the unnecessary OLE headers.</span></span>

<span data-ttu-id="8ef62-127">前のチュートリアルでは、FileUpload コントロールの使用方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="8ef62-127">In the preceding tutorial we saw how to use the FileUpload control.</span></span> <span data-ttu-id="8ef62-128">そのため、web サーバーのファイルシステムにパンフレットファイルを追加することができます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-128">Therefore, you can go ahead and add brochure files to the web server s file system.</span></span> <span data-ttu-id="8ef62-129">ただし、この操作を行っても、`Categories` テーブルの `BrochurePath` 列は更新されません。</span><span class="sxs-lookup"><span data-stu-id="8ef62-129">Doing so, however, does not update the `BrochurePath` column in the `Categories` table.</span></span> <span data-ttu-id="8ef62-130">次のチュートリアルでは、これを実現する方法を説明しますが、ここでは、この列の値を手動で指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-130">In the next tutorial we'll see how to accomplish this, but for now we need to manually provide values for this column.</span></span>

<span data-ttu-id="8ef62-131">このチュートリアルのダウンロードでは、[`~/Brochures`] フォルダーに7つの PDF パンフレットファイルがあり、シーフードを除く各カテゴリに対応しています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-131">In this tutorial s download you'll find seven PDF brochure files in the `~/Brochures` folder, one for each of the categories except Seafood.</span></span> <span data-ttu-id="8ef62-132">ここでは、すべてのレコードにバイナリデータが関連付けられているわけではないシナリオの処理方法を示すために、シーフードのパンフレットの追加を省略しました。</span><span class="sxs-lookup"><span data-stu-id="8ef62-132">I purposefully omitted adding a Seafood brochure to illustrate how to handle scenarios where not all records have associated binary data.</span></span> <span data-ttu-id="8ef62-133">これらの値を使用して `Categories` テーブルを更新するにはサーバーエクスプローラーから [`Categories`] ノードを右クリックし、[テーブルデータの表示] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="8ef62-133">To update the `Categories` table with these values, right-click on the `Categories` node from Server Explorer and choose Show Table Data.</span></span> <span data-ttu-id="8ef62-134">次に、図1に示すように、各カテゴリのパンフレットファイルへの仮想パスを入力します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-134">Then, enter the virtual paths to the brochure files for each category that has a brochure, as Figure 1 shows.</span></span> <span data-ttu-id="8ef62-135">シーフードカテゴリのパンフレットは存在しないため、`BrochurePath` 列の値は `NULL`としてそのままにします。</span><span class="sxs-lookup"><span data-stu-id="8ef62-135">Since there is no brochure for the Seafood category, leave its `BrochurePath` column s value as `NULL`.</span></span>

<span data-ttu-id="8ef62-136">[![手動でカテゴリテーブル s BrochurePath 列の値を入力する](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-136">[![Manually Enter the Values for the Categories Table s BrochurePath Column](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.png)</span></span>

<span data-ttu-id="8ef62-137">**図 1**: `Categories` Table s `BrochurePath` 列の値を手動で入力[する (クリックすると、フルサイズの画像が表示](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8ef62-137">**Figure 1**: Manually Enter the Values for the `Categories` Table s `BrochurePath` Column ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.png))</span></span>

## <a name="step-2-providing-a-download-link-for-the-brochures-in-a-gridview"></a><span data-ttu-id="8ef62-138">手順 2: GridView でのパンフレットへのダウンロードリンクの提供</span><span class="sxs-lookup"><span data-stu-id="8ef62-138">Step 2: Providing a Download Link for the Brochures in a GridView</span></span>

<span data-ttu-id="8ef62-139">`Categories` テーブルに指定された `BrochurePath` 値を使用して、各カテゴリとカテゴリ s パンフレットをダウンロードするためのリンクを一覧表示する GridView を作成する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="8ef62-139">With the `BrochurePath` values provided for the `Categories` table, we re ready to create a GridView that lists each category along with a link to download the category s brochure.</span></span> <span data-ttu-id="8ef62-140">手順4では、この GridView を拡張してカテゴリ s イメージも表示します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-140">In Step 4 we'll extend this GridView to also display the category s image.</span></span>

<span data-ttu-id="8ef62-141">まず、GridView をツールボックスから `BinaryData` フォルダーの [`DisplayOrDownloadData.aspx`] ページのデザイナーにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="8ef62-141">Start by dragging a GridView from the Toolbox onto the Designer of the `DisplayOrDownloadData.aspx` page in the `BinaryData` folder.</span></span> <span data-ttu-id="8ef62-142">GridView s `ID` を `Categories` に設定し、GridView s スマートタグを使用して、新しいデータソースにバインドするように選択します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-142">Set the GridView s `ID` to `Categories` and through the GridView s smart tag, choose to bind it to a new data source.</span></span> <span data-ttu-id="8ef62-143">具体的には、`CategoriesBLL` object s `GetCategories()` メソッドを使用してデータを取得する `CategoriesDataSource` という名前の ObjectDataSource にバインドします。</span><span class="sxs-lookup"><span data-stu-id="8ef62-143">Specifically, bind it to an ObjectDataSource named `CategoriesDataSource` that retrieves data using the `CategoriesBLL` object s `GetCategories()` method.</span></span>

<span data-ttu-id="8ef62-144">[新しい ObjectDataSource という名前の新しい名前のデータソースを作成 ![には](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-144">[![Create a New ObjectDataSource Named CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.png)</span></span>

<span data-ttu-id="8ef62-145">**図 2**: `CategoriesDataSource` という名前の新しい ObjectDataSource を作成[する (クリックすると、フルサイズの画像が表示](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.png)される)</span><span class="sxs-lookup"><span data-stu-id="8ef62-145">**Figure 2**: Create a New ObjectDataSource Named `CategoriesDataSource` ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.png))</span></span>

<span data-ttu-id="8ef62-146">[カテゴリ Bll クラスを使用するように ObjectDataSource を構成 ![には](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-146">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.png)</span></span>

<span data-ttu-id="8ef62-147">**図 3**: `CategoriesBLL` クラスを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="8ef62-147">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.png))</span></span>

<span data-ttu-id="8ef62-148">[GetCategories () メソッドを使用してカテゴリの一覧を取得 ![には](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-148">[![Retrieve the List of Categories Using the GetCategories() Method](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.png)</span></span>

<span data-ttu-id="8ef62-149">**図 4**: `GetCategories()` メソッドを使用してカテゴリの一覧を取得[する (クリックしてフルサイズのイメージを表示する](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="8ef62-149">**Figure 4**: Retrieve the List of Categories Using the `GetCategories()` Method ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.png))</span></span>

<span data-ttu-id="8ef62-150">データソースの構成ウィザードを完了すると、Visual Studio によって、`CategoryID`、`CategoryName`、`Description`、`NumberOfProducts`、および `BrochurePath` `DataColumn` の `Categories` GridView に BoundField が自動的に追加されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-150">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField to the `Categories` GridView for the `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` `DataColumn` s.</span></span> <span data-ttu-id="8ef62-151">`GetCategories()` メソッド s クエリがこの情報を取得しないため、`NumberOfProducts` BoundField を削除します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-151">Go ahead and remove the `NumberOfProducts` BoundField since the `GetCategories()` method s query does not retrieve this information.</span></span> <span data-ttu-id="8ef62-152">また、`CategoryID` BoundField を削除し、`CategoryName` と `BrochurePath` BoundFields `HeaderText` プロパティの名前をそれぞれ Category とパンフレットにそれぞれ変更します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-152">Also remove the `CategoryID` BoundField and rename the `CategoryName` and `BrochurePath` BoundFields `HeaderText` properties to Category and Brochure, respectively.</span></span> <span data-ttu-id="8ef62-153">これらの変更を行った後、GridView および ObjectDataSource s 宣言マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-153">After making these changes, your GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample1.aspx)]

<span data-ttu-id="8ef62-154">ブラウザーを使用してこのページを表示します (図5を参照)。</span><span class="sxs-lookup"><span data-stu-id="8ef62-154">View this page through a browser (see Figure 5).</span></span> <span data-ttu-id="8ef62-155">8つのカテゴリがそれぞれ一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-155">Each of the eight categories is listed.</span></span> <span data-ttu-id="8ef62-156">`BrochurePath` 値を持つ7つのカテゴリの `BrochurePath` 値は、それぞれの BoundField に表示されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-156">The seven categories with `BrochurePath` values have the `BrochurePath` value displayed in the respective BoundField.</span></span> <span data-ttu-id="8ef62-157">`BrochurePath`の `NULL` 値を持つシーフードには、空のセルが表示されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-157">Seafood, which has a `NULL` value for its `BrochurePath`, displays an empty cell.</span></span>

<span data-ttu-id="8ef62-158">[各カテゴリの [名前]、[説明]、および [BrochurePath] の値が表示されます。 ![](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-158">[![Each Category s Name, Description, and BrochurePath Value is Listed](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.png)</span></span>

<span data-ttu-id="8ef62-159">**図 5**: 各カテゴリの名前、説明、および `BrochurePath` 値が表示されます ([クリックすると、フルサイズの画像が表示](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8ef62-159">**Figure 5**: Each Category s Name, Description, and `BrochurePath` Value is Listed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.png))</span></span>

<span data-ttu-id="8ef62-160">`BrochurePath` 列のテキストを表示するのではなく、パンフレットへのリンクを作成します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-160">Rather than displaying the text of the `BrochurePath` column, we want to create a link to the brochure.</span></span> <span data-ttu-id="8ef62-161">これを行うには、`BrochurePath` BoundField を削除し、ハイパーリンクフィールドに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-161">To accomplish this, remove the `BrochurePath` BoundField and replace it with a HyperLinkField.</span></span> <span data-ttu-id="8ef62-162">新しいハイパーリンクフィールド s `HeaderText` プロパティを「パンフレット」に、その `Text` プロパティを「パンフレット」、`DataNavigateUrlFields` プロパティを「`BrochurePath`」に設定します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-162">Set the new HyperLinkField s `HeaderText` property to Brochure, its `Text` property to View Brochure, and its `DataNavigateUrlFields` property to `BrochurePath`.</span></span>

![BrochurePath のハイパーリンクフィールドを追加する](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.gif)

<span data-ttu-id="8ef62-164">**図 6**: `BrochurePath` のハイパーリンクフィールドを追加する</span><span class="sxs-lookup"><span data-stu-id="8ef62-164">**Figure 6**: Add a HyperLinkField for `BrochurePath`</span></span>

<span data-ttu-id="8ef62-165">これにより、図7に示すように、GridView にリンクの列が追加されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-165">This will add a column of links to the GridView, as Figure 7 shows.</span></span> <span data-ttu-id="8ef62-166">[パンフレットの表示] リンクをクリックすると、ブラウザーに PDF が直接表示されるか、または PDF リーダーがインストールされているかどうか、およびブラウザーの設定に応じて、ファイルのダウンロードをユーザーに促すメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-166">Clicking a View Brochure link will either display the PDF directly in the browser or prompt the user to download the file, depending on whether a PDF reader is installed and the browser s settings.</span></span>

<span data-ttu-id="8ef62-167">[[パンフレットの表示] リンクをクリックすると、カテゴリ s のパンフレットを表示でき ![](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-167">[![A Category s Brochure Can Be Viewed by Clicking the View Brochure Link](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.png)</span></span>

<span data-ttu-id="8ef62-168">**図 7**: [パンフレットを表示] リンクをクリックするとカテゴリ s のパンフレットを表示できる ([クリックすると、フルサイズの画像が表示](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8ef62-168">**Figure 7**: A Category s Brochure Can Be Viewed by Clicking the View Brochure Link ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.png))</span></span>

<span data-ttu-id="8ef62-169">[カテゴリ s のパンフレット PDF が表示され ![](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-169">[![The Category s Brochure PDF is Displayed](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.png)</span></span>

<span data-ttu-id="8ef62-170">**図 8**: カテゴリ s のパンフレット PDF が表示される ([クリックすると、フルサイズの画像が表示](displaying-binary-data-in-the-data-web-controls-vb/_static/image14.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8ef62-170">**Figure 8**: The Category s Brochure PDF is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image14.png))</span></span>

## <a name="hiding-the-view-brochure-text-for-categories-without-a-brochure"></a><span data-ttu-id="8ef62-171">パンフレットのないカテゴリのビューパンフレットのテキストを非表示にする</span><span class="sxs-lookup"><span data-stu-id="8ef62-171">Hiding the View Brochure Text for Categories Without a Brochure</span></span>

<span data-ttu-id="8ef62-172">図7に示すように、[`BrochurePath` のハイパーリンク] フィールドには、`BrochurePath`に`NULL` 以外の値があるかどうかに関係なく、すべてのレコードの `Text` プロパティ値 (ビューのパンフレット) が表示されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-172">As Figure 7 shows, the `BrochurePath` HyperLinkField displays its `Text` property value ( View Brochure ) for all records, regardless of whether there s a non-`NULL` value for `BrochurePath`.</span></span> <span data-ttu-id="8ef62-173">もちろん、`BrochurePath` が `NULL`場合、シーフードカテゴリの場合と同様に、リンクはテキストとしてのみ表示されます (図7を参照)。</span><span class="sxs-lookup"><span data-stu-id="8ef62-173">Of course, if `BrochurePath` is `NULL`, then the link is displayed as text only, as is the case with the Seafood category (refer back to Figure 7).</span></span> <span data-ttu-id="8ef62-174">テキストビューのパンフレットを表示するのではなく、`BrochurePath` の値を持たないカテゴリには、利用可能なパンフレットがないなどの代替テキストを表示すると便利な場合があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-174">Rather than displaying the text View Brochure, it might be nice to have those categories without a `BrochurePath` value display some alternate text, like No Brochure Available.</span></span>

<span data-ttu-id="8ef62-175">この動作を実現するには、`BrochurePath` 値に基づいて適切な出力を生成するページメソッドへの呼び出しによって、コンテンツが生成される TemplateField を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-175">In order to provide this behavior, we need to use a TemplateField whose content is generated via a call to a page method that emits the appropriate output based on the `BrochurePath` value.</span></span> <span data-ttu-id="8ef62-176">この書式設定の手法については、最初に GridView コントロールのチュートリアルの[「TemplateFields](../custom-formatting/using-templatefields-in-the-gridview-control-vb.md) 」で説明しています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-176">We first explored this formatting technique back in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-vb.md) tutorial.</span></span>

<span data-ttu-id="8ef62-177">[ハイパーリンク] フィールドを TemplateField に変換します。そのためには、[`BrochurePath` ハイパーリンク] フィールドを選択し、[列の編集] ダイアログボックスの [このフィールドを TemplateField に変換] リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="8ef62-177">Turn the HyperLinkField into a TemplateField by selecting the `BrochurePath` HyperLinkField and then clicking on the Convert this field into a TemplateField link in the Edit Columns dialog box.</span></span>

![ハイパーリンクフィールドを TemplateField に変換します。](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.gif)

<span data-ttu-id="8ef62-179">**図 9**: ハイパーリンクフィールドを TemplateField に変換する</span><span class="sxs-lookup"><span data-stu-id="8ef62-179">**Figure 9**: Convert the HyperLinkField into a TemplateField</span></span>

<span data-ttu-id="8ef62-180">これにより、`NavigateUrl` プロパティが `BrochurePath` 値にバインドされたハイパーリンク Web コントロールを含む `ItemTemplate` の TemplateField が作成されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-180">This will create a TemplateField with an `ItemTemplate` that contains a HyperLink Web control whose `NavigateUrl` property is bound to the `BrochurePath` value.</span></span> <span data-ttu-id="8ef62-181">このマークアップをメソッド `GenerateBrochureLink`の呼び出しに置き換え、`BrochurePath`の値を渡します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-181">Replace this markup with a call to the method `GenerateBrochureLink`, passing in the value of `BrochurePath`:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample2.aspx)]

<span data-ttu-id="8ef62-182">次に、`String` を返し、入力パラメーターとして `Object` を受け入れる `GenerateBrochureLink` という名前の ASP.NET page s 分離コードクラスに `Protected` メソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-182">Next, create a `Protected` method in the ASP.NET page s code-behind class named `GenerateBrochureLink` that returns a `String` and accepts an `Object` as an input parameter.</span></span>

[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample3.vb)]

<span data-ttu-id="8ef62-183">このメソッドは、渡された `Object` 値がデータベース `NULL` かどうかを確認し、存在する場合は、そのカテゴリにパンフレットがないことを示すメッセージを返します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-183">This method determines if the passed-in `Object` value is a database `NULL` and, if so, returns a message indicating that the category lacks a brochure.</span></span> <span data-ttu-id="8ef62-184">それ以外の場合、`BrochurePath` 値があると、その値はハイパーリンクに表示されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-184">Otherwise, if there is a `BrochurePath` value, it s displayed in a hyperlink.</span></span> <span data-ttu-id="8ef62-185">`BrochurePath` の値が存在する場合は、 [`ResolveUrl(url)` メソッド](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx)に渡されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8ef62-185">Note that if the `BrochurePath` value is present it s passed into the [`ResolveUrl(url)` method](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span></span> <span data-ttu-id="8ef62-186">このメソッドは、渡された*url*を解決し、`~` の文字を適切な仮想パスに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-186">This method resolves the passed-in *url*, replacing the `~` character with the appropriate virtual path.</span></span> <span data-ttu-id="8ef62-187">たとえば、アプリケーションが `/Tutorial55`をルートとしている場合、`ResolveUrl("~/Brochures/Meats.pdf")` は `/Tutorial55/Brochures/Meat.pdf`を返します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-187">For example, if the application is rooted at `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` will return `/Tutorial55/Brochures/Meat.pdf`.</span></span>

<span data-ttu-id="8ef62-188">図10は、これらの変更が適用された後のページを示しています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-188">Figure 10 shows the page after these changes have been applied.</span></span> <span data-ttu-id="8ef62-189">シーフード category s `BrochurePath` フィールドに、[利用可能なパンフレットがありません] というテキストが表示されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8ef62-189">Note that the Seafood category s `BrochurePath` field now displays the text No Brochure Available .</span></span>

<span data-ttu-id="8ef62-190">[テキスト ![、パンフレットのないカテゴリには [利用可能なパンフレットがありません] と表示されます。](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-190">[![The Text No Brochure Available is Displayed for Those Categories Without a Brochure](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image15.png)</span></span>

<span data-ttu-id="8ef62-191">**図 10**: パンフレットのないカテゴリには、[利用可能なパンフレットがありません] というテキストが表示されます ([クリックすると、フルサイズの画像が表示](displaying-binary-data-in-the-data-web-controls-vb/_static/image16.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8ef62-191">**Figure 10**: The Text No Brochure Available is Displayed for Those Categories Without a Brochure ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image16.png))</span></span>

## <a name="step-3-adding-a-web-page-to-display-a-category-s-picture"></a><span data-ttu-id="8ef62-192">手順 3: カテゴリ s の画像を表示するための Web ページの追加</span><span class="sxs-lookup"><span data-stu-id="8ef62-192">Step 3: Adding a Web Page to Display a Category s Picture</span></span>

<span data-ttu-id="8ef62-193">ユーザーが ASP.NET ページにアクセスすると、ASP.NET page s HTML が表示されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-193">When a user visits an ASP.NET page, they receive the ASP.NET page s HTML.</span></span> <span data-ttu-id="8ef62-194">受信した HTML はテキストのみで、バイナリデータは含まれません。</span><span class="sxs-lookup"><span data-stu-id="8ef62-194">The received HTML is just text and does not contain any binary data.</span></span> <span data-ttu-id="8ef62-195">画像、サウンドファイル、Macromedia Flash アプリケーション、埋め込みの Windows Media Player ビデオなどの追加のバイナリデータは、web サーバー上に個別のリソースとして存在します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-195">Any additional binary data, such as images, sound files, Macromedia Flash applications, embedded Windows Media Player videos, and so forth, exist as separate resources on the web server.</span></span> <span data-ttu-id="8ef62-196">HTML にはこれらのファイルへの参照が含まれていますが、ファイルの実際の内容は含まれていません。</span><span class="sxs-lookup"><span data-stu-id="8ef62-196">The HTML contains references to these files, but does not include the actual contents of the files.</span></span>

<span data-ttu-id="8ef62-197">たとえば、HTML では、`<img>` 要素を使用して画像を参照し、次のように `src` 属性でイメージファイルをポイントします。</span><span class="sxs-lookup"><span data-stu-id="8ef62-197">For example, in HTML the `<img>` element is used to reference a picture, with the `src` attribute pointing to the image file like so:</span></span>

[!code-html[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample4.html)]

<span data-ttu-id="8ef62-198">ブラウザーは、この HTML を受け取ると、web サーバーに対して別の要求を行い、イメージファイルのバイナリコンテンツを取得して、ブラウザーに表示します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-198">When a browser receives this HTML, it makes another request to the web server to retrieve the binary contents of the image file, which it then displays in the browser.</span></span> <span data-ttu-id="8ef62-199">バイナリデータにも同じ概念が適用されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-199">The same concept applies to any binary data.</span></span> <span data-ttu-id="8ef62-200">手順2では、ページ s HTML マークアップの一部として、このパンフレットはブラウザーに送信されませんでした。</span><span class="sxs-lookup"><span data-stu-id="8ef62-200">In Step 2, the brochure was not sent down to the browser as part of the page s HTML markup.</span></span> <span data-ttu-id="8ef62-201">代わりに、レンダリングされた HTML には、ブラウザーが PDF ドキュメントを直接要求したというハイパーリンクが用意されています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-201">Rather, the rendered HTML provided hyperlinks that, when clicked, caused the browser to request the PDF document directly.</span></span>

<span data-ttu-id="8ef62-202">ユーザーがデータベース内に存在するバイナリデータを表示またはダウンロードできるようにするには、データを返す別の web ページを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-202">To display or allow users to download binary data that resides within the database, we need to create a separate web page that returns the data.</span></span> <span data-ttu-id="8ef62-203">このアプリケーションでは、1つのバイナリデータフィールドが、カテゴリの画像としてデータベースに直接格納されています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-203">For our application, there s only one binary data field stored directly in the database the category s picture.</span></span> <span data-ttu-id="8ef62-204">そのため、呼び出されたときに特定のカテゴリの画像データを返すページが必要です。</span><span class="sxs-lookup"><span data-stu-id="8ef62-204">Therefore, we need a page that, when called, returns the image data for a particular category.</span></span>

<span data-ttu-id="8ef62-205">`DisplayCategoryPicture.aspx`という名前の `BinaryData` フォルダーに新しい ASP.NET ページを追加します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-205">Add a new ASP.NET page to the `BinaryData` folder named `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="8ef62-206">この場合、[マスターページの選択] チェックボックスはオフのままにしておきます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-206">When doing so, leave the Select master page checkbox unchecked.</span></span> <span data-ttu-id="8ef62-207">このページでは、querystring に `CategoryID` 値が必要であり、そのカテゴリ `Picture` 列のバイナリデータを返します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-207">This page expects a `CategoryID` value in the querystring and returns the binary data of that category s `Picture` column.</span></span> <span data-ttu-id="8ef62-208">このページはバイナリデータを返すので、それ以外の場合は HTML セクションでマークアップを必要としません。</span><span class="sxs-lookup"><span data-stu-id="8ef62-208">Since this page returns binary data and nothing else, it does not need any markup in the HTML section.</span></span> <span data-ttu-id="8ef62-209">そのため、左下隅にある [ソース] タブをクリックし、`<%@ Page %>` ディレクティブ以外のすべてのページマークアップを削除します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-209">Therefore, click on the Source tab in the lower left corner and remove all of the page s markup except for the `<%@ Page %>` directive.</span></span> <span data-ttu-id="8ef62-210">つまり、`DisplayCategoryPicture.aspx` s 宣言マークアップは単一行で構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-210">That is, `DisplayCategoryPicture.aspx` s declarative markup should consist of a single line:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample5.aspx)]

<span data-ttu-id="8ef62-211">`<%@ Page %>` ディレクティブに `MasterPageFile` 属性が表示されている場合は、削除します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-211">If you see the `MasterPageFile` attribute in the `<%@ Page %>` directive, remove it.</span></span>

<span data-ttu-id="8ef62-212">ページの分離コードクラスで、`Page_Load` イベントハンドラーに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-212">In the page s code-behind class, add the following code to the `Page_Load` event handler:</span></span>

[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample6.vb)]

<span data-ttu-id="8ef62-213">このコードでは、まず、`CategoryID` querystring の値を `categoryID`という名前の変数に読み取ります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-213">This code starts by reading in the `CategoryID` querystring value into a variable named `categoryID`.</span></span> <span data-ttu-id="8ef62-214">次に、`CategoriesBLL` クラス s `GetCategoryWithBinaryDataByCategoryID(categoryID)` メソッドの呼び出しを使用して画像データを取得します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-214">Next, the picture data is retrieved via a call to the `CategoriesBLL` class s `GetCategoryWithBinaryDataByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="8ef62-215">このデータは `Response.BinaryWrite(data)` メソッドを使用してクライアントに返されますが、このが呼び出される前に、`Picture` 列の値 s OLE ヘッダーを削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-215">This data is returned to the client by using the `Response.BinaryWrite(data)` method, but before this is called, the `Picture` column value s OLE header must be removed.</span></span> <span data-ttu-id="8ef62-216">これを行うには `strippedImageData` という名前の `Byte` 配列を作成します。これにより、`Picture` 列の値よりも正確に78文字が保持されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-216">This is accomplished by creating a `Byte` array named `strippedImageData` that will hold precisely 78 characters less than what is in the `Picture` column.</span></span> <span data-ttu-id="8ef62-217">[`Array.Copy` メソッド](https://msdn.microsoft.com/library/z50k9bft.aspx)を使用して、78の `category.Picture` の位置から `strippedImageData`にデータをコピーします。</span><span class="sxs-lookup"><span data-stu-id="8ef62-217">The [`Array.Copy` method](https://msdn.microsoft.com/library/z50k9bft.aspx) is used to copy the data from `category.Picture` starting at position 78 over to `strippedImageData`.</span></span>

<span data-ttu-id="8ef62-218">`Response.ContentType` プロパティは、返されるコンテンツの[MIME の種類](http://en.wikipedia.org/wiki/MIME)を指定します。これにより、ブラウザーでのレンダリング方法が認識されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-218">The `Response.ContentType` property specifies the [MIME type](http://en.wikipedia.org/wiki/MIME) of the content being returned so that the browser knows how to render it.</span></span> <span data-ttu-id="8ef62-219">`Categories` table s `Picture` 列はビットマップイメージであるため、ここではビットマップ MIME タイプ (image/bmp) を使用します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-219">Since the `Categories` table s `Picture` column is a bitmap image, the bitmap MIME type is used here (image/bmp).</span></span> <span data-ttu-id="8ef62-220">MIME の種類を省略した場合でも、ほとんどのブラウザーでイメージが正しく表示されます。これは、イメージファイルのバイナリデータの内容に基づいて型を推論できるためです。</span><span class="sxs-lookup"><span data-stu-id="8ef62-220">If you omit the MIME type, most browsers will still display the image correctly because they can infer the type based on the contents of the image file s binary data.</span></span> <span data-ttu-id="8ef62-221">ただし、可能な場合は、MIME の種類を含めることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8ef62-221">However, it s prudent to include the MIME type when possible.</span></span> <span data-ttu-id="8ef62-222">[MIME メディアの種類](http://www.iana.org/assignments/media-types/)の完全な一覧については、[インターネットの割り当て番号機関 s の web サイト](http://www.iana.org/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8ef62-222">See the [Internet Assigned Numbers Authority s website](http://www.iana.org/) for a complete listing of [MIME media types](http://www.iana.org/assignments/media-types/).</span></span>

<span data-ttu-id="8ef62-223">このページを作成すると、`DisplayCategoryPicture.aspx?CategoryID=categoryID`にアクセスすることで、特定のカテゴリの画像を表示できます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-223">With this page created, a particular category s picture can be viewed by visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="8ef62-224">図11に、`DisplayCategoryPicture.aspx?CategoryID=1`から表示できる飲み物のカテゴリ s の画像を示します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-224">Figure 11 shows the Beverages category s picture, which can be viewed from `DisplayCategoryPicture.aspx?CategoryID=1`.</span></span>

<span data-ttu-id="8ef62-225">[飲料カテゴリ s の画像が表示され ![](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-225">[![The Beverages Category s Picture is Displayed](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image17.png)</span></span>

<span data-ttu-id="8ef62-226">**図 11**: 飲料カテゴリ s の画像が表示される ([クリックすると、フルサイズの画像が表示](displaying-binary-data-in-the-data-web-controls-vb/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8ef62-226">**Figure 11**: The Beverages Category s Picture is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image18.png))</span></span>

<span data-ttu-id="8ef62-227">`DisplayCategoryPicture.aspx?CategoryID=categoryID`を参照しているときに、' system.string ' 型のオブジェクトを ' system.string [] ' 型にキャストできないという例外が発生した場合は、次の2つの原因が考えられます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-227">If, when visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`, you get an exception that reads Unable to cast object of type 'System.DBNull' to type 'System.Byte[]', there are two things that may be causing this.</span></span> <span data-ttu-id="8ef62-228">まず、`Categories` table s `Picture` 列に `NULL` 値が許可されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-228">First, the `Categories` table s `Picture` column does allow `NULL` values.</span></span> <span data-ttu-id="8ef62-229">ただし、`DisplayCategoryPicture.aspx` のページでは、`NULL` 以外の値が存在することを前提としています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-229">The `DisplayCategoryPicture.aspx` page, however, assumes there is a non-`NULL` value present.</span></span> <span data-ttu-id="8ef62-230">`NULL` 値がある場合、`CategoriesDataTable` の `Picture` プロパティに直接アクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="8ef62-230">The `Picture` property of the `CategoriesDataTable` cannot be directly accessed if it has a `NULL` value.</span></span> <span data-ttu-id="8ef62-231">`Picture` 列に `NULL` 値を許可する場合は、次の条件を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-231">If you do want to allow `NULL` values for the `Picture` column, you d want to include the following condition:</span></span>

[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample7.vb)]

<span data-ttu-id="8ef62-232">上のコードでは、`Images` フォルダーに `NoPictureAvailable.gif` という名前のイメージファイルがあり、画像を使用せずに表示することを前提としています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-232">The above code assumes that there s some image file named `NoPictureAvailable.gif` in the `Images` folder that you want to display for those categories without a picture.</span></span>

<span data-ttu-id="8ef62-233">この例外は、`CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` ステートメントがメインクエリの列一覧に戻された場合にも発生する可能性があります。これは、アドホック SQL ステートメントを使用していて、TableAdapter のメインクエリに対してウィザードを再実行した場合に発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-233">This exception could also be caused if the `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement has reverted back to the main query s column list, which can happen if you are using ad-hoc SQL statements and you ve re-run the wizard for the TableAdapter s main query.</span></span> <span data-ttu-id="8ef62-234">`GetCategoryWithBinaryDataByCategoryID` メソッド s `SELECT` ステートメントに `Picture` 列が含まれていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-234">Check to ensure that `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement still includes the `Picture` column.</span></span>

> [!NOTE]
> <span data-ttu-id="8ef62-235">`DisplayCategoryPicture.aspx` にアクセスするたびに、データベースにアクセスし、指定されたカテゴリの画像データが返されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-235">Every time the `DisplayCategoryPicture.aspx` is visited, the database is accessed and the specified category s picture data is returned.</span></span> <span data-ttu-id="8ef62-236">ユーザーが最後に表示した後にカテゴリ s の画像が変更されていない場合、これは無駄な作業です。</span><span class="sxs-lookup"><span data-stu-id="8ef62-236">If the category s picture hasn't changed since the user has last viewed it, though, this is wasted effort.</span></span> <span data-ttu-id="8ef62-237">幸い、HTTP では*条件付き*のを使用できます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-237">Fortunately, HTTP allows for *conditional GETs*.</span></span> <span data-ttu-id="8ef62-238">条件付きの GET を使用すると、HTTP 要求を行うクライアントは、クライアントがこのリソースを web サーバーから最後に取得した日時を示す[`If-Modified-Since` http ヘッダー](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)に従って送信されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-238">With a conditional GET, the client making the HTTP request sends along an [`If-Modified-Since` HTTP header](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) that provides the date and time the client last retrieved this resource from the web server.</span></span> <span data-ttu-id="8ef62-239">この指定した日付以降にコンテンツが変更されていない場合、web サーバーは、変更されて[いない状態コード (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)で応答し、要求されたリソースのコンテンツを済ませる返送することができます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-239">If the content has not changed since this specified date, the web server may respond with a [Not Modified status code (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) and forgo sending back the requested resource s content.</span></span> <span data-ttu-id="8ef62-240">つまり、この方法を使用すると、クライアントが最後にアクセスした後に変更されていない場合に、web サーバーはリソースのコンテンツを再度送信する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-240">In short, this technique relieves the web server from having to send back content for a resource if it has not been modified since the client last accessed it.</span></span>

<span data-ttu-id="8ef62-241">ただし、この動作を実装するには、`Picture` 列が最後に更新されたときにキャプチャする `Categories` テーブルに `PictureLastModified` 列を追加し、`If-Modified-Since` ヘッダーをチェックするコードを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-241">To implement this behavior, however, requires that you add a `PictureLastModified` column to the `Categories` table to capture when the `Picture` column was last updated as well as code to check for the `If-Modified-Since` header.</span></span> <span data-ttu-id="8ef62-242">`If-Modified-Since` ヘッダーと条件付き取得ワークフローの詳細については、「 [RSS ハッカー向け Http 条件付き get](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) 」と「 [ASP.NET ページでの Http 要求の実行](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8ef62-242">For more information on the `If-Modified-Since` header and the conditional GET workflow, see [HTTP Conditional GET for RSS Hackers](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) and [A Deeper Look at Performing HTTP Requests in an ASP.NET Page](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span></span>

## <a name="step-4-displaying-the-category-pictures-in-a-gridview"></a><span data-ttu-id="8ef62-243">手順 4: GridView でカテゴリの画像を表示する</span><span class="sxs-lookup"><span data-stu-id="8ef62-243">Step 4: Displaying the Category Pictures in a GridView</span></span>

<span data-ttu-id="8ef62-244">これで、特定のカテゴリの画像を表示する web ページが作成されました。ここで、[画像 web コントロール](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx)または HTML `<img>` 要素を使用して、`DisplayCategoryPicture.aspx?CategoryID=categoryID`をポイントします。</span><span class="sxs-lookup"><span data-stu-id="8ef62-244">Now that we have a web page to display a particular category s picture, we can display it using the [Image Web control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) or an HTML `<img>` element pointing to `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="8ef62-245">URL がデータベースデータによって決定される画像は、イメージフィールドを使用して GridView または DetailsView に表示できます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-245">Images whose URL is determined by database data can be displayed in the GridView or DetailsView using the ImageField.</span></span> <span data-ttu-id="8ef62-246">ImageField には、ハイパーリンクフィールド s `DataNavigateUrlFields` および `DataNavigateUrlFormatString` プロパティのように機能するプロパティと `DataImageUrlFormatString` プロパティ `DataImageUrlField` が含まれています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-246">The ImageField contains `DataImageUrlField` and `DataImageUrlFormatString` properties that work like the HyperLinkField s `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties.</span></span>

<span data-ttu-id="8ef62-247">では、各カテゴリの画像を表示するために ImageField を追加することで、`DisplayOrDownloadData.aspx` の `Categories` GridView を強化します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-247">Let s augment the `Categories` GridView in `DisplayOrDownloadData.aspx` by adding an ImageField to show each category s picture.</span></span> <span data-ttu-id="8ef62-248">ImageField を追加し、その `DataImageUrlField` と `DataImageUrlFormatString` プロパティをそれぞれ `CategoryID` および `DisplayCategoryPicture.aspx?CategoryID={0}`に設定するだけです。</span><span class="sxs-lookup"><span data-stu-id="8ef62-248">Simply add the ImageField and set its `DataImageUrlField` and `DataImageUrlFormatString` properties to `CategoryID` and `DisplayCategoryPicture.aspx?CategoryID={0}`, respectively.</span></span> <span data-ttu-id="8ef62-249">これにより、`src` 属性が `DisplayCategoryPicture.aspx?CategoryID={0}`を参照する `<img>` 要素を表示する GridView 列が作成されます。ここで {0} は GridView 行 s `CategoryID` 値に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-249">This will create a GridView column that renders an `<img>` element whose `src` attribute references `DisplayCategoryPicture.aspx?CategoryID={0}`, where {0} is replaced with the GridView row s `CategoryID` value.</span></span>

![ImageField を GridView に追加する](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.gif)

<span data-ttu-id="8ef62-251">**図 12**: GridView に imagefield を追加する</span><span class="sxs-lookup"><span data-stu-id="8ef62-251">**Figure 12**: Add an ImageField to the GridView</span></span>

<span data-ttu-id="8ef62-252">ImageField を追加した後、GridView の宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-252">After adding the ImageField, your GridView s declarative syntax should look like soothe following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample8.aspx)]

<span data-ttu-id="8ef62-253">ブラウザーを使用してこのページを表示します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-253">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="8ef62-254">各レコードにカテゴリの画像が含まれるようになったことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8ef62-254">Note how each record now includes a picture for the category.</span></span>

<span data-ttu-id="8ef62-255">[各行にカテゴリ s の画像が表示さ ![](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="8ef62-255">[![The Category s Picture is Displayed for Each Row](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image19.png)</span></span>

<span data-ttu-id="8ef62-256">**図 13**: 各行にカテゴリ s の画像が表示される ([クリックすると、フルサイズの画像が表示](displaying-binary-data-in-the-data-web-controls-vb/_static/image20.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8ef62-256">**Figure 13**: The Category s Picture is Displayed for Each Row ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image20.png))</span></span>

## <a name="summary"></a><span data-ttu-id="8ef62-257">要約</span><span class="sxs-lookup"><span data-stu-id="8ef62-257">Summary</span></span>

<span data-ttu-id="8ef62-258">このチュートリアルでは、バイナリデータを表示する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-258">In this tutorial we examined how to present binary data.</span></span> <span data-ttu-id="8ef62-259">データの表示方法は、データの種類によって異なります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-259">How the data is presented depends on the type of data.</span></span> <span data-ttu-id="8ef62-260">PDF のパンフレットファイルの場合、ユーザーに [ビューのパンフレット] リンクが用意されています。このリンクをクリックすると、ユーザーが直接 PDF ファイルに表示されます。</span><span class="sxs-lookup"><span data-stu-id="8ef62-260">For the PDF brochure files, we offered the user a View Brochure link that, when clicked, took the user directly to the PDF file.</span></span> <span data-ttu-id="8ef62-261">Category s picture では、まずデータベースからバイナリデータを取得して返すページを作成し、そのページを使用して、GridView に各カテゴリの画像を表示しました。</span><span class="sxs-lookup"><span data-stu-id="8ef62-261">For the category s picture, we first created a page to retrieve and return the binary data from the database and then used that page to display each category s picture in a GridView.</span></span>

<span data-ttu-id="8ef62-262">これで、バイナリデータを表示する方法を確認できました。次は、バイナリデータを使用してデータベースに対して挿入、更新、および削除を実行する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-262">Now that we ve looked at how to display binary data, we re ready to examine how to perform insert, updates, and deletes against the database with the binary data.</span></span> <span data-ttu-id="8ef62-263">次のチュートリアルでは、アップロードしたファイルを対応するデータベースレコードに関連付ける方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-263">In the next tutorial we'll look at how to associate an uploaded file with its corresponding database record.</span></span> <span data-ttu-id="8ef62-264">その後のチュートリアルでは、既存のバイナリデータを更新する方法と、関連付けられたレコードが削除されたときにバイナリデータを削除する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-264">In the tutorial after that, we'll see how to update existing binary data as well as how to delete the binary data when its associated record is removed.</span></span>

<span data-ttu-id="8ef62-265">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="8ef62-265">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8ef62-266">作成者について</span><span class="sxs-lookup"><span data-stu-id="8ef62-266">About the Author</span></span>

<span data-ttu-id="8ef62-267">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8ef62-268">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="8ef62-268">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8ef62-269">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="8ef62-269">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8ef62-270">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8ef62-270">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8ef62-271">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="8ef62-271">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8ef62-272">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="8ef62-272">Special Thanks To</span></span>

<span data-ttu-id="8ef62-273">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="8ef62-273">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8ef62-274">このチュートリアルのリードレビュー担当者は、Teresa Murphy と Dave Gardner でした。</span><span class="sxs-lookup"><span data-stu-id="8ef62-274">Lead reviewers for this tutorial were Teresa Murphy and Dave Gardner.</span></span> <span data-ttu-id="8ef62-275">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="8ef62-275">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8ef62-276">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8ef62-276">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8ef62-277">[前へ](uploading-files-vb.md)
> [次へ](including-a-file-upload-option-when-adding-a-new-record-vb.md)</span><span class="sxs-lookup"><span data-stu-id="8ef62-277">[Previous](uploading-files-vb.md)
[Next](including-a-file-upload-option-when-adding-a-new-record-vb.md)</span></span>
