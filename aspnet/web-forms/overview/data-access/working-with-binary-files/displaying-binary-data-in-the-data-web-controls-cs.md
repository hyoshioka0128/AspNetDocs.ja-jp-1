---
uid: web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-cs
title: データ Web でのバイナリ データの表示を制御する (c#) |Microsoft Docs
author: rick-anderson
description: このチュートリアルでは、Web ページで、イメージ ファイルの表示、[ダウンロード] リンク f のプロビジョニングなどをバイナリ データを表示するオプションに注目しています.
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 5cbeb9f8-5f92-4ba8-87ae-0b4d460ae6d4
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-cs
msc.type: authoredcontent
ms.openlocfilehash: 4c5c2befd31299b0d9dedf0a3cdb9c8a65d692ec
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/06/2019
ms.locfileid: "65127156"
---
# <a name="displaying-binary-data-in-the-data-web-controls-c"></a><span data-ttu-id="7f4e7-103">データ Web コントロールにバイナリ データを表示する (C#)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-103">Displaying Binary Data in the Data Web Controls (C#)</span></span>

<span data-ttu-id="7f4e7-104">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7f4e7-105">[サンプル アプリをダウンロード](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_CS.exe)または[PDF のダウンロード](displaying-binary-data-in-the-data-web-controls-cs/_static/datatutorial55cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_CS.exe) or [Download PDF](displaying-binary-data-in-the-data-web-controls-cs/_static/datatutorial55cs1.pdf)</span></span>

> <span data-ttu-id="7f4e7-106">このチュートリアルでは、Web ページで、イメージ ファイルの表示、PDF ファイルの [ダウンロード] リンクのプロビジョニングなどをバイナリ データを表示するオプションに注目します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-106">In this tutorial we look at the options to present binary data on a Web page, including the display of an image file and the provision of a 'Download' link for a PDF file.</span></span>

## <a name="introduction"></a><span data-ttu-id="7f4e7-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="7f4e7-107">Introduction</span></span>

<span data-ttu-id="7f4e7-108">前のチュートリアルでは、アプリケーションの基になるデータ モデルをバイナリ データを関連付けるための 2 つの手法を調査を FileUpload コントロールをブラウザーから web サーバーのファイル システムにファイルをアップロードするために使用します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-108">In the preceding tutorial we explored the two techniques for associating binary data with an application s underlying data model and used the FileUpload control to upload files from a browser to the web server s file system.</span></span> <span data-ttu-id="7f4e7-109">ここにアップロードしたバイナリ データをデータ モデルに関連付ける方法を確認するには、まだきました。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-109">We ve yet to see how to associate the uploaded binary data with the data model.</span></span> <span data-ttu-id="7f4e7-110">つまり、ファイルがアップロードおよびファイル システムに保存された後、適切なデータベースのレコードにファイルへのパスを格納する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-110">That is, after a file has been uploaded and saved to the file system, a path to the file must be stored in the appropriate database record.</span></span> <span data-ttu-id="7f4e7-111">データベースで直接データが格納される場合、アップロードしたバイナリ データはファイル システムに保存できません必要がありますが、データベースに挿入する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-111">If the data is being stored directly in the database, then the uploaded binary data need not be saved to the file system, but must be injected into the database.</span></span>

<span data-ttu-id="7f4e7-112">データ モデルとデータの関連付けを見ると、前に、最初に、エンドユーザー、バイナリ データを提供する方法を見て s を使用できます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-112">Before we look at associating the data with the data model, though, let s first look at how to provide the binary data to the end user.</span></span> <span data-ttu-id="7f4e7-113">テキスト データを表示することが単純で、しかしのバイナリ データ表示方法でしょうか。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-113">Presenting text data is simple enough, but how should binary data be presented?</span></span> <span data-ttu-id="7f4e7-114">これによって異なります、もちろん、バイナリ データの種類。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-114">It depends, of course, on the type of binary data.</span></span> <span data-ttu-id="7f4e7-115">イメージの場合する可能性が高く、イメージを表示pdf で Microsoft Word 文書、ZIP ファイル、およびその他の種類のバイナリ データをダウンロード リンクを提供する方が適切です。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-115">For images, we likely want to display the image; for PDFs, Microsoft Word documents, ZIP files, and other types of binary data, providing a Download link is probably more appropriate.</span></span>

<span data-ttu-id="7f4e7-116">データを使用して、関連付けられているテキスト データと共にバイナリ データを表示する方法に注目するはこのチュートリアルでは GridView や DetailsView など Web を制御します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-116">In this tutorial we will look at how to present the binary data alongside its associated text data using data Web controls like the GridView and DetailsView.</span></span> <span data-ttu-id="7f4e7-117">次のチュートリアルで、データベースと、アップロードされたファイルの関連付けを有効にします。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-117">In the next tutorial we'll turn our attention to associating an uploaded file with the database.</span></span>

## <a name="step-1-providingbrochurepathvalues"></a><span data-ttu-id="7f4e7-118">手順 1: 提供する`BrochurePath`値</span><span class="sxs-lookup"><span data-stu-id="7f4e7-118">Step 1: Providing`BrochurePath`Values</span></span>

<span data-ttu-id="7f4e7-119">`Picture`内の列、`Categories`テーブルに既にさまざまなカテゴリの画像のバイナリ データが含まれています。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-119">The `Picture` column in the `Categories` table already contains binary data for the various category images.</span></span> <span data-ttu-id="7f4e7-120">具体的には、`Picture`レコードごとに列が粗く、低品質、16 色のビットマップ イメージのバイナリ コンテンツを保持します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-120">Specifically, the `Picture` column for each record holds the binary contents of a grainy, low-quality, 16-color bitmap image.</span></span> <span data-ttu-id="7f4e7-121">各カテゴリの画像は 172 ピクセル、幅と 120 ピクセルの高さは、し、約 11 サポート技術情報を使用します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-121">Each category image is 172 pixels wide and 120 pixels tall and consumes roughly 11 KB.</span></span> <span data-ttu-id="7f4e7-122">複数 s はどのようなバイナリ コンテンツで、`Picture`列には 78 バイトが含まれています[OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding)ヘッダーが、イメージを表示する前に削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-122">What s more, the binary content in the `Picture` column includes a 78-byte [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) header that must be stripped before displaying the image.</span></span> <span data-ttu-id="7f4e7-123">Northwind データベースは Microsoft Access でそのルートを持つために、このヘッダーの情報は存在します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-123">This header information is present because the Northwind database has its roots in Microsoft Access.</span></span> <span data-ttu-id="7f4e7-124">Access では、このヘッダーに追加する OLE オブジェクトのデータ型を使用してバイナリ データが格納されます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-124">In Access, binary data is stored using the OLE Object data type, which tacks on this header.</span></span> <span data-ttu-id="7f4e7-125">ここでは、私たちは、画像を表示するためにこれらの低品質のイメージからのヘッダーを削除する方法で表示されます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-125">For now, we'll see how to strip the headers from these low-quality images in order to display the picture.</span></span> <span data-ttu-id="7f4e7-126">今後のチュートリアルでは、s のカテゴリを更新するインターフェイスを作成します`Picture`列 OLE ヘッダーを使用して、不要な OLE ヘッダーのない同等の JPG イメージでこれらのビットマップ イメージに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-126">In a future tutorial we'll build an interface for updating a category s `Picture` column and replace these bitmap images that use OLE headers with equivalent JPG images without the unnecessary OLE headers.</span></span>

<span data-ttu-id="7f4e7-127">前のチュートリアルでは、FileUpload コントロールを使用する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-127">In the preceding tutorial we saw how to use the FileUpload control.</span></span> <span data-ttu-id="7f4e7-128">そのため、パンフレット ファイルを web サーバーのファイル システムに追加してくださいすることができます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-128">Therefore, you can go ahead and add brochure files to the web server s file system.</span></span> <span data-ttu-id="7f4e7-129">これにより、ただしは更新されません、`BrochurePath`内の列、`Categories`テーブル。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-129">Doing so, however, does not update the `BrochurePath` column in the `Categories` table.</span></span> <span data-ttu-id="7f4e7-130">次のチュートリアルでこれを実現する方法を見ていきますが、ここでは手動でこの列の値を指定します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-130">In the next tutorial we'll see how to accomplish this, but for now we need to manually provide values for this column.</span></span>

<span data-ttu-id="7f4e7-131">このチュートリアルのダウンロードで 7 つの PDF パンフレット ファイルがあります、`~/Brochures`フォルダー、シーフード以外のカテゴリのそれぞれに 1 つ。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-131">In this tutorial s download you'll find seven PDF brochure files in the `~/Brochures` folder, one for each of the categories except Seafood.</span></span> <span data-ttu-id="7f4e7-132">意図しないすべてのレコードにバイナリ データが関連付けられているシナリオを処理する方法を説明するシーフード パンフレットの追加を省略するとは。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-132">I purposefully omitted adding a Seafood brochure to illustrate how to handle scenarios where not all records have associated binary data.</span></span> <span data-ttu-id="7f4e7-133">更新する、`Categories`これらの値を持つテーブルを右クリックします、`Categories`ノード サーバー エクスプ ローラーからテーブル データの表示を選択します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-133">To update the `Categories` table with these values, right-click on the `Categories` node from Server Explorer and choose Show Table Data.</span></span> <span data-ttu-id="7f4e7-134">図 1 に示すよう、パンフレットのある各カテゴリのパンフレット ファイルへの仮想パスを入力します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-134">Then, enter the virtual paths to the brochure files for each category that has a brochure, as Figure 1 shows.</span></span> <span data-ttu-id="7f4e7-135">パンフレット シーフード カテゴリがないために、以下のままにしてその`BrochurePath`列の値として`NULL`します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-135">Since there is no brochure for the Seafood category, leave its `BrochurePath` column s value as `NULL`.</span></span>

<span data-ttu-id="7f4e7-136">[![カテゴリ表の BrochurePath 列の値を手動で入力します。](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-136">[![Manually Enter the Values for the Categories Table s BrochurePath Column](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.png)</span></span>

<span data-ttu-id="7f4e7-137">**図 1**:値を手動で入力、`Categories`テーブル s`BrochurePath`列 ([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-137">**Figure 1**: Manually Enter the Values for the `Categories` Table s `BrochurePath` Column ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.png))</span></span>

## <a name="step-2-providing-a-download-link-for-the-brochures-in-a-gridview"></a><span data-ttu-id="7f4e7-138">手順 2: GridView のパンフレットのダウンロード リンクを提供します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-138">Step 2: Providing a Download Link for the Brochures in a GridView</span></span>

<span data-ttu-id="7f4e7-139">`BrochurePath`に指定された値、`Categories`カテゴリのパンフレットのダウンロードへのリンクと共に、各カテゴリの一覧を表示する GridView を作成する準備ができたらテーブル。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-139">With the `BrochurePath` values provided for the `Categories` table, we re ready to create a GridView that lists each category along with a link to download the category s brochure.</span></span> <span data-ttu-id="7f4e7-140">手順 4. でも、カテゴリのイメージを表示するには、この GridView を拡張します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-140">In Step 4 we'll extend this GridView to also display the category s image.</span></span>

<span data-ttu-id="7f4e7-141">GridView のデザイナーには、ツールボックスからドラッグして開始、`DisplayOrDownloadData.aspx`ページで、`BinaryData`フォルダー。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-141">Start by dragging a GridView from the Toolbox onto the Designer of the `DisplayOrDownloadData.aspx` page in the `BinaryData` folder.</span></span> <span data-ttu-id="7f4e7-142">GridView s 設定`ID`に`Categories`GridView s のスマート タグを新しいデータ ソースにバインドを選択します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-142">Set the GridView s `ID` to `Categories` and through the GridView s smart tag, choose to bind it to a new data source.</span></span> <span data-ttu-id="7f4e7-143">具体的には、という名前を ObjectDataSource にバインド`CategoriesDataSource`を使用してデータを取得する、`CategoriesBLL`オブジェクト`GetCategories()`メソッド。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-143">Specifically, bind it to an ObjectDataSource named `CategoriesDataSource` that retrieves data using the `CategoriesBLL` object s `GetCategories()` method.</span></span>

<span data-ttu-id="7f4e7-144">[![CategoriesDataSource という名前の新しい ObjectDataSource を作成します。](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-144">[![Create a New ObjectDataSource Named CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.png)</span></span>

<span data-ttu-id="7f4e7-145">**図 2**:名前付き新しい ObjectDataSource 作成`CategoriesDataSource`([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-145">**Figure 2**: Create a New ObjectDataSource Named `CategoriesDataSource` ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.png))</span></span>

<span data-ttu-id="7f4e7-146">[![CategoriesBLL クラスを使用する ObjectDataSource を構成します。](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-146">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.png)</span></span>

<span data-ttu-id="7f4e7-147">**図 3**:構成に使用する ObjectDataSource、`CategoriesBLL`クラス ([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-147">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.png))</span></span>

<span data-ttu-id="7f4e7-148">[![GetCategories() メソッドを使用してカテゴリの一覧を取得します。](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-148">[![Retrieve the List of Categories Using the GetCategories() Method](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.png)</span></span>

<span data-ttu-id="7f4e7-149">**図 4**:一覧のカテゴリを使用して、取得、`GetCategories()`メソッド ([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-149">**Figure 4**: Retrieve the List of Categories Using the `GetCategories()` Method ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.png))</span></span>

<span data-ttu-id="7f4e7-150">データ ソース構成ウィザードを完了すると、Visual Studio が自動的に追加する、BoundField、`Categories`の GridView、 `CategoryID`、 `CategoryName`、 `Description`、 `NumberOfProducts`、および`BrochurePath``DataColumn`秒。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-150">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField to the `Categories` GridView for the `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` `DataColumn` s.</span></span> <span data-ttu-id="7f4e7-151">さあ、削除、`NumberOfProducts`以降 BoundField、`GetCategories()`メソッドのクエリでは、この情報は取得されません。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-151">Go ahead and remove the `NumberOfProducts` BoundField since the `GetCategories()` method s query does not retrieve this information.</span></span> <span data-ttu-id="7f4e7-152">削除も、 `CategoryID` BoundField の名前を変更し、`CategoryName`と`BrochurePath`BoundFields`HeaderText`プロパティをカテゴリやパンフレット、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-152">Also remove the `CategoryID` BoundField and rename the `CategoryName` and `BrochurePath` BoundFields `HeaderText` properties to Category and Brochure, respectively.</span></span> <span data-ttu-id="7f4e7-153">これらの変更を行った後、次のよう GridView コントロールと ObjectDataSource s 宣言型マークアップになります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-153">After making these changes, your GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample1.aspx)]

<span data-ttu-id="7f4e7-154">ブラウザーからこのページを表示 (図 5 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-154">View this page through a browser (see Figure 5).</span></span> <span data-ttu-id="7f4e7-155">8 つのカテゴリの各が一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-155">Each of the eight categories is listed.</span></span> <span data-ttu-id="7f4e7-156">7 つのカテゴリと`BrochurePath`値が、`BrochurePath`それぞれ BoundField に表示される値。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-156">The seven categories with `BrochurePath` values have the `BrochurePath` value displayed in the respective BoundField.</span></span> <span data-ttu-id="7f4e7-157">シーフードを持つ、`NULL`値その`BrochurePath`、空のセルを表示します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-157">Seafood, which has a `NULL` value for its `BrochurePath`, displays an empty cell.</span></span>

<span data-ttu-id="7f4e7-158">[![各カテゴリの名前、説明、および BrochurePath 値が一覧表示します。](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-158">[![Each Category s Name, Description, and BrochurePath Value is Listed](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.png)</span></span>

<span data-ttu-id="7f4e7-159">**図 5**:各カテゴリの名前、説明、および`BrochurePath`値が表示されます ([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-159">**Figure 5**: Each Category s Name, Description, and `BrochurePath` Value is Listed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.png))</span></span>

<span data-ttu-id="7f4e7-160">テキストを表示するのではなく、`BrochurePath`パンフレットへのリンクを作成する列。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-160">Rather than displaying the text of the `BrochurePath` column, we want to create a link to the brochure.</span></span> <span data-ttu-id="7f4e7-161">これを行うには、削除、 `BrochurePath` BoundField 内に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-161">To accomplish this, remove the `BrochurePath` BoundField and replace it with a HyperLinkField.</span></span> <span data-ttu-id="7f4e7-162">新しい内 s 設定`HeaderText`プロパティ、パンフレットをその`Text`パンフレットを表示するプロパティとその`DataNavigateUrlFields`プロパティを`BrochurePath`。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-162">Set the new HyperLinkField s `HeaderText` property to Brochure, its `Text` property to View Brochure, and its `DataNavigateUrlFields` property to `BrochurePath`.</span></span>

![BrochurePath 用内を追加します。](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.gif)

<span data-ttu-id="7f4e7-164">**図 6**:内を追加します。 `BrochurePath`</span><span class="sxs-lookup"><span data-stu-id="7f4e7-164">**Figure 6**: Add a HyperLinkField for `BrochurePath`</span></span>

<span data-ttu-id="7f4e7-165">図 7 に示すように、リンクの列を GridView これ追加されます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-165">This will add a column of links to the GridView, as Figure 7 shows.</span></span> <span data-ttu-id="7f4e7-166">ビューのパンフレットのリンクをクリックをいずれか、ブラウザーで直接、PDF を表示またはユーザー PDF reader がインストールされているかどうかによって、ファイルをダウンロードして、ブラウザーの設定を確認します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-166">Clicking a View Brochure link will either display the PDF directly in the browser or prompt the user to download the file, depending on whether a PDF reader is installed and the browser s settings.</span></span>

<span data-ttu-id="7f4e7-167">[![カテゴリの s パンフレット ビュー パンフレットのリンクをクリックして表示できます。](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-167">[![A Category s Brochure Can Be Viewed by Clicking the View Brochure Link](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.png)</span></span>

<span data-ttu-id="7f4e7-168">**図 7**:カテゴリ表示パンフレットのリンクをクリックしてパンフレットを表示できる s ([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-168">**Figure 7**: A Category s Brochure Can Be Viewed by Clicking the View Brochure Link ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.png))</span></span>

<span data-ttu-id="7f4e7-169">[![S パンフレット PDF カテゴリが表示されます。](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-169">[![The Category s Brochure PDF is Displayed](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.png)</span></span>

<span data-ttu-id="7f4e7-170">**図 8**:S パンフレット PDF カテゴリが表示されます ([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image14.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-170">**Figure 8**: The Category s Brochure PDF is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image14.png))</span></span>

## <a name="hiding-the-view-brochure-text-for-categories-without-a-brochure"></a><span data-ttu-id="7f4e7-171">パンフレットなしのカテゴリ ビュー パンフレットのテキストを非表示</span><span class="sxs-lookup"><span data-stu-id="7f4e7-171">Hiding the View Brochure Text for Categories Without a Brochure</span></span>

<span data-ttu-id="7f4e7-172">図 7 に示すよう、`BrochurePath`内に表示されます、`Text`かどうかに関係なく、すべてのレコードのプロパティの値 (パンフレットを表示) が s 以外`NULL`値`BrochurePath`。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-172">As Figure 7 shows, the `BrochurePath` HyperLinkField displays its `Text` property value ( View Brochure ) for all records, regardless of whether there s a non-`NULL` value for `BrochurePath`.</span></span> <span data-ttu-id="7f4e7-173">もちろん場合、`BrochurePath`は`NULL`、テキストのみで、リンクを表示し、シーフード カテゴリは、(バックアップは、図 7 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-173">Of course, if `BrochurePath` is `NULL`, then the link is displayed as text only, as is the case with the Seafood category (refer back to Figure 7).</span></span> <span data-ttu-id="7f4e7-174">テキスト ビュー パンフレットを表示するのではなくことがなくこれらのカテゴリを用意すると良い場合があります、`BrochurePath`値は No パンフレット利用できるように、いくつかの代替テキストを表示します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-174">Rather than displaying the text View Brochure, it might be nice to have those categories without a `BrochurePath` value display some alternate text, like No Brochure Available.</span></span>

<span data-ttu-id="7f4e7-175">この動作を提供するためにコンテンツを持つがに基づいて、適切な出力を出力するページ メソッドへの呼び出しを使用して生成されて TemplateField に必要な`BrochurePath`値。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-175">In order to provide this behavior, we need to use a TemplateField whose content is generated via a call to a page method that emits the appropriate output based on the `BrochurePath` value.</span></span> <span data-ttu-id="7f4e7-176">最初に検討しましたこの手法を書式設定に戻り、 [GridView コントロールで TemplateFields を使用して](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)チュートリアル。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-176">We first explored this formatting technique back in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) tutorial.</span></span>

<span data-ttu-id="7f4e7-177">選択して、内を TemplateField にオン、`BrochurePath`列の編集 ダイアログ ボックス内をクリック、Convert でこのフィールドを TemplateField にリンクします。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-177">Turn the HyperLinkField into a TemplateField by selecting the `BrochurePath` HyperLinkField and then clicking on the Convert this field into a TemplateField link in the Edit Columns dialog box.</span></span>

![内を TemplateField に変換します。](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.gif)

<span data-ttu-id="7f4e7-179">**図 9**:内を TemplateField に変換します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-179">**Figure 9**: Convert the HyperLinkField into a TemplateField</span></span>

<span data-ttu-id="7f4e7-180">これを TemplateField が作成されます、`ItemTemplate`ハイパーリンク Web を格納しているいるコントロール`NavigateUrl`プロパティにバインドする、`BrochurePath`値。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-180">This will create a TemplateField with an `ItemTemplate` that contains a HyperLink Web control whose `NavigateUrl` property is bound to the `BrochurePath` value.</span></span> <span data-ttu-id="7f4e7-181">このマークアップ メソッドの呼び出しを置き換えます`GenerateBrochureLink`の値を渡して、 `BrochurePath`:</span><span class="sxs-lookup"><span data-stu-id="7f4e7-181">Replace this markup with a call to the method `GenerateBrochureLink`, passing in the value of `BrochurePath`:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample2.aspx)]

<span data-ttu-id="7f4e7-182">次に、作成、`protected`メソッドは、asp.net ページという名前の分離コード クラス`GenerateBrochureLink`を返す、`string`を受け入れると、`object`入力パラメーターとして。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-182">Next, create a `protected` method in the ASP.NET page s code-behind class named `GenerateBrochureLink` that returns a `string` and accepts an `object` as an input parameter.</span></span>

[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample3.cs)]

<span data-ttu-id="7f4e7-183">場合、このメソッドが決定します、渡されたで`object`値は、データベース`NULL`し、そうである場合は、カテゴリにパンフレットがされていないことを示すメッセージを返します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-183">This method determines if the passed-in `object` value is a database `NULL` and, if so, returns a message indicating that the category lacks a brochure.</span></span> <span data-ttu-id="7f4e7-184">それ以外の場合、存在する場合、`BrochurePath`値がハイパーリンクに表示されました。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-184">Otherwise, if there is a `BrochurePath` value, it s displayed in a hyperlink.</span></span> <span data-ttu-id="7f4e7-185">されている場合、`BrochurePath`値は提示に渡される、 [ `ResolveUrl(url)`メソッド](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-185">Note that if the `BrochurePath` value is present it s passed into the [`ResolveUrl(url)` method](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span></span> <span data-ttu-id="7f4e7-186">このメソッドは、渡されたで解決*url*、置換、`~`文字と適切な仮想パス。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-186">This method resolves the passed-in *url*, replacing the `~` character with the appropriate virtual path.</span></span> <span data-ttu-id="7f4e7-187">たとえば、アプリケーションがルートに`/Tutorial55`、`ResolveUrl("~/Brochures/Meats.pdf")`戻ります`/Tutorial55/Brochures/Meat.pdf`します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-187">For example, if the application is rooted at `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` will return `/Tutorial55/Brochures/Meat.pdf`.</span></span>

<span data-ttu-id="7f4e7-188">図 10 は、これらの変更が適用された後に、ページを示します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-188">Figure 10 shows the page after these changes have been applied.</span></span> <span data-ttu-id="7f4e7-189">なおシーフード カテゴリの`BrochurePath`フィールドなしパンフレットに利用可能なテキストが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-189">Note that the Seafood category s `BrochurePath` field now displays the text No Brochure Available .</span></span>

<span data-ttu-id="7f4e7-190">[![これらのカテゴリせず、パンフレットのテキストなしパンフレット利用が表示されます。](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-190">[![The Text No Brochure Available is Displayed for Those Categories Without a Brochure](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image15.png)</span></span>

<span data-ttu-id="7f4e7-191">**図 10**:これらのカテゴリせず、パンフレットのテキストなしパンフレット利用が表示されます ([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image16.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-191">**Figure 10**: The Text No Brochure Available is Displayed for Those Categories Without a Brochure ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image16.png))</span></span>

## <a name="step-3-adding-a-web-page-to-display-a-category-s-picture"></a><span data-ttu-id="7f4e7-192">手順 3: カテゴリの画像を表示する Web ページを追加します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-192">Step 3: Adding a Web Page to Display a Category s Picture</span></span>

<span data-ttu-id="7f4e7-193">ユーザーにアクセスする ASP.NET ページ、ASP.NET ページの HTML が表示されます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-193">When a user visits an ASP.NET page, they receive the ASP.NET page s HTML.</span></span> <span data-ttu-id="7f4e7-194">受信した HTML では、テキストだけでは、し、バイナリ データが含まれていません。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-194">The received HTML is just text and does not contain any binary data.</span></span> <span data-ttu-id="7f4e7-195">画像、サウンド ファイルなど、Macromedia Flash アプリケーション、埋め込み Windows Media Player のビデオなどの追加のバイナリ データは、web サーバー上の別のリソースとして存在します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-195">Any additional binary data, such as images, sound files, Macromedia Flash applications, embedded Windows Media Player videos, and so forth, exist as separate resources on the web server.</span></span> <span data-ttu-id="7f4e7-196">HTML では、これらのファイルへの参照が含まれていますが、ファイルの実際の内容は含まれません。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-196">The HTML contains references to these files, but does not include the actual contents of the files.</span></span>

<span data-ttu-id="7f4e7-197">たとえば、html 形式で、`<img>`要素を使用して、画像の参照を`src`属性は、イメージ ファイルを指すようになります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-197">For example, in HTML the `<img>` element is used to reference a picture, with the `src` attribute pointing to the image file like so:</span></span>

[!code-html[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample4.html)]

<span data-ttu-id="7f4e7-198">ブラウザーでは、この HTML を受信すると、その後、ブラウザーで表示するイメージ ファイルのバイナリ コンテンツを取得する web サーバーに別の要求を行います。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-198">When a browser receives this HTML, it makes another request to the web server to retrieve the binary contents of the image file, which it then displays in the browser.</span></span> <span data-ttu-id="7f4e7-199">同じ概念は、任意のバイナリ データに適用されます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-199">The same concept applies to any binary data.</span></span> <span data-ttu-id="7f4e7-200">手順 2 では、パンフレットがいない s HTML マークアップをページの一部としてブラウザーに送信します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-200">In Step 2, the brochure was not sent down to the browser as part of the page s HTML markup.</span></span> <span data-ttu-id="7f4e7-201">はなく、レンダリングされる HTML 提供ハイパーリンクをクリックすると、PDF ドキュメントを直接要求するブラウザーの原因となった。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-201">Rather, the rendered HTML provided hyperlinks that, when clicked, caused the browser to request the PDF document directly.</span></span>

<span data-ttu-id="7f4e7-202">表示またはデータベース内に存在するバイナリ データをダウンロードできるように、データを返す別の web ページを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-202">To display or allow users to download binary data that resides within the database, we need to create a separate web page that returns the data.</span></span> <span data-ttu-id="7f4e7-203">このアプリケーションでは、データベース カテゴリの画像に直接格納されている、s がのみ 1 つのバイナリ データ フィールド。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-203">For our application, there s only one binary data field stored directly in the database the category s picture.</span></span> <span data-ttu-id="7f4e7-204">そのため、ページ必要がありますが、呼び出されると、特定のカテゴリの画像データを返します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-204">Therefore, we need a page that, when called, returns the image data for a particular category.</span></span>

<span data-ttu-id="7f4e7-205">新しい ASP.NET ページの追加、`BinaryData`という名前のフォルダー`DisplayCategoryPicture.aspx`します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-205">Add a new ASP.NET page to the `BinaryData` folder named `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="7f4e7-206">これを行うときに、マスター ページの選択 チェック ボックスをオフのままにします。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-206">When doing so, leave the Select master page checkbox unchecked.</span></span> <span data-ttu-id="7f4e7-207">このページが必要ですが、`CategoryID`値で、クエリ文字列とそのカテゴリ s のバイナリ データを返します。`Picture`列。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-207">This page expects a `CategoryID` value in the querystring and returns the binary data of that category s `Picture` column.</span></span> <span data-ttu-id="7f4e7-208">このページは、バイナリ データ、およびその他に何も返される、ために、HTML セクション内のマークアップに必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-208">Since this page returns binary data and nothing else, it does not need any markup in the HTML section.</span></span> <span data-ttu-id="7f4e7-209">したがって、左下隅の [ソース] タブをクリックし、ページのマークアップを除くのすべてを削除、`<%@ Page %>`ディレクティブ。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-209">Therefore, click on the Source tab in the lower left corner and remove all of the page s markup except for the `<%@ Page %>` directive.</span></span> <span data-ttu-id="7f4e7-210">つまり、 `DisplayCategoryPicture.aspx` s 宣言型マークアップする必要がありますが単一行で構成されます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-210">That is, `DisplayCategoryPicture.aspx` s declarative markup should consist of a single line:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample5.aspx)]

<span data-ttu-id="7f4e7-211">表示された場合、`MasterPageFile`属性、`<%@ Page %>`ディレクティブを削除します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-211">If you see the `MasterPageFile` attribute in the `<%@ Page %>` directive, remove it.</span></span>

<span data-ttu-id="7f4e7-212">ページ分離コード クラスで次のコードを追加、`Page_Load`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-212">In the page s code-behind class, add the following code to the `Page_Load` event handler:</span></span>

[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample6.cs)]

<span data-ttu-id="7f4e7-213">このコードの先頭で読み取ることによって、`CategoryID`という名前の変数にクエリ文字列値`categoryID`します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-213">This code starts by reading in the `CategoryID` querystring value into a variable named `categoryID`.</span></span> <span data-ttu-id="7f4e7-214">次に、呼び出しに画像データが取得、`CategoriesBLL`クラスの`GetCategoryWithBinaryDataByCategoryID(categoryID)`メソッド。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-214">Next, the picture data is retrieved via a call to the `CategoriesBLL` class s `GetCategoryWithBinaryDataByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="7f4e7-215">このデータを使用して、クライアントに返される、`Response.BinaryWrite(data)`メソッドが呼び出されると、前に、`Picture`列値の OLE ヘッダーを削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-215">This data is returned to the client by using the `Response.BinaryWrite(data)` method, but before this is called, the `Picture` column value s OLE header must be removed.</span></span> <span data-ttu-id="7f4e7-216">作成してこの情報は、`byte`という名前の配列`strippedImageData`78 正確に保持する文字があるものよりも小さいか、`Picture`列。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-216">This is accomplished by creating a `byte` array named `strippedImageData` that will hold precisely 78 characters less than what is in the `Picture` column.</span></span> <span data-ttu-id="7f4e7-217">[ `Array.Copy`メソッド](https://msdn.microsoft.com/library/z50k9bft.aspx)からデータをコピーするために使用`category.Picture`を上に位置 78 から`strippedImageData`します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-217">The [`Array.Copy` method](https://msdn.microsoft.com/library/z50k9bft.aspx) is used to copy the data from `category.Picture` starting at position 78 over to `strippedImageData`.</span></span>

<span data-ttu-id="7f4e7-218">`Response.ContentType`プロパティを指定します、 [MIME の種類](http://en.wikipedia.org/wiki/MIME)のブラウザーのレンダリング方法を認識するように返されるコンテンツ。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-218">The `Response.ContentType` property specifies the [MIME type](http://en.wikipedia.org/wiki/MIME) of the content being returned so that the browser knows how to render it.</span></span> <span data-ttu-id="7f4e7-219">以降、`Categories`テーブルの`Picture`列がビットマップ イメージ、ビットマップの MIME の種類が使用されますここ (bmp イメージ/)。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-219">Since the `Categories` table s `Picture` column is a bitmap image, the bitmap MIME type is used here (image/bmp).</span></span> <span data-ttu-id="7f4e7-220">MIME の種類を省略すると、ほとんどのブラウザーでもイメージが表示されます正しくイメージ ファイルのバイナリ データの内容に基づいて、型が推論できるためです。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-220">If you omit the MIME type, most browsers will still display the image correctly because they can infer the type based on the contents of the image file s binary data.</span></span> <span data-ttu-id="7f4e7-221">ただし、その MIME を含めるが賢明ですが可能な場合に入力します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-221">However, it s prudent to include the MIME type when possible.</span></span> <span data-ttu-id="7f4e7-222">参照してください、 [Internet Assigned Numbers Authority の web サイト](http://www.iana.org/)の完全な一覧について[MIME メディア タイプ](http://www.iana.org/assignments/media-types/)します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-222">See the [Internet Assigned Numbers Authority s website](http://www.iana.org/) for a complete listing of [MIME media types](http://www.iana.org/assignments/media-types/).</span></span>

<span data-ttu-id="7f4e7-223">参照するくださいとこのページを作成すると、特定のカテゴリの画像を表示できる`DisplayCategoryPicture.aspx?CategoryID=categoryID`します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-223">With this page created, a particular category s picture can be viewed by visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="7f4e7-224">図 11 はから表示できます、飲料カテゴリの画像`DisplayCategoryPicture.aspx?CategoryID=1`します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-224">Figure 11 shows the Beverages category s picture, which can be viewed from `DisplayCategoryPicture.aspx?CategoryID=1`.</span></span>

<span data-ttu-id="7f4e7-225">[![画像が表示されます、飲料カテゴリ s](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-225">[![The Beverages Category s Picture is Displayed](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image17.png)</span></span>

<span data-ttu-id="7f4e7-226">**図 11**:画像が表示されます、飲料カテゴリ s ([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image18.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-226">**Figure 11**: The Beverages Category s Picture is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image18.png))</span></span>

<span data-ttu-id="7f4e7-227">アクセスすると、if `DisplayCategoryPicture.aspx?CategoryID=categoryID`、"system.byte[]' を入力するには、"System.DBNull"型のオブジェクトはキャストできません。 を読み取る例外が発生した、原因と考えられるこの 2 つの点があります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-227">If, when visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`, you get an exception that reads Unable to cast object of type 'System.DBNull' to type 'System.Byte[]', there are two things that may be causing this.</span></span> <span data-ttu-id="7f4e7-228">まず、`Categories`テーブル s`Picture`列では許可`NULL`値。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-228">First, the `Categories` table s `Picture` column does allow `NULL` values.</span></span> <span data-ttu-id="7f4e7-229">`DisplayCategoryPicture.aspx`  ページで、ただし、前提としていますがない`NULL`値が存在します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-229">The `DisplayCategoryPicture.aspx` page, however, assumes there is a non-`NULL` value present.</span></span> <span data-ttu-id="7f4e7-230">`Picture`のプロパティ、`CategoriesDataTable`がある場合に直接アクセスすることはできません、`NULL`値。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-230">The `Picture` property of the `CategoriesDataTable` cannot be directly accessed if it has a `NULL` value.</span></span> <span data-ttu-id="7f4e7-231">許可する場合`NULL`の値を`Picture`d する次の条件を追加する列。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-231">If you do want to allow `NULL` values for the `Picture` column, you d want to include the following condition:</span></span>

[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample7.cs)]

<span data-ttu-id="7f4e7-232">上記のコードには、一部のイメージという名前のファイルが s が前提としています`NoPictureAvailable.gif`で、`Images`画像なしのこれらのカテゴリに対して表示するフォルダー。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-232">The above code assumes that there s some image file named `NoPictureAvailable.gif` in the `Images` folder that you want to display for those categories without a picture.</span></span>

<span data-ttu-id="7f4e7-233">場合、この例外を発生することも、 `CategoriesTableAdapter` s`GetCategoryWithBinaryDataByCategoryID`メソッドの`SELECT`アドホック SQL ステートメントを使用しているし、tableadapter のウィザードを再実行している場合に発生することがメイン クエリの列リストに戻るステートメントが元に戻るメインのクエリ。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-233">This exception could also be caused if the `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement has reverted back to the main query s column list, which can happen if you are using ad-hoc SQL statements and you ve re-run the wizard for the TableAdapter s main query.</span></span> <span data-ttu-id="7f4e7-234">いることを確認するチェック`GetCategoryWithBinaryDataByCategoryID`メソッド s`SELECT`ステートメントが含まれていますが、`Picture`列。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-234">Check to ensure that `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement still includes the `Picture` column.</span></span>

> [!NOTE]
> <span data-ttu-id="7f4e7-235">毎回、`DisplayCategoryPicture.aspx`がアクセスすると、データベースにアクセスし、指定したカテゴリの画像データが返されます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-235">Every time the `DisplayCategoryPicture.aspx` is visited, the database is accessed and the specified category s picture data is returned.</span></span> <span data-ttu-id="7f4e7-236">カテゴリの画像が、ユーザーが最後に表示するために変更されていない場合、これは無駄な努力します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-236">If the category s picture hasn't changed since the user has last viewed it, though, this is wasted effort.</span></span> <span data-ttu-id="7f4e7-237">HTTP では、さいわい、*条件付きの取得*します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-237">Fortunately, HTTP allows for *conditional GETs*.</span></span> <span data-ttu-id="7f4e7-238">条件付きの GET と HTTP 要求を行うクライアントに送信に沿って、 [ `If-Modified-Since` HTTP ヘッダー](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)クライアントは、web サーバーからこのリソースを取得する最後の日時を提供します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-238">With a conditional GET, the client making the HTTP request sends along an [`If-Modified-Since` HTTP header](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) that provides the date and time the client last retrieved this resource from the web server.</span></span> <span data-ttu-id="7f4e7-239">Web サーバーが応答がこの日付が指定されているために、コンテンツが変更されていない場合、 [Not Modified 状態コード (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)せず、要求されたリソースのコンテンツを送信するとします。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-239">If the content has not changed since this specified date, the web server may respond with a [Not Modified status code (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) and forgo sending back the requested resource s content.</span></span> <span data-ttu-id="7f4e7-240">簡単に言えば、この手法により、web サーバーが変更されていない場合、クライアントが最終アクセス後にリソースのコンテンツのバックアップに送信する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-240">In short, this technique relieves the web server from having to send back content for a resource if it has not been modified since the client last accessed it.</span></span>

<span data-ttu-id="7f4e7-241">この動作を実装するただし、追加する必要があります、`PictureLastModified`列を`Categories`ときにキャプチャするテーブル、`Picture`列が最後に更新されたコードを確認すると、`If-Modified-Since`ヘッダー。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-241">To implement this behavior, however, requires that you add a `PictureLastModified` column to the `Categories` table to capture when the `Picture` column was last updated as well as code to check for the `If-Modified-Since` header.</span></span> <span data-ttu-id="7f4e7-242">詳細については、`If-Modified-Since`ヘッダーと条件付きの GET ワークフローを参照してください。 [RSS ハッカーの条件付き GET を HTTP](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers)と[A 深く見て ASP.NET ページの HTTP 要求を実行する](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-242">For more information on the `If-Modified-Since` header and the conditional GET workflow, see [HTTP Conditional GET for RSS Hackers](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) and [A Deeper Look at Performing HTTP Requests in an ASP.NET Page](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span></span>

## <a name="step-4-displaying-the-category-pictures-in-a-gridview"></a><span data-ttu-id="7f4e7-243">手順 4: GridView のカテゴリの画像を表示します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-243">Step 4: Displaying the Category Pictures in a GridView</span></span>

<span data-ttu-id="7f4e7-244">使用して表示できる特定のカテゴリの画像を表示する web ページが作成できた、[イメージ Web コントロール](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx)または HTML`<img>`要素を指す`DisplayCategoryPicture.aspx?CategoryID=categoryID`します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-244">Now that we have a web page to display a particular category s picture, we can display it using the [Image Web control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) or an HTML `<img>` element pointing to `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="7f4e7-245">イメージの URL がデータベースのデータによって決定は、GridView、DetailsView、ImageField を使用してに表示できます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-245">Images whose URL is determined by database data can be displayed in the GridView or DetailsView using the ImageField.</span></span> <span data-ttu-id="7f4e7-246">含まれています、ImageField`DataImageUrlField`と`DataImageUrlFormatString`プロパティ内のように動作する`DataNavigateUrlFields`と`DataNavigateUrlFormatString`プロパティ。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-246">The ImageField contains `DataImageUrlField` and `DataImageUrlFormatString` properties that work like the HyperLinkField s `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties.</span></span>

<span data-ttu-id="7f4e7-247">S を強化できるように、`Categories`で GridView`DisplayOrDownloadData.aspx`各カテゴリの画像を表示する、ImageField を追加することで。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-247">Let s augment the `Categories` GridView in `DisplayOrDownloadData.aspx` by adding an ImageField to show each category s picture.</span></span> <span data-ttu-id="7f4e7-248">単に、ImageField を追加し、設定、`DataImageUrlField`と`DataImageUrlFormatString`プロパティ`CategoryID`と`DisplayCategoryPicture.aspx?CategoryID={0}`、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-248">Simply add the ImageField and set its `DataImageUrlField` and `DataImageUrlFormatString` properties to `CategoryID` and `DisplayCategoryPicture.aspx?CategoryID={0}`, respectively.</span></span> <span data-ttu-id="7f4e7-249">これを表示する GridView の列が作成されます、`<img>`要素が`src`属性参照`DisplayCategoryPicture.aspx?CategoryID={0}`ここで、{0}は GridView 行 s に置き換えられます`CategoryID`値。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-249">This will create a GridView column that renders an `<img>` element whose `src` attribute references `DisplayCategoryPicture.aspx?CategoryID={0}`, where {0} is replaced with the GridView row s `CategoryID` value.</span></span>

![GridView に、ImageField を追加します。](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.gif)

<span data-ttu-id="7f4e7-251">**図 12**:GridView に、ImageField を追加します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-251">**Figure 12**: Add an ImageField to the GridView</span></span>

<span data-ttu-id="7f4e7-252">Soothe と同様に、ImageField を追加した後、GridView s の宣言型構文になります次。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-252">After adding the ImageField, your GridView s declarative syntax should look like soothe following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample8.aspx)]

<span data-ttu-id="7f4e7-253">ブラウザーからこのページを表示する時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-253">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="7f4e7-254">各レコードが今すぐ、カテゴリの画像を含んだ方法に注意してください。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-254">Note how each record now includes a picture for the category.</span></span>

<span data-ttu-id="7f4e7-255">[![各の行のカテゴリの画像が表示されます。](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-255">[![The Category s Picture is Displayed for Each Row](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image19.png)</span></span>

<span data-ttu-id="7f4e7-256">**図 13**:各の行のカテゴリの画像が表示されます ([フルサイズの画像を表示する をクリックします](displaying-binary-data-in-the-data-web-controls-cs/_static/image20.png))。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-256">**Figure 13**: The Category s Picture is Displayed for Each Row ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image20.png))</span></span>

## <a name="summary"></a><span data-ttu-id="7f4e7-257">まとめ</span><span class="sxs-lookup"><span data-stu-id="7f4e7-257">Summary</span></span>

<span data-ttu-id="7f4e7-258">このチュートリアルでは、バイナリ データを表示する方法について確認しました。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-258">In this tutorial we examined how to present binary data.</span></span> <span data-ttu-id="7f4e7-259">データを表示する方法は、データの種類によって異なります。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-259">How the data is presented depends on the type of data.</span></span> <span data-ttu-id="7f4e7-260">PDF パンフレット ファイルで、提供したは、ユーザー ビュー パンフレット リンクをクリックすると、PDF ファイルに直接ユーザーをかかりました。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-260">For the PDF brochure files, we offered the user a View Brochure link that, when clicked, took the user directly to the PDF file.</span></span> <span data-ttu-id="7f4e7-261">カテゴリの画像、私たちを取得して、データベースからバイナリ データを返すページを最初に作成されたおり、そのページを使用して GridView に各カテゴリの画像を表示します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-261">For the category s picture, we first created a page to retrieve and return the binary data from the database and then used that page to display each category s picture in a GridView.</span></span>

<span data-ttu-id="7f4e7-262">これまできましたが挿入、更新、およびバイナリ データをデータベースに対して削除を実行する方法を確認する準備ができたら、バイナリ データを表示する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-262">Now that we ve looked at how to display binary data, we re ready to examine how to perform insert, updates, and deletes against the database with the binary data.</span></span> <span data-ttu-id="7f4e7-263">次のチュートリアルでは、アップロードされたファイルを対応するデータベース レコードに関連付ける方法を紹介します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-263">In the next tutorial we'll look at how to associate an uploaded file with its corresponding database record.</span></span> <span data-ttu-id="7f4e7-264">チュートリアルでは、その後、既存のバイナリ データを更新する方法と、関連付けられているレコードが削除されると、バイナリ データを削除する方法を見ていきます。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-264">In the tutorial after that, we'll see how to update existing binary data as well as how to delete the binary data when its associated record is removed.</span></span>

<span data-ttu-id="7f4e7-265">満足のプログラミングです。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-265">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="7f4e7-266">執筆者紹介</span><span class="sxs-lookup"><span data-stu-id="7f4e7-266">About the Author</span></span>

<span data-ttu-id="7f4e7-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックおよびの創設者の著者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、Microsoft Web テクノロジと 1998 年から携わっています。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7f4e7-268">Scott は、フリーのコンサルタント、トレーナー、およびライターとして動作します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-268">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7f4e7-269">最新の著書は[ *Sams 教える自分で ASP.NET 2.0 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-269">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7f4e7-270">彼に到達できる[mitchell@4GuysFromRolla.comします。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-270">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="7f4e7-271">彼のブログにあるでまたは[ http://ScottOnWriting.NET](http://ScottOnWriting.NET)します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-271">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7f4e7-272">特別なに感謝します。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-272">Special Thanks To</span></span>

<span data-ttu-id="7f4e7-273">このチュートリアル シリーズは、多くの便利なレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-273">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7f4e7-274">このチュートリアルでは、潜在顧客レビュー担当者は、Teresa Murphy、Dave gardner 著でした。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-274">Lead reviewers for this tutorial were Teresa Murphy and Dave Gardner.</span></span> <span data-ttu-id="7f4e7-275">今後、MSDN の記事を確認したいですか。</span><span class="sxs-lookup"><span data-stu-id="7f4e7-275">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7f4e7-276">場合は、筆者に[mitchell@4GuysFromRolla.comします。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-276">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7f4e7-277">[前へ](uploading-files-cs.md)
> [次へ](including-a-file-upload-option-when-adding-a-new-record-cs.md)</span><span class="sxs-lookup"><span data-stu-id="7f4e7-277">[Previous](uploading-files-cs.md)
[Next](including-a-file-upload-option-when-adding-a-new-record-cs.md)</span></span>
