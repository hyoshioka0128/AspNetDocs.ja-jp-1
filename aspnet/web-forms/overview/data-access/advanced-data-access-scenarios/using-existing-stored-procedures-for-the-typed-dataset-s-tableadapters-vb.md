---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
title: 型指定されたデータセットの Tableadapter に既存のストアドプロシージャを使用する (VB) |Microsoft Docs
author: rick-anderson
description: 前のチュートリアルでは、TableAdapter ウィザードを使用して新しいストアドプロシージャを生成する方法を学習しました。 このチュートリアルでは、同じ TableAdapter について説明します。
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 2da25f6a-757e-4e7b-a812-1575288d8f7a
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
msc.type: authoredcontent
ms.openlocfilehash: e35c3d6a98516a07f6119e6cb9dbeb99bc28fe33
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74613575"
---
# <a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-vb"></a><span data-ttu-id="7397c-104">型指定された DataSet の TableAdapters に既存のストアド プロシージャを使用する (VB)</span><span class="sxs-lookup"><span data-stu-id="7397c-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (VB)</span></span>

<span data-ttu-id="7397c-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7397c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7397c-106">[コードのダウンロード](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip)または[PDF のダウンロード](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7397c-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span></span>

> <span data-ttu-id="7397c-107">前のチュートリアルでは、TableAdapter ウィザードを使用して新しいストアドプロシージャを生成する方法を学習しました。</span><span class="sxs-lookup"><span data-stu-id="7397c-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="7397c-108">このチュートリアルでは、既存のストアドプロシージャで同じ TableAdapter ウィザードを使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="7397c-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="7397c-109">また、データベースに新しいストアドプロシージャを手動で追加する方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="7397c-109">We also learn how to manually add new stored procedures to our database.</span></span>

## <a name="introduction"></a><span data-ttu-id="7397c-110">はじめに</span><span class="sxs-lookup"><span data-stu-id="7397c-110">Introduction</span></span>

<span data-ttu-id="7397c-111">前の[チュートリアル](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)では、アドホック SQL ステートメントではなく、ストアドプロシージャを使用してデータにアクセスするように、型指定されたデータセットの tableadapter を構成する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="7397c-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="7397c-112">特に、TableAdapter ウィザードでこれらのストアドプロシージャを自動的に作成する方法を調べました。</span><span class="sxs-lookup"><span data-stu-id="7397c-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="7397c-113">レガシアプリケーションを ASP.NET 2.0 に移植する場合、または既存のデータモデルに対して ASP.NET 2.0 web サイトを構築する場合は、必要なストアドプロシージャがデータベースに既に含まれている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7397c-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="7397c-114">または、手動で、またはストアドプロシージャを自動生成する TableAdapter ウィザード以外の何らかのツールを使用して、ストアドプロシージャを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="7397c-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="7397c-115">このチュートリアルでは、既存のストアドプロシージャを使用するように TableAdapter を構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="7397c-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="7397c-116">Northwind データベースには、いくつかの組み込みストアドプロシージャが含まれているだけであるため、Visual Studio 環境を使用してデータベースに新しいストアドプロシージャを手動で追加するために必要な手順についても説明します。</span><span class="sxs-lookup"><span data-stu-id="7397c-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="7397c-117">始めましょう!</span><span class="sxs-lookup"><span data-stu-id="7397c-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="7397c-118">「[トランザクション内でのデータベース変更のラッピング](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)」チュートリアルでは、トランザクション (`BeginTransaction`、`CommitTransaction`など) をサポートするメソッドを TableAdapter に追加しました。</span><span class="sxs-lookup"><span data-stu-id="7397c-118">In the [Wrapping Database Modifications within a Transaction](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="7397c-119">また、トランザクションをストアドプロシージャ内で完全に管理することもできます。この場合、データアクセスレイヤーコードを変更する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7397c-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="7397c-120">このチュートリアルでは、トランザクションのスコープ内でストアドプロシージャ s ステートメントを実行するために使用される T-sql コマンドについて説明します。</span><span class="sxs-lookup"><span data-stu-id="7397c-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>

## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="7397c-121">手順 1: Northwind データベースへのストアドプロシージャの追加</span><span class="sxs-lookup"><span data-stu-id="7397c-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="7397c-122">Visual Studio を使用すると、データベースに新しいストアドプロシージャを簡単に追加できます。</span><span class="sxs-lookup"><span data-stu-id="7397c-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="7397c-123">「」では、Northwind データベースに新しいストアドプロシージャを追加します。これにより、特定の `CategoryID` 値を持つ列の `Products` テーブルからすべての列が返されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="7397c-124">[サーバーエクスプローラー] ウィンドウで Northwind データベースを展開し、そのフォルダー (データベースダイアグラム、テーブル、ビューなど) が表示されるようにします。</span><span class="sxs-lookup"><span data-stu-id="7397c-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="7397c-125">前のチュートリアルで見たように、[ストアドプロシージャ] フォルダーには、データベースの既存のストアドプロシージャが含まれています。</span><span class="sxs-lookup"><span data-stu-id="7397c-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="7397c-126">新しいストアドプロシージャを追加するには、[ストアドプロシージャ] フォルダーを右クリックし、ショートカットメニューの [新しいストアドプロシージャの追加] オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="7397c-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>

<span data-ttu-id="7397c-127">[![[ストアドプロシージャ] フォルダーを右クリックし、新しいストアドプロシージャを追加します。](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span></span>

<span data-ttu-id="7397c-128">**図 1**: [ストアドプロシージャ] フォルダーを右クリックして新しいストアドプロシージャを追加[する (クリックすると、フルサイズの画像が表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="7397c-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png))</span></span>

<span data-ttu-id="7397c-129">図1に示すように、[新しいストアドプロシージャの追加] オプションを選択すると、Visual Studio のスクリプトウィンドウが開き、ストアドプロシージャの作成に必要な SQL スクリプトのアウトラインが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="7397c-130">このスクリプトを具体化して実行します。この時点で、ストアドプロシージャがデータベースに追加されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="7397c-131">次のスクリプトを入力します。</span><span class="sxs-lookup"><span data-stu-id="7397c-131">Enter the following script:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample1.sql)]

<span data-ttu-id="7397c-132">このスクリプトを実行すると、`Products_SelectByCategoryID`という名前の Northwind データベースに新しいストアドプロシージャが追加されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="7397c-133">このストアドプロシージャは、1つの入力パラメーター (`int`型の`@CategoryID`) を受け取り、一致する `CategoryID` 値を持つこれらの製品のすべてのフィールドを返します。</span><span class="sxs-lookup"><span data-stu-id="7397c-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="7397c-134">この `CREATE PROCEDURE` スクリプトを実行してストアドプロシージャをデータベースに追加するには、ツールバーの [保存] アイコンをクリックするか、Ctrl + S キーを押します。</span><span class="sxs-lookup"><span data-stu-id="7397c-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="7397c-135">この操作を実行すると、ストアドプロシージャフォルダーが更新され、新しく作成されたストアドプロシージャが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="7397c-136">また、ウィンドウのスクリプトによって、はらみが `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` から `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`に変更されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="7397c-137">`CREATE PROCEDURE` によってデータベースに新しいストアドプロシージャが追加され、`ALTER PROCEDURE` は既存のプロシージャを更新します。</span><span class="sxs-lookup"><span data-stu-id="7397c-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="7397c-138">スクリプトの開始が `ALTER PROCEDURE`に変更されたため、ストアドプロシージャの入力パラメーターまたは SQL ステートメントを変更し、[保存] アイコンをクリックすると、ストアドプロシージャが変更されて更新されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="7397c-139">図2は、`Products_SelectByCategoryID` ストアドプロシージャが保存された後の Visual Studio を示しています。</span><span class="sxs-lookup"><span data-stu-id="7397c-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>

<span data-ttu-id="7397c-140">[ストアドプロシージャ Products_SelectByCategoryID がデータベースに追加された ![](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span></span>

<span data-ttu-id="7397c-141">**図 2**: ストアドプロシージャ `Products_SelectByCategoryID` がデータベースに追加されました ([クリックしてフルサイズの画像を表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7397c-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span></span>

## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="7397c-142">手順 2: 既存のストアドプロシージャを使用するように TableAdapter を構成する</span><span class="sxs-lookup"><span data-stu-id="7397c-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="7397c-143">`Products_SelectByCategoryID` ストアドプロシージャがデータベースに追加されたので、メソッドのいずれかが呼び出されたときに、このストアドプロシージャを使用するようにデータアクセス層を構成できます。</span><span class="sxs-lookup"><span data-stu-id="7397c-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can configure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="7397c-144">特に、先ほど作成した `Products_SelectByCategoryID` ストアドプロシージャを呼び出す `NorthwindWithSprocs` 型指定されたデータセットの `ProductsTableAdapter` に `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` メソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="7397c-144">In particular, we will add a `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="7397c-145">まず、`NorthwindWithSprocs` データセットを開きます。</span><span class="sxs-lookup"><span data-stu-id="7397c-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="7397c-146">`ProductsTableAdapter` を右クリックし、[クエリの追加] を選択して、TableAdapter クエリの構成ウィザードを起動します。</span><span class="sxs-lookup"><span data-stu-id="7397c-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="7397c-147">前の[チュートリアル](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)では、TableAdapter で新しいストアドプロシージャを作成することを選択しました。</span><span class="sxs-lookup"><span data-stu-id="7397c-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="7397c-148">ただし、このチュートリアルでは、新しい TableAdapter メソッドを既存の `Products_SelectByCategoryID` ストアドプロシージャに接続する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7397c-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="7397c-149">そのため、ウィザードの最初の手順で [既存のストアドプロシージャを使用する] オプションを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="7397c-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>

<span data-ttu-id="7397c-150">[![[既存のストアドプロシージャを使用する] オプションを選択する](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span></span>

<span data-ttu-id="7397c-151">**図 3**: [既存のストアドプロシージャを使用する] オプションを選択[する (クリックすると、フルサイズの画像が表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png)されます)</span><span class="sxs-lookup"><span data-stu-id="7397c-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span></span>

<span data-ttu-id="7397c-152">次の画面には、データベースのストアドプロシージャを含むドロップダウンリストが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="7397c-153">ストアドプロシージャを選択すると、左側に入力パラメーターが、右側に返されるデータフィールド (存在する場合) が一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="7397c-154">一覧から `Products_SelectByCategoryID` ストアドプロシージャを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="7397c-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>

<span data-ttu-id="7397c-155">[Products_SelectByCategoryID ストアドプロシージャを選択 ![には](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span></span>

<span data-ttu-id="7397c-156">**図 4**: `Products_SelectByCategoryID` ストアドプロシージャを選択[する (クリックすると、フルサイズの画像が表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="7397c-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span></span>

<span data-ttu-id="7397c-157">次の画面では、ストアドプロシージャによって返されるデータの種類を確認します。この回答では、TableAdapter のメソッドによって返される型を決定します。</span><span class="sxs-lookup"><span data-stu-id="7397c-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="7397c-158">たとえば、表形式のデータが返されることを示す場合、メソッドは、ストアドプロシージャによって返されたレコードを格納する `ProductsDataTable` インスタンスを返します。</span><span class="sxs-lookup"><span data-stu-id="7397c-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="7397c-159">これに対して、このストアドプロシージャが1つの値を返すことを示す場合、TableAdapter は、ストアドプロシージャによって返される最初のレコードの最初の列の値が割り当てられた `Object` を返します。</span><span class="sxs-lookup"><span data-stu-id="7397c-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `Object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="7397c-160">`Products_SelectByCategoryID` ストアドプロシージャは、特定のカテゴリに属するすべての製品を返します。そのため、最初の回答の表形式データを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="7397c-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>

<span data-ttu-id="7397c-161">[ストアドプロシージャが表形式データを返すことを示す ![](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span></span>

<span data-ttu-id="7397c-162">**図 5**: ストアドプロシージャが表形式データを返すことを示します ([クリックすると、フルサイズの画像が表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="7397c-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span></span>

<span data-ttu-id="7397c-163">残っているのは、使用するメソッドパターン、およびこれらのメソッドの名前を示すことだけです。</span><span class="sxs-lookup"><span data-stu-id="7397c-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="7397c-164">[DataTable にデータを格納し、DataTable オプションを返す] の両方をオンのままにします。ただし、メソッドの名前を `FillByCategoryID` と `GetProductsByCategoryID`に変更します。</span><span class="sxs-lookup"><span data-stu-id="7397c-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="7397c-165">次に、[次へ] をクリックして、ウィザードが実行するタスクの概要を確認します。</span><span class="sxs-lookup"><span data-stu-id="7397c-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="7397c-166">すべてが正しい場合は、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="7397c-166">If everything looks correct, click Finish.</span></span>

<span data-ttu-id="7397c-167">[メソッドに FillByCategoryID と Get製品 Bycategoryid の ![名前を指定します。](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span></span>

<span data-ttu-id="7397c-168">**図 6**: メソッドに `FillByCategoryID` と `GetProductsByCategoryID` の名前を指定[する (クリックすると、フルサイズの画像が表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="7397c-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="7397c-169">先ほど作成した TableAdapter メソッド `FillByCategoryID` と `GetProductsByCategoryID`では、`Integer`型の入力パラメーターを想定しています。</span><span class="sxs-lookup"><span data-stu-id="7397c-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `Integer`.</span></span> <span data-ttu-id="7397c-170">この入力パラメーター値は、`@CategoryID` パラメーターを使用してストアドプロシージャに渡されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="7397c-171">ストアドプロシージャの `Products_SelectByCategory` パラメーターを変更する場合は、これらの TableAdapter メソッドのパラメーターも更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7397c-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="7397c-172">[前のチュートリアル](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)で説明したように、これは、パラメーターコレクションのパラメーターを手動で追加または削除するか、TableAdapter ウィザードを再実行することによって、次の2つの方法のいずれかで行うことができます。</span><span class="sxs-lookup"><span data-stu-id="7397c-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>

## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="7397c-173">手順 3: BLL に`GetProductsByCategoryID(categoryID)`メソッドを追加する</span><span class="sxs-lookup"><span data-stu-id="7397c-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="7397c-174">`GetProductsByCategoryID` DAL メソッドが完了したら、次の手順として、ビジネスロジック層でこのメソッドへのアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="7397c-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="7397c-175">`ProductsBLLWithSprocs` クラスファイルを開き、次のメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="7397c-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>

[!code-vb[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample2.vb)]

<span data-ttu-id="7397c-176">この BLL メソッドは、`ProductsTableAdapter` s `GetProductsByCategoryID` メソッドから返された `ProductsDataTable` を返します。</span><span class="sxs-lookup"><span data-stu-id="7397c-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="7397c-177">`DataObjectMethodAttribute` 属性は、ObjectDataSource s データソース構成ウィザードによって使用されるメタデータを提供します。</span><span class="sxs-lookup"><span data-stu-id="7397c-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="7397c-178">特に、このメソッドは [タブ s の選択] ドロップダウンリストに表示されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="7397c-179">手順 4: カテゴリ別の製品の表示</span><span class="sxs-lookup"><span data-stu-id="7397c-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="7397c-180">新しく追加された `Products_SelectByCategoryID` ストアドプロシージャ、および対応する DAL および BLL メソッドをテストするには、DropDownList と GridView を含む ASP.NET ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="7397c-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="7397c-181">DropDownList には、選択したカテゴリに属する製品が GridView に表示されますが、データベース内のすべてのカテゴリが一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="7397c-182">前のチュートリアルでは、DropDownLists を使用してマスター/詳細インターフェイスを作成しました。</span><span class="sxs-lookup"><span data-stu-id="7397c-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="7397c-183">このようなマスター/詳細レポートの実装の詳細については、「DropDownList チュートリアルを[使用したマスター/詳細のフィルタリング](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7397c-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) tutorial.</span></span>

<span data-ttu-id="7397c-184">`AdvancedDAL` フォルダーの [`ExistingSprocs.aspx`] ページを開き、[ツールボックス] から [DropDownList] をデザイナーにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="7397c-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="7397c-185">DropDownList s `ID` プロパティを `Categories` に設定し、その `AutoPostBack` プロパティを `True`に設定します。</span><span class="sxs-lookup"><span data-stu-id="7397c-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `True`.</span></span> <span data-ttu-id="7397c-186">次に、スマートタグから、DropDownList を `CategoriesDataSource`という名前の新しい ObjectDataSource にバインドします。</span><span class="sxs-lookup"><span data-stu-id="7397c-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="7397c-187">`CategoriesBLL` クラス s `GetCategories` メソッドからデータを取得するように ObjectDataSource を構成します。</span><span class="sxs-lookup"><span data-stu-id="7397c-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="7397c-188">[更新]、[挿入]、[削除] の各タブのドロップダウンリストを [(なし)] に設定します。</span><span class="sxs-lookup"><span data-stu-id="7397c-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="7397c-189">[カテゴリ Bll クラス s GetCategories メソッドからデータを取得 ![には](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span></span>

<span data-ttu-id="7397c-190">**図 7**: `CategoriesBLL` クラス s `GetCategories` メソッドからデータ[を取得する (クリックすると、フルサイズの画像が表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png)されます)</span><span class="sxs-lookup"><span data-stu-id="7397c-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span></span>

<span data-ttu-id="7397c-191">[[更新]、[挿入]、[削除] の各タブのドロップダウンリストを [(なし)] に設定 ![ます。](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span></span>

<span data-ttu-id="7397c-192">**図 8**: [更新]、[挿入]、[削除] の各タブのドロップダウンリストを (なし) に設定する ([クリックしてフルサイズの画像を表示する](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="7397c-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span></span>

<span data-ttu-id="7397c-193">ObjectDataSource ウィザードが完了したら、[`CategoryName` データ] フィールドを表示し、各 `ListItem`の `Value` として [`CategoryID`] フィールドを使用するように DropDownList を構成します。</span><span class="sxs-lookup"><span data-stu-id="7397c-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="7397c-194">この時点で、DropDownList および ObjectDataSource の宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="7397c-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>

[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample3.aspx)]

<span data-ttu-id="7397c-195">次に、GridView をデザイナーにドラッグして、DropDownList の下に配置します。</span><span class="sxs-lookup"><span data-stu-id="7397c-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="7397c-196">GridView の `ID` を `ProductsByCategory` に設定し、そのスマートタグから `ProductsByCategoryDataSource`という名前の新しい ObjectDataSource にバインドします。</span><span class="sxs-lookup"><span data-stu-id="7397c-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="7397c-197">`ProductsBLLWithSprocs` クラスを使用するように `ProductsByCategoryDataSource` ObjectDataSource を構成し、`GetProductsByCategoryID(categoryID)` メソッドを使用してそのデータを取得します。</span><span class="sxs-lookup"><span data-stu-id="7397c-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="7397c-198">この GridView はデータの表示にのみ使用されるため、[更新]、[挿入]、[削除] の各タブのドロップダウンリストを (なし) に設定し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="7397c-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>

<span data-ttu-id="7397c-199">[製品 Bllwithsproc クラスを使用するように ObjectDataSource を構成 ![には](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span></span>

<span data-ttu-id="7397c-200">**図 9**: `ProductsBLLWithSprocs` クラスを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="7397c-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span></span>

<span data-ttu-id="7397c-201">[Get$ Bycategoryid (categoryID) メソッドからデータを取得 ![には](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span></span>

<span data-ttu-id="7397c-202">**図 10**: `GetProductsByCategoryID(categoryID)` メソッドからデータ[を取得する (クリックすると、フルサイズの画像が表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png)されます)</span><span class="sxs-lookup"><span data-stu-id="7397c-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span></span>

<span data-ttu-id="7397c-203">[選択] タブで選択したメソッドはパラメーターを必要とするため、ウィザードの最後の手順によって、パラメーター s のソースが要求されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="7397c-204">[パラメーターソース] ドロップダウンリストを [制御] に設定し、[ControlID] ドロップダウンリストから `Categories` コントロールを選択します。</span><span class="sxs-lookup"><span data-stu-id="7397c-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="7397c-205">[完了] をクリックしてウィザードを終了します。</span><span class="sxs-lookup"><span data-stu-id="7397c-205">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="7397c-206">[categoryID パラメーターのソースとして [カテゴリ] を使用 ![](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span></span>

<span data-ttu-id="7397c-207">**図 11**: `Categories` DropDownList を `categoryID` パラメーターのソースとして使用する ([クリックしてフルサイズのイメージを表示する](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="7397c-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span></span>

<span data-ttu-id="7397c-208">ObjectDataSource ウィザードを完了すると、Visual Studio によって、各製品データフィールドに対して BoundFields と CheckBoxField が追加されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="7397c-209">これらのフィールドは、必要に応じて自由にカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="7397c-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="7397c-210">ブラウザーを使用してページにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="7397c-210">Visit the page through a browser.</span></span> <span data-ttu-id="7397c-211">ページにアクセスすると、飲み物カテゴリが選択され、対応する製品がグリッドに表示されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="7397c-212">図12に示すように、ドロップダウンリストを別のカテゴリに変更すると、ポストバックが発生し、グリッドが新しく選択されたカテゴリの製品と共に再読み込みされます。</span><span class="sxs-lookup"><span data-stu-id="7397c-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>

<span data-ttu-id="7397c-213">[[生成] カテゴリの製品 ![表示されます。](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span></span>

<span data-ttu-id="7397c-214">**図 12**: [生成] カテゴリの製品が表示される ([クリックすると、フルサイズの画像が表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png)されます)</span><span class="sxs-lookup"><span data-stu-id="7397c-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span></span>

## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="7397c-215">手順 5: トランザクションのスコープ内でストアドプロシージャ s ステートメントをラップする</span><span class="sxs-lookup"><span data-stu-id="7397c-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="7397c-216">「[トランザクション内でのデータベース変更のラップ](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md)」チュートリアルでは、トランザクションのスコープ内で一連のデータベース変更ステートメントを実行する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="7397c-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="7397c-217">トランザクションの全体で実行された変更はすべて成功するか、すべて失敗し、原子性が保証されることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="7397c-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="7397c-218">トランザクションを使用する方法は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="7397c-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="7397c-219">`System.Transactions` 名前空間のクラスを使用すると、</span><span class="sxs-lookup"><span data-stu-id="7397c-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="7397c-220">データアクセス層では、`SqlTransaction`のような ADO.NET クラスを使用します。</span><span class="sxs-lookup"><span data-stu-id="7397c-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="7397c-221">ストアドプロシージャ内に直接 T-sql トランザクションコマンドを追加する</span><span class="sxs-lookup"><span data-stu-id="7397c-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="7397c-222">「*トランザクション内でのデータベース変更のラッピング*」チュートリアルでは、DAL の ADO.NET クラスを使用しています。</span><span class="sxs-lookup"><span data-stu-id="7397c-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="7397c-223">このチュートリアルの残りの部分では、ストアドプロシージャ内から T-sql コマンドを使用してトランザクションを管理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="7397c-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="7397c-224">トランザクションを手動で開始、コミット、およびロールバックするための3つの主要な SQL コマンドは、それぞれ `BEGIN TRANSACTION`、`COMMIT TRANSACTION`、および `ROLLBACK TRANSACTION`です。</span><span class="sxs-lookup"><span data-stu-id="7397c-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="7397c-225">ADO.NET アプローチと同様に、ストアドプロシージャ内からトランザクションを使用する場合は、次のパターンを適用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7397c-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="7397c-226">トランザクションの開始を示します。</span><span class="sxs-lookup"><span data-stu-id="7397c-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="7397c-227">トランザクションを構成する SQL ステートメントを実行します。</span><span class="sxs-lookup"><span data-stu-id="7397c-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="7397c-228">手順 2. のステートメントのいずれかでエラーが発生した場合は、トランザクションをロールバックします。</span><span class="sxs-lookup"><span data-stu-id="7397c-228">If there is an error in any one of the statements from Step 2, rollback the transaction.</span></span>
4. <span data-ttu-id="7397c-229">手順 2. のすべてのステートメントがエラーなしで完了した場合は、トランザクションをコミットします。</span><span class="sxs-lookup"><span data-stu-id="7397c-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="7397c-230">このパターンは、次のテンプレートを使用して T-sql 構文で実装できます。</span><span class="sxs-lookup"><span data-stu-id="7397c-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample4.sql)]

<span data-ttu-id="7397c-231">このテンプレートは、`TRY...CATCH` ブロックを定義することによって開始されます。これは SQL Server 2005 の新しいコンストラクトです。</span><span class="sxs-lookup"><span data-stu-id="7397c-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="7397c-232">Visual Basic の `Try...Catch` ブロックと同様に、SQL `TRY...CATCH` ブロックは `TRY` ブロック内のステートメントを実行します。</span><span class="sxs-lookup"><span data-stu-id="7397c-232">Like with `Try...Catch` blocks in Visual Basic, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="7397c-233">いずれかのステートメントでエラーが発生した場合、コントロールは直ちに `CATCH` ブロックに転送されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="7397c-234">トランザクションを記述する SQL ステートメントの実行中にエラーが発生しなかった場合は、`COMMIT TRANSACTION` ステートメントによって変更がコミットされ、トランザクションが完了します。</span><span class="sxs-lookup"><span data-stu-id="7397c-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="7397c-235">ただし、いずれかのステートメントでエラーが発生した場合、`CATCH` ブロック内の `ROLLBACK TRANSACTION` は、トランザクションが開始される前の状態にデータベースを返します。</span><span class="sxs-lookup"><span data-stu-id="7397c-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="7397c-236">また、このストアドプロシージャは[RAISERROR コマンド](https://msdn.microsoft.com/library/ms178592.aspx)を使用してエラーを生成します。これにより、アプリケーションで `SqlException` が発生します。</span><span class="sxs-lookup"><span data-stu-id="7397c-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="7397c-237">`TRY...CATCH` ブロックは SQL Server 2005 の新機能であるため、以前のバージョンの Microsoft SQL Server を使用している場合、上記のテンプレートは機能しません。</span><span class="sxs-lookup"><span data-stu-id="7397c-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="7397c-238">SQL Server 2005 を使用していない場合は、他のバージョンの SQL Server で動作するテンプレートについては、「 [SQL Server ストアドプロシージャのトランザクションの管理」](http://www.4guysfromrolla.com/webtech/080305-1.shtml)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7397c-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>

<span data-ttu-id="7397c-239">具体的な例を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="7397c-239">Let s look at a concrete example.</span></span> <span data-ttu-id="7397c-240">`Categories` テーブルと `Products` テーブルの間には外部キー制約が存在します。つまり、`Products` テーブル内の各 `CategoryID` フィールドは `CategoryID` テーブルの `Categories` 値にマップされる必要があります。</span><span class="sxs-lookup"><span data-stu-id="7397c-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="7397c-241">この制約に違反するアクション (製品が関連付けられているカテゴリを削除しようとするなど) があると、外部キー制約違反になります。</span><span class="sxs-lookup"><span data-stu-id="7397c-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="7397c-242">これを確認するには、「バイナリデータの処理」セクション (`~/BinaryData/UpdatingAndDeleting.aspx`) の「既存のバイナリデータの更新と削除」の例を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7397c-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="7397c-243">このページには、システム内の各カテゴリが [編集] ボタンと [削除] ボタンと共に一覧表示されます (図13を参照)。ただし、飲み物など、関連付けられた製品を含むカテゴリを削除しようとすると、外部キー制約違反が原因で削除が失敗します (図14を参照)。</span><span class="sxs-lookup"><span data-stu-id="7397c-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>

<span data-ttu-id="7397c-244">[[編集] ボタンと [削除] ボタンを使用して各カテゴリを GridView に表示 ![](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span></span>

<span data-ttu-id="7397c-245">**図 13**: 各カテゴリが GridView に編集および削除ボタン付きで表示される ([クリックしてフルサイズのイメージを表示する](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="7397c-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span></span>

<span data-ttu-id="7397c-246">[既存の製品を含むカテゴリを削除することはできません ![](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="7397c-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span></span>

<span data-ttu-id="7397c-247">**図 14**: 既存の製品を持つカテゴリを削除することはできません ([クリックすると、フルサイズの画像が表示](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png)されます)</span><span class="sxs-lookup"><span data-stu-id="7397c-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span></span>

<span data-ttu-id="7397c-248">ただし、関連付けられている製品があるかどうかにかかわらず、カテゴリを削除できるようにすることを想像してください。</span><span class="sxs-lookup"><span data-stu-id="7397c-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="7397c-249">製品のカテゴリを削除する必要がある場合は、既存の製品も削除するとします (別の方法としては、単に製品 `CategoryID` 値を `NULL`に設定します)。</span><span class="sxs-lookup"><span data-stu-id="7397c-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="7397c-250">この機能は、foreign key 制約の cascade ルールを使用して実装できます。</span><span class="sxs-lookup"><span data-stu-id="7397c-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="7397c-251">または、`@CategoryID` 入力パラメーターを受け取るストアドプロシージャを作成し、呼び出されたときに、関連付けられているすべての製品と指定したカテゴリを明示的に削除することもできます。</span><span class="sxs-lookup"><span data-stu-id="7397c-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="7397c-252">このようなストアドプロシージャでの最初の試行は、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="7397c-252">Our first attempt at such a stored procedure might look like the following:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample5.sql)]

<span data-ttu-id="7397c-253">これによって、関連付けられている製品とカテゴリが確実に削除されますが、トランザクションの包括状態では削除されません。</span><span class="sxs-lookup"><span data-stu-id="7397c-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="7397c-254">`Categories` に、特定の `@CategoryID` 値の削除を禁止する外部キー制約があると仮定します。</span><span class="sxs-lookup"><span data-stu-id="7397c-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="7397c-255">問題は、このような場合に、カテゴリを削除しようとする前にすべての製品が削除されることです。</span><span class="sxs-lookup"><span data-stu-id="7397c-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="7397c-256">結果として、このようなカテゴリの場合、このストアドプロシージャは、他のテーブル内に関連レコードが残っているので、カテゴリのすべての製品を削除します。</span><span class="sxs-lookup"><span data-stu-id="7397c-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="7397c-257">ただし、ストアドプロシージャがトランザクションのスコープ内でラップされていた場合、`Categories`で削除が失敗したときに、`Products` テーブルの削除がロールバックされます。</span><span class="sxs-lookup"><span data-stu-id="7397c-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="7397c-258">次のストアドプロシージャスクリプトでは、トランザクションを使用して、2つの `DELETE` ステートメント間で原子性を確保します。</span><span class="sxs-lookup"><span data-stu-id="7397c-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample6.sql)]

<span data-ttu-id="7397c-259">`Categories_Delete` ストアドプロシージャを Northwind データベースに追加してみましょう。</span><span class="sxs-lookup"><span data-stu-id="7397c-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="7397c-260">ストアドプロシージャをデータベースに追加する手順については、手順1を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7397c-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="7397c-261">手順 6:`CategoriesTableAdapter` の更新</span><span class="sxs-lookup"><span data-stu-id="7397c-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="7397c-262">`Categories_Delete` ストアドプロシージャをデータベースに追加しましたが、現在、DAL は、アドホック SQL ステートメントを使用して削除を実行するように構成されています。</span><span class="sxs-lookup"><span data-stu-id="7397c-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="7397c-263">`CategoriesTableAdapter` を更新し、代わりに `Categories_Delete` ストアドプロシージャを使用するように指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7397c-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="7397c-264">このチュートリアルの前半では、`NorthwindWithSprocs` データセットを使用しました。</span><span class="sxs-lookup"><span data-stu-id="7397c-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="7397c-265">ただし、そのデータセットにはエンティティが1つだけ存在し、`ProductsDataTable`、カテゴリを操作する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7397c-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="7397c-266">そのため、このチュートリアルの残りの部分では、`Northwind` データセットを参照するデータアクセス層について説明します。これは、[データアクセス層の作成](../introduction/creating-a-data-access-layer-vb.md)に関するチュートリアルで最初に作成したものです。</span><span class="sxs-lookup"><span data-stu-id="7397c-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial.</span></span>

<span data-ttu-id="7397c-267">Northwind データセットを開き、`CategoriesTableAdapter`を選択して、プロパティウィンドウにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="7397c-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="7397c-268">プロパティウィンドウには、TableAdapter によって使用される `InsertCommand`、`UpdateCommand`、`DeleteCommand`、`SelectCommand` と、その名前と接続情報が表示されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="7397c-269">詳細を表示するには、[`DeleteCommand`] プロパティを展開します。</span><span class="sxs-lookup"><span data-stu-id="7397c-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="7397c-270">図15に示すように、`DeleteCommand` s `CommandType` プロパティは Text に設定されています。これは、`CommandText` プロパティのテキストをアドホック SQL クエリとして送信するように指示します。</span><span class="sxs-lookup"><span data-stu-id="7397c-270">As Figure 15 shows, the `DeleteCommand` s `CommandType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>

![デザイナーで CategoriesTableAdapter を選択すると、[プロパティ] ウィンドウにそのプロパティが表示されます。](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image43.png)

<span data-ttu-id="7397c-272">**図 15**: デザイナーで `CategoriesTableAdapter` を選択すると、[プロパティ] ウィンドウにそのプロパティが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>

<span data-ttu-id="7397c-273">これらの設定を変更するには、プロパティウィンドウで (DeleteCommand) のテキストを選択し、ドロップダウンリストから [(新規)] を選択します。</span><span class="sxs-lookup"><span data-stu-id="7397c-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="7397c-274">これにより、`CommandText`、`CommandType`、および `Parameters` の各プロパティの設定がクリアされます。</span><span class="sxs-lookup"><span data-stu-id="7397c-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="7397c-275">次に、[`CommandType`] プロパティを `StoredProcedure` に設定し、`CommandText` のストアドプロシージャの名前 (`dbo.Categories_Delete`) を入力します。</span><span class="sxs-lookup"><span data-stu-id="7397c-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="7397c-276">この順序でプロパティが入力されていることを確認した場合は、まず `CommandType` を入力し、次に `CommandText` をクリックすると、パラメーターコレクションが自動的に設定されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="7397c-277">これらのプロパティをこの順序で入力しない場合は、parameters コレクションエディターを使用して手動でパラメーターを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7397c-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="7397c-278">どちらの場合も、parameters プロパティの省略記号をクリックしてパラメーターコレクションエディターを表示し、正しいパラメーター設定が変更されていることを確認することをお勧めします (図16を参照)。</span><span class="sxs-lookup"><span data-stu-id="7397c-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="7397c-279">ダイアログボックスにパラメーターが表示されない場合は、`@CategoryID` パラメーターを手動で追加します (`@RETURN_VALUE` パラメーターを追加する必要はありません)。</span><span class="sxs-lookup"><span data-stu-id="7397c-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>

![パラメーター設定が正しいことを確認してください](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image44.png)

<span data-ttu-id="7397c-281">**図 16**: パラメーターの設定が正しいことを確認する</span><span class="sxs-lookup"><span data-stu-id="7397c-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>

<span data-ttu-id="7397c-282">DAL が更新されると、カテゴリを削除すると、そのカテゴリに関連付けられているすべての製品が自動的に削除され、トランザクションの包括的なものになります。</span><span class="sxs-lookup"><span data-stu-id="7397c-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="7397c-283">これを確認するには、[既存のバイナリデータの更新と削除] ページに戻り、いずれかのカテゴリの [削除] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="7397c-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="7397c-284">マウスを1回クリックするだけで、カテゴリとそれに関連付けられているすべての製品が削除されます。</span><span class="sxs-lookup"><span data-stu-id="7397c-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="7397c-285">選択したカテゴリと一緒に複数の製品を削除する `Categories_Delete` ストアドプロシージャをテストする前に、データベースのバックアップコピーを作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="7397c-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="7397c-286">`App_Data`で `NORTHWND.MDF` データベースを使用している場合は、単に Visual Studio を閉じ、`App_Data` 内の MDF ファイルと LDF ファイルを他のフォルダーにコピーします。</span><span class="sxs-lookup"><span data-stu-id="7397c-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="7397c-287">機能のテスト後、データベースを復元するには、Visual Studio を終了し、`App_Data` 内の現在の MDF ファイルと LDF ファイルをバックアップコピーに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="7397c-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>

## <a name="summary"></a><span data-ttu-id="7397c-288">要約</span><span class="sxs-lookup"><span data-stu-id="7397c-288">Summary</span></span>

<span data-ttu-id="7397c-289">TableAdapter ウィザードによって自動的にストアドプロシージャが生成されますが、そのようなストアドプロシージャが既に作成されている場合や、手動で作成したり、他のツールを使用したりする場合もあります。</span><span class="sxs-lookup"><span data-stu-id="7397c-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="7397c-290">このようなシナリオに対応するために、既存のストアドプロシージャを参照するように TableAdapter を構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="7397c-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="7397c-291">このチュートリアルでは、Visual Studio 環境を使用してデータベースにストアドプロシージャを手動で追加する方法と、TableAdapter のメソッドをこれらのストアドプロシージャに接続する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="7397c-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="7397c-292">また、ストアドプロシージャ内からのトランザクションの開始、コミット、およびロールバックに使用される T-sql コマンドとスクリプトパターンについても説明します。</span><span class="sxs-lookup"><span data-stu-id="7397c-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="7397c-293">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="7397c-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="7397c-294">作成者について</span><span class="sxs-lookup"><span data-stu-id="7397c-294">About the Author</span></span>

<span data-ttu-id="7397c-295">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="7397c-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7397c-296">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="7397c-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7397c-297">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="7397c-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7397c-298">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7397c-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="7397c-299">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="7397c-299">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7397c-300">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="7397c-300">Special Thanks To</span></span>

<span data-ttu-id="7397c-301">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="7397c-301">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7397c-302">このチュートリアルのリードレビュー担当者は、Hilton Geisenow、S ren Jacob Lauritsen、Teresa Murphy でした。</span><span class="sxs-lookup"><span data-stu-id="7397c-302">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="7397c-303">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="7397c-303">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7397c-304">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7397c-304">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7397c-305">[前へ](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
> [次へ](updating-the-tableadapter-to-use-joins-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7397c-305">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
[Next](updating-the-tableadapter-to-use-joins-vb.md)</span></span>
