---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/updating-the-tableadapter-to-use-joins-vb
title: 結合を使用するように TableAdapter を更新する (VB) |Microsoft Docs
author: rick-anderson
description: データベースを使用する場合は、複数のテーブルに分散されているデータを要求するのが一般的です。 2つの異なるテーブルからデータを取得するには、次のいずれかの方法を使用します。
ms.author: riande
ms.date: 07/18/2007
ms.assetid: e624a3e0-061b-4efc-8b0e-5877f9ff6714
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/updating-the-tableadapter-to-use-joins-vb
msc.type: authoredcontent
ms.openlocfilehash: 5c94baa99b126cdd24d69afc3d02bfe8b069419b
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78427528"
---
# <a name="updating-the-tableadapter-to-use-joins-vb"></a><span data-ttu-id="9fb95-104">JOIN を使用するように TableAdapter を更新する (VB)</span><span class="sxs-lookup"><span data-stu-id="9fb95-104">Updating the TableAdapter to Use JOINs (VB)</span></span>

<span data-ttu-id="9fb95-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9fb95-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9fb95-106">[コードのダウンロード](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_69_VB.zip)または[PDF のダウンロード](updating-the-tableadapter-to-use-joins-vb/_static/datatutorial69vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9fb95-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_69_VB.zip) or [Download PDF](updating-the-tableadapter-to-use-joins-vb/_static/datatutorial69vb1.pdf)</span></span>

> <span data-ttu-id="9fb95-107">データベースを使用する場合は、複数のテーブルに分散されているデータを要求するのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="9fb95-107">When working with a database it is common to request data that is spread across multiple tables.</span></span> <span data-ttu-id="9fb95-108">2つの異なるテーブルからデータを取得するには、相関サブクエリまたは結合操作のいずれかを使用できます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-108">To retrieve data from two different tables we can use either a correlated subquery or a JOIN operation.</span></span> <span data-ttu-id="9fb95-109">このチュートリアルでは、メインクエリに結合を含む TableAdapter を作成する方法を確認する前に、相関サブクエリと結合構文を比較します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-109">In this tutorial we compare correlated subqueries and the JOIN syntax before looking at how to create a TableAdapter that includes a JOIN in its main query.</span></span>

## <a name="introduction"></a><span data-ttu-id="9fb95-110">はじめに</span><span class="sxs-lookup"><span data-stu-id="9fb95-110">Introduction</span></span>

<span data-ttu-id="9fb95-111">リレーショナルデータベースでは、多くの場合、使用するデータは複数のテーブルに分散されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-111">With relational databases the data we are interested in working with is often spread across multiple tables.</span></span> <span data-ttu-id="9fb95-112">たとえば、製品情報を表示する場合、各製品に対応するカテゴリと仕入先の名前を一覧表示することが考えられます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-112">For example, when displaying product information we likely want to list each product s corresponding category and supplier s names.</span></span> <span data-ttu-id="9fb95-113">`Products` テーブルには値 `CategoryID` と `SupplierID` がありますが、実際のカテゴリと仕入先の名前はそれぞれ `Categories` テーブルと `Suppliers` テーブルにあります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-113">The `Products` table has `CategoryID` and `SupplierID` values, but the actual category and supplier names are in the `Categories` and `Suppliers` tables, respectively.</span></span>

<span data-ttu-id="9fb95-114">関連する別のテーブルから情報を取得するには、*相関サブクエリ*また*は `JOIN`を*使用できます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-114">To retrieve information from another, related table, we can either use *correlated subqueries* or `JOIN`*s*.</span></span> <span data-ttu-id="9fb95-115">相関サブクエリは、入れ子になった `SELECT` クエリで、外側のクエリの列を参照します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-115">A correlated subquery is a nested `SELECT` query that references columns in the outer query.</span></span> <span data-ttu-id="9fb95-116">たとえば、[データアクセス層の作成](../introduction/creating-a-data-access-layer-vb.md)に関するチュートリアルでは、`ProductsTableAdapter` s メインクエリで2つの相関サブクエリを使用して、各製品のカテゴリ名と仕入先名を返しました。</span><span class="sxs-lookup"><span data-stu-id="9fb95-116">For example, in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial we used two correlated subqueries in the `ProductsTableAdapter` s main query to return the category and supplier names for each product.</span></span> <span data-ttu-id="9fb95-117">`JOIN` は、2つの異なるテーブルの関連する行をマージする SQL コンストラクトです。</span><span class="sxs-lookup"><span data-stu-id="9fb95-117">A `JOIN` is a SQL construct that merges related rows from two different tables.</span></span> <span data-ttu-id="9fb95-118">ここでは、 [SqlDataSource コントロール](../accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-vb.md)チュートリアルを使用してデータにクエリを実行し、各製品と共にカテゴリ情報を表示する方法について `JOIN` 説明します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-118">We used a `JOIN` in the [Querying Data with the SqlDataSource Control](../accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-vb.md) tutorial to display category information alongside each product.</span></span>

<span data-ttu-id="9fb95-119">Tableadapter で `JOIN` s を使用しない理由は、TableAdapter s ウィザードの制限により、対応する `INSERT`、`UPDATE`、および `DELETE` ステートメントが自動生成されるためです。</span><span class="sxs-lookup"><span data-stu-id="9fb95-119">The reason we have abstained from using `JOIN` s with the TableAdapters is because of limitations in the TableAdapter s wizard to auto-generate corresponding `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="9fb95-120">具体的には、TableAdapter のメインクエリに `JOIN` が含まれている場合、TableAdapter では、`InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティに対してアドホック SQL ステートメントまたはストアドプロシージャを自動作成することはできません。</span><span class="sxs-lookup"><span data-stu-id="9fb95-120">More specifically, if the TableAdapter s main query contains any `JOIN` s, the TableAdapter cannot auto-create the ad-hoc SQL statements or stored procedures for its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties.</span></span>

<span data-ttu-id="9fb95-121">このチュートリアルでは、メインクエリに `JOIN` を含む TableAdapter を作成する方法を確認する前に、相関サブクエリと `JOIN` s を簡単に比較対照します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-121">In this tutorial we will briefly compare and contrast correlated subqueries and `JOIN` s before exploring how to create a TableAdapter that includes `JOIN` s in its main query.</span></span>

## <a name="comparing-and-contrasting-correlated-subqueries-andjoin-s"></a><span data-ttu-id="9fb95-122">相関サブクエリと`JOIN` の比較と比較</span><span class="sxs-lookup"><span data-stu-id="9fb95-122">Comparing and Contrasting Correlated Subqueries and`JOIN` s</span></span>

<span data-ttu-id="9fb95-123">`Northwind` データセットの最初のチュートリアルで作成した `ProductsTableAdapter` は、相関サブクエリを使用して、各製品に対応するカテゴリおよび仕入先名を返します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-123">Recall that the `ProductsTableAdapter` created in the first tutorial in the `Northwind` DataSet uses correlated subqueries to bring back each product s corresponding category and supplier name.</span></span> <span data-ttu-id="9fb95-124">`ProductsTableAdapter` s メインクエリを以下に示します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-124">The `ProductsTableAdapter` s main query is shown below.</span></span>

[!code-sql[Main](updating-the-tableadapter-to-use-joins-vb/samples/sample1.sql)]

<span data-ttu-id="9fb95-125">2つの相関サブクエリ (`(SELECT CategoryName FROM Categories WHERE Categories.CategoryID = Products.CategoryID)` と `(SELECT CompanyName FROM Suppliers WHERE Suppliers.SupplierID = Products.SupplierID)`) は、製品ごとに1つの値を外部 `SELECT` ステートメントの列リストに追加の列として返す `SELECT` クエリです。</span><span class="sxs-lookup"><span data-stu-id="9fb95-125">The two correlated subqueries - `(SELECT CategoryName FROM Categories WHERE Categories.CategoryID = Products.CategoryID)` and `(SELECT CompanyName FROM Suppliers WHERE Suppliers.SupplierID = Products.SupplierID)` - are `SELECT` queries that return a single value per product as an additional column in the outer `SELECT` statement s column list.</span></span>

<span data-ttu-id="9fb95-126">または、`JOIN` を使用して、各製品の仕入先とカテゴリ名を返すこともできます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-126">Alternatively, a `JOIN` can be used to return each product s supplier and category name.</span></span> <span data-ttu-id="9fb95-127">次のクエリでは、上の例と同じ出力が返されますが、サブクエリの代わりに `JOIN` s が使用されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-127">The following query returns the same output as the above one, but uses `JOIN` s in place of subqueries:</span></span>

[!code-sql[Main](updating-the-tableadapter-to-use-joins-vb/samples/sample2.sql)]

<span data-ttu-id="9fb95-128">`JOIN` は、特定の条件に基づいて、あるテーブルのレコードを別のテーブルのレコードとマージします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-128">A `JOIN` merges the records from one table with records from another table based on some criteria.</span></span> <span data-ttu-id="9fb95-129">上記のクエリでは、たとえば、`LEFT JOIN Categories ON Categories.CategoryID = Products.CategoryID` は、各製品レコードを、`CategoryID` 値が製品 s `CategoryID` 値と一致するカテゴリレコードとマージするように SQL Server に指示します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-129">In the above query, for example, the `LEFT JOIN Categories ON Categories.CategoryID = Products.CategoryID` instructs SQL Server to merge each product record with the category record whose `CategoryID` value matches the product s `CategoryID` value.</span></span> <span data-ttu-id="9fb95-130">マージされた結果を使用すると、各製品の対応するカテゴリフィールド (`CategoryName`など) を操作できます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-130">The merged result allows us to work with the corresponding category fields for each product (such as `CategoryName`).</span></span>

> [!NOTE]
> <span data-ttu-id="9fb95-131">`JOIN` は、リレーショナルデータベースからデータを照会するときによく使用されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-131">`JOIN` s are commonly used when querying data from relational databases.</span></span> <span data-ttu-id="9fb95-132">`JOIN` 構文を初めて使用する場合、または使用方法について少しの話をする必要がある場合は、「 [W3](http://www.w3schools.com/)」で[SQL Join のチュートリアル](http://www.w3schools.com/sql/sql_join.asp)をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-132">If you are new to the `JOIN` syntax or need to brush up a bit on its usage, I d recommend the [SQL Join tutorial](http://www.w3schools.com/sql/sql_join.asp) at [W3 Schools](http://www.w3schools.com/).</span></span> <span data-ttu-id="9fb95-133">また、 [SQL オンラインブック](https://msdn.microsoft.com/library/ms130214.aspx)の「 [`JOIN` の基礎](https://msdn.microsoft.com/library/ms191517.aspx)」および「[サブクエリの基礎](https://msdn.microsoft.com/library/ms189575.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9fb95-133">Also worth reading are the [`JOIN` Fundamentals](https://msdn.microsoft.com/library/ms191517.aspx) and [Subquery Fundamentals](https://msdn.microsoft.com/library/ms189575.aspx) sections of the [SQL Books Online](https://msdn.microsoft.com/library/ms130214.aspx).</span></span>

<span data-ttu-id="9fb95-134">`JOIN` s と相関サブクエリは両方とも、他のテーブルから関連データを取得するために使用できます。そのため、多くの開発者は、頭の初歩を残し、使用する方法を知ります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-134">Since `JOIN` s and correlated subqueries can both be used to retrieve related data from other tables, many developers are left scratching their heads and wondering which approach to use.</span></span> <span data-ttu-id="9fb95-135">これまでに説明したすべての SQL 中心は、ほぼ同じようにパフォーマンスを向上させることができます。これは、ほぼ同一の実行プランを生成 SQL Server という点ではありません。</span><span class="sxs-lookup"><span data-stu-id="9fb95-135">All of the SQL gurus I ve talked to have said roughly the same thing, that it doesn t really matter performance-wise as SQL Server will produce roughly identical execution plans.</span></span> <span data-ttu-id="9fb95-136">そのようなアドバイスは、お客様とチームが最も使いやすい手法を使用することです。</span><span class="sxs-lookup"><span data-stu-id="9fb95-136">Their advice, then, is to use the technique that you and your team are most comfortable with.</span></span> <span data-ttu-id="9fb95-137">この助言を分離した後、これらの専門家は、相関サブクエリで `JOIN` s の設定をすぐに表していることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="9fb95-137">It merits noting that after imparting this advice these experts immediately express their preference of `JOIN` s over correlated subqueries.</span></span>

<span data-ttu-id="9fb95-138">型指定されたデータセットを使用してデータアクセス層を構築する場合、サブクエリを使用すると、ツールの動作が向上します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-138">When building a Data Access Layer using Typed DataSets, the tools work better when using subqueries.</span></span> <span data-ttu-id="9fb95-139">特に、TableAdapter s ウィザードでは、メインクエリに `JOIN` が含まれている場合に、対応する `INSERT`、`UPDATE`、および `DELETE` ステートメントが自動生成されませんが、相関サブクエリを使用すると、これらのステートメントが自動生成されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-139">In particular, the TableAdapter s wizard will not auto-generate corresponding `INSERT`, `UPDATE`, and `DELETE` statements if the main query contains any `JOIN` s, but will auto-generate these statements when correlated subqueries are used.</span></span>

<span data-ttu-id="9fb95-140">この欠点を調べるには、`~/App_Code/DAL` フォルダーに一時的に型指定されたデータセットを作成します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-140">To explore this shortcoming, create a temporary Typed DataSet in the `~/App_Code/DAL` folder.</span></span> <span data-ttu-id="9fb95-141">TableAdapter 構成ウィザードで、アドホック SQL ステートメントを使用することを選択し、次の `SELECT` クエリを入力します (図1を参照)。</span><span class="sxs-lookup"><span data-stu-id="9fb95-141">During the TableAdapter Configuration wizard, choose to use ad-hoc SQL statements and enter the following `SELECT` query (see Figure 1):</span></span>

[!code-sql[Main](updating-the-tableadapter-to-use-joins-vb/samples/sample3.sql)]

<span data-ttu-id="9fb95-142">[結合を含むメインクエリを入力 ![には](updating-the-tableadapter-to-use-joins-vb/_static/image2.png)](updating-the-tableadapter-to-use-joins-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-142">[![Enter a Main Query that Contains JOINs](updating-the-tableadapter-to-use-joins-vb/_static/image2.png)](updating-the-tableadapter-to-use-joins-vb/_static/image1.png)</span></span>

<span data-ttu-id="9fb95-143">**図 1**: `JOIN` s を含むメインクエリを入力[する (クリックすると、フルサイズの画像が表示](updating-the-tableadapter-to-use-joins-vb/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9fb95-143">**Figure 1**: Enter a Main Query that Contains `JOIN` s ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image3.png))</span></span>

<span data-ttu-id="9fb95-144">既定では、TableAdapter は、メインクエリに基づいて、`INSERT`、`UPDATE`、および `DELETE` ステートメントを自動的に作成します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-144">By default, the TableAdapter will automatically create `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="9fb95-145">[詳細設定] ボタンをクリックすると、この機能が有効になっていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-145">If you click the Advanced button you can see that this feature is enabled.</span></span> <span data-ttu-id="9fb95-146">この設定にかかわらず、`INSERT`、`UPDATE`、および `DELETE` の各ステートメントは、メインクエリに `JOIN`が含まれているため、TableAdapter で作成することはできません。</span><span class="sxs-lookup"><span data-stu-id="9fb95-146">Despite this setting, the TableAdapter will not be able to create the `INSERT`, `UPDATE`, and `DELETE` statements because the main query contains a `JOIN`.</span></span>

![結合を含むメインクエリを入力します](updating-the-tableadapter-to-use-joins-vb/_static/image4.png)

<span data-ttu-id="9fb95-148">**図 2**: `JOIN` s を含むメインクエリを入力する</span><span class="sxs-lookup"><span data-stu-id="9fb95-148">**Figure 2**: Enter a Main Query that Contains `JOIN` s</span></span>

<span data-ttu-id="9fb95-149">[完了] をクリックしてウィザードを終了します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-149">Click Finish to complete the wizard.</span></span> <span data-ttu-id="9fb95-150">この時点で、データセットのデザイナーには、`SELECT` クエリ s 列リストに返される各フィールドの列を含む DataTable を含む単一の TableAdapter が含まれます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-150">At this point your DataSet s Designer will include a single TableAdapter with a DataTable with columns for each of the fields returned in the `SELECT` query s column list.</span></span> <span data-ttu-id="9fb95-151">これには、図3に示すように、`CategoryName` と `SupplierName`が含まれます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-151">This includes the `CategoryName` and `SupplierName`, as Figure 3 shows.</span></span>

![DataTable には、列リストで返される各フィールドの列が含まれます。](updating-the-tableadapter-to-use-joins-vb/_static/image5.png)

<span data-ttu-id="9fb95-153">**図 3**: DataTable には、列リストで返された各フィールドの列が含まれている</span><span class="sxs-lookup"><span data-stu-id="9fb95-153">**Figure 3**: The DataTable Includes a Column for Each Field Returned in the Column List</span></span>

<span data-ttu-id="9fb95-154">DataTable には適切な列が含まれていますが、TableAdapter には `InsertCommand`、`UpdateCommand`、および `DeleteCommand` プロパティの値がありません。</span><span class="sxs-lookup"><span data-stu-id="9fb95-154">While the DataTable has the appropriate columns, the TableAdapter lacks values for its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties.</span></span> <span data-ttu-id="9fb95-155">これを確認するには、デザイナーで TableAdapter をクリックし、プロパティウィンドウにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-155">To confirm this, click on the TableAdapter in the Designer and then go to the Properties window.</span></span> <span data-ttu-id="9fb95-156">`InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティが [(なし)] に設定されていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-156">There you will see that the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties are set to (None) .</span></span>

<span data-ttu-id="9fb95-157">[InsertCommand、UpdateCommand、および DeleteCommand プロパティが (None) に設定されて ![](updating-the-tableadapter-to-use-joins-vb/_static/image7.png)](updating-the-tableadapter-to-use-joins-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-157">[![The InsertCommand, UpdateCommand, and DeleteCommand Properties are Set to (None)](updating-the-tableadapter-to-use-joins-vb/_static/image7.png)](updating-the-tableadapter-to-use-joins-vb/_static/image6.png)</span></span>

<span data-ttu-id="9fb95-158">**図 4**: `InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティが (なし) に設定されている ([クリックしてフルサイズの画像を表示する](updating-the-tableadapter-to-use-joins-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="9fb95-158">**Figure 4**: The `InsertCommand`, `UpdateCommand`, and `DeleteCommand` Properties are Set to (None) ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image8.png))</span></span>

<span data-ttu-id="9fb95-159">この欠点を回避するには、プロパティウィンドウを使用して、`InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティの SQL ステートメントとパラメーターを手動で指定します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-159">To work around this shortcoming, we can manually provide the SQL statements and parameters for the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties via the Properties window.</span></span> <span data-ttu-id="9fb95-160">または、`JOIN` s を含ま*ない*ように TableAdapter のメインクエリを構成して開始することもできます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-160">Alternatively, we could start by configuring the TableAdapter s main query to *not* include any `JOIN` s.</span></span> <span data-ttu-id="9fb95-161">これにより、`INSERT`、`UPDATE`、および `DELETE` ステートメントが自動的に生成されるようになります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-161">This will allow the `INSERT`, `UPDATE`, and `DELETE` statements to be auto-generated for us.</span></span> <span data-ttu-id="9fb95-162">ウィザードが完了したら、プロパティウィンドウから TableAdapter の `SelectCommand` を手動で更新して、`JOIN` 構文を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-162">After completing the wizard, we could then manually update the TableAdapter s `SelectCommand` from the Properties window so that it includes the `JOIN` syntax.</span></span>

<span data-ttu-id="9fb95-163">この方法は機能しますが、アドホック SQL クエリを使用する場合は非常に脆弱です。これは、ウィザードを使用して TableAdapter のメインクエリを再構成するたびに、自動生成された `INSERT`、`UPDATE`、および `DELETE` ステートメントが再作成されるためです。</span><span class="sxs-lookup"><span data-stu-id="9fb95-163">While this approach works, it is very brittle when using ad-hoc SQL queries because any time the TableAdapter s main query is re-configured through the wizard, the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements are recreated.</span></span> <span data-ttu-id="9fb95-164">これは、TableAdapter を右クリックし、コンテキストメニューから [構成] を選択して、ウィザードを再度完了すると、後で行ったすべてのカスタマイズが失われることを意味します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-164">That means all of the customizations we later made would be lost if we right-clicked on the TableAdapter, chose Configure from the context menu, and completed the wizard again.</span></span>

<span data-ttu-id="9fb95-165">TableAdapter の自動生成された `INSERT`、`UPDATE`、および `DELETE` ステートメントの高まるは、さいわい、アドホック SQL ステートメントに限定されています。</span><span class="sxs-lookup"><span data-stu-id="9fb95-165">The brittleness of the TableAdapter s auto-generated `INSERT`, `UPDATE`, and `DELETE` statements is, fortunately, limited to ad-hoc SQL statements.</span></span> <span data-ttu-id="9fb95-166">TableAdapter でストアドプロシージャが使用されている場合は、ストアドプロシージャが変更される心配をせずに、`SelectCommand`、`InsertCommand`、`UpdateCommand`、または `DeleteCommand` ストアドプロシージャをカスタマイズし、TableAdapter 構成ウィザードを再実行することができます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-166">If your TableAdapter uses stored procedures, you can customize the `SelectCommand`, `InsertCommand`, `UpdateCommand`, or `DeleteCommand` stored procedures and re-run the TableAdapter Configuration wizard without having to fear that the stored procedures will be modified.</span></span>

<span data-ttu-id="9fb95-167">次のいくつかの手順では、最初に、対応する挿入、更新、および削除の各ストアドプロシージャが自動生成されるように `JOIN` を省略するメインクエリを使用する TableAdapter を作成します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-167">Over the next several steps we will create a TableAdapter that, initially, uses a main query that omits any `JOIN` s so that the corresponding insert, update, and delete stored procedures will be auto-generated.</span></span> <span data-ttu-id="9fb95-168">次に、関連テーブルから追加の列を返す `JOIN` が使用されるように、`SelectCommand` を更新します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-168">We will then update the `SelectCommand` so that uses a `JOIN` that returns additional columns from related tables.</span></span> <span data-ttu-id="9fb95-169">最後に、対応するビジネスロジックレイヤークラスを作成し、ASP.NET web ページで TableAdapter を使用する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-169">Finally, we'll create a corresponding Business Logic Layer class and demonstrate using the TableAdapter in an ASP.NET web page.</span></span>

## <a name="step-1-creating-the-tableadapter-using-a-simplified-main-query"></a><span data-ttu-id="9fb95-170">手順 1: 簡略化されたメインクエリを使用して TableAdapter を作成する</span><span class="sxs-lookup"><span data-stu-id="9fb95-170">Step 1: Creating the TableAdapter Using a Simplified Main Query</span></span>

<span data-ttu-id="9fb95-171">このチュートリアルでは、`NorthwindWithSprocs` データセットの `Employees` テーブルに TableAdapter と厳密に型指定された DataTable を追加します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-171">For this tutorial we will add a TableAdapter and strongly-typed DataTable for the `Employees` table in the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="9fb95-172">`Employees` テーブルには、従業員のマネージャーの `EmployeeID` を指定した `ReportsTo` フィールドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="9fb95-172">The `Employees` table contains a `ReportsTo` field that specified the `EmployeeID` of the employee s manager.</span></span> <span data-ttu-id="9fb95-173">たとえば、employee Anne 川本の `ReportTo` 値は5です。これは、秋山加藤の `EmployeeID` です。</span><span class="sxs-lookup"><span data-stu-id="9fb95-173">For example, employee Anne Dodsworth has a `ReportTo` value of 5, which is the `EmployeeID` of Steven Buchanan.</span></span> <span data-ttu-id="9fb95-174">その結果、Anne は秋山さん、上司に報告します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-174">Consequently, Anne reports to Steven, her manager.</span></span> <span data-ttu-id="9fb95-175">各従業員の `ReportsTo` 値を報告することに加えて、上司の名前を取得することもできます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-175">Along with reporting each employee s `ReportsTo` value, we might also want to retrieve the name of their manager.</span></span> <span data-ttu-id="9fb95-176">これは、`JOIN`を使用して実現できます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-176">This can be accomplished using a `JOIN`.</span></span> <span data-ttu-id="9fb95-177">ただし、最初に TableAdapter を作成するときに `JOIN` を使用すると、ウィザードによって、対応する挿入、更新、および削除の各機能が自動的に生成されなくなります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-177">But using a `JOIN` when initially creating the TableAdapter precludes the wizard from automatically generating the corresponding insert, update, and delete capabilities.</span></span> <span data-ttu-id="9fb95-178">そのため、最初に、メインクエリに `JOIN` が含まれていない TableAdapter を作成します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-178">Therefore, we will start by creating a TableAdapter whose main query does not contain any `JOIN` s.</span></span> <span data-ttu-id="9fb95-179">次に、手順2で、`JOIN`を使用してマネージャーの名前を取得するようにメインクエリのストアドプロシージャを更新します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-179">Then, in Step 2, we will update the main query stored procedure to retrieve the manager s name via a `JOIN`.</span></span>

<span data-ttu-id="9fb95-180">まず、`~/App_Code/DAL` フォルダー内の `NorthwindWithSprocs` データセットを開きます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-180">Start by opening the `NorthwindWithSprocs` DataSet in the `~/App_Code/DAL` folder.</span></span> <span data-ttu-id="9fb95-181">デザイナーを右クリックし、コンテキストメニューの [追加] オプションを選択して、[TableAdapter] メニュー項目を選択します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-181">Right-click on the Designer, select the Add option from the context menu, and pick the TableAdapter menu item.</span></span> <span data-ttu-id="9fb95-182">これにより、TableAdapter 構成ウィザードが起動します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-182">This will launch the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="9fb95-183">図5に示すように、ウィザードで新しいストアドプロシージャを作成し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-183">As Figure 5 depicts, have the wizard create new stored procedures and click Next.</span></span> <span data-ttu-id="9fb95-184">TableAdapter ウィザードでの新しいストアドプロシージャの作成の詳細については、「[型指定されたデータセットの tableadapter の新しいストアドプロシージャの作成](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)」チュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="9fb95-184">For a refresher on creating new stored procedures from the TableAdapter s wizard, consult the [Creating New Stored Procedures for the Typed DataSet s TableAdapters](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorial.</span></span>

<span data-ttu-id="9fb95-185">[![[新しいストアドプロシージャの作成] オプションを選択します。](updating-the-tableadapter-to-use-joins-vb/_static/image10.png)](updating-the-tableadapter-to-use-joins-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-185">[![Select the Create new stored procedures Option](updating-the-tableadapter-to-use-joins-vb/_static/image10.png)](updating-the-tableadapter-to-use-joins-vb/_static/image9.png)</span></span>

<span data-ttu-id="9fb95-186">**図 5**: [新しいストアドプロシージャを作成する] オプションを選択[する (クリックすると、フルサイズの画像が表示](updating-the-tableadapter-to-use-joins-vb/_static/image11.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9fb95-186">**Figure 5**: Select the Create new stored procedures Option ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image11.png))</span></span>

<span data-ttu-id="9fb95-187">TableAdapter のメインクエリには、次の `SELECT` ステートメントを使用します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-187">Use the following `SELECT` statement for the TableAdapter s main query:</span></span>

[!code-sql[Main](updating-the-tableadapter-to-use-joins-vb/samples/sample4.sql)]

<span data-ttu-id="9fb95-188">このクエリには `JOIN` が含まれていないため、TableAdapter ウィザードでは、対応する `INSERT`、`UPDATE`、および `DELETE` ステートメントを含むストアドプロシージャと、メインクエリを実行するためのストアドプロシージャが自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-188">Since this query does not include any `JOIN` s, the TableAdapter wizard will automatically create stored procedures with corresponding `INSERT`, `UPDATE`, and `DELETE` statements, as well as a stored procedure for executing the main query.</span></span>

<span data-ttu-id="9fb95-189">次の手順では、TableAdapter のストアドプロシージャに名前を指定できます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-189">The following step allows us to name the TableAdapter s stored procedures.</span></span> <span data-ttu-id="9fb95-190">図6に示すように、`Employees_Select`、`Employees_Insert`、`Employees_Update`、および `Employees_Delete`の名前を使用します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-190">Use the names `Employees_Select`, `Employees_Insert`, `Employees_Update`, and `Employees_Delete`, as shown in Figure 6.</span></span>

<span data-ttu-id="9fb95-191">[TableAdapter s ストアドプロシージャの名前を ![](updating-the-tableadapter-to-use-joins-vb/_static/image13.png)](updating-the-tableadapter-to-use-joins-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-191">[![Name the TableAdapter s Stored Procedures](updating-the-tableadapter-to-use-joins-vb/_static/image13.png)](updating-the-tableadapter-to-use-joins-vb/_static/image12.png)</span></span>

<span data-ttu-id="9fb95-192">**図 6**: TableAdapter のストアドプロシージャに名前[を指定する (クリックすると、フルサイズの画像が表示](updating-the-tableadapter-to-use-joins-vb/_static/image14.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9fb95-192">**Figure 6**: Name the TableAdapter s Stored Procedures ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image14.png))</span></span>

<span data-ttu-id="9fb95-193">最後の手順では、TableAdapter のメソッドに名前を指定するように求められます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-193">The final step prompts us to name the TableAdapter s methods.</span></span> <span data-ttu-id="9fb95-194">`Fill` を使用し、メソッド名として `GetEmployees` します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-194">Use `Fill` and `GetEmployees` as the method names.</span></span> <span data-ttu-id="9fb95-195">また、[更新を直接データベースに送信するためのメソッドを作成する (GenerateDBDirectMethods)] チェックボックスはオンのままにしてください。</span><span class="sxs-lookup"><span data-stu-id="9fb95-195">Also be sure to leave the Create methods to send updates directly to the database (GenerateDBDirectMethods) checkbox checked.</span></span>

<span data-ttu-id="9fb95-196">[TableAdapter のメソッドに ![名前を入力し、GetEmployees します。](updating-the-tableadapter-to-use-joins-vb/_static/image16.png)](updating-the-tableadapter-to-use-joins-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-196">[![Name the TableAdapter s Methods Fill and GetEmployees](updating-the-tableadapter-to-use-joins-vb/_static/image16.png)](updating-the-tableadapter-to-use-joins-vb/_static/image15.png)</span></span>

<span data-ttu-id="9fb95-197">**図 7**: TableAdapter のメソッド `Fill` と `GetEmployees` の名前を指定[する (クリックすると、フルサイズの画像が表示](updating-the-tableadapter-to-use-joins-vb/_static/image17.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9fb95-197">**Figure 7**: Name the TableAdapter s Methods `Fill` and `GetEmployees` ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image17.png))</span></span>

<span data-ttu-id="9fb95-198">ウィザードが完了したら、しばらく時間を取って、データベース内のストアドプロシージャを確認してください。</span><span class="sxs-lookup"><span data-stu-id="9fb95-198">After completing the wizard, take a moment to examine the stored procedures in the database.</span></span> <span data-ttu-id="9fb95-199">`Employees_Select`、`Employees_Insert`、`Employees_Update`、および `Employees_Delete`の4つの新しいものが表示されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-199">You should see four new ones: `Employees_Select`, `Employees_Insert`, `Employees_Update`, and `Employees_Delete`.</span></span> <span data-ttu-id="9fb95-200">次に、`EmployeesDataTable` を調べて、先ほど作成した `EmployeesTableAdapter` ます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-200">Next, inspect the `EmployeesDataTable` and `EmployeesTableAdapter` just created.</span></span> <span data-ttu-id="9fb95-201">DataTable には、メインクエリによって返される各フィールドの列が含まれています。</span><span class="sxs-lookup"><span data-stu-id="9fb95-201">The DataTable contains a column for each field returned by the main query.</span></span> <span data-ttu-id="9fb95-202">TableAdapter をクリックし、プロパティウィンドウにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-202">Click on the TableAdapter and then go to the Properties window.</span></span> <span data-ttu-id="9fb95-203">ここでは、`InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティが、対応するストアドプロシージャを呼び出すように正しく構成されていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-203">There you will see that the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties are correctly configured to call the corresponding stored procedures.</span></span>

<span data-ttu-id="9fb95-204">[TableAdapter には、挿入、更新、削除の各機能が含まれて ![](updating-the-tableadapter-to-use-joins-vb/_static/image19.png)](updating-the-tableadapter-to-use-joins-vb/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-204">[![The TableAdapter Includes Insert, Update, and Delete Capabilities](updating-the-tableadapter-to-use-joins-vb/_static/image19.png)](updating-the-tableadapter-to-use-joins-vb/_static/image18.png)</span></span>

<span data-ttu-id="9fb95-205">**図 8**: TableAdapter には挿入、更新、および削除の機能が含まれています ([クリックすると、フルサイズの画像が表示](updating-the-tableadapter-to-use-joins-vb/_static/image20.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9fb95-205">**Figure 8**: The TableAdapter Includes Insert, Update, and Delete Capabilities ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image20.png))</span></span>

<span data-ttu-id="9fb95-206">挿入、更新、および削除の各ストアドプロシージャが自動的に作成され、`InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティが正しく構成されているので、`SelectCommand` s ストアドプロシージャをカスタマイズして各従業員のマネージャーに関する追加情報を返すことができます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-206">With the insert, update, and delete stored procedures automatically created and the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties correctly configured, we are ready to customize the `SelectCommand` s stored procedure to return additional information about each employee s manager.</span></span> <span data-ttu-id="9fb95-207">具体的には、`JOIN` を使用し、マネージャーの `FirstName` と `LastName` の値を返すように `Employees_Select` ストアドプロシージャを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-207">Specifically, we need to update the `Employees_Select` stored procedure to use a `JOIN` and return the manager s `FirstName` and `LastName` values.</span></span> <span data-ttu-id="9fb95-208">ストアドプロシージャを更新した後は、これらの追加列が含まれるように DataTable を更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-208">After the stored procedure has been updated, we will need to update the DataTable so that it includes these additional columns.</span></span> <span data-ttu-id="9fb95-209">これらの2つのタスクについては、手順 2. と 3. で説明します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-209">We'll tackle these two tasks in Steps 2 and 3.</span></span>

## <a name="step-2-customizing-the-stored-procedure-to-include-ajoin"></a><span data-ttu-id="9fb95-210">手順 2:`JOIN` を含むようにストアドプロシージャをカスタマイズする</span><span class="sxs-lookup"><span data-stu-id="9fb95-210">Step 2: Customizing the Stored Procedure to Include a`JOIN`</span></span>

<span data-ttu-id="9fb95-211">まず、サーバーエクスプローラーに移動し、Northwind データベースの [ストアドプロシージャ] フォルダーにドリルダウンして、`Employees_Select` ストアドプロシージャを開きます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-211">Start by going to the Server Explorer, drilling down into the Northwind database s Stored Procedures folder, and opening the `Employees_Select` stored procedure.</span></span> <span data-ttu-id="9fb95-212">このストアドプロシージャが表示されない場合は、[ストアドプロシージャ] フォルダーを右クリックし、[最新の状態に更新] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-212">If you do not see this stored procedure, right-click on the Stored Procedures folder and choose Refresh.</span></span> <span data-ttu-id="9fb95-213">`LEFT JOIN` を使用して manager の姓と名を返すようにストアドプロシージャを更新します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-213">Update the stored procedure so that it uses a `LEFT JOIN` to return the manager s first and last name:</span></span>

[!code-sql[Main](updating-the-tableadapter-to-use-joins-vb/samples/sample5.sql)]

<span data-ttu-id="9fb95-214">`SELECT` ステートメントを更新した後、[ファイル] メニューの [`Employees_Select`の保存] をクリックして変更を保存します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-214">After updating the `SELECT` statement, save the changes by going to the File menu and choosing Save `Employees_Select`.</span></span> <span data-ttu-id="9fb95-215">または、ツールバーの [保存] アイコンをクリックするか、Ctrl + S キーを押します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-215">Alternatively, you can click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="9fb95-216">変更を保存した後、サーバーエクスプローラーで `Employees_Select` ストアドプロシージャを右クリックし、[実行] を選択します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-216">After saving your changes, right-click on the `Employees_Select` stored procedure in the Server Explorer and choose Execute.</span></span> <span data-ttu-id="9fb95-217">これにより、ストアドプロシージャが実行され、結果が出力ウィンドウに表示されます (図9を参照)。</span><span class="sxs-lookup"><span data-stu-id="9fb95-217">This will run the stored procedure and show its results in the Output window (see Figure 9).</span></span>

<span data-ttu-id="9fb95-218">[ストアドプロシージャの結果が ![出力ウィンドウに表示されます。](updating-the-tableadapter-to-use-joins-vb/_static/image22.png)](updating-the-tableadapter-to-use-joins-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-218">[![The Stored Procedures Results are Displayed in the Output Window](updating-the-tableadapter-to-use-joins-vb/_static/image22.png)](updating-the-tableadapter-to-use-joins-vb/_static/image21.png)</span></span>

<span data-ttu-id="9fb95-219">**図 9**: ストアドプロシージャの結果が出力ウィンドウに表示される ([クリックしてフルサイズの画像を表示する](updating-the-tableadapter-to-use-joins-vb/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="9fb95-219">**Figure 9**: The Stored Procedures Results are Displayed in the Output Window ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image23.png))</span></span>

## <a name="step-3-updating-the-datatable-s-columns"></a><span data-ttu-id="9fb95-220">手順 3: DataTable s 列を更新する</span><span class="sxs-lookup"><span data-stu-id="9fb95-220">Step 3: Updating the DataTable s Columns</span></span>

<span data-ttu-id="9fb95-221">この時点で、`Employees_Select` ストアドプロシージャは `ManagerFirstName` と `ManagerLastName` の値を返しますが、`EmployeesDataTable` にはこれらの列がありません。</span><span class="sxs-lookup"><span data-stu-id="9fb95-221">At this point, the `Employees_Select` stored procedure returns `ManagerFirstName` and `ManagerLastName` values, but the `EmployeesDataTable` is missing these columns.</span></span> <span data-ttu-id="9fb95-222">これらの欠損列は、次の2つの方法のいずれかで DataTable に追加できます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-222">These missing columns can be added to the DataTable in one of two ways:</span></span>

- <span data-ttu-id="9fb95-223">データセットデザイナーで DataTable**を右クリック**し、[追加] メニューの [列] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-223">**Manually** - right-click on the DataTable in the DataSet Designer and, from the Add menu, choose Column.</span></span> <span data-ttu-id="9fb95-224">その後、列に名前を指定し、それに応じてプロパティを設定できます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-224">You can then name the column and set its properties accordingly.</span></span>
- <span data-ttu-id="9fb95-225">**自動**-TableAdapter 構成ウィザードは、`SelectCommand` ストアドプロシージャによって返されるフィールドを反映するように、DataTable の列を更新します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-225">**Automatically** - the TableAdapter Configuration wizard will update the DataTable s columns to reflect the fields returned by the `SelectCommand` stored procedure.</span></span> <span data-ttu-id="9fb95-226">アドホック SQL ステートメントを使用すると、`SelectCommand` に `JOIN`が含まれるようになったため、`InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティも削除されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-226">When using ad-hoc SQL statements, the wizard will also remove the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties since the `SelectCommand` now contains a `JOIN`.</span></span> <span data-ttu-id="9fb95-227">ただし、ストアドプロシージャを使用する場合、これらのコマンドプロパティはそのまま残ります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-227">But when using stored procedures, these command properties remain intact.</span></span>

<span data-ttu-id="9fb95-228">前のチュートリアルでは、前のチュートリアルで DataTable 列を手動で追加する方法について説明しました。[詳細については、マスターレコードの箇条書きリスト](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md)と[ファイルのアップロード](../working-with-binary-files/uploading-files-vb.md)に関する記事をご覧ください。このプロセスについては、次のチュートリアルでさらに詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-228">We have explored manually adding DataTable columns in previous tutorials, including [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) and [Uploading Files](../working-with-binary-files/uploading-files-vb.md), and we will look at this process again in more detail in our next tutorial.</span></span> <span data-ttu-id="9fb95-229">ただし、このチュートリアルでは、が TableAdapter 構成ウィザードを使用して自動アプローチを使用します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-229">For this tutorial, however, let s use the automatic approach via the TableAdapter Configuration wizard.</span></span>

<span data-ttu-id="9fb95-230">まず、`EmployeesTableAdapter` を右クリックし、コンテキストメニューから [構成] を選択します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-230">Start by right-clicking on the `EmployeesTableAdapter` and selecting Configure from the context menu.</span></span> <span data-ttu-id="9fb95-231">これにより、TableAdapter 構成ウィザードが表示されます。これには、選択、挿入、更新、および削除に使用するストアドプロシージャが、戻り値とパラメーター (存在する場合) と共に一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-231">This brings up the TableAdapter Configuration wizard, which lists the stored procedures used for selecting, inserting, updating, and deleting, along with their return values and parameters (if any).</span></span> <span data-ttu-id="9fb95-232">図10に、このウィザードを示します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-232">Figure 10 shows this wizard.</span></span> <span data-ttu-id="9fb95-233">ここで、`Employees_Select` ストアドプロシージャが `ManagerFirstName` と `ManagerLastName` フィールドを返すようになったことがわかります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-233">Here we can see that the `Employees_Select` stored procedure now returns the `ManagerFirstName` and `ManagerLastName` fields.</span></span>

<span data-ttu-id="9fb95-234">[![、Employees_Select ストアドプロシージャの更新された列の一覧が表示されます。](updating-the-tableadapter-to-use-joins-vb/_static/image25.png)](updating-the-tableadapter-to-use-joins-vb/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-234">[![The Wizard Shows the Updated Column List for the Employees_Select Stored Procedure](updating-the-tableadapter-to-use-joins-vb/_static/image25.png)](updating-the-tableadapter-to-use-joins-vb/_static/image24.png)</span></span>

<span data-ttu-id="9fb95-235">**図 10**: ウィザードに `Employees_Select` ストアドプロシージャの更新された列の一覧が表示される ([クリックしてフルサイズの画像を表示する](updating-the-tableadapter-to-use-joins-vb/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="9fb95-235">**Figure 10**: The Wizard Shows the Updated Column List for the `Employees_Select` Stored Procedure ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image26.png))</span></span>

<span data-ttu-id="9fb95-236">[完了] をクリックしてウィザードを完了します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-236">Complete the wizard by clicking Finish.</span></span> <span data-ttu-id="9fb95-237">データセットデザイナーに戻ると、`EmployeesDataTable` に `ManagerFirstName` と `ManagerLastName`の2つの列が追加されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-237">Upon returning to the DataSet Designer, the `EmployeesDataTable` includes two additional columns: `ManagerFirstName` and `ManagerLastName`.</span></span>

<span data-ttu-id="9fb95-238">[EmployeesDataTable に2つの新しい列が含まれている ![](updating-the-tableadapter-to-use-joins-vb/_static/image28.png)](updating-the-tableadapter-to-use-joins-vb/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-238">[![The EmployeesDataTable Contains Two New Columns](updating-the-tableadapter-to-use-joins-vb/_static/image28.png)](updating-the-tableadapter-to-use-joins-vb/_static/image27.png)</span></span>

<span data-ttu-id="9fb95-239">**図 11**: `EmployeesDataTable` に2つの新しい列が含まれている ([クリックしてフルサイズの画像を表示する](updating-the-tableadapter-to-use-joins-vb/_static/image29.png))</span><span class="sxs-lookup"><span data-stu-id="9fb95-239">**Figure 11**: The `EmployeesDataTable` Contains Two New Columns ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image29.png))</span></span>

<span data-ttu-id="9fb95-240">更新された `Employees_Select` ストアドプロシージャが有効であり、TableAdapter の挿入、更新、および削除の機能がまだ機能していることを示すために、ユーザーが従業員を表示および削除できるようにする web ページを作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="9fb95-240">To illustrate that the updated `Employees_Select` stored procedure is in effect and that the insert, update, and delete capabilities of the TableAdapter are still functional, let s create a web page that allows users to view and delete employees.</span></span> <span data-ttu-id="9fb95-241">ただし、このようなページを作成する前に、最初にビジネスロジック層に新しいクラスを作成して、`NorthwindWithSprocs` データセットから従業員を操作できるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-241">Before we create such a page, however, we need to first create a new class in the Business Logic Layer for working with employees from the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="9fb95-242">手順4では、`EmployeesBLLWithSprocs` クラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-242">In Step 4, we will create an `EmployeesBLLWithSprocs` class.</span></span> <span data-ttu-id="9fb95-243">手順5では、ASP.NET ページからこのクラスを使用します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-243">In Step 5, we will use this class from an ASP.NET page.</span></span>

## <a name="step-4-implementing-the-business-logic-layer"></a><span data-ttu-id="9fb95-244">手順 4: ビジネスロジック層を実装する</span><span class="sxs-lookup"><span data-stu-id="9fb95-244">Step 4: Implementing the Business Logic Layer</span></span>

<span data-ttu-id="9fb95-245">`EmployeesBLLWithSprocs.vb`という名前の `~/App_Code/BLL` フォルダーに新しいクラスファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-245">Create a new class file in the `~/App_Code/BLL` folder named `EmployeesBLLWithSprocs.vb`.</span></span> <span data-ttu-id="9fb95-246">このクラスは、既存の `EmployeesBLL` クラスのセマンティクスを模倣しています。この新しいクラスでは、より少数のメソッドを提供し、`Northwind` データセットではなく `NorthwindWithSprocs` データセットを使用します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-246">This class mimics the semantics of the existing `EmployeesBLL` class, only this new one provides fewer methods and uses the `NorthwindWithSprocs` DataSet (instead of the `Northwind` DataSet).</span></span> <span data-ttu-id="9fb95-247">次のコードを `EmployeesBLLWithSprocs` クラスに追加します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-247">Add the following code to the `EmployeesBLLWithSprocs` class.</span></span>

[!code-vb[Main](updating-the-tableadapter-to-use-joins-vb/samples/sample6.vb)]

<span data-ttu-id="9fb95-248">`EmployeesBLLWithSprocs` class s `Adapter` プロパティは、`NorthwindWithSprocs` データセットの `EmployeesTableAdapter`のインスタンスを返します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-248">The `EmployeesBLLWithSprocs` class s `Adapter` property returns an instance of the `NorthwindWithSprocs` DataSet s `EmployeesTableAdapter`.</span></span> <span data-ttu-id="9fb95-249">これは、クラス `GetEmployees` および `DeleteEmployee` メソッドによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-249">This is used by the class s `GetEmployees` and `DeleteEmployee` methods.</span></span> <span data-ttu-id="9fb95-250">`GetEmployees` メソッドは、対応する `GetEmployees` メソッドを `EmployeesTableAdapter` 呼び出します。このメソッドは、`Employees_Select` ストアドプロシージャを呼び出し、結果を `EmployeeDataTable`に設定します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-250">The `GetEmployees` method calls the `EmployeesTableAdapter` s corresponding `GetEmployees` method, which invokes the `Employees_Select` stored procedure and populates its results in an `EmployeeDataTable`.</span></span> <span data-ttu-id="9fb95-251">`DeleteEmployee` メソッドは同様に、`EmployeesTableAdapter` s `Delete` メソッドを呼び出します。これにより、`Employees_Delete` ストアドプロシージャが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-251">The `DeleteEmployee` method similarly calls the `EmployeesTableAdapter` s `Delete` method, which invokes the `Employees_Delete` stored procedure.</span></span>

## <a name="step-5-working-with-the-data-in-the-presentation-layer"></a><span data-ttu-id="9fb95-252">手順 5: プレゼンテーション層のデータを操作する</span><span class="sxs-lookup"><span data-stu-id="9fb95-252">Step 5: Working with the Data in the Presentation Layer</span></span>

<span data-ttu-id="9fb95-253">`EmployeesBLLWithSprocs` クラスが完成したら、ASP.NET ページを使用して従業員データを操作する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="9fb95-253">With the `EmployeesBLLWithSprocs` class complete, we re ready to work with employee data through an ASP.NET page.</span></span> <span data-ttu-id="9fb95-254">`AdvancedDAL` フォルダーの [`JOINs.aspx`] ページを開き、[ツールボックス] から GridView をデザイナーにドラッグし、`ID` プロパティを [`Employees`] に設定します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-254">Open the `JOINs.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` property to `Employees`.</span></span> <span data-ttu-id="9fb95-255">次に、GridView s スマートタグから、グリッドを `EmployeesDataSource`という名前の新しい ObjectDataSource コントロールにバインドします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-255">Next, from the GridView s smart tag, bind the grid to a new ObjectDataSource control named `EmployeesDataSource`.</span></span>

<span data-ttu-id="9fb95-256">`EmployeesBLLWithSprocs` クラスを使用するように ObjectDataSource を構成します。 [選択] タブと [削除] タブで、ドロップダウンリストから [`GetEmployees`] および [`DeleteEmployee`] メソッドが選択されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-256">Configure the ObjectDataSource to use the `EmployeesBLLWithSprocs` class and, from the SELECT and DELETE tabs, ensure that the `GetEmployees` and `DeleteEmployee` methods are selected from the drop-down lists.</span></span> <span data-ttu-id="9fb95-257">[完了] をクリックして、ObjectDataSource の構成を完了します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-257">Click Finish to complete the ObjectDataSource s configuration.</span></span>

<span data-ttu-id="9fb95-258">[EmployeesBLLWithSprocs クラスを使用するように ObjectDataSource を構成 ![には](updating-the-tableadapter-to-use-joins-vb/_static/image31.png)](updating-the-tableadapter-to-use-joins-vb/_static/image30.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-258">[![Configure the ObjectDataSource to Use the EmployeesBLLWithSprocs Class](updating-the-tableadapter-to-use-joins-vb/_static/image31.png)](updating-the-tableadapter-to-use-joins-vb/_static/image30.png)</span></span>

<span data-ttu-id="9fb95-259">**図 12**: `EmployeesBLLWithSprocs` クラスを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](updating-the-tableadapter-to-use-joins-vb/_static/image32.png))</span><span class="sxs-lookup"><span data-stu-id="9fb95-259">**Figure 12**: Configure the ObjectDataSource to Use the `EmployeesBLLWithSprocs` Class ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image32.png))</span></span>

<span data-ttu-id="9fb95-260">[GetEmployees メソッドと DeleteEmployee メソッドが ObjectDataSource で使用さ ![](updating-the-tableadapter-to-use-joins-vb/_static/image34.png)](updating-the-tableadapter-to-use-joins-vb/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-260">[![Have the ObjectDataSource Use the GetEmployees and DeleteEmployee Methods](updating-the-tableadapter-to-use-joins-vb/_static/image34.png)](updating-the-tableadapter-to-use-joins-vb/_static/image33.png)</span></span>

<span data-ttu-id="9fb95-261">**図 13**: ObjectDataSource で `GetEmployees` および `DeleteEmployee` メソッドを使用する ([クリックしてフルサイズのイメージを表示する](updating-the-tableadapter-to-use-joins-vb/_static/image35.png))</span><span class="sxs-lookup"><span data-stu-id="9fb95-261">**Figure 13**: Have the ObjectDataSource Use the `GetEmployees` and `DeleteEmployee` Methods ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image35.png))</span></span>

<span data-ttu-id="9fb95-262">Visual Studio によって、`EmployeesDataTable` s 列ごとに BoundField が GridView に追加されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-262">Visual Studio will add a BoundField to the GridView for each of the `EmployeesDataTable` s columns.</span></span> <span data-ttu-id="9fb95-263">`Title`、`LastName`、`FirstName`、`ManagerFirstName`、および `ManagerLastName` を除くこれらの連結フィールドをすべて削除し、最後の4つの BoundFields の `HeaderText` プロパティを姓、名、マネージャー名、およびマネージャーの姓にそれぞれ変更します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-263">Remove all of these BoundFields except for `Title`, `LastName`, `FirstName`, `ManagerFirstName`, and `ManagerLastName` and rename the `HeaderText` properties for the last four BoundFields to Last Name, First Name, Manager s First Name, and Manager s Last Name, respectively.</span></span>

<span data-ttu-id="9fb95-264">ユーザーがこのページから従業員を削除できるようにするには、次の2つの作業を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-264">To allow users to delete employees from this page we need to do two things.</span></span> <span data-ttu-id="9fb95-265">まず、削除機能を提供するように GridView に指示します。そのためには、スマートタグから [削除を有効にする] オプションをオンにします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-265">First, instruct the GridView to provide deleting capabilities by checking the Enable Deleting option from its smart tag.</span></span> <span data-ttu-id="9fb95-266">次に、objectdatasource の `OldValuesParameterFormatString` プロパティを、ObjectDataSource ウィザードで設定された値 (`original_{0}`) から既定値 (`{0}`) に変更します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-266">Second, change the ObjectDataSource s `OldValuesParameterFormatString` property from the value set by the ObjectDataSource wizard (`original_{0}`) to its default value (`{0}`).</span></span> <span data-ttu-id="9fb95-267">これらの変更を行った後、GridView および ObjectDataSource の宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-267">After making these changes, your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](updating-the-tableadapter-to-use-joins-vb/samples/sample7.aspx)]

<span data-ttu-id="9fb95-268">ブラウザーでページにアクセスして、ページをテストします。</span><span class="sxs-lookup"><span data-stu-id="9fb95-268">Test out the page by visiting it through a browser.</span></span> <span data-ttu-id="9fb95-269">図14に示すように、ページには、各従業員と上司の名前が表示されます (所有している場合)。</span><span class="sxs-lookup"><span data-stu-id="9fb95-269">As Figure 14 shows, the page will list each employee and his or her manager s name (assuming they have one).</span></span>

<span data-ttu-id="9fb95-270">[Employees_Select ストアドプロシージャ内の結合によってマネージャー名が返される ![](updating-the-tableadapter-to-use-joins-vb/_static/image37.png)](updating-the-tableadapter-to-use-joins-vb/_static/image36.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-270">[![The JOIN in the Employees_Select Stored Procedure Returns the Manager s Name](updating-the-tableadapter-to-use-joins-vb/_static/image37.png)](updating-the-tableadapter-to-use-joins-vb/_static/image36.png)</span></span>

<span data-ttu-id="9fb95-271">**図 14**: `Employees_Select` ストアドプロシージャの `JOIN` がマネージャーの名前を返す ([クリックすると、フルサイズの画像が表示](updating-the-tableadapter-to-use-joins-vb/_static/image38.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9fb95-271">**Figure 14**: The `JOIN` in the `Employees_Select` Stored Procedure Returns the Manager s Name ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image38.png))</span></span>

<span data-ttu-id="9fb95-272">[削除] ボタンをクリックすると、削除中のワークフローが開始されます。このワークフローは `Employees_Delete` ストアドプロシージャの実行に culminates ます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-272">Clicking the Delete button starts the deleting workflow, which culminates in the execution of the `Employees_Delete` stored procedure.</span></span> <span data-ttu-id="9fb95-273">ただし、ストアドプロシージャで試行された `DELETE` ステートメントは、外部キー制約違反によって失敗します (図15を参照)。</span><span class="sxs-lookup"><span data-stu-id="9fb95-273">However, the attempted `DELETE` statement in the stored procedure fails because of a foreign key constraint violation (see Figure 15).</span></span> <span data-ttu-id="9fb95-274">具体的には、各従業員は `Orders` テーブルに1つ以上のレコードを持っているため、削除は失敗します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-274">Specifically, each employee has one or more records in the `Orders` table, causing the delete to fail.</span></span>

<span data-ttu-id="9fb95-275">[対応する注文がある従業員を削除すると、外部キー制約違反が発生する ![](updating-the-tableadapter-to-use-joins-vb/_static/image40.png)](updating-the-tableadapter-to-use-joins-vb/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="9fb95-275">[![Deleting an Employee That has Corresponding Orders Results in a Foreign Key Constraint Violation](updating-the-tableadapter-to-use-joins-vb/_static/image40.png)](updating-the-tableadapter-to-use-joins-vb/_static/image39.png)</span></span>

<span data-ttu-id="9fb95-276">**図 15**: 対応する注文がある従業員を削除すると、外部キー制約違反が発生する ([クリックすると、フルサイズの画像が表示](updating-the-tableadapter-to-use-joins-vb/_static/image41.png)されます)</span><span class="sxs-lookup"><span data-stu-id="9fb95-276">**Figure 15**: Deleting an Employee That has Corresponding Orders Results in a Foreign Key Constraint Violation ([Click to view full-size image](updating-the-tableadapter-to-use-joins-vb/_static/image41.png))</span></span>

<span data-ttu-id="9fb95-277">従業員を削除できるようにするには、次の方法があります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-277">To allow an employee to be deleted you could:</span></span>

- <span data-ttu-id="9fb95-278">Foreign key 制約を連鎖削除に更新します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-278">Update the foreign key constraint to cascade deletes,</span></span>
- <span data-ttu-id="9fb95-279">削除する従業員の `Orders` テーブルからレコードを手動で削除します。または、</span><span class="sxs-lookup"><span data-stu-id="9fb95-279">Manually delete the records from the `Orders` table for the employee(s) you want to delete, or</span></span>
- <span data-ttu-id="9fb95-280">`Employees` レコードを削除する前に、最初に `Orders` テーブルから関連レコードを削除するように `Employees_Delete` ストアドプロシージャを更新します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-280">Update the `Employees_Delete` stored procedure to first delete the related records from the `Orders` table before deleting the `Employees` record.</span></span> <span data-ttu-id="9fb95-281">この手法については、 [「型指定されたデータセットの tableadapter の既存のストアドプロシージャの使用](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)」のチュートリアルで説明しました。</span><span class="sxs-lookup"><span data-stu-id="9fb95-281">We discussed this technique in the [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorial.</span></span>

<span data-ttu-id="9fb95-282">この作業をリーダーの演習として残しておきます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-282">I leave this as an exercise for the reader.</span></span>

## <a name="summary"></a><span data-ttu-id="9fb95-283">まとめ</span><span class="sxs-lookup"><span data-stu-id="9fb95-283">Summary</span></span>

<span data-ttu-id="9fb95-284">リレーショナルデータベースを使用する場合、クエリでは、複数の関連テーブルからデータを取得するのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="9fb95-284">When working with relational databases, it is common for queries to pull their data from multiple, related tables.</span></span> <span data-ttu-id="9fb95-285">相関サブクエリと `JOIN` には、クエリ内の関連テーブルからデータにアクセスするための2つの異なる手法が用意されています。</span><span class="sxs-lookup"><span data-stu-id="9fb95-285">Correlated subqueries and `JOIN` s provide two different techniques for accessing data from related tables in a query.</span></span> <span data-ttu-id="9fb95-286">前のチュートリアルでは、通常、相関サブクエリを使用しました。これは、TableAdapter が `JOIN` に関連するクエリの `INSERT`、`UPDATE`、および `DELETE` ステートメントを自動生成できないためです。</span><span class="sxs-lookup"><span data-stu-id="9fb95-286">In previous tutorials we most commonly made use of correlated subqueries because the TableAdapter cannot auto-generate `INSERT`, `UPDATE`, and `DELETE` statements for queries involving `JOIN` s.</span></span> <span data-ttu-id="9fb95-287">これらの値は手動で指定できますが、アドホック SQL ステートメントを使用する場合は、TableAdapter 構成ウィザードの完了時にすべてのカスタマイズが上書きされます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-287">While these values can be provided manually, when using ad-hoc SQL statements any customizations will be overwritten when the TableAdapter Configuration wizard is completed.</span></span>

<span data-ttu-id="9fb95-288">さいわい、ストアドプロシージャを使用して作成された Tableadapter は、アドホック SQL ステートメントを使用して作成されたものと同じ高まるを持つことはできません。</span><span class="sxs-lookup"><span data-stu-id="9fb95-288">Fortunately, TableAdapters created using stored procedures do not suffer from the same brittleness as those created using ad-hoc SQL statements.</span></span> <span data-ttu-id="9fb95-289">そのため、ストアドプロシージャを使用する場合は、メインクエリで `JOIN` を使用する TableAdapter を作成することができます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-289">Therefore, it is feasible to create a TableAdapter whose main query uses a `JOIN` when using stored procedures.</span></span> <span data-ttu-id="9fb95-290">このチュートリアルでは、このような TableAdapter を作成する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="9fb95-290">In this tutorial we saw how to create such a TableAdapter.</span></span> <span data-ttu-id="9fb95-291">ここでは、対応する insert、update、および delete の各ストアドプロシージャが自動作成されるように、TableAdapter のメインクエリに対して `JOIN`のない `SELECT` クエリを使用して開始しました。</span><span class="sxs-lookup"><span data-stu-id="9fb95-291">We started by using a `JOIN`-less `SELECT` query for the TableAdapter s main query so that the corresponding insert, update, and delete stored procedures would be auto-created.</span></span> <span data-ttu-id="9fb95-292">TableAdapter の初期構成が完了したので、`SelectCommand` ストアドプロシージャを拡張して、`JOIN` を使用し、TableAdapter 構成ウィザードを再実行して `EmployeesDataTable` s 列を更新しました。</span><span class="sxs-lookup"><span data-stu-id="9fb95-292">With the TableAdapter s initial configuration complete, we augmented the `SelectCommand` stored procedure to use a `JOIN` and re-ran the TableAdapter Configuration wizard to update the `EmployeesDataTable` s columns.</span></span>

<span data-ttu-id="9fb95-293">TableAdapter 構成ウィザードを再実行すると、`Employees_Select` ストアドプロシージャによって返されたデータフィールドを反映するように、`EmployeesDataTable` の列が自動的に更新されます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-293">Re-running the TableAdapter Configuration wizard automatically updated the `EmployeesDataTable` columns to reflect the data fields returned by the `Employees_Select` stored procedure.</span></span> <span data-ttu-id="9fb95-294">または、これらの列を DataTable に手動で追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="9fb95-294">Alternatively, we could have added these columns manually to the DataTable.</span></span> <span data-ttu-id="9fb95-295">次のチュートリアルでは、DataTable に列を手動で追加する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-295">We will explore manually adding columns to the DataTable in the next tutorial.</span></span>

<span data-ttu-id="9fb95-296">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="9fb95-296">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="9fb95-297">著者について</span><span class="sxs-lookup"><span data-stu-id="9fb95-297">About the Author</span></span>

<span data-ttu-id="9fb95-298">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="9fb95-298">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9fb95-299">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="9fb95-299">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9fb95-300">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="9fb95-300">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9fb95-301">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9fb95-301">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="9fb95-302">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="9fb95-302">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="9fb95-303">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="9fb95-303">Special Thanks To</span></span>

<span data-ttu-id="9fb95-304">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="9fb95-304">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9fb95-305">このチュートリアルのリードレビュー担当者は、Hilton Geisenow、David u、および Teresa Murphy でした。</span><span class="sxs-lookup"><span data-stu-id="9fb95-305">Lead reviewers for this tutorial were Hilton Geisenow, David Suru, and Teresa Murphy.</span></span> <span data-ttu-id="9fb95-306">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="9fb95-306">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9fb95-307">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9fb95-307">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9fb95-308">[前へ](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
> [次へ](adding-additional-datatable-columns-vb.md)</span><span class="sxs-lookup"><span data-stu-id="9fb95-308">[Previous](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
[Next](adding-additional-datatable-columns-vb.md)</span></span>
