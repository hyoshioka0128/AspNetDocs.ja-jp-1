---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/debugging-stored-procedures-cs
title: ストアドプロシージャのデバッグC#() |Microsoft Docs
author: rick-anderson
description: Visual Studio Professional および Team System edition を使用すると、SQL Server 内のストアドプロシージャにブレークポイントを設定してステップインし、デバッグを格納することができます。
ms.author: riande
ms.date: 08/03/2007
ms.assetid: c655c324-2ffa-4c21-8265-a254d79a693d
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/debugging-stored-procedures-cs
msc.type: authoredcontent
ms.openlocfilehash: 12a8500b107345b9cc9ab457016fdef09ca1bb9d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74604796"
---
# <a name="debugging-stored-procedures-c"></a><span data-ttu-id="ab88c-103">ストアド プロシージャのデバッグ (C#)</span><span class="sxs-lookup"><span data-stu-id="ab88c-103">Debugging Stored Procedures (C#)</span></span>

<span data-ttu-id="ab88c-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ab88c-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ab88c-105">[コードのダウンロード](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_74_CS.zip)または[PDF のダウンロード](debugging-stored-procedures-cs/_static/datatutorial74cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ab88c-105">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_74_CS.zip) or [Download PDF](debugging-stored-procedures-cs/_static/datatutorial74cs1.pdf)</span></span>

> <span data-ttu-id="ab88c-106">Visual Studio Professional および Team System edition を使用すると、SQL Server 内のストアドプロシージャにブレークポイントを設定してステップインすることができます。これにより、アプリケーションコードのデバッグと同様に、デバッグストアドプロシージャを簡単に実行できます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-106">Visual Studio Professional and Team System editions allow you to set breakpoints and step in to stored procedures within SQL Server, making debugging stored procedures as easy as debugging application code.</span></span> <span data-ttu-id="ab88c-107">このチュートリアルでは、ストアドプロシージャの直接データベースデバッグとアプリケーションデバッグについて説明します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-107">This tutorial demonstrates direct database debugging and application debugging of stored procedures.</span></span>

## <a name="introduction"></a><span data-ttu-id="ab88c-108">はじめに</span><span class="sxs-lookup"><span data-stu-id="ab88c-108">Introduction</span></span>

<span data-ttu-id="ab88c-109">Visual Studio には、豊富なデバッグ機能が用意されています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-109">Visual Studio provides a rich debugging experience.</span></span> <span data-ttu-id="ab88c-110">いくつかのキーストロークやマウスのクリックを使用して、ブレークポイントを使用してプログラムの実行を停止し、その状態と制御フローを調べることができます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-110">With a few keystrokes or clicks of the mouse, it s possible to use breakpoints to stop execution of a program and examine its state and control flow.</span></span> <span data-ttu-id="ab88c-111">Visual Studio では、アプリケーションコードのデバッグと共に、SQL Server 内からストアドプロシージャをデバッグするためのサポートを提供しています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-111">Along with debugging application code, Visual Studio offers support for debugging stored procedures from within SQL Server.</span></span> <span data-ttu-id="ab88c-112">ブレークポイントは、ASP.NET 分離コードクラスまたはビジネスロジックレイヤークラスのコード内で設定できるのと同様に、ストアドプロシージャ内に配置することもできます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-112">Just like breakpoints can be set within the code of an ASP.NET code-behind class or Business Logic Layer class, so too can they be placed within stored procedures.</span></span>

<span data-ttu-id="ab88c-113">このチュートリアルでは、Visual Studio 内のサーバーエクスプローラーからストアドプロシージャへのステップインと、実行中の ASP.NET アプリケーションからストアドプロシージャが呼び出されたときにヒットするブレークポイントを設定する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-113">In this tutorial we will look at stepping into stored procedures from the Server Explorer within Visual Studio as well as how to set breakpoints that are hit when the stored procedure is called from the running ASP.NET application.</span></span>

> [!NOTE]
> <span data-ttu-id="ab88c-114">残念ながら、ストアドプロシージャは、Visual Studio の Professional および Team system バージョンでのみ段階的に、デバッグできます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-114">Unfortunately, stored procedures can only be stepped into and debugged through the Professional and Team Systems versions of Visual Studio.</span></span> <span data-ttu-id="ab88c-115">Visual Web Developer または standard バージョンの Visual Studio を使用している場合は、ストアドプロシージャをデバッグするために必要な手順について説明しますが、これらの手順をコンピューターでレプリケートすることはできません。</span><span class="sxs-lookup"><span data-stu-id="ab88c-115">If you are using Visual Web Developer or the standard version of Visual Studio, you are welcome to read along as we walk through the steps necessary to debug stored procedures, but you will not be able to replicate these steps on your machine.</span></span>

## <a name="sql-server-debugging-concepts"></a><span data-ttu-id="ab88c-116">SQL Server デバッグの概念</span><span class="sxs-lookup"><span data-stu-id="ab88c-116">SQL Server Debugging Concepts</span></span>

<span data-ttu-id="ab88c-117">Microsoft SQL Server 2005 は、[共通言語ランタイム (CLR)](https://msdn.microsoft.com/netframework/aa497266.aspx)との統合を提供するように設計されています。これは、すべての .net アセンブリで使用されるランタイムです。</span><span class="sxs-lookup"><span data-stu-id="ab88c-117">Microsoft SQL Server 2005 was designed to provide integration with the [Common Language Runtime (CLR)](https://msdn.microsoft.com/netframework/aa497266.aspx), which is the runtime used by all .NET assemblies.</span></span> <span data-ttu-id="ab88c-118">その結果、SQL Server 2005 ではマネージデータベースオブジェクトがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-118">Consequently, SQL Server 2005 supports managed database objects.</span></span> <span data-ttu-id="ab88c-119">つまり、ストアドプロシージャやユーザー定義関数 (Udf) などのデータベースオブジェクトをC#クラスのメソッドとして作成できます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-119">That is, you can create database objects like stored procedures and User-Defined Functions (UDFs) as methods in a C# class.</span></span> <span data-ttu-id="ab88c-120">これにより、これらのストアドプロシージャおよび Udf は、.NET Framework と独自のカスタムクラスの機能を利用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-120">This enables these stored procedures and UDFs to utilize functionality in the .NET Framework and from your own custom classes.</span></span> <span data-ttu-id="ab88c-121">もちろん、SQL Server 2005 では、T-sql データベースオブジェクトもサポートされています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-121">Of course, SQL Server 2005 also provides support for T-SQL database objects.</span></span>

<span data-ttu-id="ab88c-122">SQL Server 2005 では、T-sql オブジェクトとマネージデータベースオブジェクトの両方のデバッグサポートが提供されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-122">SQL Server 2005 offers debugging support for both T-SQL and managed database objects.</span></span> <span data-ttu-id="ab88c-123">ただし、これらのオブジェクトは、Visual Studio 2005 Professional および Team system の各エディションでのみデバッグできます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-123">However, these objects can only be debugged through Visual Studio 2005 Professional and Team Systems editions.</span></span> <span data-ttu-id="ab88c-124">このチュートリアルでは、T-sql database オブジェクトのデバッグについて説明します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-124">In this tutorial we will examine debugging T-SQL database objects.</span></span> <span data-ttu-id="ab88c-125">以降のチュートリアルでは、マネージデータベースオブジェクトのデバッグについて見ていきます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-125">The subsequent tutorial looks at debugging managed database objects.</span></span>

<span data-ttu-id="ab88c-126">[SQL Server 2005 CLR 統合チーム](https://blogs.msdn.com/sqlclr/default.aspx)の[SQL Server 2005 ブログエントリでの T-sql と CLR デバッグの概要](https://blogs.msdn.com/sqlclr/archive/2006/06/29/651644.aspx)については、Visual Studio から SQL Server 2005 オブジェクトをデバッグする3つの方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-126">The [Overview of T-SQL and CLR Debugging in SQL Server 2005](https://blogs.msdn.com/sqlclr/archive/2006/06/29/651644.aspx) blog entry from the [SQL Server 2005 CLR Integration team](https://blogs.msdn.com/sqlclr/default.aspx) highlights the three ways to debug SQL Server 2005 objects from Visual Studio:</span></span>

- <span data-ttu-id="ab88c-127">**Direct Database デバッグ (DDD)** -サーバーエクスプローラーは、ストアドプロシージャや udf などの t-sql データベースオブジェクトにステップインできます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-127">**Direct Database Debugging (DDD)** - from Server Explorer we can step into any T-SQL database object, such as stored procedures and UDFs.</span></span> <span data-ttu-id="ab88c-128">DDD は、手順 1. で確認します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-128">We will examine DDD in Step 1.</span></span>
- <span data-ttu-id="ab88c-129">**アプリケーションのデバッグ**-データベースオブジェクト内にブレークポイントを設定し、ASP.NET アプリケーションを実行できます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-129">**Application Debugging** - we can set breakpoints within a database object and then run our ASP.NET application.</span></span> <span data-ttu-id="ab88c-130">データベースオブジェクトが実行されると、ブレークポイントがヒットし、制御がデバッガーに対して有効になります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-130">When the database object is executed, the breakpoint will be hit and control turned over to the debugger.</span></span> <span data-ttu-id="ab88c-131">アプリケーションのデバッグでは、アプリケーションコードからデータベースオブジェクトにステップインすることはできないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="ab88c-131">Note that with application debugging we cannot step into a database object from application code.</span></span> <span data-ttu-id="ab88c-132">デバッガーを停止するストアドプロシージャまたは Udf には、明示的にブレークポイントを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-132">We must explicitly set breakpoints in those stored procedures or UDFs where we want the debugger to stop.</span></span> <span data-ttu-id="ab88c-133">アプリケーションのデバッグは、手順 2. で開始します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-133">Application debugging is examined starting in Step 2.</span></span>
- <span data-ttu-id="ab88c-134">**SQL Server のプロジェクト**Visual Studio Professional および Team Systems エディションからのデバッグには、マネージデータベースオブジェクトを作成するために一般的に使用される SQL Server のプロジェクトの種類が含まれています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-134">**Debugging from a SQL Server Project** - Visual Studio Professional and Team Systems editions include a SQL Server Project type that is commonly used to create managed database objects.</span></span> <span data-ttu-id="ab88c-135">次のチュートリアルでは、SQL Server プロジェクトを使用し、その内容をデバッグします。</span><span class="sxs-lookup"><span data-stu-id="ab88c-135">We will examine using SQL Server Projects and debugging their contents in the next tutorial.</span></span>

<span data-ttu-id="ab88c-136">Visual Studio では、ローカルおよびリモートの SQL Server インスタンスでストアドプロシージャをデバッグできます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-136">Visual Studio can debug stored procedures on local and remote SQL Server instances.</span></span> <span data-ttu-id="ab88c-137">ローカル SQL Server インスタンスは、Visual Studio と同じコンピューターにインストールされています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-137">A local SQL Server instance is one that is installed on the same machine as Visual Studio.</span></span> <span data-ttu-id="ab88c-138">使用している SQL Server データベースが開発用コンピューターに配置されていない場合は、リモートインスタンスと見なされます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-138">If the SQL Server database you are using is not located on your development machine, then it is considered a remote instance.</span></span> <span data-ttu-id="ab88c-139">これらのチュートリアルでは、ローカル SQL Server インスタンスを使用しています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-139">For these tutorials we have been using local SQL Server instances.</span></span> <span data-ttu-id="ab88c-140">リモート SQL server インスタンスでストアドプロシージャをデバッグするには、ローカルインスタンスでストアドプロシージャをデバッグする場合よりも多くの構成手順が必要です。</span><span class="sxs-lookup"><span data-stu-id="ab88c-140">Debugging stored procedures on a remote SQL server instance requires more configuration steps than when debugging stored procedures on a local instance.</span></span>

<span data-ttu-id="ab88c-141">ローカル SQL Server インスタンスを使用している場合は、手順1から開始して、このチュートリアルを最後まで実行できます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-141">If you are using a local SQL Server instance, you can start with Step 1 and work through this tutorial to the end.</span></span> <span data-ttu-id="ab88c-142">ただし、リモートの SQL Server インスタンスを使用している場合は、まず、リモートインスタンスで SQL Server ログインを持つ Windows ユーザーアカウントを使用して開発用コンピューターにログインするときに、デバッグを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-142">If you are using a remote SQL Server instance, however, you will first need to ensure that when debugging you are logged to your development machine with a Windows user account that has a SQL Server login on the remote instance.</span></span> <span data-ttu-id="ab88c-143">さらに、このデータベースログインと、実行中の ASP.NET アプリケーションからデータベースへの接続に使用されるデータベースログインの両方が、`sysadmin` ロールのメンバーである必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-143">Moreover, both this database login and the database login used to connect to the database from the running ASP.NET application must be members of the `sysadmin` role.</span></span> <span data-ttu-id="ab88c-144">Visual Studio の構成と SQL Server リモートインスタンスのデバッグの詳細については、このチュートリアルの最後にある「リモートインスタンスでの T-sql SQL Database オブジェクトのデバッグ」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ab88c-144">See the Debugging T-SQL Database Objects on Remote Instances section at the end of this tutorial for more information on configuring Visual Studio and SQL Server to debug a remote instance.</span></span>

<span data-ttu-id="ab88c-145">最後に、T-sql database オブジェクトのデバッグサポートは、.NET アプリケーションのデバッグサポートほど豊富な機能ではないことを理解しておいてください。</span><span class="sxs-lookup"><span data-stu-id="ab88c-145">Finally, understand that debugging support for T-SQL database objects is not as feature rich as debugging support for .NET applications.</span></span> <span data-ttu-id="ab88c-146">たとえば、ブレークポイントの条件とフィルターはサポートされていません。デバッグウィンドウのサブセットのみ使用できます。エディットコンティニュを使用することはできません。 [イミディエイト] ウィンドウは役に立たないように表示されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-146">For example, breakpoint conditions and filters are not supported, only a subset of the debugging windows are available, you cannot use Edit and Continue, the Immediate window is rendered useless, and so forth.</span></span> <span data-ttu-id="ab88c-147">詳細については[、「デバッガーのコマンドと機能に関する制限事項](https://msdn.microsoft.com/library/ms165035(VS.80).aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ab88c-147">See [Limitations on Debugger Commands and Features](https://msdn.microsoft.com/library/ms165035(VS.80).aspx) for more information.</span></span>

## <a name="step-1-directly-stepping-into-a-stored-procedure"></a><span data-ttu-id="ab88c-148">手順 1: ストアドプロシージャに直接ステップインする</span><span class="sxs-lookup"><span data-stu-id="ab88c-148">Step 1: Directly Stepping Into a Stored Procedure</span></span>

<span data-ttu-id="ab88c-149">Visual Studio を使用すると、データベースオブジェクトを簡単に直接デバッグできます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-149">Visual Studio makes it easy to directly debug a database object.</span></span> <span data-ttu-id="ab88c-150">ここでは、Direct Database デバッグ (DDD) 機能を使用して、Northwind データベースの `Products_SelectByCategoryID` ストアドプロシージャにステップインする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-150">Let s look at how to use the Direct Database Debugging (DDD) feature to step into the `Products_SelectByCategoryID` stored procedure in the Northwind database.</span></span> <span data-ttu-id="ab88c-151">名前が示すように、`Products_SelectByCategoryID` によって、特定のカテゴリの製品情報が返されます。「」では、[型指定されたデータセットの tableadapter チュートリアルに既存のストアドプロシージャを使用して](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)作成されました。</span><span class="sxs-lookup"><span data-stu-id="ab88c-151">As its name implies, `Products_SelectByCategoryID` returns product information for a particular category; it was created in the [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) tutorial.</span></span> <span data-ttu-id="ab88c-152">まず、サーバーエクスプローラーに移動し、Northwind データベースノードを展開します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-152">Start by going to the Server Explorer and expand the Northwind database node.</span></span> <span data-ttu-id="ab88c-153">次に、[ストアドプロシージャ] フォルダーをドリルダウンし、`Products_SelectByCategoryID` ストアドプロシージャを右クリックして、コンテキストメニューから [ストアドプロシージャにステップイン] オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-153">Next, drill down into the Stored Procedures folder, right-click on the `Products_SelectByCategoryID` stored procedure, and choose the Step Into Stored Procedure option from the context menu.</span></span> <span data-ttu-id="ab88c-154">これにより、デバッガーが開始されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-154">This will start the debugger.</span></span>

<span data-ttu-id="ab88c-155">`Products_SelectByCategoryID` ストアドプロシージャには `@CategoryID` 入力パラメーターが必要であるため、この値を指定するように求められます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-155">Since the `Products_SelectByCategoryID` stored procedure expects a `@CategoryID` input parameter, we are asked to provide this value.</span></span> <span data-ttu-id="ab88c-156">「1」と入力すると、飲み物に関する情報が返されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-156">Enter 1, which will return information about the beverages.</span></span>

![@CategoryID パラメーターに値1を使用します。](debugging-stored-procedures-cs/_static/image1.png)

<span data-ttu-id="ab88c-158">**図 1**: `@CategoryID` パラメーターに値1を使用する</span><span class="sxs-lookup"><span data-stu-id="ab88c-158">**Figure 1**: Use the Value 1 for the `@CategoryID` Parameter</span></span>

<span data-ttu-id="ab88c-159">`@CategoryID` パラメーターの値を指定すると、ストアドプロシージャが実行されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-159">After supplying the value for the `@CategoryID` parameter, the stored procedure is executed.</span></span> <span data-ttu-id="ab88c-160">ただし、完了まで実行されるのではなく、デバッガーは最初のステートメントで実行を停止します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-160">Rather than running to completion, though, the debugger halts execution on the first statement.</span></span> <span data-ttu-id="ab88c-161">余白の黄色の矢印は、ストアドプロシージャ内の現在の場所を示しています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-161">Note the yellow arrow in the margin, indicating the current location in the stored procedure.</span></span> <span data-ttu-id="ab88c-162">パラメーター値を表示および編集するには、ウォッチウィンドウを使用するか、ストアドプロシージャのパラメーター名の上にカーソルを合わせます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-162">You can view and edit parameter values through the Watch window or by hovering over the parameter name in the stored procedure.</span></span>

<span data-ttu-id="ab88c-163">[ストアドプロシージャの最初のステートメントでデバッガーが停止した ![](debugging-stored-procedures-cs/_static/image3.png)](debugging-stored-procedures-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="ab88c-163">[![The Debugger has Halted on the First Statement of the Stored Procedure](debugging-stored-procedures-cs/_static/image3.png)](debugging-stored-procedures-cs/_static/image2.png)</span></span>

<span data-ttu-id="ab88c-164">**図 2**: デバッガーがストアドプロシージャの最初のステートメントで停止した ([クリックすると、フルサイズの画像が表示](debugging-stored-procedures-cs/_static/image4.png)されます)</span><span class="sxs-lookup"><span data-stu-id="ab88c-164">**Figure 2**: The Debugger has Halted on the First Statement of the Stored Procedure ([Click to view full-size image](debugging-stored-procedures-cs/_static/image4.png))</span></span>

<span data-ttu-id="ab88c-165">ストアドプロシージャを一度に1つずつステップ実行するには、ツールバーの [ステップオーバー] ボタンをクリックするか、F10 キーを押します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-165">To step through the stored procedure one statement at a time, click the Step Over button in the Toolbar or hit the F10 key.</span></span> <span data-ttu-id="ab88c-166">`Products_SelectByCategoryID` ストアドプロシージャには1つの `SELECT` ステートメントが含まれているため、F10 キーを押すと、1つのステートメントがステップオーバーされ、ストアドプロシージャの実行が完了します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-166">The `Products_SelectByCategoryID` stored procedure contains a single `SELECT` statement, so hitting F10 will Step over the single statement and complete the execution of the stored procedure.</span></span> <span data-ttu-id="ab88c-167">ストアドプロシージャが完了すると、出力が出力ウィンドウに表示され、デバッガーが終了します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-167">After the stored procedure has completed, its output will appear in the Output window and the debugger will terminate.</span></span>

> [!NOTE]
> <span data-ttu-id="ab88c-168">T-sql のデバッグはステートメントレベルで行われます。`SELECT` ステートメントにステップインすることはできません。</span><span class="sxs-lookup"><span data-stu-id="ab88c-168">T-SQL debugging occurs at the statement level; you cannot Step into a `SELECT` statement.</span></span>

## <a name="step-2-configuring-the-website-for-application-debugging"></a><span data-ttu-id="ab88c-169">手順 2: アプリケーションデバッグ用に Web サイトを構成する</span><span class="sxs-lookup"><span data-stu-id="ab88c-169">Step 2: Configuring the Website for Application Debugging</span></span>

<span data-ttu-id="ab88c-170">ストアドプロシージャをサーバーエクスプローラーから直接デバッグすることは便利ですが、多くのシナリオでは、ストアドプロシージャが ASP.NET アプリケーションから呼び出されたときのデバッグに興味があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-170">While debugging a stored procedure directly from the Server Explorer is handy, in many scenarios we are more interested in debugging the stored procedure when it is called from our ASP.NET application.</span></span> <span data-ttu-id="ab88c-171">Visual Studio 内からストアドプロシージャにブレークポイントを追加し、ASP.NET アプリケーションのデバッグを開始できます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-171">We can add breakpoints to a stored procedure from within Visual Studio and then start debugging the ASP.NET application.</span></span> <span data-ttu-id="ab88c-172">ブレークポイントが設定されたストアドプロシージャがアプリケーションから呼び出されると、ブレークポイントで実行が停止し、ストアドプロシージャのパラメーター値を表示および変更し、ステートメントをステップ実行できます。手順1で行ったのと同じです。</span><span class="sxs-lookup"><span data-stu-id="ab88c-172">When a stored procedure with breakpoints is invoked from the application, execution will halt at the breakpoint and we can view and change the stored procedure s parameter values and step through its statements, just like we did in Step 1.</span></span>

<span data-ttu-id="ab88c-173">アプリケーションから呼び出されたストアドプロシージャのデバッグを開始する前に、ASP.NET web アプリケーションに SQL Server デバッガーとの統合を指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-173">Before we can start debugging stored procedures called from the application, we need to instruct the ASP.NET web application to integrate with the SQL Server debugger.</span></span> <span data-ttu-id="ab88c-174">まず、ソリューションエクスプローラー (`ASPNET_Data_Tutorial_74_CS`) の web サイト名を右クリックします。</span><span class="sxs-lookup"><span data-stu-id="ab88c-174">Start by right-clicking on the website name in the Solution Explorer (`ASPNET_Data_Tutorial_74_CS`).</span></span> <span data-ttu-id="ab88c-175">コンテキストメニューの [プロパティページ] オプションを選択し、左側の [開始オプション] 項目を選択して、[デバッガー] セクションの [SQL Server] チェックボックスをオンにします (図3を参照)。</span><span class="sxs-lookup"><span data-stu-id="ab88c-175">Choose the Property Pages option from the context menu, select the Start Options item on the left, and check the SQL Server checkbox in the Debuggers section (see Figure 3).</span></span>

<span data-ttu-id="ab88c-176">[[アプリケーション] プロパティページの [SQL Server] チェックボックスをオンに ![ます。](debugging-stored-procedures-cs/_static/image6.png)](debugging-stored-procedures-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="ab88c-176">[![Check the SQL Server Checkbox in the Application s Property Pages](debugging-stored-procedures-cs/_static/image6.png)](debugging-stored-procedures-cs/_static/image5.png)</span></span>

<span data-ttu-id="ab88c-177">**図 3**: アプリケーションのプロパティページの [SQL Server] チェックボックスをオン[にする (クリックすると、フルサイズの画像が表示](debugging-stored-procedures-cs/_static/image7.png)されます)</span><span class="sxs-lookup"><span data-stu-id="ab88c-177">**Figure 3**: Check the SQL Server Checkbox in the Application s Property Pages ([Click to view full-size image](debugging-stored-procedures-cs/_static/image7.png))</span></span>

<span data-ttu-id="ab88c-178">また、接続プールが無効になるように、アプリケーションで使用されるデータベース接続文字列を更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-178">Additionally, we need to update the database connection string used by the application so that connection pooling is disabled.</span></span> <span data-ttu-id="ab88c-179">データベースへの接続が切断されると、対応する `SqlConnection` オブジェクトが使用可能な接続のプールに配置されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-179">When a connection to a database is closed, the corresponding `SqlConnection` object is placed in a pool of available connections.</span></span> <span data-ttu-id="ab88c-180">データベースへの接続を確立するときに、新しい接続を作成して確立するのではなく、このプールから使用可能な接続オブジェクトを取得できます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-180">When establishing a connection to a database, an available connection object can be retrieved from this pool rather than having to create and establish a new connection.</span></span> <span data-ttu-id="ab88c-181">この接続オブジェクトのプーリングはパフォーマンスが向上し、既定で有効になっています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-181">This pooling of connection objects is a performance enhancement and is enabled by default.</span></span> <span data-ttu-id="ab88c-182">ただし、デバッグ時には、プールから取得した接続を操作するときにデバッグインフラストラクチャが正しく再確立されないため、接続プールを無効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-182">However, when debugging we want to turn off connection pooling because the debugging infrastructure is not correctly reestablished when working with a connection that was taken from the pool.</span></span>

<span data-ttu-id="ab88c-183">接続プールを無効にするには、`Web.config` の `NORTHWNDConnectionString` を更新して、`Pooling=false` 設定が含まれるようにします。</span><span class="sxs-lookup"><span data-stu-id="ab88c-183">To disabled connection pooling, update the `NORTHWNDConnectionString` in `Web.config` so that it includes the setting `Pooling=false` .</span></span>

[!code-xml[Main](debugging-stored-procedures-cs/samples/sample1.xml)]

> [!NOTE]
> <span data-ttu-id="ab88c-184">ASP.NET アプリケーションを使用して SQL Server のデバッグを終了したら、接続文字列から `Pooling` 設定を削除して (または `Pooling=true` に設定して)、接続プールを復元してください。</span><span class="sxs-lookup"><span data-stu-id="ab88c-184">Once you have finished debugging SQL Server through the ASP.NET application be sure to reinstate connection pooling by removing the `Pooling` setting from the connection string (or by setting it to `Pooling=true` ).</span></span>

<span data-ttu-id="ab88c-185">この時点で、ASP.NET アプリケーションは、Visual Studio が web アプリケーションから呼び出されたときに SQL Server データベースオブジェクトをデバッグできるように構成されています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-185">At this point the ASP.NET application has been configured to allow Visual Studio to debug SQL Server database objects when invoked through the web application.</span></span> <span data-ttu-id="ab88c-186">ここまでで、ブレークポイントをストアドプロシージャに追加し、デバッグを開始します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-186">All that remains now is to add a breakpoint to a stored procedure and start debugging!</span></span>

## <a name="step-3-adding-a-breakpoint-and-debugging"></a><span data-ttu-id="ab88c-187">手順 3: ブレークポイントとデバッグの追加</span><span class="sxs-lookup"><span data-stu-id="ab88c-187">Step 3: Adding a Breakpoint and Debugging</span></span>

<span data-ttu-id="ab88c-188">`Products_SelectByCategoryID` ストアドプロシージャを開き、`SELECT` ステートメントの先頭にブレークポイントを設定します。そのためには、適切な場所にある余白をクリックするか `SELECT` ステートメントの先頭にカーソルを置き、F9 キーを押します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-188">Open the `Products_SelectByCategoryID` stored procedure and set a breakpoint at the start of the `SELECT` statement by clicking in the margin at the appropriate place or by placing your cursor at the start of the `SELECT` statement and hitting F9.</span></span> <span data-ttu-id="ab88c-189">図4に示すように、ブレークポイントは、余白に赤い円として表示されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-189">As Figure 4 illustrates, the breakpoint appears as a red circle in the margin.</span></span>

<span data-ttu-id="ab88c-190">[Products_SelectByCategoryID ストアドプロシージャにブレークポイントを設定 ![には](debugging-stored-procedures-cs/_static/image9.png)](debugging-stored-procedures-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="ab88c-190">[![Set a Breakpoint in the Products_SelectByCategoryID Stored Procedure](debugging-stored-procedures-cs/_static/image9.png)](debugging-stored-procedures-cs/_static/image8.png)</span></span>

<span data-ttu-id="ab88c-191">**図 4**: `Products_SelectByCategoryID` ストアドプロシージャにブレークポイントを設定[する (クリックしてフルサイズの画像を表示する](debugging-stored-procedures-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="ab88c-191">**Figure 4**: Set a Breakpoint in the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](debugging-stored-procedures-cs/_static/image10.png))</span></span>

<span data-ttu-id="ab88c-192">クライアントアプリケーションを使用して SQL database オブジェクトをデバッグするには、アプリケーションのデバッグをサポートするようにデータベースを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-192">In order for a SQL database object to be debugged through a client application, it is imperative that the database be configured to support application debugging.</span></span> <span data-ttu-id="ab88c-193">最初にブレークポイントを設定すると、この設定は自動的にオンになりますが、再度確認することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ab88c-193">When you first set a breakpoint, this setting should automatically be switched on, but it is prudent to double-check.</span></span> <span data-ttu-id="ab88c-194">サーバーエクスプローラーの [`NORTHWND.MDF`] ノードを右クリックします。</span><span class="sxs-lookup"><span data-stu-id="ab88c-194">Right-click on the `NORTHWND.MDF` node in the Server Explorer.</span></span> <span data-ttu-id="ab88c-195">コンテキストメニューには、アプリケーションデバッグという名前のチェックされたメニュー項目が含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-195">The context menu should include a checked menu item named Application Debugging .</span></span>

![[アプリケーションデバッグ] オプションが有効になっていることを確認します。](debugging-stored-procedures-cs/_static/image11.png)

<span data-ttu-id="ab88c-197">**図 5**: アプリケーションのデバッグオプションが有効になっていることを確認する</span><span class="sxs-lookup"><span data-stu-id="ab88c-197">**Figure 5**: Ensure that the Application Debugging Option is Enabled</span></span>

<span data-ttu-id="ab88c-198">ブレークポイントを設定し、[アプリケーションデバッグ] オプションを有効にすると、ASP.NET アプリケーションから呼び出されたときにストアドプロシージャをデバッグする準備が整います。</span><span class="sxs-lookup"><span data-stu-id="ab88c-198">With the breakpoint set and the Application Debugging option enabled, we are ready to debug the stored procedure when called from the ASP.NET application.</span></span> <span data-ttu-id="ab88c-199">デバッガーを起動するには、[デバッグ] メニューに移動し、F5 キーを押すか、ツールバーの緑色の再生アイコンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="ab88c-199">Start the debugger by going to the Debug menu and choosing Start Debugging, by hitting F5, or by clicking the green play icon in the Toolbar.</span></span> <span data-ttu-id="ab88c-200">これにより、デバッガーが起動し、web サイトが起動します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-200">This will start the debugger and launch the website.</span></span>

<span data-ttu-id="ab88c-201">`Products_SelectByCategoryID` ストアドプロシージャは、型指定された[データセットの tableadapter チュートリアル用の既存のストアドプロシージャを使用して](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)、で作成されました。</span><span class="sxs-lookup"><span data-stu-id="ab88c-201">The `Products_SelectByCategoryID` stored procedure was created in the [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) tutorial.</span></span> <span data-ttu-id="ab88c-202">対応する web ページ (`~/AdvancedDAL/ExistingSprocs.aspx`) には、このストアドプロシージャによって返された結果を表示する GridView が含まれています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-202">Its corresponding web page (`~/AdvancedDAL/ExistingSprocs.aspx`) contains a GridView that displays the results returned by this stored procedure.</span></span> <span data-ttu-id="ab88c-203">ブラウザーでこのページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ab88c-203">Visit this page through the browser.</span></span> <span data-ttu-id="ab88c-204">ページに到達すると、`Products_SelectByCategoryID` ストアドプロシージャ内のブレークポイントにヒットし、Visual Studio に制御が返されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-204">Upon reaching the page, the breakpoint in the `Products_SelectByCategoryID` stored procedure will be hit and control returned to Visual Studio.</span></span> <span data-ttu-id="ab88c-205">手順1と同様に、ストアドプロシージャ s ステートメントをステップ実行し、パラメーター値を表示および変更することができます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-205">Just like in Step 1, you can step through the stored procedure s statements and view and modify the parameter values.</span></span>

<span data-ttu-id="ab88c-206">[ExistingSprocs .aspx ページが最初に飲み物を表示 ![](debugging-stored-procedures-cs/_static/image13.png)](debugging-stored-procedures-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="ab88c-206">[![The ExistingSprocs.aspx Page Initially Displays the Beverages](debugging-stored-procedures-cs/_static/image13.png)](debugging-stored-procedures-cs/_static/image12.png)</span></span>

<span data-ttu-id="ab88c-207">**図 6**: `ExistingSprocs.aspx` ページには、最初に飲み物が表示されます ([クリックすると、フルサイズの画像が表示](debugging-stored-procedures-cs/_static/image14.png)されます)</span><span class="sxs-lookup"><span data-stu-id="ab88c-207">**Figure 6**: The `ExistingSprocs.aspx` Page Initially Displays the Beverages ([Click to view full-size image](debugging-stored-procedures-cs/_static/image14.png))</span></span>

<span data-ttu-id="ab88c-208">[ストアドプロシージャ s のブレークポイントに達した ![](debugging-stored-procedures-cs/_static/image16.png)](debugging-stored-procedures-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="ab88c-208">[![The Stored Procedure s Breakpoint has been Reached](debugging-stored-procedures-cs/_static/image16.png)](debugging-stored-procedures-cs/_static/image15.png)</span></span>

<span data-ttu-id="ab88c-209">**図 7**: ストアドプロシージャ s のブレークポイントに達しました ([クリックすると、フルサイズの画像が表示](debugging-stored-procedures-cs/_static/image17.png)されます)</span><span class="sxs-lookup"><span data-stu-id="ab88c-209">**Figure 7**: The Stored Procedure s Breakpoint has been Reached ([Click to view full-size image](debugging-stored-procedures-cs/_static/image17.png))</span></span>

<span data-ttu-id="ab88c-210">図7のウォッチウィンドウに示すように、`@CategoryID` パラメーターの値は1です。</span><span class="sxs-lookup"><span data-stu-id="ab88c-210">As the Watch window in Figure 7 shows, the value of the `@CategoryID` parameter is 1.</span></span> <span data-ttu-id="ab88c-211">これは、[`ExistingSprocs.aspx`] ページで、[飲料] カテゴリの製品が最初に表示されるためです。これには、`CategoryID` 値が1になっています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-211">This is because the `ExistingSprocs.aspx` page initially displays products in the beverages category, which has a `CategoryID` value of 1.</span></span> <span data-ttu-id="ab88c-212">ドロップダウンリストから別のカテゴリを選択します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-212">Choose a different category from the drop-down list.</span></span> <span data-ttu-id="ab88c-213">これにより、ポストバックが発生し、`Products_SelectByCategoryID` ストアドプロシージャが再実行されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-213">Doing so causes a postback and re-executes the `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="ab88c-214">ブレークポイントは再びヒットしますが、今度は `@CategoryID` パラメーター s の値に、選択したドロップダウンリスト項目の `CategoryID`が反映されます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-214">The breakpoint is hit again, but this time the `@CategoryID` parameter s value reflects the selected drop-down list item s `CategoryID`.</span></span>

<span data-ttu-id="ab88c-215">[ドロップダウンリストから別のカテゴリを選択 ![には](debugging-stored-procedures-cs/_static/image19.png)](debugging-stored-procedures-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="ab88c-215">[![Choose a Different Category from the Drop-Down List](debugging-stored-procedures-cs/_static/image19.png)](debugging-stored-procedures-cs/_static/image18.png)</span></span>

<span data-ttu-id="ab88c-216">**図 8**: ドロップダウンリストから別のカテゴリを選択する ([クリックすると、フルサイズの画像が表示](debugging-stored-procedures-cs/_static/image20.png)されます)</span><span class="sxs-lookup"><span data-stu-id="ab88c-216">**Figure 8**: Choose a Different Category from the Drop-Down List ([Click to view full-size image](debugging-stored-procedures-cs/_static/image20.png))</span></span>

<span data-ttu-id="ab88c-217">[![@CategoryID パラメーターには、Web ページから選択されたカテゴリが反映されます。](debugging-stored-procedures-cs/_static/image22.png)](debugging-stored-procedures-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="ab88c-217">[![The @CategoryID Parameter Reflects the Category Selected from the Web Page](debugging-stored-procedures-cs/_static/image22.png)](debugging-stored-procedures-cs/_static/image21.png)</span></span>

<span data-ttu-id="ab88c-218">**図 9**: `@CategoryID` パラメーターには、Web ページから選択したカテゴリが反映されます ([クリックすると、フルサイズの画像が表示](debugging-stored-procedures-cs/_static/image23.png)されます)</span><span class="sxs-lookup"><span data-stu-id="ab88c-218">**Figure 9**: The `@CategoryID` Parameter Reflects the Category Selected from the Web Page ([Click to view full-size image](debugging-stored-procedures-cs/_static/image23.png))</span></span>

> [!NOTE]
> <span data-ttu-id="ab88c-219">[`ExistingSprocs.aspx`] ページにアクセスするときに `Products_SelectByCategoryID` ストアドプロシージャ内のブレークポイントにヒットしない場合は、[ASP.NET application s] プロパティページの [デバッガー] セクションで [SQL Server] チェックボックスがオンになっていること、接続プーリングが無効になっていること、および [データベース s アプリケーションデバッグ] オプションが有効になっていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-219">If the breakpoint in the `Products_SelectByCategoryID` stored procedure is not hit when visiting the `ExistingSprocs.aspx` page, make sure that the SQL Server checkbox has been checked in the Debuggers section of the ASP.NET application s Properties Page, that connection pooling has been disabled, and that the database s Application Debugging option is enabled.</span></span> <span data-ttu-id="ab88c-220">問題が解決しない場合は、Visual Studio を再起動して、もう一度やり直してください。</span><span class="sxs-lookup"><span data-stu-id="ab88c-220">If you re still having problems, restart Visual Studio and try again.</span></span>

## <a name="debugging-t-sql-database-objects-on-remote-instances"></a><span data-ttu-id="ab88c-221">リモートインスタンスでの T SQL Database オブジェクトのデバッグ</span><span class="sxs-lookup"><span data-stu-id="ab88c-221">Debugging T-SQL Database Objects on Remote Instances</span></span>

<span data-ttu-id="ab88c-222">SQL Server データベースインスタンスが Visual Studio と同じコンピューター上にある場合、Visual Studio を使用してデータベースオブジェクトをデバッグするのは非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="ab88c-222">Debugging database objects through Visual Studio is fairly straightforward when the SQL Server database instance is on the same machine as Visual Studio.</span></span> <span data-ttu-id="ab88c-223">ただし、SQL Server と Visual Studio が異なるコンピューターに存在する場合は、すべてが正常に動作するためには慎重に構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-223">However, if SQL Server and Visual Studio reside on different machines then some careful configuration is required to get everything working properly.</span></span> <span data-ttu-id="ab88c-224">ここでは、次の2つの主要なタスクに直面します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-224">There are two core tasks we are faced with:</span></span>

- <span data-ttu-id="ab88c-225">ADO.NET 経由でデータベースに接続するために使用されるログインが、`sysadmin` ロールに属していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-225">Ensure that the login used to connect to the database via ADO.NET belongs to the `sysadmin` role.</span></span>
- <span data-ttu-id="ab88c-226">開発用コンピューターの Visual Studio で使用されている Windows ユーザーアカウントが、`sysadmin` ロールに属している有効な SQL Server ログインアカウントであることを確認します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-226">Ensure that the Windows user account used by Visual Studio on the development machine is a valid SQL Server login account that belongs to the `sysadmin` role.</span></span>

<span data-ttu-id="ab88c-227">最初の手順は比較的簡単です。</span><span class="sxs-lookup"><span data-stu-id="ab88c-227">The first step is relatively straightforward.</span></span> <span data-ttu-id="ab88c-228">まず、ASP.NET アプリケーションからデータベースに接続するために使用するユーザーアカウントを特定し、SQL Server Management Studio から、そのログインアカウントを `sysadmin` ロールに追加します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-228">First, identify the user account used to connect to the database from the ASP.NET application and then, from SQL Server Management Studio, add that login account to the `sysadmin` role.</span></span>

<span data-ttu-id="ab88c-229">2番目のタスクでは、アプリケーションのデバッグに使用する Windows ユーザーアカウントが、リモートデータベースの有効なログインである必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-229">The second task requires that the Windows user account you use to debug the application be a valid login on the remote database.</span></span> <span data-ttu-id="ab88c-230">ただし、ワークステーションにログオンした Windows アカウントが SQL Server の有効なログインではない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-230">However, chances are the Windows account you logged on to your workstation with is not a valid login on SQL Server.</span></span> <span data-ttu-id="ab88c-231">特定のログインアカウントを SQL Server に追加するのではなく、一部の Windows ユーザーアカウントを SQL Server デバッグアカウントとして指定する方が適しています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-231">Rather than adding your particular login account to SQL Server, a better choice would be to designate some Windows user account as the SQL Server debugging account.</span></span> <span data-ttu-id="ab88c-232">次に、リモート SQL Server インスタンスのデータベースオブジェクトをデバッグするには、その Windows ログインアカウントの資格情報を使用して Visual Studio を実行します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-232">Then, to debug the database objects of a remote SQL Server instance, you would run Visual Studio using that Windows login account s credentials.</span></span>

<span data-ttu-id="ab88c-233">例を使用すると、わかりやすくなります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-233">An example should help clarify things.</span></span> <span data-ttu-id="ab88c-234">Windows ドメイン内に `SQLDebug` という名前の Windows アカウントがあると仮定します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-234">Imagine that there is a Windows account named `SQLDebug` within the Windows domain.</span></span> <span data-ttu-id="ab88c-235">このアカウントは、リモート SQL Server インスタンスに有効なログインとして追加し、`sysadmin` ロールのメンバーとして追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-235">This account would need to be added to the remote SQL Server instance as a valid login and as a member of the `sysadmin` role.</span></span> <span data-ttu-id="ab88c-236">次に、Visual Studio からリモート SQL Server インスタンスをデバッグするには、`SQLDebug` ユーザーとして Visual Studio を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-236">Then, to debug the remote SQL Server instance from Visual Studio, we would need to run Visual Studio as the `SQLDebug` user.</span></span> <span data-ttu-id="ab88c-237">これを行うには、ワークステーションからログアウトし、`SQLDebug`としてログインした後、Visual Studio を起動しますが、より簡単な方法は、独自の資格情報を使用してワークステーションにログインし、`runas.exe` を使用して `SQLDebug` ユーザーとして Visual Studio を起動することです。</span><span class="sxs-lookup"><span data-stu-id="ab88c-237">This could be done by logging out of our workstation, logging back in as `SQLDebug`, and then launching Visual Studio, but a simpler approach would be to login to our workstation using our own credentials and then use `runas.exe` to launch Visual Studio as the `SQLDebug` user.</span></span> <span data-ttu-id="ab88c-238">`runas.exe` を使用すると、特定のアプリケーションを別のユーザーアカウントの guise で実行できます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-238">`runas.exe` allows a particular application to be executed under the guise of a different user account.</span></span> <span data-ttu-id="ab88c-239">`SQLDebug`として Visual Studio を起動するには、コマンドラインで次のステートメントを入力します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-239">To launch Visual Studio as `SQLDebug`, you could enter the following statement at the command line:</span></span>

[!code-console[Main](debugging-stored-procedures-cs/samples/sample2.cmd)]

<span data-ttu-id="ab88c-240">このプロセスの詳細については、 *Visual Studio と SQL Server、7番目のエディション*の「[ウィリアム R. Vaughn](http://betav.com/BLOG/billva/) s ヒットガイド」、および「[方法: デバッグのための SQL Server アクセス許可を設定する](https://msdn.microsoft.com/library/w1bhybwz(VS.80).aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ab88c-240">For a more detailed explanation on this process, see [William R. Vaughn](http://betav.com/BLOG/billva/) s *Hitchhiker s Guide to Visual Studio and SQL Server, Seventh Edition* as well as [How To: Set SQL Server Permissions for Debugging](https://msdn.microsoft.com/library/w1bhybwz(VS.80).aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="ab88c-241">開発用コンピューターで Windows XP Service Pack 2 が実行されている場合は、リモートデバッグを許可するようにインターネット接続ファイアウォールを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-241">If your development machine is running Windows XP Service Pack 2 you will need to configure the Internet Connection Firewall to allow remote debugging.</span></span> <span data-ttu-id="ab88c-242">「[方法: SQL Server 2005 デバッグを有効](https://msdn.microsoft.com/library/s0fk6z6e(VS.80).aspx)にする」の記事では、Visual Studio ホストコンピューターでの2つの手順 (a) が必要であることに注意してください。 `Devenv.exe` を例外の一覧に追加し、TCP 135 ポートを開く必要があります。リモート (SQL) マシンでは、(b) TCP 135 ポートを開き、`sqlservr.exe` を例外一覧に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-242">[The How To: Enable SQL Server 2005 Debugging](https://msdn.microsoft.com/library/s0fk6z6e(VS.80).aspx) article notes that this involves two steps: (a) On the Visual Studio host machine, you must add `Devenv.exe` to the Exceptions list and open the TCP 135 port; and (b) On the remote (SQL) machine, you must open the TCP 135 port and add `sqlservr.exe` to the Exceptions list.</span></span> <span data-ttu-id="ab88c-243">ドメインポリシーで IPSec 経由でネットワーク通信を行う必要がある場合は、UDP 4500 および UDP 500 ポートを開く必要があります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-243">If your domain policy requires network communication to be done through IPSec, you must open the UDP 4500 and UDP 500 ports.</span></span>

## <a name="summary"></a><span data-ttu-id="ab88c-244">要約</span><span class="sxs-lookup"><span data-stu-id="ab88c-244">Summary</span></span>

<span data-ttu-id="ab88c-245">Visual Studio では、.NET アプリケーションコードに対してデバッグサポートを提供するだけでなく、SQL Server 2005 用のさまざまなデバッグオプションも用意されています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-245">In addition to providing debugging support for .NET application code, Visual Studio also provides a variety of debugging options for SQL Server 2005.</span></span> <span data-ttu-id="ab88c-246">このチュートリアルでは、直接データベースデバッグとアプリケーションデバッグという2つのオプションについて説明しました。</span><span class="sxs-lookup"><span data-stu-id="ab88c-246">In this tutorial we looked at two of those options: Direct Database Debugging and application debugging.</span></span> <span data-ttu-id="ab88c-247">T-sql database オブジェクトを直接デバッグするには、サーバーエクスプローラーでオブジェクトを見つけて右クリックし、[ステップイン] を選択します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-247">To directly debug a T-SQL database object, locate the object through the Server Explorer then right-click on it and choose Step Into.</span></span> <span data-ttu-id="ab88c-248">これにより、デバッガーが起動し、データベースオブジェクトの最初のステートメントで停止します。この時点で、オブジェクトのステートメントをステップ実行し、パラメーター値を表示および変更できます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-248">This starts the debugger and halts on the first statement in the database object, at which point you can step through the object s statements and view and modify parameter values.</span></span> <span data-ttu-id="ab88c-249">手順1では、この方法を使用して `Products_SelectByCategoryID` ストアドプロシージャにステップインしました。</span><span class="sxs-lookup"><span data-stu-id="ab88c-249">In Step 1 we used this approach to step into the `Products_SelectByCategoryID` stored procedure.</span></span>

<span data-ttu-id="ab88c-250">アプリケーションのデバッグを使用すると、データベースオブジェクト内でブレークポイントを直接設定できます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-250">Application debugging allows breakpoints to be set directly within the database objects.</span></span> <span data-ttu-id="ab88c-251">ブレークポイントを持つデータベースオブジェクトがクライアントアプリケーション (ASP.NET web アプリケーションなど) から呼び出された場合、デバッガーが引き継ぐと、プログラムは停止します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-251">When a database object with breakpoints is invoked from a client application (such as an ASP.NET web application), the program halts as the debugger takes over.</span></span> <span data-ttu-id="ab88c-252">アプリケーションのデバッグは、特定のデータベースオブジェクトが呼び出されるアプリケーションアクションをより明確に示すため便利です。</span><span class="sxs-lookup"><span data-stu-id="ab88c-252">Application debugging is useful because it more clearly shows what application action causes a particular database object to be invoked.</span></span> <span data-ttu-id="ab88c-253">ただし、データベースの直接デバッグよりも少し多くの構成と設定が必要です。</span><span class="sxs-lookup"><span data-stu-id="ab88c-253">However, it requires a bit more configuration and setup than Direct Database Debugging.</span></span>

<span data-ttu-id="ab88c-254">データベースオブジェクトは、SQL Server プロジェクトでデバッグすることもできます。</span><span class="sxs-lookup"><span data-stu-id="ab88c-254">Database objects can also be debugged through SQL Server Projects.</span></span> <span data-ttu-id="ab88c-255">SQL Server プロジェクトの使用方法と、それらを使用して、次のチュートリアルでマネージデータベースオブジェクトを作成およびデバッグする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-255">We will look at using SQL Server Projects and how to use them to create and debug managed database objects in the next tutorial.</span></span>

<span data-ttu-id="ab88c-256">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="ab88c-256">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ab88c-257">作成者について</span><span class="sxs-lookup"><span data-stu-id="ab88c-257">About the Author</span></span>

<span data-ttu-id="ab88c-258">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-258">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ab88c-259">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="ab88c-259">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ab88c-260">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="ab88c-260">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ab88c-261">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ab88c-261">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="ab88c-262">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="ab88c-262">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ab88c-263">[前へ](protecting-connection-strings-and-other-configuration-information-cs.md)
> [次へ](creating-stored-procedures-and-user-defined-functions-with-managed-code-cs.md)</span><span class="sxs-lookup"><span data-stu-id="ab88c-263">[Previous](protecting-connection-strings-and-other-configuration-information-cs.md)
[Next](creating-stored-procedures-and-user-defined-functions-with-managed-code-cs.md)</span></span>
