---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-vb
title: DataTable 列を追加する (VB) |Microsoft Docs
author: rick-anderson
description: TableAdapter ウィザードを使用して型指定されたデータセットを作成する場合、対応する DataTable には、メインデータベースクエリによって返される列が含まれます。 しかし、
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 1e8e65f9-fe3e-4250-810b-c90227786bed
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-vb
msc.type: authoredcontent
ms.openlocfilehash: 3a55f8bc4d3508387927ca81674073a001867de7
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74608195"
---
# <a name="adding-additional-datatable-columns-vb"></a><span data-ttu-id="58bd8-104">その他の DataTable 列を追加する (VB)</span><span class="sxs-lookup"><span data-stu-id="58bd8-104">Adding Additional DataTable Columns (VB)</span></span>

<span data-ttu-id="58bd8-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="58bd8-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="58bd8-106">[コードのダウンロード](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_VB.zip)または[PDF のダウンロード](adding-additional-datatable-columns-vb/_static/datatutorial70vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="58bd8-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_VB.zip) or [Download PDF](adding-additional-datatable-columns-vb/_static/datatutorial70vb1.pdf)</span></span>

> <span data-ttu-id="58bd8-107">TableAdapter ウィザードを使用して型指定されたデータセットを作成する場合、対応する DataTable には、メインデータベースクエリによって返される列が含まれます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-107">When using the TableAdapter Wizard to create a Typed DataSet, the corresponding DataTable contains the columns returned by the main database query.</span></span> <span data-ttu-id="58bd8-108">ただし、DataTable に追加の列を含める必要がある場合もあります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-108">But there are occasions when the DataTable needs to include additional columns.</span></span> <span data-ttu-id="58bd8-109">このチュートリアルでは、追加の DataTable 列が必要な場合に、ストアドプロシージャを推奨する理由について説明します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-109">In this tutorial we learn why stored procedures are recommended when we need additional DataTable columns.</span></span>

## <a name="introduction"></a><span data-ttu-id="58bd8-110">はじめに</span><span class="sxs-lookup"><span data-stu-id="58bd8-110">Introduction</span></span>

<span data-ttu-id="58bd8-111">型指定されたデータセットに TableAdapter を追加する場合、対応する DataTable s スキーマは TableAdapter のメインクエリによって決定されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-111">When adding a TableAdapter to a Typed DataSet, the corresponding DataTable s schema is determined by the TableAdapter s main query.</span></span> <span data-ttu-id="58bd8-112">たとえば、メインクエリからデータフィールド*a*、 *b*、および*c*が返される場合、DataTable には、a、 *b*、および*c*という3つ*の*対応する列があります。TableAdapter には、メインのクエリに加えて、いくつかのパラメーターに基づいてデータのサブセットを返す追加のクエリを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-112">For example, if the main query returns data fields *A*, *B*, and *C*, the DataTable will have three corresponding columns named *A*, *B*, and *C*. In addition to its main query, a TableAdapter can include additional queries that return, perhaps, a subset of the data based on some parameter.</span></span> <span data-ttu-id="58bd8-113">たとえば、すべての製品に関する情報を返す `ProductsTableAdapter` s メインクエリに加えて、指定されたパラメーターに基づいて特定の製品情報を返す `GetProductsByCategoryID(categoryID)` や `GetProductByProductID(productID)`などのメソッドも含まれています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-113">For instance, in addition to the `ProductsTableAdapter` s main query, which returns information about all products, it also contains methods like `GetProductsByCategoryID(categoryID)` and `GetProductByProductID(productID)`, which return specific product information based on a supplied parameter.</span></span>

<span data-ttu-id="58bd8-114">DataTable s スキーマが TableAdapter s メインクエリを反映するモデルは、すべての TableAdapter のメソッドが、メインクエリで指定されたデータフィールドと同じかそれよりも少数のデータフィールドを返す場合に適しています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-114">The model of having the DataTable s schema reflect the TableAdapter s main query works well if all of the TableAdapter s methods return the same or fewer data fields than those specified in the main query.</span></span> <span data-ttu-id="58bd8-115">TableAdapter メソッドが追加のデータフィールドを返す必要がある場合は、それに応じて DataTable s スキーマを展開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-115">If a TableAdapter method needs to return additional data fields, then we should expand the DataTable s schema accordingly.</span></span> <span data-ttu-id="58bd8-116">[「詳細を含むマスターレコードの箇条書きリストを使用したマスター/詳細](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md)」では、メイン `NumberOfProducts`クエリに定義されている `CategoryID`、`CategoryName`、および `Description` のデータフィールドを返す `CategoriesTableAdapter` にメソッドを追加し、各カテゴリに関連付けられている製品の数を報告する追加のデータフィールドを追加しました。</span><span class="sxs-lookup"><span data-stu-id="58bd8-116">In the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) tutorial we added a method to the `CategoriesTableAdapter` that returned the `CategoryID`, `CategoryName`, and `Description` data fields defined in the main query plus `NumberOfProducts`, an additional data field that reported the number of products associated with each category.</span></span> <span data-ttu-id="58bd8-117">この新しいメソッドから `NumberOfProducts` データフィールドの値を取得するために、`CategoriesDataTable` に新しい列を手動で追加しました。</span><span class="sxs-lookup"><span data-stu-id="58bd8-117">We manually added a new column to the `CategoriesDataTable` in order to capture the `NumberOfProducts` data field value from this new method.</span></span>

<span data-ttu-id="58bd8-118">[ファイルのアップロード](../working-with-binary-files/uploading-files-vb.md)に関するチュートリアルで説明したように、アドホック SQL ステートメントを使用し、データフィールドがメインクエリと正確に一致しないメソッドがある tableadapter を使用して、細心の注意を払う必要があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-118">As discussed in the [Uploading Files](../working-with-binary-files/uploading-files-vb.md) tutorial, great care must be taken with TableAdapters that use ad-hoc SQL statements and have methods whose data fields do not precisely match the main query.</span></span> <span data-ttu-id="58bd8-119">TableAdapter 構成ウィザードを再実行すると、すべての TableAdapter のメソッドが更新され、データフィールドの一覧がメインクエリと一致するようになります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-119">If the TableAdapter Configuration wizard is re-run, it will update all of the TableAdapter s methods so that their data field list matches the main query.</span></span> <span data-ttu-id="58bd8-120">その結果、列リストがカスタマイズされたすべてのメソッドは、メインクエリの列リストに戻り、予想されるデータを返しません。</span><span class="sxs-lookup"><span data-stu-id="58bd8-120">Consequently, any methods with customized column lists will revert to the main query s column list and not return the expected data.</span></span> <span data-ttu-id="58bd8-121">この問題は、ストアドプロシージャを使用する場合には発生しません。</span><span class="sxs-lookup"><span data-stu-id="58bd8-121">This issue does not arise when using stored procedures.</span></span>

<span data-ttu-id="58bd8-122">このチュートリアルでは、DataTable s スキーマを拡張して列を追加する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-122">In this tutorial we will look at how to extend a DataTable s schema to include additional columns.</span></span> <span data-ttu-id="58bd8-123">このチュートリアルでは、アドホック SQL ステートメントを使用するときの TableAdapter の高まるにより、ストアドプロシージャを使用します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-123">Due to the brittleness of the TableAdapter when using ad-hoc SQL statements, in this tutorial we will use stored procedures.</span></span> <span data-ttu-id="58bd8-124">ストアドプロシージャを使用するように TableAdapter を構成する方法の詳細については、「型指定された[データセットの tableadapter 用に新しいストアドプロシージャを作成](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)する」および[「型指定](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)されたデータセットの tableadapter のチュートリアル」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="58bd8-124">Refer to the [Creating New Stored Procedures for the Typed DataSet s TableAdapters](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) and [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorials for more information on configuring a TableAdapter to use stored procedures.</span></span>

## <a name="step-1-adding-apricequartilecolumn-to-theproductsdatatable"></a><span data-ttu-id="58bd8-125">手順 1:`ProductsDataTable` に`PriceQuartile`列を追加する</span><span class="sxs-lookup"><span data-stu-id="58bd8-125">Step 1: Adding a`PriceQuartile`Column to the`ProductsDataTable`</span></span>

<span data-ttu-id="58bd8-126">「*型指定されたデータセットの tableadapter 用の新しいストアドプロシージャの作成*」チュートリアルでは、`NorthwindWithSprocs`という名前の型指定されたデータセットを作成しました。</span><span class="sxs-lookup"><span data-stu-id="58bd8-126">In the *Creating New Stored Procedures for the Typed DataSet s TableAdapters* tutorial we created a Typed DataSet named `NorthwindWithSprocs`.</span></span> <span data-ttu-id="58bd8-127">現在、このデータセットには、`ProductsDataTable` と `EmployeesDataTable`の2つの Datatable が含まれています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-127">This DataSet currently contains two DataTables: `ProductsDataTable` and `EmployeesDataTable`.</span></span> <span data-ttu-id="58bd8-128">`ProductsTableAdapter` には、次の3つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-128">The `ProductsTableAdapter` has the following three methods:</span></span>

- <span data-ttu-id="58bd8-129">`GetProducts`-`Products` テーブルからすべてのレコードを返すメインクエリ</span><span class="sxs-lookup"><span data-stu-id="58bd8-129">`GetProducts` - the main query, which returns all records from the `Products` table</span></span>
- <span data-ttu-id="58bd8-130">`GetProductsByCategoryID(categoryID)`-指定された*categoryID*を持つすべての製品を返します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-130">`GetProductsByCategoryID(categoryID)` - returns all products with the specified *categoryID*.</span></span>
- <span data-ttu-id="58bd8-131">`GetProductByProductID(productID)`-指定された*productID*を持つ特定の製品を返します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-131">`GetProductByProductID(productID)` - returns the particular product with the specified *productID*.</span></span>

<span data-ttu-id="58bd8-132">メインクエリと2つの追加のメソッドはすべて、同じデータフィールドのセットを返します。つまり、`Products` テーブルのすべての列が返されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-132">The main query and the two additional methods all return the same set of data fields, namely all of the columns from the `Products` table.</span></span> <span data-ttu-id="58bd8-133">相関サブクエリが存在しないか、`Categories` または `Suppliers` テーブルから関連データをプルして `JOIN`。</span><span class="sxs-lookup"><span data-stu-id="58bd8-133">There are no correlated subqueries or `JOIN` s pulling related data from the `Categories` or `Suppliers` tables.</span></span> <span data-ttu-id="58bd8-134">したがって、`ProductsDataTable` には、`Products` テーブル内の各フィールドに対応する列があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-134">Therefore, the `ProductsDataTable` has a corresponding column for each field in the `Products` table.</span></span>

<span data-ttu-id="58bd8-135">このチュートリアルでは、を使用して、すべての製品を返す `GetProductsWithPriceQuartile` という名前の `ProductsTableAdapter` にメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-135">For this tutorial, let s add a method to the `ProductsTableAdapter` named `GetProductsWithPriceQuartile` that returns all of the products.</span></span> <span data-ttu-id="58bd8-136">標準の製品データフィールドに加えて、`GetProductsWithPriceQuartile` には、製品の価格がどの四分の値に分類されるかを示す `PriceQuartile` データフィールドも含まれます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-136">In addition to the standard product data fields, `GetProductsWithPriceQuartile` will also include a `PriceQuartile` data field that indicates under which quartile the product s price falls.</span></span> <span data-ttu-id="58bd8-137">たとえば、価格が最も高価な25% の製品には `PriceQuartile` の値1が割り当てられ、下位25% に価格が設定されている製品の値は4になります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-137">For example, those products whose prices are in the most expensive 25% will have a `PriceQuartile` value of 1, while those whose prices fall in the bottom 25% will have a value of 4.</span></span> <span data-ttu-id="58bd8-138">ただし、この情報を返すストアドプロシージャを作成することを心配する前に、まず、`ProductsDataTable` を更新して、`GetProductsWithPriceQuartile` メソッドが使用されたときに `PriceQuartile` の結果を保持する列を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-138">Before we worry about creating the stored procedure to return this information, however, we first need to update the `ProductsDataTable` to include a column to hold the `PriceQuartile` results when the `GetProductsWithPriceQuartile` method is used.</span></span>

<span data-ttu-id="58bd8-139">`NorthwindWithSprocs` データセットを開き、`ProductsDataTable`を右クリックします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-139">Open the `NorthwindWithSprocs` DataSet and right-click on the `ProductsDataTable`.</span></span> <span data-ttu-id="58bd8-140">コンテキストメニューの [追加] をクリックし、[列] を選択します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-140">Choose Add from the context-menu and then pick Column.</span></span>

<span data-ttu-id="58bd8-141">[製品の Datatable に新しい列を追加 ![には](adding-additional-datatable-columns-vb/_static/image2.png)](adding-additional-datatable-columns-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-141">[![Add a New Column to the ProductsDataTable](adding-additional-datatable-columns-vb/_static/image2.png)](adding-additional-datatable-columns-vb/_static/image1.png)</span></span>

<span data-ttu-id="58bd8-142">**図 1**: `ProductsDataTable` に新しい列を追加する ([クリックすると、フルサイズの画像が表示](adding-additional-datatable-columns-vb/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="58bd8-142">**Figure 1**: Add a New Column to the `ProductsDataTable` ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image3.png))</span></span>

<span data-ttu-id="58bd8-143">これにより、`System.String`型の Column1 という名前の DataTable に新しい列が追加されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-143">This will add a new column to the DataTable named Column1 of type `System.String`.</span></span> <span data-ttu-id="58bd8-144">この列の名前を PriceQuartile に、その型を `System.Int32` に更新する必要があります。これは、1 ~ 4 の数値を保持するために使用されるためです。</span><span class="sxs-lookup"><span data-stu-id="58bd8-144">We need to update this column s name to PriceQuartile and its type to `System.Int32` since it will be used to hold a number between 1 and 4.</span></span> <span data-ttu-id="58bd8-145">`ProductsDataTable` で新しく追加された列を選択し、プロパティウィンドウの [`Name`] プロパティを [PriceQuartile] に設定し、[`DataType`] プロパティを [`System.Int32`] に設定します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-145">Select the newly-added column in the `ProductsDataTable` and, from the Properties window, set the `Name` property to PriceQuartile and the `DataType` property to `System.Int32`.</span></span>

<span data-ttu-id="58bd8-146">[新しい列の Name プロパティと DataType プロパティを設定 ![には](adding-additional-datatable-columns-vb/_static/image5.png)](adding-additional-datatable-columns-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-146">[![Set the New Column s Name and DataType Properties](adding-additional-datatable-columns-vb/_static/image5.png)](adding-additional-datatable-columns-vb/_static/image4.png)</span></span>

<span data-ttu-id="58bd8-147">**図 2**: 新しい列の `Name` と `DataType` プロパティの設定 ([クリックしてフルサイズの画像を表示](adding-additional-datatable-columns-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="58bd8-147">**Figure 2**: Set the New Column s `Name` and `DataType` Properties ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image6.png))</span></span>

<span data-ttu-id="58bd8-148">図2に示すように、設定できる追加のプロパティがあります。たとえば、列の値が一意である必要があるかどうか、列が自動インクリメント列であるかどうか、データベース `NULL` 値が許可されているかどうかなどです。</span><span class="sxs-lookup"><span data-stu-id="58bd8-148">As Figure 2 shows, there are additional properties that can be set, such as whether the values in the column must be unique, if the column is an auto-increment column, whether or not database `NULL` values are allowed, and so on.</span></span> <span data-ttu-id="58bd8-149">これらの値は既定値のままにしておきます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-149">Leave these values set to their defaults.</span></span>

## <a name="step-2-creating-thegetproductswithpricequartilemethod"></a><span data-ttu-id="58bd8-150">手順 2:`GetProductsWithPriceQuartile`メソッドの作成</span><span class="sxs-lookup"><span data-stu-id="58bd8-150">Step 2: Creating the`GetProductsWithPriceQuartile`Method</span></span>

<span data-ttu-id="58bd8-151">`PriceQuartile` 列を含むように `ProductsDataTable` が更新されたので、`GetProductsWithPriceQuartile` メソッドを作成する準備が整いました。</span><span class="sxs-lookup"><span data-stu-id="58bd8-151">Now that the `ProductsDataTable` has been updated to include the `PriceQuartile` column, we are ready to create the `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="58bd8-152">まず、TableAdapter を右クリックし、コンテキストメニューから [クエリの追加] を選択します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-152">Start by right-clicking on the TableAdapter and choosing Add Query from the context-menu.</span></span> <span data-ttu-id="58bd8-153">これにより、TableAdapter クエリの構成ウィザードが起動します。このウィザードでは、アドホック SQL ステートメントと新規または既存のストアドプロシージャのどちらを使用するかを確認するメッセージが最初に表示されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-153">This brings up the TableAdapter Query Configuration wizard, which first prompts us as to whether we want to use ad-hoc SQL statements or a new or existing stored procedure.</span></span> <span data-ttu-id="58bd8-154">価格の四分位データを返すストアドプロシージャはまだありません。そのため、では、TableAdapter によってこのストアドプロシージャを作成することが許可されています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-154">Since we don t yet have a stored procedure that returns the price quartile data, let s allow the TableAdapter to create this stored procedure for us.</span></span> <span data-ttu-id="58bd8-155">[新しいストアドプロシージャの作成] オプションを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-155">Select the Create new stored procedure option and click Next.</span></span>

<span data-ttu-id="58bd8-156">[![、TableAdapter ウィザードでストアドプロシージャを作成するように指示します。](adding-additional-datatable-columns-vb/_static/image8.png)](adding-additional-datatable-columns-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-156">[![Instruct the TableAdapter Wizard to Create the Stored Procedure For Us](adding-additional-datatable-columns-vb/_static/image8.png)](adding-additional-datatable-columns-vb/_static/image7.png)</span></span>

<span data-ttu-id="58bd8-157">**図 3**: TableAdapter ウィザードを使用して、ストアドプロシージャを作成するように指示する ([クリックすると、フルサイズの画像が表示](adding-additional-datatable-columns-vb/_static/image9.png)されます)</span><span class="sxs-lookup"><span data-stu-id="58bd8-157">**Figure 3**: Instruct the TableAdapter Wizard to Create the Stored Procedure For Us ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image9.png))</span></span>

<span data-ttu-id="58bd8-158">図4に示されている後続の画面では、ウィザードによって、追加するクエリの種類が表示されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-158">In the subsequent screen, shown in Figure 4, the wizard asks us what type of query to add.</span></span> <span data-ttu-id="58bd8-159">`GetProductsWithPriceQuartile` メソッドは `Products` テーブルからすべての列とレコードを返すため、[行を返す] オプションを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-159">Since the `GetProductsWithPriceQuartile` method will return all columns and records from the `Products` table, select the SELECT which returns rows option and click Next.</span></span>

<span data-ttu-id="58bd8-160">[クエリが複数行を返す SELECT ステートメントになる ![](adding-additional-datatable-columns-vb/_static/image11.png)](adding-additional-datatable-columns-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-160">[![Our Query will be a SELECT Statement that Returns Multiple Rows](adding-additional-datatable-columns-vb/_static/image11.png)](adding-additional-datatable-columns-vb/_static/image10.png)</span></span>

<span data-ttu-id="58bd8-161">**図 4**: クエリは複数の行を返す `SELECT` ステートメントです ([クリックすると、フルサイズの画像が表示](adding-additional-datatable-columns-vb/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="58bd8-161">**Figure 4**: Our Query will be a `SELECT` Statement that Returns Multiple Rows ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image12.png))</span></span>

<span data-ttu-id="58bd8-162">次に、`SELECT` クエリを入力するように求められます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-162">Next we are prompted for the `SELECT` query.</span></span> <span data-ttu-id="58bd8-163">ウィザードに次のクエリを入力します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-163">Enter the following query into the wizard:</span></span>

[!code-sql[Main](adding-additional-datatable-columns-vb/samples/sample1.sql)]

<span data-ttu-id="58bd8-164">上記のクエリでは、SQL Server 2005 s new [`NTILE` 関数](https://msdn.microsoft.com/library/ms175126.aspx)を使用して、結果を4つのグループに分割しています。このグループは、`UnitPrice` 値によって降順に並べ替えられています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-164">The above query uses SQL Server 2005 s new [`NTILE` function](https://msdn.microsoft.com/library/ms175126.aspx) to divide the results into four groups where the groups are determined by the `UnitPrice` values sorted in descending order.</span></span>

<span data-ttu-id="58bd8-165">残念ながら、クエリビルダーでは、`OVER` キーワードを解析する方法がわからず、上記のクエリの解析時にエラーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-165">Unfortunately, the Query Builder does not know how to parse the `OVER` keyword and will display an error when parsing the above query.</span></span> <span data-ttu-id="58bd8-166">そのため、クエリビルダーを使用せずに、ウィザードのテキストボックスに上記のクエリを直接入力します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-166">Therefore, enter the above query directly in the textbox in the wizard without using the Query Builder.</span></span>

> [!NOTE]
> <span data-ttu-id="58bd8-167">NTILE および SQL Server 2005 s その他の順位付け関数の詳細については、 [SQL Server 2005 オンラインブック](https://msdn.microsoft.com/library/ms189798.aspx)の「 [Microsoft SQL Server 2005 を使用](http://www.4guysfromrolla.com/webtech/010406-1.shtml)して順位付けされた結果を返す」および「[順位付け関数」](https://msdn.microsoft.com/library/ms189798.aspx)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="58bd8-167">For more information on NTILE and SQL Server 2005 s other ranking functions, see [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) and the [Ranking Functions section](https://msdn.microsoft.com/library/ms189798.aspx) from the [SQL Server 2005 Books Online](https://msdn.microsoft.com/library/ms189798.aspx).</span></span>

<span data-ttu-id="58bd8-168">`SELECT` クエリを入力して [次へ] をクリックすると、ウィザードによって作成されるストアドプロシージャの名前を入力するように求められます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-168">After entering the `SELECT` query and clicking Next, the wizard asks us to provide a name for the stored procedure it will create.</span></span> <span data-ttu-id="58bd8-169">新しいストアドプロシージャに `Products_SelectWithPriceQuartile` という名前を指定し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-169">Name the new stored procedure `Products_SelectWithPriceQuartile` and click Next.</span></span>

<span data-ttu-id="58bd8-170">[ストアドプロシージャの名前を ![Products_SelectWithPriceQuartile](adding-additional-datatable-columns-vb/_static/image14.png)](adding-additional-datatable-columns-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-170">[![Name the Stored Procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-vb/_static/image14.png)](adding-additional-datatable-columns-vb/_static/image13.png)</span></span>

<span data-ttu-id="58bd8-171">**図 5**: ストアドプロシージャの名前を `Products_SelectWithPriceQuartile`[にする (クリックすると、フルサイズの画像が表示](adding-additional-datatable-columns-vb/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="58bd8-171">**Figure 5**: Name the Stored Procedure `Products_SelectWithPriceQuartile` ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image15.png))</span></span>

<span data-ttu-id="58bd8-172">最後に、TableAdapter メソッドに名前を指定するように求められます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-172">Lastly, we are prompted to name the TableAdapter methods.</span></span> <span data-ttu-id="58bd8-173">[DataTable にデータを格納し、DataTable を返す] チェックボックスをオンのままにして、メソッドの名前を `FillWithPriceQuartile` と `GetProductsWithPriceQuartile`にします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-173">Leave both the Fill a DataTable and Return a DataTable checkboxes checked and name the methods `FillWithPriceQuartile` and `GetProductsWithPriceQuartile`.</span></span>

<span data-ttu-id="58bd8-174">[TableAdapter のメソッドに名前を ![、[完了] をクリックします。](adding-additional-datatable-columns-vb/_static/image17.png)](adding-additional-datatable-columns-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-174">[![Name the TableAdapter s Methods and Click Finish](adding-additional-datatable-columns-vb/_static/image17.png)](adding-additional-datatable-columns-vb/_static/image16.png)</span></span>

<span data-ttu-id="58bd8-175">**図 6**: TableAdapter のメソッドに名前を指定し、[完了][をクリックする (クリックすると、フルサイズの画像が表示](adding-additional-datatable-columns-vb/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="58bd8-175">**Figure 6**: Name the TableAdapter s Methods and Click Finish ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image18.png))</span></span>

<span data-ttu-id="58bd8-176">`SELECT` のクエリを指定し、ストアドプロシージャと TableAdapter メソッドをと共に使用して、[完了] をクリックしてウィザードを完了します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-176">With the `SELECT` query specified and the stored procedure and TableAdapter methods named, click Finish to complete the wizard.</span></span> <span data-ttu-id="58bd8-177">この時点で、`OVER` SQL コンストラクトまたはステートメントがサポートされていないことを示す警告がウィザードから表示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-177">At this point you may get a warning or two from the wizard saying that The `OVER` SQL construct or statement is not supported.</span></span> <span data-ttu-id="58bd8-178">これらの警告は無視してかまいません。</span><span class="sxs-lookup"><span data-stu-id="58bd8-178">These warnings can be ignored.</span></span>

<span data-ttu-id="58bd8-179">ウィザードが完了したら、TableAdapter に `FillWithPriceQuartile` メソッドと `GetProductsWithPriceQuartile` メソッドを含め、データベースに `Products_SelectWithPriceQuartile`という名前のストアドプロシージャを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-179">After completing the wizard, the TableAdapter should include the `FillWithPriceQuartile` and `GetProductsWithPriceQuartile` methods and the database should include a stored procedure named `Products_SelectWithPriceQuartile`.</span></span> <span data-ttu-id="58bd8-180">この新しいメソッドが TableAdapter に実際に含まれていること、およびストアドプロシージャがデータベースに正しく追加されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-180">Take a moment to verify that the TableAdapter does indeed contain this new method and that the stored procedure has been correctly added to the database.</span></span> <span data-ttu-id="58bd8-181">データベースをチェックするときに、ストアドプロシージャが表示されない場合は、[ストアドプロシージャ] フォルダーを右クリックして [最新の状態に更新] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-181">When checking the database, if you do not see the stored procedure try right-clicking on the Stored Procedures folder and choosing Refresh.</span></span>

![新しいメソッドが TableAdapter に追加されたことを確認する](adding-additional-datatable-columns-vb/_static/image19.png)

<span data-ttu-id="58bd8-183">**図 7**: 新しいメソッドが TableAdapter に追加されたことを確認する</span><span class="sxs-lookup"><span data-stu-id="58bd8-183">**Figure 7**: Verify that a New Method Has Been Added to the TableAdapter</span></span>

<span data-ttu-id="58bd8-184">[![データベースに Products_SelectWithPriceQuartile ストアドプロシージャが含まれていることを確認する](adding-additional-datatable-columns-vb/_static/image21.png)](adding-additional-datatable-columns-vb/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-184">[![Ensure that the Database Contains the Products_SelectWithPriceQuartile Stored Procedure](adding-additional-datatable-columns-vb/_static/image21.png)](adding-additional-datatable-columns-vb/_static/image20.png)</span></span>

<span data-ttu-id="58bd8-185">**図 8**: データベースに `Products_SelectWithPriceQuartile` ストアドプロシージャが含まれていることを確認[する (クリックしてフルサイズの画像を表示する](adding-additional-datatable-columns-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="58bd8-185">**Figure 8**: Ensure that the Database Contains the `Products_SelectWithPriceQuartile` Stored Procedure ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image22.png))</span></span>

> [!NOTE]
> <span data-ttu-id="58bd8-186">アドホック SQL ステートメントの代わりにストアドプロシージャを使用する利点の1つは、TableAdapter 構成ウィザードを再実行しても、[ストアドプロシージャ] 列の一覧が変更されないことです。</span><span class="sxs-lookup"><span data-stu-id="58bd8-186">One of the benefits of using stored procedures instead of ad-hoc SQL statements is that re-running the TableAdapter Configuration wizard will not modify the stored procedures column lists.</span></span> <span data-ttu-id="58bd8-187">これを確認するには、TableAdapter を右クリックし、コンテキストメニューから [構成] オプションを選択してウィザードを起動し、[完了] をクリックして完了します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-187">Verify this by right-clicking on the TableAdapter, choosing the Configure option from the context-menu to start the wizard, and then clicking Finish to complete it.</span></span> <span data-ttu-id="58bd8-188">次に、データベースにアクセスし、`Products_SelectWithPriceQuartile` ストアドプロシージャを表示します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-188">Next, go to the database and view the `Products_SelectWithPriceQuartile` stored procedure.</span></span> <span data-ttu-id="58bd8-189">列リストが変更されていないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="58bd8-189">Note that its column list has not been modified.</span></span> <span data-ttu-id="58bd8-190">アドホック SQL ステートメントを使用していたので、TableAdapter 構成ウィザードを再実行すると、メインクエリ列リストに一致するようにこのクエリの列リストが元に戻され、`GetProductsWithPriceQuartile` メソッドによって使用されるクエリから NTILE ステートメントが削除されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-190">Had we been using ad-hoc SQL statements, re-running the TableAdapter Configuration wizard would have reverted this query s column list to match the main query column list, thereby removing the NTILE statement from the query used by the `GetProductsWithPriceQuartile` method.</span></span>

<span data-ttu-id="58bd8-191">データアクセス層 s `GetProductsWithPriceQuartile` メソッドが呼び出されると、TableAdapter は `Products_SelectWithPriceQuartile` ストアドプロシージャを実行し、返された各レコードの `ProductsDataTable` に行を追加します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-191">When the Data Access Layer s `GetProductsWithPriceQuartile` method is invoked, the TableAdapter executes the `Products_SelectWithPriceQuartile` stored procedure and adds a row to the `ProductsDataTable` for each returned record.</span></span> <span data-ttu-id="58bd8-192">ストアドプロシージャによって返されるデータフィールドは、`ProductsDataTable` s 列にマップされます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-192">The data fields returned by the stored procedure are mapped to the `ProductsDataTable` s columns.</span></span> <span data-ttu-id="58bd8-193">ストアドプロシージャから返される `PriceQuartile` データフィールドがあるため、その値は `ProductsDataTable` s `PriceQuartile` 列に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-193">Since there is a `PriceQuartile` data field returned from the stored procedure, its value is assigned to the `ProductsDataTable` s `PriceQuartile` column.</span></span>

<span data-ttu-id="58bd8-194">クエリによって `PriceQuartile` データフィールドが返されない TableAdapter メソッドの場合、`PriceQuartile` 列の値はその `DefaultValue` プロパティによって指定された値になります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-194">For those TableAdapter methods whose queries do not return a `PriceQuartile` data field, the `PriceQuartile` column s value is the value specified by its `DefaultValue` property.</span></span> <span data-ttu-id="58bd8-195">図2に示すように、この値は `DBNull`(既定) に設定されています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-195">As Figure 2 shows, this value is set to `DBNull`, the default.</span></span> <span data-ttu-id="58bd8-196">別の既定値を使用する場合は、`DefaultValue` プロパティを適宜設定します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-196">If you would prefer a different default value, simply set the `DefaultValue` property accordingly.</span></span> <span data-ttu-id="58bd8-197">列 `DataType` (つまり、`PriceQuartile` 列の `System.Int32`) によって `DefaultValue` 値が有効であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="58bd8-197">Just make sure that the `DefaultValue` value is valid given the column s `DataType` (i.e., `System.Int32` for the `PriceQuartile` column).</span></span>

<span data-ttu-id="58bd8-198">この時点で、DataTable に列を追加するために必要な手順を実行しました。</span><span class="sxs-lookup"><span data-stu-id="58bd8-198">At this point we have performed the necessary steps for adding an additional column to a DataTable.</span></span> <span data-ttu-id="58bd8-199">この追加列が想定どおりに動作することを確認するには、ASP.NET ページを作成して、各製品の名前、価格、および価格の四分の1を表示します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-199">To verify that this additional column works as expected, let s create an ASP.NET page that displays each product s name, price, and price quartile.</span></span> <span data-ttu-id="58bd8-200">ただし、その前に、最初にビジネスロジックレイヤーを更新して、DAL の `GetProductsWithPriceQuartile` メソッドを呼び出すメソッドを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-200">Before we do that, though, we first need to update the Business Logic Layer to include a method that calls down to the DAL s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="58bd8-201">次に、手順 3. で [BLL] を更新してから、手順4で ASP.NET ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-201">We will update the BLL next, in Step 3, and then create the ASP.NET page in Step 4.</span></span>

## <a name="step-3-augmenting-the-business-logic-layer"></a><span data-ttu-id="58bd8-202">手順 3: ビジネスロジック層を補強する</span><span class="sxs-lookup"><span data-stu-id="58bd8-202">Step 3: Augmenting the Business Logic Layer</span></span>

<span data-ttu-id="58bd8-203">プレゼンテーション層から新しい `GetProductsWithPriceQuartile` メソッドを使用する前に、まず、対応するメソッドを BLL に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-203">Before we use the new `GetProductsWithPriceQuartile` method from the Presentation Layer, we should first add a corresponding method to the BLL.</span></span> <span data-ttu-id="58bd8-204">`ProductsBLLWithSprocs` クラスファイルを開き、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-204">Open the `ProductsBLLWithSprocs` class file and add the following code:</span></span>

[!code-vb[Main](adding-additional-datatable-columns-vb/samples/sample2.vb)]

<span data-ttu-id="58bd8-205">`ProductsBLLWithSprocs`の他のデータ取得メソッドと同様に、`GetProductsWithPriceQuartile` メソッドは単に、対応する `GetProductsWithPriceQuartile` メソッドを呼び出し、その結果を返します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-205">Like the other data retrieval methods in `ProductsBLLWithSprocs`, the `GetProductsWithPriceQuartile` method simply calls the DAL s corresponding `GetProductsWithPriceQuartile` method and returns its results.</span></span>

## <a name="step-4-displaying-the-price-quartile-information-in-an-aspnet-web-page"></a><span data-ttu-id="58bd8-206">手順 4: ASP.NET Web ページで価格の四分の情報を表示する</span><span class="sxs-lookup"><span data-stu-id="58bd8-206">Step 4: Displaying the Price Quartile Information in an ASP.NET Web Page</span></span>

<span data-ttu-id="58bd8-207">BLL の追加が完了したら、各製品の価格の ASP.NET を示すページを作成します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-207">With the BLL addition complete we re ready to create an ASP.NET page that shows the price quartile for each product.</span></span> <span data-ttu-id="58bd8-208">`AdvancedDAL` フォルダーの [`AddingColumns.aspx`] ページを開き、[ツールボックス] から GridView をデザイナーにドラッグし、`ID` プロパティを [`Products`] に設定します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-208">Open the `AddingColumns.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="58bd8-209">GridView s スマートタグから、`ProductsDataSource`という名前の新しい ObjectDataSource にバインドします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-209">From the GridView s smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="58bd8-210">`ProductsBLLWithSprocs` クラス s `GetProductsWithPriceQuartile` メソッドを使用するように ObjectDataSource を構成します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-210">Configure the ObjectDataSource to use the `ProductsBLLWithSprocs` class s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="58bd8-211">これは読み取り専用であるため、[更新]、[挿入]、[削除] の各タブのドロップダウンリストを [(なし)] に設定します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-211">Since this will be a read-only grid, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="58bd8-212">[製品 Bllwithsproc クラスを使用するように ObjectDataSource を構成 ![には](adding-additional-datatable-columns-vb/_static/image24.png)](adding-additional-datatable-columns-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-212">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](adding-additional-datatable-columns-vb/_static/image24.png)](adding-additional-datatable-columns-vb/_static/image23.png)</span></span>

<span data-ttu-id="58bd8-213">**図 9**: `ProductsBLLWithSprocs` クラスを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](adding-additional-datatable-columns-vb/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="58bd8-213">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image25.png))</span></span>

<span data-ttu-id="58bd8-214">[GetProductsWithPriceQuartile メソッドから製品情報を取得 ![には](adding-additional-datatable-columns-vb/_static/image27.png)](adding-additional-datatable-columns-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-214">[![Retrieve Product Information from the GetProductsWithPriceQuartile Method](adding-additional-datatable-columns-vb/_static/image27.png)](adding-additional-datatable-columns-vb/_static/image26.png)</span></span>

<span data-ttu-id="58bd8-215">**図 10**: `GetProductsWithPriceQuartile` メソッドから製品情報[を取得する (クリックすると、フルサイズの画像が表示](adding-additional-datatable-columns-vb/_static/image28.png)されます)</span><span class="sxs-lookup"><span data-stu-id="58bd8-215">**Figure 10**: Retrieve Product Information from the `GetProductsWithPriceQuartile` Method ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image28.png))</span></span>

<span data-ttu-id="58bd8-216">データソースの構成ウィザードを完了すると、Visual Studio によって、メソッドによって返される各データフィールドの GridView に BoundField または CheckBoxField が自動的に追加されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-216">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the data fields returned by the method.</span></span> <span data-ttu-id="58bd8-217">これらのデータフィールドの1つは `PriceQuartile`です。これは、手順 1. で `ProductsDataTable` に追加した列です。</span><span class="sxs-lookup"><span data-stu-id="58bd8-217">One of these data fields is `PriceQuartile`, which is the column we added to the `ProductsDataTable` in Step 1.</span></span>

<span data-ttu-id="58bd8-218">GridView のフィールドを編集し、`ProductName`、`UnitPrice`、および `PriceQuartile` BoundFields 以外はすべて削除します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-218">Edit the GridView s fields, removing all but the `ProductName`, `UnitPrice`, and `PriceQuartile` BoundFields.</span></span> <span data-ttu-id="58bd8-219">`UnitPrice` BoundField を構成して、その値を通貨として書式設定し、`UnitPrice` と `PriceQuartile` BoundFields をそれぞれ右および中央揃えに設定します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-219">Configure the `UnitPrice` BoundField to format its value as a currency and have the `UnitPrice` and `PriceQuartile` BoundFields right- and center-aligned, respectively.</span></span> <span data-ttu-id="58bd8-220">最後に、残りの BoundFields `HeaderText` プロパティを、それぞれ製品、価格、価格の4分の4に更新します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-220">Finally, update the remaining BoundFields `HeaderText` properties to Product, Price, and Price Quartile, respectively.</span></span> <span data-ttu-id="58bd8-221">また、GridView s スマートタグの [並べ替えを有効にする] チェックボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-221">Also, check the Enable Sorting checkbox from the GridView s smart tag.</span></span>

<span data-ttu-id="58bd8-222">これらの変更を加えた後、GridView および ObjectDataSource s 宣言マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-222">After these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](adding-additional-datatable-columns-vb/samples/sample3.aspx)]

<span data-ttu-id="58bd8-223">図11は、ブラウザーを使用してアクセスしたときのこのページを示しています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-223">Figure 11 shows this page when visited through a browser.</span></span> <span data-ttu-id="58bd8-224">初期状態では、各製品に適切な `PriceQuartile` 値が割り当てられ、製品の価格が降順で並べ替えられていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="58bd8-224">Note that, initially, the products are ordered by their price in descending order with each product assigned an appropriate `PriceQuartile` value.</span></span> <span data-ttu-id="58bd8-225">もちろん、このデータは他の条件で並べ替えることができます。価格の四分の列の値は、価格に関して製品のランク付けを反映しています (図12を参照)。</span><span class="sxs-lookup"><span data-stu-id="58bd8-225">Of course this data can be sorted by other criteria with the Price Quartile column value still reflecting the product s ranking with respect to price (see Figure 12).</span></span>

<span data-ttu-id="58bd8-226">[製品が価格順に並べられている ![](adding-additional-datatable-columns-vb/_static/image30.png)](adding-additional-datatable-columns-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-226">[![The Products are Ordered by their Prices](adding-additional-datatable-columns-vb/_static/image30.png)](adding-additional-datatable-columns-vb/_static/image29.png)</span></span>

<span data-ttu-id="58bd8-227">**図 11**: 製品が価格順に並べられている ([クリックすると、フルサイズの画像が表示](adding-additional-datatable-columns-vb/_static/image31.png)されます)</span><span class="sxs-lookup"><span data-stu-id="58bd8-227">**Figure 11**: The Products are Ordered by their Prices ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image31.png))</span></span>

<span data-ttu-id="58bd8-228">[製品が名前順に並んでいる ![](adding-additional-datatable-columns-vb/_static/image33.png)](adding-additional-datatable-columns-vb/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="58bd8-228">[![The Products are Ordered by their Names](adding-additional-datatable-columns-vb/_static/image33.png)](adding-additional-datatable-columns-vb/_static/image32.png)</span></span>

<span data-ttu-id="58bd8-229">**図 12**: 製品は名前順に並んでいます ([クリックすると、フルサイズの画像が表示](adding-additional-datatable-columns-vb/_static/image34.png)されます)</span><span class="sxs-lookup"><span data-stu-id="58bd8-229">**Figure 12**: The Products are Ordered by their Names ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image34.png))</span></span>

> [!NOTE]
> <span data-ttu-id="58bd8-230">数行のコードを使用して、`PriceQuartile` 値に基づいて製品の行を色分けするように GridView を拡張することができます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-230">With a few lines of code we could augment the GridView so that it colored the product rows based on their `PriceQuartile` value.</span></span> <span data-ttu-id="58bd8-231">これらの製品については、最初の4分の1番目の四分位に色を設定します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-231">We might color those products in the first quartile a light green, those in the second quartile a light yellow, and so forth.</span></span> <span data-ttu-id="58bd8-232">この機能を追加することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-232">I encourage you to take a moment to add this functionality.</span></span> <span data-ttu-id="58bd8-233">GridView の書式設定に関するリフレッシャーが必要な場合は、「[データに基づくカスタム書式](../custom-formatting/custom-formatting-based-upon-data-vb.md)設定」チュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="58bd8-233">If you need a refresher on formatting a GridView, consult the [Custom Formatting Based Upon Data](../custom-formatting/custom-formatting-based-upon-data-vb.md) tutorial.</span></span>

## <a name="an-alternative-approach---creating-another-tableadapter"></a><span data-ttu-id="58bd8-234">別の方法-別の TableAdapter の作成</span><span class="sxs-lookup"><span data-stu-id="58bd8-234">An Alternative Approach - Creating Another TableAdapter</span></span>

<span data-ttu-id="58bd8-235">このチュートリアルで説明したように、メインクエリでスペルが指定されていないデータフィールドを返す TableAdapter にメソッドを追加する場合、対応する列を DataTable に追加できます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-235">As we saw in this tutorial, when adding a method to a TableAdapter that returns data fields other than those spelled out by the main query, we can add corresponding columns to the DataTable.</span></span> <span data-ttu-id="58bd8-236">ただし、このような方法は、異なるデータフィールドを返す TableAdapter 内のメソッドの数が少ない場合や、それらの代替データフィールドがメインクエリによって大きく変化しない場合にのみ適しています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-236">Such an approach, however, works well only if there are a small number of methods in the TableAdapter that return different data fields and if those alternate data fields do not vary too much from the main query.</span></span>

<span data-ttu-id="58bd8-237">列を DataTable に追加するのではなく、別のデータフィールドを返す最初の TableAdapter のメソッドを含むデータセットに別の TableAdapter を追加することができます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-237">Rather than adding columns to the DataTable, you can instead add another TableAdapter to the DataSet that contains the methods from the first TableAdapter that return different data fields.</span></span> <span data-ttu-id="58bd8-238">このチュートリアルでは、`ProductsDataTable` (`GetProductsWithPriceQuartile` メソッドによってのみ使用されます) に `PriceQuartile` 列を追加するのではなく、`Products_SelectWithPriceQuartile` ストアドプロシージャをメインクエリとして使用した `ProductsWithPriceQuartileTableAdapter` という名前のデータセットに、追加の TableAdapter を追加することができます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-238">For this tutorial, rather than add the `PriceQuartile` column to the `ProductsDataTable` (where it is only used by the `GetProductsWithPriceQuartile` method), we could have added an additional TableAdapter to the DataSet named `ProductsWithPriceQuartileTableAdapter` that used the `Products_SelectWithPriceQuartile` stored procedure as its main query.</span></span> <span data-ttu-id="58bd8-239">価格の ASP.NET に製品情報を取得するために必要なページには、`ProductsWithPriceQuartileTableAdapter`が使用されていますが、`ProductsTableAdapter`の使用を継続できませんでした。</span><span class="sxs-lookup"><span data-stu-id="58bd8-239">ASP.NET pages that needed to get product information with the price quartile would use the `ProductsWithPriceQuartileTableAdapter`, while those that did not could continue to use the `ProductsTableAdapter`.</span></span>

<span data-ttu-id="58bd8-240">新しい TableAdapter を追加することにより、Datatable は untarnished を維持し、その列には TableAdapter のメソッドによって返されるデータフィールドが正確に反映されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-240">By adding a new TableAdapter, the DataTables remain untarnished and their columns precisely mirror the data fields returned by their TableAdapter s methods.</span></span> <span data-ttu-id="58bd8-241">ただし、追加の Tableadapter によって、反復的なタスクと機能が導入される場合があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-241">However, additional TableAdapters can introduce repetitive tasks and functionality.</span></span> <span data-ttu-id="58bd8-242">たとえば、`PriceQuartile` 列を表示するこれらの ASP.NET ページにも、挿入、更新、および削除のサポートが必要な場合、`ProductsWithPriceQuartileTableAdapter` には、`InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティが正しく構成されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-242">For example, if those ASP.NET pages that displayed the `PriceQuartile` column also needed to provide insert, update, and delete support, the `ProductsWithPriceQuartileTableAdapter` would need to have its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties properly configured.</span></span> <span data-ttu-id="58bd8-243">これらのプロパティは `ProductsTableAdapter` をミラー化しますが、この構成では追加の手順が導入されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-243">While these properties would mirror the `ProductsTableAdapter` s, this configuration introduces an extra step.</span></span> <span data-ttu-id="58bd8-244">さらに、データベースに対して製品を更新、削除、または追加するには、`ProductsTableAdapter` と `ProductsWithPriceQuartileTableAdapter` のクラスを使用する2つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-244">Moreover, there are now two ways to update, delete, or add a product to the database - through the `ProductsTableAdapter` and `ProductsWithPriceQuartileTableAdapter` classes.</span></span>

<span data-ttu-id="58bd8-245">このチュートリアルのダウンロードには、この代替アプローチを示す `ProductsWithPriceQuartileTableAdapter` クラスが `NorthwindWithSprocs` データセットに含まれています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-245">The download for this tutorial includes a `ProductsWithPriceQuartileTableAdapter` class in the `NorthwindWithSprocs` DataSet that illustrates this alternative approach.</span></span>

## <a name="summary"></a><span data-ttu-id="58bd8-246">要約</span><span class="sxs-lookup"><span data-stu-id="58bd8-246">Summary</span></span>

<span data-ttu-id="58bd8-247">ほとんどのシナリオでは、TableAdapter 内のすべてのメソッドは同じデータフィールドのセットを返しますが、特定のメソッドまたは2が追加のフィールドを返す必要がある場合もあります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-247">In most scenarios, all of the methods in a TableAdapter will return the same set of data fields, but there are times when a particular method or two may need to return an additional field.</span></span> <span data-ttu-id="58bd8-248">たとえば、マスター[レコードの箇条書きリストを使用した、詳細データを含むマスターレコードの一覧を使用したマスター/詳細](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md)のチュートリアルでは、`CategoriesTableAdapter` にメソッドを追加しました。このメソッドは、メインクエリ s のデータフィールドに加えて、各カテゴリに関連付けられている製品の数を報告する `NumberOfProducts` フィールドを返しました。</span><span class="sxs-lookup"><span data-stu-id="58bd8-248">For example, in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) tutorial we added a method to the `CategoriesTableAdapter` that, in addition to the main query s data fields, returned a `NumberOfProducts` field that reported the number of products associated with each category.</span></span> <span data-ttu-id="58bd8-249">このチュートリアルでは、メインのクエリ s データフィールドに加えて、`PriceQuartile` フィールドを返す `ProductsTableAdapter` にメソッドを追加する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="58bd8-249">In this tutorial we looked at adding a method in the `ProductsTableAdapter` that returned a `PriceQuartile` field in addition to the main query s data fields.</span></span> <span data-ttu-id="58bd8-250">TableAdapter のメソッドによって返された追加のデータフィールドを取得するには、対応する列を DataTable に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-250">To capture additional data fields returned by the TableAdapter s methods we need to add corresponding columns to the DataTable.</span></span>

<span data-ttu-id="58bd8-251">DataTable に列を手動で追加する予定の場合は、TableAdapter でストアドプロシージャを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-251">If you plan on manually adding columns to the DataTable, it is recommended that the TableAdapter use stored procedures.</span></span> <span data-ttu-id="58bd8-252">TableAdapter がアドホック SQL ステートメントを使用する場合、TableAdapter 構成ウィザードを実行するたびに、すべてのメソッドのデータフィールドリストがメインクエリによって返されるデータフィールドに戻されます。</span><span class="sxs-lookup"><span data-stu-id="58bd8-252">If the TableAdapter uses ad-hoc SQL statements, any time the TableAdapter Configuration wizard is run all of the methods data field lists revert to the data fields returned by the main query.</span></span> <span data-ttu-id="58bd8-253">この問題は、ストアドプロシージャには適用されません。そのため、このチュートリアルでは、この問題を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="58bd8-253">This problem does not extend to stored procedures, which is why they are recommended and were used in this tutorial.</span></span>

<span data-ttu-id="58bd8-254">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="58bd8-254">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="58bd8-255">作成者について</span><span class="sxs-lookup"><span data-stu-id="58bd8-255">About the Author</span></span>

<span data-ttu-id="58bd8-256">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="58bd8-257">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="58bd8-257">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="58bd8-258">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="58bd8-258">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="58bd8-259">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="58bd8-259">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="58bd8-260">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="58bd8-260">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="58bd8-261">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="58bd8-261">Special Thanks To</span></span>

<span data-ttu-id="58bd8-262">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="58bd8-262">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="58bd8-263">このチュートリアルのリードレビュー担当者は、Randy/Jacky Goor、Bernadette Leigh、Hilton Giesenow でした。</span><span class="sxs-lookup"><span data-stu-id="58bd8-263">Lead reviewers for this tutorial were Randy Schmidt, Jacky Goor, Bernadette Leigh, and Hilton Giesenow.</span></span> <span data-ttu-id="58bd8-264">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="58bd8-264">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="58bd8-265">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="58bd8-265">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="58bd8-266">[前へ](updating-the-tableadapter-to-use-joins-vb.md)
> [次へ](working-with-computed-columns-vb.md)</span><span class="sxs-lookup"><span data-stu-id="58bd8-266">[Previous](updating-the-tableadapter-to-use-joins-vb.md)
[Next](working-with-computed-columns-vb.md)</span></span>
