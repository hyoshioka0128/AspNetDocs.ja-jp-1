---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs
title: 挿入、更新、および削除に関連付けられてC#いるイベントを調べる () |Microsoft Docs
author: rick-anderson
description: このチュートリアルでは、ASP.NET データ Web コントロールの挿入、更新、または削除操作の前後に発生するイベントを使用します。 W...
ms.author: riande
ms.date: 07/17/2006
ms.assetid: dab291a0-a8b5-46fa-9dd8-3d35b249201f
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs
msc.type: authoredcontent
ms.openlocfilehash: a8c1388b73524a8bb918b67aa265db894c07636f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78493426"
---
# <a name="examining-the-events-associated-with-inserting-updating-and-deleting-c"></a><span data-ttu-id="c6ac6-104">挿入、更新、削除に関連付けられているイベントを調べる (C#)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-104">Examining the Events Associated with Inserting, Updating, and Deleting (C#)</span></span>

<span data-ttu-id="c6ac6-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c6ac6-106">[サンプルアプリのダウンロード](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_CS.exe)または[PDF のダウンロード](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/datatutorial17cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_CS.exe) or [Download PDF](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/datatutorial17cs1.pdf)</span></span>

> <span data-ttu-id="c6ac6-107">このチュートリアルでは、ASP.NET データ Web コントロールの挿入、更新、または削除操作の前後に発生するイベントを使用します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-107">In this tutorial we'll examine using the events that occur before, during, and after an insert, update, or delete operation of an ASP.NET data Web control.</span></span> <span data-ttu-id="c6ac6-108">また、製品フィールドのサブセットのみを更新するように編集インターフェイスをカスタマイズする方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-108">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>

## <a name="introduction"></a><span data-ttu-id="c6ac6-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="c6ac6-109">Introduction</span></span>

<span data-ttu-id="c6ac6-110">GridView、DetailsView、または FormView コントロールの組み込みの挿入、編集、または削除機能を使用する場合、エンドユーザーが新しいレコードを追加したり、既存のレコードを更新または削除したりするプロセスを完了すると、さまざまな手順が実行されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-110">When using the built-in inserting, editing, or deleting features of the GridView, DetailsView, or FormView controls, a variety of steps transpire when the end user completes the process of adding a new record or updating or deleting an existing record.</span></span> <span data-ttu-id="c6ac6-111">[前のチュートリアル](an-overview-of-inserting-updating-and-deleting-data-cs.md)で説明したように、GridView で行が編集されると、[編集] ボタンが [Update] ボタンと [Cancel] ボタンに置き換えられ、Boundfields がテキストボックスに変わります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-111">As we discussed in the [previous tutorial](an-overview-of-inserting-updating-and-deleting-data-cs.md), when a row is edited in the GridView the Edit button is replaced by Update and Cancel buttons and the BoundFields turn into TextBoxes.</span></span> <span data-ttu-id="c6ac6-112">エンドユーザーがデータを更新して [更新] をクリックすると、次の手順がポストバック時に実行されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-112">After the end user updates the data and clicks Update, the following steps are performed on postback:</span></span>

1. <span data-ttu-id="c6ac6-113">GridView では、ObjectDataSource の `UpdateParameters` が、ユーザーが入力した値と共に、編集されたレコードの一意の識別フィールド (`DataKeyNames` プロパティを介して) に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-113">The GridView populates its ObjectDataSource's `UpdateParameters` with the edited record's unique identifying field(s) (via the `DataKeyNames` property) along with the values entered by the user</span></span>
2. <span data-ttu-id="c6ac6-114">GridView は、ObjectDataSource の `Update()` メソッドを呼び出します。このメソッドは、基になるオブジェクト (前のチュートリアルでは`ProductsDAL.UpdateProduct`) の適切なメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-114">The GridView invokes its ObjectDataSource's `Update()` method, which in turn invokes the appropriate method in the underlying object (`ProductsDAL.UpdateProduct`, in our previous tutorial)</span></span>
3. <span data-ttu-id="c6ac6-115">基になるデータ (更新された変更が含まれる) は、GridView に再バインドされます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-115">The underlying data, which now includes the updated changes, is rebound to the GridView</span></span>

<span data-ttu-id="c6ac6-116">この一連の手順では、いくつかのイベントが発生し、必要に応じてカスタムロジックを追加するためのイベントハンドラーを作成できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-116">During this sequence of steps, a number of events fire, enabling us to create event handlers to add custom logic where needed.</span></span> <span data-ttu-id="c6ac6-117">たとえば、手順1の前に、GridView の `RowUpdating` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-117">For example, prior to Step 1, the GridView's `RowUpdating` event fires.</span></span> <span data-ttu-id="c6ac6-118">この時点で、検証エラーが発生した場合に更新要求を取り消すことができます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-118">We can, at this point, cancel the update request if there is some validation error.</span></span> <span data-ttu-id="c6ac6-119">`Update()` メソッドが呼び出されると、ObjectDataSource の `Updating` イベントが発生し、`UpdateParameters`の値を追加またはカスタマイズできるようになります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-119">When the `Update()` method is invoked, the ObjectDataSource's `Updating` event fires, providing an opportunity to add or customize the values of any of the `UpdateParameters`.</span></span> <span data-ttu-id="c6ac6-120">ObjectDataSource の基になるオブジェクトのメソッドの実行が完了すると、ObjectDataSource の `Updated` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-120">After the ObjectDataSource's underlying object's method has completed executing, the ObjectDataSource's `Updated` event is raised.</span></span> <span data-ttu-id="c6ac6-121">`Updated` イベントのイベントハンドラーは、影響を受けた行の数や、例外が発生したかどうかなど、更新操作の詳細を調べることができます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-121">An event handler for the `Updated` event can inspect the details about the update operation, such as how many rows were affected and whether or not an exception occurred.</span></span> <span data-ttu-id="c6ac6-122">最後に、手順2の後に、GridView の `RowUpdated` イベントが発生します。このイベントのイベントハンドラーでは、実行した更新操作に関する追加情報を調べることができます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-122">Finally, after Step 2, the GridView's `RowUpdated` event fires; an event handler for this event can examine additional information about the update operation just performed.</span></span>

<span data-ttu-id="c6ac6-123">図1は、GridView を更新するときのこの一連のイベントと手順を示しています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-123">Figure 1 depicts this series of events and steps when updating a GridView.</span></span> <span data-ttu-id="c6ac6-124">図1のイベントパターンは、GridView による更新には固有ではありません。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-124">The event pattern in Figure 1 is not unique to updating with a GridView.</span></span> <span data-ttu-id="c6ac6-125">GridView、DetailsView、または FormView からデータを挿入、更新、または削除すると、データ Web コントロールと ObjectDataSource の両方について、同じ順序で precipitates イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-125">Inserting, updating, or deleting data from the GridView, DetailsView, or FormView precipitates the same sequence of pre- and post-level events for both the data Web control and the ObjectDataSource.</span></span>

<span data-ttu-id="c6ac6-126">[GridView のデータを更新するときに一連のイベントが発生し ![](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-126">[![A Series of Pre- and Post-Events Fire When Updating Data in a GridView](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image1.png)</span></span>

<span data-ttu-id="c6ac6-127">**図 1**: GridView のデータを更新するときに一連のイベントが発生し、イベントが発生します ([クリックすると、フルサイズのイメージが表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-127">**Figure 1**: A Series of Pre- and Post-Events Fire When Updating Data in a GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image3.png))</span></span>

<span data-ttu-id="c6ac6-128">このチュートリアルでは、これらのイベントを使用して、ASP.NET data Web コントロールの組み込みの挿入、更新、および削除機能を拡張します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-128">In this tutorial we'll examine using these events to extend the built-in inserting, updating, and deleting capabilities of the ASP.NET data Web controls.</span></span> <span data-ttu-id="c6ac6-129">また、製品フィールドのサブセットのみを更新するように編集インターフェイスをカスタマイズする方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-129">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>

## <a name="step-1-updating-a-productsproductnameandunitpricefields"></a><span data-ttu-id="c6ac6-130">手順 1: 製品の`ProductName`と`UnitPrice`のフィールドの更新</span><span class="sxs-lookup"><span data-stu-id="c6ac6-130">Step 1: Updating a Product's`ProductName`and`UnitPrice`Fields</span></span>

<span data-ttu-id="c6ac6-131">前のチュートリアルの編集インターフェイスでは、読み取り専用ではない*すべて*の product フィールドを含める必要がありました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-131">In the editing interfaces from the previous tutorial *all* product fields that were not read-only had to be included.</span></span> <span data-ttu-id="c6ac6-132">GridView からフィールドを削除する場合 `QuantityPerUnit`-データを更新するときに、データ Web コントロールは ObjectDataSource の `QuantityPerUnit` `UpdateParameters` 値を設定しません。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-132">If we were to remove a field from the GridView - say `QuantityPerUnit` - when updating the data the data Web control would not set the ObjectDataSource's `QuantityPerUnit` `UpdateParameters` value.</span></span> <span data-ttu-id="c6ac6-133">次に、ObjectDataSource は、`null` 値を `UpdateProduct` ビジネスロジック層 (BLL) メソッドに渡します。これにより、編集されたデータベースレコードの `QuantityPerUnit` 列が `NULL` 値に変更されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-133">The ObjectDataSource would then pass in a `null` value into the `UpdateProduct` Business Logic Layer (BLL) method, which would change the edited database record's `QuantityPerUnit` column to a `NULL` value.</span></span> <span data-ttu-id="c6ac6-134">同様に、`ProductName`などの必須フィールドが編集インターフェイスから削除された場合、更新は失敗し、"*列 ' ProductName ' は null*を許容しません" という例外が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-134">Similarly, if a required field, such as `ProductName`, is removed from the editing interface, the update will fail with a "*Column 'ProductName' does not allow nulls*" exception.</span></span> <span data-ttu-id="c6ac6-135">この動作が発生する理由は、ObjectDataSource が `ProductsBLL` クラスの `UpdateProduct` メソッドを呼び出すように構成されており、各製品フィールドに入力パラメーターが必要であるためです。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-135">The reason for this behavior was because the ObjectDataSource was configured to call the `ProductsBLL` class's `UpdateProduct` method, which expected an input parameter for each of the product fields.</span></span> <span data-ttu-id="c6ac6-136">したがって、ObjectDataSource の `UpdateParameters` コレクションには、メソッドの入力パラメーターごとにパラメーターが含まれていました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-136">Therefore, the ObjectDataSource's `UpdateParameters` collection contained a parameter for each of the method's input parameters.</span></span>

<span data-ttu-id="c6ac6-137">エンドユーザーがフィールドのサブセットのみを更新できるデータ Web コントロールを提供する場合は、ObjectDataSource の `Updating` イベントハンドラーで欠落している `UpdateParameters` 値をプログラムによって設定するか、フィールドのサブセットのみを想定する BLL メソッドを作成して呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-137">If we want to provide a data Web control that allows the end user to only update a subset of fields, then we need to either programmatically set the missing `UpdateParameters` values in the ObjectDataSource's `Updating` event handler or create and call a BLL method that expects only a subset of the fields.</span></span> <span data-ttu-id="c6ac6-138">後者の方法を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-138">Let's explore this latter approach.</span></span>

<span data-ttu-id="c6ac6-139">具体的には、編集可能な GridView で `ProductName` および `UnitPrice` のフィールドだけを表示するページを作成します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-139">Specifically, let's create a page that displays just the `ProductName` and `UnitPrice` fields in an editable GridView.</span></span> <span data-ttu-id="c6ac6-140">この GridView の編集インターフェイスでは、表示されている2つのフィールド、`ProductName` および `UnitPrice`のみを更新できます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-140">This GridView's editing interface will only allow the user to update the two displayed fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="c6ac6-141">この編集インターフェイスは製品のフィールドのサブセットのみを提供するため、既存の BLL の `UpdateProduct` メソッドを使用する ObjectDataSource を作成する必要があります。また、不足している product フィールド値が `Updating` イベントハンドラーでプログラムによって設定されているか、GridView で定義されたフィールドのサブセットのみを必要とする新しい BLL メソッドを作成する</span><span class="sxs-lookup"><span data-stu-id="c6ac6-141">Since this editing interface only provides a subset of a product's fields, we either need to create an ObjectDataSource that uses the existing BLL's `UpdateProduct` method and has the missing product field values set programmatically in its `Updating` event handler, or we need to create a new BLL method that expects only the subset of fields defined in the GridView.</span></span> <span data-ttu-id="c6ac6-142">このチュートリアルでは、後者のオプションを使用し、`productName`、`unitPrice`、および `productID`の3つの入力パラメーターだけを受け取る `UpdateProduct` メソッドのオーバーロードを作成します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-142">For this tutorial, let's use the latter option and create an overload of the `UpdateProduct` method, one that takes in just three input parameters: `productName`, `unitPrice`, and `productID`:</span></span>

[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample1.cs)]

<span data-ttu-id="c6ac6-143">元の `UpdateProduct` メソッドと同様に、このオーバーロードは、指定された `ProductID`の製品がデータベース内に存在するかどうかを確認することから始まります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-143">Like the original `UpdateProduct` method, this overload starts by checking to see if there is a product in the database with the specified `ProductID`.</span></span> <span data-ttu-id="c6ac6-144">そうでない場合は、`false`を返します。これは、製品情報を更新する要求が失敗したことを示します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-144">If not, it returns `false`, indicating that the request to update the product information failed.</span></span> <span data-ttu-id="c6ac6-145">それ以外の場合は、既存の製品レコードの `ProductName` と `UnitPrice` フィールドを適宜更新し、TableAdapter の `Update()` メソッドを呼び出して更新をコミットし、`ProductsRow` インスタンスを渡します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-145">Otherwise it updates the existing product record's `ProductName` and `UnitPrice` fields accordingly and commits the update by calling the TableAdapter's `Update()` method, passing in the `ProductsRow` instance.</span></span>

<span data-ttu-id="c6ac6-146">`ProductsBLL` クラスに追加されたことで、簡略化された GridView インターフェイスを作成する準備が整いました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-146">With this addition to our `ProductsBLL` class, we're ready to create the simplified GridView interface.</span></span> <span data-ttu-id="c6ac6-147">`EditInsertDelete` フォルダー内の `DataModificationEvents.aspx` を開き、GridView をページに追加します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-147">Open the `DataModificationEvents.aspx` in the `EditInsertDelete` folder and add a GridView to the page.</span></span> <span data-ttu-id="c6ac6-148">新しい ObjectDataSource を作成し、`ProductsBLL` クラスを使用するように構成します。これには、`GetProducts` への `Select()` メソッドマッピングと、`UpdateProduct`、`productName`、および `unitPrice`の入力パラメーターのみを受け取る `productID` オーバーロードへのその `Update()` メソッドのマッピングが含まれます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-148">Create a new ObjectDataSource and configure it to use the `ProductsBLL` class with its `Select()` method mapping to `GetProducts` and its `Update()` method mapping to the `UpdateProduct` overload that takes in only the `productName`, `unitPrice`, and `productID` input parameters.</span></span> <span data-ttu-id="c6ac6-149">図2は、ObjectDataSource の `Update()` メソッドを `ProductsBLL` クラスの新しい `UpdateProduct` メソッドオーバーロードにマッピングするときのデータソースの作成ウィザードを示しています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-149">Figure 2 shows the Create Data Source wizard when mapping the ObjectDataSource's `Update()` method to the `ProductsBLL` class's new `UpdateProduct` method overload.</span></span>

<span data-ttu-id="c6ac6-150">[ObjectDataSource の Update () メソッドを新しい UpdateProduct オーバーロードにマップ ![](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-150">[![Map the ObjectDataSource's Update() Method to the New UpdateProduct Overload](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image4.png)</span></span>

<span data-ttu-id="c6ac6-151">**図 2**: ObjectDataSource の `Update()` メソッドを新しい `UpdateProduct` オーバーロードにマップする ([クリックしてフルサイズのイメージを表示する](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c6ac6-151">**Figure 2**: Map the ObjectDataSource's `Update()` Method to the New `UpdateProduct` Overload ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image6.png))</span></span>

<span data-ttu-id="c6ac6-152">この例では最初にデータの編集のみを行う必要がありますが、レコードの挿入や削除を行うことはできません。そのため、[挿入] タブと [削除] タブに移動し、ドロップダウンリストから [(なし)] をクリックして、ObjectDataSource の `Insert()` および `Delete()` メソッドを `ProductsBLL` クラスのメソッドにマップしないことを明示的</span><span class="sxs-lookup"><span data-stu-id="c6ac6-152">Since our example will initially just need the ability to edit data, but not to insert or delete records, take a moment to explicitly indicate that the ObjectDataSource's `Insert()` and `Delete()` methods shouldn't be mapped to any of the `ProductsBLL` class's methods by going to the INSERT and DELETE tabs and choosing (None) from the drop-down list.</span></span>

<span data-ttu-id="c6ac6-153">[[挿入] タブと [削除] タブのドロップダウンリストから [(なし)] を選択 ![ます。](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-153">[![Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image7.png)</span></span>

<span data-ttu-id="c6ac6-154">**図 3**: [挿入] タブと [削除] タブのドロップダウンリストから [(なし)] を選択[する (クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image9.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-154">**Figure 3**: Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image9.png))</span></span>

<span data-ttu-id="c6ac6-155">このウィザードを完了したら、GridView のスマートタグから [編集を有効にする] チェックボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-155">After completing this wizard check the Enable Editing checkbox from the GridView's smart tag.</span></span>

<span data-ttu-id="c6ac6-156">データソースの作成ウィザードが完了し、GridView にバインドされると、Visual Studio は両方のコントロールに対して宣言構文を作成しました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-156">With the completion of the Create Data Source wizard and binding that to the GridView, Visual Studio has created the declarative syntax for both controls.</span></span> <span data-ttu-id="c6ac6-157">ソースビューにアクセスして、次に示す ObjectDataSource の宣言型マークアップを検査します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-157">Go to the Source view to inspect the ObjectDataSource's declarative markup, which is shown below:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample2.aspx)]

<span data-ttu-id="c6ac6-158">ObjectDataSource の `Insert()` メソッドと `Delete()` メソッドのマッピングはないため、`InsertParameters` または `DeleteParameters` セクションはありません。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-158">Since there are no mappings for the ObjectDataSource's `Insert()` and `Delete()` methods, there are no `InsertParameters` or `DeleteParameters` sections.</span></span> <span data-ttu-id="c6ac6-159">さらに、`Update()` メソッドは、3つの入力パラメーターのみを受け入れる `UpdateProduct` メソッドのオーバーロードにマップされるため、`UpdateParameters` のセクションには `Parameter` インスタンスが3つだけあります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-159">Furthermore, since the `Update()` method is mapped to the `UpdateProduct` method overload that only accepts three input parameters, the `UpdateParameters` section has just three `Parameter` instances.</span></span>

<span data-ttu-id="c6ac6-160">ObjectDataSource の `OldValuesParameterFormatString` プロパティは `original_{0}`に設定されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-160">Note that the ObjectDataSource's `OldValuesParameterFormatString` property is set to `original_{0}`.</span></span> <span data-ttu-id="c6ac6-161">このプロパティは、データソースの構成ウィザードを使用するときに Visual Studio によって自動的に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-161">This property is set automatically by Visual Studio when using the Configure Data Source wizard.</span></span> <span data-ttu-id="c6ac6-162">ただし、BLL メソッドでは元の `ProductID` 値が渡されるとは想定されていないため、このプロパティの割り当てを ObjectDataSource の宣言構文から完全に削除します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-162">However, since our BLL methods don't expect the original `ProductID` value to be passed in, remove this property assignment altogether from the ObjectDataSource's declarative syntax.</span></span>

> [!NOTE]
> <span data-ttu-id="c6ac6-163">デザインビューのプロパティウィンドウから `OldValuesParameterFormatString` プロパティ値をクリアするだけの場合、プロパティは宣言構文に存在しますが、空の文字列に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-163">If you simply clear out the `OldValuesParameterFormatString` property value from the Properties window in the Design view, the property will still exist in the declarative syntax, but will be set to an empty string.</span></span> <span data-ttu-id="c6ac6-164">宣言構文からプロパティを完全に削除するか、プロパティウィンドウから、値を既定の `{0}`に設定します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-164">Either remove the property altogether from the declarative syntax or, from the Properties window, set the value to the default, `{0}`.</span></span>

<span data-ttu-id="c6ac6-165">ObjectDataSource には製品名、価格、および ID の `UpdateParameters` がありますが、Visual Studio では、各製品のフィールドの GridView に BoundField または CheckBoxField が追加されています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-165">While the ObjectDataSource only has `UpdateParameters` for the product's name, price, and ID, Visual Studio has added a BoundField or CheckBoxField in the GridView for each of the product's fields.</span></span>

<span data-ttu-id="c6ac6-166">[GridView ![、各製品のフィールドの BoundField または CheckBoxField が含まれています。](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-166">[![The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image10.png)</span></span>

<span data-ttu-id="c6ac6-167">**図 4**: GridView には、各製品のフィールドの BoundField または CheckBoxField が含まれています ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-167">**Figure 4**: The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image12.png))</span></span>

<span data-ttu-id="c6ac6-168">エンドユーザーが製品を編集して [更新] ボタンをクリックすると、GridView は、読み取り専用ではなかったフィールドを列挙します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-168">When the end user edits a product and clicks its Update button, the GridView enumerates those fields that were not read-only.</span></span> <span data-ttu-id="c6ac6-169">次に、ObjectDataSource の `UpdateParameters` コレクション内の対応するパラメーターの値を、ユーザーが入力した値に設定します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-169">It then sets the value of the corresponding parameter in the ObjectDataSource's `UpdateParameters` collection to the value entered by the user.</span></span> <span data-ttu-id="c6ac6-170">対応するパラメーターがない場合は、GridView によってコレクションに追加されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-170">If there is not a corresponding parameter, the GridView adds one to the collection.</span></span> <span data-ttu-id="c6ac6-171">したがって、GridView ですべての製品のフィールドに対して BoundFields と CheckBoxFields が含まれている場合、objectdatasource の宣言型マークアップで指定されている入力パラメーターは3つだけであるとしても、objectdatasource は、これらすべてのパラメーターを受け取る `UpdateProduct` オーバーロードを呼び出します (図5を参照)。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-171">Therefore, if our GridView contains BoundFields and CheckBoxFields for all of the product's fields, the ObjectDataSource will end up invoking the `UpdateProduct` overload that takes in all of these parameters, despite the fact that the ObjectDataSource's declarative markup specifies only three input parameters (see Figure 5).</span></span> <span data-ttu-id="c6ac6-172">同様に、`UpdateProduct` のオーバーロードの入力パラメーターに対応しない、非読み取り専用の product フィールドの組み合わせが GridView にある場合は、更新しようとすると例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-172">Similarly, if there is some combination of non-read-only product fields in the GridView that doesn't correspond to the input parameters for a `UpdateProduct` overload, an exception will be raised when attempting to update.</span></span>

<span data-ttu-id="c6ac6-173">[GridView によって ![ObjectDataSource の UpdateParameters コレクションにパラメーターが追加されます。](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-173">[![The GridView Will Add Parameters to the ObjectDataSource's UpdateParameters Collection](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image13.png)</span></span>

<span data-ttu-id="c6ac6-174">**図 5**: GridView は ObjectDataSource の `UpdateParameters` コレクションにパラメーターを追加します ([クリックすると、フルサイズのイメージが表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-174">**Figure 5**: The GridView Will Add Parameters to the ObjectDataSource's `UpdateParameters` Collection ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image15.png))</span></span>

<span data-ttu-id="c6ac6-175">ObjectDataSource が製品名、価格、および ID だけを受け取る `UpdateProduct` オーバーロードを呼び出すようにするには、`ProductName` と `UnitPrice`に対してのみ編集可能なフィールドを持つように GridView を制限する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-175">To ensure that the ObjectDataSource invokes the `UpdateProduct` overload that takes in just the product's name, price, and ID, we need to restrict the GridView to having editable fields for just the `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="c6ac6-176">これを実現するには、他の BoundFields と CheckBoxFields を削除するか、他のフィールドの `ReadOnly` プロパティを `true`に設定するか、またはその2つの組み合わせを使用します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-176">This can be accomplished by removing the other BoundFields and CheckBoxFields, by setting those other fields' `ReadOnly` property to `true`, or by some combination of the two.</span></span> <span data-ttu-id="c6ac6-177">このチュートリアルでは、`ProductName` および `UnitPrice` BoundFields を除くすべての GridView フィールドを削除するだけです。その後、GridView の宣言マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-177">For this tutorial let's simply remove all GridView fields except the `ProductName` and `UnitPrice` BoundFields, after which the GridView's declarative markup will look like:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample3.aspx)]

<span data-ttu-id="c6ac6-178">`UpdateProduct` のオーバーロードには3つの入力パラメーターが必要ですが、GridView では2つの BoundFields しかありません。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-178">Even though the `UpdateProduct` overload expects three input parameters, we only have two BoundFields in our GridView.</span></span> <span data-ttu-id="c6ac6-179">これは、`productID` 入力パラメーターが主キーの値であり、編集された行の `DataKeyNames` プロパティの値を通じて渡されるためです。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-179">This is because the `productID` input parameter is a primary key value and passed in through the value of the `DataKeyNames` property for the edited row.</span></span>

<span data-ttu-id="c6ac6-180">GridView を `UpdateProduct` のオーバーロードと共に使用すると、ユーザーは製品の名前と価格だけを編集して、他の製品フィールドを失うことはありません。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-180">Our GridView, along with the `UpdateProduct` overload, allows a user to edit just the name and price of a product without losing any of the other product fields.</span></span>

<span data-ttu-id="c6ac6-181">[インターフェイスを ![して、製品の名前と価格だけを編集できます。](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-181">[![The Interface Allows Editing Just the Product's Name and Price](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image16.png)</span></span>

<span data-ttu-id="c6ac6-182">**図 6**: インターフェイスでは、製品の名前と価格だけを編集できます ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-182">**Figure 6**: The Interface Allows Editing Just the Product's Name and Price ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c6ac6-183">前のチュートリアルで説明したように、GridView のビューステートが有効になっていることが非常に重要です (既定の動作)。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-183">As discussed in the previous tutorial, it is vitally important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="c6ac6-184">GridView s `EnableViewState` プロパティを `false`に設定すると、同時実行ユーザーが誤ってレコードを削除または編集する危険性があります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-184">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="c6ac6-185">「警告: 詳細については[、編集または削除をサポートし、ビューステートが無効になっている ASP.NET 2.0 GridViews/DetailsView/formviews での同時実行の問題](http://scottonwriting.net/sowblog/archive/2006/10/03/163215.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-185">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/archive/2006/10/03/163215.aspx) for more information.</span></span>

## <a name="improving-theunitpriceformatting"></a><span data-ttu-id="c6ac6-186">`UnitPrice`の書式設定の改善</span><span class="sxs-lookup"><span data-stu-id="c6ac6-186">Improving the`UnitPrice`Formatting</span></span>

<span data-ttu-id="c6ac6-187">図6に示されている GridView の例は動作しますが、`UnitPrice` フィールドはまったく書式設定されていません。その結果、通貨記号がなく、小数点以下桁数が4桁の価格が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-187">While the GridView example shown in Figure 6 works, the `UnitPrice` field is not formatted at all, resulting in a price display that lacks any currency symbols and has four decimal places.</span></span> <span data-ttu-id="c6ac6-188">編集できない行に通貨書式を適用するには、単に `UnitPrice` BoundField の `DataFormatString` プロパティを `{0:c}` に設定し、その `HtmlEncode` プロパティを `false`に設定します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-188">To apply a currency formatting for the non-editable rows, simply set the `UnitPrice` BoundField's `DataFormatString` property to `{0:c}` and its `HtmlEncode` property to `false`.</span></span>

<span data-ttu-id="c6ac6-189">[UnitPrice の DataFormatString と HtmlEncode プロパティを適宜設定 ![](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-189">[![Set the UnitPrice's DataFormatString and HtmlEncode Properties Accordingly](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image19.png)</span></span>

<span data-ttu-id="c6ac6-190">**図 7**: `UnitPrice`の `DataFormatString` と `HtmlEncode` のプロパティを設定[する (クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image21.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-190">**Figure 7**: Set the `UnitPrice`'s `DataFormatString` and `HtmlEncode` Properties Accordingly ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image21.png))</span></span>

<span data-ttu-id="c6ac6-191">この変更により、編集できない行は価格を通貨として書式設定します。ただし、編集された行には、通貨記号を含まない値と小数点以下4桁の値が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-191">With this change, the non-editable rows format the price as a currency; the edited row, however, still displays the value without the currency symbol and with four decimal places.</span></span>

<span data-ttu-id="c6ac6-192">[![編集できない行が通貨値として書式設定されるようになりました。](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-192">[![Non-Editable Rows are Now Formatted as Currency Values](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image22.png)</span></span>

<span data-ttu-id="c6ac6-193">**図 8**: 編集できない行が通貨値として書式設定される ([クリックしてフルサイズの画像を表示する](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c6ac6-193">**Figure 8**: Non-Editable Rows are Now Formatted as Currency Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image24.png))</span></span>

<span data-ttu-id="c6ac6-194">BoundField の `ApplyFormatInEditMode` プロパティを `true` (既定値は `false`) に設定することによって、`DataFormatString` プロパティで指定された書式設定の手順を編集インターフェイスに適用できます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-194">The formatting instructions specified in the `DataFormatString` property can be applied to the editing interface by setting the BoundField's `ApplyFormatInEditMode` property to `true` (the default is `false`).</span></span> <span data-ttu-id="c6ac6-195">このプロパティを `true`に設定します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-195">Take a moment to set this property to `true`.</span></span>

<span data-ttu-id="c6ac6-196">[![UnitPrice BoundField の ApplyFormatInEditMode プロパティを true に設定します。](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-196">[![Set the UnitPrice BoundField's ApplyFormatInEditMode property to true](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image25.png)</span></span>

<span data-ttu-id="c6ac6-197">**図 9**: `UnitPrice` BoundField の `ApplyFormatInEditMode` プロパティを `true` に設定する ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image27.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-197">**Figure 9**: Set the `UnitPrice` BoundField's `ApplyFormatInEditMode` property to `true` ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image27.png))</span></span>

<span data-ttu-id="c6ac6-198">この変更により、編集された行に表示される `UnitPrice` の値も通貨として書式設定されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-198">With this change, the value of the `UnitPrice` displayed in the edited row is also formatted as a currency.</span></span>

<span data-ttu-id="c6ac6-199">[編集された行の UnitPrice 値が通貨として書式設定されている ![](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-199">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image28.png)</span></span>

<span data-ttu-id="c6ac6-200">**図 10**: 編集した行の `UnitPrice` 値が通貨として書式設定される ([クリックしてフルサイズの画像を表示する](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="c6ac6-200">**Figure 10**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image30.png))</span></span>

<span data-ttu-id="c6ac6-201">ただし、$19.00 などのテキストボックスで通貨記号を使用して製品を更新すると、`FormatException`がスローされます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-201">However, updating a product with the currency symbol in the textbox such as $19.00 throws a `FormatException`.</span></span> <span data-ttu-id="c6ac6-202">GridView がユーザーが指定した値を ObjectDataSource の `UpdateParameters` コレクションに割り当てようとすると、`UnitPrice` 文字列 "$19.00" をパラメーターで必要な `decimal` に変換できません (図11を参照)。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-202">When the GridView attempts to assign the user-supplied values to the ObjectDataSource's `UpdateParameters` collection it is unable to convert the `UnitPrice` string "$19.00" into the `decimal` required by the parameter (see Figure 11).</span></span> <span data-ttu-id="c6ac6-203">これを解決するには、GridView の `RowUpdating` イベントのイベントハンドラーを作成し、ユーザーが指定した `UnitPrice` を通貨形式の `decimal`として解析することができます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-203">To remedy this we can create an event handler for the GridView's `RowUpdating` event and have it parse the user-supplied `UnitPrice` as a currency-formatted `decimal`.</span></span>

<span data-ttu-id="c6ac6-204">GridView の `RowUpdating` イベントは、2番目のパラメーターとして、 [GridViewUpdateEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx)型のオブジェクトを受け取ります。これには、ObjectDataSource の `UpdateParameters` コレクションに割り当てる準備ができているユーザー指定の値を保持するプロパティの1つとして、`NewValues` ディクショナリが含まれます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-204">The GridView's `RowUpdating` event accepts as its second parameter an object of type [GridViewUpdateEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx), which includes a `NewValues` dictionary as one of its properties that holds the user-supplied values ready to be assigned to the ObjectDataSource's `UpdateParameters` collection.</span></span> <span data-ttu-id="c6ac6-205">`NewValues` コレクション内の既存の `UnitPrice` 値は、通貨書式を使用して解析された10進数値で、`RowUpdating` イベントハンドラーの次のコード行で上書きできます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-205">We can overwrite the existing `UnitPrice` value in the `NewValues` collection with a decimal value parsed using the currency format with the following lines of code in the `RowUpdating` event handler:</span></span>

[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample4.cs)]

<span data-ttu-id="c6ac6-206">ユーザーが `UnitPrice` 値 ("$19.00" など) を指定した場合、この値は[10 進数](https://msdn.microsoft.com/library/system.decimal.parse(VS.80).aspx)で計算された10進値で上書きされます。値を通貨として解析します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-206">If the user has supplied a `UnitPrice` value (such as "$19.00"), this value is overwritten with the decimal value computed by [Decimal.Parse](https://msdn.microsoft.com/library/system.decimal.parse(VS.80).aspx), parsing the value as a currency.</span></span> <span data-ttu-id="c6ac6-207">これにより、通貨記号、コンマ、小数点などが発生した場合に、10進数が正しく解析され、NumberStyles 名前[空間の](https://msdn.microsoft.com/library/abeh092z(VS.80).aspx)[列挙体](https://msdn.microsoft.com/library/system.globalization.numberstyles(VS.80).aspx)が使用されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-207">This will correctly parse the decimal in the event of any currency symbols, commas, decimal points, and so on, and uses the [NumberStyles enumeration](https://msdn.microsoft.com/library/system.globalization.numberstyles(VS.80).aspx) in the [System.Globalization](https://msdn.microsoft.com/library/abeh092z(VS.80).aspx) namespace.</span></span>

<span data-ttu-id="c6ac6-208">図11に、ユーザーが指定した `UnitPrice`の通貨記号による問題と、そのような入力を正しく解析するために GridView の `RowUpdating` イベントハンドラーを使用する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-208">Figure 11 shows both the problem caused by currency symbols in the user-supplied `UnitPrice`, along with how the GridView's `RowUpdating` event handler can be utilized to correctly parse such input.</span></span>

<span data-ttu-id="c6ac6-209">[編集された行の UnitPrice 値が通貨として書式設定されている ![](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-209">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image31.png)</span></span>

<span data-ttu-id="c6ac6-210">**図 11**: 編集した行の `UnitPrice` 値が通貨として書式設定される ([クリックしてフルサイズの画像を表示する](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="c6ac6-210">**Figure 11**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image33.png))</span></span>

## <a name="step-2-prohibitingnull-unitprices"></a><span data-ttu-id="c6ac6-211">手順 2:`NULL UnitPrices` を禁止する</span><span class="sxs-lookup"><span data-stu-id="c6ac6-211">Step 2: Prohibiting`NULL UnitPrices`</span></span>

<span data-ttu-id="c6ac6-212">データベースは `Products` テーブルの `UnitPrice` 列の値 `NULL` を許可するように構成されていますが、この特定のページにアクセスするユーザーが `NULL` `UnitPrice` 値を指定できないようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-212">While the database is configured to allow `NULL` values in the `Products` table's `UnitPrice` column, we may want to prevent users visiting this particular page from specifying a `NULL` `UnitPrice` value.</span></span> <span data-ttu-id="c6ac6-213">つまり、ユーザーが製品行の編集時に `UnitPrice` 値の入力に失敗した場合は、結果をデータベースに保存するのではなく、このページで、編集したすべての製品に価格を指定する必要があることをユーザーに通知するメッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-213">That is, if a user fails to enter a `UnitPrice` value when editing a product row, rather than save the results to the database we want to display a message informing the user that, through this page, any edited products must have a price specified.</span></span>

<span data-ttu-id="c6ac6-214">GridView の `RowUpdating` イベントハンドラーに渡される `GridViewUpdateEventArgs` オブジェクトには、`Cancel` プロパティが含まれています。このプロパティは `true`に設定されている場合、更新プロセスを終了します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-214">The `GridViewUpdateEventArgs` object passed into the GridView's `RowUpdating` event handler contains a `Cancel` property that, if set to `true`, terminates the updating process.</span></span> <span data-ttu-id="c6ac6-215">`RowUpdating` イベントハンドラーを拡張して、`e.Cancel` を `true` に設定し、`NewValues` コレクション内の `UnitPrice` 値が `null`かどうかを説明するメッセージを表示してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-215">Let's extend the `RowUpdating` event handler to set `e.Cancel` to `true` and display a message explaining why if the `UnitPrice` value in the `NewValues` collection is `null`.</span></span>

<span data-ttu-id="c6ac6-216">まず、`MustProvideUnitPriceMessage`という名前のページにラベル Web コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-216">Start by adding a Label Web control to the page named `MustProvideUnitPriceMessage`.</span></span> <span data-ttu-id="c6ac6-217">このラベルコントロールは、ユーザーが製品の更新時に `UnitPrice` 値を指定できなかった場合に表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-217">This Label control will be displayed if the user fails to specify a `UnitPrice` value when updating a product.</span></span> <span data-ttu-id="c6ac6-218">ラベルの `Text` プロパティを「製品の価格を指定する必要があります」に設定します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-218">Set the Label's `Text` property to "You must provide a price for the product."</span></span> <span data-ttu-id="c6ac6-219">また、次の定義で `Warning` という名前の `Styles.css` に新しい CSS クラスを作成しました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-219">I've also created a new CSS class in `Styles.css` named `Warning` with the following definition:</span></span>

[!code-css[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample5.css)]

<span data-ttu-id="c6ac6-220">最後に、ラベルの `CssClass` プロパティを `Warning`に設定します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-220">Finally, set the Label's `CssClass` property to `Warning`.</span></span> <span data-ttu-id="c6ac6-221">この時点で、デザイナーは、図12に示すように、GridView の上に赤い、太字、斜体、特大のフォントサイズで警告メッセージを表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-221">At this point the Designer should show the warning message in a red, bold, italic, extra large font size above the GridView, as shown in Figure 12.</span></span>

<span data-ttu-id="c6ac6-222">[ラベルが GridView の上に追加された ![](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-222">[![A Label Has Been Added Above the GridView](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image34.png)</span></span>

<span data-ttu-id="c6ac6-223">**図 12**: GridView の上にラベルが追加されました ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image36.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-223">**Figure 12**: A Label Has Been Added Above the GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image36.png))</span></span>

<span data-ttu-id="c6ac6-224">既定では、このラベルは非表示になっているため、`Visible` プロパティを `Page_Load` イベントハンドラーで `false` に設定します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-224">By default, this Label should be hidden, so set its `Visible` property to `false` in the `Page_Load` event handler:</span></span>

[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample6.cs)]

<span data-ttu-id="c6ac6-225">ユーザーが `UnitPrice`を指定せずに製品を更新しようとした場合は、更新をキャンセルし、警告ラベルを表示します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-225">If the user attempts to update a product without specifying the `UnitPrice`, we want to cancel the update and display the warning label.</span></span> <span data-ttu-id="c6ac6-226">GridView の `RowUpdating` イベントハンドラーを次のように拡張します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-226">Augment the GridView's `RowUpdating` event handler as follows:</span></span>

[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample7.cs)]

<span data-ttu-id="c6ac6-227">ユーザーが価格を指定せずに製品を保存しようとすると、更新が取り消され、役に立つメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-227">If a user attempts to save a product without specifying a price, the update is cancelled and a helpful message is displayed.</span></span> <span data-ttu-id="c6ac6-228">データベース (およびビジネスロジック) では `UnitPrice` `NULL` が許可されますが、この特定の ASP.NET ページは使用できません。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-228">While the database (and business logic) allows for `NULL` `UnitPrice` s, this particular ASP.NET page does not.</span></span>

<span data-ttu-id="c6ac6-229">[ユーザーが ![UnitPrice を空白のままにすることはできません](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-229">[![A User Cannot Leave UnitPrice Blank](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image37.png)</span></span>

<span data-ttu-id="c6ac6-230">**図 13**: ユーザーは `UnitPrice` 空白のままにすることはできません ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image39.png)される)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-230">**Figure 13**: A User Cannot Leave `UnitPrice` Blank ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image39.png))</span></span>

<span data-ttu-id="c6ac6-231">ここまでは、GridView の `RowUpdating` イベントを使用して、ObjectDataSource の `UpdateParameters` コレクションに割り当てられているパラメーター値をプログラムによって変更する方法と、更新プロセスをすべて取り消す方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-231">So far we have seen how to use the GridView's `RowUpdating` event to programmatically alter the parameter values assigned to the ObjectDataSource's `UpdateParameters` collection as well as how to cancel the updating process altogether.</span></span> <span data-ttu-id="c6ac6-232">これらの概念は、DetailsView コントロールと FormView コントロールに引き継がれ、挿入と削除にも適用されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-232">These concepts carry over to the DetailsView and FormView controls and also apply to inserting and deleting.</span></span>

<span data-ttu-id="c6ac6-233">これらのタスクは、`Inserting`、`Updating`、および `Deleting` イベントのイベントハンドラーを通じて ObjectDataSource レベルで実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-233">These tasks can also be done at the ObjectDataSource level through event handlers for its `Inserting`, `Updating`, and `Deleting` events.</span></span> <span data-ttu-id="c6ac6-234">これらのイベントは、基になるオブジェクトの関連付けられたメソッドが呼び出される前に起動され、入力パラメーターのコレクションを変更するか、操作を完全にキャンセルする機会を提供します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-234">These events fire before the associated method of the underlying object is invoked and provide a last-chance opportunity to modify the input parameters collection or cancel the operation outright.</span></span> <span data-ttu-id="c6ac6-235">これら3つのイベントのイベントハンドラーには、 [ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx)型のオブジェクトが渡されます。このオブジェクトには、次の2つのプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-235">The event handlers for these three events are passed an object of type [ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx) that has two properties of interest:</span></span>

- <span data-ttu-id="c6ac6-236">[[キャンセル](https://msdn.microsoft.com/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx)]。 `true`に設定すると、実行中の操作が取り消されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-236">[Cancel](https://msdn.microsoft.com/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx), which, if set to `true`, cancels the operation being performed</span></span>
- <span data-ttu-id="c6ac6-237">[InputParameters](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx)。イベントハンドラーが `Inserting`、`Updating`、または `Deleting` イベントのどちらであるかに応じて、`InsertParameters`、`UpdateParameters`、または `DeleteParameters`のコレクションです。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-237">[InputParameters](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx), which is the collection of `InsertParameters`, `UpdateParameters`, or `DeleteParameters`, depending on whether the event handler is for the `Inserting`, `Updating`, or `Deleting` event</span></span>

<span data-ttu-id="c6ac6-238">ObjectDataSource レベルでのパラメーター値の使用方法を示すために、ページに DetailsView を含めて、ユーザーが新しい製品を追加できるようにしましょう。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-238">To illustrate working with the parameter values at the ObjectDataSource level, let's include a DetailsView in our page that allows the users to add a new product.</span></span> <span data-ttu-id="c6ac6-239">この DetailsView は、新しい製品をデータベースにすばやく追加するためのインターフェイスを提供するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-239">This DetailsView will be used to provide an interface for quickly adding a new product to the database.</span></span> <span data-ttu-id="c6ac6-240">新しい製品を追加するときに一貫性のあるユーザーインターフェイスを維持するには、ユーザーが `ProductName` フィールドと `UnitPrice` フィールドに対してのみ値を入力できるようにします。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-240">To keep a consistent user interface when adding a new product let's allow the user to only enter values for the `ProductName` and `UnitPrice` fields.</span></span> <span data-ttu-id="c6ac6-241">既定では、DetailsView の挿入インターフェイスに指定されていない値は、`NULL` データベースの値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-241">By default, those values that aren't supplied in the DetailsView's inserting interface will be set to a `NULL` database value.</span></span> <span data-ttu-id="c6ac6-242">ただし、後で説明するように、ObjectDataSource の `Inserting` イベントを使用して異なる既定値を挿入することもできます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-242">However, we can use the ObjectDataSource's `Inserting` event to inject different default values, as we'll see shortly.</span></span>

## <a name="step-3-providing-an-interface-to-add-new-products"></a><span data-ttu-id="c6ac6-243">手順 3: 新しい製品を追加するためのインターフェイスを提供する</span><span class="sxs-lookup"><span data-stu-id="c6ac6-243">Step 3: Providing an Interface to Add New Products</span></span>

<span data-ttu-id="c6ac6-244">ツールボックスから [DetailsView] をドラッグして、GridView の上にあるデザイナーに移動し、`Height` と `Width` のプロパティをオフにして、ページに既に存在する ObjectDataSource にバインドします。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-244">Drag a DetailsView from the Toolbox onto the Designer above the GridView, clear out its `Height` and `Width` properties, and bind it to the ObjectDataSource already present on the page.</span></span> <span data-ttu-id="c6ac6-245">これにより、各製品のフィールドの BoundField または CheckBoxField が追加されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-245">This will add a BoundField or CheckBoxField for each of the product's fields.</span></span> <span data-ttu-id="c6ac6-246">この DetailsView を使用して新しい製品を追加する必要があるため、スマートタグから [挿入を有効にする] オプションをオンにする必要があります。ただし、ObjectDataSource の `Insert()` メソッドが `ProductsBLL` クラスのメソッドにマップされていないため、このようなオプションはありません (データソースの構成時にこのマッピングを (None) に設定したことを思い出してください)。図3を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-246">Since we want to use this DetailsView to add new products, we need to check the Enable Inserting option from the smart tag; however, there's no such option because the ObjectDataSource's `Insert()` method is not mapped to a method in the `ProductsBLL` class (recall that we set this mapping to (None) when configuring the data source see Figure 3).</span></span>

<span data-ttu-id="c6ac6-247">ObjectDataSource を構成するには、スマートタグから [データソースの構成] リンクを選択し、ウィザードを起動します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-247">To configure the ObjectDataSource, select the Configure Data Source link from its smart tag, launching the wizard.</span></span> <span data-ttu-id="c6ac6-248">最初の画面では、ObjectDataSource がバインドされている基になるオブジェクトを変更できます。`ProductsBLL`に設定したままにします。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-248">The first screen allows you to change the underlying object the ObjectDataSource is bound to; leave it set to `ProductsBLL`.</span></span> <span data-ttu-id="c6ac6-249">次の画面には、ObjectDataSource のメソッドから基になるオブジェクトのへのマッピングが一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-249">The next screen lists the mappings from the ObjectDataSource's methods to the underlying object's.</span></span> <span data-ttu-id="c6ac6-250">`Insert()` メソッドと `Delete()` メソッドをどのメソッドにもマップしないように明示的に指定しても、[挿入] タブと [削除] タブにアクセスすると、マッピングが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-250">Even though we explicitly indicated that the `Insert()` and `Delete()` methods should not be mapped to any methods, if you go to the INSERT and DELETE tabs you'll see that a mapping is there.</span></span> <span data-ttu-id="c6ac6-251">これは、`ProductsBLL`の `AddProduct` メソッドと `DeleteProduct` メソッドが `DataObjectMethodAttribute` の属性を使用して、それぞれ `Insert()` および `Delete()`の既定のメソッドであることを示すためです。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-251">This is because the `ProductsBLL`'s `AddProduct` and `DeleteProduct` methods use the `DataObjectMethodAttribute` attribute to indicate that they are the default methods for `Insert()` and `Delete()`, respectively.</span></span> <span data-ttu-id="c6ac6-252">そのため、ObjectDataSource ウィザードでは、他の値が明示的に指定されていない限り、ウィザードを実行するたびにこれらの値が選択されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-252">Hence, the ObjectDataSource wizard selects these each time you run the wizard unless there's some other value explicitly specified.</span></span>

<span data-ttu-id="c6ac6-253">`Insert()` メソッドを `AddProduct` メソッドをポイントしたままにして、[削除] タブのドロップダウンリストを [(なし)] に設定します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-253">Leave the `Insert()` method pointing to the `AddProduct` method, but again set the DELETE tab's drop-down list to (None).</span></span>

<span data-ttu-id="c6ac6-254">[[挿入] タブのドロップダウンリストを AddProduct メソッドに設定 ![](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-254">[![Set the INSERT Tab's Drop-Down List to the AddProduct Method](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image40.png)</span></span>

<span data-ttu-id="c6ac6-255">**図 14**: [INSERT] タブのドロップダウンリストを `AddProduct` メソッドに設定する ([クリックしてフルサイズの画像を表示する](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="c6ac6-255">**Figure 14**: Set the INSERT Tab's Drop-Down List to the `AddProduct` Method ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image42.png))</span></span>

<span data-ttu-id="c6ac6-256">[![[削除] タブのドロップダウンリストを [(なし)] に設定します。](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-256">[![Set the DELETE Tab's Drop-Down List to (None)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image43.png)</span></span>

<span data-ttu-id="c6ac6-257">**図 15**: [削除] タブのドロップダウンリストを [(なし)] に設定する ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image45.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-257">**Figure 15**: Set the DELETE Tab's Drop-Down List to (None) ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image45.png))</span></span>

<span data-ttu-id="c6ac6-258">これらの変更を行った後、次に示すように、ObjectDataSource の宣言構文は `InsertParameters` コレクションを含むように展開されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-258">After making these changes, the ObjectDataSource's declarative syntax will be expanded to include an `InsertParameters` collection, as shown below:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample8.aspx)]

<span data-ttu-id="c6ac6-259">ウィザードを再実行すると、`OldValuesParameterFormatString` プロパティが戻されました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-259">Rerunning the wizard added back the `OldValuesParameterFormatString` property.</span></span> <span data-ttu-id="c6ac6-260">このプロパティを既定値 (`{0}`) に設定するか、宣言型の構文から完全に削除することで、このプロパティをクリアします。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-260">Take a moment to clear this property by setting it to the default value (`{0}`) or removing it altogether from the declarative syntax.</span></span>

<span data-ttu-id="c6ac6-261">ObjectDataSource には挿入機能があり、DetailsView のスマートタグには [挿入を有効にする] チェックボックスが含まれるようになりました。デザイナーに戻り、このオプションをオンにします。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-261">With the ObjectDataSource providing inserting capabilities, the DetailsView's smart tag will now include the Enable Inserting checkbox; return to the Designer and check this option.</span></span> <span data-ttu-id="c6ac6-262">次に、省いと `UnitPrice` と CommandField の2つの連結された `ProductName` フィールドのみを持つように、DetailsView をします。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-262">Next, pare down the DetailsView so that it only has two BoundFields - `ProductName` and `UnitPrice` - and the CommandField.</span></span> <span data-ttu-id="c6ac6-263">この時点で、DetailsView の宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-263">At this point the DetailsView's declarative syntax should look like:</span></span>

[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample9.aspx)]

<span data-ttu-id="c6ac6-264">図16は、この時点でブラウザーで表示するときにこのページを示しています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-264">Figure 16 shows this page when viewed through a browser at this point.</span></span> <span data-ttu-id="c6ac6-265">ご覧のとおり、DetailsView には最初の製品 (Chai) の名前と価格が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-265">As you can see, the DetailsView lists the name and price of the first product (Chai).</span></span> <span data-ttu-id="c6ac6-266">ただし、必要なのは、ユーザーがデータベースに新しい製品をすばやく追加するための手段を提供する挿入インターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-266">What we want, however, is an inserting interface that provides a means for the user to quickly add a new product to the database.</span></span>

<span data-ttu-id="c6ac6-267">[現在、DetailsView が読み取り専用モードで表示されて ![](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-267">[![The DetailsView is Currently Rendered in Read-Only Mode](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image46.png)</span></span>

<span data-ttu-id="c6ac6-268">**図 16**: DetailsView が現在読み取り専用モードで表示されている ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image48.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-268">**Figure 16**: The DetailsView is Currently Rendered in Read-Only Mode ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image48.png))</span></span>

<span data-ttu-id="c6ac6-269">挿入モードで DetailsView を表示するには、`DefaultMode` プロパティを `Inserting`に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-269">In order to show the DetailsView in its inserting mode we need to set the `DefaultMode` property to `Inserting`.</span></span> <span data-ttu-id="c6ac6-270">これにより、最初にアクセスしたときに、挿入モードで DetailsView がレンダリングされ、新しいレコードを挿入した後もそのまま保持されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-270">This renders the DetailsView in insert mode when first visited and keeps it there after inserting a new record.</span></span> <span data-ttu-id="c6ac6-271">図17に示すように、このような DetailsView は新しいレコードを追加するための簡単なインターフェイスを提供します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-271">As Figure 17 shows, such a DetailsView provides a quick interface for adding a new record.</span></span>

<span data-ttu-id="c6ac6-272">[DetailsView が ![新しい製品をすばやく追加するためのインターフェイスを提供する](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-272">[![The DetailsView Provides an Interface for Quickly Adding a New Product](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image49.png)</span></span>

<span data-ttu-id="c6ac6-273">**図 17**: DetailsView は、新しい製品をすばやく追加するためのインターフェイスを提供します ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image51.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-273">**Figure 17**: The DetailsView Provides an Interface for Quickly Adding a New Product ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image51.png))</span></span>

<span data-ttu-id="c6ac6-274">ユーザーが製品名と価格 (図17のように "Acme 水" や1.99 など) を入力して [挿入] をクリックすると、ポストバック ensues と挿入ワークフローが開始され、データベースに追加される新しい製品レコードがするされます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-274">When the user enters a product name and price (such as "Acme Water" and 1.99, as in Figure 17) and clicks Insert, a postback ensues and the inserting workflow commences, culminating in a new product record being added to the database.</span></span> <span data-ttu-id="c6ac6-275">DetailsView は挿入インターフェイスを保持し、図18に示すように、新しい製品を含めるために GridView が自動的にデータソースに再バインドされます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-275">The DetailsView maintains its inserting interface and the GridView is automatically rebound to its data source in order to include the new product, as shown in Figure 18.</span></span>

![製品](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image52.png)

<span data-ttu-id="c6ac6-277">**図 18**: 製品 "Acme 水" がデータベースに追加されました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-277">**Figure 18**: The Product "Acme Water" Has Been Added to the Database</span></span>

<span data-ttu-id="c6ac6-278">図18の GridView には表示されませんが、DetailsView インターフェイス `CategoryID`、`SupplierID`、`QuantityPerUnit`などの製品フィールドは、データベースの値 `NULL` 割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-278">While the GridView in Figure 18 doesn't show it, the product fields lacking from the DetailsView interface `CategoryID`, `SupplierID`, `QuantityPerUnit`, and so on are assigned `NULL` database values.</span></span> <span data-ttu-id="c6ac6-279">これを確認するには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-279">You can see this by performing the following steps:</span></span>

1. <span data-ttu-id="c6ac6-280">Visual Studio でサーバーエクスプローラーにアクセスする</span><span class="sxs-lookup"><span data-stu-id="c6ac6-280">Go to the Server Explorer in Visual Studio</span></span>
2. <span data-ttu-id="c6ac6-281">`NORTHWND.MDF` データベースノードの展開</span><span class="sxs-lookup"><span data-stu-id="c6ac6-281">Expanding the `NORTHWND.MDF` database node</span></span>
3. <span data-ttu-id="c6ac6-282">`Products` データベーステーブルノードを右クリックします。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-282">Right-click on the `Products` database table node</span></span>
4. <span data-ttu-id="c6ac6-283">[テーブルデータの表示] を選択します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-283">Select Show Table Data</span></span>

<span data-ttu-id="c6ac6-284">これにより、`Products` テーブル内のすべてのレコードが一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-284">This will list all of the records in the `Products` table.</span></span> <span data-ttu-id="c6ac6-285">図19に示すように、`ProductID`、`ProductName`、および `UnitPrice` 以外のすべての新しい製品の列には `NULL` 値が設定されています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-285">As Figure 19 shows, all of our new product's columns other than `ProductID`, `ProductName`, and `UnitPrice` have `NULL` values.</span></span>

<span data-ttu-id="c6ac6-286">[DetailsView に指定されていない製品フィールドに NULL 値が割り当てられて ![](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-286">[![The Product Fields Not Provided in the DetailsView are Assigned NULL Values](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image53.png)</span></span>

<span data-ttu-id="c6ac6-287">**図 19**: DetailsView に指定されていない Product フィールドに値 `NULL` 割り当てられる ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image55.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-287">**Figure 19**: The Product Fields Not Provided in the DetailsView are Assigned `NULL` Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image55.png))</span></span>

<span data-ttu-id="c6ac6-288">これらの列値の1つまたは複数に対して、`NULL` 以外の既定値を指定することもできます。これは `NULL` が最適な既定のオプションではないため、またはデータベース列自体が `NULL` を許可しないためです。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-288">We may want to provide a default value other than `NULL` for one or more of these column values, either because `NULL` isn't the best default option or because the database column itself doesn't allow `NULL` s.</span></span> <span data-ttu-id="c6ac6-289">これを実現するには、DetailsView の `InputParameters` コレクションのパラメーターの値をプログラムで設定します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-289">To accomplish this we can programmatically set the values of the parameters of the DetailsView's `InputParameters` collection.</span></span> <span data-ttu-id="c6ac6-290">この割り当ては、DetailsView の `ItemInserting` イベントのイベントハンドラー、または ObjectDataSource の `Inserting` イベントに対して行うことができます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-290">This assignment can be done either in the event handler for the DetailsView's `ItemInserting` event or the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="c6ac6-291">データ Web コントロールレベルでは、事前レベルおよび事後レベルのイベントの使用について既に説明したので、ここでは ObjectDataSource のイベントを使用してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-291">Since we've already looked at using the pre- and post-level events at the data Web control level, let's explore using the ObjectDataSource's events this time.</span></span>

## <a name="step-4-assigning-values-to-thecategoryidandsupplieridparameters"></a><span data-ttu-id="c6ac6-292">手順 4:`CategoryID`および`SupplierID`パラメーターへの値の代入</span><span class="sxs-lookup"><span data-stu-id="c6ac6-292">Step 4: Assigning Values to the`CategoryID`and`SupplierID`Parameters</span></span>

<span data-ttu-id="c6ac6-293">このチュートリアルでは、このインターフェイスを使用して新しい製品を追加するときに、アプリケーションに対して、`CategoryID` と `SupplierID` 値1を割り当てる必要があることを考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-293">For this tutorial let's imagine that for our application when adding a new product through this interface it should be assigned a `CategoryID` and `SupplierID` value of 1.</span></span> <span data-ttu-id="c6ac6-294">既に説明したように、ObjectDataSource には、データ変更プロセス中に起動される、上位レベルおよびポストレベルのイベントのペアがあります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-294">As mentioned earlier, the ObjectDataSource has a pair of pre- and post-level events that fire during the data modification process.</span></span> <span data-ttu-id="c6ac6-295">`Insert()` メソッドが呼び出されると、ObjectDataSource は最初にその `Inserting` イベントを発生させ、その `Insert()` メソッドが割り当てられているメソッドを呼び出し、最後に `Inserted` イベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-295">When its `Insert()` method is invoked, the ObjectDataSource first raises its `Inserting` event, then calls the method that its `Insert()` method has been mapped to, and finally raises the `Inserted` event.</span></span> <span data-ttu-id="c6ac6-296">`Inserting` イベントハンドラーは、入力パラメーターを調整したり、操作を完全に取り消したりする最後の機会を与えます。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-296">The `Inserting` event handler affords us one last opportunity to tweak the input parameters or cancel the operation outright.</span></span>

> [!NOTE]
> <span data-ttu-id="c6ac6-297">実際のアプリケーションでは、ユーザーにカテゴリとサプライヤーを指定させたり、条件やビジネスロジック (ID 1 を選択するのではなく) に基づいてこの値を選択したりすることが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-297">In a real-world application you would likely want to either let the user specify the category and supplier or would pick this value for them based on some criteria or business logic (rather than blindly selecting an ID of 1).</span></span> <span data-ttu-id="c6ac6-298">に関係なく、この例は、ObjectDataSource の事前レベルイベントから入力パラメーターの値をプログラムで設定する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-298">Regardless, the example illustrates how to programmatically set the value of an input parameter from the ObjectDataSource's pre-level event.</span></span>

<span data-ttu-id="c6ac6-299">時間を取って、ObjectDataSource の `Inserting` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-299">Take a moment to create an event handler for the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="c6ac6-300">イベントハンドラーの2番目の入力パラメーターは `ObjectDataSourceMethodEventArgs`型のオブジェクトであることに注意してください。これには、parameters コレクション (`InputParameters`) にアクセスするためのプロパティと、操作をキャンセルするためのプロパティ (`Cancel`) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-300">Notice that the event handler's second input parameter is an object of type `ObjectDataSourceMethodEventArgs`, which has a property to access the parameters collection (`InputParameters`) and a property to cancel the operation (`Cancel`).</span></span>

[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample10.cs)]

<span data-ttu-id="c6ac6-301">この時点で、`InputParameters` プロパティには、DetailsView から割り当てられた値を持つ ObjectDataSource の `InsertParameters` コレクションが含まれています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-301">At this point, the `InputParameters` property contains the ObjectDataSource's `InsertParameters` collection with the values assigned from the DetailsView.</span></span> <span data-ttu-id="c6ac6-302">これらのパラメーターのいずれかの値を変更するには、単に: `e.InputParameters["paramName"] = value`を使用します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-302">To change the value of one of these parameters, simply use: `e.InputParameters["paramName"] = value`.</span></span> <span data-ttu-id="c6ac6-303">したがって、`CategoryID` と `SupplierID` を1の値に設定するには、`Inserting` イベントハンドラーを次のように調整します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-303">Therefore, to set the `CategoryID` and `SupplierID` to values of 1, adjust the `Inserting` event handler to look like the following:</span></span>

[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample11.cs)]

<span data-ttu-id="c6ac6-304">新しい製品 (Acme ソーダなど) を追加すると、新しい製品の `CategoryID` 列と `SupplierID` 列が1に設定されます (図20を参照)。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-304">This time when adding a new product (such as Acme Soda), the `CategoryID` and `SupplierID` columns of the new product are set to 1 (see Figure 20).</span></span>

<span data-ttu-id="c6ac6-305">[新しい製品 ![、CategoryID および仕入先の値が1に設定されました](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image56.png)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-305">[![New Products Now Have Their CategoryID and SupplierID Values Set to 1](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image56.png)</span></span>

<span data-ttu-id="c6ac6-306">**図 20**: 新しい製品の `CategoryID` と `SupplierID` の値が1に設定されました ([クリックすると、フルサイズの画像が表示](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image58.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-306">**Figure 20**: New Products Now Have Their `CategoryID` and `SupplierID` Values Set to 1 ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image58.png))</span></span>

## <a name="summary"></a><span data-ttu-id="c6ac6-307">まとめ</span><span class="sxs-lookup"><span data-stu-id="c6ac6-307">Summary</span></span>

<span data-ttu-id="c6ac6-308">編集、挿入、および削除のプロセスでは、データ Web コントロールと ObjectDataSource の両方が、いくつかの事前レベルおよび事後レベルのイベントを処理します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-308">During the editing, inserting, and deleting process, both the data Web control and the ObjectDataSource proceed through a number of pre- and post-level events.</span></span> <span data-ttu-id="c6ac6-309">このチュートリアルでは、事前レベルのイベントを確認し、これらを使用して入力パラメーターをカスタマイズする方法、またはデータの変更操作をデータ Web コントロールと ObjectDataSource のイベントの両方から完全にキャンセルする方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-309">In this tutorial we examined the pre-level events and saw how to use these to customize the input parameters or cancel the data modification operation altogether both from the data Web control and ObjectDataSource's events.</span></span> <span data-ttu-id="c6ac6-310">次のチュートリアルでは、投稿レベルのイベントのイベントハンドラーの作成と使用について説明します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-310">In the next tutorial we'll look at creating and using event handlers for the post-level events.</span></span>

<span data-ttu-id="c6ac6-311">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-311">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c6ac6-312">著者について</span><span class="sxs-lookup"><span data-stu-id="c6ac6-312">About the Author</span></span>

<span data-ttu-id="c6ac6-313">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c6ac6-314">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-314">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c6ac6-315">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-315">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c6ac6-316">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-316">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="c6ac6-317">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-317">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="c6ac6-318">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-318">Special Thanks To</span></span>

<span data-ttu-id="c6ac6-319">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-319">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c6ac6-320">このチュートリアルのリードレビュー担当者は、Jackie Goor and Liz Shulok でした。</span><span class="sxs-lookup"><span data-stu-id="c6ac6-320">Lead reviewers for this tutorial were Jackie Goor and Liz Shulok.</span></span> <span data-ttu-id="c6ac6-321">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="c6ac6-321">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c6ac6-322">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-322">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c6ac6-323">[前へ](an-overview-of-inserting-updating-and-deleting-data-cs.md)
> [次へ](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)</span><span class="sxs-lookup"><span data-stu-id="c6ac6-323">[Previous](an-overview-of-inserting-updating-and-deleting-data-cs.md)
[Next](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)</span></span>
