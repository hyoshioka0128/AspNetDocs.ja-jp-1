---
uid: web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/sorting-data-in-a-datalist-or-repeater-control-vb
title: DataList または Repeater コントロールでのデータの並べ替え (VB) |Microsoft Docs
author: rick-anderson
description: このチュートリアルでは、DataList と Repeater に並べ替えサポートを含める方法と、データを格納できる DataList または Repeater を構築する方法について説明します。
ms.author: riande
ms.date: 11/13/2006
ms.assetid: 97c13898-0741-45f9-b3fa-7540ab1679e6
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/sorting-data-in-a-datalist-or-repeater-control-vb
msc.type: authoredcontent
ms.openlocfilehash: 81e07bec8569b9ee987dfaa84dec9eec95a2692f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78465256"
---
# <a name="sorting-data-in-a-datalist-or-repeater-control-vb"></a><span data-ttu-id="22fb2-103">DataList または Repeater コントロールのデータを並べ替える (VB)</span><span class="sxs-lookup"><span data-stu-id="22fb2-103">Sorting Data in a DataList or Repeater Control (VB)</span></span>

<span data-ttu-id="22fb2-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="22fb2-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="22fb2-105">[サンプルアプリのダウンロード](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_45_VB.exe)または[PDF のダウンロード](sorting-data-in-a-datalist-or-repeater-control-vb/_static/datatutorial45vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="22fb2-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_45_VB.exe) or [Download PDF](sorting-data-in-a-datalist-or-repeater-control-vb/_static/datatutorial45vb1.pdf)</span></span>

> <span data-ttu-id="22fb2-106">このチュートリアルでは、DataList と Repeater に並べ替えサポートを含める方法と、データのページングと並べ替えが可能な DataList または Repeater を構築する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-106">In this tutorial we'll examine how to include sorting support in the DataList and Repeater, as well as how to construct a DataList or Repeater whose data can be paged and sorted.</span></span>

## <a name="introduction"></a><span data-ttu-id="22fb2-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="22fb2-107">Introduction</span></span>

<span data-ttu-id="22fb2-108">前の[チュートリアル](paging-report-data-in-a-datalist-or-repeater-control-vb.md)では、DataList にページングサポートを追加する方法を説明しています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-108">In the [previous tutorial](paging-report-data-in-a-datalist-or-repeater-control-vb.md) we examined how to add paging support to a DataList.</span></span> <span data-ttu-id="22fb2-109">`PagedDataSource` オブジェクトを返す `ProductsBLL` クラス (`GetProductsAsPagedDataSource`) に新しいメソッドを作成しました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-109">We created a new method in the `ProductsBLL` class (`GetProductsAsPagedDataSource`) that returned a `PagedDataSource` object.</span></span> <span data-ttu-id="22fb2-110">Datalist または repeater にバインドされている場合、DataList または Repeater は、要求されたデータのページだけを表示します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-110">When bound to a DataList or Repeater, the DataList or Repeater would display just the requested page of data.</span></span> <span data-ttu-id="22fb2-111">この手法は、組み込みの既定のページング機能を提供するために GridView、DetailsView、FormView コントロールによって内部的に使用されるものと似ています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-111">This technique is similar to what is used internally by the GridView, DetailsView, and FormView controls to provide their built-in default paging functionality.</span></span>

<span data-ttu-id="22fb2-112">GridView には、ページングをサポートするだけでなく、すぐに使える並べ替えサポートも含まれています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-112">In addition to offering paging support, the GridView also includes out of the box sorting support.</span></span> <span data-ttu-id="22fb2-113">DataList も Repeater も、組み込みの並べ替え機能を提供しません。ただし、部分的なコードを使用して並べ替え機能を追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-113">Neither the DataList nor Repeater provides built-in sorting functionality; however, sorting features can be added with a bit of code.</span></span> <span data-ttu-id="22fb2-114">このチュートリアルでは、DataList と Repeater に並べ替えサポートを含める方法と、データのページングと並べ替えが可能な DataList または Repeater を構築する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-114">In this tutorial we'll examine how to include sorting support in the DataList and Repeater, as well as how to construct a DataList or Repeater whose data can be paged and sorted.</span></span>

## <a name="a-review-of-sorting"></a><span data-ttu-id="22fb2-115">並べ替えのレビュー</span><span class="sxs-lookup"><span data-stu-id="22fb2-115">A Review of Sorting</span></span>

<span data-ttu-id="22fb2-116">「[レポートデータのページングと並べ替え](../paging-and-sorting/paging-and-sorting-report-data-vb.md)」チュートリアルで説明したように、GridView コントロールには、すぐに使用できる並べ替えサポートが用意されています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-116">As we saw in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-vb.md) tutorial, the GridView control provides out of the box sorting support.</span></span> <span data-ttu-id="22fb2-117">各 GridView フィールドに関連付けられた `SortExpression`を持つことができます。これは、データの並べ替えに使用するデータフィールドを示します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-117">Each GridView field can have an associated `SortExpression`, which indicates the data field by which to sort the data.</span></span> <span data-ttu-id="22fb2-118">GridView の `AllowSorting` プロパティが `true`に設定されている場合、`SortExpression` プロパティ値を持つ各 GridView フィールドのヘッダーは LinkButton として表示されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-118">When the GridView s `AllowSorting` property is set to `true`, each GridView field that has a `SortExpression` property value has its header rendered as a LinkButton.</span></span> <span data-ttu-id="22fb2-119">ユーザーが特定の GridView フィールド s ヘッダーをクリックすると、ポストバックが発生し、クリックされたフィールド s `SortExpression`に従ってデータが並べ替えられます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-119">When a user clicks a particular GridView field s header, a postback occurs and the data is sorted according to the clicked field s `SortExpression`.</span></span>

<span data-ttu-id="22fb2-120">GridView コントロールには、データの並べ替えに使用される GridView フィールドの `SortExpression` を格納する `SortExpression` プロパティもあります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-120">The GridView control has a `SortExpression` property as well, which stores the `SortExpression` of the GridView field the data is sorted by.</span></span> <span data-ttu-id="22fb2-121">また、`SortDirection` プロパティは、データを昇順または降順で並べ替えるかどうかを示します (ユーザーが特定の GridView フィールド s ヘッダーリンクを連続して2回クリックした場合、並べ替え順序が切り替わります)。</span><span class="sxs-lookup"><span data-stu-id="22fb2-121">Additionally, a `SortDirection` property indicates whether the data is to be sorted in ascending or descending order (if a user clicks a particular GridView field s header link twice in succession, the sort order is toggled).</span></span>

<span data-ttu-id="22fb2-122">GridView がデータソースコントロールにバインドされている場合、その `SortExpression` を渡し、プロパティをデータソースコントロールに `SortDirection` します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-122">When the GridView is bound to its data source control, it hands off its `SortExpression` and `SortDirection` properties to the data source control.</span></span> <span data-ttu-id="22fb2-123">データソースコントロールはデータを取得し、指定された `SortExpression` および `SortDirection` プロパティに従ってデータを並べ替えます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-123">The data source control retrieves the data and then sorts it according to the supplied `SortExpression` and `SortDirection` properties.</span></span> <span data-ttu-id="22fb2-124">データを並べ替えると、データソースコントロールによってデータが GridView に返されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-124">After sorting the data, the data source control returns it to the GridView.</span></span>

<span data-ttu-id="22fb2-125">DataList または Repeater コントロールを使用してこの機能をレプリケートするには、次の操作を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-125">To replicate this functionality with the DataList or Repeater controls, we must:</span></span>

- <span data-ttu-id="22fb2-126">並べ替えインターフェイスを作成する</span><span class="sxs-lookup"><span data-stu-id="22fb2-126">Create a sorting interface</span></span>
- <span data-ttu-id="22fb2-127">並べ替えの基準となるデータフィールドと、昇順と降順のどちらで並べ替えるかを忘れないでください。</span><span class="sxs-lookup"><span data-stu-id="22fb2-127">Remember the data field to sort by and whether to sort in ascending or descending order</span></span>
- <span data-ttu-id="22fb2-128">特定のデータフィールドでデータを並べ替えるように ObjectDataSource に指示します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-128">Instruct the ObjectDataSource to sort the data by a particular data field</span></span>

<span data-ttu-id="22fb2-129">ここでは、手順3と4の3つのタスクについて説明します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-129">We'll tackle these three tasks in steps 3 and 4.</span></span> <span data-ttu-id="22fb2-130">ここでは、DataList または Repeater でページングと並べ替えの両方のサポートを含める方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-130">Following that, we'll examine how to include both paging and sorting support in a DataList or Repeater.</span></span>

## <a name="step-2-displaying-the-products-in-a-repeater"></a><span data-ttu-id="22fb2-131">手順 2: リピータでの製品の表示</span><span class="sxs-lookup"><span data-stu-id="22fb2-131">Step 2: Displaying the Products in a Repeater</span></span>

<span data-ttu-id="22fb2-132">並べ替えに関連する機能の実装について心配する前に、まずリピータコントロールに製品を一覧表示してみましょう。</span><span class="sxs-lookup"><span data-stu-id="22fb2-132">Before we worry about implementing any of the sorting-related functionality, let s start by listing the products in a Repeater control.</span></span> <span data-ttu-id="22fb2-133">まず、`PagingSortingDataListRepeater` フォルダーの [`Sorting.aspx`] ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-133">Start by opening the `Sorting.aspx` page in the `PagingSortingDataListRepeater` folder.</span></span> <span data-ttu-id="22fb2-134">Repeater コントロールを web ページに追加し、その `ID` プロパティを `SortableProducts`に設定します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-134">Add a Repeater control to the web page, setting its `ID` property to `SortableProducts`.</span></span> <span data-ttu-id="22fb2-135">Repeater s スマートタグから `ProductsDataSource` という名前の新しい ObjectDataSource を作成し、`ProductsBLL` クラス s `GetProducts()` メソッドからデータを取得するように構成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-135">From the Repeater s smart tag, create a new ObjectDataSource named `ProductsDataSource` and configure it to retrieve data from the `ProductsBLL` class s `GetProducts()` method.</span></span> <span data-ttu-id="22fb2-136">[挿入]、[更新]、および [削除] の各タブのドロップダウンリストから [(なし)] オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-136">Select the (None) option from the drop-down lists in the INSERT, UPDATE, and DELETE tabs.</span></span>

<span data-ttu-id="22fb2-137">[ObjectDataSource を作成 ![、GetProductsAsPagedDataSource () メソッドを使用するように構成します。](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image2.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-137">[![Create an ObjectDataSource and Configure it to Use the GetProductsAsPagedDataSource() Method](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image2.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image1.png)</span></span>

<span data-ttu-id="22fb2-138">**図 1**: ObjectDataSource を作成し、`GetProductsAsPagedDataSource()` メソッドを使用するように構成する ([クリックしてフルサイズのイメージを表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="22fb2-138">**Figure 1**: Create an ObjectDataSource and Configure it to Use the `GetProductsAsPagedDataSource()` Method ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image3.png))</span></span>

<span data-ttu-id="22fb2-139">[[更新]、[挿入]、[削除] の各タブのドロップダウンリストを [(なし)] に設定 ![ます。](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image5.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-139">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image5.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image4.png)</span></span>

<span data-ttu-id="22fb2-140">**図 2**: [更新]、[挿入]、[削除] の各タブのドロップダウンリストを (なし) に設定する ([クリックしてフルサイズの画像を表示する](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="22fb2-140">**Figure 2**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None) ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image6.png))</span></span>

<span data-ttu-id="22fb2-141">DataList とは異なり、Visual Studio では、データソースにバインドした後、Repeater コントロールの `ItemTemplate` が自動的に作成されません。</span><span class="sxs-lookup"><span data-stu-id="22fb2-141">Unlike with the DataList, Visual Studio does not automatically create an `ItemTemplate` for the Repeater control after binding it to a data source.</span></span> <span data-ttu-id="22fb2-142">さらに、この `ItemTemplate` を宣言的に追加する必要があります。これは、Repeater コントロール s スマートタグに、DataList s で見つかった [テンプレートの編集] オプションがないためです。</span><span class="sxs-lookup"><span data-stu-id="22fb2-142">Furthermore, we must add this `ItemTemplate` declaratively, as the Repeater control s smart tag lacks the Edit Templates option found in the DataList s.</span></span> <span data-ttu-id="22fb2-143">ここでは、製品名、供給業者、カテゴリを表示する前のチュートリアルと同じ `ItemTemplate` を使用します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-143">Let s use the same `ItemTemplate` from the previous tutorial, which displayed the product s name, supplier, and category.</span></span>

<span data-ttu-id="22fb2-144">`ItemTemplate`を追加した後、リピータおよび ObjectDataSource の宣言マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-144">After adding the `ItemTemplate`, the Repeater and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample1.aspx)]

<span data-ttu-id="22fb2-145">図3は、ブラウザーを使用して表示するときのこのページを示しています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-145">Figure 3 shows this page when viewed through a browser.</span></span>

<span data-ttu-id="22fb2-146">[各製品の名前、供給業者、およびカテゴリが ![表示されます。](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image8.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-146">[![Each Product s Name, Supplier, and Category is Displayed](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image8.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image7.png)</span></span>

<span data-ttu-id="22fb2-147">**図 3**: 各製品の名前、供給業者、カテゴリが表示されます ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image9.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-147">**Figure 3**: Each Product s Name, Supplier, and Category is Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image9.png))</span></span>

## <a name="step-3-instructing-the-objectdatasource-to-sort-the-data"></a><span data-ttu-id="22fb2-148">手順 3: データの並べ替えを ObjectDataSource に指示する</span><span class="sxs-lookup"><span data-stu-id="22fb2-148">Step 3: Instructing the ObjectDataSource to Sort the Data</span></span>

<span data-ttu-id="22fb2-149">リピータに表示されるデータを並べ替えるには、データの並べ替えに使用する並べ替え式を ObjectDataSource に通知する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-149">To sort the data displayed in the Repeater, we need to inform the ObjectDataSource of the sort expression by which the data should be sorted.</span></span> <span data-ttu-id="22fb2-150">ObjectDataSource によってデータが取得される前に、まず[`Selecting` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selecting.aspx)が発生します。これにより、並べ替え式を指定できるようになります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-150">Before the ObjectDataSource retrieves its data, it first fires its [`Selecting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selecting.aspx), which provides an opportunity for us to specify a sort expression.</span></span> <span data-ttu-id="22fb2-151">`Selecting` イベントハンドラーに[`ObjectDataSourceSelectingEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.aspx)型のオブジェクトが渡されます。このオブジェクトには、 [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx)型の[`Arguments`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.arguments.aspx)という名前のプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-151">The `Selecting` event handler is passed an object of type [`ObjectDataSourceSelectingEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.aspx), which has a property named [`Arguments`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.arguments.aspx) of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx).</span></span> <span data-ttu-id="22fb2-152">`DataSourceSelectArguments` クラスは、データのコンシューマーからデータソースコントロールにデータ関連の要求を渡すように設計されており、 [`SortExpression` のプロパティ](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.sortexpression.aspx)が含まれています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-152">The `DataSourceSelectArguments` class is designed to pass data-related requests from a consumer of data to the data source control, and includes a [`SortExpression` property](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.sortexpression.aspx).</span></span>

<span data-ttu-id="22fb2-153">並べ替え情報を ASP.NET ページから ObjectDataSource に渡すには、`Selecting` イベントのイベントハンドラーを作成し、次のコードを使用します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-153">To pass sorting information from the ASP.NET page to the ObjectDataSource, create an event handler for the `Selecting` event and use the following code:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample2.vb)]

<span data-ttu-id="22fb2-154">*SortExpression*値には、データの並べ替えに使用するデータフィールドの名前 (ProductName など) を割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-154">The *sortExpression* value should be assigned the name of the data field to sort the data by (such as ProductName ).</span></span> <span data-ttu-id="22fb2-155">並べ替えの方向に関連するプロパティはありません。そのため、データを降順に並べ替える場合は、 *sortExpression*値 (ProductName desc など) に文字列 DESC を追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-155">There is no sort direction-related property, so if you want to sort the data in descending order, append the string DESC to the *sortExpression* value (such as ProductName DESC ).</span></span>

<span data-ttu-id="22fb2-156">*SortExpression*に対してハードコーディングされた別の値を試し、ブラウザーで結果をテストしてみましょう。</span><span class="sxs-lookup"><span data-stu-id="22fb2-156">Go ahead and try some different hard-coded values for *sortExpression* and test the results in a browser.</span></span> <span data-ttu-id="22fb2-157">図4に示すように、ProductName DESC を*sortExpression*として使用する場合、製品は名前の逆順でアルファベット順に並べ替えられます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-157">As Figure 4 shows, when using ProductName DESC as the *sortExpression*, the products are sorted by their name in reverse alphabetical order.</span></span>

<span data-ttu-id="22fb2-158">[製品の名前をアルファベットの逆順で並べ替える ![](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image11.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-158">[![The Products are Sorted by their Name in Reverse Alphabetical Order](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image11.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image10.png)</span></span>

<span data-ttu-id="22fb2-159">**図 4**: 製品はアルファベットの逆順で名前順に並べ替えられます ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-159">**Figure 4**: The Products are Sorted by their Name in Reverse Alphabetical Order ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image12.png))</span></span>

## <a name="step-4-creating-the-sorting-interface-and-remembering-the-sort-expression-and-direction"></a><span data-ttu-id="22fb2-160">手順 4: 並べ替えインターフェイスを作成し、並べ替え式と方向を記憶する</span><span class="sxs-lookup"><span data-stu-id="22fb2-160">Step 4: Creating the Sorting Interface and Remembering the Sort Expression and Direction</span></span>

<span data-ttu-id="22fb2-161">GridView で並べ替えのサポートを有効にすると、並べ替え可能な各フィールドのヘッダーテキストが LinkButton に変換され、クリックすると、それに応じてデータが並べ替えられます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-161">Turning on sorting support in the GridView converts each sortable field s header text into a LinkButton that, when clicked, sorts the data accordingly.</span></span> <span data-ttu-id="22fb2-162">このような並べ替えインターフェイスは、データが列に適切に配置されている GridView に適しています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-162">Such a sorting interface makes sense for the GridView, where its data is neatly laid out in columns.</span></span> <span data-ttu-id="22fb2-163">ただし、DataList コントロールと Repeater コントロールでは、別の並べ替えインターフェイスが必要です。</span><span class="sxs-lookup"><span data-stu-id="22fb2-163">For the DataList and Repeater controls, however, a different sorting interface is needed.</span></span> <span data-ttu-id="22fb2-164">データの一覧に対する一般的な並べ替えインターフェイス (データのグリッドではなく) は、データの並べ替えに使用するフィールドを示すドロップダウンリストです。</span><span class="sxs-lookup"><span data-stu-id="22fb2-164">A common sorting interface for a list of data (as opposed to a grid of data), is a drop-down list that provides the fields by which the data can be sorted.</span></span> <span data-ttu-id="22fb2-165">このチュートリアルでは、このようなインターフェイスを実装します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-165">Let s implement such an interface for this tutorial.</span></span>

<span data-ttu-id="22fb2-166">`SortableProducts` リピータの上に DropDownList Web コントロールを追加し、その `ID` プロパティを `SortBy`に設定します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-166">Add a DropDownList Web control above the `SortableProducts` Repeater and set its `ID` property to `SortBy`.</span></span> <span data-ttu-id="22fb2-167">プロパティウィンドウから、`Items` プロパティの省略記号をクリックして、ListItem コレクションエディターを表示します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-167">From the Properties window, click the ellipses in the `Items` property to bring up the ListItem Collection Editor.</span></span> <span data-ttu-id="22fb2-168">`ProductName`、`CategoryName`、および `SupplierName` の各フィールドでデータを並べ替えるには `ListItem` s を追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-168">Add `ListItem` s to sort the data by the `ProductName`, `CategoryName`, and `SupplierName` fields.</span></span> <span data-ttu-id="22fb2-169">また、製品を名前で逆順にアルファベット順に並べ替える `ListItem` も追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-169">Also add a `ListItem` to sort the products by their name in reverse alphabetical order.</span></span>

<span data-ttu-id="22fb2-170">`ListItem` `Text` のプロパティを任意の値 (Name など) に設定できますが、`Value` プロパティはデータフィールドの名前 (ProductName など) に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-170">The `ListItem` `Text` properties can be set to any value (such as Name ), but the `Value` properties must be set to the name of the data field (such as ProductName ).</span></span> <span data-ttu-id="22fb2-171">結果を降順に並べ替えるには、ProductName DESC のように、データフィールド名に文字列 DESC を追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-171">To sort the results in descending order, append the string DESC to the data field name, like ProductName DESC .</span></span>

![並べ替え可能な各データフィールドの ListItem を追加する](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image13.png)

<span data-ttu-id="22fb2-173">**図 5**: 並べ替え可能な各データフィールドの `ListItem` を追加する</span><span class="sxs-lookup"><span data-stu-id="22fb2-173">**Figure 5**: Add a `ListItem` for Each of the Sortable Data Fields</span></span>

<span data-ttu-id="22fb2-174">最後に、DropDownList の右側にボタン Web コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-174">Finally, add a Button Web control to the right of the DropDownList.</span></span> <span data-ttu-id="22fb2-175">`ID` を `RefreshRepeater` に設定し、その `Text` プロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-175">Set its `ID` to `RefreshRepeater` and its `Text` property to Refresh .</span></span>

<span data-ttu-id="22fb2-176">`ListItem` s を作成して [更新] ボタンを追加すると、DropDownList とボタンの宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-176">After creating the `ListItem` s and adding the Refresh button, the DropDownList and Button s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample3.aspx)]

<span data-ttu-id="22fb2-177">並べ替えの DropDownList が完了したら、次に ObjectDataSource s `Selecting` イベントハンドラーを更新して、ハードコーディングされた並べ替え式ではなく、選択した `SortBy``ListItem` s `Value` プロパティを使用するようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-177">With the sorting DropDownList complete, we next need to update the ObjectDataSource s `Selecting` event handler so that it uses the selected `SortBy``ListItem` s `Value` property as opposed to a hard-coded sort expression.</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample4.vb)]

<span data-ttu-id="22fb2-178">この時点で、最初にページにアクセスしたときに、製品は最初に `ProductName` データフィールドによって並べ替えられます。これは、`SortBy` `ListItem` 既定で選択されているためです (図6を参照)。</span><span class="sxs-lookup"><span data-stu-id="22fb2-178">At this point when first visiting the page the products will initially be sorted by the `ProductName` data field, as it s the `SortBy` `ListItem` selected by default (see Figure 6).</span></span> <span data-ttu-id="22fb2-179">[カテゴリ] や [更新] をクリックするなど、別の並べ替えオプションを選択すると、図7に示すように、ポストバックが発生し、カテゴリ名によってデータが再並べ替えされます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-179">Selecting a different sorting option such as Category and clicking Refresh will cause a postback and re-sort the data by the category name, as Figure 7 shows.</span></span>

<span data-ttu-id="22fb2-180">[製品が最初に名前順に並べ替えられた ![](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image15.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-180">[![The Products are Initially Sorted by their Name](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image15.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image14.png)</span></span>

<span data-ttu-id="22fb2-181">**図 6**: 製品は最初に名前で並べ替えられます ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image16.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-181">**Figure 6**: The Products are Initially Sorted by their Name ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image16.png))</span></span>

<span data-ttu-id="22fb2-182">[製品がカテゴリ別に並べ替えられた ![](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image18.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-182">[![The Products are Now Sorted by Category](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image18.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image17.png)</span></span>

<span data-ttu-id="22fb2-183">**図 7**: 製品がカテゴリ別に並べ替えられるようになりました ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image19.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-183">**Figure 7**: The Products are Now Sorted by Category ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image19.png))</span></span>

> [!NOTE]
> <span data-ttu-id="22fb2-184">[最新の情報に更新] ボタンをクリックすると、Repeater のビューステートが無効になっているため、データが自動的に並べ替えられます。これにより、リピータは、すべてのポストバック時にそのデータソースに再バインドされます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-184">Clicking the Refresh button causes the data to automatically be re-sorted because the Repeater s view state has been disabled, thereby causing the Repeater to rebind to its data source on every postback.</span></span> <span data-ttu-id="22fb2-185">リピータのビューステートを有効にしたままにした場合、並べ替えのドロップダウンリストを変更しても、並べ替え順序に影響はありません。</span><span class="sxs-lookup"><span data-stu-id="22fb2-185">If you ve left the Repeater s view state enabled, changing the sorting drop-down list won't have any affect on the sort order.</span></span> <span data-ttu-id="22fb2-186">これを解決するには、Refresh Button s `Click` イベントのイベントハンドラーを作成し、repeater をそのデータソースに再バインドします (Repeater s `DataBind()` メソッドを呼び出します)。</span><span class="sxs-lookup"><span data-stu-id="22fb2-186">To remedy this, create an event handler for the Refresh Button s `Click` event and rebind the Repeater to its data source (by calling the Repeater s `DataBind()` method).</span></span>

## <a name="remembering-the-sort-expression-and-direction"></a><span data-ttu-id="22fb2-187">並べ替え式と方向の記憶</span><span class="sxs-lookup"><span data-stu-id="22fb2-187">Remembering the Sort Expression and Direction</span></span>

<span data-ttu-id="22fb2-188">並べ替えられていない関連のポストバックが発生する可能性があるページで、並べ替え可能な DataList または Repeater を作成する場合は、並べ替え式と方向をポストバック間で記録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-188">When creating a sortable DataList or Repeater on a page where non-sort related postbacks may occur, it s imperative that the sort expression and direction be remembered across postbacks.</span></span> <span data-ttu-id="22fb2-189">たとえば、このチュートリアルでリピータを更新して、各製品に [削除] ボタンを追加したとします。</span><span class="sxs-lookup"><span data-stu-id="22fb2-189">For example, imagine that we updated the Repeater in this tutorial to include a Delete button with each product.</span></span> <span data-ttu-id="22fb2-190">ユーザーが [削除] ボタンをクリックしたときに、選択した製品を削除するコードをいくつか実行し、そのデータを Repeater に再バインドします。</span><span class="sxs-lookup"><span data-stu-id="22fb2-190">When the user clicks the Delete button we d run some code to delete the selected product and then rebind the data to the Repeater.</span></span> <span data-ttu-id="22fb2-191">ポストバック間で並べ替えの詳細が保持されていない場合、画面に表示されるデータは元の並べ替え順序に戻ります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-191">If the sort details are not persisted across postback, the data displayed on screen will revert to the original sort order.</span></span>

<span data-ttu-id="22fb2-192">このチュートリアルでは、DropDownList は並べ替え式と方向をビューステートに暗黙的に保存します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-192">For this tutorial, the DropDownList implicitly saves the sort expression and direction in its view state for us.</span></span> <span data-ttu-id="22fb2-193">別の並べ替えインターフェイスを使用していた場合、たとえば、さまざまな並べ替えオプションを提供する LinkButtons では、ポストバック間で並べ替え順序を記憶する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-193">If we were using a different sorting interface one with, say, LinkButtons that provided the various sorting options we d need to take care to remember the sort order across postbacks.</span></span> <span data-ttu-id="22fb2-194">これを実現するには、並べ替えパラメーターをページのビューステートに格納します。そのためには、querystring に sort パラメーターを含めるか、他の状態の永続化手法を使用します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-194">This could be accomplished by storing the sorting parameters in the page s view state, by including the sort parameter in the querystring, or through some other state persistence technique.</span></span>

<span data-ttu-id="22fb2-195">このチュートリアルの今後の例では、ページ s ビューステートに並べ替えの詳細を保持する方法を紹介します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-195">Future examples in this tutorial explore how to persist the sorting details in the page s view state.</span></span>

## <a name="step-5-adding-sorting-support-to-a-datalist-that-uses-default-paging"></a><span data-ttu-id="22fb2-196">手順 5: 既定のページングを使用する DataList に並べ替えサポートを追加する</span><span class="sxs-lookup"><span data-stu-id="22fb2-196">Step 5: Adding Sorting Support to a DataList that Uses Default Paging</span></span>

<span data-ttu-id="22fb2-197">前の[チュートリアル](paging-report-data-in-a-datalist-or-repeater-control-vb.md)では、DataList を使用して既定のページングを実装する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-197">In the [preceding tutorial](paging-report-data-in-a-datalist-or-repeater-control-vb.md) we examined how to implement default paging with a DataList.</span></span> <span data-ttu-id="22fb2-198">では、この前の例を拡張して、ページングされたデータを並べ替える機能を追加してみましょう。</span><span class="sxs-lookup"><span data-stu-id="22fb2-198">Let s extend this previous example to include the ability to sort the paged data.</span></span> <span data-ttu-id="22fb2-199">まず、`PagingSortingDataListRepeater` フォルダーの `SortingWithDefaultPaging.aspx` と `Paging.aspx` のページを開きます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-199">Start by opening the `SortingWithDefaultPaging.aspx` and `Paging.aspx` pages in the `PagingSortingDataListRepeater` folder.</span></span> <span data-ttu-id="22fb2-200">[`Paging.aspx`] ページで、[ソース] ボタンをクリックして、ページの宣言型マークアップを表示します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-200">From the `Paging.aspx` page, click on the Source button to view the page s declarative markup.</span></span> <span data-ttu-id="22fb2-201">選択したテキストをコピーし (図8を参照)、`<asp:Content>` タグ間の `SortingWithDefaultPaging.aspx` の宣言型マークアップに貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-201">Copy the selected text (see Figure 8) and paste it into the declarative markup of `SortingWithDefaultPaging.aspx` between the `<asp:Content>` tags.</span></span>

<span data-ttu-id="22fb2-202">[![、&lt;asp: Content&gt; Tags から SortingWithDefaultPaging に宣言マークアップをレプリケートします。](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image21.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-202">[![Replicate the Declarative Markup in the &lt;asp:Content&gt; Tags from Paging.aspx to SortingWithDefaultPaging.aspx](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image21.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image20.png)</span></span>

<span data-ttu-id="22fb2-203">**図 8**: `Paging.aspx` から `SortingWithDefaultPaging.aspx` に `<asp:Content>` タグの宣言マークアップをレプリケートする ([クリックしてフルサイズのイメージを表示する](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="22fb2-203">**Figure 8**: Replicate the Declarative Markup in the `<asp:Content>` Tags from `Paging.aspx` to `SortingWithDefaultPaging.aspx` ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image22.png))</span></span>

<span data-ttu-id="22fb2-204">宣言型マークアップをコピーしたら、`Paging.aspx` ページの分離コードクラスのメソッドとプロパティを `SortingWithDefaultPaging.aspx`の分離コードクラスにコピーします。</span><span class="sxs-lookup"><span data-stu-id="22fb2-204">After copying the declarative markup, copy the methods and properties in the `Paging.aspx` page s code-behind class to the code-behind class for `SortingWithDefaultPaging.aspx`.</span></span> <span data-ttu-id="22fb2-205">次に、ブラウザーで `SortingWithDefaultPaging.aspx` ページを表示します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-205">Next, take a moment to view the `SortingWithDefaultPaging.aspx` page in a browser.</span></span> <span data-ttu-id="22fb2-206">`Paging.aspx`と同じ機能と外観が表示されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-206">It should exhibit the same functionality and appearance as `Paging.aspx`.</span></span>

## <a name="enhancing-productsbll-to-include-a-default-paging-and-sorting-method"></a><span data-ttu-id="22fb2-207">既定のページングと並べ替え方法を含むように、製品の Bll を強化する</span><span class="sxs-lookup"><span data-stu-id="22fb2-207">Enhancing ProductsBLL to Include a Default Paging and Sorting Method</span></span>

<span data-ttu-id="22fb2-208">前のチュートリアルでは、`PagedDataSource` オブジェクトを返す `ProductsBLL` クラスの `GetProductsAsPagedDataSource(pageIndex, pageSize)` メソッドを作成しました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-208">In the previous tutorial we created a `GetProductsAsPagedDataSource(pageIndex, pageSize)` method in the `ProductsBLL` class that returned a `PagedDataSource` object.</span></span> <span data-ttu-id="22fb2-209">この `PagedDataSource` オブジェクトには、(BLL s `GetProducts()` メソッドを使用して)*すべて*の製品が格納されていますが、DataList にバインドされている場合は、指定した*pageIndex*および*pageSize*入力パラメーターに対応するレコードのみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-209">This `PagedDataSource` object was populated with *all* of the products (via the BLL s `GetProducts()` method), but when bound to the DataList only those records corresponding to the specified *pageIndex* and *pageSize* input parameters were displayed.</span></span>

<span data-ttu-id="22fb2-210">このチュートリアルの前半では、ObjectDataSource s `Selecting` イベントハンドラーから並べ替え式を指定して、並べ替えサポートを追加しました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-210">Earlier in this tutorial we added sorting support by specifying the sort expression from the ObjectDataSource s `Selecting` event handler.</span></span> <span data-ttu-id="22fb2-211">これは、ObjectDataSource が、`GetProducts()` メソッドによって返される `ProductsDataTable` のように、並べ替え可能なオブジェクトを返す場合に適しています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-211">This works well when the ObjectDataSource is returned an object that can be sorted, like the `ProductsDataTable` returned by the `GetProducts()` method.</span></span> <span data-ttu-id="22fb2-212">ただし、`GetProductsAsPagedDataSource` メソッドによって返された `PagedDataSource` オブジェクトは、内部データソースの並べ替えをサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="22fb2-212">However, the `PagedDataSource` object returned by the `GetProductsAsPagedDataSource` method does not support sorting of its inner data source.</span></span> <span data-ttu-id="22fb2-213">代わりに、`GetProducts()` メソッドから返された結果を `PagedDataSource`に配置する*前*に並べ替える必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-213">Instead, we need to sort the results returned from the `GetProducts()` method *before* we put it in the `PagedDataSource`.</span></span>

<span data-ttu-id="22fb2-214">これを実現するには、`ProductsBLL` クラスで新しいメソッドを作成し、`GetProductsSortedAsPagedDataSource(sortExpression, pageIndex, pageSize)`します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-214">To accomplish this, create a new method in the `ProductsBLL` class, `GetProductsSortedAsPagedDataSource(sortExpression, pageIndex, pageSize)`.</span></span> <span data-ttu-id="22fb2-215">`GetProducts()` メソッドによって返される `ProductsDataTable` を並べ替えるには、既定の `DataTableView`の `Sort` プロパティを指定します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-215">To sort the `ProductsDataTable` returned by the `GetProducts()` method, specify the `Sort` property of its default `DataTableView`:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample5.vb)]

<span data-ttu-id="22fb2-216">`GetProductsSortedAsPagedDataSource` メソッドは、前のチュートリアルで作成した `GetProductsAsPagedDataSource` メソッドとはわずかに異なります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-216">The `GetProductsSortedAsPagedDataSource` method differs only slightly from the `GetProductsAsPagedDataSource` method created in the previous tutorial.</span></span> <span data-ttu-id="22fb2-217">特に、`GetProductsSortedAsPagedDataSource` は追加の入力パラメーター `sortExpression` を受け取り、この値を `ProductDataTable` s `DefaultView`の `Sort` プロパティに割り当てます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-217">In particular, `GetProductsSortedAsPagedDataSource` accepts an additional input parameter `sortExpression` and assigns this value to the `Sort` property of the `ProductDataTable` s `DefaultView`.</span></span> <span data-ttu-id="22fb2-218">数行のコードでは、`PagedDataSource` object s DataSource に `ProductDataTable` s `DefaultView`が割り当てられています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-218">A few lines of code later, the `PagedDataSource` object s DataSource is assigned the `ProductDataTable` s `DefaultView`.</span></span>

## <a name="calling-the-getproductssortedaspageddatasource-method-and-specifying-the-value-for-the-sortexpression-input-parameter"></a><span data-ttu-id="22fb2-219">GetProductsSortedAsPagedDataSource メソッドを呼び出し、SortExpression 入力パラメーターの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-219">Calling the GetProductsSortedAsPagedDataSource Method and Specifying the Value for the SortExpression Input Parameter</span></span>

<span data-ttu-id="22fb2-220">`GetProductsSortedAsPagedDataSource` メソッドが完了したら、次の手順として、このパラメーターの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-220">With the `GetProductsSortedAsPagedDataSource` method complete, the next step is to provide the value for this parameter.</span></span> <span data-ttu-id="22fb2-221">`SortingWithDefaultPaging.aspx` の ObjectDataSource は、現在、`GetProductsAsPagedDataSource` メソッドを呼び出すように構成されており、2つの入力パラメーターを、`SelectParameters` コレクションで指定されている2つの `QueryStringParameters`を介して渡します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-221">The ObjectDataSource in `SortingWithDefaultPaging.aspx` is currently configured to call the `GetProductsAsPagedDataSource` method and passes in the two input parameters through its two `QueryStringParameters`, which are specified in the `SelectParameters` collection.</span></span> <span data-ttu-id="22fb2-222">これらの2つの `QueryStringParameters` は、`GetProductsAsPagedDataSource` メソッドの*pageIndex*および*pageSize*パラメーターのソースが、`pageIndex` と `pageSize`のクエリ文字列フィールドから取得されることを示します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-222">These two `QueryStringParameters` indicate that the source for the `GetProductsAsPagedDataSource` method s *pageIndex* and *pageSize* parameters come from the querystring fields `pageIndex` and `pageSize`.</span></span>

<span data-ttu-id="22fb2-223">新しい `GetProductsSortedAsPagedDataSource` メソッドを呼び出すように、ObjectDataSource s `SelectMethod` プロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-223">Update the ObjectDataSource s `SelectMethod` property so that it invokes the new `GetProductsSortedAsPagedDataSource` method.</span></span> <span data-ttu-id="22fb2-224">次に、新しい `QueryStringParameter` を追加して、クエリ文字列フィールド `sortExpression`から*sortExpression*入力パラメーターにアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="22fb2-224">Then, add a new `QueryStringParameter` so that the *sortExpression* input parameter is accessed from the querystring field `sortExpression`.</span></span> <span data-ttu-id="22fb2-225">`QueryStringParameter` s `DefaultValue` を ProductName に設定します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-225">Set the `QueryStringParameter` s `DefaultValue` to ProductName .</span></span>

<span data-ttu-id="22fb2-226">これらの変更を行った後、ObjectDataSource s 宣言マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-226">After these changes, the ObjectDataSource s declarative markup should look like:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample6.aspx)]

<span data-ttu-id="22fb2-227">この時点で、`SortingWithDefaultPaging.aspx` ページは結果を製品名でアルファベット順に並べ替えます (図9を参照)。</span><span class="sxs-lookup"><span data-stu-id="22fb2-227">At this point, the `SortingWithDefaultPaging.aspx` page will sort its results alphabetically by the product name (see Figure 9).</span></span> <span data-ttu-id="22fb2-228">これは、既定では、ProductName の値が `GetProductsSortedAsPagedDataSource` method s *sortExpression*パラメーターとして渡されるためです。</span><span class="sxs-lookup"><span data-stu-id="22fb2-228">This is because, by default, a value of ProductName is passed in as the `GetProductsSortedAsPagedDataSource` method s *sortExpression* parameter.</span></span>

<span data-ttu-id="22fb2-229">[![既定では、結果は ProductName 別に並べ替えられます。](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image24.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-229">[![By Default, the Results are Sorted by ProductName](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image24.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image23.png)</span></span>

<span data-ttu-id="22fb2-230">**図 9**: 既定では、結果は `ProductName` 順に並べ替えられます ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image25.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-230">**Figure 9**: By Default, the Results are Sorted by `ProductName` ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image25.png))</span></span>

<span data-ttu-id="22fb2-231">`SortingWithDefaultPaging.aspx?sortExpression=CategoryName` などの `sortExpression` querystring フィールドを手動で追加すると、指定した `sortExpression`によって結果が並べ替えられます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-231">If you manually add a `sortExpression` querystring field such as `SortingWithDefaultPaging.aspx?sortExpression=CategoryName` the results will be sorted by the specified `sortExpression`.</span></span> <span data-ttu-id="22fb2-232">ただし、この `sortExpression` パラメーターは、データの別のページに移動するときに、querystring には含まれません。</span><span class="sxs-lookup"><span data-stu-id="22fb2-232">However, this `sortExpression` parameter is not included in the querystring when moving to a different page of data.</span></span> <span data-ttu-id="22fb2-233">実際には、[次へ] または [最後のページ] ボタンをクリックすると `Paging.aspx`に戻ります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-233">In fact, clicking on the Next or Last page buttons takes us back to `Paging.aspx`!</span></span> <span data-ttu-id="22fb2-234">さらに、現在、並べ替えインターフェイスはありません。</span><span class="sxs-lookup"><span data-stu-id="22fb2-234">Furthermore, there s currently no sorting interface.</span></span> <span data-ttu-id="22fb2-235">ユーザーがページングされたデータの並べ替え順序を変更する唯一の方法は、クエリ文字列を直接操作することです。</span><span class="sxs-lookup"><span data-stu-id="22fb2-235">The only way a user can change the sort order of the paged data is by manipulating the querystring directly.</span></span>

## <a name="creating-the-sorting-interface"></a><span data-ttu-id="22fb2-236">並べ替えインターフェイスの作成</span><span class="sxs-lookup"><span data-stu-id="22fb2-236">Creating the Sorting Interface</span></span>

<span data-ttu-id="22fb2-237">まず、`RedirectUser` メソッドを更新して、ユーザーを `Paging.aspx`ではなく `SortingWithDefaultPaging.aspx` に送信し、`sortExpression` の値を querystring に含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-237">We first need to update the `RedirectUser` method to send the user to `SortingWithDefaultPaging.aspx` (instead of `Paging.aspx`) and to include the `sortExpression` value in the querystring.</span></span> <span data-ttu-id="22fb2-238">また、`SortExpression` プロパティという名前の読み取り専用のページレベルを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-238">We should also add a read-only, page-level named `SortExpression` property.</span></span> <span data-ttu-id="22fb2-239">このプロパティは、前のチュートリアルで作成した `PageIndex` や `PageSize` プロパティと同様に、`sortExpression` querystring フィールドが存在する場合はその値を返し、それ以外の場合は既定値 (ProductName) を返します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-239">This property, similar to the `PageIndex` and `PageSize` properties created in the previous tutorial, returns the value of the `sortExpression` querystring field if it exists, and the default value ( ProductName ) otherwise.</span></span>

<span data-ttu-id="22fb2-240">現在、`RedirectUser` メソッドでは、表示するページのインデックスを1つの入力パラメーターだけを受け取ることができます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-240">Currently the `RedirectUser` method accepts only a single input parameter the index of the page to display.</span></span> <span data-ttu-id="22fb2-241">ただし、クエリ文字列に指定されている以外の並べ替え式を使用して、データの特定のページにユーザーをリダイレクトすることが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-241">However, there may be times when we want to redirect the user to a particular page of data using a sort expression other than what s specified in the querystring.</span></span> <span data-ttu-id="22fb2-242">ここでは、このページの並べ替えインターフェイスを作成します。これには、指定された列によってデータを並べ替えるための一連のボタン Web コントロールが含まれます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-242">In a moment we'll create the sorting interface for this page, which will include a series of Button Web controls for sorting the data by a specified column.</span></span> <span data-ttu-id="22fb2-243">これらのボタンのいずれかをクリックすると、適切な並べ替え式の値を渡してユーザーをリダイレクトすることになります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-243">When one of those Buttons is clicked, we want to redirect the user passing in the appropriate sort expression value.</span></span> <span data-ttu-id="22fb2-244">この機能を提供するには、`RedirectUser` メソッドの2つのバージョンを作成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-244">To provide this functionality, create two versions of the `RedirectUser` method.</span></span> <span data-ttu-id="22fb2-245">1つ目はページインデックスだけを表示し、2つ目はページインデックスと並べ替え式を受け入れます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-245">The first one should accept just the page index to display, while the second one accepts the page index and sort expression.</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample7.vb)]

<span data-ttu-id="22fb2-246">このチュートリアルの最初の例では、DropDownList を使用して並べ替えインターフェイスを作成しました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-246">In the first example in this tutorial, we created a sorting interface using a DropDownList.</span></span> <span data-ttu-id="22fb2-247">この例では、`ProductName`によって並べ替えを行うために、DataList 1 の上に配置された3つのボタン Web コントロールを使用します。1つは `CategoryName`用で、もう1つは `SupplierName`用です。</span><span class="sxs-lookup"><span data-stu-id="22fb2-247">For this example, let s use three Button Web controls positioned above the DataList one for sorting by `ProductName`, one for `CategoryName`, and one for `SupplierName`.</span></span> <span data-ttu-id="22fb2-248">3つのボタン Web コントロールを追加し、`ID` プロパティと `Text` プロパティを適切に設定します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-248">Add the three Button Web controls, setting their `ID` and `Text` properties appropriately:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample8.aspx)]

<span data-ttu-id="22fb2-249">次に、それぞれの `Click` イベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-249">Next, create a `Click` event handler for each.</span></span> <span data-ttu-id="22fb2-250">イベントハンドラーは、`RedirectUser` メソッドを呼び出し、適切な並べ替え式を使用してユーザーを最初のページに返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-250">The event handlers should call the `RedirectUser` method, returning the user to the first page using the appropriate sort expression.</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample9.vb)]

<span data-ttu-id="22fb2-251">最初にページにアクセスしたときに、製品名でデータがアルファベット順に並べ替えられます (図9を参照)。</span><span class="sxs-lookup"><span data-stu-id="22fb2-251">When first visiting the page, the data is sorted by the product name alphabetically (refer back to Figure 9).</span></span> <span data-ttu-id="22fb2-252">[次へ] ボタンをクリックしてデータの2ページ目に進み、[カテゴリで並べ替え] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="22fb2-252">Click the Next button to advance to the second page of data and then click the Sort by Category button.</span></span> <span data-ttu-id="22fb2-253">これにより、データの最初のページにカテゴリ名で並べ替えられます (図10を参照)。</span><span class="sxs-lookup"><span data-stu-id="22fb2-253">This returns us to the first page of data, sorted by category name (see Figure 10).</span></span> <span data-ttu-id="22fb2-254">同様に、[仕入先で並べ替え] ボタンをクリックすると、データの最初のページから、仕入先別にデータが並べ替えられます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-254">Likewise, clicking the Sort by Supplier button sorts the data by supplier starting from the first page of data.</span></span> <span data-ttu-id="22fb2-255">並べ替えの選択は、データがページングされるときに記憶されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-255">The sort choice is remembered as the data is paged through.</span></span> <span data-ttu-id="22fb2-256">図11では、カテゴリ別に並べ替えた後、データの13番目のページに進むとページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-256">Figure 11 shows the page after sorting by category and then advancing to the thirteenth page of data.</span></span>

<span data-ttu-id="22fb2-257">[製品がカテゴリ別に並べ替えられて ![](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image27.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-257">[![The Products are Sorted by Category](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image27.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image26.png)</span></span>

<span data-ttu-id="22fb2-258">**図 10**: 製品がカテゴリ別に並べ替えられている ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image28.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-258">**Figure 10**: The Products are Sorted by Category ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image28.png))</span></span>

<span data-ttu-id="22fb2-259">[データのページング時に並べ替え式が記憶される ![](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image30.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-259">[![The Sort Expression is Remembered When Paging Through the Data](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image30.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image29.png)</span></span>

<span data-ttu-id="22fb2-260">**図 11**: データをページングするときに並べ替え式が記憶される ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image31.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-260">**Figure 11**: The Sort Expression is Remembered When Paging Through the Data ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image31.png))</span></span>

## <a name="step-6-custom-paging-through-records-in-a-repeater"></a><span data-ttu-id="22fb2-261">手順 6: リピータのレコードを使用したカスタムページング</span><span class="sxs-lookup"><span data-stu-id="22fb2-261">Step 6: Custom Paging Through Records in a Repeater</span></span>

<span data-ttu-id="22fb2-262">DataList の例では、非効率的な既定のページング手法を使用して、手順5ページでデータを調べています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-262">The DataList example examined in step 5 pages through its data using the inefficient default paging technique.</span></span> <span data-ttu-id="22fb2-263">大量のデータをページングする場合は、カスタムページングを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-263">When paging through sufficiently large amounts of data, it is imperative that custom paging be used.</span></span> <span data-ttu-id="22fb2-264">[大量のデータを効率的にページング](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md)し、カスタムページング[データを並べ替える](../paging-and-sorting/sorting-custom-paged-data-vb.md)チュートリアルでは、カスタムページングを利用し、カスタムページングデータを並べ替えるために、BLL 内の既定のページングとカスタムページングの違いを調べました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-264">Back in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) and [Sorting Custom Paged Data](../paging-and-sorting/sorting-custom-paged-data-vb.md) tutorials, we examined the differences between default and custom paging and created methods in the BLL for utilizing custom paging and sorting custom paged data.</span></span> <span data-ttu-id="22fb2-265">具体的には、次の2つのチュートリアルでは、`ProductsBLL` クラスに次の3つのメソッドを追加しました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-265">In particular, in these two previous tutorials we added the following three methods to the `ProductsBLL` class:</span></span>

- <span data-ttu-id="22fb2-266">`GetProductsPaged(startRowIndex, maximumRows)` は、 *Startrowindex*から始まり、 *maximumrows*を超えないレコードの特定のサブセットを返します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-266">`GetProductsPaged(startRowIndex, maximumRows)` returns a particular subset of records starting at *startRowIndex* and not exceeding *maximumRows*.</span></span>
- <span data-ttu-id="22fb2-267">`GetProductsPagedAndSorted(sortExpression, startRowIndex, maximumRows)` は、指定された*sortExpression*入力パラメーターによって並べ替えられた特定のレコードのサブセットを返します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-267">`GetProductsPagedAndSorted(sortExpression, startRowIndex, maximumRows)` returns a particular subset of records sorted by the specified *sortExpression* input parameter.</span></span>
- <span data-ttu-id="22fb2-268">`TotalNumberOfProducts()` `Products` データベーステーブル内のレコードの合計数を示します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-268">`TotalNumberOfProducts()` provides the total number of records in the `Products` database table.</span></span>

<span data-ttu-id="22fb2-269">これらのメソッドを使用すると、DataList または Repeater コントロールを使用してデータを効率的にページおよび並べ替えできます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-269">These methods can be used to efficiently page and sort through data using a DataList or Repeater control.</span></span> <span data-ttu-id="22fb2-270">これを説明するために、まず、カスタムページングをサポートする Repeater コントロールを作成します。次に、並べ替え機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-270">To illustrate this, let s start by creating a Repeater control with custom paging support; we'll then add sorting capabilities.</span></span>

<span data-ttu-id="22fb2-271">`PagingSortingDataListRepeater` フォルダーの [`SortingWithCustomPaging.aspx`] ページを開き、Repeater をページに追加します。その `ID` プロパティを [`Products`] に設定します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-271">Open the `SortingWithCustomPaging.aspx` page in the `PagingSortingDataListRepeater` folder and add a Repeater to the page, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="22fb2-272">Repeater s スマートタグから、`ProductsDataSource`という名前の新しい ObjectDataSource を作成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-272">From the Repeater s smart tag, create a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="22fb2-273">`ProductsBLL` クラス s `GetProductsPaged` メソッドからデータを選択するように構成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-273">Configure it to select its data from the `ProductsBLL` class s `GetProductsPaged` method.</span></span>

<span data-ttu-id="22fb2-274">[Productbll クラス s GetProductsPaged 切れメソッドを使用するように ObjectDataSource を構成 ![](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image33.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-274">[![Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image33.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image32.png)</span></span>

<span data-ttu-id="22fb2-275">**図 12**: `ProductsBLL` クラス s `GetProductsPaged` メソッドを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="22fb2-275">**Figure 12**: Configure the ObjectDataSource to Use the `ProductsBLL` Class s `GetProductsPaged` Method ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image34.png))</span></span>

<span data-ttu-id="22fb2-276">[更新]、[挿入]、[削除] の各タブのドロップダウンリストを (なし) に設定し、[次へ] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="22fb2-276">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and then click the Next button.</span></span> <span data-ttu-id="22fb2-277">データソースの構成ウィザードによって、`GetProductsPaged` method s *Startrowindex*および*maximumrows*入力パラメーターのソースの入力が求められるようになりました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-277">The Configure Data Source wizard now prompts for the sources of the `GetProductsPaged` method s *startRowIndex* and *maximumRows* input parameters.</span></span> <span data-ttu-id="22fb2-278">実際には、これらの入力パラメーターは無視されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-278">In actuality, these input parameters are ignored.</span></span> <span data-ttu-id="22fb2-279">代わりに、このチュートリアルの最初のデモで*sortExpression*を指定したのと同じように、ObjectDataSource s `Selecting` イベントハンドラーの `Arguments` プロパティを通じて*Startrowindex*と*maximumrows*の値が渡されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-279">Instead, the *startRowIndex* and *maximumRows* values will be passed in through the `Arguments` property in the ObjectDataSource s `Selecting` event handler, just like how we specified the *sortExpression* in this tutorial s first demo.</span></span> <span data-ttu-id="22fb2-280">このため、ウィザードの [ソース] ドロップダウンリストは [なし] のままにしておきます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-280">Therefore, leave the parameter source drop-down lists in the wizard set at None .</span></span>

<span data-ttu-id="22fb2-281">[[パラメーターのソース] を [なし] のままにし ![](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image36.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-281">[![Leave the Parameter Sources Set to None](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image36.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image35.png)</span></span>

<span data-ttu-id="22fb2-282">**図 13**: パラメーターソースを None に設定したままにする ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image37.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-282">**Figure 13**: Leave the Parameter Sources Set to None ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image37.png))</span></span>

> [!NOTE]
> <span data-ttu-id="22fb2-283">ObjectDataSource s `EnablePaging` プロパティを `true`*に設定しないでください。*</span><span class="sxs-lookup"><span data-stu-id="22fb2-283">Do *not* set the ObjectDataSource s `EnablePaging` property to `true`.</span></span> <span data-ttu-id="22fb2-284">これにより、ObjectDataSource では、独自の*Startrowindex*パラメーターと*maximumrows*パラメーターが、`SelectMethod` の既存のパラメーターリストに自動的に追加されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-284">This will cause the ObjectDataSource to automatically include its own *startRowIndex* and *maximumRows* parameters to the `SelectMethod` s existing parameter list.</span></span> <span data-ttu-id="22fb2-285">`EnablePaging` プロパティは、GridView、DetailsView、または FormView コントロールにカスタムページングデータをバインドする場合に便利です。これは、これらのコントロールは、`EnablePaging` プロパティが `true`場合にのみ使用できる ObjectDataSource からの特定の動作を想定しているためです。</span><span class="sxs-lookup"><span data-stu-id="22fb2-285">The `EnablePaging` property is useful when binding custom paged data to a GridView, DetailsView, or FormView control because these controls expect certain behavior from the ObjectDataSource that s only available when `EnablePaging` property is `true`.</span></span> <span data-ttu-id="22fb2-286">DataList と Repeater のページングサポートを手動で追加する必要があるため、このプロパティは `false` (既定) に設定したままにします。 ASP.NET ページ内で必要な機能を直接焼き付けるします。</span><span class="sxs-lookup"><span data-stu-id="22fb2-286">Since we have to manually add the paging support for the DataList and Repeater, leave this property set to `false` (the default), as we'll bake in the needed functionality directly within our ASP.NET page.</span></span>

<span data-ttu-id="22fb2-287">最後に、製品名、カテゴリ、および供給業者が表示されるように、リピータの `ItemTemplate` を定義します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-287">Finally, define the Repeater s `ItemTemplate` so that the product s name, category, and supplier are shown.</span></span> <span data-ttu-id="22fb2-288">これらの変更が完了すると、Repeater および ObjectDataSource の宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-288">After these changes, the Repeater and ObjectDataSource s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample10.aspx)]

<span data-ttu-id="22fb2-289">ブラウザーでページにアクセスして、レコードが返されないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-289">Take a moment to visit the page through a browser and note that no records are returned.</span></span> <span data-ttu-id="22fb2-290">これは、 *Startrowindex*および*maximumrows*パラメーター値をまだ指定していないためです。したがって、値0は両方に渡されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-290">This is because we ve yet to specify the *startRowIndex* and *maximumRows* parameter values; therefore, values of 0 are being passed in for both.</span></span> <span data-ttu-id="22fb2-291">これらの値を指定するには、ObjectDataSource s `Selecting` イベントのイベントハンドラーを作成し、これらのパラメーター値をプログラムによって、0および5のハードコーディングされた値に設定します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-291">To specify these values, create an event handler for the ObjectDataSource s `Selecting` event and set these parameters values programmatically to hard-coded values of 0 and 5, respectively:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample11.vb)]

<span data-ttu-id="22fb2-292">この変更により、ブラウザーで表示したときに、最初の5つの製品がページに表示されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-292">With this change, the page, when viewed through a browser, shows the first five products.</span></span>

<span data-ttu-id="22fb2-293">[最初の5つのレコードが表示される ![](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image39.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-293">[![The First Five Records are Displayed](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image39.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image38.png)</span></span>

<span data-ttu-id="22fb2-294">**図 14**: 最初の5つのレコードが表示される ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image40.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-294">**Figure 14**: The First Five Records are Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image40.png))</span></span>

> [!NOTE]
> <span data-ttu-id="22fb2-295">図14に記載されている製品は、効率的なカスタムページングクエリを実行する `GetProductsPaged` ストアドプロシージャが `ProductName`によって結果を並べ替えるため、製品名で並べ替えられています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-295">The products listed in Figure 14 happen to be sorted by product name because the `GetProductsPaged` stored procedure that performs the efficient custom paging query orders the results by `ProductName`.</span></span>

<span data-ttu-id="22fb2-296">ユーザーがページをステップ実行できるようにするには、開始行インデックスと最大行数を追跡し、ポストバック全体でこれらの値を記憶しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-296">In order to allow the user to step through the pages, we need to keep track of the start row index and maximum rows and remember these values across postbacks.</span></span> <span data-ttu-id="22fb2-297">既定のページングの例では、querystring フィールドを使用してこれらの値を保持していました。このデモでは、この情報をページ s ビューステートに保持します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-297">In the default paging example we used querystring fields to persist these values; for this demo, let s persist this information in the page s view state.</span></span> <span data-ttu-id="22fb2-298">次の2つのプロパティを作成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-298">Create the following two properties:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample12.vb)]

<span data-ttu-id="22fb2-299">次に、選択したイベントハンドラーのコードを更新します。これにより、0と5のハードコーディングされた値の代わりに、`StartRowIndex` と `MaximumRows` のプロパティが使用されるようになります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-299">Next, update the code in the Selecting event handler so that it uses the `StartRowIndex` and `MaximumRows` properties instead of the hard-coded values of 0 and 5:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample13.vb)]

<span data-ttu-id="22fb2-300">この時点で、ページには最初の5つのレコードのみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-300">At this point our page still shows just the first five records.</span></span> <span data-ttu-id="22fb2-301">ただし、これらのプロパティが設定されていれば、ページングインターフェイスを作成する準備が整います。</span><span class="sxs-lookup"><span data-stu-id="22fb2-301">However, with these properties in place, we re ready to create our paging interface.</span></span>

## <a name="adding-the-paging-interface"></a><span data-ttu-id="22fb2-302">ページングインターフェイスの追加</span><span class="sxs-lookup"><span data-stu-id="22fb2-302">Adding the Paging Interface</span></span>

<span data-ttu-id="22fb2-303">では、既定のページングの例で使用されている最初、前、次の最後のページングインターフェイスと同じものを使用します。これには、表示されているデータページと合計ページ数を表示するラベル Web コントロールが含まれます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-303">Let s use the same First, Previous, Next, Last paging interface used in the default paging example, including the Label Web control that displays what page of data is being viewed and how many total pages exist.</span></span> <span data-ttu-id="22fb2-304">Repeater の下に、4つのボタンの Web コントロールとラベルを追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-304">Add the four Button Web controls and Label below the Repeater.</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample14.aspx)]

<span data-ttu-id="22fb2-305">次に、4つのボタンの `Click` イベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-305">Next, create `Click` event handlers for the four Buttons.</span></span> <span data-ttu-id="22fb2-306">これらのボタンのいずれかをクリックすると、`StartRowIndex` を更新して、データをリピータに再バインドする必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-306">When one of these Buttons is clicked, we need to update the `StartRowIndex` and rebind the data to the Repeater.</span></span> <span data-ttu-id="22fb2-307">[最初]、[前へ]、[次へ] の各ボタンのコードは単純ですが、最後のボタンの場合、最後のページのデータの先頭行のインデックスはどのように決定しますか。</span><span class="sxs-lookup"><span data-stu-id="22fb2-307">The code for the First, Previous, and Next buttons is simple enough, but for the Last button how do we determine the start row index for the last page of data?</span></span> <span data-ttu-id="22fb2-308">このインデックスを計算し、次のボタンと最後のボタンを有効にする必要があるかどうかを判断できるようにするには、合計でページングされているレコードの数を把握しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-308">To compute this index as well as being able to determine whether the Next and Last buttons should be enabled we need to know how many records in total are being paged through.</span></span> <span data-ttu-id="22fb2-309">これは、`ProductsBLL` クラス s `TotalNumberOfProducts()` メソッドを呼び出すことによって判断できます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-309">We can determine this by calling the `ProductsBLL` class s `TotalNumberOfProducts()` method.</span></span> <span data-ttu-id="22fb2-310">`TotalNumberOfProducts()` メソッドの結果を返す `TotalRowCount` という名前の読み取り専用のページレベルのプロパティを作成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-310">Let s create a read-only, page-level property named `TotalRowCount` that returns the results of the `TotalNumberOfProducts()` method:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample15.vb)]

<span data-ttu-id="22fb2-311">このプロパティを使用して、最後のページの開始行インデックスを決定できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-311">With this property we can now determine the last page s start row index.</span></span> <span data-ttu-id="22fb2-312">具体的には、`TotalRowCount`-1 を `MaximumRows`で除算し、`MaximumRows`を乗算した結果の整数が返されます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-312">Specifically, it s the integer result of the `TotalRowCount` minus 1 divided by `MaximumRows`, multiplied by `MaximumRows`.</span></span> <span data-ttu-id="22fb2-313">次に、4つのページングインターフェイスボタンの `Click` イベントハンドラーを記述できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-313">We can now write the `Click` event handlers for the four paging interface buttons:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample16.vb)]

<span data-ttu-id="22fb2-314">最後に、データの最初のページを表示するときにページングインターフェイスの最初のボタンと前のボタンを無効にし、最後のページを表示するときに [次へ] と [最後] のボタンを無効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-314">Finally, we need to disable the First and Previous buttons in the paging interface when viewing the first page of data and the Next and Last buttons when viewing the last page.</span></span> <span data-ttu-id="22fb2-315">これを実現するには、ObjectDataSource s `Selecting` イベントハンドラーに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-315">To accomplish this, add the following code to the ObjectDataSource s `Selecting` event handler:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample17.vb)]

<span data-ttu-id="22fb2-316">これらの `Click` イベントハンドラーを追加し、現在の開始行インデックスに基づいてページングインターフェイス要素を有効または無効にするコードを追加した後、ブラウザーでページをテストします。</span><span class="sxs-lookup"><span data-stu-id="22fb2-316">After adding these `Click` event handlers and the code to enable or disable the paging interface elements based on the current start row index, test the page in a browser.</span></span> <span data-ttu-id="22fb2-317">図15に示すように、最初にページにアクセスしたときに、最初のボタンと前のボタンが無効になります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-317">As Figure 15 illustrates, when first visiting the page the First and Previous buttons will are disabled.</span></span> <span data-ttu-id="22fb2-318">[次へ] をクリックすると、データの2ページ目が表示され、[最後] をクリックすると最終ページが表示されます (図16と17を参照)。</span><span class="sxs-lookup"><span data-stu-id="22fb2-318">Clicking Next shows the second page of data, while clicking Last displays the final page (see Figures 16 and 17).</span></span> <span data-ttu-id="22fb2-319">データの最後のページを表示すると、[次へ] と [最後] の両方のボタンが無効になります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-319">When viewing the last page of data both the Next and Last buttons are disabled.</span></span>

<span data-ttu-id="22fb2-320">[製品の最初のページを表示しているときに、前のボタンと最後のボタンが無効に ![](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image42.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-320">[![The Previous and Last Buttons are Disabled When Viewing the First Page of Products](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image42.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image41.png)</span></span>

<span data-ttu-id="22fb2-321">**図 15**: 製品の最初のページを表示するときに、前のボタンと最後のボタンが無効になる ([クリックしてフルサイズの画像を表示する](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image43.png))</span><span class="sxs-lookup"><span data-stu-id="22fb2-321">**Figure 15**: The Previous and Last Buttons are Disabled When Viewing the First Page of Products ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image43.png))</span></span>

<span data-ttu-id="22fb2-322">[![製品の2番目のページが表示されます。](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image45.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image44.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-322">[![The Second Page of Products are Displayed](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image45.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image44.png)</span></span>

<span data-ttu-id="22fb2-323">**図 16**: 製品の2番目のページが表示される ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image46.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-323">**Figure 16**: The Second Page of Products are Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image46.png))</span></span>

<span data-ttu-id="22fb2-324">[最後の ![クリックすると、最後のデータページが表示されます](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image48.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-324">[![Clicking Last Displays the Final Page of Data](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image48.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image47.png)</span></span>

<span data-ttu-id="22fb2-325">**図 17**: [最後[へ] をクリックする](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image49.png)と、データの最終ページが表示されます (クリックすると、フルサイズの画像が表示されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-325">**Figure 17**: Clicking Last Displays the Final Page of Data ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image49.png))</span></span>

## <a name="step-7-including-sorting-support-with-the-custom-paged-repeater"></a><span data-ttu-id="22fb2-326">手順 7: カスタムのページリピータを使用した並べ替えサポートの追加</span><span class="sxs-lookup"><span data-stu-id="22fb2-326">Step 7: Including Sorting Support with the Custom Paged Repeater</span></span>

<span data-ttu-id="22fb2-327">カスタムページングが実装されたので、並べ替えサポートを追加する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-327">Now that custom paging has been implemented, we re ready to include sorting support.</span></span> <span data-ttu-id="22fb2-328">`ProductsBLL` クラス s `GetProductsPagedAndSorted` メソッドには `GetProductsPaged`と同じ*Startrowindex*および*maximumrows*入力パラメーターがありますが、追加の*sortExpression*入力パラメーターが許可されています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-328">The `ProductsBLL` class s `GetProductsPagedAndSorted` method has the same *startRowIndex* and *maximumRows* input parameters as `GetProductsPaged`, but permits an additional *sortExpression* input parameter.</span></span> <span data-ttu-id="22fb2-329">`SortingWithCustomPaging.aspx`から `GetProductsPagedAndSorted` メソッドを使用するには、次の手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-329">To use the `GetProductsPagedAndSorted` method from `SortingWithCustomPaging.aspx`, we need to perform the following steps:</span></span>

1. <span data-ttu-id="22fb2-330">ObjectDataSource s `SelectMethod` プロパティを `GetProductsPaged` から `GetProductsPagedAndSorted`に変更します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-330">Change the ObjectDataSource s `SelectMethod` property from `GetProductsPaged` to `GetProductsPagedAndSorted`.</span></span>
2. <span data-ttu-id="22fb2-331">*SortExpression* `Parameter` オブジェクトを ObjectDataSource s `SelectParameters` コレクションに追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-331">Add a *sortExpression* `Parameter` object to the ObjectDataSource s `SelectParameters` collection.</span></span>
3. <span data-ttu-id="22fb2-332">ページ s ビューステートを通じてポストバック間で値を永続化する、ページレベルのプライベート `SortExpression` プロパティを作成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-332">Create a private, page-level `SortExpression` property that persists its value across postbacks through the page s view state.</span></span>
4. <span data-ttu-id="22fb2-333">ObjectDataSource s `Selecting` イベントハンドラーを更新して、ObjectDataSource s *sortExpression*パラメーターにページレベル `SortExpression` プロパティの値を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-333">Update the ObjectDataSource s `Selecting` event handler to assign the ObjectDataSource s *sortExpression* parameter the value of the page-level `SortExpression` property.</span></span>
5. <span data-ttu-id="22fb2-334">並べ替えインターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-334">Create the sorting interface.</span></span>

<span data-ttu-id="22fb2-335">最初に、ObjectDataSource s `SelectMethod` プロパティを更新し、 *sortExpression* `Parameter`を追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-335">Start by updating the ObjectDataSource s `SelectMethod` property and adding a *sortExpression* `Parameter`.</span></span> <span data-ttu-id="22fb2-336">*SortExpression* `Parameter` s `Type` プロパティが `String`に設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-336">Make sure that the *sortExpression* `Parameter` s `Type` property is set to `String`.</span></span> <span data-ttu-id="22fb2-337">これらの最初の2つのタスクを完了すると、ObjectDataSource s 宣言マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-337">After completing these first two tasks, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample18.aspx)]

<span data-ttu-id="22fb2-338">次に、値がビューステートにシリアル化されるページレベルの `SortExpression` プロパティが必要です。</span><span class="sxs-lookup"><span data-stu-id="22fb2-338">Next, we need a page-level `SortExpression` property whose value is serialized to view state.</span></span> <span data-ttu-id="22fb2-339">並べ替え式の値が設定されていない場合は、ProductName を既定値として使用します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-339">If no sort expression value has been set, use ProductName as the default:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample19.vb)]

<span data-ttu-id="22fb2-340">ObjectDataSource によって `GetProductsPagedAndSorted` メソッドが呼び出される前に、 *sortExpression* `Parameter` を `SortExpression` プロパティの値に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-340">Before the ObjectDataSource invokes the `GetProductsPagedAndSorted` method we need to set the *sortExpression* `Parameter` to the value of the `SortExpression` property.</span></span> <span data-ttu-id="22fb2-341">`Selecting` イベントハンドラーで、次のコード行を追加します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-341">In the `Selecting` event handler, add the following line of code:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample20.vb)]

<span data-ttu-id="22fb2-342">残りのことは、並べ替えインターフェイスを実装することだけです。</span><span class="sxs-lookup"><span data-stu-id="22fb2-342">All that remains is to implement the sorting interface.</span></span> <span data-ttu-id="22fb2-343">最後の例で行ったように、では、ユーザーが製品名、カテゴリ、または業者別に結果を並べ替えられるようにする3つのボタン Web コントロールを使用して、並べ替えインターフェイスを実装しています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-343">As we did in the last example, let s have the sorting interface implemented using three Button Web controls that allow the user to sort the results by product name, category, or supplier.</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample21.aspx)]

<span data-ttu-id="22fb2-344">これら3つのボタンコントロールの `Click` イベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-344">Create `Click` event handlers for these three Button controls.</span></span> <span data-ttu-id="22fb2-345">イベントハンドラーで、`StartRowIndex` を0にリセットし、`SortExpression` を適切な値に設定して、データをリピータに再バインドします。</span><span class="sxs-lookup"><span data-stu-id="22fb2-345">In the event handler, reset the `StartRowIndex` to 0, set the `SortExpression` to the appropriate value, and rebind the data to the Repeater:</span></span>

[!code-vb[Main](sorting-data-in-a-datalist-or-repeater-control-vb/samples/sample22.vb)]

<span data-ttu-id="22fb2-346">これで完了です。</span><span class="sxs-lookup"><span data-stu-id="22fb2-346">That s all there is to it!</span></span> <span data-ttu-id="22fb2-347">カスタムページングと並べ替えを実装するための手順はいくつかありましたが、これらの手順は、既定のページングに必要な手順とよく似ていました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-347">While there were a number of steps to get custom paging and sorting implemented, the steps were very similar to those needed for default paging.</span></span> <span data-ttu-id="22fb2-348">図18に、カテゴリ別に並べ替えられたデータの最後のページを表示する場合の製品を示します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-348">Figure 18 shows the products when viewing the last page of data when sorted by category.</span></span>

<span data-ttu-id="22fb2-349">[データの最後のページ ![カテゴリ別に並べ替えられて表示されます。](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image51.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="22fb2-349">[![The Last Page of Data, Sorted by Category, is Displayed](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image51.png)](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image50.png)</span></span>

<span data-ttu-id="22fb2-350">**図 18**: データの最後のページがカテゴリ別に並べ替えられて表示される ([クリックすると、フルサイズの画像が表示](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image52.png)されます)</span><span class="sxs-lookup"><span data-stu-id="22fb2-350">**Figure 18**: The Last Page of Data, Sorted by Category, is Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-vb/_static/image52.png))</span></span>

> [!NOTE]
> <span data-ttu-id="22fb2-351">前の例では、supplier SupplierName による並べ替えが並べ替え式として使用されていました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-351">In previous examples, when sorting by the supplier SupplierName was used as the sort expression.</span></span> <span data-ttu-id="22fb2-352">ただし、カスタムページング実装の場合は、CompanyName を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-352">However, for the custom paging implementation, we need to use CompanyName.</span></span> <span data-ttu-id="22fb2-353">これは、カスタムページング `GetProductsPagedAndSorted` を実装するストアドプロシージャが `ROW_NUMBER()` キーワードに並べ替え式を渡す場合、`ROW_NUMBER()` キーワードには別名ではなく実際の列名が必要であるためです。</span><span class="sxs-lookup"><span data-stu-id="22fb2-353">This is because the stored procedure responsible for implementing custom paging `GetProductsPagedAndSorted` passes the sort expression into the `ROW_NUMBER()` keyword, The `ROW_NUMBER()` keyword requires the actual column name rather than an alias.</span></span> <span data-ttu-id="22fb2-354">そのため、並べ替え式の `SELECT` クエリ (`SupplierName`) で使用される別名ではなく、`CompanyName` (`Suppliers` テーブルの列名) を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-354">Therefore, we must use `CompanyName` (the name of the column in the `Suppliers` table) rather than the alias used in the `SELECT` query (`SupplierName`) for the sort expression.</span></span>

## <a name="summary"></a><span data-ttu-id="22fb2-355">まとめ</span><span class="sxs-lookup"><span data-stu-id="22fb2-355">Summary</span></span>

<span data-ttu-id="22fb2-356">DataList も Repeater も、組み込みの並べ替えサポートを提供していませんが、コードとカスタムの並べ替えインターフェイスを使用して、そのような機能を追加することができます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-356">Neither the DataList nor Repeater offer built-in sorting support, but with a bit of code and a custom sorting interface, such functionality can be added.</span></span> <span data-ttu-id="22fb2-357">並べ替えを実装するときにページングではなく、ObjectDataSource s `Select` メソッドに渡される `DataSourceSelectArguments` オブジェクトを使用して並べ替え式を指定できます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-357">When implementing sorting, but not paging, the sort expression can be specified through the `DataSourceSelectArguments` object passed into the ObjectDataSource s `Select` method.</span></span> <span data-ttu-id="22fb2-358">この `DataSourceSelectArguments` オブジェクト s `SortExpression` プロパティは、ObjectDataSource s `Selecting` イベントハンドラーで割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-358">This `DataSourceSelectArguments` object s `SortExpression` property can be assigned in the ObjectDataSource s `Selecting` event handler.</span></span>

<span data-ttu-id="22fb2-359">既にページングがサポートされている DataList または Repeater に並べ替え機能を追加するには、並べ替え式を受け取るメソッドを含むようにビジネスロジックレイヤーをカスタマイズするのが最も簡単な方法です。</span><span class="sxs-lookup"><span data-stu-id="22fb2-359">To add sorting capabilities to a DataList or Repeater that already provides paging support, the easiest approach is to customize the Business Logic Layer to include a method that accepts a sort expression.</span></span> <span data-ttu-id="22fb2-360">この情報は、ObjectDataSource s `SelectParameters`のパラメーターを通じて渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="22fb2-360">This information can then be passed in through a parameter in the ObjectDataSource s `SelectParameters`.</span></span>

<span data-ttu-id="22fb2-361">このチュートリアルでは、DataList コントロールと Repeater コントロールを使用したページングと並べ替えの検査を完了します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-361">This tutorial completes our examination of paging and sorting with the DataList and Repeater controls.</span></span> <span data-ttu-id="22fb2-362">次の最後のチュートリアルでは、カスタムのユーザーが開始した機能を項目ごとに提供するために、DataList および Repeater のテンプレートにボタン Web コントロールを追加する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-362">Our next and final tutorial will examine how to add Button Web controls to the DataList and Repeater s templates in order to provide some custom, user-initiated functionality on a per-item basis.</span></span>

<span data-ttu-id="22fb2-363">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="22fb2-363">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="22fb2-364">著者について</span><span class="sxs-lookup"><span data-stu-id="22fb2-364">About the Author</span></span>

<span data-ttu-id="22fb2-365">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-365">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="22fb2-366">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="22fb2-366">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="22fb2-367">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="22fb2-367">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="22fb2-368">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="22fb2-368">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="22fb2-369">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="22fb2-369">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="22fb2-370">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-370">Special Thanks To</span></span>

<span data-ttu-id="22fb2-371">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="22fb2-371">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="22fb2-372">このチュートリアルのリードレビュー担当者は David, u です。</span><span class="sxs-lookup"><span data-stu-id="22fb2-372">Lead reviewer for this tutorial was David Suru.</span></span> <span data-ttu-id="22fb2-373">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="22fb2-373">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="22fb2-374">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="22fb2-374">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="22fb2-375">[[戻る]](paging-report-data-in-a-datalist-or-repeater-control-vb.md)</span><span class="sxs-lookup"><span data-stu-id="22fb2-375">[Previous](paging-report-data-in-a-datalist-or-repeater-control-vb.md)</span></span>
