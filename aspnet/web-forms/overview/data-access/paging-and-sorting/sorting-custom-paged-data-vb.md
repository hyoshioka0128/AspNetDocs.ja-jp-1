---
uid: web-forms/overview/data-access/paging-and-sorting/sorting-custom-paged-data-vb
title: カスタムページングデータの並べ替え (VB) |Microsoft Docs
author: rick-anderson
description: 前のチュートリアルでは、web ページにデータを表示するときにカスタムページングを実装する方法について学習しました。 このチュートリアルでは、前の手順を拡張する方法について説明します。
ms.author: riande
ms.date: 08/15/2006
ms.assetid: 4823a186-caaf-4116-a318-c7ff4d955ddc
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/sorting-custom-paged-data-vb
msc.type: authoredcontent
ms.openlocfilehash: 934c7558d907611732ae6f04c553bc9e295c569b
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78501712"
---
# <a name="sorting-custom-paged-data-vb"></a><span data-ttu-id="1206d-104">カスタム ページングを適用したデータを並べ替える (VB)</span><span class="sxs-lookup"><span data-stu-id="1206d-104">Sorting Custom Paged Data (VB)</span></span>

<span data-ttu-id="1206d-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="1206d-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="1206d-106">[サンプルアプリのダウンロード](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_26_VB.exe)または[PDF のダウンロード](sorting-custom-paged-data-vb/_static/datatutorial26vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="1206d-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_26_VB.exe) or [Download PDF](sorting-custom-paged-data-vb/_static/datatutorial26vb1.pdf)</span></span>

> <span data-ttu-id="1206d-107">前のチュートリアルでは、web ページにデータを表示するときにカスタムページングを実装する方法について学習しました。</span><span class="sxs-lookup"><span data-stu-id="1206d-107">In the previous tutorial we learned how to implement custom paging when presenting data on a web page.</span></span> <span data-ttu-id="1206d-108">このチュートリアルでは、前の例を拡張してカスタムページングの並べ替えをサポートする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="1206d-108">In this tutorial we see how to extend the preceding example to include support for sorting custom paging.</span></span>

## <a name="introduction"></a><span data-ttu-id="1206d-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="1206d-109">Introduction</span></span>

<span data-ttu-id="1206d-110">既定のページングと比較すると、カスタムページングを使用すると、データによるページングのパフォーマンスをいくつかの程度向上させることができます。これにより、大量のデータをページングするときに、事実上ページングの実装をカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="1206d-110">Compared to default paging, custom paging can improve the performance of paging through data by several orders of magnitude, making custom paging the de facto paging implementation choice when paging through large amounts of data.</span></span> <span data-ttu-id="1206d-111">ただし、カスタムページングの実装は、特に並べ替えをミックスに追加する場合に、既定のページングを実装するよりも複雑です。</span><span class="sxs-lookup"><span data-stu-id="1206d-111">Implementing custom paging is more involved than implementing default paging, however, especially when adding sorting to the mix.</span></span> <span data-ttu-id="1206d-112">このチュートリアルでは、前の例の例を拡張して、並べ替え*と*カスタムページングのサポートを追加します。</span><span class="sxs-lookup"><span data-stu-id="1206d-112">In this tutorial we'll extend the example from the preceding one to include support for sorting *and* custom paging.</span></span>

> [!NOTE]
> <span data-ttu-id="1206d-113">このチュートリアルは前のチュートリアルに基づいているため、先に進む前に、前のチュートリアルの web ページ (`EfficientPaging.aspx`) の `<asp:Content>` 要素内の宣言構文をコピーし、`SortParameter.aspx` ページの `<asp:Content>` 要素の間に貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="1206d-113">Since this tutorial builds upon the preceding one, before beginning take a moment to copy the declarative syntax within the `<asp:Content>` element from the preceding tutorial s web page (`EfficientPaging.aspx`) and paste it between the `<asp:Content>` element in the `SortParameter.aspx` page.</span></span> <span data-ttu-id="1206d-114">ASP.NET ページの機能を別のページにレプリケートする方法の詳細については、「[編集および挿入インターフェイスに検証コントロールを追加する](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)」の手順1を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1206d-114">Refer back to Step 1 of the [Adding Validation Controls to the Editing and Inserting Interfaces](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md) tutorial for a more detailed discussion on replicating the functionality of one ASP.NET page to another.</span></span>

## <a name="step-1-reexamining-the-custom-paging-technique"></a><span data-ttu-id="1206d-115">手順 1: カスタムページング手法を再検査する</span><span class="sxs-lookup"><span data-stu-id="1206d-115">Step 1: Reexamining the Custom Paging Technique</span></span>

<span data-ttu-id="1206d-116">カスタムページングを正常に動作させるには、開始行インデックスおよび最大行数パラメーターを指定して、特定のレコードのサブセットを効率的に取得できるいくつかの手法を実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-116">For custom paging to work properly, we must implement some technique that can efficiently grab a particular subset of records given the Start Row Index and Maximum Rows parameters.</span></span> <span data-ttu-id="1206d-117">この目標を達成するために使用できる手法がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="1206d-117">There are a handful of techniques that can be used to achieve this aim.</span></span> <span data-ttu-id="1206d-118">前のチュートリアルでは、Microsoft SQL Server 2005 s new `ROW_NUMBER()` 順位付け関数を使用してこれを実現しました。</span><span class="sxs-lookup"><span data-stu-id="1206d-118">In the preceding tutorial we looked at accomplishing this using Microsoft SQL Server 2005 s new `ROW_NUMBER()` ranking function.</span></span> <span data-ttu-id="1206d-119">つまり、`ROW_NUMBER()` 順位付け関数は、指定された並べ替え順序によって順位付けされたクエリによって返される各行に行番号を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="1206d-119">In short, the `ROW_NUMBER()` ranking function assigns a row number to each row returned by a query that is ranked by a specified sort order.</span></span> <span data-ttu-id="1206d-120">レコードの適切なサブセットを取得するには、番号付きの結果の特定のセクションを返します。</span><span class="sxs-lookup"><span data-stu-id="1206d-120">The appropriate subset of records is then obtained by returning a particular section of the numbered results.</span></span> <span data-ttu-id="1206d-121">次のクエリは、この手法を使用して、結果をアルファベット順に順位付けするときに、`ProductName`によって数値が 11 ~ 20 の製品を返す方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="1206d-121">The following query illustrates how to use this technique to return those products numbered 11 through 20 when ranking the results ordered alphabetically by the `ProductName`:</span></span>

[!code-sql[Main](sorting-custom-paged-data-vb/samples/sample1.sql)]

<span data-ttu-id="1206d-122">この手法は、特定の並べ替え順序 (この場合はアルファベット順に並べ替え`ProductName`) を使用したページングに適していますが、別の並べ替え式で並べ替えられた結果を表示するようにクエリを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-122">This technique works well for paging using a specific sort order (`ProductName` sorted alphabetically, in this case), but the query needs to be modified to show the results sorted by a different sort expression.</span></span> <span data-ttu-id="1206d-123">このクエリは、次のように `OVER` 句のパラメーターを使用するように書き換えることが理想的です。</span><span class="sxs-lookup"><span data-stu-id="1206d-123">Ideally, the above query could be rewritten to use a parameter in the `OVER` clause, like so:</span></span>

[!code-sql[Main](sorting-custom-paged-data-vb/samples/sample2.sql)]

<span data-ttu-id="1206d-124">残念ながら、パラメーター化された `ORDER BY` 句は使用できません。</span><span class="sxs-lookup"><span data-stu-id="1206d-124">Unfortunately, parameterized `ORDER BY` clauses are not allowed.</span></span> <span data-ttu-id="1206d-125">代わりに、`@sortExpression` 入力パラメーターを受け取るストアドプロシージャを作成する必要がありますが、次のいずれかの回避策を使用します。</span><span class="sxs-lookup"><span data-stu-id="1206d-125">Instead, we must create a stored procedure that accepts a `@sortExpression` input parameter, but uses one of the following workarounds:</span></span>

- <span data-ttu-id="1206d-126">使用される可能性のある並べ替え式ごとに、ハードコーディングされたクエリを記述します。次に、`IF/ELSE` T-sql ステートメントを使用して、実行するクエリを決定します。</span><span class="sxs-lookup"><span data-stu-id="1206d-126">Write hard-coded queries for each of the sort expressions that may be used; then, use `IF/ELSE` T-SQL statements to determine which query to execute.</span></span>
- <span data-ttu-id="1206d-127">`@sortExpressio` n 入力パラメーターに基づいて動的な `ORDER BY` 式を指定するには、`CASE` ステートメントを使用します。詳細については、「 [SQL `CASE` ステートメントの機能](http://www.4guysfromrolla.com/webtech/102704-1.shtml)」の「クエリ結果を動的に並べ替えるために使用する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1206d-127">Use a `CASE` statement to provide dynamic `ORDER BY` expressions based on the `@sortExpressio` n input parameter; see the Used to Dynamically Sort Query Results section in [The Power of SQL `CASE` Statements](http://www.4guysfromrolla.com/webtech/102704-1.shtml) for more information.</span></span>
- <span data-ttu-id="1206d-128">ストアドプロシージャ内の文字列として適切なクエリを構築し、 [`sp_executesql` システムストアドプロシージャ](https://msdn.microsoft.com/library/ms188001.aspx)を使用して動的クエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="1206d-128">Craft the appropriate query as a string in the stored procedure and then use [the `sp_executesql` system stored procedure](https://msdn.microsoft.com/library/ms188001.aspx) to execute the dynamic query.</span></span>

<span data-ttu-id="1206d-129">これらの回避策にはいくつかの欠点があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-129">Each of these workarounds has some drawbacks.</span></span> <span data-ttu-id="1206d-130">1つ目のオプションは、考えられる各並べ替え式に対してクエリを作成する必要があるため、他の2つの方法ほど保守が容易ではありません。</span><span class="sxs-lookup"><span data-stu-id="1206d-130">The first option is not as maintainable as the other two as it requires that you create a query for each possible sort expression.</span></span> <span data-ttu-id="1206d-131">したがって、後で並べ替え可能な新しいフィールドを GridView に追加する場合は、戻ってストアドプロシージャを更新する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="1206d-131">Therefore, if later you decide to add new, sortable fields to the GridView you will also need to go back and update the stored procedure.</span></span> <span data-ttu-id="1206d-132">2番目の方法には、文字列以外のデータベース列によって並べ替えを行うときにパフォーマンスに関する問題が発生し、1番目の方法と同じ保守容易性の問題が発生するという微妙な点があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-132">The second approach has some subtleties that introduce performance concerns when sorting by non-string database columns and also suffers from the same maintainability issues as the first.</span></span> <span data-ttu-id="1206d-133">また、動的 SQL を使用する3つ目の選択肢では、攻撃者が、選択した入力パラメーター値を渡してストアドプロシージャを実行できる場合、SQL インジェクション攻撃のリスクが生じます。</span><span class="sxs-lookup"><span data-stu-id="1206d-133">And the third choice, which uses dynamic SQL, introduces the risk for a SQL injection attack if an attacker is able to execute the stored procedure passing in the input parameter values of their choosing.</span></span>

<span data-ttu-id="1206d-134">これらの方法は完全ではありませんが、3番目の方法が最も優れていると考えられます。</span><span class="sxs-lookup"><span data-stu-id="1206d-134">While none of these approaches is perfect, I think the third option is the best of the three.</span></span> <span data-ttu-id="1206d-135">動的 SQL を使用することで、他の2つのレベルを柔軟に提供できます。</span><span class="sxs-lookup"><span data-stu-id="1206d-135">With its use of dynamic SQL, it offers a level of flexibility the other two do not.</span></span> <span data-ttu-id="1206d-136">さらに、SQL インジェクション攻撃は、攻撃者が任意の入力パラメーターを渡してストアドプロシージャを実行できる場合にのみ、悪用される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-136">Furthermore, a SQL injection attack can only be exploited if an attacker is able to execute the stored procedure passing in the input parameters of his choice.</span></span> <span data-ttu-id="1206d-137">DAL はパラメーター化クエリを使用するため、ADO.NET は、アーキテクチャを通じてデータベースに送信されるパラメーターを保護します。つまり、攻撃者がストアドプロシージャを直接実行できる場合にのみ、SQL インジェクション攻撃の脆弱性が存在します。</span><span class="sxs-lookup"><span data-stu-id="1206d-137">Since the DAL uses parameterized queries, ADO.NET will protect those parameters that are sent to the database through the architecture, meaning that the SQL injection attack vulnerability only exists if the attacker can directly execute the stored procedure.</span></span>

<span data-ttu-id="1206d-138">この機能を実装するには、`GetProductsPagedAndSorted`という名前の Northwind データベースに新しいストアドプロシージャを作成します。</span><span class="sxs-lookup"><span data-stu-id="1206d-138">To implement this functionality, create a new stored procedure in the Northwind database named `GetProductsPagedAndSorted`.</span></span> <span data-ttu-id="1206d-139">このストアドプロシージャは、結果の並べ替え方法を指定する3つの入力パラメーター (`nvarchar(100`型の入力パラメーター) を受け取る必要があり `@sortExpression`ます。これは `OVER` 句の `ORDER BY` テキストの直後に挿入されます。および `@startRowIndex` と `@maximumRows`には、前のチュートリアルで検証した `GetProductsPaged` ストアドプロシージャと同じ2つの整数入力パラメーターがあります。</span><span class="sxs-lookup"><span data-stu-id="1206d-139">This stored procedure should accept three input parameters: `@sortExpression`, an input parameter of type `nvarchar(100`) that specifies how the results should be sorted and is injected directly after the `ORDER BY` text in the `OVER` clause; and `@startRowIndex` and `@maximumRows`, the same two integer input parameters from the `GetProductsPaged` stored procedure examined in the preceding tutorial.</span></span> <span data-ttu-id="1206d-140">次のスクリプトを使用して、`GetProductsPagedAndSorted` ストアドプロシージャを作成します。</span><span class="sxs-lookup"><span data-stu-id="1206d-140">Create the `GetProductsPagedAndSorted` stored procedure using the following script:</span></span>

[!code-sql[Main](sorting-custom-paged-data-vb/samples/sample3.sql)]

<span data-ttu-id="1206d-141">ストアドプロシージャは、最初に `@sortExpression` パラメーターの値が指定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="1206d-141">The stored procedure starts by ensuring that a value for the `@sortExpression` parameter has been specified.</span></span> <span data-ttu-id="1206d-142">指定されていない場合、結果は `ProductID`順に順位付けされます。</span><span class="sxs-lookup"><span data-stu-id="1206d-142">If it is missing, the results are ranked by `ProductID`.</span></span> <span data-ttu-id="1206d-143">次に、動的 SQL クエリが作成されます。</span><span class="sxs-lookup"><span data-stu-id="1206d-143">Next, the dynamic SQL query is constructed.</span></span> <span data-ttu-id="1206d-144">ここでの動的 SQL クエリは、Products テーブルからすべての行を取得するために使用される前のクエリとは若干異なります。</span><span class="sxs-lookup"><span data-stu-id="1206d-144">Note that the dynamic SQL query here differs slightly from our previous queries used to retrieve all rows from the Products table.</span></span> <span data-ttu-id="1206d-145">前の例では、サブクエリを使用して、各製品に関連付けられているカテゴリと仕入先の名前を取得しました。</span><span class="sxs-lookup"><span data-stu-id="1206d-145">In prior examples, we obtained each product s associated category s and supplier s names using a subquery.</span></span> <span data-ttu-id="1206d-146">この決定は、[データアクセス層の作成](../introduction/creating-a-data-access-layer-vb.md)に関するチュートリアルで行ったもので、`JOIN` を使用する代わりに実行しました。このようなクエリに関連する insert、update、および delete メソッドを TableAdapter で自動的に作成することはできません。</span><span class="sxs-lookup"><span data-stu-id="1206d-146">This decision was made back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial and was done in lieu of using `JOIN` s because the TableAdapter cannot automatically create the associated insert, update, and delete methods for such queries.</span></span> <span data-ttu-id="1206d-147">ただし、`GetProductsPagedAndSorted` ストアドプロシージャでは、結果がカテゴリ名または仕入先名によって並べ替えられるために `JOIN` を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-147">The `GetProductsPagedAndSorted` stored procedure, however, must use `JOIN` s for the results to be ordered by the category or supplier names.</span></span>

<span data-ttu-id="1206d-148">この動的クエリは、静的なクエリ部分と `@sortExpression`、`@startRowIndex`、および `@maximumRows` パラメーターを連結することによって構築されます。</span><span class="sxs-lookup"><span data-stu-id="1206d-148">This dynamic query is built up by concatenating the static query portions and the `@sortExpression`, `@startRowIndex`, and `@maximumRows` parameters.</span></span> <span data-ttu-id="1206d-149">`@startRowIndex` と `@maximumRows` は整数のパラメーターであるため、正しく連結されるためには、これらのパラメーターを nvarchars に変換する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-149">Since `@startRowIndex` and `@maximumRows` are integer parameters, they must be converted into nvarchars in order to be correctly concatenated.</span></span> <span data-ttu-id="1206d-150">この動的 SQL クエリが構築されると、`sp_executesql`経由で実行されます。</span><span class="sxs-lookup"><span data-stu-id="1206d-150">Once this dynamic SQL query has been constructed, it is executed via `sp_executesql`.</span></span>

<span data-ttu-id="1206d-151">`@sortExpression`、`@startRowIndex`、および `@maximumRows` パラメーターに対して異なる値を使用して、このストアドプロシージャをテストします。</span><span class="sxs-lookup"><span data-stu-id="1206d-151">Take a moment to test this stored procedure with different values for the `@sortExpression`, `@startRowIndex`, and `@maximumRows` parameters.</span></span> <span data-ttu-id="1206d-152">サーバーエクスプローラーで、ストアドプロシージャ名を右クリックし、[実行] を選択します。</span><span class="sxs-lookup"><span data-stu-id="1206d-152">From the Server Explorer, right-click on the stored procedure name and choose Execute.</span></span> <span data-ttu-id="1206d-153">これにより、[ストアドプロシージャの実行] ダイアログボックスが表示されます。このダイアログボックスで、入力パラメーターを入力できます (図1を参照)。</span><span class="sxs-lookup"><span data-stu-id="1206d-153">This will bring up the Run Stored Procedure dialog box into which you can enter the input parameters (see Figure 1).</span></span> <span data-ttu-id="1206d-154">カテゴリ名で結果を並べ替えるには、`@sortExpression` パラメーター値として [区分名] を使用します。仕入先の会社名で並べ替えるには、CompanyName を使用します。</span><span class="sxs-lookup"><span data-stu-id="1206d-154">To sort the results by the category name, use CategoryName for the `@sortExpression` parameter value; to sort by the supplier s company name, use CompanyName.</span></span> <span data-ttu-id="1206d-155">パラメーターの値を指定したら、[OK] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="1206d-155">After providing the parameters values, click OK.</span></span> <span data-ttu-id="1206d-156">結果が [出力] ウィンドウに表示されます。</span><span class="sxs-lookup"><span data-stu-id="1206d-156">The results are displayed in the Output window.</span></span> <span data-ttu-id="1206d-157">図2は、`UnitPrice` によって降順に並べ替えられる場合に、11 ~ 20 の製品を返すと結果を示しています。</span><span class="sxs-lookup"><span data-stu-id="1206d-157">Figure 2 shows the results when returning products ranked 11 through 20 when ordering by the `UnitPrice` in descending order.</span></span>

![ストアドプロシージャ s に異なる値を指定してください。3つの入力パラメーター](sorting-custom-paged-data-vb/_static/image1.png)

<span data-ttu-id="1206d-159">**図 1**: ストアドプロシージャ s の異なる値を使用する3つの入力パラメーター</span><span class="sxs-lookup"><span data-stu-id="1206d-159">**Figure 1**: Try Different Values for the Stored Procedure s Three Input Parameters</span></span>

<span data-ttu-id="1206d-160">[ストアドプロシージャの結果が ![出力ウィンドウに表示されます。](sorting-custom-paged-data-vb/_static/image3.png)](sorting-custom-paged-data-vb/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="1206d-160">[![The Stored Procedure s Results are Shown in the Output Window](sorting-custom-paged-data-vb/_static/image3.png)](sorting-custom-paged-data-vb/_static/image2.png)</span></span>

<span data-ttu-id="1206d-161">**図 2**: ストアドプロシージャの結果が出力ウィンドウに表示される ([クリックすると、フルサイズの画像が表示](sorting-custom-paged-data-vb/_static/image4.png)されます)</span><span class="sxs-lookup"><span data-stu-id="1206d-161">**Figure 2**: The Stored Procedure s Results are Shown in the Output Window ([Click to view full-size image](sorting-custom-paged-data-vb/_static/image4.png))</span></span>

> [!NOTE]
> <span data-ttu-id="1206d-162">`OVER` 句の指定した `ORDER BY` 列によって結果を順位付けする場合、SQL Server は結果を並べ替える必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-162">When ranking the results by the specified `ORDER BY` column in the `OVER` clause, SQL Server must sort the results.</span></span> <span data-ttu-id="1206d-163">これは、結果が並べ替えられている列にクラスター化インデックスが存在する場合、またはカバリングインデックスがある場合はクイック操作ですが、それ以外の場合はコストが高くなります。</span><span class="sxs-lookup"><span data-stu-id="1206d-163">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="1206d-164">十分に大きなクエリのパフォーマンスを向上させるには、結果の並べ替えに使用する列に非クラスター化インデックスを追加することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="1206d-164">To improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="1206d-165">詳細については[、SQL Server 2005 の順位付け関数とパフォーマンス](http://www.sql-server-performance.com/ak_ranking_functions.asp)に関する説明を参照してください。</span><span class="sxs-lookup"><span data-stu-id="1206d-165">Refer to [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for more details.</span></span>

## <a name="step-2-augmenting-the-data-access-and-business-logic-layers"></a><span data-ttu-id="1206d-166">手順 2: データアクセスとビジネスロジック層を補強する</span><span class="sxs-lookup"><span data-stu-id="1206d-166">Step 2: Augmenting the Data Access and Business Logic Layers</span></span>

<span data-ttu-id="1206d-167">`GetProductsPagedAndSorted` ストアドプロシージャを作成したので、次の手順では、アプリケーションアーキテクチャを使用してストアドプロシージャを実行する手段を提供します。</span><span class="sxs-lookup"><span data-stu-id="1206d-167">With the `GetProductsPagedAndSorted` stored procedure created, our next step is to provide a means to execute that stored procedure through our application architecture.</span></span> <span data-ttu-id="1206d-168">これには、DAL と BLL の両方に適切なメソッドを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-168">This entails adding an appropriate method to both the DAL and BLL.</span></span> <span data-ttu-id="1206d-169">まず、DAL にメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="1206d-169">Let s start by adding a method to the DAL.</span></span> <span data-ttu-id="1206d-170">`Northwind.xsd` 型指定されたデータセットを開き、`ProductsTableAdapter`を右クリックして、コンテキストメニューから [クエリの追加] オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="1206d-170">Open the `Northwind.xsd` Typed DataSet, right-click on the `ProductsTableAdapter`, and choose the Add Query option from the context menu.</span></span> <span data-ttu-id="1206d-171">前のチュートリアルで行ったように、この新しい DAL メソッドを構成して既存のストアドプロシージャ (この場合は `GetProductsPagedAndSorted`) を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-171">As we did in the preceding tutorial, we want to configure this new DAL method to use an existing stored procedure - `GetProductsPagedAndSorted`, in this case.</span></span> <span data-ttu-id="1206d-172">まず、新しい TableAdapter メソッドで既存のストアドプロシージャを使用することを指定します。</span><span class="sxs-lookup"><span data-stu-id="1206d-172">Start by indicating that you want the new TableAdapter method to use an existing stored procedure.</span></span>

![既存のストアドプロシージャの使用を選択する](sorting-custom-paged-data-vb/_static/image5.png)

<span data-ttu-id="1206d-174">**図 3**: 既存のストアドプロシージャの使用を選択する</span><span class="sxs-lookup"><span data-stu-id="1206d-174">**Figure 3**: Choose to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="1206d-175">使用するストアドプロシージャを指定するには、次の画面のドロップダウンリストから `GetProductsPagedAndSorted` ストアドプロシージャを選択します。</span><span class="sxs-lookup"><span data-stu-id="1206d-175">To specify the stored procedure to use, select the `GetProductsPagedAndSorted` stored procedure from the drop-down list in the next screen.</span></span>

![GetProductsPagedAndSorted ストアドプロシージャを使用する](sorting-custom-paged-data-vb/_static/image6.png)

<span data-ttu-id="1206d-177">**図 4**: GetProductsPagedAndSorted ストアドプロシージャを使用する</span><span class="sxs-lookup"><span data-stu-id="1206d-177">**Figure 4**: Use the GetProductsPagedAndSorted Stored Procedure</span></span>

<span data-ttu-id="1206d-178">このストアドプロシージャは、一連のレコードを結果として返します。そのため、次の画面では、表形式のデータが返されることを示しています。</span><span class="sxs-lookup"><span data-stu-id="1206d-178">This stored procedure returns a set of records as its results so, in the next screen, indicate that it returns tabular data.</span></span>

![ストアドプロシージャが表形式データを返すことを示します。](sorting-custom-paged-data-vb/_static/image7.png)

<span data-ttu-id="1206d-180">**図 5**: ストアドプロシージャが表形式データを返すことを示す</span><span class="sxs-lookup"><span data-stu-id="1206d-180">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data</span></span>

<span data-ttu-id="1206d-181">最後に、DataTable に Fill を使用し、DataTable パターンを返す DAL メソッドを作成します。これらのメソッドは、それぞれ `FillPagedAndSorted` と `GetProductsPagedAndSorted`に名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="1206d-181">Finally, create DAL methods that use both the Fill a DataTable and Return a DataTable patterns, naming the methods `FillPagedAndSorted` and `GetProductsPagedAndSorted`, respectively.</span></span>

![メソッド名の選択](sorting-custom-paged-data-vb/_static/image8.png)

<span data-ttu-id="1206d-183">**図 6**: メソッド名を選択する</span><span class="sxs-lookup"><span data-stu-id="1206d-183">**Figure 6**: Choose the Methods Names</span></span>

<span data-ttu-id="1206d-184">DAL を拡張したので、BLL に切り替える準備ができました。</span><span class="sxs-lookup"><span data-stu-id="1206d-184">Now that we ve extended the DAL, we re ready to turn to the BLL.</span></span> <span data-ttu-id="1206d-185">`ProductsBLL` クラスファイルを開き、新しいメソッド `GetProductsPagedAndSorted`を追加します。</span><span class="sxs-lookup"><span data-stu-id="1206d-185">Open the `ProductsBLL` class file and add a new method, `GetProductsPagedAndSorted`.</span></span> <span data-ttu-id="1206d-186">このメソッドでは、3つの入力パラメーター `sortExpression`、`startRowIndex`、および `maximumRows` を受け取る必要があります。また、次のように、単に DAL s `GetProductsPagedAndSorted` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-186">This method needs to accept three input parameters `sortExpression`, `startRowIndex`, and `maximumRows` and should simply call down into the DAL s `GetProductsPagedAndSorted` method, like so:</span></span>

[!code-vb[Main](sorting-custom-paged-data-vb/samples/sample4.vb)]

## <a name="step-3-configuring-the-objectdatasource-to-pass-in-the-sortexpression-parameter"></a><span data-ttu-id="1206d-187">手順 3: SortExpression パラメーターに渡す ObjectDataSource の構成</span><span class="sxs-lookup"><span data-stu-id="1206d-187">Step 3: Configuring the ObjectDataSource to Pass in the SortExpression Parameter</span></span>

<span data-ttu-id="1206d-188">`GetProductsPagedAndSorted` ストアドプロシージャを利用するメソッドを含むように DAL と BLL を強化した後は、`SortParameter.aspx` ページで ObjectDataSource を構成して新しい BLL メソッドを使用し、ユーザーが結果を並べ替えるために要求した列に基づいて `SortExpression` パラメーターを渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-188">Having augmented the DAL and BLL to include methods that utilize the `GetProductsPagedAndSorted` stored procedure, all that remains is to configure the ObjectDataSource in the `SortParameter.aspx` page to use the new BLL method and to pass in the `SortExpression` parameter based on the column that the user has requested to sort the results by.</span></span>

<span data-ttu-id="1206d-189">最初に、ObjectDataSource s `SelectMethod` を `GetProductsPaged` から `GetProductsPagedAndSorted`に変更します。</span><span class="sxs-lookup"><span data-stu-id="1206d-189">Start by changing the ObjectDataSource s `SelectMethod` from `GetProductsPaged` to `GetProductsPagedAndSorted`.</span></span> <span data-ttu-id="1206d-190">これは、データソースの構成ウィザード、プロパティウィンドウから、または宣言型の構文を使用して直接行うことができます。</span><span class="sxs-lookup"><span data-stu-id="1206d-190">This can be done through the Configure Data Source wizard, from the Properties window, or directly through the declarative syntax.</span></span> <span data-ttu-id="1206d-191">次に、ObjectDataSource s [`SortParameterName` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.sortparametername.aspx)の値を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-191">Next, we need to provide a value for the ObjectDataSource s [`SortParameterName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.sortparametername.aspx).</span></span> <span data-ttu-id="1206d-192">このプロパティが設定されている場合、ObjectDataSource は GridView s `SortExpression` プロパティを `SelectMethod`に渡そうとします。</span><span class="sxs-lookup"><span data-stu-id="1206d-192">If this property is set, the ObjectDataSource attempts to pass in the GridView s `SortExpression` property to the `SelectMethod`.</span></span> <span data-ttu-id="1206d-193">特に、ObjectDataSource は、`SortParameterName` プロパティの値と同じ名前を持つ入力パラメーターを検索します。</span><span class="sxs-lookup"><span data-stu-id="1206d-193">In particular, the ObjectDataSource looks for an input parameter whose name is equal to the value of the `SortParameterName` property.</span></span> <span data-ttu-id="1206d-194">BLL s `GetProductsPagedAndSorted` メソッドには `sortExpression`という名前の並べ替え式の入力パラメーターがあるため、ObjectDataSource s `SortExpression` プロパティを sortExpression に設定します。</span><span class="sxs-lookup"><span data-stu-id="1206d-194">Since the BLL s `GetProductsPagedAndSorted` method has the sort expression input parameter named `sortExpression`, set the ObjectDataSource s `SortExpression` property to sortExpression .</span></span>

<span data-ttu-id="1206d-195">これらの2つの変更を行った後、ObjectDataSource s 宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="1206d-195">After making these two changes, the ObjectDataSource s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](sorting-custom-paged-data-vb/samples/sample5.aspx)]

> [!NOTE]
> <span data-ttu-id="1206d-196">前のチュートリアルと同様に、ObjectDataSource には SelectParameters コレクションに sortExpression、startRowIndex、または maximumRows の入力パラメーターが含ま*れていない*ことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="1206d-196">As with the preceding tutorial, ensure that the ObjectDataSource does *not* include the sortExpression, startRowIndex, or maximumRows input parameters in its SelectParameters collection.</span></span>

<span data-ttu-id="1206d-197">GridView で並べ替えを有効にするには、gridview s スマートタグの [並べ替えを有効にする] チェックボックスをオンにします。これにより、GridView s `AllowSorting` プロパティが `true` に設定され、各列のヘッダーテキストが LinkButton としてレンダリングされます。</span><span class="sxs-lookup"><span data-stu-id="1206d-197">To enable sorting in the GridView, simply check the Enable Sorting checkbox in the GridView s smart tag, which sets the GridView s `AllowSorting` property to `true` and causing the header text for each column to be rendered as a LinkButton.</span></span> <span data-ttu-id="1206d-198">エンドユーザーがヘッダーリンクボタンのいずれかをクリックすると、ポストバック ensues と次の手順が終了します。</span><span class="sxs-lookup"><span data-stu-id="1206d-198">When the end user clicks on one of the header LinkButtons, a postback ensues and the following steps transpire:</span></span>

1. <span data-ttu-id="1206d-199">GridView は、その[`SortExpression` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sortexpression.aspx)を、ヘッダーリンクがクリックされたフィールドの `SortExpression` の値に更新します。</span><span class="sxs-lookup"><span data-stu-id="1206d-199">The GridView updates its [`SortExpression` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sortexpression.aspx) to the value of the `SortExpression` of the field whose header link was clicked</span></span>
2. <span data-ttu-id="1206d-200">ObjectDataSource は、BLL s `GetProductsPagedAndSorted` メソッドを呼び出します。これには、GridView s `SortExpression` プロパティを、メソッド s `sortExpression` の入力パラメーターの値として渡します (適切な `startRowIndex` および `maximumRows` 入力パラメーター値と共に)。</span><span class="sxs-lookup"><span data-stu-id="1206d-200">The ObjectDataSource invokes the BLL s `GetProductsPagedAndSorted` method, passing in the GridView s `SortExpression` property as the value for the method s `sortExpression` input parameter (along with the appropriate `startRowIndex` and `maximumRows` input parameter values)</span></span>
3. <span data-ttu-id="1206d-201">BLL は、DAL の `GetProductsPagedAndSorted` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="1206d-201">The BLL invokes the DAL s `GetProductsPagedAndSorted` method</span></span>
4. <span data-ttu-id="1206d-202">DAL は `GetProductsPagedAndSorted` ストアドプロシージャを実行し、`@sortExpression` パラメーター (`@startRowIndex` および `@maximumRows` 入力パラメーター値と共に渡します。</span><span class="sxs-lookup"><span data-stu-id="1206d-202">The DAL executes the `GetProductsPagedAndSorted` stored procedure, passing in the `@sortExpression` parameter (along with the `@startRowIndex` and `@maximumRows` input parameter values)</span></span>
5. <span data-ttu-id="1206d-203">このストアドプロシージャは、データの適切なサブセットを BLL に返します。これにより、データが ObjectDataSource に返されます。このデータは、GridView にバインドされ、HTML に表示され、エンドユーザーに送信されます。</span><span class="sxs-lookup"><span data-stu-id="1206d-203">The stored procedure returns the appropriate subset of data to the BLL, which returns it to the ObjectDataSource; this data is then bound to the GridView, rendered into HTML, and sent down to the end user</span></span>

<span data-ttu-id="1206d-204">図7に、`UnitPrice` によって昇順に並べ替えられた場合の結果の最初のページを示します。</span><span class="sxs-lookup"><span data-stu-id="1206d-204">Figure 7 shows the first page of results when sorted by the `UnitPrice` in ascending order.</span></span>

<span data-ttu-id="1206d-205">[結果が UnitPrice によって並べ替えら ![](sorting-custom-paged-data-vb/_static/image10.png)](sorting-custom-paged-data-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="1206d-205">[![The Results are Sorted by the UnitPrice](sorting-custom-paged-data-vb/_static/image10.png)](sorting-custom-paged-data-vb/_static/image9.png)</span></span>

<span data-ttu-id="1206d-206">**図 7**: 結果が UnitPrice によって並べ替えられる ([クリックすると、フルサイズの画像が表示](sorting-custom-paged-data-vb/_static/image11.png)されます)</span><span class="sxs-lookup"><span data-stu-id="1206d-206">**Figure 7**: The Results are Sorted by the UnitPrice ([Click to view full-size image](sorting-custom-paged-data-vb/_static/image11.png))</span></span>

<span data-ttu-id="1206d-207">現在の実装では、製品名、カテゴリ名、数量/単位、および単価によって結果を正しく並べ替えることができますが、仕入先名によって結果を注文しようとすると、ランタイム例外が発生します (図8を参照)。</span><span class="sxs-lookup"><span data-stu-id="1206d-207">While the current implementation can correctly sort the results by product name, category name, quantity per unit, and unit price, attempting to order the results by the supplier name results in a runtime exception (see Figure 8).</span></span>

![仕入先によって結果を並べ替えようとすると、次のランタイム例外が発生します。](sorting-custom-paged-data-vb/_static/image12.png)

<span data-ttu-id="1206d-209">**図 8**: 仕入先によって結果を並べ替えようとすると、次のランタイム例外が発生する</span><span class="sxs-lookup"><span data-stu-id="1206d-209">**Figure 8**: Attempting to Sort the Results by the Supplier Results in the Following Runtime Exception</span></span>

<span data-ttu-id="1206d-210">この例外は、GridView `SupplierName` BoundField の `SortExpression` が `SupplierName`に設定されていることが原因で発生します。</span><span class="sxs-lookup"><span data-stu-id="1206d-210">This exception occurs because the `SortExpression` of the GridView s `SupplierName` BoundField is set to `SupplierName`.</span></span> <span data-ttu-id="1206d-211">ただし、`Suppliers` テーブルの仕入先の名前は、実際には `SupplierName`としてこの列名のエイリアスが `CompanyName` と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="1206d-211">However, the supplier s name in the `Suppliers` table is actually called `CompanyName` we have been aliased this column name as `SupplierName`.</span></span> <span data-ttu-id="1206d-212">ただし、`ROW_NUMBER()` 関数で使用される `OVER` 句は別名を使用できず、実際の列名を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1206d-212">However, the `OVER` clause used by the `ROW_NUMBER()` function cannot use the alias and must use the actual column name.</span></span> <span data-ttu-id="1206d-213">したがって、`SupplierName` BoundField s `SortExpression` を SupplierName から CompanyName に変更します (図9を参照)。</span><span class="sxs-lookup"><span data-stu-id="1206d-213">Therefore, change the `SupplierName` BoundField s `SortExpression` from SupplierName to CompanyName (see Figure 9).</span></span> <span data-ttu-id="1206d-214">図10に示すように、この変更を行うと、仕入先によって結果を並べ替えることができます。</span><span class="sxs-lookup"><span data-stu-id="1206d-214">As Figure 10 shows, after this change the results can be sorted by the supplier.</span></span>

![SupplierName BoundField s SortExpression を CompanyName に変更します。](sorting-custom-paged-data-vb/_static/image13.png)

<span data-ttu-id="1206d-216">**図 9**: SupplierName BoundField s SortExpression を CompanyName に変更する</span><span class="sxs-lookup"><span data-stu-id="1206d-216">**Figure 9**: Change the SupplierName BoundField s SortExpression to CompanyName</span></span>

<span data-ttu-id="1206d-217">[![結果を Supplier で並べ替えることができるようになりました](sorting-custom-paged-data-vb/_static/image15.png)](sorting-custom-paged-data-vb/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="1206d-217">[![The Results Can Now Be Sorted by Supplier](sorting-custom-paged-data-vb/_static/image15.png)](sorting-custom-paged-data-vb/_static/image14.png)</span></span>

<span data-ttu-id="1206d-218">**図 10**: Supplier で結果を並べ替えることができる ([クリックすると、フルサイズの画像が表示](sorting-custom-paged-data-vb/_static/image16.png)されます)</span><span class="sxs-lookup"><span data-stu-id="1206d-218">**Figure 10**: The Results Can Now Be Sorted by Supplier ([Click to view full-size image](sorting-custom-paged-data-vb/_static/image16.png))</span></span>

## <a name="summary"></a><span data-ttu-id="1206d-219">まとめ</span><span class="sxs-lookup"><span data-stu-id="1206d-219">Summary</span></span>

<span data-ttu-id="1206d-220">前のチュートリアルで検証したカスタムページング実装では、デザイン時に結果の並べ替え順序を指定する必要がありました。</span><span class="sxs-lookup"><span data-stu-id="1206d-220">The custom paging implementation we examined in the preceding tutorial required that the order by which the results were to be sorted be specified at design time.</span></span> <span data-ttu-id="1206d-221">つまり、実装したカスタムページング実装は、並べ替え機能を提供することができなかったことを意味します。</span><span class="sxs-lookup"><span data-stu-id="1206d-221">In short, this meant that the custom paging implementation we implemented could not, at the same time, provide sorting capabilities.</span></span> <span data-ttu-id="1206d-222">このチュートリアルでは、最初からストアドプロシージャを拡張し、結果を並べ替えるための `@sortExpression` 入力パラメーターを含めることによって、この制限を克服しました。</span><span class="sxs-lookup"><span data-stu-id="1206d-222">In this tutorial we overcame this limitation by extending the stored procedure from the first to include a `@sortExpression` input parameter by which the results could be sorted.</span></span>

<span data-ttu-id="1206d-223">このストアドプロシージャを作成し、DAL および BLL で新しいメソッドを作成した後、GridView を構成して、並べ替えとカスタムページングの両方を提供する GridView を実装できるようになりました。これにより、GridView の current `SortExpression` プロパティを BLL `SelectMethod`に渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="1206d-223">After creating this stored procedure and creating new methods in the DAL and BLL, we were able to implement a GridView that offered both sorting and custom paging by configuring the ObjectDataSource to pass in the GridView s current `SortExpression` property to the BLL `SelectMethod`.</span></span>

<span data-ttu-id="1206d-224">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="1206d-224">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="1206d-225">著者について</span><span class="sxs-lookup"><span data-stu-id="1206d-225">About the Author</span></span>

<span data-ttu-id="1206d-226">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="1206d-226">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="1206d-227">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="1206d-227">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="1206d-228">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="1206d-228">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="1206d-229">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1206d-229">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="1206d-230">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="1206d-230">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="1206d-231">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="1206d-231">Special Thanks To</span></span>

<span data-ttu-id="1206d-232">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="1206d-232">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="1206d-233">このチュートリアルのリードレビュー担当者は、Carlos Santos でした。</span><span class="sxs-lookup"><span data-stu-id="1206d-233">Lead reviewer for this tutorial was Carlos Santos.</span></span> <span data-ttu-id="1206d-234">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="1206d-234">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="1206d-235">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1206d-235">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1206d-236">[前へ](efficiently-paging-through-large-amounts-of-data-vb.md)
> [次へ](creating-a-customized-sorting-user-interface-vb.md)</span><span class="sxs-lookup"><span data-stu-id="1206d-236">[Previous](efficiently-paging-through-large-amounts-of-data-vb.md)
[Next](creating-a-customized-sorting-user-interface-vb.md)</span></span>
