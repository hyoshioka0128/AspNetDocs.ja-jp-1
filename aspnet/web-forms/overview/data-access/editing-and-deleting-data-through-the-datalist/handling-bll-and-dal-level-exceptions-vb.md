---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
title: BLL および DAL レベルの例外の処理 (VB) |Microsoft Docs
author: rick-anderson
description: このチュートリアルでは、編集可能な DataList の更新ワークフロー中に発生した例外を tactfully に処理する方法について説明します。
ms.author: riande
ms.date: 10/30/2006
ms.assetid: ca665073-b379-4239-9404-f597663ca65e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: 319ab44f2e65afc77f6f89ca8aa58c529f40d05c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78480154"
---
# <a name="handling-bll--and-dal-level-exceptions-vb"></a><span data-ttu-id="d3a3d-103">BLL レベルと DAL レベルの例外を処理する (VB)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-103">Handling BLL- and DAL-Level Exceptions (VB)</span></span>

<span data-ttu-id="d3a3d-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d3a3d-105">[サンプルアプリのダウンロード](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe)または[PDF のダウンロード](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span></span>

> <span data-ttu-id="d3a3d-106">このチュートリアルでは、編集可能な DataList の更新ワークフロー中に発生した例外を tactfully に処理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>

## <a name="introduction"></a><span data-ttu-id="d3a3d-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="d3a3d-107">Introduction</span></span>

<span data-ttu-id="d3a3d-108">DataList チュートリアル[でのデータの編集と削除の概要](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)では、単純な編集および削除機能を提供する DataList を作成しました。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="d3a3d-109">完全に機能している間は、編集または削除のプロセス中に発生したエラーによってハンドルされない例外が発生したため、ユーザーにとってはわかりませんでした。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="d3a3d-110">たとえば、製品名を省略したり、製品を編集するときに価格を非常に手頃な価格で入力したりすると、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="d3a3d-111">この例外はコードでキャッチされないため、ASP.NET ランタイムにバブルし、web ページに例外の詳細が表示されます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="d3a3d-112">「 [ASP.NET ページでの BLL と DAL レベルの例外の処理](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)」チュートリアルで説明したように、ビジネスロジックまたはデータアクセス層の深さから例外が発生すると、例外の詳細が ObjectDataSource に返され、次に GridView に返されます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="d3a3d-113">これらの例外を適切に処理する方法については、ObjectDataSource または GridView のイベントハンドラーを `Updated` または `RowUpdated` 作成し、例外を確認して、例外が処理されたことを示しています。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="d3a3d-114">ただし、DataList チュートリアルでは、データの更新と削除に ObjectDataSource は使用しません。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-114">Our DataList tutorials, however, aren't using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="d3a3d-115">代わりに、BLL に対して直接作業しています。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="d3a3d-116">BLL または DAL から発生した例外を検出するには、ASP.NET ページの分離コード内で例外処理コードを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="d3a3d-117">このチュートリアルでは、編集可能な DataList の更新ワークフロー中に発生した例外を tactfully に処理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="d3a3d-118">*「Datalist チュートリアル」の「データの編集と削除の概要*」では、datalist のデータを編集および削除するためのさまざまな手法について説明しました。これは、更新と削除に ObjectDataSource を使用する手法です。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="d3a3d-119">これらの手法を採用している場合は、ObjectDataSource または DAL の例外を ObjectDataSource s `Updated` または `Deleted` のイベントハンドラーを通じて処理できます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>

## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="d3a3d-120">手順 1: 編集可能な DataList の作成</span><span class="sxs-lookup"><span data-stu-id="d3a3d-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="d3a3d-121">更新ワークフロー中に発生した例外の処理について心配する前に、まず、編集可能な DataList を作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="d3a3d-122">`EditDeleteDataList` フォルダーの `ErrorHandling.aspx` ページを開き、DataList をデザイナーに追加し、その `ID` プロパティを `Products`に設定して、`ProductsDataSource`という名前の新しい ObjectDataSource を追加します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="d3a3d-123">`ProductsBLL` クラス s `GetProducts()` メソッドを使用してレコードを選択するように ObjectDataSource を構成します。[挿入]、[更新]、および [削除] の各タブのドロップダウンリストを [(なし)] に設定します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="d3a3d-124">[GetProducts () メソッドを使用して製品情報を返す ![](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span></span>

<span data-ttu-id="d3a3d-125">**図 1**: `GetProducts()` メソッドを使用して製品情報を返す ([クリックすると、フルサイズの画像が表示](handling-bll-and-dal-level-exceptions-vb/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span></span>

<span data-ttu-id="d3a3d-126">ObjectDataSource ウィザードを完了すると、Visual Studio によって DataList の `ItemTemplate` が自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="d3a3d-127">これを、各製品の名前と価格を表示し、[編集] ボタンを含む `ItemTemplate` で置き換えます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="d3a3d-128">次に、[名前]、[価格]、[更新]、および [キャンセル] ボタンのテキストボックス Web コントロールを含む `EditItemTemplate` を作成します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="d3a3d-129">最後に、DataList s `RepeatColumns` プロパティを2に設定します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="d3a3d-130">これらの変更が完了すると、ページの宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="d3a3d-131">[編集]、[キャンセル]、および [更新] の各ボタンの `CommandName` プロパティが、それぞれ [編集]、[キャンセル]、[更新] に設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="d3a3d-132">このチュートリアルでは、DataList s ビューステートを有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-132">For this tutorial the DataList s view state must be enabled.</span></span>

<span data-ttu-id="d3a3d-133">ブラウザーで進行状況を確認します (図2を参照)。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>

<span data-ttu-id="d3a3d-134">[各製品に [Edit] \ (編集 \) ボタンが含まれて ![](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span></span>

<span data-ttu-id="d3a3d-135">**図 2**: 各製品には、[編集] ボタンがあります ([クリックすると、フルサイズの画像が表示](handling-bll-and-dal-level-exceptions-vb/_static/image6.png)されます)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span></span>

<span data-ttu-id="d3a3d-136">現在、[編集] ボタンによってポストバックが発生するのは、まだ製品が編集可能になっていないためです。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="d3a3d-137">編集を有効にするには、DataList s `EditCommand`、`CancelCommand`、および `UpdateCommand` イベントのイベントハンドラーを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="d3a3d-138">`EditCommand` イベントと `CancelCommand` イベントは、単に DataList s `EditItemIndex` プロパティを更新し、データを DataList に再バインドします。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="d3a3d-139">`UpdateCommand` イベントハンドラーはもう少し複雑です。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="d3a3d-140">編集した製品の `ProductID` を `DataKeys` コレクションから、`EditItemTemplate`のテキストボックスの製品名と価格と共に読み取る必要があります。その後、DataList を編集前の状態に戻す前に、`ProductsBLL` クラス s `UpdateProduct` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="d3a3d-141">ここでは、「 *DataList チュートリアル」の「データの編集と削除の概要*」で、`UpdateCommand` イベントハンドラーとまったく同じコードを使用してみましょう。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="d3a3d-142">手順 2. で例外を適切に処理するコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="d3a3d-143">形式が無効な入力がある場合は、無効な形式の単価、-$5.00 のような無効な単価値、または製品名の省略によって例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="d3a3d-144">`UpdateCommand` イベントハンドラーには、この時点で例外処理コードが含まれていないため、例外は ASP.NET ランタイムにバブルアップされ、エンドユーザーに表示されます (図3を参照)。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>

![未処理の例外が発生すると、エンドユーザーにエラーページが表示されます。](handling-bll-and-dal-level-exceptions-vb/_static/image7.png)

<span data-ttu-id="d3a3d-146">**図 3**: ハンドルされない例外が発生した場合、エンドユーザーにエラーページが表示される</span><span class="sxs-lookup"><span data-stu-id="d3a3d-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>

## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="d3a3d-147">手順 2: UpdateCommand イベントハンドラーで例外を適切に処理する</span><span class="sxs-lookup"><span data-stu-id="d3a3d-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="d3a3d-148">更新中のワークフローでは、`UpdateCommand` イベントハンドラー、BLL、または DAL で例外が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="d3a3d-149">たとえば、ユーザーが高価な価格を入力した場合、`UpdateCommand` イベントハンドラーの `Decimal.Parse` ステートメントは `FormatException` 例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="d3a3d-150">ユーザーが製品名を省略した場合、または価格に負の値が含まれている場合は、DAL によって例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="d3a3d-151">例外が発生したときに、ページ内に情報メッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="d3a3d-152">`ID` が `ExceptionDetails`に設定されているページに、ラベル Web コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="d3a3d-153">`Styles.css` ファイルで定義されている `Warning` CSS クラスに `CssClass` プロパティを割り当てることにより、ラベル s テキストを赤、特大、太字、斜体のフォントで表示するように構成します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="d3a3d-154">エラーが発生した場合、ラベルを一度だけ表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="d3a3d-155">つまり、それ以降のポストバックでは、ラベル s の警告メッセージが表示されなくなります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="d3a3d-156">これを実現するには、Label s `Text` プロパティをクリアするか `Visible` プロパティを設定して、`Page_Load` イベントハンドラーで `False` に戻します (「 [ASP.NET ページでの BLL および DAL レベルの例外の処理](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)」を参照してください)。または、ラベル s のビューステートのサポートを無効にします。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="d3a3d-157">後者のオプションを使用してみましょう。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-157">Let s use the latter option.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample4.aspx)]

<span data-ttu-id="d3a3d-158">例外が発生したときに、例外の詳細を `ExceptionDetails` Label コントロール s `Text` プロパティに割り当てます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="d3a3d-159">ビューステートが無効になっているため、以降のポストバック時に `Text` プロパティのプログラムによる変更が失われ、既定のテキスト (空の文字列) に戻り、警告メッセージが非表示になります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="d3a3d-160">ページに有用なメッセージを表示するためにエラーが発生したタイミングを判断するには、`UpdateCommand` イベントハンドラーに `Try ... Catch` ブロックを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="d3a3d-161">`Try` 部分には、例外の原因となる可能性のあるコードが含まれています。一方、`Catch` ブロックには、例外の発生時に実行されるコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="d3a3d-162">`Try ... Catch` ブロックの詳細については、.NET Framework のドキュメントの[例外処理の基礎](https://msdn.microsoft.com/library/2w8f0bss.aspx)に関するセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="d3a3d-163">`Try` ブロック内のコードによって任意の型の例外がスローされると、`Catch` ブロックのコードが実行を開始します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="d3a3d-164">`DbException`、`NoNullAllowedException`、`ArgumentException`などによってスローされる例外の種類は、最初にエラーをよりしたものによって異なります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="d3a3d-165">データベースレベルで問題が発生すると、`DbException` がスローされます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="d3a3d-166">`UnitPrice`、`UnitsInStock`、`UnitsOnOrder`、または `ReorderLevel` フィールドに無効な値が入力された場合、`ArgumentException` クラスでこれらのフィールド値を検証するコードを追加したため、`ProductsDataTable` がスローされます (「[ビジネスロジック層の作成](../introduction/creating-a-business-logic-layer-vb.md)」チュートリアルを参照してください)。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial).</span></span>

<span data-ttu-id="d3a3d-167">キャッチされた例外の種類に基づいてメッセージテキストを指定することにより、エンドユーザーにより役立つ説明を提供できます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="d3a3d-168">次のコードは、 [ASP.NET Page チュートリアルでの BLL と DAL レベルの例外の処理](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)について、ほぼ同じ形式で使用されています。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial provides this level of detail:</span></span>

[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample6.vb)]

<span data-ttu-id="d3a3d-169">このチュートリアルを完了するには、キャッチされた `Exception` インスタンス (`ex`) を渡して、`Catch` ブロックから `DisplayExceptionDetails` メソッドを呼び出すだけです。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="d3a3d-170">`Try ... Catch` ブロックが配置されていると、ユーザーには、図4と5に示すように、より詳細なエラーメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="d3a3d-171">例外が発生した場合、DataList は編集モードのままであることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="d3a3d-172">これは、例外が発生すると、コントロールフローが直ちに `Catch` ブロックにリダイレクトされ、DataList を編集前の状態に返すコードがバイパスされるためです。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="d3a3d-173">[ユーザーが必要なフィールドを省略した場合にエラーメッセージが表示される ![](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span></span>

<span data-ttu-id="d3a3d-174">**図 4**: ユーザーが必要なフィールドを省略した場合にエラーメッセージが表示される ([クリックすると、フルサイズの画像が表示](handling-bll-and-dal-level-exceptions-vb/_static/image10.png)されます)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span></span>

<span data-ttu-id="d3a3d-175">[負の価格を入力したときにエラーメッセージが表示される ![](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span></span>

<span data-ttu-id="d3a3d-176">**図 5**: 負の価格を入力したときにエラーメッセージが表示される ([クリックすると、フルサイズの画像が表示](handling-bll-and-dal-level-exceptions-vb/_static/image13.png)されます)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span></span>

## <a name="summary"></a><span data-ttu-id="d3a3d-177">まとめ</span><span class="sxs-lookup"><span data-stu-id="d3a3d-177">Summary</span></span>

<span data-ttu-id="d3a3d-178">GridView および ObjectDataSource は、ワークフローの更新中や削除中に発生した例外に関する情報を含むポストレベルのイベントハンドラーを提供します。また、例外が発生したかどうかを示すために設定できるプロパティについても説明します。対応.</span><span class="sxs-lookup"><span data-stu-id="d3a3d-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="d3a3d-179">ただし、DataList を使用して BLL を直接使用する場合、これらの機能は使用できません。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="d3a3d-180">代わりに、例外処理を実装する責任があります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="d3a3d-181">このチュートリアルでは、`UpdateCommand` イベントハンドラーに `Try ... Catch` ブロックを追加して、編集可能な DataList s 更新ワークフローに例外処理を追加する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="d3a3d-182">更新中のワークフロー中に例外が発生した場合、`Catch` ブロックのコードが実行され、`ExceptionDetails` ラベルに有用な情報が表示されます。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="d3a3d-183">この時点で、DataList では、最初の段階で例外が発生しないようにする作業は行われません。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="d3a3d-184">負の価格によって例外が発生することはわかっていますが、ユーザーがこのような無効な入力を事前に入力できないようにするための機能はまだ追加されていません。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-184">Even though we know that a negative price will result in an exception, we haven't yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="d3a3d-185">次のチュートリアルでは、`EditItemTemplate`に検証コントロールを追加することによって、無効なユーザー入力によって発生する例外を軽減する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="d3a3d-186">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="d3a3d-187">参考資料</span><span class="sxs-lookup"><span data-stu-id="d3a3d-187">Further Reading</span></span>

<span data-ttu-id="d3a3d-188">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d3a3d-189">例外のデザインのガイドライン</span><span class="sxs-lookup"><span data-stu-id="d3a3d-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="d3a3d-190">[エラーログモジュールとハンドラー (ELMAH)](http://workspaces.gotdotnet.com/elmah) (エラーをログに記録するためのオープンソースライブラリ)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="d3a3d-191">[.NET Framework 2.0 のエンタープライズライブラリ](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en)(例外管理アプリケーションブロックを含む)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="d3a3d-192">著者について</span><span class="sxs-lookup"><span data-stu-id="d3a3d-192">About the Author</span></span>

<span data-ttu-id="d3a3d-193">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d3a3d-194">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d3a3d-195">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="d3a3d-196">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="d3a3d-197">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="d3a3d-198">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-198">Special Thanks To</span></span>

<span data-ttu-id="d3a3d-199">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d3a3d-200">このチュートリアルのリードレビュー担当者は、Ken による Isa です。</span><span class="sxs-lookup"><span data-stu-id="d3a3d-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="d3a3d-201">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="d3a3d-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d3a3d-202">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d3a3d-203">[前へ](performing-batch-updates-vb.md)
> [次へ](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span><span class="sxs-lookup"><span data-stu-id="d3a3d-203">[Previous](performing-batch-updates-vb.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span></span>
