---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-cs
title: DataList (C#) でのデータの編集と削除の概要について説明します。Microsoft Docs
author: rick-anderson
description: DataList には編集および削除機能が組み込まれていませんが、このチュートリアルでは、編集と削除をサポートする DataList を作成する方法について説明します。
ms.author: riande
ms.date: 10/30/2006
ms.assetid: c3b0c86e-fe98-41ee-b26f-ca38cddaa75e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: 481c9a14b1ebfe36ffcddd0237701bc04266e393
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74629535"
---
# <a name="an-overview-of-editing-and-deleting-data-in-the-datalist-c"></a><span data-ttu-id="5b2c9-103">DataList (C#) でのデータの編集と削除の概要</span><span class="sxs-lookup"><span data-stu-id="5b2c9-103">An Overview of Editing and Deleting Data in the DataList (C#)</span></span>

<span data-ttu-id="5b2c9-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5b2c9-105">[サンプルアプリのダウンロード](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_CS.exe)または[PDF のダウンロード](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/datatutorial36cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_CS.exe) or [Download PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/datatutorial36cs1.pdf)</span></span>

> <span data-ttu-id="5b2c9-106">DataList には編集および削除機能が組み込まれていませんが、このチュートリアルでは、基になるデータの編集と削除をサポートする DataList を作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-106">While the DataList lacks built-in editing and deleting capabilities, in this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span>

## <a name="introduction"></a><span data-ttu-id="5b2c9-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="5b2c9-107">Introduction</span></span>

<span data-ttu-id="5b2c9-108">[「データの挿入、更新、削除の概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)」チュートリアルでは、アプリケーションアーキテクチャ、ObjectDataSource、GridView、DetailsView、および FormView コントロールを使用してデータを挿入、更新、および削除する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-108">In the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial we looked at how to insert, update, and delete data using the application architecture, an ObjectDataSource, and the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="5b2c9-109">ObjectDataSource とこれら3つのデータ Web コントロールでは、単純なデータ変更インターフェイスの実装はスナップであり、単にスマートタグからチェックボックスをオンにするだけです。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-109">With the ObjectDataSource and these three data Web controls, implementing simple data modification interfaces was a snap and involved merely ticking a checkbox from a smart tag.</span></span> <span data-ttu-id="5b2c9-110">コードを記述する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-110">No code needed to be written.</span></span>

<span data-ttu-id="5b2c9-111">残念ながら、DataList には GridView コントロールに固有の組み込みの編集および削除機能がありません。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-111">Unfortunately, the DataList lacks the built-in editing and deleting capabilities inherent in the GridView control.</span></span> <span data-ttu-id="5b2c9-112">この欠けている機能は、宣言型のデータソースコントロールとコードフリーのデータ変更ページが使用できない場合に、DataList が以前のバージョンの ASP.NET の聖製品であることが原因です。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-112">This missing functionality is due in part to the fact that the DataList is a relic from the previous version of ASP.NET, when declarative data source controls and code-free data modification pages were unavailable.</span></span> <span data-ttu-id="5b2c9-113">ASP.NET 2.0 の DataList では、GridView と同じデータ変更機能が提供されていませんが、ASP.NET 1. x の手法を使用してこの機能を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-113">While the DataList in ASP.NET 2.0 does not offer the same out of the box data modification capabilities as the GridView, we can use ASP.NET 1.x techniques to include such functionality.</span></span> <span data-ttu-id="5b2c9-114">この方法には少しのコードが必要ですが、このチュートリアルで説明するように、DataList には、このプロセスを支援するためのイベントとプロパティがいくつか用意されています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-114">This approach requires a bit of code but, as we'll see in this tutorial, the DataList has some events and properties in place to aid in this process.</span></span>

<span data-ttu-id="5b2c9-115">このチュートリアルでは、基になるデータの編集と削除をサポートする DataList を作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-115">In this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span> <span data-ttu-id="5b2c9-116">今後のチュートリアルでは、入力フィールドの検証、データアクセスやビジネスロジックレイヤーから発生した例外の適切な処理など、より高度な編集と削除のシナリオについて説明します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-116">Future tutorials will examine more advanced editing and deleting scenarios, including input field validation, gracefully handling exceptions raised from the Data Access or Business Logic Layers, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="5b2c9-117">DataList と同様に、Repeater コントロールは、挿入、更新、または削除のためのすぐに使用する機能を備えていません。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-117">Like the DataList, the Repeater control lacks the out of the box functionality for inserting, updating, or deleting.</span></span> <span data-ttu-id="5b2c9-118">このような機能を追加できますが、DataList には、このような機能の追加を簡略化する、リピータに見つからないプロパティとイベントが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-118">While such functionality can be added, the DataList includes properties and events not found in the Repeater that simplify adding such capabilities.</span></span> <span data-ttu-id="5b2c9-119">そのため、このチュートリアルと、編集と削除については、常に DataList に焦点を当てています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-119">Therefore, this tutorial and future ones that look at editing and deleting will focus strictly on the DataList.</span></span>

## <a name="step-1-creating-the-editing-and-deleting-tutorials-web-pages"></a><span data-ttu-id="5b2c9-120">手順 1: チュートリアルの編集と削除の Web ページを作成する</span><span class="sxs-lookup"><span data-stu-id="5b2c9-120">Step 1: Creating the Editing and Deleting Tutorials Web Pages</span></span>

<span data-ttu-id="5b2c9-121">DataList からデータを更新および削除する方法を確認する前に、まず、このチュートリアルに必要な ASP.NET ページを web サイトプロジェクトに作成し、次のいくつかについて説明します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-121">Before we start exploring how to update and delete data from a DataList, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next several ones.</span></span> <span data-ttu-id="5b2c9-122">まず、`EditDeleteDataList`という名前の新しいフォルダーを追加します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-122">Start by adding a new folder named `EditDeleteDataList`.</span></span> <span data-ttu-id="5b2c9-123">次に、次の ASP.NET ページをそのフォルダーに追加します。各ページは `Site.master` マスターページに関連付けられていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Basics.aspx`
- `BatchUpdate.aspx`
- `ErrorHandling.aspx`
- `UIValidation.aspx`
- `CustomizedUI.aspx`
- `OptimisticConcurrency.aspx`
- `ConfirmationOnDelete.aspx`
- `UserLevelAccess.aspx`

![チュートリアルの ASP.NET ページを追加する](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image1.png)

<span data-ttu-id="5b2c9-125">**図 1**: チュートリアルの ASP.NET ページを追加する</span><span class="sxs-lookup"><span data-stu-id="5b2c9-125">**Figure 1**: Add the ASP.NET Pages for the Tutorials</span></span>

<span data-ttu-id="5b2c9-126">他のフォルダーと同様に、`EditDeleteDataList` フォルダー内の `Default.aspx` には、そのセクションのチュートリアルが一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-126">Like in the other folders, `Default.aspx` in the `EditDeleteDataList` folder lists the tutorials in its section.</span></span> <span data-ttu-id="5b2c9-127">`SectionLevelTutorialListing.ascx` ユーザーコントロールがこの機能を提供していることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="5b2c9-128">したがって、ソリューションエクスプローラーからページデザインビューにドラッグして、このユーザーコントロールを `Default.aspx` に追加します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="5b2c9-129">[SectionLevelTutorialListing ユーザーコントロールを default.aspx に追加 ![には](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image2.png)</span></span>

<span data-ttu-id="5b2c9-130">**図 2**: `Default.aspx` に `SectionLevelTutorialListing.ascx` ユーザーコントロールを追加する ([クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image4.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image4.png))</span></span>

<span data-ttu-id="5b2c9-131">最後に、`Web.sitemap` ファイルにエントリとしてページを追加します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-131">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="5b2c9-132">具体的には、DataList および Repeater `<siteMapNode>`を使用して、マスター/詳細レポートの後に次のマークアップを追加します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-132">Specifically, add the following markup after the Master/Detail Reports with the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-xml[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample1.xml)]

<span data-ttu-id="5b2c9-133">`Web.sitemap`を更新した後、ブラウザーを使用してチュートリアル web サイトを表示します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="5b2c9-134">左側のメニューには、DataList の編集と削除のチュートリアルの項目が含まれるようになりました。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-134">The menu on the left now includes items for the DataList editing and deleting tutorials.</span></span>

![サイトマップに、DataList の編集と削除のチュートリアルのエントリが含まれるようになりました。](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image5.png)

<span data-ttu-id="5b2c9-136">**図 3**: サイトマップに、DataList の編集と削除のチュートリアルのエントリが含まれるようになりました。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-136">**Figure 3**: The Site Map Now Includes Entries for the DataList Editing and Deleting Tutorials</span></span>

## <a name="step-2-examining-techniques-for-updating-and-deleting-data"></a><span data-ttu-id="5b2c9-137">手順 2: データの更新と削除の手法を調べる</span><span class="sxs-lookup"><span data-stu-id="5b2c9-137">Step 2: Examining Techniques for Updating and Deleting Data</span></span>

<span data-ttu-id="5b2c9-138">GridView を使用してデータを編集および削除するのは簡単です。これは、gridview と ObjectDataSource が連携して動作するためです。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-138">Editing and deleting data with the GridView is so easy because, underneath the covers, the GridView and ObjectDataSource work in concert.</span></span> <span data-ttu-id="5b2c9-139">「[挿入、更新、および削除に関連するイベントの調査](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)」で説明されているように、[行 s 更新] ボタンをクリックすると、GridView は、双方向のデータバインディングを使用したフィールドを objectdatasource の `UpdateParameters` コレクションに自動的に割り当て、その objectdatasource `Update()` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-139">As discussed in the [Examining the Events Associated with Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md) tutorial, when a row s Update button is clicked, the GridView automatically assigns its fields that used two-way databinding to the `UpdateParameters` collection of its ObjectDataSource and then invokes that ObjectDataSource s `Update()` method.</span></span>

<span data-ttu-id="5b2c9-140">残念ながら、DataList では、この組み込み機能は提供されません。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-140">Sadly, the DataList does not provide any of this built-in functionality.</span></span> <span data-ttu-id="5b2c9-141">ユーザーの値が ObjectDataSource s パラメーターに割り当てられ、`Update()` メソッドが呼び出されるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-141">It is our responsibility to ensure that the user s values are assigned to the ObjectDataSource s parameters and that its `Update()` method is called.</span></span> <span data-ttu-id="5b2c9-142">この機能を利用するために、DataList には次のプロパティとイベントが用意されています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-142">To aid us in this endeavor, the DataList provides the following properties and events:</span></span>

- <span data-ttu-id="5b2c9-143">更新または削除する場合、  **[`DataKeyField` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)は**、DataList 内の各項目を一意に識別できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-143">**The [`DataKeyField` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** when updating or deleting, we need to be able to uniquely identify each item in the DataList.</span></span> <span data-ttu-id="5b2c9-144">このプロパティを、表示されるデータの [主キー] フィールドに設定します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-144">Set this property to the primary key field of the displayed data.</span></span> <span data-ttu-id="5b2c9-145">これにより、datalist s [`DataKeys` コレクション](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx)に、各 datalist 項目の指定された `DataKeyField` 値が設定されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-145">Doing so will populate the DataList s [`DataKeys` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx) with the specified `DataKeyField` value for each DataList item.</span></span>
- <span data-ttu-id="5b2c9-146">**[`EditCommand` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** は、`CommandName` プロパティが [編集] に設定されているボタン、LinkButton、または ImageButton がクリックされたときに発生します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-146">**The [`EditCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Edit is clicked.</span></span>
- <span data-ttu-id="5b2c9-147">**[`CancelCommand` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** は、`CommandName` プロパティが [キャンセル] に設定されているボタン、LinkButton、または ImageButton がクリックされたときに発生します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-147">**The [`CancelCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Cancel is clicked.</span></span>
- <span data-ttu-id="5b2c9-148">**[`UpdateCommand` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** は、`CommandName` プロパティが [更新] に設定されているボタン、LinkButton、または ImageButton がクリックされたときに発生します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-148">**The [`UpdateCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Update is clicked.</span></span>
- <span data-ttu-id="5b2c9-149">**[`DeleteCommand` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** は、`CommandName` プロパティが [削除] に設定されているボタン、LinkButton、または ImageButton がクリックされたときに発生します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-149">**The [`DeleteCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Delete is clicked.</span></span>

<span data-ttu-id="5b2c9-150">これらのプロパティとイベントを使用して、DataList からデータを更新および削除するために使用できる4つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-150">Using these properties and events, there are four approaches we can use to update and delete data from the DataList:</span></span>

1. <span data-ttu-id="5b2c9-151">**ASP.NET 1.X 手法を使用**すると、DataList は ASP.NET 2.0 および objectdatasources ソースより前に存在し、プログラムによる手段を通じてデータを完全に更新および削除することができました。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-151">**Using ASP.NET 1.x Techniques** the DataList existed prior to ASP.NET 2.0 and ObjectDataSources and was able to update and delete data entirely through programmatic means.</span></span> <span data-ttu-id="5b2c9-152">この手法では、ObjectDataSource を完全に ditches し、表示するデータを取得するときとレコードを更新または削除するときの両方で、ビジネスロジック層からデータを DataList に直接バインドする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-152">This technique ditches the ObjectDataSource altogether and requires that we bind the data to the DataList directly from the Business Logic Layer, both in retrieving the data to display and when updating or deleting a record.</span></span>
2. <span data-ttu-id="5b2c9-153">DataList に固有の編集および削除機能がないときに、**ページで1つの ObjectDataSource コントロールを選択、更新、および削除するために使用**することはできません。そのため、これらを自分で追加することはできません。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-153">**Using a Single ObjectDataSource Control on the Page for Selecting, Updating, and Deleting** while the DataList lacks the GridView s inherent editing and deleting capabilities, there s no reason we can t add them in ourselves.</span></span> <span data-ttu-id="5b2c9-154">この方法では、GridView の例と同様に ObjectDataSource を使用しますが、ObjectDataSource s パラメーターを設定し、その `Update()` メソッドを呼び出すために、DataList s `UpdateCommand` イベントのイベントハンドラーを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-154">With this approach, we use an ObjectDataSource just like in the GridView examples, but must create an event handler for the DataList s `UpdateCommand` event where we set the ObjectDataSource s parameters and call its `Update()` method.</span></span>
3. <span data-ttu-id="5b2c9-155">オプション2を使用するときに、 **ObjectDataSource コントロールを選択するときに ObjectDataSource コントロールを使用して、BLL に対して直接更新および削除**を行う必要があります。そのためには、`UpdateCommand` イベントに少しのコードを記述し、パラメーター値を割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-155">**Using an ObjectDataSource Control for Selecting, but Updating and Deleting Directly Against the BLL** when using option 2, we need to write a bit of code in the `UpdateCommand` event, assigning parameter values and so on.</span></span> <span data-ttu-id="5b2c9-156">代わりに、ObjectDataSource を選択に使用してもかまいませんが、更新と削除の呼び出しを BLL に対して直接行うことができます (オプション1など)。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-156">Instead, we can stick with using the ObjectDataSource for selecting, but make the updating and deleting calls directly against the BLL (like with option 1).</span></span> <span data-ttu-id="5b2c9-157">私の意見では、BLL に直接インターフェイスを使用してデータを更新することにより、ObjectDataSource を `UpdateParameters` し、その `Update()` メソッドを呼び出すよりも読みやすいコードになります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-157">In my opinion, updating data by interfacing directly with the BLL leads to more readable code than assigning the ObjectDataSource s `UpdateParameters` and calling its `Update()` method.</span></span>
4. <span data-ttu-id="5b2c9-158">**複数の ObjectDataSources ソースを介して宣言型の意味を使用**する前の3つの方法では、すべてのコードが必要になります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-158">**Using Declarative Means through Multiple ObjectDataSources** the previous three approaches all require a bit of code.</span></span> <span data-ttu-id="5b2c9-159">可能な限り多くの宣言型の構文を使用する場合は、最後のオプションとして、ページに複数の ObjectDataSources ソースを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-159">If you d rather keep using as much declarative syntax as possible, a final option is to include multiple ObjectDataSources on the page.</span></span> <span data-ttu-id="5b2c9-160">最初の ObjectDataSource は、BLL からデータを取得し、それを DataList にバインドします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-160">The first ObjectDataSource retrieves the data from the BLL and binds it to the DataList.</span></span> <span data-ttu-id="5b2c9-161">更新の場合、別の ObjectDataSource が追加されますが、DataList s `EditItemTemplate`内に直接追加されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-161">For updating, another ObjectDataSource is added, but added directly within the DataList s `EditItemTemplate`.</span></span> <span data-ttu-id="5b2c9-162">削除のサポートを含めるには、`ItemTemplate`でもう1つの ObjectDataSource が必要になります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-162">To include deleting support, yet another ObjectDataSource would be needed in the `ItemTemplate`.</span></span> <span data-ttu-id="5b2c9-163">この方法では、これらの埋め込み ObjectDataSource は `ControlParameters` を使用して、ObjectDataSource s パラメーターをユーザー入力コントロールに宣言によってバインドします (DataList s `UpdateCommand` イベントハンドラーでプログラムによって指定する必要はありません)。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-163">With this approach, these embedded ObjectDataSource s use `ControlParameters` to declaratively bind the ObjectDataSource s parameters to the user input controls (rather than having to specify them programmatically in the DataList s `UpdateCommand` event handler).</span></span> <span data-ttu-id="5b2c9-164">この方法では、埋め込み ObjectDataSource `Update()` または `Delete()` コマンドを呼び出す必要がありますが、他の3つの方法よりもはるかに少ないコードが必要です。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-164">This approach still requires a bit of code we need to call the embedded ObjectDataSource s `Update()` or `Delete()` command but requires far less than with the other three approaches.</span></span> <span data-ttu-id="5b2c9-165">ここでの欠点は、複数の ObjectDataSources がページを見やすくし、全体的に読みやすさを向上させることです。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-165">The downside here is that the multiple ObjectDataSources do clutter up the page, detracting from the overall readability.</span></span>

<span data-ttu-id="5b2c9-166">これらの方法のいずれかのみを使用するように強制する場合は、オプション1を選択します。これは、最も柔軟性が高く、DataList がもともとこのパターンに対応するように設計されているためです。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-166">If forced to only ever use one of these approaches, I d choose option 1 because it provides the most flexibility and because the DataList was originally designed to accommodate this pattern.</span></span> <span data-ttu-id="5b2c9-167">DataList は、ASP.NET 2.0 データソースコントロールで動作するように拡張されましたが、公式の ASP.NET 2.0 データ Web コントロール (GridView、DetailsView、FormView) のすべての機能拡張ポイントまたは機能を備えていません。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-167">While the DataList was extended to work with the ASP.NET 2.0 data source controls, it does not have all of the extensibility points or features of the official ASP.NET 2.0 data Web controls (the GridView, DetailsView, and FormView).</span></span> <span data-ttu-id="5b2c9-168">ただし、オプション 2 ~ 4 は、メリットがありません。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-168">Options 2 through 4 are not without merit, though.</span></span>

<span data-ttu-id="5b2c9-169">このチュートリアルと今後の編集と削除のチュートリアルでは、表示するデータを取得するために ObjectDataSource を使用し、データを更新および削除するために BLL に直接呼び出します (オプション 3)。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-169">This and the future editing and deleting tutorials will use an ObjectDataSource for retrieving the data to display and direct calls to the BLL to update and delete data (option 3).</span></span>

## <a name="step-3-adding-the-datalist-and-configuring-its-objectdatasource"></a><span data-ttu-id="5b2c9-170">手順 3: DataList を追加し、ObjectDataSource を構成する</span><span class="sxs-lookup"><span data-stu-id="5b2c9-170">Step 3: Adding the DataList and Configuring its ObjectDataSource</span></span>

<span data-ttu-id="5b2c9-171">このチュートリアルでは、製品情報を一覧表示する DataList を作成します。製品ごとに、ユーザーは、名前と価格を編集したり、製品を削除することができます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-171">In this tutorial we will create a DataList that lists product information and, for each product, provides the user the ability to edit the name and price and to delete the product altogether.</span></span> <span data-ttu-id="5b2c9-172">特に、ObjectDataSource を使用して表示するレコードを取得しますが、BLL と直接やり取りすることで update アクションと delete アクションを実行します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-172">In particular, we will retrieve the records to display using an ObjectDataSource, but perform the update and delete actions by interfacing directly with the BLL.</span></span> <span data-ttu-id="5b2c9-173">DataList に編集機能と削除機能を実装することを心配する前に、まず、読み取り専用インターフェイスに製品を表示するページを取得してみましょう。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-173">Before we worry about implementing the editing and deleting capabilities to the DataList, let s first get the page to display the products in a read-only interface.</span></span> <span data-ttu-id="5b2c9-174">前のチュートリアルでこれらの手順を確認したので、これらの手順をすぐに進めていきます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-174">Since we ve examined these steps in previous tutorials, I'll proceed through them quickly.</span></span>

<span data-ttu-id="5b2c9-175">まず、`EditDeleteDataList` フォルダーの [`Basics.aspx`] ページを開いて、デザインビューからページに DataList を追加します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-175">Start by opening the `Basics.aspx` page in the `EditDeleteDataList` folder and, from the Design view, add a DataList to the page.</span></span> <span data-ttu-id="5b2c9-176">次に、DataList s スマートタグから新しい ObjectDataSource を作成します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-176">Next, from the DataList s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="5b2c9-177">ここでは、製品データを操作しているため、`ProductsBLL` クラスを使用するように構成します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-177">Since we are working with product data, configure it to use the `ProductsBLL` class.</span></span> <span data-ttu-id="5b2c9-178">*すべて*の製品を取得するには、[選択] タブで `GetProducts()` 方法を選択します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-178">To retrieve *all* products, choose the `GetProducts()` method in the SELECT tab.</span></span>

<span data-ttu-id="5b2c9-179">[製品の Bll クラスを使用するように ObjectDataSource を構成 ![には](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-179">[![Configure the ObjectDataSource to Use the ProductsBLL Class](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image6.png)</span></span>

<span data-ttu-id="5b2c9-180">**図 4**: `ProductsBLL` クラスを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="5b2c9-180">**Figure 4**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image8.png))</span></span>

<span data-ttu-id="5b2c9-181">[GetProducts () メソッドを使用して製品情報を返す ![](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-181">[![Return the Product Information Using the GetProducts() Method](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image9.png)</span></span>

<span data-ttu-id="5b2c9-182">**図 5**: `GetProducts()` メソッドを使用して製品情報を返す ([クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image11.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-182">**Figure 5**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image11.png))</span></span>

<span data-ttu-id="5b2c9-183">GridView と同様に、DataList は新しいデータを挿入するように設計されていません。そのため、[挿入] タブのドロップダウンリストから [(なし)] オプションを選択します。また、[更新] タブと [削除] タブの [(なし)] を選択します。これは、更新プログラムと削除が BLL を通じてプログラムによって実行されるためです。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-183">The DataList, like the GridView, is not designed for inserting new data; therefore, select the (None) option from the drop-down list in the INSERT tab. Also choose (None) for the UPDATE and DELETE tabs since the updates and deletes will be performed programmatically through the BLL.</span></span>

<span data-ttu-id="5b2c9-184">[[ObjectDataSource s INSERT]、[UPDATE]、[DELETE] の各タブのドロップダウンリストが [(なし)] に設定されていることを ![確認します。](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-184">[![Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image12.png)</span></span>

<span data-ttu-id="5b2c9-185">**図 6**: ObjectDataSource s の [挿入]、[更新]、および [削除] の各タブのドロップダウンリストが [(なし)] に設定されていることを確認[する (クリックしてフルサイズの画像を表示する](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="5b2c9-185">**Figure 6**: Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None) ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image14.png))</span></span>

<span data-ttu-id="5b2c9-186">ObjectDataSource を構成したら、[完了] をクリックしてデザイナーに戻ります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-186">After configuring the ObjectDataSource, click Finish, returning to the Designer.</span></span> <span data-ttu-id="5b2c9-187">前の例で説明したように、ObjectDataSource 構成を完了すると、Visual Studio によって DropDownList の `ItemTemplate` が自動的に作成され、各データフィールドが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-187">As we ve seen in past examples, when completing the ObjectDataSource configuration, Visual Studio automatically creates an `ItemTemplate` for the DropDownList, displaying each of the data fields.</span></span> <span data-ttu-id="5b2c9-188">この `ItemTemplate` を、製品の名前と価格だけを表示するものに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-188">Replace this `ItemTemplate` with one that displays only the product s name and price.</span></span> <span data-ttu-id="5b2c9-189">また、`RepeatColumns` プロパティを2に設定します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-189">Also, set the `RepeatColumns` property to 2.</span></span>

> [!NOTE]
> <span data-ttu-id="5b2c9-190">*データの挿入、更新、削除の概要*に関するチュートリアルで説明したように、objectdatasource のアーキテクチャを使用してデータを変更する場合は、objectdatasource s 宣言マークアップから `OldValuesParameterFormatString` プロパティを削除する必要があります (または、既定値の `{0}`)。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-190">As discussed in the *Overview of Inserting, Updating, and Deleting Data* tutorial, when modifying data using the ObjectDataSource our architecture requires that we remove the `OldValuesParameterFormatString` property from the ObjectDataSource s declarative markup (or reset it to its default value, `{0}`).</span></span> <span data-ttu-id="5b2c9-191">ただし、このチュートリアルでは、データの取得に ObjectDataSource のみを使用しています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-191">In this tutorial, however, we are using the ObjectDataSource only for retrieving data.</span></span> <span data-ttu-id="5b2c9-192">したがって、ObjectDataSource s `OldValuesParameterFormatString` のプロパティ値を変更する必要はありません (ただし、これには害がありません)。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-192">Therefore, we do not need to modify the ObjectDataSource s `OldValuesParameterFormatString` property value (although it doesn t hurt to do so).</span></span>

<span data-ttu-id="5b2c9-193">既定の DataList `ItemTemplate` をカスタマイズされたものに置き換えると、ページ上の宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-193">After replacing the default DataList `ItemTemplate` with a customized one, the declarative markup on your page should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample2.aspx)]

<span data-ttu-id="5b2c9-194">ブラウザーで進行状況を確認してください。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-194">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="5b2c9-195">図7に示すように、DataList は各製品の製品名と単価を2つの列に表示します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-195">As Figure 7 shows, the DataList displays the product name and unit price for each product in two columns.</span></span>

<span data-ttu-id="5b2c9-196">[製品の名前と価格が2列の DataList に表示される ![](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-196">[![The Products Names and Prices are Displayed in a Two-Column DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image15.png)</span></span>

<span data-ttu-id="5b2c9-197">**図 7**: 製品名と価格が2列の DataList で表示される ([クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image17.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-197">**Figure 7**: The Products Names and Prices are Displayed in a Two-Column DataList ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image17.png))</span></span>

> [!NOTE]
> <span data-ttu-id="5b2c9-198">DataList には、更新および削除プロセスに必要ないくつかのプロパティがあり、これらの値はビューステートに格納されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-198">The DataList has a number of properties that are required for the updating and deleting process, and these values are stored in view state.</span></span> <span data-ttu-id="5b2c9-199">そのため、データの編集または削除をサポートする DataList を構築する場合は、DataList s ビューステートが有効になっていることが重要です。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-199">Therefore, when building a DataList that supports editing or deleting data, it is essential that the DataList s view state be enabled.</span></span>  
>   
> <span data-ttu-id="5b2c9-200">ずる賢い reader は、編集可能な GridViews、の [表示] ビュー、および [FormViews] を作成するときに、ビューステートを無効にできることを思い出している可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-200">The astute reader may recall that we were able to disable view state when creating editable GridViews, DetailsViews, and FormViews.</span></span> <span data-ttu-id="5b2c9-201">これは、ASP.NET 2.0 Web コントロールには、ビューステートなどのポストバック間で保持される状態である*コントロールの状態*を含めることができますが、これは必須であると見なされるためです。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-201">This is because ASP.NET 2.0 Web controls can include *control state*, which is state persisted across postbacks like view state, but deemed essential.</span></span>

<span data-ttu-id="5b2c9-202">GridView のビューステートを無効にすると、単純な状態情報が省略されますが、コントロールの状態 (編集および削除に必要な状態を含む) は維持されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-202">Disabling view state in the GridView merely omits trivial state information, but maintains the control state (which includes the state necessary for editing and deleting).</span></span> <span data-ttu-id="5b2c9-203">ASP.NET 1.x 時間枠で作成された DataList はコントロールの状態を利用しないため、ビューステートが有効になっている必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-203">The DataList, having been created in the ASP.NET 1.x timeframe, does not utilize control state and therefore must have view state enabled.</span></span> <span data-ttu-id="5b2c9-204">制御状態とビューステートの違いの詳細については、「コントロールの状態と[ビューステート](https://msdn.microsoft.com/library/1whwt1k7.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-204">See [Control State vs. View State](https://msdn.microsoft.com/library/1whwt1k7.aspx) for more information on the purpose of control state and how it differs from view state.</span></span>

## <a name="step-4-adding-an-editing-user-interface"></a><span data-ttu-id="5b2c9-205">手順 4: 編集ユーザーインターフェイスを追加する</span><span class="sxs-lookup"><span data-stu-id="5b2c9-205">Step 4: Adding an Editing User Interface</span></span>

<span data-ttu-id="5b2c9-206">GridView コントロールは、フィールド (BoundFields、CheckBoxFields、TemplateFields など) のコレクションで構成されています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-206">The GridView control is composed of a collection of fields (BoundFields, CheckBoxFields, TemplateFields, and so on).</span></span> <span data-ttu-id="5b2c9-207">これらのフィールドは、表示されているマークアップをモードに応じて調整できます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-207">These fields can adjust their rendered markup depending on their mode.</span></span> <span data-ttu-id="5b2c9-208">たとえば、読み取り専用モードの場合、BoundField はデータフィールドの値をテキストとして表示します。編集モードの場合は、`Text` プロパティにデータフィールド値が割り当てられている TextBox Web コントロールがレンダリングされます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-208">For example, when in read-only mode, a BoundField displays its data field value as text; when in edit mode, it renders a TextBox Web control whose `Text` property is assigned the data field value.</span></span>

<span data-ttu-id="5b2c9-209">一方、DataList は、テンプレートを使用して項目をレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-209">The DataList, on the other hand, renders its items using templates.</span></span> <span data-ttu-id="5b2c9-210">読み取り専用の項目は `ItemTemplate` を使用してレンダリングされますが、編集モードの項目は `EditItemTemplate`によってレンダリングされます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-210">Read-only items are rendered using the `ItemTemplate` whereas items in edit mode are rendered via the `EditItemTemplate`.</span></span> <span data-ttu-id="5b2c9-211">この時点で、DataList には `ItemTemplate`のみが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-211">At this point, our DataList has only an `ItemTemplate`.</span></span> <span data-ttu-id="5b2c9-212">項目レベルの編集機能をサポートするには、編集可能な項目に対して表示されるマークアップを含む `EditItemTemplate` を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-212">To support item-level editing functionality we need to add an `EditItemTemplate` that contains the markup to be displayed for the editable item.</span></span> <span data-ttu-id="5b2c9-213">このチュートリアルでは、テキストボックス Web コントロールを使用して、製品の名前と単価を編集します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-213">For this tutorial, we'll use TextBox Web controls for editing the product s name and unit price.</span></span>

<span data-ttu-id="5b2c9-214">`EditItemTemplate` は、宣言によって、またはデザイナーを使用して作成できます (DataList s スマートタグの [テンプレートの編集] オプションを選択します)。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-214">The `EditItemTemplate` can be created either declaratively or through the Designer (by selecting the Edit Templates option from the DataList s smart tag).</span></span> <span data-ttu-id="5b2c9-215">[テンプレートの編集] オプションを使用するには、まずスマートタグの [テンプレートの編集] リンクをクリックし、ドロップダウンリストから `EditItemTemplate` 項目を選択します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-215">To use the Edit Templates option, first click the Edit Templates link in the smart tag and then select the `EditItemTemplate` item from the drop-down list.</span></span>

<span data-ttu-id="5b2c9-216">[![DataList s EditItemTemplate を使用することを選択します。](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-216">[![Opt to Work with the DataList s EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image18.png)</span></span>

<span data-ttu-id="5b2c9-217">**図 8**: DataList s `EditItemTemplate` を使用することを選択する ([クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image20.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-217">**Figure 8**: Opt to Work with the DataList s `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image20.png))</span></span>

<span data-ttu-id="5b2c9-218">次に、[Product name:] と [Price] を入力します。次に、ツールボックスから2つのテキストボックスコントロールをデザイナーの `EditItemTemplate` インターフェイスにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-218">Next, type in Product name: and Price: and then drag two TextBox controls from the Toolbox into the `EditItemTemplate` interface on the Designer.</span></span> <span data-ttu-id="5b2c9-219">テキストボックス `ID` プロパティを `ProductName` と `UnitPrice`に設定します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-219">Set the TextBoxes `ID` properties to `ProductName` and `UnitPrice`.</span></span>

<span data-ttu-id="5b2c9-220">[製品の名前と価格のテキストボックスを追加 ![には](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-220">[![Add a TextBox for the Product s Name and Price](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image21.png)</span></span>

<span data-ttu-id="5b2c9-221">**図 9**: 製品名と価格のテキストボックスを追加する ([クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image23.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-221">**Figure 9**: Add a TextBox for the Product s Name and Price ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image23.png))</span></span>

<span data-ttu-id="5b2c9-222">対応する製品データフィールドの値を、2つのテキストボックスの `Text` プロパティにバインドする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-222">We need to bind the corresponding product data field values to the `Text` properties of the two TextBoxes.</span></span> <span data-ttu-id="5b2c9-223">図10に示すように、テキストボックスのスマートタグから、[データバインディングの編集] リンクをクリックし、適切なデータフィールドを `Text` プロパティに関連付けます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-223">From the TextBoxes smart tags, click on the Edit DataBindings link and then associate the appropriate data field with the `Text` property, as shown in Figure 10.</span></span>

> [!NOTE]
> <span data-ttu-id="5b2c9-224">`UnitPrice` データフィールドを price TextBox s `Text` フィールドにバインドする場合は、通貨値 (`{0:C}`)、一般数値 (`{0:N}`) として書式設定するか、または書式設定しないままにすることができます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-224">When binding the `UnitPrice` data field to the price TextBox s `Text` field, you may format it as a currency value (`{0:C}`), a general number (`{0:N}`), or leave it unformatted.</span></span>

![ProductName および UnitPrice データフィールドをテキストボックスのテキストプロパティにバインドする](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image24.png)

<span data-ttu-id="5b2c9-226">**図 10**: `ProductName` と `UnitPrice` のデータフィールドをテキストボックスの `Text` プロパティにバインドする</span><span class="sxs-lookup"><span data-stu-id="5b2c9-226">**Figure 10**: Bind the `ProductName` and `UnitPrice` Data Fields to the `Text` Properties of the TextBoxes</span></span>

<span data-ttu-id="5b2c9-227">図10の [データ連結の編集] ダイアログボックスには、GridView または DetailsView で TemplateField を編集するときに存在する双方向のデータバインドチェックボックス、または FormView 内のテンプレートが含ま*れていない*ことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-227">Notice how the Edit DataBindings dialog box in Figure 10 does *not* include the Two-way databinding checkbox that is present when editing a TemplateField in the GridView or DetailsView, or a template in the FormView.</span></span> <span data-ttu-id="5b2c9-228">双方向のデータバインディング機能では、入力 Web コントロールに入力された値が、データを挿入または更新するときに、対応する ObjectDataSource s `InsertParameters` または `UpdateParameters` に自動的に割り当てられるようになりました。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-228">The two-way databinding feature allowed the value entered into the input Web control to be automatically assigned to the corresponding ObjectDataSource s `InsertParameters` or `UpdateParameters` when inserting or updating data.</span></span> <span data-ttu-id="5b2c9-229">DataList は、このチュートリアルで後ほど説明するように、双方向のデータバインディングをサポートしていません。ユーザーが変更を加えてデータを更新する準備ができたら、プログラムを使用してこれらのテキスト `Text` ボックスにアクセスし、その値を `ProductsBLL` クラスの適切な `UpdateProduct` メソッドに渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-229">The DataList does not support two-way databinding as we'll see later on in this tutorial, after the user makes her changes and is ready to update the data, we will need to programmatically access these TextBoxes `Text` properties and pass in their values to the appropriate `UpdateProduct` method in the `ProductsBLL` class.</span></span>

<span data-ttu-id="5b2c9-230">最後に、[更新] ボタンと [キャンセル] ボタンを `EditItemTemplate`に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-230">Finally, we need to add Update and Cancel buttons to the `EditItemTemplate`.</span></span> <span data-ttu-id="5b2c9-231">[詳細な DataList チュートリアルを含むマスターレコードの箇条書きリストを使用してマスター/詳細](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)を確認しましたが、`CommandName` プロパティが設定されているボタン、LinkButton、または ImageButton が repeater または datalist 内からクリックされると、repeater または datalist s `ItemCommand` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-231">As we saw in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial, when a Button, LinkButton, or ImageButton whose `CommandName` property is set is clicked from within a Repeater or DataList, the Repeater or DataList s `ItemCommand` event is raised.</span></span> <span data-ttu-id="5b2c9-232">DataList の場合、`CommandName` プロパティが特定の値に設定されていると、追加のイベントも発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-232">For the DataList, if the `CommandName` property is set to a certain value, an additional event may be raised as well.</span></span> <span data-ttu-id="5b2c9-233">特別な `CommandName` プロパティ値には、次のようなものがあります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-233">The special `CommandName` property values include, among others:</span></span>

- <span data-ttu-id="5b2c9-234">Cancel は `CancelCommand` イベントを発生させます</span><span class="sxs-lookup"><span data-stu-id="5b2c9-234">Cancel raises the `CancelCommand` event</span></span>
- <span data-ttu-id="5b2c9-235">Edit は `EditCommand` イベントを発生させます</span><span class="sxs-lookup"><span data-stu-id="5b2c9-235">Edit raises the `EditCommand` event</span></span>
- <span data-ttu-id="5b2c9-236">Update によって `UpdateCommand` イベントが発生します</span><span class="sxs-lookup"><span data-stu-id="5b2c9-236">Update raises the `UpdateCommand` event</span></span>

<span data-ttu-id="5b2c9-237">これらのイベントは、`ItemCommand` イベント*に加え*て発生することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-237">Keep in mind that these events are raised *in addition to* the `ItemCommand` event.</span></span>

<span data-ttu-id="5b2c9-238">`CommandName` を更新するように設定し、もう一方をキャンセルに設定して、2つのボタンの Web コントロール `EditItemTemplate` に追加します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-238">Add to the `EditItemTemplate` two Button Web controls, one whose `CommandName` is set to Update and the other s set to Cancel.</span></span> <span data-ttu-id="5b2c9-239">これらの2つのボタン Web コントロールを追加すると、デザイナーは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-239">After adding these two Button Web controls the Designer should look similar to the following:</span></span>

<span data-ttu-id="5b2c9-240">[EditItemTemplate に [Update] ボタンと [Cancel] ボタンを追加 ![には](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-240">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image25.png)</span></span>

<span data-ttu-id="5b2c9-241">**図 11**: [更新] ボタンと [キャンセル] ボタンを `EditItemTemplate` に追加[する (クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image27.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-241">**Figure 11**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image27.png))</span></span>

<span data-ttu-id="5b2c9-242">`EditItemTemplate` 完了すると、DataList s 宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-242">With the `EditItemTemplate` complete your DataList s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample3.aspx)]

## <a name="step-5-adding-the-plumbing-to-enter-edit-mode"></a><span data-ttu-id="5b2c9-243">手順 5: 編集モードにするには、プラミングを追加します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-243">Step 5: Adding the Plumbing to Enter Edit Mode</span></span>

<span data-ttu-id="5b2c9-244">この時点で、DataList には `EditItemTemplate`を介して定義された編集インターフェイスがあります。ただし、現在のところ、ユーザーが製品の情報を編集することを示すためにページにアクセスする方法はありません。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-244">At this point our DataList has an editing interface defined via its `EditItemTemplate`; however, there s currently no way for a user visiting our page to indicate that he wants to edit a product s information.</span></span> <span data-ttu-id="5b2c9-245">[編集] ボタンを各製品に追加する必要があります。このボタンをクリックすると、DataList 項目が編集モードで表示されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-245">We need to add an Edit button to each product that, when clicked, renders that DataList item in edit mode.</span></span> <span data-ttu-id="5b2c9-246">まず、デザイナーを使用するか、宣言によって `ItemTemplate`に [編集] ボタンを追加します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-246">Start by adding an Edit button to the `ItemTemplate`, either through the Designer or declaratively.</span></span> <span data-ttu-id="5b2c9-247">[Edit button s `CommandName`] プロパティを Edit に設定してください。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-247">Be certain to set the Edit button s `CommandName` property to Edit .</span></span>

<span data-ttu-id="5b2c9-248">この編集ボタンを追加した後、ブラウザーを使用してページを表示します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-248">After you have added this Edit button, take a moment to view the page through a browser.</span></span> <span data-ttu-id="5b2c9-249">この追加では、各製品の一覧に [編集] ボタンが含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-249">With this addition, each product listing should include an Edit button.</span></span>

<span data-ttu-id="5b2c9-250">[EditItemTemplate に [Update] ボタンと [Cancel] ボタンを追加 ![には](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-250">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image28.png)</span></span>

<span data-ttu-id="5b2c9-251">**図 12**: [更新] ボタンと [キャンセル] ボタンを `EditItemTemplate` に追加[する (クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image30.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-251">**Figure 12**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image30.png))</span></span>

<span data-ttu-id="5b2c9-252">このボタンをクリックするとポストバックが発生しますが、製品リストが編集モードになる*ことはありません*。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-252">Clicking the button causes a postback, but does *not* bring the product listing into edit mode.</span></span> <span data-ttu-id="5b2c9-253">製品を編集可能にするには、次のことを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-253">To make the product editable, we need to:</span></span>

1. <span data-ttu-id="5b2c9-254">[DataList s [`EditItemIndex`] プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)を、[編集] ボタンがクリックされた `DataListItem` のインデックスに設定します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-254">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of the `DataListItem` whose Edit button was just clicked.</span></span>
2. <span data-ttu-id="5b2c9-255">データを DataList に再バインドします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-255">Rebind the data to the DataList.</span></span> <span data-ttu-id="5b2c9-256">DataList を再描画すると、`ItemIndex` が DataList s `EditItemIndex` に対応する `DataListItem` が、その `EditItemTemplate`を使用して表示されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-256">When the DataList is re-rendered, the `DataListItem` whose `ItemIndex` corresponds with the DataList s `EditItemIndex` will render using its `EditItemTemplate`.</span></span>

<span data-ttu-id="5b2c9-257">[編集] ボタンをクリックすると DataList s `EditCommand` イベントが発生するため、次のコードを使用して `EditCommand` イベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-257">Since the DataList s `EditCommand` event is fired when the Edit button is clicked, create an `EditCommand` event handler with the following code:</span></span>

[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample4.cs)]

<span data-ttu-id="5b2c9-258">`EditCommand` イベントハンドラーは、`DataListCommandEventArgs` 型のオブジェクトで2番目の入力パラメーターとして渡されます。これには、Edit ボタンがクリックされた (`e.Item`) `DataListItem` への参照が含まれます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-258">The `EditCommand` event handler is passed in an object of type `DataListCommandEventArgs` as its second input parameter, which includes a reference to the `DataListItem` whose Edit button was clicked (`e.Item`).</span></span> <span data-ttu-id="5b2c9-259">イベントハンドラーは、最初に DataList s `EditItemIndex` を編集可能な `DataListItem` の `ItemIndex` に設定し、DataList s `DataBind()` メソッドを呼び出すことによってデータを DataList に再バインドします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-259">The event handler first sets the DataList s `EditItemIndex` to the `ItemIndex` of the editable `DataListItem` and then rebinds the data to the DataList by calling the DataList s `DataBind()` method.</span></span>

<span data-ttu-id="5b2c9-260">このイベントハンドラーを追加した後、ブラウザーでページを再度参照してください。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-260">After adding this event handler, revisit the page in a browser.</span></span> <span data-ttu-id="5b2c9-261">[編集] ボタンをクリックすると、クリックした製品が編集可能になります (図13を参照)。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-261">Clicking the Edit button now makes the clicked product editable (see Figure 13).</span></span>

<span data-ttu-id="5b2c9-262">[[編集] ボタンをクリック ![と、製品が編集可能になります](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-262">[![Clicking the Edit Button Makes the Product Editable](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image31.png)</span></span>

<span data-ttu-id="5b2c9-263">**図 13**: [編集] ボタンをクリックすると、製品が編集可能になります ([クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image33.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-263">**Figure 13**: Clicking the Edit Button Makes the Product Editable ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image33.png))</span></span>

## <a name="step-6-saving-the-user-s-changes"></a><span data-ttu-id="5b2c9-264">手順 6: ユーザーの変更を保存する</span><span class="sxs-lookup"><span data-stu-id="5b2c9-264">Step 6: Saving the User s Changes</span></span>

<span data-ttu-id="5b2c9-265">編集した製品の [更新] ボタンまたは [キャンセル] ボタンをクリックしても、この時点では何も行われません。この機能を追加するには、DataList s `UpdateCommand` イベントと `CancelCommand` イベントのイベントハンドラーを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-265">Clicking the edited product s Update or Cancel buttons does nothing at this point; to add this functionality we need to create event handlers for the DataList s `UpdateCommand` and `CancelCommand` events.</span></span> <span data-ttu-id="5b2c9-266">まず、`CancelCommand` イベントハンドラーを作成します。このハンドラーは、編集した製品の [キャンセル] ボタンがクリックされたときに実行され、DataList を編集前の状態に戻します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-266">Start by creating the `CancelCommand` event handler, which will execute when the edited product s Cancel button is clicked and it tasked with returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="5b2c9-267">DataList が読み取り専用モードですべての項目を表示するには、次のことを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-267">To have the DataList render all of its items in the read-only mode, we need to:</span></span>

1. <span data-ttu-id="5b2c9-268">DataList s [`EditItemIndex` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)に、存在しない `DataListItem` インデックスのインデックスを設定します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-268">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="5b2c9-269">`DataListItem` インデックスは `0`から開始されるため、`-1` は安全な選択肢です。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-269">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
2. <span data-ttu-id="5b2c9-270">データを DataList に再バインドします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-270">Rebind the data to the DataList.</span></span> <span data-ttu-id="5b2c9-271">`DataListItem` `ItemIndex` es が DataList s `EditItemIndex`に対応していないため、DataList 全体が読み取り専用モードで表示されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-271">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="5b2c9-272">これらの手順は、次のイベントハンドラーコードを使用して実行できます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-272">These steps can be accomplished with the following event handler code:</span></span>

[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample5.cs)]

<span data-ttu-id="5b2c9-273">この追加により、[キャンセル] ボタンをクリックすると、DataList が編集前の状態に戻ります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-273">With this addition, clicking the Cancel button returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="5b2c9-274">最後に完了する必要があるイベントハンドラーは、`UpdateCommand` イベントハンドラーです。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-274">The last event handler we need to complete is the `UpdateCommand` event handler.</span></span> <span data-ttu-id="5b2c9-275">このイベントハンドラーは次のことを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-275">This event handler needs to:</span></span>

1. <span data-ttu-id="5b2c9-276">ユーザーが入力した製品名と価格だけでなく、編集した製品 `ProductID`にプログラムによってアクセスします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-276">Programmatically access the user-entered product name and price as well as the edited product s `ProductID`.</span></span>
2. <span data-ttu-id="5b2c9-277">`ProductsBLL` クラスで適切な `UpdateProduct` オーバーロードを呼び出して、更新プロセスを開始します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-277">Initiate the update process by calling the appropriate `UpdateProduct` overload in the `ProductsBLL` class.</span></span>
3. <span data-ttu-id="5b2c9-278">DataList s [`EditItemIndex` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)に、存在しない `DataListItem` インデックスのインデックスを設定します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-278">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="5b2c9-279">`DataListItem` インデックスは `0`から開始されるため、`-1` は安全な選択肢です。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-279">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
4. <span data-ttu-id="5b2c9-280">データを DataList に再バインドします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-280">Rebind the data to the DataList.</span></span> <span data-ttu-id="5b2c9-281">`DataListItem` `ItemIndex` es が DataList s `EditItemIndex`に対応していないため、DataList 全体が読み取り専用モードで表示されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-281">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="5b2c9-282">手順 1. と 2. では、ユーザーの変更を保存します。手順 3. および 4. では、変更が保存された後に、DataList が編集前の状態に戻り、`CancelCommand` イベントハンドラーで実行した手順と同じになります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-282">Steps 1 and 2 are responsible for saving the user s changes; steps 3 and 4 return the DataList to its pre-editing state after the changes have been saved and are identical to the steps performed in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="5b2c9-283">更新された製品名と価格を取得するには、`FindControl` メソッドを使用して、`EditItemTemplate`内のテキストボックス Web コントロールをプログラムで参照する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-283">To get the updated product name and price, we need to use the `FindControl` method to programmatically reference the TextBox Web controls within the `EditItemTemplate`.</span></span> <span data-ttu-id="5b2c9-284">また、編集した製品の `ProductID` 値を取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-284">We also need to get the edited product s `ProductID` value.</span></span> <span data-ttu-id="5b2c9-285">最初に ObjectDataSource を DataList にバインドしたときに、Visual Studio によって、データソースからの主キーの値 (`ProductID`) に DataList s `DataKeyField` プロパティが割り当てられています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-285">When we initially bound the ObjectDataSource to the DataList, Visual Studio assigned the DataList s `DataKeyField` property to the primary key value from the data source (`ProductID`).</span></span> <span data-ttu-id="5b2c9-286">この値は、DataList s `DataKeys` コレクションから取得できます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-286">This value can then be retrieved from the DataList s `DataKeys` collection.</span></span> <span data-ttu-id="5b2c9-287">`DataKeyField` プロパティが実際に `ProductID`に設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-287">Take a moment to ensure that the `DataKeyField` property is indeed set to `ProductID`.</span></span>

<span data-ttu-id="5b2c9-288">次のコードは、4つの手順を実装しています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-288">The following code implements the four steps:</span></span>

[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="5b2c9-289">イベントハンドラーは、`DataKeys` コレクションから編集された製品の `ProductID` を読み取って開始します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-289">The event handler starts by reading in the edited product s `ProductID` from the `DataKeys` collection.</span></span> <span data-ttu-id="5b2c9-290">次に、`EditItemTemplate` 内の2つのテキストボックスが参照され、`Text` のプロパティがローカル変数である `productNameValue` および `unitPriceValue`に格納されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-290">Next, the two TextBoxes in the `EditItemTemplate` are referenced and their `Text` properties stored in local variables, `productNameValue` and `unitPriceValue`.</span></span> <span data-ttu-id="5b2c9-291">`Decimal.Parse()` メソッドを使用して `UnitPrice` テキストボックスから値を読み取って、入力された値が通貨記号を持っている場合でも、適切に `Decimal` 値に変換できるようにします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-291">We use the `Decimal.Parse()` method to read the value from the `UnitPrice` TextBox so that if the value entered has a currency symbol, it can still be correctly converted into a `Decimal` value.</span></span>

> [!NOTE]
> <span data-ttu-id="5b2c9-292">[`ProductName`] ボックスと [`UnitPrice`] ボックスの値は、テキストボックスのテキストプロパティに値が指定されている場合にのみ、productNameValue 変数と unitPriceValue 変数に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-292">The values from the `ProductName` and `UnitPrice` TextBoxes are only assigned to the productNameValue and unitPriceValue variables if the TextBoxes Text properties have a value specified.</span></span> <span data-ttu-id="5b2c9-293">それ以外の場合、`Nothing` の値が変数に使用されます。これにより、データベース `NULL` 値を使用してデータを更新する効果があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-293">Otherwise, a value of `Nothing` is used for the variables, which has the effect of updating the data with a database `NULL` value.</span></span> <span data-ttu-id="5b2c9-294">つまり、このコードでは、空の文字列をデータベース `NULL` の値に変換します。これは、GridView、DetailsView、および FormView コントロールでの編集インターフェイスの既定の動作です。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-294">That is, our code treats converts empty strings to database `NULL` values, which is the default behavior of the editing interface in the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="5b2c9-295">値を読み取った後、`ProductsBLL` クラス s `UpdateProduct` メソッドが呼び出され、製品名、価格、および `ProductID`が渡されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-295">After reading the values, the `ProductsBLL` class s `UpdateProduct` method is called, passing in the product s name, price, and `ProductID`.</span></span> <span data-ttu-id="5b2c9-296">イベントハンドラーは、`CancelCommand` イベントハンドラーとまったく同じロジックを使用して、DataList を編集前の状態に戻して完了します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-296">The event handler completes by returning the DataList to its pre-editing state using the exact same logic as in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="5b2c9-297">`EditCommand`、`CancelCommand`、`UpdateCommand` イベントハンドラーが完了すると、訪問者は製品の名前と価格を編集できます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-297">With the `EditCommand`, `CancelCommand`, and `UpdateCommand` event handlers complete, a visitor can edit the name and price of a product.</span></span> <span data-ttu-id="5b2c9-298">図14-16 は、この編集ワークフローの動作を示しています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-298">Figures 14-16 show this editing workflow in action.</span></span>

<span data-ttu-id="5b2c9-299">[![最初にページにアクセスしたときに、すべての製品が読み取り専用モードになります。](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-299">[![When First Visiting the Page, All Products are in Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image34.png)</span></span>

<span data-ttu-id="5b2c9-300">**図 14**: 最初にページにアクセスしたときに、すべての製品が読み取り専用モードになっている ([クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image36.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-300">**Figure 14**: When First Visiting the Page, All Products are in Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image36.png))</span></span>

<span data-ttu-id="5b2c9-301">[製品の名前または価格を更新 ![には、[編集] ボタンをクリックします。](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-301">[![To Update a Product s Name or Price, Click the Edit Button](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image37.png)</span></span>

<span data-ttu-id="5b2c9-302">**図 15**: 製品名または価格を更新するには、[編集] ボタンをクリックします ([クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image39.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-302">**Figure 15**: To Update a Product s Name or Price, Click the Edit Button ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image39.png))</span></span>

<span data-ttu-id="5b2c9-303">[![値を変更した後、[更新] をクリックして読み取り専用モードに戻ります。](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-303">[![After Changing the Value, Click Update to Return to the Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image40.png)</span></span>

<span data-ttu-id="5b2c9-304">**図 16**: 値を変更した後、[更新] をクリックして読み取り専用モードに戻ります ([クリックすると、フルサイズの画像が表示](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image42.png)されます)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-304">**Figure 16**: After Changing the Value, Click Update to Return to the Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image42.png))</span></span>

## <a name="step-7-adding-delete-capabilities"></a><span data-ttu-id="5b2c9-305">手順 7: 削除機能の追加</span><span class="sxs-lookup"><span data-stu-id="5b2c9-305">Step 7: Adding Delete Capabilities</span></span>

<span data-ttu-id="5b2c9-306">DataList に削除機能を追加する手順は、編集機能を追加する手順と似ています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-306">The steps for adding delete capabilities to a DataList are similar to those for adding editing capabilities.</span></span> <span data-ttu-id="5b2c9-307">つまり、クリックしたときに `ItemTemplate` に [削除] ボタンを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-307">In short, we need to add a Delete button to the `ItemTemplate` that, when clicked:</span></span>

1. <span data-ttu-id="5b2c9-308">`DataKeys` コレクションを使用して、対応する製品の `ProductID` を読み取ります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-308">Reads in the corresponding product s `ProductID` via the `DataKeys` collection.</span></span>
2. <span data-ttu-id="5b2c9-309">`ProductsBLL` クラス s `DeleteProduct` メソッドを呼び出すことによって削除を実行します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-309">Performs the delete by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>
3. <span data-ttu-id="5b2c9-310">データを DataList に再バインドします。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-310">Rebinds the data to the DataList.</span></span>

<span data-ttu-id="5b2c9-311">まず、[削除] ボタンを `ItemTemplate`に追加します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-311">Let s start by adding a Delete button to the `ItemTemplate`.</span></span>

<span data-ttu-id="5b2c9-312">クリックすると、`CommandName` が Edit、Update、または Cancel であるボタンによって、DataList s `ItemCommand` イベントが追加のイベントと共に発生します (たとえば、Edit を使用する場合、`EditCommand` イベントも発生します)。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-312">When clicked, a Button whose `CommandName` is Edit, Update, or Cancel raises the DataList s `ItemCommand` event along with an additional event (for example, when using Edit the `EditCommand` event is raised as well).</span></span> <span data-ttu-id="5b2c9-313">同様に、DataList で `CommandName` プロパティが [削除] に設定されているボタン、LinkButton、または ImageButton は、`DeleteCommand` イベントが発生します (`ItemCommand`)。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-313">Similarly, any Button, LinkButton, or ImageButton in the DataList whose `CommandName` property is set to Delete causes the `DeleteCommand` event to fire (along with `ItemCommand`).</span></span>

<span data-ttu-id="5b2c9-314">`ItemTemplate`の [編集] ボタンの横にある削除ボタンを追加し、その `CommandName` プロパティを [削除] に設定します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-314">Add a Delete button next to the Edit button in the `ItemTemplate`, setting its `CommandName` property to Delete.</span></span> <span data-ttu-id="5b2c9-315">このボタンコントロールを追加した後、`ItemTemplate` の宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-315">After adding this Button control your DataList s `ItemTemplate` declarative syntax should look like:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample7.aspx)]

<span data-ttu-id="5b2c9-316">次に、次のコードを使用して、DataList s `DeleteCommand` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-316">Next, create an event handler for the DataList s `DeleteCommand` event, using the following code:</span></span>

[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="5b2c9-317">[削除] ボタンをクリックすると、ポストバックが発生し、DataList s `DeleteCommand` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-317">Clicking the Delete button causes a postback and fires the DataList s `DeleteCommand` event.</span></span> <span data-ttu-id="5b2c9-318">イベントハンドラーでは、クリックされた product s `ProductID` の値が `DataKeys` コレクションからアクセスされます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-318">In the event handler, the clicked product s `ProductID` value is accessed from the `DataKeys` collection.</span></span> <span data-ttu-id="5b2c9-319">次に、`ProductsBLL` クラス s `DeleteProduct` メソッドを呼び出すことによって、製品が削除されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-319">Next, the product is deleted by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>

<span data-ttu-id="5b2c9-320">製品を削除した後、データを DataList (`DataList1.DataBind()`) に再バインドすることが重要です。そうしないと、削除されたばかりの製品が DataList によって引き続き表示されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-320">After deleting the product, it s important that we rebind the data to the DataList (`DataList1.DataBind()`), otherwise the DataList will continue to show the product that was just deleted.</span></span>

## <a name="summary"></a><span data-ttu-id="5b2c9-321">要約</span><span class="sxs-lookup"><span data-stu-id="5b2c9-321">Summary</span></span>

<span data-ttu-id="5b2c9-322">DataList はポイントを持たないのに対し、GridView によって使用されている編集および削除のサポートはわずかですが、これらの機能を含めるように拡張することができます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-322">While the DataList lacks the point and click editing and deleting support enjoyed by the GridView, with a short bit of code it can be enhanced to include these features.</span></span> <span data-ttu-id="5b2c9-323">このチュートリアルでは、削除して名前と価格を編集できる2列の製品の一覧を作成する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-323">In this tutorial we saw how to create a two-column listing of products that could be deleted and whose name and price could be edited.</span></span> <span data-ttu-id="5b2c9-324">編集と削除のサポートを追加するには、適切な Web コントロールを `ItemTemplate` と `EditItemTemplate`に含め、対応するイベントハンドラーを作成し、ユーザーが入力したキーと主キーの値を読み取り、ビジネスロジック層とやり取りする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-324">Adding editing and deleting support is a matter of including the appropriate Web controls in the `ItemTemplate` and `EditItemTemplate`, creating the corresponding event handlers, reading the user-entered and primary key values, and interfacing with the Business Logic Layer.</span></span>

<span data-ttu-id="5b2c9-325">DataList には基本的な編集機能と削除機能が追加されていますが、高度な機能はありません。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-325">While we have added basic editing and deleting capabilities to the DataList, it lacks more advanced features.</span></span> <span data-ttu-id="5b2c9-326">たとえば、入力フィールドの検証は行われません。ユーザーが高価な価格を入力した場合、`Decimal`に対してコストが高すぎると、`Decimal.Parse` によって例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-326">For example, there is no input field validation - if a user enters a price of Too expensive, an exception will be thrown by `Decimal.Parse` when attempting to convert Too expensive into a `Decimal`.</span></span> <span data-ttu-id="5b2c9-327">同様に、ビジネスロジックまたはデータアクセスレイヤーでデータを更新するときに問題が発生した場合は、標準のエラー画面が表示されます。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-327">Similarly, if there is a problem in updating the data at the Business Logic or Data Access Layers the user will be presented with the standard error screen.</span></span> <span data-ttu-id="5b2c9-328">[削除] ボタンの確認を何も行わないと、誤って製品を削除してしまう可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-328">Without any sort of confirmation on the Delete button, accidentally deleting a product is all too likely.</span></span>

<span data-ttu-id="5b2c9-329">今後のチュートリアルでは、編集中のユーザーエクスペリエンスを向上させる方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-329">In future tutorials we'll see how to improve the editing user experience.</span></span>

<span data-ttu-id="5b2c9-330">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-330">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5b2c9-331">作成者について</span><span class="sxs-lookup"><span data-stu-id="5b2c9-331">About the Author</span></span>

<span data-ttu-id="5b2c9-332">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5b2c9-333">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-333">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5b2c9-334">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-334">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5b2c9-335">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-335">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5b2c9-336">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-336">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="5b2c9-337">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-337">Special Thanks To</span></span>

<span data-ttu-id="5b2c9-338">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-338">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5b2c9-339">このチュートリアルのリードレビュー担当者は、Zack Jones、Ken PRandy Isa、および/Midt でした。</span><span class="sxs-lookup"><span data-stu-id="5b2c9-339">Lead reviewers for this tutorial were Zack Jones, Ken Pespisa, and Randy Schmidt.</span></span> <span data-ttu-id="5b2c9-340">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="5b2c9-340">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5b2c9-341">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5b2c9-341">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="5b2c9-342">次へ</span><span class="sxs-lookup"><span data-stu-id="5b2c9-342">Next</span></span>](performing-batch-updates-cs.md)
