---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs
title: バッチ更新の実行C#() |Microsoft Docs
author: rick-anderson
description: 完全に編集可能な DataList を作成する方法について説明します。すべての項目が編集モードであり、値を保存するには、[すべて更新] ボタンをクリックします。
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 57743ca7-5695-4e07-aed1-44b297f245a9
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs
msc.type: authoredcontent
ms.openlocfilehash: cde12a4d24555216adc49dd02818901278932eaa
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74631582"
---
# <a name="performing-batch-updates-c"></a><span data-ttu-id="f9633-103">バッチ更新を実行する (C#)</span><span class="sxs-lookup"><span data-stu-id="f9633-103">Performing Batch Updates (C#)</span></span>

<span data-ttu-id="f9633-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f9633-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f9633-105">[サンプルアプリのダウンロード](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_CS.exe)または[PDF のダウンロード](performing-batch-updates-cs/_static/datatutorial37cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="f9633-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_CS.exe) or [Download PDF](performing-batch-updates-cs/_static/datatutorial37cs1.pdf)</span></span>

> <span data-ttu-id="f9633-106">すべての項目が編集モードで、ページの [すべて更新] ボタンをクリックして値を保存できる、完全に編集可能な DataList を作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f9633-106">Learn how to create a fully-editable DataList where all of its items are in edit mode and whose values can be saved by clicking an "Update All" button on the page.</span></span>

## <a name="introduction"></a><span data-ttu-id="f9633-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="f9633-107">Introduction</span></span>

<span data-ttu-id="f9633-108">前の[チュートリアル](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)では、項目レベルの DataList を作成する方法を説明しています。</span><span class="sxs-lookup"><span data-stu-id="f9633-108">In the [preceding tutorial](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) we examined how to create an item-level DataList.</span></span> <span data-ttu-id="f9633-109">標準の編集可能な GridView と同様に、DataList の各項目には [編集] ボタンが含まれています。このボタンをクリックすると、項目が編集可能になります。</span><span class="sxs-lookup"><span data-stu-id="f9633-109">Like the standard editable GridView, each item in the DataList included an Edit button that, when clicked, would make the item editable.</span></span> <span data-ttu-id="f9633-110">この項目レベルの編集は、ときどき更新されるデータに対しては有効ですが、特定のユースケースシナリオでは、ユーザーが多くのレコードを編集する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f9633-110">While this item-level editing works well for data that is only updated occasionally, certain use case scenarios require the user to edit many records.</span></span> <span data-ttu-id="f9633-111">ユーザーが多数のレコードを編集する必要があり、[編集] をクリックし、変更を加えて、それぞれの [更新] をクリックする必要がある場合は、クリックすると、その生産性が低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f9633-111">If a user needs to edit dozens of records and is forced to click Edit, make their changes, and click Update for each one, the amount of clicking can hamper her productivity.</span></span> <span data-ttu-id="f9633-112">このような状況では、完全に編集可能な DataList を指定することをお勧めします。これは、*すべて*の項目が編集モードであり、ページ上の [すべて更新] ボタンをクリックして値を編集できる、というものです (図1を参照)。</span><span class="sxs-lookup"><span data-stu-id="f9633-112">In such situations, a better option is to provide a fully-editable DataList, one where *all* of its items are in edit mode and whose values can be edited by clicking an Update All button on the page (see Figure 1).</span></span>

<span data-ttu-id="f9633-113">[完全に編集可能な DataList の各項目を変更できる ![](performing-batch-updates-cs/_static/image2.png)](performing-batch-updates-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f9633-113">[![Each Item in a Fully Editable DataList can be Modified](performing-batch-updates-cs/_static/image2.png)](performing-batch-updates-cs/_static/image1.png)</span></span>

<span data-ttu-id="f9633-114">**図 1**: 完全に編集可能な DataList の各項目を変更することができます ([クリックすると、フルサイズのイメージが表示](performing-batch-updates-cs/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="f9633-114">**Figure 1**: Each Item in a Fully Editable DataList can be Modified ([Click to view full-size image](performing-batch-updates-cs/_static/image3.png))</span></span>

<span data-ttu-id="f9633-115">このチュートリアルでは、ユーザーが完全に編集可能な DataList を使用して仕入先の住所情報を更新できるようにする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f9633-115">In this tutorial we'll examine how to enable users to update suppliers address information using a fully editable DataList.</span></span>

## <a name="step-1-create-the-editable-user-interface-in-the-datalist-s-itemtemplate"></a><span data-ttu-id="f9633-116">手順 1: DataList s ItemTemplate で編集可能なユーザーインターフェイスを作成する</span><span class="sxs-lookup"><span data-stu-id="f9633-116">Step 1: Create the Editable User Interface in the DataList s ItemTemplate</span></span>

<span data-ttu-id="f9633-117">前のチュートリアルでは、標準の項目レベルの編集可能な DataList を作成し、次の2つのテンプレートを使用しています。</span><span class="sxs-lookup"><span data-stu-id="f9633-117">In the preceding tutorial, where we creating a standard, item-level editable DataList, we used two templates:</span></span>

- <span data-ttu-id="f9633-118">`ItemTemplate` には、読み取り専用のユーザーインターフェイス (各製品の名前と価格を表示するためのラベル Web コントロール) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="f9633-118">`ItemTemplate` contained the read-only user interface (the Label Web controls for displaying each product s name and price).</span></span>
- <span data-ttu-id="f9633-119">`EditItemTemplate` には、編集モードのユーザーインターフェイスが含まれています (2 つの TextBox Web コントロール)。</span><span class="sxs-lookup"><span data-stu-id="f9633-119">`EditItemTemplate` contained the edit mode user interface (the two TextBox Web controls).</span></span>

<span data-ttu-id="f9633-120">DataList s `EditItemIndex` プロパティは、`EditItemTemplate`を使用して表示される `DataListItem` (存在する場合) を決定します。</span><span class="sxs-lookup"><span data-stu-id="f9633-120">The DataList s `EditItemIndex` property dictates what `DataListItem` (if any) is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="f9633-121">特に、`ItemIndex` 値が DataList s `EditItemIndex` プロパティと一致する `DataListItem` は、`EditItemTemplate`を使用して表示されます。</span><span class="sxs-lookup"><span data-stu-id="f9633-121">In particular, the `DataListItem` whose `ItemIndex` value matches the DataList s `EditItemIndex` property is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="f9633-122">このモデルは、一度に1つの項目しか編集できない場合に適していますが、完全に編集可能な DataList を作成するときには区別されません。</span><span class="sxs-lookup"><span data-stu-id="f9633-122">This model works well when only one item can be edited at a time, but falls apart when creating a fully-editable DataList.</span></span>

<span data-ttu-id="f9633-123">完全に編集可能な DataList の場合は、*すべて*の `DataListItem` が編集可能なインターフェイスを使用して表示されます。</span><span class="sxs-lookup"><span data-stu-id="f9633-123">For a fully editable DataList, we want *all* of the `DataListItem` s to render using the editable interface.</span></span> <span data-ttu-id="f9633-124">これを実現する最も簡単な方法は、`ItemTemplate`で編集可能なインターフェイスを定義することです。</span><span class="sxs-lookup"><span data-stu-id="f9633-124">The simplest way to accomplish this is to define the editable interface in the `ItemTemplate`.</span></span> <span data-ttu-id="f9633-125">仕入先の住所情報を変更するために、編集可能なインターフェイスには業者名がテキストとして含まれており、住所、市区町村、および国の値のテキストボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f9633-125">For modifying the suppliers address information, the editable interface contains the supplier name as text and then TextBoxes for the address, city, and country values.</span></span>

<span data-ttu-id="f9633-126">まず、`BatchUpdate.aspx` ページを開き、DataList コントロールを追加して、その `ID` プロパティを `Suppliers`に設定します。</span><span class="sxs-lookup"><span data-stu-id="f9633-126">Start by opening the `BatchUpdate.aspx` page, add a DataList control, and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="f9633-127">DataList s スマートタグから、`SuppliersDataSource`という名前の新しい ObjectDataSource コントロールを追加することを選択します。</span><span class="sxs-lookup"><span data-stu-id="f9633-127">From the DataList s smart tag, opt to add a new ObjectDataSource control named `SuppliersDataSource`.</span></span>

<span data-ttu-id="f9633-128">[SuppliersDataSource という名前の新しい ObjectDataSource を作成 ![には](performing-batch-updates-cs/_static/image5.png)](performing-batch-updates-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="f9633-128">[![Create a New ObjectDataSource Named SuppliersDataSource](performing-batch-updates-cs/_static/image5.png)](performing-batch-updates-cs/_static/image4.png)</span></span>

<span data-ttu-id="f9633-129">**図 2**: `SuppliersDataSource` という名前の新しい ObjectDataSource を作成[する (クリックすると、フルサイズの画像が表示](performing-batch-updates-cs/_static/image6.png)される)</span><span class="sxs-lookup"><span data-stu-id="f9633-129">**Figure 2**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](performing-batch-updates-cs/_static/image6.png))</span></span>

<span data-ttu-id="f9633-130">`SuppliersBLL` クラス s `GetSuppliers()` メソッドを使用してデータを取得するように ObjectDataSource を構成します (図3を参照)。</span><span class="sxs-lookup"><span data-stu-id="f9633-130">Configure the ObjectDataSource to retrieve data using the `SuppliersBLL` class s `GetSuppliers()` method (see Figure 3).</span></span> <span data-ttu-id="f9633-131">前のチュートリアルと同様に、ObjectDataSource を通じて supplier 情報を更新するのではなく、ビジネスロジックレイヤーを直接操作します。</span><span class="sxs-lookup"><span data-stu-id="f9633-131">As with the preceding tutorial, rather than updating the supplier information through the ObjectDataSource, we'll work directly with the Business Logic Layer.</span></span> <span data-ttu-id="f9633-132">そのため、[更新] タブで、ドロップダウンリストを [(なし)] に設定します (図4を参照)。</span><span class="sxs-lookup"><span data-stu-id="f9633-132">Therefore, set the drop-down list to (None) in the UPDATE tab (see Figure 4).</span></span>

<span data-ttu-id="f9633-133">[GetSuppliers () メソッドを使用して業者情報を取得 ![には](performing-batch-updates-cs/_static/image8.png)](performing-batch-updates-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f9633-133">[![Retrieve Supplier Information Using the GetSuppliers() Method](performing-batch-updates-cs/_static/image8.png)](performing-batch-updates-cs/_static/image7.png)</span></span>

<span data-ttu-id="f9633-134">**図 3**: `GetSuppliers()` メソッドを使用して業者情報を取得[する (クリックしてフルサイズのイメージを表示](performing-batch-updates-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="f9633-134">**Figure 3**: Retrieve Supplier Information Using the `GetSuppliers()` Method ([Click to view full-size image](performing-batch-updates-cs/_static/image9.png))</span></span>

<span data-ttu-id="f9633-135">[[更新] タブで、ドロップダウンリストを [(なし)] に設定 ![ます。](performing-batch-updates-cs/_static/image11.png)](performing-batch-updates-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="f9633-135">[![Set the Drop-Down List to (None) in the UPDATE Tab](performing-batch-updates-cs/_static/image11.png)](performing-batch-updates-cs/_static/image10.png)</span></span>

<span data-ttu-id="f9633-136">**図 4**: [更新] タブでドロップダウンリストを (なし) に設定する ([クリックすると、フルサイズの画像が表示](performing-batch-updates-cs/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="f9633-136">**Figure 4**: Set the Drop-Down List to (None) in the UPDATE Tab ([Click to view full-size image](performing-batch-updates-cs/_static/image12.png))</span></span>

<span data-ttu-id="f9633-137">ウィザードを完了すると、Visual Studio によって自動的に DataList s `ItemTemplate` が生成され、データソースから返された各データフィールドがラベル Web コントロールに表示されます。</span><span class="sxs-lookup"><span data-stu-id="f9633-137">After completing the wizard, Visual Studio automatically generates the DataList s `ItemTemplate` to display each data field returned by the data source in a Label Web control.</span></span> <span data-ttu-id="f9633-138">代わりに編集インターフェイスを提供するように、このテンプレートを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f9633-138">We need to modify this template so that it provides the editing interface instead.</span></span> <span data-ttu-id="f9633-139">`ItemTemplate` は、デザイナーを使用して、DataList s スマートタグの [テンプレートの編集] オプションを使用してカスタマイズすることも、宣言型の構文から直接カスタマイズすることもできます。</span><span class="sxs-lookup"><span data-stu-id="f9633-139">The `ItemTemplate` can be customized through the Designer using the Edit Templates option from the DataList s smart tag or directly through the declarative syntax.</span></span>

<span data-ttu-id="f9633-140">業者の名前をテキストとして表示する編集インターフェイスを作成しますが、仕入先の住所、市区町村、国の値のテキストボックスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="f9633-140">Take a moment to create an editing interface that displays the supplier s name as text, but includes TextBoxes for the supplier s address, city, and country values.</span></span> <span data-ttu-id="f9633-141">これらの変更を行った後、ページの宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="f9633-141">After making these changes, your page s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](performing-batch-updates-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="f9633-142">前のチュートリアルと同様に、このチュートリアルの DataList ではビューステートが有効になっている必要があります。</span><span class="sxs-lookup"><span data-stu-id="f9633-142">As with the preceding tutorial, the DataList in this tutorial must have its view state enabled.</span></span>

<span data-ttu-id="f9633-143">`ItemTemplate` は、2つの新しい CSS クラスを使用しています。 `SupplierPropertyLabel` と `SupplierPropertyValue`は、`Styles.css` クラスに追加され、`ProductPropertyLabel` および `ProductPropertyValue` CSS クラスと同じスタイル設定を使用するように構成されています。</span><span class="sxs-lookup"><span data-stu-id="f9633-143">In the `ItemTemplate` I m using two new CSS classes, `SupplierPropertyLabel` and `SupplierPropertyValue`, which have been added to the `Styles.css` class and configured to use the same style settings as the `ProductPropertyLabel` and `ProductPropertyValue` CSS classes.</span></span>

[!code-css[Main](performing-batch-updates-cs/samples/sample2.css)]

<span data-ttu-id="f9633-144">これらの変更を行った後、ブラウザーを使用してこのページにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="f9633-144">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="f9633-145">図5に示すように、各 DataList 項目は、仕入先名をテキストとして表示し、テキストボックスを使用して住所、市区町村、および国を表示します。</span><span class="sxs-lookup"><span data-stu-id="f9633-145">As Figure 5 shows, each DataList item displays the supplier name as text and uses TextBoxes to display the address, city, and country.</span></span>

<span data-ttu-id="f9633-146">[DataList 内の各サプライヤーが編集可能で ![](performing-batch-updates-cs/_static/image14.png)](performing-batch-updates-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f9633-146">[![Each Supplier in the DataList is Editable](performing-batch-updates-cs/_static/image14.png)](performing-batch-updates-cs/_static/image13.png)</span></span>

<span data-ttu-id="f9633-147">**図 5**: DataList の各仕入先は編集可能です ([クリックすると、フルサイズの画像が表示](performing-batch-updates-cs/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="f9633-147">**Figure 5**: Each Supplier in the DataList is Editable ([Click to view full-size image](performing-batch-updates-cs/_static/image15.png))</span></span>

## <a name="step-2-adding-an-update-all-button"></a><span data-ttu-id="f9633-148">手順 2: [すべて更新] ボタンを追加する</span><span class="sxs-lookup"><span data-stu-id="f9633-148">Step 2: Adding an Update All Button</span></span>

<span data-ttu-id="f9633-149">図5の各仕入先には、住所、市区町村、および国のフィールドがテキストボックスに表示されていますが、現在は [更新] ボタンがありません。</span><span class="sxs-lookup"><span data-stu-id="f9633-149">While each supplier in Figure 5 has its address, city, and country fields displayed in a TextBox, there currently is no Update button available.</span></span> <span data-ttu-id="f9633-150">アイテムごとに更新ボタンを使用するのではなく、完全に編集可能な DataLists を使用すると、通常、ページの [すべて更新] ボタンがあります。このボタンをクリックすると、DataList 内の*すべて*のレコードが更新されます。</span><span class="sxs-lookup"><span data-stu-id="f9633-150">Rather than having an Update button per item, with fully editable DataLists there is typically a single Update All button on the page that, when clicked, updates *all* of the records in the DataList.</span></span> <span data-ttu-id="f9633-151">このチュートリアルでは、2つの [すべての更新] ボタン (ページの上部と下部に1つ) を追加します (いずれかのボタンをクリックしても同じ効果が得られます)。</span><span class="sxs-lookup"><span data-stu-id="f9633-151">For this tutorial, let s add two Update All buttons - one at the top of the page and one at the bottom (although clicking either button will have the same effect).</span></span>

<span data-ttu-id="f9633-152">まず、DataList の上に Button Web コントロールを追加し、その `ID` プロパティを `UpdateAll1`に設定します。</span><span class="sxs-lookup"><span data-stu-id="f9633-152">Start by adding a Button Web control above the DataList and set its `ID` property to `UpdateAll1`.</span></span> <span data-ttu-id="f9633-153">次に、DataList の下に2番目のボタン Web コントロールを追加し、その `ID` を `UpdateAll2`に設定します。</span><span class="sxs-lookup"><span data-stu-id="f9633-153">Next, add the second Button Web control beneath the DataList, setting its `ID` to `UpdateAll2`.</span></span> <span data-ttu-id="f9633-154">2つのボタンの `Text` プロパティを [すべて更新] に設定します。</span><span class="sxs-lookup"><span data-stu-id="f9633-154">Set the `Text` properties for the two Buttons to Update All.</span></span> <span data-ttu-id="f9633-155">最後に、両方のボタン `Click` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="f9633-155">Lastly, create event handlers for both Buttons `Click` events.</span></span> <span data-ttu-id="f9633-156">各イベントハンドラーで更新ロジックを複製するのではなく、を3番目のメソッド (`UpdateAllSupplierAddresses`) にリファクタリングし、この3番目のメソッドを呼び出すだけでイベントハンドラーを使用します。</span><span class="sxs-lookup"><span data-stu-id="f9633-156">Rather than duplicating the update logic in each of the event handlers, let s refactor that logic to a third method, `UpdateAllSupplierAddresses`, having the event handlers simply invoking this third method.</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample3.cs)]

<span data-ttu-id="f9633-157">図6は、[すべて更新] ボタンが追加された後のページを示しています。</span><span class="sxs-lookup"><span data-stu-id="f9633-157">Figure 6 shows the page after the Update All buttons have been added.</span></span>

<span data-ttu-id="f9633-158">[![2 つの更新プログラムのすべてのボタンがページに追加されました](performing-batch-updates-cs/_static/image17.png)](performing-batch-updates-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="f9633-158">[![Two Update All Buttons have been Added to the Page](performing-batch-updates-cs/_static/image17.png)](performing-batch-updates-cs/_static/image16.png)</span></span>

<span data-ttu-id="f9633-159">**図 6**: [すべての更新] ボタンがページに追加されました ([クリックすると、フルサイズの画像が表示](performing-batch-updates-cs/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="f9633-159">**Figure 6**: Two Update All Buttons have been Added to the Page ([Click to view full-size image](performing-batch-updates-cs/_static/image18.png))</span></span>

## <a name="step-3-updating-all-of-the-suppliers-address-information"></a><span data-ttu-id="f9633-160">手順 3: すべての仕入先の住所情報を更新する</span><span class="sxs-lookup"><span data-stu-id="f9633-160">Step 3: Updating All of the Suppliers Address Information</span></span>

<span data-ttu-id="f9633-161">すべての DataList 項目で編集インターフェイスを表示し、[すべて更新] ボタンを追加すると、残っているのはバッチ更新を実行するコードを記述することだけです。</span><span class="sxs-lookup"><span data-stu-id="f9633-161">With all of the DataList s items displaying the editing interface and with the addition of the Update All buttons, all that remains is writing the code to perform the batch update.</span></span> <span data-ttu-id="f9633-162">具体的には、DataList s 項目をループ処理し、それぞれに対して `SuppliersBLL` クラス s `UpdateSupplierAddress` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="f9633-162">Specifically, we need to loop through the DataList s items and call the `SuppliersBLL` class s `UpdateSupplierAddress` method for each one.</span></span>

<span data-ttu-id="f9633-163">DataList を設定する `DataListItem` インスタンスのコレクションには、DataList s [`Items` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx)を使用してアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="f9633-163">The collection of `DataListItem` instances that makeup the DataList can be accessed via the DataList s [`Items` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span></span> <span data-ttu-id="f9633-164">`DataListItem`への参照を使用して、次のコードに示すように、`DataKeys` コレクションから対応する `SupplierID` を取得し、プログラムによって `ItemTemplate` 内の TextBox Web コントロールを参照することができます。</span><span class="sxs-lookup"><span data-stu-id="f9633-164">With a reference to a `DataListItem`, we can grab the corresponding `SupplierID` from the `DataKeys` collection and programmatically reference the TextBox Web controls within the `ItemTemplate` as the following code illustrates:</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample4.cs)]

<span data-ttu-id="f9633-165">[すべて更新] ボタンのいずれかをクリックすると、`UpdateAllSupplierAddresses` メソッドは、`Suppliers` DataList 内の各 `DataListItem` を反復処理し、対応する値を渡して `SuppliersBLL` クラス s `UpdateSupplierAddress` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="f9633-165">When the user clicks one of the Update All buttons, the `UpdateAllSupplierAddresses` method iterates through each `DataListItem` in the `Suppliers` DataList and calls the `SuppliersBLL` class s `UpdateSupplierAddress` method, passing in the corresponding values.</span></span> <span data-ttu-id="f9633-166">住所、都市、または国のパスに対して入力されていない値は、(空白の文字列ではなく) `UpdateSupplierAddress` する `Nothing` の値です。これにより、基になるレコードのフィールドに対してデータベース `NULL` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="f9633-166">A non-entered value for address, city, or country passes is a value of `Nothing` to `UpdateSupplierAddress` (rather than a blank string), which results in a database `NULL` for the underlying record s fields.</span></span>

> [!NOTE]
> <span data-ttu-id="f9633-167">拡張機能として、バッチ更新の実行後に確認メッセージが表示されるページに、ステータスラベル Web コントロールを追加することができます。</span><span class="sxs-lookup"><span data-stu-id="f9633-167">As an enhancement, you may want to add a status Label Web control to the page that provides some confirmation message after the batch update is performed.</span></span>

## <a name="updating-only-those-addresses-that-have-been-modified"></a><span data-ttu-id="f9633-168">変更されたアドレスのみを更新する</span><span class="sxs-lookup"><span data-stu-id="f9633-168">Updating Only Those Addresses That Have Been Modified</span></span>

<span data-ttu-id="f9633-169">このチュートリアルで使用するバッチ更新アルゴリズムでは、そのアドレス情報が変更されているかどうかにかかわらず、DataList 内の*すべて*の業者に対して `UpdateSupplierAddress` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="f9633-169">The batch update algorithm used for this tutorial calls the `UpdateSupplierAddress` method for *every* supplier in the DataList, regardless of whether their address information has been changed.</span></span> <span data-ttu-id="f9633-170">このようなブラインド更新は、通常はパフォーマンス上の問題ではありませんが、データベーステーブルへの変更を監査すると、余分なレコードが生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f9633-170">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="f9633-171">たとえば、トリガーを使用して、すべての `UPDATE` を `Suppliers` テーブルに記録する場合は、ユーザーが [すべて更新] ボタンをクリックするたびに、ユーザーが変更を行ったかどうかに関係なく、システム内の各業者に対して新しい監査レコードが作成されます。</span><span class="sxs-lookup"><span data-stu-id="f9633-171">For example, if you use triggers to record all `UPDATE` s to the `Suppliers` table to an auditing table, every time a user clicks the Update All button a new audit record will be created for each supplier in the system, regardless of whether the user made any changes.</span></span>

<span data-ttu-id="f9633-172">ADO.NET DataTable および DataAdapter クラスはバッチ更新をサポートするように設計されており、変更、削除、および新しいレコードだけがデータベース通信になります。</span><span class="sxs-lookup"><span data-stu-id="f9633-172">The ADO.NET DataTable and DataAdapter classes are designed to support batch updates where only modified, deleted, and new records results in any database communication.</span></span> <span data-ttu-id="f9633-173">DataTable 内の各行には、行が DataTable に追加されているか、削除されたか、変更されたか、または変更されていないかを示す[`RowState` プロパティ](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx)があります。</span><span class="sxs-lookup"><span data-stu-id="f9633-173">Each row in the DataTable has a [`RowState` property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) that indicates whether the row has been added to the DataTable, deleted from it, modified, or remains unchanged.</span></span> <span data-ttu-id="f9633-174">DataTable に最初に値が設定されると、すべての行が未変更としてマークされます。</span><span class="sxs-lookup"><span data-stu-id="f9633-174">When a DataTable is initially populated, all rows are marked unchanged.</span></span> <span data-ttu-id="f9633-175">いずれかの行の列の値を変更すると、行が変更済みとしてマークされます。</span><span class="sxs-lookup"><span data-stu-id="f9633-175">Changing the value of any of the row s columns marks the row as modified.</span></span>

<span data-ttu-id="f9633-176">`SuppliersBLL` クラスでは、最初に単一の仕入先レコードを `SuppliersDataTable` に読み取り、次のコードを使用して、`Address`、`City`、および `Country` 列の値を設定することによって、指定された仕入先のアドレス情報を更新します。</span><span class="sxs-lookup"><span data-stu-id="f9633-176">In the `SuppliersBLL` class we update the specified supplier s address information by first reading in the single supplier record into a `SuppliersDataTable` and then set the `Address`, `City`, and `Country` column values using the following code:</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample5.cs)]

<span data-ttu-id="f9633-177">このコードネイティブは、値が変更されたかどうかに関係なく、渡されたアドレス、市区町村、国の値を `SuppliersDataTable` 内の `SuppliersRow` に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="f9633-177">This code naively assigns the passed-in address, city, and country values to the `SuppliersRow` in the `SuppliersDataTable` regardless of whether or not the values have changed.</span></span> <span data-ttu-id="f9633-178">これらの変更により、`SuppliersRow` s `RowState` プロパティが変更済みとしてマークされます。</span><span class="sxs-lookup"><span data-stu-id="f9633-178">These modifications cause the `SuppliersRow` s `RowState` property to be marked as modified.</span></span> <span data-ttu-id="f9633-179">データアクセス層 s `Update` メソッドが呼び出されると、`SupplierRow` が変更されていることが確認されるため、データベースに `UPDATE` コマンドが送信されます。</span><span class="sxs-lookup"><span data-stu-id="f9633-179">When the Data Access Layer s `Update` method is called, it sees that the `SupplierRow` has been modified and therefore sends an `UPDATE` command to the database.</span></span>

<span data-ttu-id="f9633-180">ただし、このメソッドにコードを追加して、渡された address、city、および country の値が `SuppliersRow` s の既存の値と異なる場合にのみ割り当てるようにしたとします。</span><span class="sxs-lookup"><span data-stu-id="f9633-180">Imagine, however, that we added code to this method to only assign the passed-in address, city, and country values if they differ from the `SuppliersRow` s existing values.</span></span> <span data-ttu-id="f9633-181">住所、市区町村、および国が既存のデータと同じ場合、変更は行われず、`SupplierRow` s `RowState` は変更なしとしてマークされたままになります。</span><span class="sxs-lookup"><span data-stu-id="f9633-181">In the case where the address, city, and country are the same as the existing data, no changes will be made and the `SupplierRow` s `RowState` will be left marked as unchanged.</span></span> <span data-ttu-id="f9633-182">結果として、DAL `Update` メソッドが呼び出されたときに、`SuppliersRow` が変更されていないため、データベースの呼び出しは行われません。</span><span class="sxs-lookup"><span data-stu-id="f9633-182">The net result is that when the DAL s `Update` method is called, no database call will be made because the `SuppliersRow` has not been modified.</span></span>

<span data-ttu-id="f9633-183">この変更を適用するには、渡されたアドレス、市区町村、国の値を無条件に割り当てるステートメントを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="f9633-183">To enact this change, replace the statements that blindly assign the passed-in address, city, and country values with the following code:</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample6.cs)]

<span data-ttu-id="f9633-184">このコードを追加すると、DAL の `Update` メソッドは、アドレス関連の値が変更されたレコードだけを対象として `UPDATE` ステートメントをデータベースに送信します。</span><span class="sxs-lookup"><span data-stu-id="f9633-184">With this added code, the DAL s `Update` method sends an `UPDATE` statement to the database for only those records whose address-related values have changed.</span></span>

<span data-ttu-id="f9633-185">または、渡されたアドレスフィールドとデータベースデータの間に違いがあるかどうかを追跡し、存在しない場合は、単に DAL s `Update` メソッドの呼び出しをバイパスすることもできます。</span><span class="sxs-lookup"><span data-stu-id="f9633-185">Alternatively, we could keep track of whether there are any differences between the passed-in address fields and the database data and, if there are none, simply bypass the call to the DAL s `Update` method.</span></span> <span data-ttu-id="f9633-186">この方法は、DB ダイレクトメソッドを使用した場合に適しています。これは、データベースの呼び出しが実際に必要かどうかを判断するために `RowState` を確認できる `SuppliersRow` インスタンスが DB ダイレクトメソッドに渡されないためです。</span><span class="sxs-lookup"><span data-stu-id="f9633-186">This approach works well if you re using the DB direct method, since the DB direct method isn t passed a `SuppliersRow` instance whose `RowState` can be checked to determine whether a database call is actually needed.</span></span>

> [!NOTE]
> <span data-ttu-id="f9633-187">`UpdateSupplierAddress` メソッドが呼び出されるたびに、データベースに対して呼び出しが行われ、更新されたレコードに関する情報が取得されます。</span><span class="sxs-lookup"><span data-stu-id="f9633-187">Each time the `UpdateSupplierAddress` method is invoked, a call is made to the database to retrieve information about the updated record.</span></span> <span data-ttu-id="f9633-188">次に、データが変更された場合、テーブル行を更新するための別のデータベース呼び出しが行われます。</span><span class="sxs-lookup"><span data-stu-id="f9633-188">Then, if there are any changes in data, another call to the database is made to update the table row.</span></span> <span data-ttu-id="f9633-189">このワークフローを最適化するには、`BatchUpdate.aspx` ページの*すべて*の変更を含む `EmployeesDataTable` インスタンスを受け入れる `UpdateSupplierAddress` メソッドのオーバーロードを作成します。</span><span class="sxs-lookup"><span data-stu-id="f9633-189">This workflow could be optimized by creating an `UpdateSupplierAddress` method overload that accepts an `EmployeesDataTable` instance that has *all* of the changes from the `BatchUpdate.aspx` page.</span></span> <span data-ttu-id="f9633-190">次に、データベースを1回呼び出して、`Suppliers` テーブルからすべてのレコードを取得することができます。</span><span class="sxs-lookup"><span data-stu-id="f9633-190">Then, it could make one call to the database to get all of the records from the `Suppliers` table.</span></span> <span data-ttu-id="f9633-191">その後、2つの結果セットを列挙し、変更が発生したレコードのみを更新できます。</span><span class="sxs-lookup"><span data-stu-id="f9633-191">The two resultsets could then be enumerated and only those records where changes have occurred could be updated.</span></span>

## <a name="summary"></a><span data-ttu-id="f9633-192">要約</span><span class="sxs-lookup"><span data-stu-id="f9633-192">Summary</span></span>

<span data-ttu-id="f9633-193">このチュートリアルでは、完全に編集可能な DataList を作成し、ユーザーが複数のサプライヤーのアドレス情報をすばやく変更できるようにする方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="f9633-193">In this tutorial we saw how to create a fully editable DataList, allowing a user to quickly modify the address information for multiple suppliers.</span></span> <span data-ttu-id="f9633-194">このチュートリアルでは、まず、DataList s アドレス、市区町村、および国の値に対して、編集インターフェイスの TextBox Web コントロールを `ItemTemplate`します。</span><span class="sxs-lookup"><span data-stu-id="f9633-194">We started by defining the editing interface a TextBox Web control for the supplier s address, city, and country values in the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="f9633-195">次に、DataList の上と下に [すべて更新] ボタンを追加しました。</span><span class="sxs-lookup"><span data-stu-id="f9633-195">Next, we added Update All buttons above and below the DataList.</span></span> <span data-ttu-id="f9633-196">ユーザーが自分の変更を行って [すべて更新] ボタンをクリックすると、`DataListItem` s が列挙され、`SuppliersBLL` クラス s `UpdateSupplierAddress` メソッドの呼び出しが行われます。</span><span class="sxs-lookup"><span data-stu-id="f9633-196">After a user has made his changes and clicked one of the Update All buttons, the `DataListItem` s are enumerated and a call to the `SuppliersBLL` class s `UpdateSupplierAddress` method is made.</span></span>

<span data-ttu-id="f9633-197">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="f9633-197">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="f9633-198">作成者について</span><span class="sxs-lookup"><span data-stu-id="f9633-198">About the Author</span></span>

<span data-ttu-id="f9633-199">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="f9633-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f9633-200">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="f9633-200">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f9633-201">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="f9633-201">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="f9633-202">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f9633-202">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="f9633-203">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="f9633-203">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="f9633-204">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="f9633-204">Special Thanks To</span></span>

<span data-ttu-id="f9633-205">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="f9633-205">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="f9633-206">このチュートリアルのリードレビュー担当者は、Zack Jones と Ken による Isa です。</span><span class="sxs-lookup"><span data-stu-id="f9633-206">Lead reviewers for this tutorial were Zack Jones and Ken Pespisa.</span></span> <span data-ttu-id="f9633-207">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="f9633-207">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="f9633-208">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f9633-208">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f9633-209">[前へ](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)
> [次へ](handling-bll-and-dal-level-exceptions-cs.md)</span><span class="sxs-lookup"><span data-stu-id="f9633-209">[Previous](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)
[Next](handling-bll-and-dal-level-exceptions-cs.md)</span></span>
