---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
title: バッチ挿入 (VB) |Microsoft Docs
author: rick-anderson
description: 1回の操作で複数のデータベースレコードを挿入する方法について説明します。 ユーザーインターフェイスレイヤーでは、GridView を拡張して、ユーザーが複数の n...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 48e2a4ae-77ca-4208-a204-c38c690ffb59
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
msc.type: authoredcontent
ms.openlocfilehash: 413a0e209b1899414eaab70aff07ee0d3223f28f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78501490"
---
# <a name="batch-inserting-vb"></a><span data-ttu-id="72673-104">一括挿入 (VB)</span><span class="sxs-lookup"><span data-stu-id="72673-104">Batch Inserting (VB)</span></span>

<span data-ttu-id="72673-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="72673-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="72673-106">[コードのダウンロード](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip)または[PDF のダウンロード](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="72673-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip) or [Download PDF](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span></span>

> <span data-ttu-id="72673-107">1回の操作で複数のデータベースレコードを挿入する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="72673-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="72673-108">ユーザーインターフェイスレイヤーでは、GridView を拡張して、ユーザーが複数の新しいレコードを入力できるようにします。</span><span class="sxs-lookup"><span data-stu-id="72673-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="72673-109">データアクセス層では、トランザクション内で複数の挿入操作をラップして、すべての挿入が成功するか、すべての挿入がロールバックされるようにします。</span><span class="sxs-lookup"><span data-stu-id="72673-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="72673-110">はじめに</span><span class="sxs-lookup"><span data-stu-id="72673-110">Introduction</span></span>

<span data-ttu-id="72673-111">[バッチ更新](batch-updating-vb.md)のチュートリアルでは、GridView コントロールをカスタマイズして、複数のレコードが編集可能であるインターフェイスを表示する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="72673-111">In the [Batch Updating](batch-updating-vb.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="72673-112">ページにアクセスするユーザーは一連の変更を行い、ボタンを1回クリックするだけでバッチ更新を実行できます。</span><span class="sxs-lookup"><span data-stu-id="72673-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="72673-113">ユーザーが一般的に1つの移動で多くのレコードを更新する場合、このようなインターフェイスでは、[データの挿入、更新、および削除の概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)について最初に調査した既定の行ごとの編集機能と比較して、多数のクリックとキーボードからマウスのコンテキストスイッチを保存できます。</span><span class="sxs-lookup"><span data-stu-id="72673-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial.</span></span>

<span data-ttu-id="72673-114">この概念は、レコードを追加するときにも適用できます。</span><span class="sxs-lookup"><span data-stu-id="72673-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="72673-115">ここでは、Northwind Traders で、特定のカテゴリの製品が多数含まれているサプライヤーから出荷を受け取ることが多いとします。</span><span class="sxs-lookup"><span data-stu-id="72673-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="72673-116">例として、東京 Traders から6つの異なる紅茶とコーヒー製品の出荷を受けているとします。</span><span class="sxs-lookup"><span data-stu-id="72673-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="72673-117">ユーザーが DetailsView コントロールを使用して6つの製品を一度に1つずつ入力した場合、同じ値の多くを繰り返し選択する必要があります。同じカテゴリ (飲み物)、同じ業者 (東京 Traders)、および同じ廃止された値を選択する必要があります (False)、および注文の値 (0) に同じ単位が指定されています。</span><span class="sxs-lookup"><span data-stu-id="72673-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="72673-118">この反復的なデータ入力は、時間のかかるだけでなく、エラーが発生しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="72673-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="72673-119">少し作業をして、ユーザーが仕入先とカテゴリを1回選択し、一連の製品名と単価を入力し、ボタンをクリックして新しい製品をデータベースに追加できるようにする、バッチ挿入インターフェイスを作成できます (図1を参照)。</span><span class="sxs-lookup"><span data-stu-id="72673-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="72673-120">各製品が追加されると、その `ProductName` および `UnitPrice` のデータフィールドにはテキストボックスに入力された値が割り当てられ、その `CategoryID` 値と `SupplierID` 値にはフォームの上部にある DropDownLists の値が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="72673-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="72673-121">`Discontinued` と `UnitsOnOrder` の値は、それぞれ `False` と0のハードコーディングされた値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="72673-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `False` and 0, respectively.</span></span>

<span data-ttu-id="72673-122">[バッチ挿入インターフェイスの ![](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="72673-122">[![The Batch Inserting Interface](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span></span>

<span data-ttu-id="72673-123">**図 1**: バッチ挿入インターフェイス ([クリックすると、フルサイズの画像が表示](batch-inserting-vb/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="72673-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-vb/_static/image3.png))</span></span>

<span data-ttu-id="72673-124">このチュートリアルでは、図1に示すバッチ挿入インターフェイスを実装するページを作成します。</span><span class="sxs-lookup"><span data-stu-id="72673-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="72673-125">前の2つのチュートリアルと同様に、アトミック性を確保するために、トランザクションのスコープ内に挿入をラップします。</span><span class="sxs-lookup"><span data-stu-id="72673-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="72673-126">始めましょう!</span><span class="sxs-lookup"><span data-stu-id="72673-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="72673-127">手順 1: 表示インターフェイスを作成する</span><span class="sxs-lookup"><span data-stu-id="72673-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="72673-128">このチュートリアルは、表示領域と挿入領域という2つの領域に分割された1つのページで構成されます。</span><span class="sxs-lookup"><span data-stu-id="72673-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="72673-129">この手順で作成する display インターフェイスには、GridView の製品が表示され、[Process Product] (製品出荷のプロセス) というボタンが表示されます。</span><span class="sxs-lookup"><span data-stu-id="72673-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="72673-130">このボタンをクリックすると、図1に示すように、表示インターフェイスが挿入インターフェイスに置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="72673-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="72673-131">[出荷からの製品の追加] または [キャンセル] ボタンをクリックすると、表示インターフェイスが戻ります。</span><span class="sxs-lookup"><span data-stu-id="72673-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="72673-132">ここでは、手順 2. で挿入インターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="72673-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="72673-133">2つのインターフェイスを持つページを作成するときに、そのうちの1つだけが一度に表示される場合、通常、各インターフェイスは、他のコントロールのコンテナーとして機能する[パネル Web コントロール](http://www.w3schools.com/aspnet/control_panel.asp)内に配置されます。</span><span class="sxs-lookup"><span data-stu-id="72673-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="72673-134">したがって、このページでは、インターフェイスごとに2つのパネルコントロールが表示されます。</span><span class="sxs-lookup"><span data-stu-id="72673-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="72673-135">まず、`BatchData` フォルダーの [`BatchInsert.aspx`] ページを開き、パネルをツールボックスからデザイナーにドラッグします (図2を参照)。</span><span class="sxs-lookup"><span data-stu-id="72673-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="72673-136">[Panel s `ID`] プロパティを `DisplayInterface`に設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="72673-137">パネルをデザイナーに追加すると、`Height` プロパティと `Width` プロパティがそれぞれ50px と125px に設定されます。</span><span class="sxs-lookup"><span data-stu-id="72673-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="72673-138">これらのプロパティ値をプロパティウィンドウから削除します。</span><span class="sxs-lookup"><span data-stu-id="72673-138">Clear out these property values from the Properties window.</span></span>

<span data-ttu-id="72673-139">[パネルをツールボックスからデザイナーにドラッグ ![](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="72673-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span></span>

<span data-ttu-id="72673-140">**図 2**: パネルをツールボックスからデザイナーにドラッグする ([クリックすると、フルサイズの画像が表示](batch-inserting-vb/_static/image6.png)されます)</span><span class="sxs-lookup"><span data-stu-id="72673-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-vb/_static/image6.png))</span></span>

<span data-ttu-id="72673-141">次に、ボタンと GridView コントロールをパネルにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="72673-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="72673-142">ボタン s `ID` プロパティを `ProcessShipment` に設定し、その `Text` プロパティを製品出荷を処理するように設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="72673-143">GridView s `ID` プロパティを `ProductsGrid` に設定し、そのスマートタグから `ProductsDataSource`という名前の新しい ObjectDataSource にバインドします。</span><span class="sxs-lookup"><span data-stu-id="72673-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="72673-144">`ProductsBLL` クラス s `GetProducts` メソッドからデータをプルするように ObjectDataSource を構成します。</span><span class="sxs-lookup"><span data-stu-id="72673-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="72673-145">この GridView はデータの表示にのみ使用されるため、[更新]、[挿入]、[削除] の各タブのドロップダウンリストを [(なし)] に設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="72673-146">[完了] をクリックして、データソースの構成ウィザードを完了します。</span><span class="sxs-lookup"><span data-stu-id="72673-146">Click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="72673-147">[製品の Bll クラス s GetProducts メソッドから返されたデータを表示 ![](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="72673-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span></span>

<span data-ttu-id="72673-148">**図 3**: `ProductsBLL` クラス s `GetProducts` メソッドから返されたデータを表示[する (クリックしてフルサイズの画像を表示する](batch-inserting-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="72673-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-vb/_static/image9.png))</span></span>

<span data-ttu-id="72673-149">[[更新]、[挿入]、[削除] の各タブのドロップダウンリストを [(なし)] に設定 ![ます。](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="72673-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span></span>

<span data-ttu-id="72673-150">**図 4**: [更新]、[挿入]、[削除] の各タブのドロップダウンリストを (なし) に設定する ([クリックしてフルサイズのイメージを表示する](batch-inserting-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="72673-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-vb/_static/image12.png))</span></span>

<span data-ttu-id="72673-151">ObjectDataSource ウィザードを完了すると、Visual Studio によって、BoundFields と product データフィールドの CheckBoxField が追加されます。</span><span class="sxs-lookup"><span data-stu-id="72673-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="72673-152">`ProductName`、`CategoryName`、`SupplierName`、`UnitPrice`、および `Discontinued` のフィールド以外はすべて削除します。</span><span class="sxs-lookup"><span data-stu-id="72673-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="72673-153">美しいカスタマイズを自由に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="72673-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="72673-154">ここでは、`UnitPrice` フィールドを通貨値として書式設定し、フィールドを並べ替え、いくつかのフィールドの名前を `HeaderText` 値に変更することにしました。</span><span class="sxs-lookup"><span data-stu-id="72673-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="72673-155">また、gridview のスマートタグの [ページングを有効にし、並べ替えを有効にする] チェックボックスをオンにして、ページングと並べ替えのサポートを含むように GridView を構成します。</span><span class="sxs-lookup"><span data-stu-id="72673-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="72673-156">パネル、ボタン、GridView、ObjectDataSource の各コントロールを追加し、GridView のフィールドをカスタマイズすると、ページ s の宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="72673-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](batch-inserting-vb/samples/sample1.aspx)]

<span data-ttu-id="72673-157">ボタンと GridView のマークアップは、開始タグと終了タグの `<asp:Panel>` 内に表示されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="72673-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="72673-158">これらのコントロールは `DisplayInterface` パネル内にあるため、Panel s `Visible` プロパティを `False`に設定するだけで非表示にすることができます。</span><span class="sxs-lookup"><span data-stu-id="72673-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `False`.</span></span> <span data-ttu-id="72673-159">手順3では、ボタンクリックに応じてパネルの `Visible` プロパティをプログラムによって変更し、もう一方のインターフェイスを非表示にします。</span><span class="sxs-lookup"><span data-stu-id="72673-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="72673-160">ブラウザーで進行状況を確認してください。</span><span class="sxs-lookup"><span data-stu-id="72673-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="72673-161">図5に示すように、一度に10製品を一覧表示する GridView の上に、[Process Product 出荷] ボタンが表示されます。</span><span class="sxs-lookup"><span data-stu-id="72673-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>

<span data-ttu-id="72673-162">[GridView によって製品が一覧表示され、並べ替えとページングの機能が提供さ ![](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="72673-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span></span>

<span data-ttu-id="72673-163">**図 5**: GridView に製品が一覧表示され、並べ替えとページングの機能が提供される ([クリックすると、フルサイズの画像が表示](batch-inserting-vb/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="72673-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-vb/_static/image15.png))</span></span>

## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="72673-164">手順 2: 挿入インターフェイスの作成</span><span class="sxs-lookup"><span data-stu-id="72673-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="72673-165">Display インターフェイスが完成したら、挿入インターフェイスを作成する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="72673-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="72673-166">このチュートリアルでは、1つの仕入先とカテゴリの値を要求する挿入インターフェイスを作成し、ユーザーが最大5つの製品名と単価の値を入力できるようにします。</span><span class="sxs-lookup"><span data-stu-id="72673-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="72673-167">このインターフェイスを使用すると、ユーザーは、同じカテゴリおよび仕入先を共有し、一意の製品名と価格を持つ5つの新しい製品に1つを追加できます。</span><span class="sxs-lookup"><span data-stu-id="72673-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="72673-168">まず、パネルをツールボックスからデザイナーにドラッグして、既存の `DisplayInterface` パネルの下に配置します。</span><span class="sxs-lookup"><span data-stu-id="72673-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="72673-169">新しく追加したこのパネルの [`ID`] プロパティを `InsertingInterface` に設定し、その `Visible` プロパティを [`False`] に設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `False`.</span></span> <span data-ttu-id="72673-170">手順 3. で `True` に `InsertingInterface` Panel s `Visible` プロパティを設定するコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="72673-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `True` in Step 3.</span></span> <span data-ttu-id="72673-171">また、パネル s `Height` をオフにし、プロパティ値 `Width` します。</span><span class="sxs-lookup"><span data-stu-id="72673-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="72673-172">次に、図1に戻された挿入インターフェイスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="72673-173">このインターフェイスは、さまざまな HTML 手法を使用して作成できますが、非常に簡単な方法として、4列の7行のテーブルを使用します。</span><span class="sxs-lookup"><span data-stu-id="72673-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="72673-174">HTML `<table>` 要素のマークアップを入力するときに、ソースビューを使用します。</span><span class="sxs-lookup"><span data-stu-id="72673-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="72673-175">Visual Studio には `<table>` 要素をデザイナーから追加するためのツールが用意されていますが、デザイナーでは、`style` 設定の unasked をマークアップに挿入する必要がありすぎないように見えます。</span><span class="sxs-lookup"><span data-stu-id="72673-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="72673-176">`<table>` マークアップを作成したら、通常はデザイナーに戻り、Web コントロールを追加し、そのプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="72673-177">事前に定義された列と行を含むテーブルを作成する場合は、[テーブル web コントロール](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx)ではなく静的な HTML を使用することをお勧めします。これは、テーブル web コントロール内に配置された web コントロールには `FindControl("controlID")` パターンを使用してのみアクセスできるためです。</span><span class="sxs-lookup"><span data-stu-id="72673-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="72673-178">ただし、テーブル web コントロールはプログラムによって構築できるため、動的にサイズ変更されたテーブル (行または列がデータベースまたはユーザー指定の条件に基づいているテーブル) にはテーブル Web コントロールを使用します。</span><span class="sxs-lookup"><span data-stu-id="72673-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>

<span data-ttu-id="72673-179">`InsertingInterface` パネルの `<asp:Panel>` タグ内に次のマークアップを入力します。</span><span class="sxs-lookup"><span data-stu-id="72673-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>

[!code-html[Main](batch-inserting-vb/samples/sample2.html)]

<span data-ttu-id="72673-180">この `<table>` マークアップには、まだ Web コントロールが含まれていません。これらを一時的に追加します。</span><span class="sxs-lookup"><span data-stu-id="72673-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="72673-181">各 `<tr>` 要素には、特定の CSS クラス設定が含まれていることに注意してください。これは、supplier リストと category DropDownLists が移動するヘッダー行の `BatchInsertHeaderRow` です。[出荷から製品を追加] および [キャンセル] ボタンが表示されるフッター行の `BatchInsertFooterRow`とは、product および unit price TextBox コントロールを含む行の `BatchInsertRow` と `BatchInsertAlternatingRow` の値を交互に表示します。</span><span class="sxs-lookup"><span data-stu-id="72673-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="72673-182">このチュートリアルで使用している GridView および DetailsView コントロールと同様の外観を挿入インターフェイスに与えるために、対応する CSS クラスを `Styles.css` ファイルに作成しました。</span><span class="sxs-lookup"><span data-stu-id="72673-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="72673-183">これらの CSS クラスを次に示します。</span><span class="sxs-lookup"><span data-stu-id="72673-183">These CSS classes are shown below.</span></span>

[!code-css[Main](batch-inserting-vb/samples/sample3.css)]

<span data-ttu-id="72673-184">このマークアップを入力したら、デザインビューに戻ります。</span><span class="sxs-lookup"><span data-stu-id="72673-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="72673-185">図6に示すように、この `<table>` はデザイナーに4列の7行のテーブルとして表示されます。</span><span class="sxs-lookup"><span data-stu-id="72673-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>

<span data-ttu-id="72673-186">[挿入インターフェイスは、4列の7行のテーブルで構成されて ![ます。](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="72673-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span></span>

<span data-ttu-id="72673-187">**図 6**: 挿入インターフェイスは、4列の7行のテーブルで構成されています ([クリックすると、フルサイズの画像が表示](batch-inserting-vb/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="72673-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-vb/_static/image18.png))</span></span>

<span data-ttu-id="72673-188">挿入インターフェイスに Web コントロールを追加する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="72673-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="72673-189">ツールボックスから2つの DropDownLists をテーブル内の適切なセルにドラッグして、仕入先とカテゴリに1つずつドラッグします。</span><span class="sxs-lookup"><span data-stu-id="72673-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="72673-190">Supplier DropDownList `ID` プロパティを `Suppliers` に設定し、`SuppliersDataSource`という名前の新しい ObjectDataSource にバインドします。</span><span class="sxs-lookup"><span data-stu-id="72673-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="72673-191">新しい ObjectDataSource を `SuppliersBLL` クラス s `GetSuppliers` メソッドからデータを取得するように構成し、[更新] タブのドロップダウンリストを [(なし)] に設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="72673-192">[完了] をクリックしてウィザードを終了します。</span><span class="sxs-lookup"><span data-stu-id="72673-192">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="72673-193">[SuppliersBLL Class s GetSuppliers メソッドを使用するように ObjectDataSource を構成 ![には](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="72673-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span></span>

<span data-ttu-id="72673-194">**図 7**: `SuppliersBLL` クラス s `GetSuppliers` メソッドを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](batch-inserting-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="72673-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-vb/_static/image21.png))</span></span>

<span data-ttu-id="72673-195">`Suppliers` DropDownList で `CompanyName` データフィールドを表示し、`SupplierID` データフィールドを `ListItem` s 値として使用します。</span><span class="sxs-lookup"><span data-stu-id="72673-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>

<span data-ttu-id="72673-196">[![CompanyName データフィールドを表示し、値として [仕入先] を使用します。](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="72673-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span></span>

<span data-ttu-id="72673-197">**図 8**: `CompanyName` データフィールドを表示し、値として `SupplierID` を使用する ([クリックしてフルサイズの画像を表示する](batch-inserting-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="72673-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-vb/_static/image24.png))</span></span>

<span data-ttu-id="72673-198">2番目の DropDownList `Categories` という名前を付け、`CategoriesDataSource`という名前の新しい ObjectDataSource にバインドします。</span><span class="sxs-lookup"><span data-stu-id="72673-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="72673-199">`CategoriesBLL` クラス s `GetCategories` メソッドを使用するように `CategoriesDataSource` ObjectDataSource を構成します。[更新] タブと [削除] タブのドロップダウンリストを (なし) に設定し、[完了] をクリックしてウィザードを完了します。</span><span class="sxs-lookup"><span data-stu-id="72673-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="72673-200">最後に、DropDownList に `CategoryName` データフィールドを表示させると共に、`CategoryID` を値として使用します。</span><span class="sxs-lookup"><span data-stu-id="72673-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="72673-201">これら2つの DropDownLists を追加し、適切に構成された ObjectDataSources ソースにバインドした後、画面は図9のようになります。</span><span class="sxs-lookup"><span data-stu-id="72673-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>

<span data-ttu-id="72673-202">[ヘッダー行に [仕入先] と [カテゴリ] の DropDownLists が含まれるように ![](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="72673-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span></span>

<span data-ttu-id="72673-203">**図 9**: ヘッダー行に `Suppliers` と `Categories` の Dropdownlists が含まれるようになりました ([クリックしてフルサイズの画像を表示](batch-inserting-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="72673-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-vb/_static/image27.png))</span></span>

<span data-ttu-id="72673-204">ここで、新しい製品の名前と価格を収集するためのテキストボックスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="72673-205">5つの製品名と価格行のそれぞれについて、[ツールボックス] から [TextBox] コントロールをデザイナーにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="72673-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="72673-206">テキストボックスの `ID` プロパティを `ProductName1`、`UnitPrice1`、`ProductName2`、`UnitPrice2`、`ProductName3`、`UnitPrice3`などに設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="72673-207">各単価テキストボックスの後に CompareValidator を追加し、`ControlToValidate` プロパティを適切な `ID`に設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="72673-208">また、`Operator` プロパティを `GreaterThanEqual`、`ValueToCompare` 0、および `Type` を `Currency`に設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="72673-209">これらの設定は、入力された場合、価格が0以上の有効な通貨値であることを保証するように CompareValidator に指示します。</span><span class="sxs-lookup"><span data-stu-id="72673-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="72673-210">`Text` プロパティを \*に設定し、`ErrorMessage` には0以上の値を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="72673-211">また、通貨記号は省略してください。</span><span class="sxs-lookup"><span data-stu-id="72673-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="72673-212">`Products` データベーステーブルの `ProductName` フィールドで `NULL` 値が許可されていない場合でも、挿入インターフェイスには RequiredFieldValidator コントロールは含まれません。</span><span class="sxs-lookup"><span data-stu-id="72673-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="72673-213">これは、ユーザーが最大5つの製品を入力できるようにするためです。</span><span class="sxs-lookup"><span data-stu-id="72673-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="72673-214">たとえば、ユーザーが最初の3行の製品名と単価を入力し、最後の2行を空白のままにしている場合は、3つの新しい製品をシステムに追加するだけです。</span><span class="sxs-lookup"><span data-stu-id="72673-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="72673-215">ただし `ProductName` が必要であるため、対応する製品名の値が指定されているかどうかをプログラムによって確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="72673-216">このチェックについては、手順 4. で説明します。</span><span class="sxs-lookup"><span data-stu-id="72673-216">We'll tackle this check in Step 4.</span></span>

<span data-ttu-id="72673-217">ユーザーの入力を検証するときに、値に通貨記号が含まれている場合、CompareValidator は無効なデータを報告します。</span><span class="sxs-lookup"><span data-stu-id="72673-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="72673-218">価格を入力するときに通貨記号を省略するようユーザーに指示する視覚的な合図として使用するために、各単価のテキストボックスの前に $ を追加します。</span><span class="sxs-lookup"><span data-stu-id="72673-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="72673-219">最後に、[`InsertingInterface`] パネルに [ValidationSummary] コントロールを追加し、`ShowMessageBox` プロパティを `True` に設定し、その `ShowSummary` プロパティを `False`に設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="72673-220">これらの設定を使用すると、ユーザーが無効な単価の値を入力すると、問題のあるテキストボックスコントロールの横にアスタリスクが表示され、前に指定したエラーメッセージを表示するクライアント側のメッセージボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="72673-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="72673-221">この時点で、画面は図10のようになります。</span><span class="sxs-lookup"><span data-stu-id="72673-221">At this point, your screen should look similar to Figure 10.</span></span>

<span data-ttu-id="72673-222">[挿入インターフェイスに製品名と価格のテキストボックスが含まれるようになった ![](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="72673-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span></span>

<span data-ttu-id="72673-223">**図 10**: 挿入インターフェイスに製品名と価格のテキストボックスが含まれるようになりました ([クリックすると、フルサイズの画像が表示](batch-inserting-vb/_static/image30.png)されます)</span><span class="sxs-lookup"><span data-stu-id="72673-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-vb/_static/image30.png))</span></span>

<span data-ttu-id="72673-224">次に、[出荷からの製品の追加] ボタンと [キャンセル] ボタンをフッター行に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="72673-225">ツールボックスから2つのボタンコントロールを挿入インターフェイスのフッターにドラッグし、ボタン `ID` プロパティを `CancelButton` `AddProducts` に設定し、プロパティを `Text` して、出荷から製品を追加したり、キャンセルしたりします。</span><span class="sxs-lookup"><span data-stu-id="72673-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="72673-226">さらに、`CancelButton` コントロール s `CausesValidation` プロパティを `false`に設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="72673-227">最後に、2つのインターフェイスのステータスメッセージを表示する Label Web コントロールを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="72673-228">たとえば、ユーザーが製品の新しい出荷物を正常に追加した場合、表示インターフェイスに戻り、確認メッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="72673-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="72673-229">ただし、ユーザーが新しい製品の価格を指定し、製品名を残した場合は、`ProductName` フィールドが必須であるため、警告メッセージを表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="72673-230">このメッセージは、両方のインターフェイスに表示する必要があるため、パネルの外側にあるページの上部に配置します。</span><span class="sxs-lookup"><span data-stu-id="72673-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="72673-231">[ツールボックス] から、デザイナーのページの上部にラベル Web コントロールをドラッグします。</span><span class="sxs-lookup"><span data-stu-id="72673-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="72673-232">`ID` プロパティを `StatusLabel`に設定し、`Text` プロパティをオフにして、`Visible` および `EnableViewState` のプロパティを `False`に設定します。</span><span class="sxs-lookup"><span data-stu-id="72673-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="72673-233">前のチュートリアルで見たように、[`EnableViewState`] プロパティを `False` に設定すると、ラベル s のプロパティ値をプログラムで変更し、後続のポストバック時に自動的に既定値に戻すことができます。</span><span class="sxs-lookup"><span data-stu-id="72673-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `False` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="72673-234">これにより、後続のポストバックで表示されなくなったユーザー操作に応答してステータスメッセージを表示するコードが簡単になります。</span><span class="sxs-lookup"><span data-stu-id="72673-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="72673-235">最後に、`StatusLabel` コントロール s `CssClass` プロパティを [警告] に設定します。これは、大きい、斜体、太字、赤のフォントでテキストを表示する、`Styles.css` で定義されている CSS クラスの名前です。</span><span class="sxs-lookup"><span data-stu-id="72673-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="72673-236">図11は、ラベルが追加および構成された後の Visual Studio デザイナーを示しています。</span><span class="sxs-lookup"><span data-stu-id="72673-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>

<span data-ttu-id="72673-237">[StatusLabel コントロールを2つのパネルコントロールの上に配置 ![には](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="72673-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span></span>

<span data-ttu-id="72673-238">**図 11**: `StatusLabel` コントロールを2つのパネルコントロールの上[に配置する (クリックしてフルサイズのイメージを表示する](batch-inserting-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="72673-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-vb/_static/image33.png))</span></span>

## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="72673-239">手順 3: 表示インターフェイスと挿入インターフェイスの切り替え</span><span class="sxs-lookup"><span data-stu-id="72673-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="72673-240">この時点で、表示および挿入インターフェイスのマークアップが完了しましたが、次の2つのタスクが残っています。</span><span class="sxs-lookup"><span data-stu-id="72673-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="72673-241">表示インターフェイスと挿入インターフェイスの切り替え</span><span class="sxs-lookup"><span data-stu-id="72673-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="72673-242">出荷時の製品をデータベースに追加する</span><span class="sxs-lookup"><span data-stu-id="72673-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="72673-243">現在、表示インターフェイスは表示されていますが、挿入インターフェイスが非表示になっています。</span><span class="sxs-lookup"><span data-stu-id="72673-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="72673-244">これは、`DisplayInterface` Panel s `Visible` プロパティが `True` (既定値) に設定され、`InsertingInterface` Panel s `Visible` プロパティが `False`に設定されているためです。</span><span class="sxs-lookup"><span data-stu-id="72673-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `True` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `False`.</span></span> <span data-ttu-id="72673-245">2つのインターフェイスを切り替えるには、各コントロールの `Visible` プロパティ値を切り替えるだけです。</span><span class="sxs-lookup"><span data-stu-id="72673-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="72673-246">[Product 出荷の処理] ボタンがクリックされたときに、表示インターフェイスから挿入インターフェイスに移動します。</span><span class="sxs-lookup"><span data-stu-id="72673-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="72673-247">したがって、次のコードを含むこのボタン `Click` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="72673-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample4.vb)]

<span data-ttu-id="72673-248">このコードは、`DisplayInterface` パネルを非表示にして、`InsertingInterface` パネルを表示するだけです。</span><span class="sxs-lookup"><span data-stu-id="72673-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="72673-249">次に、挿入インターフェイスの [出荷からの製品の追加] および [キャンセル] ボタンコントロールのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="72673-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="72673-250">これらのボタンのいずれかをクリックすると、表示インターフェイスに戻す必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="72673-251">`ReturnToDisplayInterface`を呼び出すために、すぐに追加するメソッドである `Click` イベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="72673-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="72673-252">`ReturnToDisplayInterface` メソッドでは、[`InsertingInterface`] パネルを非表示にして `DisplayInterface` パネルを表示するだけでなく、Web コントロールを編集前の状態に戻す必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="72673-253">これには、DropDownLists `SelectedIndex` プロパティを0に設定し、TextBox コントロールの `Text` プロパティをクリアする作業が含まれます。</span><span class="sxs-lookup"><span data-stu-id="72673-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="72673-254">表示インターフェイスに戻る前に、コントロールを編集前の状態に戻していない場合はどうなるかを検討してください。</span><span class="sxs-lookup"><span data-stu-id="72673-254">Consider what might happen if we didn't return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="72673-255">ユーザーは、[製品出荷プロセス] ボタンをクリックし、出荷の製品を入力して、[出荷時の製品の追加] をクリックすることがあります。</span><span class="sxs-lookup"><span data-stu-id="72673-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="72673-256">これにより、製品が追加され、ユーザーが表示インターフェイスに返されます。</span><span class="sxs-lookup"><span data-stu-id="72673-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="72673-257">この時点で、ユーザーは別の出荷を追加することが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="72673-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="72673-258">[製品出荷の処理] ボタンをクリックすると、挿入インターフェイスに戻りますが、DropDownList の選択とテキストボックスの値には、前の値が設定されたままになります。</span><span class="sxs-lookup"><span data-stu-id="72673-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample5.vb)]

<span data-ttu-id="72673-259">どちらの `Click` イベントハンドラーも `ReturnToDisplayInterface` メソッドを呼び出しますが、手順 4. で [出荷から製品を追加] `Click` イベントハンドラーに戻り、製品を保存するコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="72673-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="72673-260">`ReturnToDisplayInterface` は、`Suppliers` と `Categories` の DropDownLists を最初のオプションに返すことから始まります。</span><span class="sxs-lookup"><span data-stu-id="72673-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="72673-261">2つの定数 `firstControlID` および `lastControlID`、挿入インターフェイスの製品名と単価のテキストボックスに名前を付けるために使用される開始および終了の制御インデックス値をマークし、テキストボックスコントロールの `Text` プロパティを空の文字列に設定する `For` ループの境界内で使用されます。</span><span class="sxs-lookup"><span data-stu-id="72673-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `For` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="72673-262">最後に、挿入インターフェイスが非表示になり、表示インターフェイスが表示されるように、パネル `Visible` のプロパティがリセットされます。</span><span class="sxs-lookup"><span data-stu-id="72673-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="72673-263">ブラウザーでこのページをテストしてみましょう。</span><span class="sxs-lookup"><span data-stu-id="72673-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="72673-264">最初にページにアクセスしたときに、図5に示すように表示インターフェイスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="72673-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="72673-265">[プロセスの製品出荷] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="72673-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="72673-266">ページがポストバックされ、図12に示すように挿入インターフェイスが表示されるようになります。</span><span class="sxs-lookup"><span data-stu-id="72673-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="72673-267">[出荷からの製品の追加] または [キャンセル] ボタンのいずれかをクリックすると、表示インターフェイスに戻ります。</span><span class="sxs-lookup"><span data-stu-id="72673-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="72673-268">挿入インターフェイスを表示しているときに、[単価] テキストボックスで CompareValidators をテストしてみましょう。</span><span class="sxs-lookup"><span data-stu-id="72673-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="72673-269">[出荷から商品を追加] ボタンをクリックすると、無効な通貨値または価格が0未満の値を持つクライアント側のメッセージボックス警告が表示されます。</span><span class="sxs-lookup"><span data-stu-id="72673-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>

<span data-ttu-id="72673-270">[[プロセスの製品出荷] ボタンをクリックした後に挿入インターフェイスが表示される ![](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="72673-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span></span>

<span data-ttu-id="72673-271">**図 12**: [製品出荷プロセス] ボタンをクリックすると、[挿入] インターフェイスが表示されます ([クリックすると、フルサイズの画像が表示](batch-inserting-vb/_static/image36.png)されます)</span><span class="sxs-lookup"><span data-stu-id="72673-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-vb/_static/image36.png))</span></span>

## <a name="step-4-adding-the-products"></a><span data-ttu-id="72673-272">手順 4: 製品を追加する</span><span class="sxs-lookup"><span data-stu-id="72673-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="72673-273">このチュートリアルでは、[出荷から製品を追加] ボタン `Click` イベントハンドラーで製品をデータベースに保存するだけです。</span><span class="sxs-lookup"><span data-stu-id="72673-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="72673-274">これを行うには、`ProductsDataTable` を作成し、提供された各製品名に対して `ProductsRow` インスタンスを追加します。</span><span class="sxs-lookup"><span data-stu-id="72673-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="72673-275">これらの `ProductsRow` が追加されたら、`ProductsDataTable`で渡される `ProductsBLL` クラス s `UpdateWithTransaction` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="72673-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="72673-276">「[トランザクション内のデータベースの変更のラップ](wrapping-database-modifications-within-a-transaction-vb.md)」チュートリアルで作成した `UpdateWithTransaction` メソッドが、`ProductsTableAdapter`の `UpdateWithTransaction` メソッドに `ProductsDataTable` を渡すことを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="72673-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter`'s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="72673-277">そこから、ADO.NET トランザクションが開始され、データテーブルに追加された各 `ProductsRow` について、TableAdapter が `INSERT` ステートメントをデータベースに発行します。</span><span class="sxs-lookup"><span data-stu-id="72673-277">From there, an ADO.NET transaction is started and the TableAdapter issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="72673-278">すべての製品がエラーなしで追加されると、トランザクションはコミットされ、それ以外の場合はロールバックされます。</span><span class="sxs-lookup"><span data-stu-id="72673-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="72673-279">また、[出荷時の製品の追加] ボタン `Click` イベントハンドラーのコードでは、いくつかのエラーチェックも実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="72673-280">挿入インターフェイスで使用されている RequiredFieldValidators がないため、ユーザーは製品の価格を入力しても名前を省略できます。</span><span class="sxs-lookup"><span data-stu-id="72673-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="72673-281">製品名は必須であるため、このような条件が上ば、ユーザーに警告し、挿入を続行する必要がありません。</span><span class="sxs-lookup"><span data-stu-id="72673-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="72673-282">`Click` イベントハンドラーの完全なコードは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="72673-282">The complete `Click` event handler code follows:</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample6.vb)]

<span data-ttu-id="72673-283">イベントハンドラーは、`Page.IsValid` プロパティが `True`の値を返すことを保証することによって開始されます。</span><span class="sxs-lookup"><span data-stu-id="72673-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `True`.</span></span> <span data-ttu-id="72673-284">`False`が返された場合、1つ以上の CompareValidators が無効なデータを報告していることを意味します。このような場合は、入力した製品を挿入しようとしないか、または、ユーザーが入力した単価の値を `ProductsRow` s `UnitPrice` プロパティに割り当てようとしたときに例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="72673-284">If it returns `False`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="72673-285">次に、新しい `ProductsDataTable` インスタンスを作成します (`products`)。</span><span class="sxs-lookup"><span data-stu-id="72673-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="72673-286">`For` ループは、製品名と単価のテキストボックスを反復処理するために使用され、`Text` のプロパティは `productName` と `unitPrice`のローカル変数に読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="72673-286">A `For` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="72673-287">ユーザーが、対応する製品名ではなく単価の値を入力した場合、単価を指定すると、`StatusLabel` にメッセージが表示されます。製品の名前も含めて、イベントハンドラーを終了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="72673-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="72673-288">製品名が指定されている場合は、`ProductsDataTable` s `NewProductsRow` メソッドを使用して新しい `ProductsRow` インスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="72673-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="72673-289">この新しい `ProductsRow` instance s `ProductName` プロパティは、[現在の製品名] テキストボックスに設定されますが、`SupplierID` プロパティと `CategoryID` プロパティは、[挿入] interface s ヘッダーの DropDownLists の `SelectedValue` プロパティに割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="72673-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="72673-290">ユーザーが製品の価格の値を入力した場合は、`ProductsRow` instance s `UnitPrice` プロパティに割り当てられます。それ以外の場合、プロパティは未割り当てのままになり、データベース内の `UnitPrice` の `NULL` 値になります。</span><span class="sxs-lookup"><span data-stu-id="72673-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="72673-291">最後に、`Discontinued` と `UnitsOnOrder` の各プロパティは、ハードコーディングされた値 `False` と0にそれぞれ割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="72673-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `False` and 0, respectively.</span></span>

<span data-ttu-id="72673-292">`ProductsRow` インスタンスにプロパティが割り当てられると、`ProductsDataTable`に追加されます。</span><span class="sxs-lookup"><span data-stu-id="72673-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="72673-293">`For` ループが完了したら、製品が追加されているかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="72673-293">At the completion of the `For` loop, we check whether any products have been added.</span></span> <span data-ttu-id="72673-294">すべてのユーザーが製品名または価格を入力する前に、[出荷から製品を追加] をクリックしている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="72673-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="72673-295">`ProductsDataTable`に少なくとも1つの製品がある場合は、`ProductsBLL` クラス s `UpdateWithTransaction` メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="72673-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="72673-296">次に、新しく追加した製品が表示インターフェイスに表示されるように、データが `ProductsGrid` GridView に再バインドされます。</span><span class="sxs-lookup"><span data-stu-id="72673-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="72673-297">`StatusLabel` が更新され、確認メッセージが表示され、`ReturnToDisplayInterface` が呼び出され、挿入インターフェイスが非表示になり、表示インターフェイスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="72673-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="72673-298">商品が入力されていない場合、挿入インターフェイスは表示されたままですが、"製品が追加されていません。</span><span class="sxs-lookup"><span data-stu-id="72673-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="72673-299">テキストボックスに製品名と単価を入力してください。</span><span class="sxs-lookup"><span data-stu-id="72673-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="72673-300">図 s 13、14、および15は、挿入と表示のインターフェイスが動作していることを示しています。</span><span class="sxs-lookup"><span data-stu-id="72673-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="72673-301">図13では、ユーザーは、対応する製品名を指定せずに単価の値を入力しました。</span><span class="sxs-lookup"><span data-stu-id="72673-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="72673-302">図14は、3つの新しい製品が正常に追加された後の表示インターフェイスを示しています。図15は、新しく追加された2つの製品を GridView に示しています (3 番目の製品は前のページにあります)。</span><span class="sxs-lookup"><span data-stu-id="72673-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>

<span data-ttu-id="72673-303">[単価を入力するときに製品名が必要 ![](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="72673-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span></span>

<span data-ttu-id="72673-304">**図 13**: 単価を入力するときに製品名が必要である ([クリックしてフルサイズの画像を表示する](batch-inserting-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="72673-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-vb/_static/image39.png))</span></span>

<span data-ttu-id="72673-305">[![業者に対して3つの新しい Veggies が追加されました。](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="72673-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span></span>

<span data-ttu-id="72673-306">**図 14**: Supplier i s の新しい Veggies が3つ追加されました ([クリックすると、フルサイズの画像が表示](batch-inserting-vb/_static/image42.png)されます)</span><span class="sxs-lookup"><span data-stu-id="72673-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-vb/_static/image42.png))</span></span>

<span data-ttu-id="72673-307">[新しい製品が GridView の最後のページにある ![](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="72673-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span></span>

<span data-ttu-id="72673-308">**図 15**: GridView の最後のページに新しい製品があります ([クリックすると、フルサイズの画像が表示](batch-inserting-vb/_static/image45.png)されます)。</span><span class="sxs-lookup"><span data-stu-id="72673-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-vb/_static/image45.png))</span></span>

> [!NOTE]
> <span data-ttu-id="72673-309">このチュートリアルで使用するバッチ挿入ロジックでは、トランザクションのスコープ内で挿入をラップします。</span><span class="sxs-lookup"><span data-stu-id="72673-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="72673-310">これを確認するには、データベースレベルのエラーを意図的に導入します。</span><span class="sxs-lookup"><span data-stu-id="72673-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="72673-311">たとえば、新しい `ProductsRow` インスタンスの `CategoryID` プロパティを `Categories` DropDownList で選択されている値に割り当てるのではなく、`i * 5`などの値に割り当てます。</span><span class="sxs-lookup"><span data-stu-id="72673-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="72673-312">ここで `i` はループインデクサーで、1 ~ 5 の範囲の値を持ちます。</span><span class="sxs-lookup"><span data-stu-id="72673-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="72673-313">したがって、バッチ挿入に2つ以上の製品を追加する場合、最初の製品には有効な `CategoryID` 値 (5) が設定されますが、それ以降の製品では、`Categories` テーブルの値 `CategoryID` に一致しない値が `CategoryID` されます。</span><span class="sxs-lookup"><span data-stu-id="72673-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="72673-314">実質的には、最初の `INSERT` は成功しますが、それ以降は外部キー制約違反で失敗します。</span><span class="sxs-lookup"><span data-stu-id="72673-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="72673-315">バッチ挿入はアトミックであるため、最初の `INSERT` がロールバックされ、バッチ挿入プロセスが開始される前にデータベースがその状態に戻ります。</span><span class="sxs-lookup"><span data-stu-id="72673-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>

## <a name="summary"></a><span data-ttu-id="72673-316">まとめ</span><span class="sxs-lookup"><span data-stu-id="72673-316">Summary</span></span>

<span data-ttu-id="72673-317">このチュートリアルと前の2つのチュートリアルでは、データのバッチの更新、削除、および挿入を可能にするインターフェイスを作成しました。トランザクションを使用する場合は、[トランザクション内でデータベースをラップ](wrapping-database-modifications-within-a-transaction-vb.md)することで、データアクセス層に追加しました。</span><span class="sxs-lookup"><span data-stu-id="72673-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial.</span></span> <span data-ttu-id="72673-318">特定のシナリオでは、このようなバッチ処理のユーザーインターフェイスを使用すると、基になるデータの整合性を維持しながら、クリック、ポストバック、キーボードからマウスへのコンテキストスイッチの数を減らすことで、エンドユーザーの効率を大幅に向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="72673-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="72673-319">このチュートリアルでは、バッチ処理されたデータの使用方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="72673-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="72673-320">次の一連のチュートリアルでは、TableAdapter のメソッドでのストアドプロシージャの使用、DAL での接続とコマンドレベルの設定の構成、接続文字列の暗号化など、高度なデータアクセス層のさまざまなシナリオについて説明します。</span><span class="sxs-lookup"><span data-stu-id="72673-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="72673-321">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="72673-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="72673-322">著者について</span><span class="sxs-lookup"><span data-stu-id="72673-322">About the Author</span></span>

<span data-ttu-id="72673-323">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="72673-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="72673-324">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="72673-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="72673-325">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="72673-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="72673-326">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="72673-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="72673-327">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="72673-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="72673-328">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="72673-328">Special Thanks To</span></span>

<span data-ttu-id="72673-329">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="72673-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="72673-330">このチュートリアルのリードレビュー担当者は、Hilton Giesenow と S ren Jacob Lauritsen でした。</span><span class="sxs-lookup"><span data-stu-id="72673-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="72673-331">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="72673-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="72673-332">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="72673-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="72673-333">[[戻る]](batch-deleting-vb.md)</span><span class="sxs-lookup"><span data-stu-id="72673-333">[Previous](batch-deleting-vb.md)</span></span>
