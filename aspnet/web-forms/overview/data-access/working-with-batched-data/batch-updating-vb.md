---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
title: バッチ更新 (VB) |Microsoft Docs
author: rick-anderson
description: 1回の操作で複数のデータベースレコードを更新する方法について説明します。 ユーザーインターフェイスレイヤーでは、各行が編集可能な GridView をビルドします。 データ...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: d191a204-d7ea-458d-b81c-0b9049ecb55f
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
msc.type: authoredcontent
ms.openlocfilehash: f0bb83b17585876dd6d28a5893a223cce15da31d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78501310"
---
# <a name="batch-updating-vb"></a><span data-ttu-id="8f04e-105">一括更新 (VB)</span><span class="sxs-lookup"><span data-stu-id="8f04e-105">Batch Updating (VB)</span></span>

<span data-ttu-id="8f04e-106">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8f04e-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8f04e-107">[コードのダウンロード](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip)または[PDF のダウンロード](batch-updating-vb/_static/datatutorial64vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8f04e-107">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip) or [Download PDF](batch-updating-vb/_static/datatutorial64vb1.pdf)</span></span>

> <span data-ttu-id="8f04e-108">1回の操作で複数のデータベースレコードを更新する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="8f04e-109">ユーザーインターフェイスレイヤーでは、各行が編集可能な GridView をビルドします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="8f04e-110">データアクセス層では、1つのトランザクション内に複数の更新操作をラップして、すべての更新が成功するか、すべての更新がロールバックされるようにします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="8f04e-111">はじめに</span><span class="sxs-lookup"><span data-stu-id="8f04e-111">Introduction</span></span>

<span data-ttu-id="8f04e-112">前の[チュートリアル](wrapping-database-modifications-within-a-transaction-vb.md)では、データアクセス層を拡張して、データベーストランザクションのサポートを追加する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="8f04e-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="8f04e-113">データベーストランザクションは、一連のデータ変更ステートメントが1つのアトミック操作として扱われることを保証します。これにより、すべての変更が失敗するか、すべてが成功します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="8f04e-114">この低レベルの DAL 機能を使用して、バッチデータ変更インターフェイスを作成する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="8f04e-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="8f04e-115">このチュートリアルでは、各行を編集できる GridView をビルドします (図1を参照)。</span><span class="sxs-lookup"><span data-stu-id="8f04e-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="8f04e-116">各行は編集インターフェイスにレンダリングされるため、[編集]、[更新]、および [キャンセル] の各ボタンの列は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="8f04e-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="8f04e-117">このページには、2つの [Update Products] ボタンがあります。このボタンをクリックすると、GridView 行が列挙され、データベースが更新されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>

<span data-ttu-id="8f04e-118">[GridView の各行が編集可能 ![](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-118">[![Each Row in the GridView is Editable](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span></span>

<span data-ttu-id="8f04e-119">**図 1**: GridView の各行が編集可能である ([クリックしてフルサイズの画像を表示する](batch-updating-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="8f04e-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-vb/_static/image2.png))</span></span>

<span data-ttu-id="8f04e-120">始めましょう!</span><span class="sxs-lookup"><span data-stu-id="8f04e-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="8f04e-121">[バッチ更新の実行](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md)に関するチュートリアルでは、DataList コントロールを使用してバッチ編集インターフェイスを作成しました。</span><span class="sxs-lookup"><span data-stu-id="8f04e-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="8f04e-122">このチュートリアルは、GridView を使用しているでの前のチュートリアルとは異なり、バッチ更新はトランザクションのスコープ内で実行されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="8f04e-123">このチュートリアルを完了すると、前のチュートリアルに戻って、前のチュートリアルで追加したデータベーストランザクション関連の機能を使用するように更新することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>

## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="8f04e-124">すべての GridView 行を編集できるようにするための手順を確認しています</span><span class="sxs-lookup"><span data-stu-id="8f04e-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="8f04e-125">[「データの挿入、更新、および削除の概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)」で説明したように、GridView は、基になるデータを行単位で編集するための組み込みサポートを提供します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="8f04e-126">内部的には、GridView は、 [`EditIndex` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx)を使用して編集可能な行を示します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="8f04e-127">GridView はデータソースにバインドされているため、各行のインデックスが `EditIndex`の値と等しいかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="8f04e-128">その場合、その行のフィールドは編集インターフェイスを使用して表示されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="8f04e-129">BoundFields の場合、編集インターフェイスは、BoundField s `DataField` プロパティによって指定されたデータフィールドの値が `Text` プロパティに割り当てられている TextBox です。</span><span class="sxs-lookup"><span data-stu-id="8f04e-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="8f04e-130">TemplateFields の場合、`ItemTemplate`の代わりに `EditItemTemplate` が使用されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="8f04e-131">ユーザーが行 s の [編集] ボタンをクリックしたときに、編集ワークフローが開始されることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="8f04e-132">これにより、ポストバックが発生し、GridView s `EditIndex` プロパティがクリックされた行 s インデックスに設定され、データがグリッドに再バインドされます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="8f04e-133">行 s の [キャンセル] ボタンがクリックされると、ポストバック時に、データをグリッドに再バインドする前に `EditIndex` が `-1` の値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="8f04e-134">GridView の行はゼロでインデックス作成を開始するため、`EditIndex` を `-1` に設定すると、GridView が読み取り専用モードで表示されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="8f04e-135">`EditIndex` プロパティは行ごとの編集に適していますが、バッチ編集用には設計されていません。</span><span class="sxs-lookup"><span data-stu-id="8f04e-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="8f04e-136">GridView 全体を編集できるようにするには、編集インターフェイスを使用して各行を表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="8f04e-137">これを実現する最も簡単な方法は、`ItemTemplate`で定義されている編集インターフェイスを使用して、編集可能な各フィールドが TemplateField として実装されている場所を作成することです。</span><span class="sxs-lookup"><span data-stu-id="8f04e-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="8f04e-138">次のいくつかの手順で、完全に編集可能な GridView を作成します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="8f04e-139">手順 1. では、まず GridView とその ObjectDataSource を作成し、その BoundFields と CheckBoxField を TemplateFields に変換します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="8f04e-140">手順 2. と 3. で、編集インターフェイスを TemplateFields `EditItemTemplate` s から `ItemTemplate` s に移動します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="8f04e-141">手順 1: 製品情報の表示</span><span class="sxs-lookup"><span data-stu-id="8f04e-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="8f04e-142">行が編集可能な GridView を作成することを心配する前に、まず製品情報を表示してみましょう。</span><span class="sxs-lookup"><span data-stu-id="8f04e-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="8f04e-143">`BatchData` フォルダーの [`BatchUpdate.aspx`] ページを開き、[ツールボックス] から GridView をデザイナーにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="8f04e-144">GridView の `ID` を `ProductsGrid` に設定し、そのスマートタグから、`ProductsDataSource`という名前の新しい ObjectDataSource にバインドするように選択します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="8f04e-145">`ProductsBLL` クラス s `GetProducts` メソッドからデータを取得するように ObjectDataSource を構成します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>

<span data-ttu-id="8f04e-146">[製品の Bll クラスを使用するように ObjectDataSource を構成 ![には](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span></span>

<span data-ttu-id="8f04e-147">**図 2**: `ProductsBLL` クラスを使用するように ObjectDataSource を構成する ([クリックすると、フルサイズの画像が表示](batch-updating-vb/_static/image4.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8f04e-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image4.png))</span></span>

<span data-ttu-id="8f04e-148">[GetProducts メソッドを使用して製品データを取得 ![には](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span></span>

<span data-ttu-id="8f04e-149">**図 3**: `GetProducts` メソッドを使用して製品データを取得[する (クリックしてフルサイズの画像を表示する](batch-updating-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="8f04e-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-vb/_static/image6.png))</span></span>

<span data-ttu-id="8f04e-150">GridView と同様に、ObjectDataSource の変更機能は行単位で動作するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="8f04e-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="8f04e-151">一連のレコードを更新するには、データをバッチ処理して BLL に渡す、ASP.NET ページの分離コードクラスに少しコードを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="8f04e-152">そのため、ObjectDataSource s UPDATE、INSERT、および DELETE の各タブのドロップダウンリストを (None) に設定します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="8f04e-153">[完了] をクリックしてウィザードを終了します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-153">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="8f04e-154">[[更新]、[挿入]、[削除] の各タブのドロップダウンリストを [(なし)] に設定 ![ます。](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span></span>

<span data-ttu-id="8f04e-155">**図 4**: [更新]、[挿入]、[削除] の各タブのドロップダウンリストを (なし) に設定する ([クリックしてフルサイズのイメージを表示する](batch-updating-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="8f04e-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image8.png))</span></span>

<span data-ttu-id="8f04e-156">データソースの構成ウィザードを完了すると、ObjectDataSource s 宣言マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample1.aspx)]

<span data-ttu-id="8f04e-157">データソースの構成ウィザードを完了すると、Visual Studio によって、GridView の product データフィールドの連結フィールドと CheckBoxField が作成されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="8f04e-158">このチュートリアルでは、を使用して、製品の名前、カテゴリ、価格、および廃止された状態を表示および編集できるようにします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="8f04e-159">`ProductName`、`CategoryName`、`UnitPrice`、`Discontinued` の各フィールドを除くすべてのフィールドを削除し、最初の3つのフィールドの `HeaderText` プロパティの名前をそれぞれ Product、Category、および Price に変更します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="8f04e-160">最後に、GridView s スマートタグの [ページングを有効にし、並べ替えを有効にする] チェックボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="8f04e-161">この時点で、GridView には、3つの連結されたフィールド (`ProductName`、`CategoryName`、および `UnitPrice`) と CheckBoxField (`Discontinued`) があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="8f04e-162">これらの4つのフィールドを TemplateFields に変換してから、編集インターフェイスを TemplateField s `EditItemTemplate` から `ItemTemplate`に移動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="8f04e-163">「[データ変更インターフェイスのカスタマイズ](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)」チュートリアルの templatefields の作成とカスタマイズについて説明します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span> <span data-ttu-id="8f04e-164">ここでは、BoundFields と CheckBoxField を TemplateFields に変換し、その `ItemTemplate` で編集インターフェイスを定義する手順について説明しますが、行き詰まった場合やリフレッシャーが必要な場合は、前のチュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>

<span data-ttu-id="8f04e-165">GridView s スマートタグから [列の編集] リンクをクリックして、[フィールド] ダイアログボックスを開きます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="8f04e-166">次に、各フィールドを選択し、[このフィールドを TemplateField に変換する] リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>

![既存の BoundFields と CheckBoxField を TemplateFields に変換します。](batch-updating-vb/_static/image5.gif)

<span data-ttu-id="8f04e-168">**図 5**: 既存の boundfields と CheckBoxField を Templatefields に変換する</span><span class="sxs-lookup"><span data-stu-id="8f04e-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateFields</span></span>

<span data-ttu-id="8f04e-169">各フィールドが TemplateField になったので、編集インターフェイスを `EditItemTemplate` s から `ItemTemplate` s に移動する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="8f04e-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="8f04e-170">手順 2:`ProductName`、`UnitPrice`、および`Discontinued`の編集インターフェイスの作成</span><span class="sxs-lookup"><span data-stu-id="8f04e-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="8f04e-171">`ProductName`、`UnitPrice`、および `Discontinued` 編集インターフェイスの作成は、この手順のトピックです。各インターフェイスは TemplateField s `EditItemTemplate`で既に定義されているため、非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="8f04e-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="8f04e-172">`CategoryName` 編集インターフェイスを作成することは、該当するカテゴリの DropDownList を作成する必要があるため、少し複雑になります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="8f04e-173">この `CategoryName` 編集インターフェイスについては、手順 3. で説明します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="8f04e-174">では、`ProductName` TemplateField から始めましょう。</span><span class="sxs-lookup"><span data-stu-id="8f04e-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="8f04e-175">GridView s スマートタグから [Edit Templates] リンクをクリックし、`ProductName` TemplateField s `EditItemTemplate`にドリルダウンします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="8f04e-176">テキストボックスを選択し、クリップボードにコピーして、`ProductName` TemplateField s `ItemTemplate`に貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="8f04e-177">TextBox s `ID` プロパティを `ProductName`に変更します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="8f04e-178">次に、`ItemTemplate` に RequiredFieldValidator を追加して、ユーザーが各製品名に値を提供するようにします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="8f04e-179">`ControlToValidate` プロパティを ProductName に設定し、`ErrorMessage` プロパティに製品の名前を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="8f04e-180">\*する `Text` プロパティ。</span><span class="sxs-lookup"><span data-stu-id="8f04e-180">and the `Text` property to \*.</span></span> <span data-ttu-id="8f04e-181">これらを `ItemTemplate`に追加すると、画面は図6のようになります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>

<span data-ttu-id="8f04e-182">[![ProductName TemplateField にテキストボックスと RequiredFieldValidator が含まれるようになりました。](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span></span>

<span data-ttu-id="8f04e-183">**図 6**: `ProductName` TemplateField にテキストボックスと RequiredFieldValidator が含まれるようになりました ([クリックすると、フルサイズの画像が表示](batch-updating-vb/_static/image10.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8f04e-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-vb/_static/image10.png))</span></span>

<span data-ttu-id="8f04e-184">`UnitPrice` 編集インターフェイスの場合は、まず `EditItemTemplate` から `ItemTemplate`にテキストボックスをコピーします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="8f04e-185">次に、テキストボックスの前に $ を置き、その `ID` プロパティを UnitPrice に、その `Columns` プロパティを8に設定します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="8f04e-186">また、CompareValidator を `UnitPrice` s `ItemTemplate` に追加して、ユーザーが入力した値が $0.00 以上の有効な通貨値であることを確認します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="8f04e-187">[バリデーター s `ControlToValidate`] プロパティを [UnitPrice] に、[`ErrorMessage`] プロパティを [UnitPrice] に設定し、有効な通貨値を入力する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="8f04e-188">通貨記号を省略し、その `Text` プロパティを \*に、`Type` プロパティを `Currency`に、その `Operator` プロパティを0に、その `GreaterThanEqual`プロパティを0にします。`ValueToCompare`</span><span class="sxs-lookup"><span data-stu-id="8f04e-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>

<span data-ttu-id="8f04e-189">[入力した価格が負でない通貨値であることを確認するために CompareValidator を追加 ![ます。](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span></span>

<span data-ttu-id="8f04e-190">**図 7**: 入力した価格が負でない通貨値であることを確認するために CompareValidator を追加する ([クリックすると、フルサイズの画像が表示](batch-updating-vb/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8f04e-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-vb/_static/image12.png))</span></span>

<span data-ttu-id="8f04e-191">`Discontinued` TemplateField の場合、`ItemTemplate`で既に定義されているチェックボックスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="8f04e-192">単純に `ID` を "廃止" に設定し、その `Enabled` プロパティを `True`に設定します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-192">Simply set its `ID` to Discontinued and its `Enabled` property to `True`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="8f04e-193">手順 3:`CategoryName`編集インターフェイスを作成する</span><span class="sxs-lookup"><span data-stu-id="8f04e-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="8f04e-194">`CategoryName` TemplateField s `EditItemTemplate` の編集インターフェイスには、`CategoryName` データフィールドの値を表示するテキストボックスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="8f04e-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="8f04e-195">これを、使用可能なカテゴリを一覧表示する DropDownList に置き換える必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="8f04e-196">「[データ変更インターフェイスのカスタマイズ](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)」チュートリアルでは、テキストボックスではなく DropDownList を含めるようにテンプレートをカスタマイズする方法について詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="8f04e-197">手順は完了しましたが、tersely に表示されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="8f04e-198">カテゴリ DropDownList の作成と構成の詳細については、「[データ変更インターフェイスのカスタマイズ](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)」チュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span>

<span data-ttu-id="8f04e-199">[DropDownList] をツールボックスから `CategoryName` TemplateField s `ItemTemplate`にドラッグし、その `ID` を `Categories`に設定します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="8f04e-200">この時点では、通常、新しい ObjectDataSource を作成して、そのスマートタグを使用して DropDownLists s データソースを定義します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="8f04e-201">ただし、`ItemTemplate`内に ObjectDataSource が追加されるため、各 GridView 行に対して ObjectDataSource インスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="8f04e-202">代わりに、によって、GridView の TemplateFields フィールド以外に ObjectDataSource が作成されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="8f04e-203">テンプレートの編集を終了し、ObjectDataSource をツールボックスから `ProductsDataSource` ObjectDataSource の下のデザイナーにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="8f04e-204">新しい ObjectDataSource `CategoriesDataSource` という名前を設定し、`CategoriesBLL` クラス s `GetCategories` メソッドを使用するように構成します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>

<span data-ttu-id="8f04e-205">[カテゴリ Bll クラスを使用するように ObjectDataSource を構成 ![には](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span></span>

<span data-ttu-id="8f04e-206">**図 8**: `CategoriesBLL` クラスを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](batch-updating-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="8f04e-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image14.png))</span></span>

<span data-ttu-id="8f04e-207">[GetCategories メソッドを使用してカテゴリデータを取得 ![には](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span></span>

<span data-ttu-id="8f04e-208">**図 9**: `GetCategories` メソッドを使用してカテゴリデータを取得[する (クリックしてフルサイズの画像を表示する](batch-updating-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="8f04e-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-vb/_static/image16.png))</span></span>

<span data-ttu-id="8f04e-209">この ObjectDataSource はデータを取得するためにのみ使用されるため、[更新] タブと [削除] タブのドロップダウンリストを [(なし)] に設定します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="8f04e-210">[完了] をクリックしてウィザードを終了します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-210">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="8f04e-211">[[更新] タブと [削除] タブのドロップダウンリストを [(なし)] に設定 ![ます。](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span></span>

<span data-ttu-id="8f04e-212">**図 10**: [更新] タブと [削除] タブのドロップダウンリストを (なし) に設定する ([クリックすると、フルサイズの画像が表示](batch-updating-vb/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8f04e-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image18.png))</span></span>

<span data-ttu-id="8f04e-213">ウィザードを完了すると、`CategoriesDataSource` s 宣言マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample2.aspx)]

<span data-ttu-id="8f04e-214">`CategoriesDataSource` 作成して構成した状態で `CategoryName` TemplateField s `ItemTemplate` に戻り、DropDownList s スマートタグから [データソースの選択] リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="8f04e-215">データソース構成ウィザードで、最初のドロップダウンリストから [`CategoriesDataSource`] オプションを選択し、値として表示と `CategoryID` に `CategoryName` 使用することを選択します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>

<span data-ttu-id="8f04e-216">[DropDownList をカテゴリデータソースにバインド ![には](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span></span>

<span data-ttu-id="8f04e-217">**図 11**: DropDownList を `CategoriesDataSource` にバインドする ([クリックすると、フルサイズの画像が表示](batch-updating-vb/_static/image20.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8f04e-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-vb/_static/image20.png))</span></span>

<span data-ttu-id="8f04e-218">この時点で、`Categories` DropDownList はすべてのカテゴリを一覧表示しますが、GridView 行にバインドされている製品の適切なカテゴリはまだ自動的に選択されていません。</span><span class="sxs-lookup"><span data-stu-id="8f04e-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="8f04e-219">これを実現するには、`Categories` DropDownList s `SelectedValue` を製品の `CategoryID` 値に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="8f04e-220">「DropDownList s」スマートタグから [データバインディングの編集] リンクをクリックし、図12に示すように、`SelectedValue` プロパティを `CategoryID` データフィールドに関連付けます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>

![Product s CategoryID 値を DropDownList s SelectedValue プロパティにバインドします。](batch-updating-vb/_static/image12.gif)

<span data-ttu-id="8f04e-222">**図 12**: `CategoryID` 値を DropDownList s `SelectedValue` プロパティにバインドする</span><span class="sxs-lookup"><span data-stu-id="8f04e-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>

<span data-ttu-id="8f04e-223">最後に1つの問題が残っています。製品に `CategoryID` 値が指定されていない場合、`SelectedValue` の databinding ステートメントで例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="8f04e-224">これは、DropDownList にカテゴリの項目のみが含まれており、`CategoryID`の `NULL` データベース値を持つ製品のオプションが提供されていないためです。</span><span class="sxs-lookup"><span data-stu-id="8f04e-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="8f04e-225">これを解決するには、DropDownList s `AppendDataBoundItems` プロパティを `True` に設定し、新しい項目を DropDownList に追加します。これにより、宣言構文の `Value` プロパティを省略します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `True` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="8f04e-226">つまり、`Categories` DropDownList s の宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample3.aspx)]

<span data-ttu-id="8f04e-227">`Value` 属性が明示的に空の文字列に設定されている `<asp:ListItem Value="">` を選択する方法に注意してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="8f04e-228">`NULL` のケースを処理するためにこの追加の DropDownList 項目が必要な理由と、`Value` プロパティを空の文字列に割り当てる理由について詳しく説明するために、「[データ変更インターフェイスのカスタマイズ](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)」チュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="8f04e-229">ここでは、パフォーマンスとスケーラビリティに関する潜在的な問題について説明します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="8f04e-230">各行には、データソースとして `CategoriesDataSource` を使用する DropDownList があるため、`CategoriesBLL` class s `GetCategories` メソッドは、ページへのアクセスごとに*n*回呼び出されます。ここで、 *n*は GridView の行数です。</span><span class="sxs-lookup"><span data-stu-id="8f04e-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="8f04e-231">これらの*n* `GetCategories` を呼び出すと、データベースに対して*n 個*のクエリが発生します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="8f04e-232">このデータベースへの影響は、要求ごとのキャッシュ、または SQL キャッシュの依存関係または非常に短い時間ベースの有効期限を使用してキャッシュレイヤーを介して返されたカテゴリをキャッシュすることによって軽減できます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="8f04e-233">要求ごとのキャッシュオプションの詳細については、「[要求ごとのキャッシュストアの`HttpContext.Items`](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>

## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="8f04e-234">手順 4: 編集インターフェイスを完了する</span><span class="sxs-lookup"><span data-stu-id="8f04e-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="8f04e-235">進行状況を表示するために、GridView のテンプレートにいくつかの変更を加えました。</span><span class="sxs-lookup"><span data-stu-id="8f04e-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="8f04e-236">ブラウザーで進行状況を確認してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="8f04e-237">図13に示すように、各行は、セルの編集インターフェイスを含む `ItemTemplate`を使用してレンダリングされます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>

<span data-ttu-id="8f04e-238">[各 GridView 行が編集可能 ![](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-238">[![Each GridView Row is Editable](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span></span>

<span data-ttu-id="8f04e-239">**図 13**: 各 GridView 行が編集可能である ([クリックしてフルサイズの画像を表示する](batch-updating-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="8f04e-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-vb/_static/image22.png))</span></span>

<span data-ttu-id="8f04e-240">この時点では、いくつかの軽微な書式設定の問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="8f04e-241">まず、`UnitPrice` 値には4つの小数点が含まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="8f04e-242">この問題を解決するには、`UnitPrice` TemplateField s `ItemTemplate` に戻り、TextBox s のスマートタグから [自動接続の編集] リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="8f04e-243">次に、`Text` プロパティを数値として書式設定するように指定します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-243">Next, specify that the `Text` property should be formatted as a number.</span></span>

![テキストプロパティを数値として書式設定する](batch-updating-vb/_static/image14.gif)

<span data-ttu-id="8f04e-245">**図 14**: `Text` のプロパティを数値として書式設定する</span><span class="sxs-lookup"><span data-stu-id="8f04e-245">**Figure 14**: Format the `Text` Property as a Number</span></span>

<span data-ttu-id="8f04e-246">次に、[`Discontinued`] 列のチェックボックスを中央に配置します (左揃えではなく)。</span><span class="sxs-lookup"><span data-stu-id="8f04e-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="8f04e-247">GridView s スマートタグから [列の編集] をクリックし、左下隅のフィールドの一覧から `Discontinued` TemplateField を選択します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="8f04e-248">図15に示すように、`ItemStyle` にドリルダウンし、`HorizontalAlign` プロパティを Center に設定します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>

![[中止] チェックボックスを中央にする](batch-updating-vb/_static/image15.gif)

<span data-ttu-id="8f04e-250">**図 15**: `Discontinued` チェックボックスを中央に配置する</span><span class="sxs-lookup"><span data-stu-id="8f04e-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>

<span data-ttu-id="8f04e-251">次に、ValidationSummary コントロールをページに追加し、その `ShowMessageBox` プロパティを `True` に設定し、その `ShowSummary` プロパティを `False`に設定します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="8f04e-252">また、ボタン Web コントロールも追加します。このボタンをクリックすると、ユーザーの変更が更新されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="8f04e-253">具体的には、2つのボタン Web コントロール (GridView の上に1つ、その下に1つ) を追加し、両方のコントロールに `Text` プロパティを設定して製品を更新します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="8f04e-254">GridView の編集インターフェイスは TemplateFields `ItemTemplate` s で定義されているため、`EditItemTemplate` のは不要であり、削除される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="8f04e-255">上記の書式変更を説明し、ボタンコントロールを追加し、不要な `EditItemTemplate` を削除すると、ページ s の宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample4.aspx)]

<span data-ttu-id="8f04e-256">図16は、ボタン Web コントロールが追加され、書式が変更された後にブラウザーで表示するときに、このページを示しています。</span><span class="sxs-lookup"><span data-stu-id="8f04e-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>

<span data-ttu-id="8f04e-257">[ページに2つの [更新製品] ボタンが追加され ![](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="8f04e-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span></span>

<span data-ttu-id="8f04e-258">**図 16**: ページに2つの [製品の更新] ボタンが追加されました ([クリックすると、フルサイズの画像が表示](batch-updating-vb/_static/image24.png)されます)</span><span class="sxs-lookup"><span data-stu-id="8f04e-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-vb/_static/image24.png))</span></span>

## <a name="step-5-updating-the-products"></a><span data-ttu-id="8f04e-259">手順 5: 製品を更新する</span><span class="sxs-lookup"><span data-stu-id="8f04e-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="8f04e-260">ユーザーがこのページにアクセスすると、変更が加えられ、2つの [製品の更新] ボタンのいずれかをクリックします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="8f04e-261">その時点で、行ごとにユーザーが入力した値を `ProductsDataTable` インスタンスに保存してから、その `ProductsDataTable` インスタンスを DAL の `UpdateWithTransaction` メソッドに渡す BLL メソッドに渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="8f04e-262">[前のチュートリアル](wrapping-database-modifications-within-a-transaction-vb.md)で作成した `UpdateWithTransaction` メソッドを使用すると、変更のバッチがアトミック操作として更新されるようになります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="8f04e-263">`BatchUpdate.aspx.vb` に `BatchUpdate` という名前のメソッドを作成し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.vb` and add the following code:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample5.vb)]

<span data-ttu-id="8f04e-264">このメソッドは、まず、BLL s `GetProducts` メソッドの呼び出しを使用して、すべての製品を `ProductsDataTable` に戻します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="8f04e-265">次に、`ProductGrid` GridView s [`Rows` コレクション](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx)を列挙します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="8f04e-266">`Rows` コレクションには、GridView に表示される各行の[`GridViewRow` インスタンス](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx)が含まれています。</span><span class="sxs-lookup"><span data-stu-id="8f04e-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="8f04e-267">1ページあたり最大10行を表示しているため、GridView の `Rows` コレクションに含まれる項目数は10個までです。</span><span class="sxs-lookup"><span data-stu-id="8f04e-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="8f04e-268">行ごとに、`ProductID` が `DataKeys` コレクションからグラブされ、適切な `ProductsRow` が `ProductsDataTable`から選択されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="8f04e-269">4つの TemplateField 入力コントロールがプログラムによって参照され、その値が `ProductsRow` インスタンスのプロパティに割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="8f04e-270">各 GridView 行 s の値を使用して `ProductsDataTable`を更新した後は、前のチュートリアルで説明したように、BLL の `UpdateWithTransaction` メソッドに渡されます。このメソッドは、単に DAL s `UpdateWithTransaction` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="8f04e-271">このチュートリアルで使用するバッチ更新アルゴリズムでは、製品の情報が変更されているかどうかに関係なく、GridView の行に対応する `ProductsDataTable` の各行を更新します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="8f04e-272">このようなブラインド更新は、通常はパフォーマンス上の問題ではありませんが、データベーステーブルへの変更を監査すると、余分なレコードが生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-272">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="8f04e-273">[バッチ更新の実行](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md)に関するチュートリアルでは、DataList を使用してバッチ更新インターフェイスを探索し、ユーザーが実際に変更したレコードのみを更新するコードを追加しました。</span><span class="sxs-lookup"><span data-stu-id="8f04e-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="8f04e-274">必要に応じて、[バッチ更新を実行](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md)する方法を自由に使用して、このチュートリアルのコードを更新してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="8f04e-275">データソースをそのスマートタグを使用して GridView にバインドすると、Visual Studio によって、データソースの主キー値が GridView s `DataKeyNames` プロパティに自動的に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="8f04e-276">手順 1. で説明したように、gridview s スマートタグを介して ObjectDataSource を GridView にバインドしなかった場合は、`DataKeys` コレクションを使用して各行の `ProductID` 値にアクセスするために、GridView の `DataKeyNames` プロパティを ProductID に手動で設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>

<span data-ttu-id="8f04e-277">`BatchUpdate` で使用されるコードは、BLL の `UpdateProduct` メソッドで使用されるコードと似ていますが、`UpdateProduct` メソッドでは、アーキテクチャから取得される `ProductRow` インスタンスは1つだけであるという主な違いがあります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="8f04e-278">`ProductRow` のプロパティを割り当てるコードは、全体的なパターンと同じように、`BatchUpdate`の `For Each` ループ内のコードと `UpdateProducts` メソッドとの間で同じです。</span><span class="sxs-lookup"><span data-stu-id="8f04e-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `For Each` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="8f04e-279">このチュートリアルを完了するには、[製品の更新] ボタンのいずれかをクリックしたときに、`BatchUpdate` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="8f04e-280">これらの2つのボタンコントロールの `Click` イベントのイベントハンドラーを作成し、イベントハンドラーに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample6.vb)]

<span data-ttu-id="8f04e-281">最初に、`BatchUpdate`に対して呼び出しが行われます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="8f04e-282">次に、 [`ClientScript` プロパティ](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx)を使用して、製品が更新されたことを読み取るメッセージボックスを表示する JavaScript を挿入します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-282">Next, the [`ClientScript` property](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx) is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="8f04e-283">このコードをテストするには、少し時間を取ってください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-283">Take a minute to test out this code.</span></span> <span data-ttu-id="8f04e-284">ブラウザーを使用して `BatchUpdate.aspx` にアクセスし、いくつかの行を編集して、[更新製品] ボタンのいずれかをクリックします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="8f04e-285">入力検証エラーがないと仮定すると、製品が更新されたことを読み取るメッセージボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="8f04e-286">更新の原子性を検証するには、`UnitPrice` 値1234.56 を禁止するランダム `CHECK` 制約を追加することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="8f04e-287">次に、`BatchUpdate.aspx`から複数のレコードを編集し、製品の `UnitPrice` 値の1つを禁止値 (1234.56) に設定します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="8f04e-288">そのバッチ操作を元の値にロールバックしたときに、他の変更と共に [製品の更新] をクリックすると、エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="8f04e-289">代替の`BatchUpdate`方法</span><span class="sxs-lookup"><span data-stu-id="8f04e-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="8f04e-290">ここで説明した `BatchUpdate` 方法では、BLL `GetProducts` メソッドから*すべて*の製品を取得し、GridView に表示されるレコードのみを更新します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="8f04e-291">この方法は、GridView がページングを使用しない場合に最適ですが、その場合は、数百、数千、数十の製品が存在する可能性がありますが、GridView には10行しかありません。</span><span class="sxs-lookup"><span data-stu-id="8f04e-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="8f04e-292">このような場合、データベースからすべての製品を取得するのは、そのうちの10を変更することだけです。</span><span class="sxs-lookup"><span data-stu-id="8f04e-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="8f04e-293">このような状況では、代わりに次の `BatchUpdateAlternate` メソッドを使用することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample7.vb)]

<span data-ttu-id="8f04e-294">`BatchMethodAlternate` は、`products`という名前の新しい空の `ProductsDataTable` を作成することから始めます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="8f04e-295">次に、GridView s `Rows` コレクションをステップ実行します。行ごとに、BLL s `GetProductByProductID(productID)` メソッドを使用して特定の製品情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="8f04e-296">取得した `ProductsRow` インスタンスのプロパティは `BatchUpdate`と同じ方法で更新されますが、行を更新すると、DataTable s [`ImportRow(DataRow)` メソッド](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx)を使用して `products` `ProductsDataTable` にインポートされます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products` `ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="8f04e-297">`For Each` ループが完了すると、`products` には GridView 内の行ごとに1つの `ProductsRow` インスタンスが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8f04e-297">After the `For Each` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="8f04e-298">各 `ProductsRow` インスタンスは (更新ではなく) `products` に追加されているため、無条件に `UpdateWithTransaction` メソッドに渡すと、`ProductsTableAdapter` は各レコードをデータベースに挿入しようとします。</span><span class="sxs-lookup"><span data-stu-id="8f04e-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdapter` will try to insert each of the records into the database.</span></span> <span data-ttu-id="8f04e-299">代わりに、これらの各行が変更されている (追加されていない) ことを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="8f04e-300">これを行うには、`UpdateProductsWithTransaction`という名前の BLL に新しいメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="8f04e-301">次に示す `UpdateProductsWithTransaction`は、`ProductsDataTable` 内の各 `ProductsRow` インスタンスの `RowState` を `Modified` に設定し、その `ProductsDataTable` を DAL の `UpdateWithTransaction` メソッドに渡します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample8.vb)]

## <a name="summary"></a><span data-ttu-id="8f04e-302">まとめ</span><span class="sxs-lookup"><span data-stu-id="8f04e-302">Summary</span></span>

<span data-ttu-id="8f04e-303">GridView には、行単位の編集機能が組み込まれていますが、完全に編集可能なインターフェイスの作成はサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="8f04e-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="8f04e-304">このチュートリアルで説明したように、このようなインターフェイスは可能ですが、多少の作業が必要です。</span><span class="sxs-lookup"><span data-stu-id="8f04e-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="8f04e-305">すべての行が編集可能な GridView を作成するには、GridView s フィールドを TemplateFields に変換し、`ItemTemplate` 内で編集インターフェイスを定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="8f04e-306">また、GridView とは別に、すべての型のボタン Web コントロールをページに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="8f04e-307">イベントハンドラー `Click` これらのボタンは、GridView の `Rows` コレクションを列挙し、変更を `ProductsDataTable`に格納して、更新された情報を適切な BLL メソッドに渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="8f04e-308">次のチュートリアルでは、batch を削除するためのインターフェイスを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="8f04e-309">具体的には、各 GridView 行にチェックボックスが含まれており、[すべての型を更新] ボタンの代わりに、[選択した行の削除] ボタンがあります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="8f04e-310">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="8f04e-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8f04e-311">著者について</span><span class="sxs-lookup"><span data-stu-id="8f04e-311">About the Author</span></span>

<span data-ttu-id="8f04e-312">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="8f04e-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8f04e-313">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="8f04e-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8f04e-314">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="8f04e-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8f04e-315">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8f04e-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8f04e-316">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="8f04e-316">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8f04e-317">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="8f04e-317">Special Thanks To</span></span>

<span data-ttu-id="8f04e-318">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="8f04e-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8f04e-319">このチュートリアルのリードレビュー担当者は、Teresa Murphy と David になりました。</span><span class="sxs-lookup"><span data-stu-id="8f04e-319">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="8f04e-320">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="8f04e-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8f04e-321">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8f04e-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8f04e-322">[前へ](wrapping-database-modifications-within-a-transaction-vb.md)
> [次へ](batch-deleting-vb.md)</span><span class="sxs-lookup"><span data-stu-id="8f04e-322">[Previous](wrapping-database-modifications-within-a-transaction-vb.md)
[Next](batch-deleting-vb.md)</span></span>
