---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-vb
title: SqlDataSource コントロールを使用してデータにクエリを実行する (VB) |Microsoft Docs
author: rick-anderson
description: 前のチュートリアルでは、ObjectDataSource コントロールを使用して、プレゼンテーション層とデータアクセス層を完全に分離しています。 次の教えるで始まる...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: b12f752d-3502-40a4-b695-fc7b7d08cfd3
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-vb
msc.type: authoredcontent
ms.openlocfilehash: 199ddb46e877c3a0937672d33241a240660684da
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74606017"
---
# <a name="querying-data-with-the-sqldatasource-control-vb"></a><span data-ttu-id="9509f-104">SqlDataSource コントロールでデータにクエリを実行する (VB)</span><span class="sxs-lookup"><span data-stu-id="9509f-104">Querying Data with the SqlDataSource Control (VB)</span></span>

<span data-ttu-id="9509f-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9509f-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9509f-106">[サンプルアプリのダウンロード](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_47_VB.exe)または[PDF のダウンロード](querying-data-with-the-sqldatasource-control-vb/_static/datatutorial47vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9509f-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_47_VB.exe) or [Download PDF](querying-data-with-the-sqldatasource-control-vb/_static/datatutorial47vb1.pdf)</span></span>

> <span data-ttu-id="9509f-107">前のチュートリアルでは、ObjectDataSource コントロールを使用して、プレゼンテーション層とデータアクセス層を完全に分離しています。</span><span class="sxs-lookup"><span data-stu-id="9509f-107">In the preceding tutorials we used the ObjectDataSource control to fully separate the presentation layer from the Data Access layer.</span></span> <span data-ttu-id="9509f-108">このチュートリアルでは、プレゼンテーションとデータアクセスの厳密な分離を必要としない単純なアプリケーションに対して、SqlDataSource コントロールを使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9509f-108">Starting with this tutorial, we learn how the SqlDataSource control can be used for simple applications that do not require such a strict separation of presentation and data access.</span></span>

## <a name="introduction"></a><span data-ttu-id="9509f-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="9509f-109">Introduction</span></span>

<span data-ttu-id="9509f-110">これまでに説明したすべてのチュートリアルでは、プレゼンテーション、ビジネスロジック、およびデータアクセス層で構成される階層型アーキテクチャを使用してきました。</span><span class="sxs-lookup"><span data-stu-id="9509f-110">All of the tutorials we ve examined so far have used a tiered architecture consisting of presentation, Business Logic, and Data Access layers.</span></span> <span data-ttu-id="9509f-111">データアクセス層 (DAL) は、1つ目のチュートリアル ([データアクセス層の作成](../introduction/creating-a-data-access-layer-vb.md)) とビジネスロジック層 ([ビジネスロジック層の作成](../introduction/creating-a-business-logic-layer-vb.md)) で作成されました。</span><span class="sxs-lookup"><span data-stu-id="9509f-111">The Data Access Layer (DAL) was crafted in the first tutorial ([Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md)) and the Business Logic Layer in the second ([Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md)).</span></span> <span data-ttu-id="9509f-112">「ObjectDataSource チュートリアル[を使用してデータを表示](../basic-reporting/displaying-data-with-the-objectdatasource-vb.md)する」から、ASP.NET 2.0 s new ObjectDataSource コントロールを使用して、プレゼンテーション層のアーキテクチャとの宣言によるインターフェイスを作成する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="9509f-112">Starting with the [Displaying Data With the ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-vb.md) tutorial, we saw how to use ASP.NET 2.0 s new ObjectDataSource control to declaratively interface with the architecture from the presentation layer.</span></span>

<span data-ttu-id="9509f-113">これまでのすべてのチュートリアルでは、アーキテクチャを使用してデータを処理してきましたが、ASP.NET ページから直接データベースデータにアクセスし、挿入、更新、削除することもできます。</span><span class="sxs-lookup"><span data-stu-id="9509f-113">While all of the tutorials so far have used the architecture to work with data, it is also possible to access, insert, update, and delete database data directly from an ASP.NET page, bypassing the architecture.</span></span> <span data-ttu-id="9509f-114">これにより、特定のデータベースクエリとビジネスロジックが web ページに直接配置されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-114">Doing so places the specific database queries and business logic directly in the web page.</span></span> <span data-ttu-id="9509f-115">大規模または複雑なアプリケーションの場合、階層化されたアーキテクチャの設計、実装、および使用は、アプリケーションの成功、更新、および保守性を実現するために非常に重要です。</span><span class="sxs-lookup"><span data-stu-id="9509f-115">For sufficiently large or complex applications, designing, implementing, and using a tiered architecture is vitally important for the success, updatability, and maintainability of the application.</span></span> <span data-ttu-id="9509f-116">ただし、非常に単純な1回限りのアプリケーションを作成する場合、堅牢なアーキテクチャの開発は不要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="9509f-116">Developing a robust architecture, however, may be unnecessary when creating exceedingly simple, one-off applications.</span></span>

<span data-ttu-id="9509f-117">ASP.NET 2.0 には、 [SqlDataSource](https://msdn.microsoft.com/library/dz12d98w%28vs.80%29.aspx)、 [AccessDataSource](https://msdn.microsoft.com/library/8e5545e1.aspx)、 [ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx)、 [XmlDataSource](https://msdn.microsoft.com/library/e8d8587a%28en-US,VS.80%29.aspx)、および[SiteMapDataSource](https://msdn.microsoft.com/library/5ex9t96x%28en-US,VS.80%29.aspx)という5つの組み込みデータソースコントロールが用意されています。</span><span class="sxs-lookup"><span data-stu-id="9509f-117">ASP.NET 2.0 provides five built-in data source controls [SqlDataSource](https://msdn.microsoft.com/library/dz12d98w%28vs.80%29.aspx), [AccessDataSource](https://msdn.microsoft.com/library/8e5545e1.aspx), [ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), [XmlDataSource](https://msdn.microsoft.com/library/e8d8587a%28en-US,VS.80%29.aspx), and [SiteMapDataSource](https://msdn.microsoft.com/library/5ex9t96x%28en-US,VS.80%29.aspx).</span></span> <span data-ttu-id="9509f-118">SqlDataSource を使用すると、リレーショナルデータベース (Microsoft SQL Server、Microsoft Access、Oracle、MySQL など) から直接データにアクセスして変更を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="9509f-118">The SqlDataSource can be used to access and modify data directly from a relational database, including Microsoft SQL Server, Microsoft Access, Oracle, MySQL, and others.</span></span> <span data-ttu-id="9509f-119">このチュートリアルと次の3つのチュートリアルでは、SqlDataSource コントロールを操作する方法、データベースデータのクエリとフィルター処理の方法、および SqlDataSource を使用してデータを挿入、更新、および削除する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9509f-119">In this tutorial and the next three, we'll examine how to work with the SqlDataSource control, exploring how to query and filter database data, as well as how to use the SqlDataSource to insert, update, and delete data.</span></span>

![ASP.NET 2.0 には、5つの組み込みデータソースコントロールが含まれています](querying-data-with-the-sqldatasource-control-vb/_static/image1.gif)

<span data-ttu-id="9509f-121">**図 1**: ASP.NET 2.0 には、5つの組み込みデータソースコントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="9509f-121">**Figure 1**: ASP.NET 2.0 Includes Five Built-In Data Source Controls</span></span>

## <a name="comparing-the-objectdatasource-and-sqldatasource"></a><span data-ttu-id="9509f-122">ObjectDataSource と SqlDataSource の比較</span><span class="sxs-lookup"><span data-stu-id="9509f-122">Comparing the ObjectDataSource and SqlDataSource</span></span>

<span data-ttu-id="9509f-123">概念的には、ObjectDataSource と SqlDataSource の両方のコントロールが単にデータのプロキシになります。</span><span class="sxs-lookup"><span data-stu-id="9509f-123">Conceptually, both the ObjectDataSource and SqlDataSource controls are simply proxies to data.</span></span> <span data-ttu-id="9509f-124">「 [Objectdatasource を使用したデータの表示](../basic-reporting/displaying-data-with-the-objectdatasource-vb.md)」で説明したように、objectdatasource には、データを提供するオブジェクトの種類を示すプロパティと、基になるオブジェクトの種類からデータを選択、挿入、更新、および削除するために呼び出すメソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="9509f-124">As discussed in the [Displaying Data With the ObjectDataSource](../basic-reporting/displaying-data-with-the-objectdatasource-vb.md) tutorial, the ObjectDataSource has properties that indicate the object type that provides the data and the methods to invoke to select, insert, update, and delete data from the underlying object type.</span></span> <span data-ttu-id="9509f-125">ObjectDataSource のプロパティが構成されたら、GridView、DetailsView、DataList などのデータ Web コントロールをコントロールにバインドできます。その際、ObjectDataSource s `Select()`、`Insert()`、`Delete()`、および `Update()` の各メソッドを使用して、基になるアーキテクチャと対話します。</span><span class="sxs-lookup"><span data-stu-id="9509f-125">Once the ObjectDataSource s properties have been configured, a data Web control such as a GridView, DetailsView, or DataList can be bound to the control, using the ObjectDataSource s `Select()`, `Insert()`, `Delete()`, and `Update()` methods to interact with the underlying architecture.</span></span>

<span data-ttu-id="9509f-126">SqlDataSource は同じ機能を提供しますが、オブジェクトライブラリではなくリレーショナルデータベースに対して動作します。</span><span class="sxs-lookup"><span data-stu-id="9509f-126">The SqlDataSource provides the same functionality, but operates against a relational database rather than an object library.</span></span> <span data-ttu-id="9509f-127">SqlDataSource を使用する場合は、データベース接続文字列と、データの挿入、更新、削除、および取得を実行するアドホック SQL クエリまたはストアドプロシージャを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9509f-127">With the SqlDataSource, we must specify the database connection string and the ad-hoc SQL queries or stored procedures to execute to insert, update, delete, and retrieve data.</span></span> <span data-ttu-id="9509f-128">SqlDataSource s `Select()`、`Insert()`、`Update()`、および `Delete()` メソッドを呼び出すと、指定されたデータベースに接続し、適切な SQL クエリを発行します。</span><span class="sxs-lookup"><span data-stu-id="9509f-128">The SqlDataSource s `Select()`, `Insert()`, `Update()`, and `Delete()` methods, when invoked, connect to the specified database and issue the appropriate SQL query.</span></span> <span data-ttu-id="9509f-129">次の図に示すように、これらのメソッドは、データベースへの接続、クエリの発行、および結果の取得の grunt を実行します。</span><span class="sxs-lookup"><span data-stu-id="9509f-129">As the following diagram illustrates, the these methods do the grunt work of connecting to a database, issuing a query, and returning the results.</span></span>

![SqlDataSource は、データベースへのプロキシとして機能します。](querying-data-with-the-sqldatasource-control-vb/_static/image2.gif)

<span data-ttu-id="9509f-131">**図 2**: SqlDataSource はデータベースへのプロキシとして機能する</span><span class="sxs-lookup"><span data-stu-id="9509f-131">**Figure 2**: The SqlDataSource Serves as a Proxy to the Database</span></span>

> [!NOTE]
> <span data-ttu-id="9509f-132">このチュートリアルでは、データベースからデータを取得することに重点を置いて説明します。</span><span class="sxs-lookup"><span data-stu-id="9509f-132">In this tutorial we'll focus on retrieving data from the database.</span></span> <span data-ttu-id="9509f-133">「 [Sqldatasource Control を使用したデータの挿入、更新、および削除](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)」チュートリアルでは、挿入、更新、および削除をサポートするように sqldatasource を構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="9509f-133">In the [Inserting, Updating, and Deleting Data with the SqlDataSource Control](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md) tutorial, we'll see how to configure the SqlDataSource to support inserting, updating, and deleting.</span></span>

## <a name="the-sqldatasource-and-accessdatasource-controls"></a><span data-ttu-id="9509f-134">SqlDataSource コントロールと AccessDataSource コントロール</span><span class="sxs-lookup"><span data-stu-id="9509f-134">The SqlDataSource and AccessDataSource Controls</span></span>

<span data-ttu-id="9509f-135">SqlDataSource コントロールに加えて、ASP.NET 2.0 には AccessDataSource コントロールも含まれています。</span><span class="sxs-lookup"><span data-stu-id="9509f-135">In addition to the SqlDataSource control, ASP.NET 2.0 also includes an AccessDataSource control.</span></span> <span data-ttu-id="9509f-136">これらの2つの異なるコントロールは、多くの開発者にとって ASP.NET 2.0 を使用することをお勧めします。これは、AccessDataSource コントロールが、Microsoft SQL Server でのみ動作するように設計された SqlDataSource コントロールを使用して、Microsoft Access でのみ動作するように設計さ</span><span class="sxs-lookup"><span data-stu-id="9509f-136">These two different controls lead many developers new to ASP.NET 2.0 to suspect that the AccessDataSource control is designed to work exclusively with Microsoft Access with the SqlDataSource control designed to work exclusively with Microsoft SQL Server.</span></span> <span data-ttu-id="9509f-137">AccessDataSource は、特に Microsoft Access で動作するように設計されていますが、SqlDataSource コントロールは、.NET を介してアクセスできる*任意*のリレーショナルデータベースで動作します。</span><span class="sxs-lookup"><span data-stu-id="9509f-137">While the AccessDataSource is designed to work specifically with Microsoft Access, the SqlDataSource control works with *any* relational database that can be accessed through .NET.</span></span> <span data-ttu-id="9509f-138">これには、Microsoft SQL Server、Microsoft Access、Oracle、Informix、MySQL、PostgreSQL など、他の多くの OleDb または ODBC に準拠したデータストアが含まれます。</span><span class="sxs-lookup"><span data-stu-id="9509f-138">This includes any OleDb- or ODBC-compliant data stores, such as Microsoft SQL Server, Microsoft Access, Oracle, Informix, MySQL, and PostgreSQL, among many others.</span></span>

<span data-ttu-id="9509f-139">AccessDataSource と SqlDataSource コントロールの唯一の違いは、データベース接続情報を指定する方法です。</span><span class="sxs-lookup"><span data-stu-id="9509f-139">The sole difference between the AccessDataSource and SqlDataSource controls is how the database connection information is specified.</span></span> <span data-ttu-id="9509f-140">AccessDataSource コントロールには、Access データベースファイルへのファイルパスのみが必要です。</span><span class="sxs-lookup"><span data-stu-id="9509f-140">The AccessDataSource control needs just the file path to the Access database file.</span></span> <span data-ttu-id="9509f-141">一方、SqlDataSource には、完全な接続文字列が必要です。</span><span class="sxs-lookup"><span data-stu-id="9509f-141">The SqlDataSource, on the other hand, requires a complete connection string.</span></span>

## <a name="step-1-creating-the-sqldatasource-web-pages"></a><span data-ttu-id="9509f-142">手順 1: SqlDataSource Web ページの作成</span><span class="sxs-lookup"><span data-stu-id="9509f-142">Step 1: Creating the SqlDataSource Web Pages</span></span>

<span data-ttu-id="9509f-143">SqlDataSource コントロールを使用してデータベースデータを直接操作する方法を確認する前に、まず、このチュートリアルで必要な ASP.NET ページを web サイトプロジェクトに作成し、次の3つについて説明します。</span><span class="sxs-lookup"><span data-stu-id="9509f-143">Before we start exploring how to work directly with database data using the SqlDataSource control, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="9509f-144">まず、`SqlDataSource`という名前の新しいフォルダーを追加します。</span><span class="sxs-lookup"><span data-stu-id="9509f-144">Start by adding a new folder named `SqlDataSource`.</span></span> <span data-ttu-id="9509f-145">次に、次の ASP.NET ページをそのフォルダーに追加します。各ページは `Site.master` マスターページに関連付けられていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="9509f-145">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Querying.aspx`
- `ParameterizedQueries.aspx`
- `InsertUpdateDelete.aspx`
- `OptimisticConcurrency.aspx`

![SqlDataSource 関連のチュートリアルの ASP.NET ページを追加する](querying-data-with-the-sqldatasource-control-vb/_static/image3.gif)

<span data-ttu-id="9509f-147">**図 3**: SqlDataSource 関連のチュートリアルの ASP.NET ページを追加する</span><span class="sxs-lookup"><span data-stu-id="9509f-147">**Figure 3**: Add the ASP.NET Pages for the SqlDataSource-Related Tutorials</span></span>

<span data-ttu-id="9509f-148">他のフォルダーと同様に、`SqlDataSource` フォルダー内の `Default.aspx` には、そのセクションのチュートリアルが一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-148">Like in the other folders, `Default.aspx` in the `SqlDataSource` folder will list the tutorials in its section.</span></span> <span data-ttu-id="9509f-149">`SectionLevelTutorialListing.ascx` ユーザーコントロールがこの機能を提供していることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="9509f-149">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="9509f-150">したがって、ソリューションエクスプローラーからページデザインビューにドラッグして、このユーザーコントロールを `Default.aspx` に追加します。</span><span class="sxs-lookup"><span data-stu-id="9509f-150">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="9509f-151">[SectionLevelTutorialListing ユーザーコントロールを default.aspx に追加 ![には](querying-data-with-the-sqldatasource-control-vb/_static/image5.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image4.gif)</span><span class="sxs-lookup"><span data-stu-id="9509f-151">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](querying-data-with-the-sqldatasource-control-vb/_static/image5.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image4.gif)</span></span>

<span data-ttu-id="9509f-152">**図 4**: `Default.aspx` に `SectionLevelTutorialListing.ascx` ユーザーコントロールを追加する ([クリックすると、フルサイズの画像が表示](querying-data-with-the-sqldatasource-control-vb/_static/image6.gif)されます)</span><span class="sxs-lookup"><span data-stu-id="9509f-152">**Figure 4**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](querying-data-with-the-sqldatasource-control-vb/_static/image6.gif))</span></span>

<span data-ttu-id="9509f-153">最後に、これらの4つのページをエントリとして `Web.sitemap` ファイルに追加します。</span><span class="sxs-lookup"><span data-stu-id="9509f-153">Lastly, add these four pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="9509f-154">具体的には、DataList および Repeater `<siteMapNode>`にカスタムボタンを追加した後に、次のマークアップを追加します。</span><span class="sxs-lookup"><span data-stu-id="9509f-154">Specifically, add the following markup after the Adding Custom Buttons to the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-sql[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample1.sql)]

<span data-ttu-id="9509f-155">`Web.sitemap`を更新した後、ブラウザーを使用してチュートリアル web サイトを表示します。</span><span class="sxs-lookup"><span data-stu-id="9509f-155">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="9509f-156">左側のメニューには、チュートリアルの編集、挿入、および削除を行うための項目が含まれています。</span><span class="sxs-lookup"><span data-stu-id="9509f-156">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![サイトマップに、SqlDataSource チュートリアルのエントリが含まれるようになりました。](querying-data-with-the-sqldatasource-control-vb/_static/image7.gif)

<span data-ttu-id="9509f-158">**図 5**: サイトマップに SqlDataSource チュートリアルのエントリが含まれるようになった</span><span class="sxs-lookup"><span data-stu-id="9509f-158">**Figure 5**: The Site Map Now Includes Entries for the SqlDataSource Tutorials</span></span>

## <a name="step-2-adding-and-configuring-the-sqldatasource-control"></a><span data-ttu-id="9509f-159">手順 2: SqlDataSource コントロールの追加と構成</span><span class="sxs-lookup"><span data-stu-id="9509f-159">Step 2: Adding and Configuring the SqlDataSource Control</span></span>

<span data-ttu-id="9509f-160">まず、`SqlDataSource` フォルダーの [`Querying.aspx`] ページを開いてデザインビューに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="9509f-160">Start by opening the `Querying.aspx` page in the `SqlDataSource` folder and switch to Design view.</span></span> <span data-ttu-id="9509f-161">[ツールボックス] から [SqlDataSource] コントロールをデザイナーにドラッグし、その `ID` を [`ProductsDataSource`] に設定します。</span><span class="sxs-lookup"><span data-stu-id="9509f-161">Drag a SqlDataSource control from the Toolbox onto the Designer and set its `ID` to `ProductsDataSource`.</span></span> <span data-ttu-id="9509f-162">ObjectDataSource と同様に、SqlDataSource はレンダリングされた出力を生成しないため、デザインサーフェイスに灰色のボックスとして表示されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-162">As with the ObjectDataSource, the SqlDataSource does not produce any rendered output and therefore appears as a gray box on the design surface.</span></span> <span data-ttu-id="9509f-163">SqlDataSource を構成するには、SqlDataSource s スマートタグから [データソースの構成] リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="9509f-163">To configure the SqlDataSource, click on the Configure Data Source link from the SqlDataSource s smart tag.</span></span>

![SqlDataSource s スマートタグから [データソースの構成] リンクをクリックします。](querying-data-with-the-sqldatasource-control-vb/_static/image8.gif)

<span data-ttu-id="9509f-165">**図 6**: SqlDataSource s スマートタグから [データソースの構成] リンクをクリックする</span><span class="sxs-lookup"><span data-stu-id="9509f-165">**Figure 6**: Click on the Configure Data Source Link from the SqlDataSource s Smart Tag</span></span>

<span data-ttu-id="9509f-166">これにより、[SqlDataSource control s データソースの構成] ウィザードが起動します。</span><span class="sxs-lookup"><span data-stu-id="9509f-166">This brings up the SqlDataSource control s Configure Data Source wizard.</span></span> <span data-ttu-id="9509f-167">ウィザードの手順は ObjectDataSource コントロールとは異なりますが、最終的な目的は、データソースを介してデータを取得、挿入、更新、および削除する方法の詳細を提供することと同じです。</span><span class="sxs-lookup"><span data-stu-id="9509f-167">While the wizard s steps differ from the ObjectDataSource control s, the end goal is the same to provide the details on how to retrieve, insert, update, and delete data through the data source.</span></span> <span data-ttu-id="9509f-168">SqlDataSource の場合は、使用する基になるデータベースを指定し、アドホック SQL ステートメントまたはストアドプロシージャを提供します。</span><span class="sxs-lookup"><span data-stu-id="9509f-168">For the SqlDataSource this entails specifying the underlying database to use and providing the ad-hoc SQL statements or stored procedures.</span></span>

<span data-ttu-id="9509f-169">ウィザードの最初のステップでは、データベースの入力を求められます。</span><span class="sxs-lookup"><span data-stu-id="9509f-169">The first wizard step prompts us for the database.</span></span> <span data-ttu-id="9509f-170">ドロップダウンリストには、web アプリケーションの `App_Data` フォルダーにあるデータベースと、サーバーエクスプローラーの [データ接続] ノードに追加されたデータベースが表示されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-170">The drop-down list includes those databases found in the web application s `App_Data` folder and those that have been added to the Data Connections node in the Server Explorer.</span></span> <span data-ttu-id="9509f-171">`App_Data` フォルダー内の `NORTHWIND.MDF` データベースの接続文字列は、プロジェクトの `Web.config` ファイルに既に追加されているため、ドロップダウンリストには、その接続文字列への参照、`NORTHWINDConnectionString`が含まれています。</span><span class="sxs-lookup"><span data-stu-id="9509f-171">Since we ve already added a connection string for the `NORTHWIND.MDF` database in the `App_Data` folder to our project s `Web.config` file, the drop-down list includes a reference to that connection string, `NORTHWINDConnectionString`.</span></span> <span data-ttu-id="9509f-172">ドロップダウンリストからこの項目を選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9509f-172">Choose this item from the drop-down list and click Next.</span></span>

![ドロップダウンリストから NORTHWINDConnectionString を選択します。](querying-data-with-the-sqldatasource-control-vb/_static/image9.gif)

<span data-ttu-id="9509f-174">**図 7**: ドロップダウンリストから `NORTHWINDConnectionString` を選択する</span><span class="sxs-lookup"><span data-stu-id="9509f-174">**Figure 7**: Choose the `NORTHWINDConnectionString` from the Drop-Down List</span></span>

<span data-ttu-id="9509f-175">データベースを選択すると、ウィザードによって、データを返すクエリが要求されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-175">After choosing the database, the wizard asks for the query to return data.</span></span> <span data-ttu-id="9509f-176">返されるテーブルまたはビューの列を指定するか、カスタム SQL ステートメントを入力するか、ストアドプロシージャを指定できます。</span><span class="sxs-lookup"><span data-stu-id="9509f-176">We can either specify the columns of a table or view to return or can enter a custom SQL statement or specify a stored procedure.</span></span> <span data-ttu-id="9509f-177">このオプションは、[カスタム SQL ステートメントまたはストアドプロシージャの指定] と [テーブルまたはビューのオプション] ボタンからの列の指定によって切り替えることができます。</span><span class="sxs-lookup"><span data-stu-id="9509f-177">You can toggle between this choice through the Specify a custom SQL statement or stored procedure and Specify columns from a table or view radio buttons.</span></span>

> [!NOTE]
> <span data-ttu-id="9509f-178">最初の例では、[テーブルまたはビューから列を指定] オプションを使用します。</span><span class="sxs-lookup"><span data-stu-id="9509f-178">For this first example, let s use the Specify columns from a table or view option.</span></span> <span data-ttu-id="9509f-179">このチュートリアルの後半でウィザードに戻り、[カスタム SQL ステートメントまたはストアドプロシージャの指定] オプションを調べます。</span><span class="sxs-lookup"><span data-stu-id="9509f-179">We'll return to the wizard later in this tutorial and explore the Specify a custom SQL statement or stored procedure option.</span></span>

<span data-ttu-id="9509f-180">図8は、[テーブルまたはビューから列を指定] オプションボタンが選択されている場合の [Select ステートメントの構成] 画面を示しています。</span><span class="sxs-lookup"><span data-stu-id="9509f-180">Figure 8 shows the Configure the Select Statement screen when the Specify columns from a table or view radio button is selected.</span></span> <span data-ttu-id="9509f-181">ドロップダウンリストには、Northwind データベースのテーブルとビューのセットが含まれています。選択したテーブルまたはビュー s 列が下のチェックボックスの一覧に表示されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-181">The drop-down list contains the set of tables and views in the Northwind database, with the selected table or view s columns displayed in the checkbox list below.</span></span> <span data-ttu-id="9509f-182">この例では、を使用して、`Products` テーブルから `ProductID`、`ProductName`、および `UnitPrice` の各列を返します。</span><span class="sxs-lookup"><span data-stu-id="9509f-182">For this example, let s return the `ProductID`, `ProductName`, and `UnitPrice` columns from the `Products` table.</span></span> <span data-ttu-id="9509f-183">図8に示すように、これらのオプションを選択すると、結果として得られる SQL ステートメント `SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`がウィザードに表示されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-183">As Figure 8 shows, after making these selections the wizard shows the resulting SQL statement `SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`.</span></span>

![Products テーブルからデータを返す](querying-data-with-the-sqldatasource-control-vb/_static/image10.gif)

<span data-ttu-id="9509f-185">**図 8**: `Products` テーブルからデータを返す</span><span class="sxs-lookup"><span data-stu-id="9509f-185">**Figure 8**: Return Data from the `Products` Table</span></span>

<span data-ttu-id="9509f-186">`Products` テーブルから `ProductID`、`ProductName`、および `UnitPrice` 列を返すようにウィザードを構成したら、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9509f-186">Once you have configured the wizard to return the `ProductID`, `ProductName`, and `UnitPrice` columns from the `Products` table, click the Next button.</span></span> <span data-ttu-id="9509f-187">この最後の画面では、前の手順で構成したクエリの結果を調べることができます。</span><span class="sxs-lookup"><span data-stu-id="9509f-187">This final screen provides an opportunity to examine the results of the query configured from the previous step.</span></span> <span data-ttu-id="9509f-188">[クエリのテスト] ボタンをクリックすると、構成済みの `SELECT` ステートメントが実行され、結果がグリッドに表示されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-188">Clicking the Test Query button executes the configured `SELECT` statement and displays the results in a grid.</span></span>

![[クエリのテスト] ボタンをクリックして、選択したクエリを確認します。](querying-data-with-the-sqldatasource-control-vb/_static/image11.gif)

<span data-ttu-id="9509f-190">**図 9**: [クエリのテスト] ボタンをクリックして `SELECT` クエリを確認する</span><span class="sxs-lookup"><span data-stu-id="9509f-190">**Figure 9**: Click the Test Query Button to Review Your `SELECT` Query</span></span>

<span data-ttu-id="9509f-191">ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9509f-191">To complete the wizard, click Finish.</span></span>

<span data-ttu-id="9509f-192">ObjectDataSource の場合と同様に、SqlDataSource s ウィザードでは、コントロールのプロパティ、つまり[`ConnectionString`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.connectionstring.aspx)と[`SelectCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommand.aspx)のプロパティに値が割り当てられるだけです。</span><span class="sxs-lookup"><span data-stu-id="9509f-192">Like with the ObjectDataSource, the SqlDataSource s wizard merely assigns values to the control s properties, namely the [`ConnectionString`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.connectionstring.aspx) and [`SelectCommand`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommand.aspx) properties.</span></span> <span data-ttu-id="9509f-193">ウィザードを完了すると、SqlDataSource コントロール s の宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="9509f-193">After completing the wizard, your SqlDataSource control s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample2.aspx)]

<span data-ttu-id="9509f-194">`ConnectionString` プロパティは、データベースに接続する方法に関する情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="9509f-194">The `ConnectionString` property provides information on how to connect to the database.</span></span> <span data-ttu-id="9509f-195">このプロパティには、ハードコーディングされた完全な接続文字列値を割り当てることも、`Web.config`の接続文字列を指定することもできます。</span><span class="sxs-lookup"><span data-stu-id="9509f-195">This property can be assigned a complete, hard-coded connection string value or can point to a connection string in `Web.config`.</span></span> <span data-ttu-id="9509f-196">Web.config の接続文字列値を参照するには、`<%$ expressionPrefix:expressionValue %>`構文を使用します。</span><span class="sxs-lookup"><span data-stu-id="9509f-196">To reference a connection string value in Web.config, use the syntax `<%$ expressionPrefix:expressionValue %>`.</span></span> <span data-ttu-id="9509f-197">通常、*式のプレフィックス*は ConnectionStrings で、*式の値*は `Web.config` [`<connectionStrings>` セクション](https://msdn.microsoft.com/library/bf7sd233.aspx)の接続文字列の名前です。</span><span class="sxs-lookup"><span data-stu-id="9509f-197">Typically, *expressionPrefix* is ConnectionStrings and *expressionValue* is the name of the connect string in the `Web.config` [`<connectionStrings>` section](https://msdn.microsoft.com/library/bf7sd233.aspx).</span></span> <span data-ttu-id="9509f-198">ただし、構文を使用して、リソースファイルから `<appSettings>` の要素やコンテンツを参照することができます。</span><span class="sxs-lookup"><span data-stu-id="9509f-198">However, the syntax can be used to reference `<appSettings>` elements or content from resource files.</span></span> <span data-ttu-id="9509f-199">この構文の詳細については、「 [ASP.NET 式の概要](https://msdn.microsoft.com/library/d5bd1tad.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9509f-199">See [ASP.NET Expressions Overview](https://msdn.microsoft.com/library/d5bd1tad.aspx) for more on this syntax.</span></span>

<span data-ttu-id="9509f-200">`SelectCommand` プロパティは、データを返すために実行するアドホック SQL ステートメントまたはストアドプロシージャを指定します。</span><span class="sxs-lookup"><span data-stu-id="9509f-200">The `SelectCommand` property specifies the ad-hoc SQL statement or stored procedure to execute to return the data.</span></span>

## <a name="step-3-adding-a-data-web-control-and-binding-it-to-the-sqldatasource"></a><span data-ttu-id="9509f-201">手順 3: データ Web コントロールを追加し、SqlDataSource にバインドする</span><span class="sxs-lookup"><span data-stu-id="9509f-201">Step 3: Adding a Data Web Control and Binding it to the SqlDataSource</span></span>

<span data-ttu-id="9509f-202">SqlDataSource が構成されると、GridView や DetailsView などのデータ Web コントロールにバインドできます。</span><span class="sxs-lookup"><span data-stu-id="9509f-202">Once the SqlDataSource has been configured, it can be bound to a data Web control, such as a GridView or DetailsView.</span></span> <span data-ttu-id="9509f-203">このチュートリアルでは、を使用して GridView のデータを表示します。</span><span class="sxs-lookup"><span data-stu-id="9509f-203">For this tutorial, let s display the data in a GridView.</span></span> <span data-ttu-id="9509f-204">[ツールボックス] から、GridView をページにドラッグして `ProductsDataSource` SqlDataSource にバインドします。これを行うには、GridView のスマートタグのドロップダウンリストからデータソースを選択します。</span><span class="sxs-lookup"><span data-stu-id="9509f-204">From the Toolbox, drag a GridView onto the page and bind it to the `ProductsDataSource` SqlDataSource by choosing the data source from the drop-down list in the GridView s smart tag.</span></span>

<span data-ttu-id="9509f-205">[GridView を追加して SqlDataSource コントロールにバインド ![には](querying-data-with-the-sqldatasource-control-vb/_static/image13.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image12.gif)</span><span class="sxs-lookup"><span data-stu-id="9509f-205">[![Add a GridView and Bind it to the SqlDataSource Control](querying-data-with-the-sqldatasource-control-vb/_static/image13.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image12.gif)</span></span>

<span data-ttu-id="9509f-206">**図 10**: GridView を追加して SqlDataSource コントロールにバインドする ([クリックすると、フルサイズの画像が表示](querying-data-with-the-sqldatasource-control-vb/_static/image14.gif)されます)</span><span class="sxs-lookup"><span data-stu-id="9509f-206">**Figure 10**: Add a GridView and Bind it to the SqlDataSource Control ([Click to view full-size image](querying-data-with-the-sqldatasource-control-vb/_static/image14.gif))</span></span>

<span data-ttu-id="9509f-207">GridView s スマートタグのドロップダウンリストから SqlDataSource コントロールを選択すると、データソースコントロールによって返される各列の GridView に BoundField または CheckBoxField が自動的に追加されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-207">Once you ve selected the SqlDataSource control from the drop-down list in the GridView s smart tag, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the columns returned by the data source control.</span></span> <span data-ttu-id="9509f-208">SqlDataSource は `ProductID`、`ProductName`、`UnitPrice` の3つのデータベース列を返すため、GridView には3つのフィールドがあります。</span><span class="sxs-lookup"><span data-stu-id="9509f-208">Since the SqlDataSource returns three database columns `ProductID`, `ProductName`, and `UnitPrice` there are three fields in the GridView.</span></span>

<span data-ttu-id="9509f-209">GridView の3つの連結フィールドを構成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="9509f-209">Take a moment to configure the GridView s three BoundFields.</span></span> <span data-ttu-id="9509f-210">`ProductName` field s `HeaderText` プロパティを Product Name に、`UnitPrice` フィールドを Price に変更します。</span><span class="sxs-lookup"><span data-stu-id="9509f-210">Change the `ProductName` field s `HeaderText` property to Product Name and the `UnitPrice` field s to Price.</span></span> <span data-ttu-id="9509f-211">また、`UnitPrice` フィールドを通貨として書式設定します。</span><span class="sxs-lookup"><span data-stu-id="9509f-211">Also format the `UnitPrice` field as a currency.</span></span> <span data-ttu-id="9509f-212">これらの変更を行った後、GridView の宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="9509f-212">After making these modifications, your GridView s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample3.aspx)]

<span data-ttu-id="9509f-213">ブラウザーを使用してこのページにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="9509f-213">Visit this page through a browser.</span></span> <span data-ttu-id="9509f-214">図11に示すように、GridView には、各製品の `ProductID`、`ProductName`、および `UnitPrice` 値が表示されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-214">As Figure 11 shows, the GridView lists each product s `ProductID`, `ProductName`, and `UnitPrice` values.</span></span>

<span data-ttu-id="9509f-215">[GridView に ![各製品の ProductID、ProductName、および UnitPrice の値が表示されます](querying-data-with-the-sqldatasource-control-vb/_static/image16.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="9509f-215">[![The GridView Displays Each Product s ProductID, ProductName, and UnitPrice Values](querying-data-with-the-sqldatasource-control-vb/_static/image16.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image15.gif)</span></span>

<span data-ttu-id="9509f-216">**図 11**: GridView には、各製品の `ProductID`、`ProductName`、および `UnitPrice` の値が表示されます ([クリックすると、フルサイズの画像が表示](querying-data-with-the-sqldatasource-control-vb/_static/image17.gif)されます)</span><span class="sxs-lookup"><span data-stu-id="9509f-216">**Figure 11**: The GridView Displays Each Product s `ProductID`, `ProductName`, and `UnitPrice` Values ([Click to view full-size image](querying-data-with-the-sqldatasource-control-vb/_static/image17.gif))</span></span>

<span data-ttu-id="9509f-217">ページにアクセスすると、GridView はそのデータソースコントロール s `Select()` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="9509f-217">When the page is visited the GridView invokes its data source control s `Select()` method.</span></span> <span data-ttu-id="9509f-218">ObjectDataSource コントロールを使用していた場合、これは `ProductsBLL` クラス s `GetProducts()` メソッドと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="9509f-218">When we were using the ObjectDataSource control, this called the `ProductsBLL` class s `GetProducts()` method.</span></span> <span data-ttu-id="9509f-219">ただし、SqlDataSource を使用すると、`Select()` メソッドは、指定されたデータベースへの接続を確立し、`SelectCommand` (この例では`SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`) を発行します。</span><span class="sxs-lookup"><span data-stu-id="9509f-219">With the SqlDataSource, however, the `Select()` method establishes a connection to the specified database and issues the `SelectCommand` (`SELECT [ProductID], [ProductName], [UnitPrice] FROM [Products]`, in this example).</span></span> <span data-ttu-id="9509f-220">SqlDataSource はその結果を返します。 GridView は、返された各データベースレコードに対して、GridView 内に行を作成します。</span><span class="sxs-lookup"><span data-stu-id="9509f-220">The SqlDataSource returns its results which the GridView then enumerates, creating a row in the GridView for each database record returned.</span></span>

## <a name="the-built-in-data-web-control-features-and-the-sqldatasource-control"></a><span data-ttu-id="9509f-221">組み込みのデータ Web コントロール機能と SqlDataSource コントロール</span><span class="sxs-lookup"><span data-stu-id="9509f-221">The Built-In Data Web Control Features and the SqlDataSource Control</span></span>

<span data-ttu-id="9509f-222">一般に、データ Web コントロールに固有の機能 (ページング、並べ替え、編集、削除、挿入など) はデータ Web コントロールに固有であり、使用されるデータソースコントロールには依存しません。</span><span class="sxs-lookup"><span data-stu-id="9509f-222">In general, the features inherent to the data Web controls paging, sorting, editing, deleting, inserting, and so on are specific to the data Web control and are not dependent on the data source control used.</span></span> <span data-ttu-id="9509f-223">つまり、GridView は、組み込みのページング、並べ替え、編集、および削除が ObjectDataSource または SqlDataSource にバインドされているかどうかを利用できます。</span><span class="sxs-lookup"><span data-stu-id="9509f-223">That is, the GridView can utilize its built-in paging, sorting, editing, and deleting whether it is bound to an ObjectDataSource or a SqlDataSource.</span></span> <span data-ttu-id="9509f-224">ただし、特定のデータ Web コントロール機能は、使用されているデータソースコントロールまたはデータソースコントロールの構成に依存しています。</span><span class="sxs-lookup"><span data-stu-id="9509f-224">However, certain data Web control features are sensitive to the data source control being used or to the data source control s configuration.</span></span>

<span data-ttu-id="9509f-225">たとえば、[大量のデータを効率的にページング](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md)するチュートリアルでは、既定では、データ Web コントロールネイティブのページングロジックによって基になるデータソースから*すべて*のレコードが返されます。その後、現在のページインデックスとページごとに表示されるレコードの数に応じて、適切なレコードのサブセットのみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-225">For example, in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb.md) tutorial we discussed how, by default, the paging logic for the data Web controls naively returns *all* records from the underlying data source and then displays only the appropriate subset of records given the current page index and the number of records to display per page.</span></span> <span data-ttu-id="9509f-226">このモデルは、十分に大きな結果セットを使用してページングする場合、非常に非効率的です。</span><span class="sxs-lookup"><span data-stu-id="9509f-226">This model is highly inefficient when paging through sufficiently large result sets.</span></span> <span data-ttu-id="9509f-227">幸い、ObjectDataSource はカスタムページングをサポートするように構成できます。これにより、表示するレコードの正確なサブセットのみが返されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-227">Fortunately, the ObjectDataSource can be configured to support custom paging, which returns only the precise subset of records to display.</span></span> <span data-ttu-id="9509f-228">ただし、SqlDataSource コントロールには、カスタムページングを実装するためのプロパティがありません。</span><span class="sxs-lookup"><span data-stu-id="9509f-228">The SqlDataSource control, however, lacks the properties for implementing custom paging.</span></span>

<span data-ttu-id="9509f-229">ページングと並べ替えを行う別のはらみが SqlDataSource で発生します。</span><span class="sxs-lookup"><span data-stu-id="9509f-229">Another subtlety with paging and sorting arises with the SqlDataSource.</span></span> <span data-ttu-id="9509f-230">既定では、SqlDataSource から返されるデータは、GridView を使用してページングまたは並べ替えを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="9509f-230">By default, the data returned from a SqlDataSource can be paged or sorted through the GridView.</span></span> <span data-ttu-id="9509f-231">これを示すには、`Querying.aspx` の GridView s スマートタグで [ページングを有効にし、並べ替えオプションを有効にする] をオンにして、これが想定どおりに動作することを確認します。</span><span class="sxs-lookup"><span data-stu-id="9509f-231">To demonstrate this, check the Enable Paging and Enable Sorting options in the GridView s smart tag in `Querying.aspx` and verify that this works as expected.</span></span>

<span data-ttu-id="9509f-232">SqlDataSource は、緩い型のデータセットにデータベースデータを取得するため、並べ替えとページングが機能します。</span><span class="sxs-lookup"><span data-stu-id="9509f-232">Sorting and paging works because the SqlDataSource retrieves the database data into a loosely-typed DataSet.</span></span> <span data-ttu-id="9509f-233">クエリによって返されるレコードの合計数は、ページングを実装するために必要な要素として、データセットから確かめるすることができます。</span><span class="sxs-lookup"><span data-stu-id="9509f-233">The total number of records returned by the query an essential aspect to implementing paging can be ascertained from the DataSet.</span></span> <span data-ttu-id="9509f-234">さらに、データセットの結果は DataView を使用して並べ替えることができます。</span><span class="sxs-lookup"><span data-stu-id="9509f-234">Additionally, the DataSet s results can be sorted through a DataView.</span></span> <span data-ttu-id="9509f-235">これらの機能は、GridView がページングまたは並べ替えデータを要求するときに、SqlDataSource によって自動的に使用されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-235">These capabilities are automatically used by the SqlDataSource when the GridView requests paged or sorted data.</span></span>

<span data-ttu-id="9509f-236">SqlDataSource は、その[`DataSourceMode` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx)を `DataSet` (既定) から `DataReader`に変更することによって、データセットではなく DataReader を返すように構成できます。</span><span class="sxs-lookup"><span data-stu-id="9509f-236">The SqlDataSource can be configured to return a DataReader instead of a DataSet by changing its [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx) from `DataSet` (the default) to `DataReader`.</span></span> <span data-ttu-id="9509f-237">Datareader を使用する場合は、DataReader を想定している既存のコードに SqlDataSource s の結果を渡すと、状況によって好ましい場合があります。</span><span class="sxs-lookup"><span data-stu-id="9509f-237">Using a DataReader might be preferred in situations when passing the SqlDataSource s results to existing code that expects a DataReader.</span></span> <span data-ttu-id="9509f-238">さらに、Datareader はデータセットよりもはるかに単純なオブジェクトであるため、パフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="9509f-238">Furthermore, since DataReaders are considerably simpler objects than DataSets, they offer better performance.</span></span> <span data-ttu-id="9509f-239">ただし、この変更を行った場合、SqlDataSource ではクエリによって返されるレコード数を確認できず、返されたデータを並べ替えるための手法も用意されていないため、データ Web コントロールは並べ替えもページもできません。</span><span class="sxs-lookup"><span data-stu-id="9509f-239">If you make this change, however, the data Web control can neither sort nor page since the SqlDataSource cannot ascertain how many records are returned by the query, nor does the DataReader offer any techniques for sorting the returned data.</span></span>

## <a name="step-4-using-a-custom-sql-statement-or-stored-procedure"></a><span data-ttu-id="9509f-240">手順 4: カスタム SQL ステートメントまたはストアドプロシージャの使用</span><span class="sxs-lookup"><span data-stu-id="9509f-240">Step 4: Using a Custom SQL Statement or Stored Procedure</span></span>

<span data-ttu-id="9509f-241">SqlDataSource コントロールを構成する場合、データを返すために使用されるクエリは、カスタム SQL ステートメントまたはストアドプロシージャとして、または既存のテーブルまたはビューの列として、次の2つの方法のいずれかで指定できます。</span><span class="sxs-lookup"><span data-stu-id="9509f-241">When configuring the SqlDataSource control, the query used to return data can be specified in one of two approaches as a custom SQL statement or stored procedure, or as columns from an existing table or view.</span></span> <span data-ttu-id="9509f-242">手順2では、`Products` テーブルから列を選択します。</span><span class="sxs-lookup"><span data-stu-id="9509f-242">In Step 2 we examined selecting columns from the `Products` table.</span></span> <span data-ttu-id="9509f-243">では、カスタム SQL ステートメントを使用する方法を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="9509f-243">Let s look at using a custom SQL statement.</span></span>

<span data-ttu-id="9509f-244">別の GridView コントロールを `Querying.aspx` ページに追加し、スマートタグのドロップダウンリストから新しいデータソースを作成することを選択します。</span><span class="sxs-lookup"><span data-stu-id="9509f-244">Add another GridView control to the `Querying.aspx` page and choose to create a new data source from the drop-down list in the smart tag.</span></span> <span data-ttu-id="9509f-245">次に、データがデータベースからプルされることを示します。これにより、新しい SqlDataSource コントロールが作成されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-245">Next, indicate that the data will be pulled from a database this will create a new SqlDataSource control.</span></span> <span data-ttu-id="9509f-246">コントロールに `ProductsWithCategoryInfoDataSource`という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="9509f-246">Name the control `ProductsWithCategoryInfoDataSource`.</span></span>

![「製品とカテゴリのインフォデータソース」という名前の新しい SqlDataSource コントロールを作成します。](querying-data-with-the-sqldatasource-control-vb/_static/image18.gif)

<span data-ttu-id="9509f-248">**図 12**: `ProductsWithCategoryInfoDataSource` という名前の新しい SqlDataSource コントロールを作成する</span><span class="sxs-lookup"><span data-stu-id="9509f-248">**Figure 12**: Create a New SqlDataSource Control Named `ProductsWithCategoryInfoDataSource`</span></span>

<span data-ttu-id="9509f-249">次の画面では、データベースを指定するように求められます。</span><span class="sxs-lookup"><span data-stu-id="9509f-249">The next screen asks us to specify the database.</span></span> <span data-ttu-id="9509f-250">図7に戻ってきたように、ドロップダウンリストから `NORTHWINDConnectionString` を選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9509f-250">As we did back in Figure 7, select the `NORTHWINDConnectionString` from the drop-down list and click Next.</span></span> <span data-ttu-id="9509f-251">[Select ステートメントの構成] 画面で、[カスタム SQL ステートメントまたはストアドプロシージャを指定します] オプションを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="9509f-251">In the Configure the Select Statement screen, choose the Specify a custom SQL statement or stored procedure radio button and click Next.</span></span> <span data-ttu-id="9509f-252">[カスタムステートメントまたはストアドプロシージャの定義] 画面が表示され、[選択]、[更新]、[挿入]、および [削除] というラベルの付いたタブが表示されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-252">This will bring up the Define Custom Statements or Stored Procedures screen, which offers tabs labeled SELECT, UPDATE, INSERT, and DELETE.</span></span> <span data-ttu-id="9509f-253">各タブで、テキストボックスにカスタム SQL ステートメントを入力するか、ドロップダウンリストからストアドプロシージャを選択できます。</span><span class="sxs-lookup"><span data-stu-id="9509f-253">In each tab you can enter a custom SQL statement into the textbox or choose a stored procedure from the drop-down list.</span></span> <span data-ttu-id="9509f-254">このチュートリアルでは、カスタム SQL ステートメントの入力について説明します。次のチュートリアルでは、ストアドプロシージャを使用する例を紹介します。</span><span class="sxs-lookup"><span data-stu-id="9509f-254">In this tutorial we will look at entering a custom SQL statement; the next tutorial includes an example that uses a stored procedure.</span></span>

![カスタム SQL ステートメントを入力するか、ストアドプロシージャを選択します。](querying-data-with-the-sqldatasource-control-vb/_static/image19.gif)

<span data-ttu-id="9509f-256">**図 13**: カスタム SQL ステートメントを入力するか、ストアドプロシージャを選択する</span><span class="sxs-lookup"><span data-stu-id="9509f-256">**Figure 13**: Enter a Custom SQL Statement or Pick a Stored Procedure</span></span>

<span data-ttu-id="9509f-257">カスタム SQL ステートメントは、手動でテキストボックスに入力することも、[クエリビルダー] ボタンをクリックしてグラフィカルに作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="9509f-257">The custom SQL statement can be entered by hand into the textbox or can be constructed graphically by clicking the Query Builder button.</span></span> <span data-ttu-id="9509f-258">`JOIN` テーブルから製品 `CategoryName` を取得するには、次のクエリを使用して、クエリビルダーまたはテキストボックスから、次のクエリを使用して、`Products` テーブルの `ProductID` と `ProductName` のフィールドを返します。</span><span class="sxs-lookup"><span data-stu-id="9509f-258">From either the Query Builder or the textbox, use the following query to return the `ProductID` and `ProductName` fields from the `Products` table using a `JOIN` to retrieve the product s `CategoryName` from the `Categories` table:</span></span>

[!code-sql[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample4.sql)]

![クエリは、を使用してグラフィカルに作成できクエリビルダー](querying-data-with-the-sqldatasource-control-vb/_static/image20.gif)

<span data-ttu-id="9509f-260">**図 14**: を使用してクエリをグラフィカルに作成する方法クエリビルダー</span><span class="sxs-lookup"><span data-stu-id="9509f-260">**Figure 14**: You can Graphically Construct the Query Using the Query Builder</span></span>

<span data-ttu-id="9509f-261">クエリを指定したら、[次へ] をクリックして [クエリのテスト] 画面に進みます。</span><span class="sxs-lookup"><span data-stu-id="9509f-261">After specifying the query, click Next to proceed to the Test Query screen.</span></span> <span data-ttu-id="9509f-262">[完了] をクリックして、SqlDataSource wizard を完了します。</span><span class="sxs-lookup"><span data-stu-id="9509f-262">Click Finish to complete the SqlDataSource wizard.</span></span>

<span data-ttu-id="9509f-263">ウィザードを完了すると、GridView に3つの連結されたフィールドが追加され、クエリから返された `ProductID`、`ProductName`、および `CategoryName` 列が表示され、次の宣言型マークアップが生成されます。</span><span class="sxs-lookup"><span data-stu-id="9509f-263">After completing the wizard, the GridView will have three BoundFields added to it displaying the `ProductID`, `ProductName`, and `CategoryName` columns returned from the query and resulting in the following declarative markup:</span></span>

[!code-aspx[Main](querying-data-with-the-sqldatasource-control-vb/samples/sample5.aspx)]

<span data-ttu-id="9509f-264">[GridView に ![、各製品の ID、名前、および関連付けられているカテゴリ名が表示されます。](querying-data-with-the-sqldatasource-control-vb/_static/image22.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="9509f-264">[![The GridView Shows Each Product s ID, Name, and Associated Category Name](querying-data-with-the-sqldatasource-control-vb/_static/image22.gif)](querying-data-with-the-sqldatasource-control-vb/_static/image21.gif)</span></span>

<span data-ttu-id="9509f-265">**図 15**: GridView には、各製品の ID、名前、および関連付けられているカテゴリ名が表示されます ([クリックすると、フルサイズの画像が表示](querying-data-with-the-sqldatasource-control-vb/_static/image23.gif)されます)</span><span class="sxs-lookup"><span data-stu-id="9509f-265">**Figure 15**: The GridView Shows Each Product s ID, Name, and Associated Category Name ([Click to view full-size image](querying-data-with-the-sqldatasource-control-vb/_static/image23.gif))</span></span>

## <a name="summary"></a><span data-ttu-id="9509f-266">要約</span><span class="sxs-lookup"><span data-stu-id="9509f-266">Summary</span></span>

<span data-ttu-id="9509f-267">このチュートリアルでは、SqlDataSource コントロールを使用してデータのクエリと表示を行う方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="9509f-267">In this tutorial we saw how to query and display data using the SqlDataSource control.</span></span> <span data-ttu-id="9509f-268">ObjectDataSource と同様に、SqlDataSource はプロキシとして機能し、データにアクセスするための宣言型のアプローチを提供します。</span><span class="sxs-lookup"><span data-stu-id="9509f-268">Like the ObjectDataSource, the SqlDataSource serves as a proxy, providing a declarative approach to accessing data.</span></span> <span data-ttu-id="9509f-269">このプロパティは、接続先のデータベースと実行する SQL `SELECT` クエリを指定します。これらは、プロパティウィンドウまたはデータソースの構成ウィザードを使用して指定できます。</span><span class="sxs-lookup"><span data-stu-id="9509f-269">Its properties specify the database to connect to and the SQL `SELECT` query to execute; they can be specified through the Properties window or by using the Configure DataSource wizard.</span></span>

<span data-ttu-id="9509f-270">このチュートリアルで調べた `SELECT` クエリの例では、指定されたクエリのすべてのレコードが返されました。</span><span class="sxs-lookup"><span data-stu-id="9509f-270">The `SELECT` query examples we examined in this tutorial returned all of the records from the specified query.</span></span> <span data-ttu-id="9509f-271">ただし、SqlDataSource コントロールには、値がプログラムによって割り当てられるか、または指定されたソースから自動的にプルされるパラメーターを含む `WHERE` 句を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="9509f-271">The SqlDataSource control, however, can include a `WHERE` clause with parameters whose values are assigned programmatically or are automatically pulled from a specified source.</span></span> <span data-ttu-id="9509f-272">パラメーター化されたクエリを作成して使用する方法については、次のチュートリアルで説明します。</span><span class="sxs-lookup"><span data-stu-id="9509f-272">We'll examine how to create and use parameterized queries in the next tutorial!</span></span>

<span data-ttu-id="9509f-273">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="9509f-273">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="9509f-274">関連項目</span><span class="sxs-lookup"><span data-stu-id="9509f-274">Further Reading</span></span>

<span data-ttu-id="9509f-275">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="9509f-275">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="9509f-276">リレーショナルデータベースデータへのアクセス</span><span class="sxs-lookup"><span data-stu-id="9509f-276">Accessing Relational Database Data</span></span>](http://aspnet.4guysfromrolla.com/articles/022206-1.aspx)
- [<span data-ttu-id="9509f-277">SqlDataSource コントロールの概要</span><span class="sxs-lookup"><span data-stu-id="9509f-277">SqlDataSource Control Overview</span></span>](https://msdn.microsoft.com/library/dz12d98w.aspx)
- [<span data-ttu-id="9509f-278">ASP.NET クイックスタートチュートリアル: SqlDataSource コントロール</span><span class="sxs-lookup"><span data-stu-id="9509f-278">ASP.NET Quickstart Tutorials: The SqlDataSource Control</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/sqldatasource.aspx)
- [<span data-ttu-id="9509f-279">Web.config `<connectionStrings>` 要素</span><span class="sxs-lookup"><span data-stu-id="9509f-279">The Web.config `<connectionStrings>` Element</span></span>](https://msdn.microsoft.com/library/bf7sd233.aspx)
- [<span data-ttu-id="9509f-280">データベース接続文字列のリファレンス</span><span class="sxs-lookup"><span data-stu-id="9509f-280">Database Connection String Reference</span></span>](http://www.connectionstrings.com/)

## <a name="about-the-author"></a><span data-ttu-id="9509f-281">作成者について</span><span class="sxs-lookup"><span data-stu-id="9509f-281">About the Author</span></span>

<span data-ttu-id="9509f-282">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="9509f-282">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9509f-283">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="9509f-283">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9509f-284">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="9509f-284">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9509f-285">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9509f-285">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="9509f-286">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="9509f-286">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="9509f-287">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="9509f-287">Special Thanks To</span></span>

<span data-ttu-id="9509f-288">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="9509f-288">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9509f-289">このチュートリアルのリードレビュー担当者は、スーザン、Bernadette Leigh、David 藤巻 u でした。</span><span class="sxs-lookup"><span data-stu-id="9509f-289">Lead reviewers for this tutorial were Susan Connery, Bernadette Leigh, and David Suru.</span></span> <span data-ttu-id="9509f-290">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="9509f-290">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9509f-291">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9509f-291">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9509f-292">[前へ](implementing-optimistic-concurrency-with-the-sqldatasource-cs.md)
> [次へ](using-parameterized-queries-with-the-sqldatasource-vb.md)</span><span class="sxs-lookup"><span data-stu-id="9509f-292">[Previous](implementing-optimistic-concurrency-with-the-sqldatasource-cs.md)
[Next](using-parameterized-queries-with-the-sqldatasource-vb.md)</span></span>
