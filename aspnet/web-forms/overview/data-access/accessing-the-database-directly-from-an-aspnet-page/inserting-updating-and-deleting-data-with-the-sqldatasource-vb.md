---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/inserting-updating-and-deleting-data-with-the-sqldatasource-vb
title: SqlDataSource (VB) を使用したデータの挿入、更新、および削除Microsoft Docs
author: rick-anderson
description: 前のチュートリアルでは、ObjectDataSource コントロールでデータの挿入、更新、および削除を許可する方法について学習しました。 SqlDataSource コントロールでサポートされている...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: 9673bef3-892c-45ba-a7d8-0da3d6f48ec5
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/inserting-updating-and-deleting-data-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: 4f7b282b09769272df8ff3a32aa4c509c8917481
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78508336"
---
# <a name="inserting-updating-and-deleting-data-with-the-sqldatasource-vb"></a><span data-ttu-id="c97cb-104">SqlDataSource でデータを挿入、更新、削除する (VB)</span><span class="sxs-lookup"><span data-stu-id="c97cb-104">Inserting, Updating, and Deleting Data with the SqlDataSource (VB)</span></span>

<span data-ttu-id="c97cb-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c97cb-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c97cb-106">[サンプルアプリのダウンロード](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_49_VB.exe)または[PDF のダウンロード](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/datatutorial49vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c97cb-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_49_VB.exe) or [Download PDF](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/datatutorial49vb1.pdf)</span></span>

> <span data-ttu-id="c97cb-107">前のチュートリアルでは、ObjectDataSource コントロールでデータの挿入、更新、および削除を許可する方法について学習しました。</span><span class="sxs-lookup"><span data-stu-id="c97cb-107">In previous tutorials we learned how the ObjectDataSource control allowed for inserting, updating, and deleting of data.</span></span> <span data-ttu-id="c97cb-108">SqlDataSource コントロールは同じ操作をサポートしますが、この方法は異なります。このチュートリアルでは、データの挿入、更新、および削除を行うための SqlDataSource を構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-108">The SqlDataSource control supports the same operations, but the approach is different, and this tutorial shows how to configure the SqlDataSource to insert, update, and delete data.</span></span>

## <a name="introduction"></a><span data-ttu-id="c97cb-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="c97cb-109">Introduction</span></span>

<span data-ttu-id="c97cb-110">[挿入、更新、および削除の概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)について説明したように、GridView コントロールには、組み込みの更新および削除機能が用意されています。また、DetailsView コントロールと FormView コントロールには、編集および削除機能と共に挿入サポートが含まれています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-110">As discussed in [An Overview of Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), the GridView control provides built-in updating and deleting capabilities, while the DetailsView and FormView controls include inserting support along with editing and deleting functionality.</span></span> <span data-ttu-id="c97cb-111">これらのデータ変更機能は、コード行を記述しなくても、データソースコントロールに直接接続できます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-111">These data modification capabilities can be plugged directly into a data source control without a line of code needing to be written.</span></span> <span data-ttu-id="c97cb-112">[挿入、更新、および削除の概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)については、ObjectDataSource を使用して、GridView、DetailsView、FormView コントロールでの挿入、更新、および削除を容易にします。</span><span class="sxs-lookup"><span data-stu-id="c97cb-112">[An Overview of Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) examined using the ObjectDataSource to facilitate inserting, updating, and deleting with the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="c97cb-113">または、ObjectDataSource の代わりに SqlDataSource を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-113">Alternatively, the SqlDataSource can be used in place of the ObjectDataSource.</span></span>

<span data-ttu-id="c97cb-114">挿入、更新、および削除をサポートするために、ObjectDataSource を使用して、挿入、更新、または削除アクションを実行するために呼び出すオブジェクトレイヤーメソッドを指定する必要があることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="c97cb-114">Recall that to support inserting, updating, and deleting, with the ObjectDataSource we needed to specify the object layer methods to invoke to perform the insert, update, or delete action.</span></span> <span data-ttu-id="c97cb-115">SqlDataSource を使用する場合は、`INSERT`、`UPDATE`、および `DELETE` SQL ステートメント (またはストアドプロシージャ) を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-115">With the SqlDataSource, we need to provide `INSERT`, `UPDATE`, and `DELETE` SQL statements (or stored procedures) to execute.</span></span> <span data-ttu-id="c97cb-116">このチュートリアルで説明するように、これらのステートメントは手動で作成することも、SqlDataSource s データソース構成ウィザードで自動的に生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-116">As we'll see in this tutorial, these statements can be created manually or can be automatically generated by the SqlDataSource s Configure Data Source wizard.</span></span>

> [!NOTE]
> <span data-ttu-id="c97cb-117">GridView、DetailsView、および FormView コントロールの挿入、編集、および削除機能については既に説明したので、このチュートリアルでは、これらの操作をサポートする SqlDataSource コントロールの構成に焦点を当てます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-117">Since we ve already discussed the inserting, editing, and deleting capabilities of the GridView, DetailsView, and FormView controls, this tutorial will focus on configuring the SqlDataSource control to support these operations.</span></span> <span data-ttu-id="c97cb-118">GridView、DetailsView、および FormView 内でこれらの機能を実装するときにブラシを作成する必要がある場合は、データの編集、挿入、および削除に関するチュートリアルに戻り、[挿入、更新、削除の概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)を説明します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-118">If you need to brush up on implementing these features within the GridView, DetailsView, and FormView, return to the Editing, Inserting, and Deleting Data tutorials, starting with [An Overview of Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md).</span></span>

## <a name="step-1-specifyinginsertupdate-anddeletestatements"></a><span data-ttu-id="c97cb-119">手順 1:`INSERT`、`UPDATE`、および`DELETE`ステートメントの指定</span><span class="sxs-lookup"><span data-stu-id="c97cb-119">Step 1: Specifying`INSERT`,`UPDATE`, and`DELETE`Statements</span></span>

<span data-ttu-id="c97cb-120">これまでの2つのチュートリアルで説明したように、SqlDataSource コントロールからデータを取得するには、次の2つのプロパティを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-120">As we ve seen in the past two tutorials, to retrieve data from a SqlDataSource control we need to set two properties:</span></span>

1. <span data-ttu-id="c97cb-121">`ConnectionString`。クエリの送信先となるデータベースを指定します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-121">`ConnectionString`, which specifies what database to send the query to, and</span></span>
2. <span data-ttu-id="c97cb-122">`SelectCommand`。結果を返すために実行するアドホック SQL ステートメントまたはストアドプロシージャ名を指定します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-122">`SelectCommand`, which specifies the ad-hoc SQL statement or stored procedure name to execute to return the results.</span></span>

<span data-ttu-id="c97cb-123">パラメーターを持つ `SelectCommand` 値の場合、パラメーター値は SqlDataSource s `SelectParameters` コレクションを介して指定され、ハードコーディングされた値、共通パラメーターソース値 (querystring フィールド、セッション変数、Web コントロール値など)、またはプログラムによって割り当てられることがあります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-123">For `SelectCommand` values with parameters, the parameter values are specified via the SqlDataSource s `SelectParameters` collection and can include hard-coded values, common parameter source values (querystring fields, session variables, Web control values, and so on), or can be programmatically assigned.</span></span> <span data-ttu-id="c97cb-124">SqlDataSource control s `Select()` メソッドがプログラムによって、またはデータ Web コントロールから自動的に呼び出されると、データベースへの接続が確立され、パラメーター値がクエリに割り当てられ、コマンドがデータベースに shuttled されます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-124">When the SqlDataSource control s `Select()` method is invoked either programmatically or automatically from a data Web control a connection to the database is established, the parameter values are assigned to the query, and the command is shuttled off to the database.</span></span> <span data-ttu-id="c97cb-125">結果は、コントロール s の `DataSourceMode` プロパティの値に応じて、データセットまたは DataReader として返されます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-125">The results are then returned as either a DataSet or DataReader, depending on the value of the control s `DataSourceMode` property.</span></span>

<span data-ttu-id="c97cb-126">データの選択と共に、SqlDataSource コントロールを使用して、`INSERT`、`UPDATE`、および `DELETE` SQL ステートメントをほぼ同じ方法で挿入、更新、および削除することができます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-126">Along with selecting data, the SqlDataSource control can be used to insert, update, and delete data by supplying `INSERT`, `UPDATE`, and `DELETE` SQL statements in much the same way.</span></span> <span data-ttu-id="c97cb-127">実行する SQL ステートメント `INSERT`、`UPDATE`、および `DELETE` の `InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティを割り当てるだけです。</span><span class="sxs-lookup"><span data-stu-id="c97cb-127">Simply assign the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties the `INSERT`, `UPDATE`, and `DELETE` SQL statements to execute.</span></span> <span data-ttu-id="c97cb-128">ステートメントにパラメーターがある場合は (ほとんどの場合)、`InsertParameters`、`UpdateParameters`、および `DeleteParameters` コレクションに含めます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-128">If the statements have parameters (as they most always will), include them in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span>

<span data-ttu-id="c97cb-129">`InsertCommand`、`UpdateCommand`、または `DeleteCommand` 値が指定されると、対応するデータ Web コントロール s スマートタグの [挿入の有効化]、[編集の有効化]、または [削除の有効化] オプションが使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-129">Once an `InsertCommand`, `UpdateCommand`, or `DeleteCommand` value has been specified, the Enable Inserting, Enable Editing, or Enable Deleting option in the corresponding data Web control s smart tag will become available.</span></span> <span data-ttu-id="c97cb-130">これを説明するために、「 [SqlDataSource Control チュートリアルを使用](querying-data-with-the-sqldatasource-control-vb.md)してデータにクエリを実行する」で作成した `Querying.aspx` ページから例を見て、削除機能を含むように拡張します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-130">To illustrate this, let s take an example from the `Querying.aspx` page we created in the [Querying Data with the SqlDataSource Control](querying-data-with-the-sqldatasource-control-vb.md) tutorial and augment it to include delete capabilities.</span></span>

<span data-ttu-id="c97cb-131">まず、`SqlDataSource` フォルダーから `InsertUpdateDelete.aspx` ページと `Querying.aspx` ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-131">Start by opening the `InsertUpdateDelete.aspx` and `Querying.aspx` pages from the `SqlDataSource` folder.</span></span> <span data-ttu-id="c97cb-132">`Querying.aspx` ページのデザイナーから、最初の例の SqlDataSource と GridView (`ProductsDataSource` コントロールと `GridView1` コントロール) を選択します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-132">From the Designer on the `Querying.aspx` page, select the SqlDataSource and GridView from the first example (the `ProductsDataSource` and `GridView1` controls).</span></span> <span data-ttu-id="c97cb-133">2つのコントロールを選択したら、[編集] メニューの [コピー] をクリックします (または、Ctrl + C キーを押します)。</span><span class="sxs-lookup"><span data-stu-id="c97cb-133">After selecting the two controls, go to the Edit menu and choose Copy (or just hit Ctrl+C).</span></span> <span data-ttu-id="c97cb-134">次に、`InsertUpdateDelete.aspx` のデザイナーにアクセスして、コントロールを貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-134">Next, go to the Designer of `InsertUpdateDelete.aspx` and paste in the controls.</span></span> <span data-ttu-id="c97cb-135">2つのコントロールを `InsertUpdateDelete.aspx`に移動したら、ブラウザーでページをテストします。</span><span class="sxs-lookup"><span data-stu-id="c97cb-135">After you have moved the two controls over to `InsertUpdateDelete.aspx`, test out the page in a browser.</span></span> <span data-ttu-id="c97cb-136">`Products` データベーステーブルのすべてのレコードについて、`ProductID`、`ProductName`、および `UnitPrice` 列の値が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-136">You should see the values of the `ProductID`, `ProductName`, and `UnitPrice` columns for all of the records in the `Products` database table.</span></span>

<span data-ttu-id="c97cb-137">[すべての製品が ProductID で並べ替えられて ![表示されます。](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image1.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c97cb-137">[![All of the Products are Listed, Ordered by ProductID](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image1.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="c97cb-138">**図 1**: すべての製品が `ProductID` 順に一覧表示されます ([クリックすると、フルサイズの画像が表示](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image2.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c97cb-138">**Figure 1**: All of the Products are Listed, Ordered by `ProductID` ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image2.png))</span></span>

## <a name="adding-the-sqldatasource-sdeletecommandanddeleteparametersproperties"></a><span data-ttu-id="c97cb-139">SqlDataSource s`DeleteCommand`と`DeleteParameters`プロパティの追加</span><span class="sxs-lookup"><span data-stu-id="c97cb-139">Adding the SqlDataSource s`DeleteCommand`and`DeleteParameters`Properties</span></span>

<span data-ttu-id="c97cb-140">この時点で、`Products` テーブルのすべてのレコードと、このデータを表示する GridView が返されるのは、SqlDataSource です。</span><span class="sxs-lookup"><span data-stu-id="c97cb-140">At this point we have a SqlDataSource that simply returns all of the records from the `Products` table and a GridView that renders this data.</span></span> <span data-ttu-id="c97cb-141">目標は、この例を拡張して、ユーザーが GridView で製品を削除できるようにすることです。</span><span class="sxs-lookup"><span data-stu-id="c97cb-141">Our goal is to extend this example to allow for the user to delete products via the GridView.</span></span> <span data-ttu-id="c97cb-142">これを実現するには、SqlDataSource コントロール s `DeleteCommand` と `DeleteParameters` プロパティの値を指定してから、削除をサポートするように GridView を構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-142">To accomplish this we need to specify values for the SqlDataSource control s `DeleteCommand` and `DeleteParameters` properties and then configure the GridView to support deleting.</span></span>

<span data-ttu-id="c97cb-143">`DeleteCommand` プロパティと `DeleteParameters` プロパティは、さまざまな方法で指定できます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-143">The `DeleteCommand` and `DeleteParameters` properties can be specified in a number of ways:</span></span>

- <span data-ttu-id="c97cb-144">宣言型の構文を使用する</span><span class="sxs-lookup"><span data-stu-id="c97cb-144">Through the declarative syntax</span></span>
- <span data-ttu-id="c97cb-145">デザイナーのプロパティウィンドウから</span><span class="sxs-lookup"><span data-stu-id="c97cb-145">From the Properties window in the Designer</span></span>
- <span data-ttu-id="c97cb-146">データソース構成ウィザードの [カスタム SQL ステートメントまたはストアドプロシージャの指定] 画面から</span><span class="sxs-lookup"><span data-stu-id="c97cb-146">From the Specify a custom SQL statement or stored procedure screen in the Configure Data Source wizard</span></span>
- <span data-ttu-id="c97cb-147">データソースの構成ウィザードの [ビューのテーブルから列を指定] 画面の [詳細設定] ボタンを使用して、`DeleteCommand` と `DeleteParameters` のプロパティで使用される `DELETE` SQL ステートメントとパラメーターコレクションを実際に自動的に生成します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-147">Via the Advanced button in the Specify columns from a table of view screen in the Configure Data Source wizard, which will actually automatically generate the `DELETE` SQL statement and parameter collection used in the `DeleteCommand` and `DeleteParameters` properties</span></span>

<span data-ttu-id="c97cb-148">ここでは、手順 2. で `DELETE` ステートメントを自動的に作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-148">We'll examine how to automatically have the `DELETE` statement created in Step 2.</span></span> <span data-ttu-id="c97cb-149">ここでは、デザイナーのプロパティウィンドウを使用します。ただし、データソースの構成ウィザードまたは宣言型の構文オプションは同様に機能します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-149">For now, let s use the Properties window in the Designer, although the Configure Data Source wizard or declarative syntax option would work just as well.</span></span>

<span data-ttu-id="c97cb-150">`InsertUpdateDelete.aspx`のデザイナーで、SqlDataSource `ProductsDataSource` をクリックし、プロパティウィンドウを表示します ([表示] メニューの [プロパティウィンドウ] をクリックするか、F4 キーを押します)。</span><span class="sxs-lookup"><span data-stu-id="c97cb-150">From the Designer in `InsertUpdateDelete.aspx`, click on the `ProductsDataSource` SqlDataSource and then bring up the Properties window (from the View menu, choose Properties window, or simply hit F4).</span></span> <span data-ttu-id="c97cb-151">[DeleteQuery] プロパティを選択すると、一連の省略記号が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-151">Select the DeleteQuery property, which will bring up a set of ellipses.</span></span>

![[プロパティ] ウィンドウで DeleteQuery プロパティを選択します。](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image2.gif)

<span data-ttu-id="c97cb-153">**図 2**: [プロパティ] ウィンドウで Deletequery プロパティを選択する</span><span class="sxs-lookup"><span data-stu-id="c97cb-153">**Figure 2**: Select the DeleteQuery Property from the Properties Window</span></span>

> [!NOTE]
> <span data-ttu-id="c97cb-154">SqlDataSource に DeleteQuery プロパティがありません。</span><span class="sxs-lookup"><span data-stu-id="c97cb-154">The SqlDataSource doesn t have a DeleteQuery property.</span></span> <span data-ttu-id="c97cb-155">DeleteQuery は、`DeleteCommand` プロパティと `DeleteParameters` プロパティの組み合わせであり、デザイナーでウィンドウを表示するときにプロパティウィンドウにのみ表示されます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-155">Rather, DeleteQuery is a combination of the `DeleteCommand` and `DeleteParameters` properties and is only listed in the Properties window when viewing the window through the Designer.</span></span> <span data-ttu-id="c97cb-156">ソースビューのプロパティウィンドウを参照している場合は、代わりに `DeleteCommand` プロパティが見つかります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-156">If you are looking at the Properties window in the Source view, you'll find the `DeleteCommand` property instead.</span></span>

<span data-ttu-id="c97cb-157">DeleteQuery プロパティの省略記号をクリックして、[コマンドおよびパラメーターエディター] ダイアログボックスを表示します (図3を参照)。</span><span class="sxs-lookup"><span data-stu-id="c97cb-157">Click the ellipses in the DeleteQuery property to bring up the Command and Parameter Editor dialog box (see Figure 3).</span></span> <span data-ttu-id="c97cb-158">このダイアログボックスでは、`DELETE` SQL ステートメントを指定し、パラメーターを指定できます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-158">From this dialog box you can specify the `DELETE` SQL statement and specify the parameters.</span></span> <span data-ttu-id="c97cb-159">[`DELETE` コマンド] ボックスに次のクエリを入力します (手動で、または必要に応じてクエリビルダーを使用します)。</span><span class="sxs-lookup"><span data-stu-id="c97cb-159">Enter the following query into the `DELETE` command textbox (either manually or using the Query Builder, if you prefer):</span></span>

[!code-sql[Main](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="c97cb-160">次に、[パラメーターの更新] ボタンをクリックして、以下のパラメーターの一覧に `@ProductID` パラメーターを追加します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-160">Next, click the Refresh Parameters button to add the `@ProductID` parameter to the list of parameters below.</span></span>

<span data-ttu-id="c97cb-161">[![[プロパティ] ウィンドウで DeleteQuery プロパティを選択します。](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image3.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="c97cb-161">[![Select the DeleteQuery Property from the Properties Window](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image3.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="c97cb-162">**図 3**: [プロパティ] ウィンドウで Deletequery プロパティを選択[する (クリックすると、フルサイズの画像が表示](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image4.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c97cb-162">**Figure 3**: Select the DeleteQuery Property from the Properties Window ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image4.png))</span></span>

<span data-ttu-id="c97cb-163">このパラメーターに値を指定しないでください (パラメーターソースは None のままにし*て*おきます)。</span><span class="sxs-lookup"><span data-stu-id="c97cb-163">Do *not* provide a value for this parameter (leave its Parameter source at None ).</span></span> <span data-ttu-id="c97cb-164">削除サポートを GridView に追加すると、GridView は、[削除] ボタンがクリックされた行の `DataKeys` コレクションの値を使用して、このパラメーター値を自動的に指定します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-164">Once we add deleting support to the GridView, the GridView will automatically supply this parameter value, using the value of its `DataKeys` collection for the row whose Delete button was clicked.</span></span>

> [!NOTE]
> <span data-ttu-id="c97cb-165">`DELETE` クエリで使用されるパラメーター名は、GridView、DetailsView、または FormView の `DataKeyNames` 値の名前と同じで*ある必要があり*ます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-165">The parameter name used in the `DELETE` query *must* be the same as the name of the `DataKeyNames` value in the GridView, DetailsView, or FormView.</span></span> <span data-ttu-id="c97cb-166">つまり、Products テーブルの主キー列名 (したがって、GridView のいる datakeynames 値) が `ProductID`であるため、`DELETE` ステートメントのパラメーターには `@ProductID` (たとえば、`@ID`) という名前が付けられています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-166">That is, the parameter in the `DELETE` statement is purposefully named `@ProductID` (instead of, say, `@ID`), because the primary key column name in the Products table (and therefore the DataKeyNames value in the GridView) is `ProductID`.</span></span>

<span data-ttu-id="c97cb-167">パラメーター名と `DataKeyNames` 値が一致しない場合、GridView は `DataKeys` コレクションの値にパラメーターを自動的に割り当てることはできません。</span><span class="sxs-lookup"><span data-stu-id="c97cb-167">If the parameter name and `DataKeyNames` value doesn t match, the GridView cannot automatically assign the parameter the value from the `DataKeys` collection.</span></span>

<span data-ttu-id="c97cb-168">[コマンドおよびパラメーターエディター] ダイアログボックスに削除関連の情報を入力したら、[OK] をクリックし、ソースビューにアクセスして、結果の宣言型マークアップを確認します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-168">After entering the delete-related information into the Command and Parameter Editor dialog box click OK and go to the Source view to examine the resulting declarative markup:</span></span>

[!code-aspx[Main](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/samples/sample2.aspx)]

<span data-ttu-id="c97cb-169">`DeleteCommand` プロパティ、`<DeleteParameters>` セクション、および `productID`という名前のパラメーターオブジェクトが追加されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c97cb-169">Note the addition of the `DeleteCommand` property as well as the `<DeleteParameters>` section and the Parameter object named `productID`.</span></span>

## <a name="configuring-the-gridview-for-deleting"></a><span data-ttu-id="c97cb-170">削除のための GridView の構成</span><span class="sxs-lookup"><span data-stu-id="c97cb-170">Configuring the GridView for Deleting</span></span>

<span data-ttu-id="c97cb-171">`DeleteCommand` プロパティが追加されたので、GridView s スマートタグに [削除を有効にする] オプションが含まれるようになりました。</span><span class="sxs-lookup"><span data-stu-id="c97cb-171">With the `DeleteCommand` property added, the GridView s smart tag now contains the Enable Deleting option.</span></span> <span data-ttu-id="c97cb-172">さあ、このチェックボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="c97cb-172">Go ahead and check this checkbox.</span></span> <span data-ttu-id="c97cb-173">[挿入、更新、および削除の概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)について説明したように、これにより、GridView は `ShowDeleteButton` プロパティが `True`に設定された commandfield を追加します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-173">As discussed in [An Overview of Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), this causes the GridView to add a CommandField with its `ShowDeleteButton` property set to `True`.</span></span> <span data-ttu-id="c97cb-174">図4に示すように、ブラウザーを使用してページにアクセスすると、[削除] ボタンが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-174">As Figure 4 shows, when the page is visited through a browser a Delete button is included.</span></span> <span data-ttu-id="c97cb-175">このページをテストするには、いくつかの製品を削除します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-175">Test this page out by deleting some products.</span></span>

<span data-ttu-id="c97cb-176">[各 GridView 行に [Delete] ボタンが追加され ![](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image4.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c97cb-176">[![Each GridView Row Now Includes a Delete Button](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image4.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="c97cb-177">**図 4**: 各 GridView 行に Delete ボタンが追加されました ([クリックすると、フルサイズの画像が表示](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image6.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c97cb-177">**Figure 4**: Each GridView Row Now Includes a Delete Button ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image6.png))</span></span>

<span data-ttu-id="c97cb-178">[削除] ボタンをクリックするとポストバックが発生すると、GridView は、[削除] ボタンをクリックした行の `DataKeys` コレクション値の値を `ProductID` パラメーターに割り当て、SqlDataSource s `Delete()` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-178">Upon clicking a Delete button, a postback occurs, the GridView assigns the `ProductID` parameter the value of the `DataKeys` collection value for the row whose Delete button was clicked, and invokes the SqlDataSource s `Delete()` method.</span></span> <span data-ttu-id="c97cb-179">次に、SqlDataSource コントロールはデータベースに接続し、`DELETE` ステートメントを実行します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-179">The SqlDataSource control then connects to the database and executes the `DELETE` statement.</span></span> <span data-ttu-id="c97cb-180">次に、GridView は SqlDataSource に再バインドし、現在の製品セットを取得して表示します (削除されたレコードは含まれなくなりました)。</span><span class="sxs-lookup"><span data-stu-id="c97cb-180">The GridView then rebinds to the SqlDataSource, getting back and displaying the current set of products (which no longer includes the just-deleted record).</span></span>

> [!NOTE]
> <span data-ttu-id="c97cb-181">GridView は `DataKeys` コレクションを使用して SqlDataSource パラメーターを設定するため、GridView の `DataKeyNames` プロパティが主キーを構成する列に設定され、SqlDataSource s `SelectCommand` によってこれらの列が返されることが重要です。</span><span class="sxs-lookup"><span data-stu-id="c97cb-181">Since the GridView uses its `DataKeys` collection to populate the SqlDataSource parameters, it s vital that the GridView s `DataKeyNames` property be set to the column(s) that constitute the primary key and that the SqlDataSource s `SelectCommand` returns these columns.</span></span> <span data-ttu-id="c97cb-182">さらに、SqlDataSource s `DeleteCommand` のパラメーター名が `@ProductID`に設定されていることが重要です。</span><span class="sxs-lookup"><span data-stu-id="c97cb-182">Moreover, it s important that the parameter name in the SqlDataSource s `DeleteCommand` is set to `@ProductID`.</span></span> <span data-ttu-id="c97cb-183">`DataKeyNames` プロパティが設定されていない場合、またはパラメーターの名前が `@ProductsID`でない場合は、[削除] ボタンをクリックするとポストバックが発生しますが、実際にはレコードは削除されません。</span><span class="sxs-lookup"><span data-stu-id="c97cb-183">If the `DataKeyNames` property is not set or the parameter is not named `@ProductsID`, clicking the Delete button will cause a postback, but won't actually delete any record.</span></span>

<span data-ttu-id="c97cb-184">図5は、この対話をグラフィカルに示しています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-184">Figure 5 depicts this interaction graphically.</span></span> <span data-ttu-id="c97cb-185">データ Web コントロールからの挿入、更新、および削除に関連するイベントのチェーンの詳細については、「[挿入、更新、および削除に関連するイベントの調査」](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c97cb-185">Refer back to the [Examining the Events Associated with Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb.md) tutorial for a more detailed discussion on the chain of events associated with inserting, updating, and deleting from a data Web control.</span></span>

![GridView の [削除] ボタンをクリックすると、SqlDataSource s Delete () メソッドが呼び出されます。](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image5.gif)

<span data-ttu-id="c97cb-187">**図 5**: GridView の [削除] ボタンをクリックすると、SqlDataSource s `Delete()` メソッドが呼び出される</span><span class="sxs-lookup"><span data-stu-id="c97cb-187">**Figure 5**: Clicking the Delete Button in the GridView Invokes the SqlDataSource s `Delete()` Method</span></span>

## <a name="step-2-automatically-generating-theinsertupdate-anddeletestatements"></a><span data-ttu-id="c97cb-188">手順 2:`INSERT`、`UPDATE`、および`DELETE`ステートメントを自動的に生成する</span><span class="sxs-lookup"><span data-stu-id="c97cb-188">Step 2: Automatically Generating the`INSERT`,`UPDATE`, and`DELETE`Statements</span></span>

<span data-ttu-id="c97cb-189">手順 1. で確認したように、`INSERT`、`UPDATE`、および `DELETE` SQL ステートメントは、プロパティウィンドウまたはコントロール s 宣言構文を使用して指定できます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-189">As Step 1 examined, `INSERT`, `UPDATE`, and `DELETE` SQL statements can be specified through the Properties window or the control s declarative syntax.</span></span> <span data-ttu-id="c97cb-190">ただし、この方法では手動で SQL ステートメントを手動で書き出す必要がありますが、単調なとエラーが発生しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-190">However, this approach requires that we manually write out the SQL statements by hand, which can be monotonous and error-prone.</span></span> <span data-ttu-id="c97cb-191">幸いにも、データソースの構成ウィザードでは、[ビューのテーブルから列を指定] 画面を使用して、`INSERT`、`UPDATE`、および `DELETE` ステートメントを自動的に生成するオプションが用意されています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-191">Fortunately, the Configure Data Source wizard provides an option to have the `INSERT`, `UPDATE`, and `DELETE` statements automatically generated when using the Specify columns from a table of view screen.</span></span>

<span data-ttu-id="c97cb-192">ここでは、この自動生成オプションについて説明します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-192">Let s explore this automatic generation option.</span></span> <span data-ttu-id="c97cb-193">`InsertUpdateDelete.aspx` のデザイナーに DetailsView を追加し、その `ID` プロパティを `ManageProducts`に設定します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-193">Add a DetailsView to the Designer in `InsertUpdateDelete.aspx` and set its `ID` property to `ManageProducts`.</span></span> <span data-ttu-id="c97cb-194">次に、[DetailsView s] スマートタグから、新しいデータソースを作成し、`ManageProductsDataSource`という名前の SqlDataSource を作成します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-194">Next, from the DetailsView s smart tag, choose to create a new data source and create a SqlDataSource named `ManageProductsDataSource`.</span></span>

<span data-ttu-id="c97cb-195">[Manage製品 Datasource という名前の新しい SqlDataSource を作成 ![には](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image6.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c97cb-195">[![Create a New SqlDataSource Named ManageProductsDataSource](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image6.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="c97cb-196">**図 6**: `ManageProductsDataSource` という名前の新しい SqlDataSource を作成[する (クリックすると、フルサイズの画像が表示](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image8.png)される)</span><span class="sxs-lookup"><span data-stu-id="c97cb-196">**Figure 6**: Create a New SqlDataSource Named `ManageProductsDataSource` ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image8.png))</span></span>

<span data-ttu-id="c97cb-197">データソースの構成ウィザードで、`NORTHWINDConnectionString` 接続文字列を使用することを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c97cb-197">From the Configure Data Source wizard, opt to use the `NORTHWINDConnectionString` connection string and click Next.</span></span> <span data-ttu-id="c97cb-198">[Select ステートメントの構成] 画面で、[テーブルまたはビューから列を指定する] ラジオボタンを選択したままにして、ドロップダウンリストから `Products` テーブルを選択します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-198">From the Configure the Select Statement screen, leave the Specify columns from a table or view radio button selected and pick the `Products` table from the drop-down list.</span></span> <span data-ttu-id="c97cb-199">`ProductID`、`ProductName`、`UnitPrice`、および `Discontinued` の列をチェックボックスの一覧から選択します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-199">Select the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` columns from the checkbox list.</span></span>

<span data-ttu-id="c97cb-200">[Products テーブルを使用して ![、ProductID、ProductName、UnitPrice、および廃止された列を返します。](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image7.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="c97cb-200">[![Using the Products Table, Return the ProductID, ProductName, UnitPrice, and Discontinued Columns](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image7.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="c97cb-201">**図 7**: `Products` テーブルを使用して、`ProductID`、`ProductName`、`UnitPrice`、および `Discontinued` 列を返す ([クリックすると、フルサイズの画像が表示](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image10.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c97cb-201">**Figure 7**: Using the `Products` Table, Return the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` Columns ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image10.png))</span></span>

<span data-ttu-id="c97cb-202">選択したテーブルと列に基づいて `INSERT`、`UPDATE`、および `DELETE` ステートメントを自動的に生成するには、[詳細設定] ボタンをクリックし、[`INSERT`の生成]、[`UPDATE`]、[`DELETE` ステートメント] チェックボックスをオンにします。</span><span class="sxs-lookup"><span data-stu-id="c97cb-202">To automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the selected table and columns, click the Advanced button and check the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox.</span></span>

![[INSERT、UPDATE、および DELETE ステートメントの生成] チェックボックスをオンにします。](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image8.gif)

<span data-ttu-id="c97cb-204">**図 8**: [`INSERT`の生成]、[`UPDATE`]、および [`DELETE` ステートメント] チェックボックスをオンにする</span><span class="sxs-lookup"><span data-stu-id="c97cb-204">**Figure 8**: Check the Generate `INSERT`, `UPDATE`, and `DELETE` statements Checkbox</span></span>

<span data-ttu-id="c97cb-205">[`INSERT`の生成]、[`UPDATE`]、および [`DELETE` ステートメント] チェックボックスは、選択したテーブルに主キーがあり、主キー列 (または列) が返された列の一覧に含まれている場合にのみチェック可能なになります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-205">The Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox will only be checkable if the table selected has a primary key and the primary key column (or columns) are included in the list of returned columns.</span></span> <span data-ttu-id="c97cb-206">[オプティミスティック同時実行制御を使用する] チェックボックスをオンにすると、[`INSERT`の生成]、[`UPDATE`]、および [`DELETE` ステートメント] チェックボックスがオンになった後に選択できるようになります。このチェックボックスをオンにすると、結果の `UPDATE` ステートメントと `DELETE` ステートメント内の `WHERE` 句が拡張され、</span><span class="sxs-lookup"><span data-stu-id="c97cb-206">The Use optimistic concurrency checkbox, which becomes selectable once the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox has been checked, will augment the `WHERE` clauses in the resulting `UPDATE` and `DELETE` statements to provide optimistic concurrency control.</span></span> <span data-ttu-id="c97cb-207">ここでは、このチェックボックスをオフのままにします。オプティミスティック同時実行制御については、次のチュートリアルでは SqlDataSource コントロールを使用します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-207">For now, leave this checkbox unchecked; we'll examine optimistic concurrency with the SqlDataSource control in the next tutorial.</span></span>

<span data-ttu-id="c97cb-208">[`INSERT`の生成]、[`UPDATE`、および `DELETE` ステートメント] チェックボックスをオンにした後、[OK] をクリックして [Select ステートメントの構成] 画面に戻り、[次へ] をクリックして、[完了] をクリックし、データソースの構成ウィザードを完了します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-208">After checking the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox, click OK to return to the Configure Select Statement screen, then click Next, and then Finish, to complete the Configure Data Source wizard.</span></span> <span data-ttu-id="c97cb-209">ウィザードを完了すると、Visual Studio によって、`ProductID`、`ProductName`、および `UnitPrice` 列の DetailsView に BoundFields が追加され、`Discontinued` 列の CheckBoxField が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-209">Upon completing the wizard, Visual Studio will add BoundFields to the DetailsView for the `ProductID`, `ProductName`, and `UnitPrice` columns and a CheckBoxField for the `Discontinued` column.</span></span> <span data-ttu-id="c97cb-210">DetailsView s スマートタグから、[ページングを有効にする] オプションをオンにして、このページにアクセスするユーザーが製品をステップ実行できるようにします。</span><span class="sxs-lookup"><span data-stu-id="c97cb-210">From the DetailsView s smart tag, check the Enable Paging option so that the user visiting this page can step through the products.</span></span> <span data-ttu-id="c97cb-211">また、DetailsView の `Width` と `Height` プロパティもクリアします。</span><span class="sxs-lookup"><span data-stu-id="c97cb-211">Also clear out the DetailsView s `Width` and `Height` properties.</span></span>

<span data-ttu-id="c97cb-212">スマートタグの [挿入を有効にする]、[編集を有効にする]、および [削除オプションを有効にする] があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c97cb-212">Notice that the smart tag has the Enable Inserting, Enable Editing, and Enable Deleting options available.</span></span> <span data-ttu-id="c97cb-213">これは、次の宣言構文に示すように、SqlDataSource に `InsertCommand`、`UpdateCommand`、および `DeleteCommand`の値が含まれているためです。</span><span class="sxs-lookup"><span data-stu-id="c97cb-213">This is because the SqlDataSource contains values for its `InsertCommand`, `UpdateCommand`, and `DeleteCommand`, as the following declarative syntax shows:</span></span>

[!code-aspx[Main](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/samples/sample3.aspx)]

<span data-ttu-id="c97cb-214">SqlDataSource コントロールの `InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティに対して値が自動的に設定されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c97cb-214">Note how the SqlDataSource control has had values automatically set for its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties.</span></span> <span data-ttu-id="c97cb-215">`InsertCommand` プロパティと `UpdateCommand` プロパティで参照される列のセットは、`SELECT` ステートメントの列に基づいています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-215">The set of columns referenced in the `InsertCommand` and `UpdateCommand` properties are based on those in the `SELECT` statement.</span></span> <span data-ttu-id="c97cb-216">つまり、`InsertCommand` および `UpdateCommand`内の*すべて*の Products 列を使用するのではなく、`SelectCommand` で指定された列 `ProductID`( [`IDENTITY` 列](http://www.sqlteam.com/item.asp?ItemID=102)であるため、省略されています。これは、編集時に値を変更できず、挿入時に自動的に割り当てられます)。</span><span class="sxs-lookup"><span data-stu-id="c97cb-216">That is, rather than having *every* Products column in the `InsertCommand` and `UpdateCommand`, there are only those columns specified in the `SelectCommand` (less `ProductID`, which is omitted because it s an [`IDENTITY` column](http://www.sqlteam.com/item.asp?ItemID=102), whose value cannot be changed when edited and which is automatically assigned when inserting).</span></span> <span data-ttu-id="c97cb-217">さらに、`InsertCommand`、`UpdateCommand`、および `DeleteCommand` プロパティの各パラメーターには、`InsertParameters`、`UpdateParameters`、および `DeleteParameters` コレクションに対応するパラメーターがあります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-217">Moreover, for each parameter in the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties there are corresponding parameters in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span>

<span data-ttu-id="c97cb-218">DetailsView のデータ変更機能を有効にするには、[挿入を有効にする]、[編集を有効にする]、および [スマートタグの削除オプションを有効にする] をオンにします。</span><span class="sxs-lookup"><span data-stu-id="c97cb-218">To turn on the DetailsView s data modification features, check the Enable Inserting, Enable Editing, and Enable Deleting options in its smart tag.</span></span> <span data-ttu-id="c97cb-219">これにより、`ShowInsertButton`、`ShowEditButton`、および `ShowDeleteButton` プロパティが `True`に設定された CommandField が追加されます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-219">This adds a CommandField with its `ShowInsertButton`, `ShowEditButton`, and `ShowDeleteButton` properties set to `True`.</span></span>

<span data-ttu-id="c97cb-220">ブラウザーのページにアクセスし、DetailsView に含まれる [編集]、[削除]、および [新規] ボタンを確認します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-220">Visit the page in a browser and note the Edit, Delete, and New buttons included in the DetailsView.</span></span> <span data-ttu-id="c97cb-221">[編集] ボタンをクリックすると、DetailsView が編集モードに変わり、`ReadOnly` プロパティがテキストボックスとして `False` (既定) に設定されている各 BoundField と、チェックボックスとして CheckBoxField が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-221">Clicking the Edit button turns the DetailsView into edit mode, which displays each BoundField whose `ReadOnly` property is set to `False` (the default) as a TextBox, and the CheckBoxField as a checkbox.</span></span>

<span data-ttu-id="c97cb-222">[DetailsView s の既定の編集インターフェイスを ![する](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image9.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="c97cb-222">[![The DetailsView s Default Editing Interface](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image9.gif)](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="c97cb-223">**図 9**: DetailsView の既定の編集インターフェイス ([クリックしてフルサイズのイメージを表示する](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c97cb-223">**Figure 9**: The DetailsView s Default Editing Interface ([Click to view full-size image](inserting-updating-and-deleting-data-with-the-sqldatasource-vb/_static/image12.png))</span></span>

<span data-ttu-id="c97cb-224">同様に、現在選択されている製品を削除したり、システムに新しい製品を追加したりすることもできます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-224">Similarly, you can delete the currently selected product or add a new product to the system.</span></span> <span data-ttu-id="c97cb-225">`InsertCommand` ステートメントは、`ProductName`、`UnitPrice`、および `Discontinued` 列でのみ機能するため、他の列には、挿入時にデータベースによって割り当てられた `NULL` または既定値があります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-225">Since the `InsertCommand` statement only works with the `ProductName`, `UnitPrice`, and `Discontinued` columns, the other columns have either `NULL` or their default value assigned by the database upon insert.</span></span> <span data-ttu-id="c97cb-226">ObjectDataSource と同様に、`InsertCommand` に `NULL` s が許可されていないデータベーステーブルの列があり、既定値がない場合は、`INSERT` ステートメントを実行しようとすると SQL エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-226">Just like with the ObjectDataSource, if the `InsertCommand` is missing any database table columns that don t allow `NULL` s and don t have a default value, a SQL error will occur when attempting to execute the `INSERT` statement.</span></span>

> [!NOTE]
> <span data-ttu-id="c97cb-227">DetailsView s の挿入および編集インターフェイスには、カスタマイズや検証の一種がありません。</span><span class="sxs-lookup"><span data-stu-id="c97cb-227">The DetailsView s inserting and editing interfaces lack any sort of customization or validation.</span></span> <span data-ttu-id="c97cb-228">検証コントロールを追加したり、インターフェイスをカスタマイズしたりするには、BoundFields を TemplateFields に変換する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-228">To add validation controls or to customize the interfaces, you need to convert the BoundFields to TemplateFields.</span></span> <span data-ttu-id="c97cb-229">詳細については、「[編集および挿入インターフェイスに検証コントロールを追加](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)する」および「[データ変更インターフェイスのカスタマイズ](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c97cb-229">Refer to the [Adding Validation Controls to the Editing and Inserting Interfaces](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md) and [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorials for more information.</span></span>

<span data-ttu-id="c97cb-230">また、更新と削除では、DetailsView は現在の product s `DataKey` value を使用します。これは、`DataKeyNames` プロパティが構成されている場合にのみ存在します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-230">Also, keep in mind that for updating and deleting, the DetailsView uses the current product s `DataKey` value, which is only present if the `DataKeyNames` property is configured.</span></span> <span data-ttu-id="c97cb-231">編集または削除が無効になっているように見える場合は、`DataKeyNames` プロパティが設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-231">If editing or deleting appears to have no effect, ensure that the `DataKeyNames` property is set.</span></span>

## <a name="limitations-of-automatically-generating-sql-statements"></a><span data-ttu-id="c97cb-232">SQL ステートメントの自動生成に関する制限事項</span><span class="sxs-lookup"><span data-stu-id="c97cb-232">Limitations of Automatically Generating SQL Statements</span></span>

<span data-ttu-id="c97cb-233">[`INSERT`の生成]、[`UPDATE`]、および [`DELETE` ステートメント] オプションは、テーブルから列を選択する場合にのみ使用できるため、より複雑なクエリの場合は、手順1で作成したのと同様に、独自の `INSERT`、`UPDATE`、および `DELETE` のステートメントを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-233">Since the Generate `INSERT`, `UPDATE`, and `DELETE` statements option is only available when picking columns from a table, for more complex queries you will have to write your own `INSERT`, `UPDATE`, and `DELETE` statements like we did in Step 1.</span></span> <span data-ttu-id="c97cb-234">一般的に、SQL `SELECT` ステートメントでは `JOIN` s を使用して1つ以上の参照テーブルのデータを表示します (製品情報を表示するときに、`Categories` table s `CategoryName` フィールドを元に戻すなど)。</span><span class="sxs-lookup"><span data-stu-id="c97cb-234">Commonly, SQL `SELECT` statements use `JOIN` s to bring back data from one or more lookup tables for display purposes (such as bringing back the `Categories` table s `CategoryName` field when displaying product information).</span></span> <span data-ttu-id="c97cb-235">同時に、ユーザーがコアテーブル (この場合は`Products`) に対してデータの編集、更新、または挿入を行えるようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-235">At the same time, we might want to allow the user to edit, update, or insert data into the core table (`Products`, in this case).</span></span>

<span data-ttu-id="c97cb-236">`INSERT`、`UPDATE`、および `DELETE` の各ステートメントは手動で入力できますが、次のような時間節約のヒントを検討してください。</span><span class="sxs-lookup"><span data-stu-id="c97cb-236">While the `INSERT`, `UPDATE`, and `DELETE` statements can be entered manually, consider the following time-saving tip.</span></span> <span data-ttu-id="c97cb-237">最初に、`Products` テーブルからのみデータを取得するように SqlDataSource を設定します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-237">Initially setup the SqlDataSource so that it pulls back data just from the `Products` table.</span></span> <span data-ttu-id="c97cb-238">[データソースの構成ウィザード] を使用すると、`INSERT`、`UPDATE`、および `DELETE` ステートメントを自動的に生成できるように、テーブルまたはビュー画面から列を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-238">Use the Configure Data Source wizard s Specify columns from a table or view screen so that you can automatically generate the `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="c97cb-239">次に、ウィザードが完了したら、プロパティウィンドウから SelectQuery を構成します (または、データソースの構成ウィザードに戻りますが、[カスタム SQL ステートメントまたはストアドプロシージャを指定します] オプションを使用します)。</span><span class="sxs-lookup"><span data-stu-id="c97cb-239">Then, after completing the wizard, choose to configure the SelectQuery from the Properties window (or, alternatively, go back to the Configure Data Source wizard, but use the Specify a custom SQL statement or stored procedure option).</span></span> <span data-ttu-id="c97cb-240">次に、`SELECT` ステートメントを更新して、`JOIN` 構文を含めます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-240">Then update the `SELECT` statement to include the `JOIN` syntax.</span></span> <span data-ttu-id="c97cb-241">この手法は、自動的に生成された SQL ステートメントの時間を節約し、よりカスタマイズされた `SELECT` ステートメントを使用できるようにします。</span><span class="sxs-lookup"><span data-stu-id="c97cb-241">This technique offers the time-saving benefits of the automatically generated SQL statements and allows for a more customized `SELECT` statement.</span></span>

<span data-ttu-id="c97cb-242">`INSERT`、`UPDATE`、および `DELETE` ステートメントを自動的に生成するもう1つの制限は、`INSERT` ステートメントと `UPDATE` ステートメントの列が、`SELECT` ステートメントによって返される列に基づいていることです。</span><span class="sxs-lookup"><span data-stu-id="c97cb-242">Another limitation of automatically generating the `INSERT`, `UPDATE`, and `DELETE` statements is that the columns in the `INSERT` and `UPDATE` statements are based on the columns returned by the `SELECT` statement.</span></span> <span data-ttu-id="c97cb-243">ただし、多くのフィールドを更新または挿入することが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-243">We may need to update or insert more or fewer fields, however.</span></span> <span data-ttu-id="c97cb-244">たとえば、手順 2. の例では、`UnitPrice` BoundField を読み取り専用にする必要があるかもしれません。</span><span class="sxs-lookup"><span data-stu-id="c97cb-244">For example, in the example from Step 2, maybe we want to have the `UnitPrice` BoundField be read-only.</span></span> <span data-ttu-id="c97cb-245">その場合は、`UpdateCommand`に表示されません。</span><span class="sxs-lookup"><span data-stu-id="c97cb-245">In that case, it shouldn't appear in the `UpdateCommand`.</span></span> <span data-ttu-id="c97cb-246">または、GridView に表示されないテーブルフィールドの値を設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-246">Or we may want to set the value of a table field that does not appear in the GridView.</span></span> <span data-ttu-id="c97cb-247">たとえば、新しいレコードを追加するときに、`QuantityPerUnit` の値を TODO に設定することができます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-247">For example, when adding a new record we may want the `QuantityPerUnit` value set to TODO .</span></span>

<span data-ttu-id="c97cb-248">このようなカスタマイズが必要な場合は、プロパティウィンドウ、ウィザードの [カスタム SQL ステートメントまたはストアドプロシージャの指定] オプション、または宣言型の構文を使用して、手動で作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-248">If such customizations are required, you need to make them manually, either through the Properties window, the Specify a custom SQL statement or stored procedure option in the wizard, or via the declarative syntax.</span></span>

> [!NOTE]
> <span data-ttu-id="c97cb-249">データ Web コントロールに対応するフィールドがないパラメーターを追加する場合は、これらのパラメーター値に何らかの方法で値を割り当てる必要があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c97cb-249">When adding parameters that do not have corresponding fields in the data Web control, keep in mind that these parameters values will need to be assigned values in some manner.</span></span> <span data-ttu-id="c97cb-250">これらの値は、`InsertCommand` または `UpdateCommand`で直接ハードコーディングすることができます。定義済みのソース (querystring、セッション状態、ページ上の Web コントロールなど) から取得できます。またはは、前のチュートリアルで説明したように、プログラムで割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-250">These values can be: hard-coded directly in the `InsertCommand` or `UpdateCommand`; can come from some pre-defined source (the querystring, session state, Web controls on the page, and so on); or can be assigned programmatically, as we saw in the preceding tutorial.</span></span>

## <a name="summary"></a><span data-ttu-id="c97cb-251">まとめ</span><span class="sxs-lookup"><span data-stu-id="c97cb-251">Summary</span></span>

<span data-ttu-id="c97cb-252">データ Web コントロールで組み込みの挿入、編集、および削除機能を使用するには、バインドされているデータソースコントロールがそのような機能を提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-252">In order for the data Web controls to utilize their built-in inserting, editing, and deleting capabilities, the data source control they are bound to must offer such functionality.</span></span> <span data-ttu-id="c97cb-253">SqlDataSource の場合、これは `INSERT`、`UPDATE`、および `DELETE` SQL ステートメントを `InsertCommand`、`UpdateCommand`、および `DeleteCommand` の各プロパティに割り当てる必要があることを意味します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-253">For the SqlDataSource, this means that `INSERT`, `UPDATE`, and `DELETE` SQL statements must be assigned to the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties.</span></span> <span data-ttu-id="c97cb-254">これらのプロパティおよび対応する parameters コレクションは、データソースの構成ウィザードを使用して手動で追加することも、自動的に生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="c97cb-254">These properties, and the corresponding parameters collections, can be added manually or generated automatically through the Configure Data Source wizard.</span></span> <span data-ttu-id="c97cb-255">このチュートリアルでは、両方の手法を検討しています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-255">In this tutorial we examined both techniques.</span></span>

<span data-ttu-id="c97cb-256">オプティミスティック同時実行制御の[実装](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md)に関するチュートリアルでは、ObjectDataSource と共にオプティミスティック同時実行制御を使用しています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-256">We examined using optimistic concurrency with the ObjectDataSource in the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial.</span></span> <span data-ttu-id="c97cb-257">SqlDataSource コントロールは、オプティミスティック同時実行制御も提供します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-257">The SqlDataSource control also provides optimistic concurrency support.</span></span> <span data-ttu-id="c97cb-258">手順 2. で説明したように、`INSERT`、`UPDATE`、および `DELETE` ステートメントを自動的に生成する場合、このウィザードにはオプティミスティック同時実行制御オプションが用意されています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-258">As noted in Step 2, when automatically generating the `INSERT`, `UPDATE`, and `DELETE` statements, the wizard offers a Use optimistic concurrency option.</span></span> <span data-ttu-id="c97cb-259">次のチュートリアルで説明するように、SqlDataSource でオプティミスティック同時実行制御を使用すると、`UPDATE` および `DELETE` ステートメント内の `WHERE` 句が変更され、ページに最後にデータが表示されてから他の列の値が変更されないようになります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-259">As we'll see in the next tutorial, using optimistic concurrency with the SqlDataSource modifies the `WHERE` clauses in the `UPDATE` and `DELETE` statements to ensure that the values for the other columns haven't changed since the data was last displayed on the page.</span></span>

<span data-ttu-id="c97cb-260">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="c97cb-260">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c97cb-261">著者について</span><span class="sxs-lookup"><span data-stu-id="c97cb-261">About the Author</span></span>

<span data-ttu-id="c97cb-262">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-262">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c97cb-263">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="c97cb-263">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c97cb-264">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="c97cb-264">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c97cb-265">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c97cb-265">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="c97cb-266">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="c97cb-266">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c97cb-267">[前へ](using-parameterized-queries-with-the-sqldatasource-vb.md)
> [次へ](implementing-optimistic-concurrency-with-the-sqldatasource-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c97cb-267">[Previous](using-parameterized-queries-with-the-sqldatasource-vb.md)
[Next](implementing-optimistic-concurrency-with-the-sqldatasource-vb.md)</span></span>
