---
uid: web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-vb
title: GridView へのボタンの追加と応答 (VB) |Microsoft Docs
author: rick-anderson
description: このチュートリアルでは、テンプレートと GridView コントロールまたは DetailsView コントロールのフィールドの両方にカスタムボタンを追加する方法について説明します。 特に、...
ms.author: riande
ms.date: 09/13/2006
ms.assetid: 06c6bbd2-4bdc-435b-87a3-df2c868f4baa
msc.legacyurl: /web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-vb
msc.type: authoredcontent
ms.openlocfilehash: 8727d8faead02340d223c75845bf29f63d1a0834
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74600915"
---
# <a name="adding-and-responding-to-buttons-to-a-gridview-vb"></a><span data-ttu-id="19f97-104">GridView にボタンを追加し、応答する (VB)</span><span class="sxs-lookup"><span data-stu-id="19f97-104">Adding and Responding to Buttons to a GridView (VB)</span></span>

<span data-ttu-id="19f97-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="19f97-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="19f97-106">[サンプルアプリのダウンロード](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_VB.exe)または[PDF のダウンロード](adding-and-responding-to-buttons-to-a-gridview-vb/_static/datatutorial28vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="19f97-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_VB.exe) or [Download PDF](adding-and-responding-to-buttons-to-a-gridview-vb/_static/datatutorial28vb1.pdf)</span></span>

> <span data-ttu-id="19f97-107">このチュートリアルでは、テンプレートと GridView コントロールまたは DetailsView コントロールのフィールドの両方にカスタムボタンを追加する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="19f97-107">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="19f97-108">特に、ユーザーがサプライヤーを通じてページを作成できるようにする FormView を持つインターフェイスを構築します。</span><span class="sxs-lookup"><span data-stu-id="19f97-108">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span>

## <a name="introduction"></a><span data-ttu-id="19f97-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="19f97-109">Introduction</span></span>

<span data-ttu-id="19f97-110">レポートデータへの読み取り専用アクセスは多くのレポートシナリオに含まれますが、レポートには、表示されるデータに基づいてアクションを実行する機能が含まれていることは珍しくありません。</span><span class="sxs-lookup"><span data-stu-id="19f97-110">While many reporting scenarios involve read-only access to the report data, it s not uncommon for reports to include the ability to perform actions based upon the data displayed.</span></span> <span data-ttu-id="19f97-111">通常、この操作を行うには、レポートに表示される各レコードと共に Button、LinkButton、または ImageButton Web コントロールを追加する必要があります。これは、クリックすると、ポストバックが発生し、いくつかのサーバー側コードが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-111">Typically this involved adding a Button, LinkButton, or ImageButton Web control with each record displayed in the report that, when clicked, causes a postback and invokes some server-side code.</span></span> <span data-ttu-id="19f97-112">レコードごとにデータを編集および削除することが、最も一般的な例です。</span><span class="sxs-lookup"><span data-stu-id="19f97-112">Editing and deleting the data on a record-by-record basis is the most common example.</span></span> <span data-ttu-id="19f97-113">実際、[データの挿入、更新、削除の概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)について説明したように、編集と削除は、GridView、DetailsView、および FormView コントロールが、1行のコードを記述しなくても、このような機能をサポートできるという点でよく見られます。</span><span class="sxs-lookup"><span data-stu-id="19f97-113">In fact, as we saw starting with the [Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial, editing and deleting is so common that the GridView, DetailsView, and FormView controls can support such functionality without the need for writing a single line of code.</span></span>

<span data-ttu-id="19f97-114">[編集] ボタンと [削除] ボタンに加えて、GridView、DetailsView、および FormView コントロールには、ボタン、リンクボタン、または ImageButtons を含めることができます。このボタンは、クリックすると、カスタムのサーバー側ロジックを実行します。</span><span class="sxs-lookup"><span data-stu-id="19f97-114">In addition to Edit and Delete buttons, the GridView, DetailsView, and FormView controls can also include Buttons, LinkButtons, or ImageButtons that, when clicked, perform some custom server-side logic.</span></span> <span data-ttu-id="19f97-115">このチュートリアルでは、テンプレートと GridView コントロールまたは DetailsView コントロールのフィールドの両方にカスタムボタンを追加する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="19f97-115">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="19f97-116">特に、ユーザーがサプライヤーを通じてページを作成できるようにする FormView を持つインターフェイスを構築します。</span><span class="sxs-lookup"><span data-stu-id="19f97-116">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span> <span data-ttu-id="19f97-117">特定の仕入先について、FormView には、サプライヤーに関する情報とボタン Web コントロールが表示されます。このボタンをクリックすると、関連付けられているすべての製品が廃止済みとしてマークされます。</span><span class="sxs-lookup"><span data-stu-id="19f97-117">For a given supplier, the FormView will show information about the supplier along with a Button Web control that, if clicked, will mark all of their associated products as discontinued.</span></span> <span data-ttu-id="19f97-118">また、GridView は、選択された業者によって提供される製品を一覧表示します。各行には、[価格] ボタンと [割引価格] ボタンが表示されます。このボタンをクリックすると、製品の `UnitPrice` が10% 上がります (図1を参照)。</span><span class="sxs-lookup"><span data-stu-id="19f97-118">Additionally, a GridView lists those products provided by the selected supplier, with each row containing Increase Price and Discount Price Buttons that, if clicked, raise or reduce the product s `UnitPrice` by 10% (see Figure 1).</span></span>

<span data-ttu-id="19f97-119">[FormView と GridView の両方にカスタムアクションを実行するボタンが含まれている ![](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-119">[![Both the FormView and GridView Contain Buttons That Perform Custom Actions](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image1.png)</span></span>

<span data-ttu-id="19f97-120">**図 1**: FormView と GridView の両方にカスタムアクションを実行するボタンが含まれている ([クリックしてフルサイズのイメージを表示する](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="19f97-120">**Figure 1**: Both the FormView and GridView Contain Buttons That Perform Custom Actions ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image3.png))</span></span>

## <a name="step-1-adding-the-button-tutorial-web-pages"></a><span data-ttu-id="19f97-121">手順 1: Button チュートリアル Web ページの追加</span><span class="sxs-lookup"><span data-stu-id="19f97-121">Step 1: Adding the Button Tutorial Web Pages</span></span>

<span data-ttu-id="19f97-122">カスタムボタンを追加する方法を確認する前に、まず、このチュートリアルで必要となる web サイトプロジェクトの ASP.NET ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="19f97-122">Before we look at how to add a custom buttons, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial.</span></span> <span data-ttu-id="19f97-123">まず、`CustomButtons`という名前の新しいフォルダーを追加します。</span><span class="sxs-lookup"><span data-stu-id="19f97-123">Start by adding a new folder named `CustomButtons`.</span></span> <span data-ttu-id="19f97-124">次に、次の2つの ASP.NET ページをそのフォルダーに追加します。各ページは `Site.master` マスターページに関連付けられていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="19f97-124">Next, add the following two ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `CustomButtons.aspx`

![カスタムボタンに関連するチュートリアルの ASP.NET ページを追加する](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image4.png)

<span data-ttu-id="19f97-126">**図 2**: カスタムボタンに関連するチュートリアルの ASP.NET ページを追加する</span><span class="sxs-lookup"><span data-stu-id="19f97-126">**Figure 2**: Add the ASP.NET Pages for the Custom Buttons-Related Tutorials</span></span>

<span data-ttu-id="19f97-127">他のフォルダーと同様に、`CustomButtons` フォルダー内の `Default.aspx` には、そのセクションのチュートリアルが一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-127">Like in the other folders, `Default.aspx` in the `CustomButtons` folder will list the tutorials in its section.</span></span> <span data-ttu-id="19f97-128">`SectionLevelTutorialListing.ascx` ユーザーコントロールがこの機能を提供していることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="19f97-128">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="19f97-129">したがって、ソリューションエクスプローラーからページデザインビューにドラッグして、このユーザーコントロールを `Default.aspx` に追加します。</span><span class="sxs-lookup"><span data-stu-id="19f97-129">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="19f97-130">[SectionLevelTutorialListing ユーザーコントロールを default.aspx に追加 ![には](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-130">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image5.png)</span></span>

<span data-ttu-id="19f97-131">**図 3**: `Default.aspx` に `SectionLevelTutorialListing.ascx` ユーザーコントロールを追加する ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image7.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-131">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image7.png))</span></span>

<span data-ttu-id="19f97-132">最後に、`Web.sitemap` ファイルにエントリとしてページを追加します。</span><span class="sxs-lookup"><span data-stu-id="19f97-132">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="19f97-133">具体的には、ページングと並べ替え `<siteMapNode>`の後に、次のマークアップを追加します。</span><span class="sxs-lookup"><span data-stu-id="19f97-133">Specifically, add the following markup after the Paging and Sorting `<siteMapNode>`:</span></span>

[!code-xml[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample1.xml)]

<span data-ttu-id="19f97-134">`Web.sitemap`を更新した後、ブラウザーを使用してチュートリアル web サイトを表示します。</span><span class="sxs-lookup"><span data-stu-id="19f97-134">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="19f97-135">左側のメニューには、チュートリアルの編集、挿入、および削除を行うための項目が含まれています。</span><span class="sxs-lookup"><span data-stu-id="19f97-135">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![サイトマップにカスタムボタンチュートリアルのエントリが含まれるようになりました。](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image8.png)

<span data-ttu-id="19f97-137">**図 4**: サイトマップにカスタムボタンチュートリアルのエントリが含まれるようになりました。</span><span class="sxs-lookup"><span data-stu-id="19f97-137">**Figure 4**: The Site Map Now Includes the Entry for the Custom Buttons Tutorial</span></span>

## <a name="step-2-adding-a-formview-that-lists-the-suppliers"></a><span data-ttu-id="19f97-138">手順 2: 仕入先を一覧表示する FormView を追加する</span><span class="sxs-lookup"><span data-stu-id="19f97-138">Step 2: Adding a FormView that Lists the Suppliers</span></span>

<span data-ttu-id="19f97-139">ここでは、サプライヤーを一覧表示する FormView を追加して、このチュートリアルを開始してみましょう。</span><span class="sxs-lookup"><span data-stu-id="19f97-139">Let s get started with this tutorial by adding the FormView that lists the suppliers.</span></span> <span data-ttu-id="19f97-140">概要で説明したように、この FormView を使用すると、サプライヤーによって提供される製品を GridView で表示することができます。</span><span class="sxs-lookup"><span data-stu-id="19f97-140">As discussed in the Introduction, this FormView will allow the user to page through the suppliers, showing the products provided by the supplier in a GridView.</span></span> <span data-ttu-id="19f97-141">また、この FormView にはボタンが含まれており、クリックすると、すべての仕入先製品が廃止済みとしてマークされます。</span><span class="sxs-lookup"><span data-stu-id="19f97-141">Additionally, this FormView will include a Button that, when clicked, will mark all of the supplier s products as discontinued.</span></span> <span data-ttu-id="19f97-142">FormView にカスタムボタンを追加することに関心がある前に、まず FormView を作成して、仕入先の情報が表示されるようにしましょう。</span><span class="sxs-lookup"><span data-stu-id="19f97-142">Before we concern ourselves with adding the custom button to the FormView, let s first just create the FormView so that it displays the supplier information.</span></span>

<span data-ttu-id="19f97-143">まず、`CustomButtons` フォルダーの [`CustomButtons.aspx`] ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="19f97-143">Start by opening the `CustomButtons.aspx` page in the `CustomButtons` folder.</span></span> <span data-ttu-id="19f97-144">FormView を [ツールボックス] からデザイナーにドラッグし、[`ID`] プロパティを [`Suppliers`] に設定して、FormView をページに追加します。</span><span class="sxs-lookup"><span data-stu-id="19f97-144">Add a FormView to the page by dragging it from the Toolbox onto the Designer and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="19f97-145">FormView s スマートタグから、`SuppliersDataSource`という名前の新しい ObjectDataSource を作成することを選択します。</span><span class="sxs-lookup"><span data-stu-id="19f97-145">From the FormView s smart tag, opt to create a new ObjectDataSource named `SuppliersDataSource`.</span></span>

<span data-ttu-id="19f97-146">[SuppliersDataSource という名前の新しい ObjectDataSource を作成 ![には](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-146">[![Create a New ObjectDataSource Named SuppliersDataSource](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image9.png)</span></span>

<span data-ttu-id="19f97-147">**図 5**: `SuppliersDataSource` という名前の新しい ObjectDataSource を作成[する (クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image11.png)される)</span><span class="sxs-lookup"><span data-stu-id="19f97-147">**Figure 5**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image11.png))</span></span>

<span data-ttu-id="19f97-148">`SuppliersBLL` クラス s `GetSuppliers()` メソッドからクエリを行うように、この新しい ObjectDataSource を構成します (図6を参照)。</span><span class="sxs-lookup"><span data-stu-id="19f97-148">Configure this new ObjectDataSource such that it queries from the `SuppliersBLL` class s `GetSuppliers()` method (see Figure 6).</span></span> <span data-ttu-id="19f97-149">この FormView では supplier 情報を更新するためのインターフェイスが提供されないため、[更新] タブのドロップダウンリストから [(なし)] オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="19f97-149">Since this FormView does not provide an interface for updating the supplier information, select the (None) option from the drop-down list in the UPDATE tab.</span></span>

<span data-ttu-id="19f97-150">[SuppliersBLL Class s GetSuppliers () メソッドを使用するようにデータソースを構成 ![には](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-150">[![Configure the Data Source to use the SuppliersBLL Class s GetSuppliers() Method](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image12.png)</span></span>

<span data-ttu-id="19f97-151">**図 6**: `SuppliersBLL` クラス s `GetSuppliers()` メソッドを使用するようにデータソースを構成する ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image14.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-151">**Figure 6**: Configure the Data Source to use the `SuppliersBLL` Class s `GetSuppliers()` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image14.png))</span></span>

<span data-ttu-id="19f97-152">ObjectDataSource を構成すると、Visual Studio によって、FormView の `InsertItemTemplate`、`EditItemTemplate`、および `ItemTemplate` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-152">After configuring the ObjectDataSource, Visual Studio will generate an `InsertItemTemplate`, `EditItemTemplate`, and `ItemTemplate` for the FormView.</span></span> <span data-ttu-id="19f97-153">`InsertItemTemplate` と `EditItemTemplate` を削除し、仕入先の会社名と電話番号だけを表示するように `ItemTemplate` を変更します。</span><span class="sxs-lookup"><span data-stu-id="19f97-153">Remove the `InsertItemTemplate` and `EditItemTemplate` and modify the `ItemTemplate` so that it displays just the supplier s company name and phone number.</span></span> <span data-ttu-id="19f97-154">最後に、[ページングを有効にする] チェックボックスをオンにして、FormView のページングサポートをオンにします (または、その `AllowPaging` プロパティを `True`に設定します)。</span><span class="sxs-lookup"><span data-stu-id="19f97-154">Finally, turn on paging support for the FormView by checking the Enable Paging checkbox from its smart tag (or by setting its `AllowPaging` property to `True`).</span></span> <span data-ttu-id="19f97-155">これらの変更が完了すると、ページの宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="19f97-155">After these changes your page s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample2.aspx)]

<span data-ttu-id="19f97-156">図7は、ブラウザーを使用して表示するときの CustomButtons .aspx ページを示しています。</span><span class="sxs-lookup"><span data-stu-id="19f97-156">Figure 7 shows the CustomButtons.aspx page when viewed through a browser.</span></span>

<span data-ttu-id="19f97-157">[FormView に ![現在選択されている業者からの CompanyName フィールドと Phone フィールドが一覧表示されます](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-157">[![The FormView Lists the CompanyName and Phone Fields from the Currently Selected Supplier](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image15.png)</span></span>

<span data-ttu-id="19f97-158">**図 7**: FormView には、現在選択されている業者の `CompanyName` および `Phone` のフィールドが一覧表示されます ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image17.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-158">**Figure 7**: The FormView Lists the `CompanyName` and `Phone` Fields from the Currently Selected Supplier ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image17.png))</span></span>

## <a name="step-3-adding-a-gridview-that-lists-the-selected-supplier-s-products"></a><span data-ttu-id="19f97-159">手順 3: 選択した仕入先の製品を一覧表示する GridView の追加</span><span class="sxs-lookup"><span data-stu-id="19f97-159">Step 3: Adding a GridView that Lists the Selected Supplier s Products</span></span>

<span data-ttu-id="19f97-160">FormView s テンプレートに [すべての製品の中止] ボタンを追加する前に、まず、選択した業者によって提供される製品を一覧表示する FormView の下に GridView を追加します。</span><span class="sxs-lookup"><span data-stu-id="19f97-160">Before we add the Discontinue All Products Button to the FormView s template, let s first add a GridView beneath the FormView that lists the products provided by the selected supplier.</span></span> <span data-ttu-id="19f97-161">これを行うには、GridView をページに追加し、その `ID` プロパティを `SuppliersProducts`に設定して、`SuppliersProductsDataSource`という名前の新しい ObjectDataSource を追加します。</span><span class="sxs-lookup"><span data-stu-id="19f97-161">To accomplish this, add a GridView to the page, set its `ID` property to `SuppliersProducts`, and add a new ObjectDataSource named `SuppliersProductsDataSource`.</span></span>

<span data-ttu-id="19f97-162">[SuppliersProductsDataSource という名前の新しい ObjectDataSource を作成 ![には](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-162">[![Create a New ObjectDataSource Named SuppliersProductsDataSource](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image18.png)</span></span>

<span data-ttu-id="19f97-163">**図 8**: `SuppliersProductsDataSource` という名前の新しい ObjectDataSource を作成[する (クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image20.png)される)</span><span class="sxs-lookup"><span data-stu-id="19f97-163">**Figure 8**: Create a New ObjectDataSource Named `SuppliersProductsDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image20.png))</span></span>

<span data-ttu-id="19f97-164">この ObjectDataSource を構成して、製品の Bll クラス s `GetProductsBySupplierID(supplierID)` メソッドを使用します (図9を参照)。</span><span class="sxs-lookup"><span data-stu-id="19f97-164">Configure this ObjectDataSource to use the ProductsBLL class s `GetProductsBySupplierID(supplierID)` method (see Figure 9).</span></span> <span data-ttu-id="19f97-165">この GridView では、製品の価格を調整できますが、GridView の組み込みの編集機能または削除機能は使用されません。</span><span class="sxs-lookup"><span data-stu-id="19f97-165">While this GridView will allow for a product s price to be adjusted, it won't be using the built-in editing or deleting features from the GridView.</span></span> <span data-ttu-id="19f97-166">そのため、ObjectDataSource s UPDATE、INSERT、DELETE の各タブでは、ドロップダウンリストを [(なし)] に設定できます。</span><span class="sxs-lookup"><span data-stu-id="19f97-166">Therefore, we can set the drop-down list to (None) for the ObjectDataSource s UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="19f97-167">[製品の Bll クラス s Get$ By仕入先 (仕入先) メソッドを使用するようにデータソースを構成 ![](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-167">[![Configure the Data Source to use the ProductsBLL Class s GetProductsBySupplierID(supplierID) Method](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image21.png)</span></span>

<span data-ttu-id="19f97-168">**図 9**: `ProductsBLL` クラス s `GetProductsBySupplierID(supplierID)` メソッドを使用するようにデータソースを構成する ([クリックしてフルサイズのイメージを表示する](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="19f97-168">**Figure 9**: Configure the Data Source to use the `ProductsBLL` Class s `GetProductsBySupplierID(supplierID)` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image23.png))</span></span>

<span data-ttu-id="19f97-169">`GetProductsBySupplierID(supplierID)` メソッドは入力パラメーターを受け取るため、ObjectDataSource ウィザードでは、このパラメーター値のソースを要求するメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-169">Since the `GetProductsBySupplierID(supplierID)` method accepts an input parameter, the ObjectDataSource wizard prompts us for the source of this parameter value.</span></span> <span data-ttu-id="19f97-170">FormView から `SupplierID` 値を渡すには、[パラメーターソース] ドロップダウンリストを [制御] に設定し、[ControlID] ドロップダウンリストを `Suppliers` (手順2で作成した FormView の ID) に設定します。</span><span class="sxs-lookup"><span data-stu-id="19f97-170">To pass in the `SupplierID` value from the FormView, set the Parameter source drop-down list to Control and the ControlID drop-down list to `Suppliers` (the ID of the FormView created in Step 2).</span></span>

<span data-ttu-id="19f97-171">[![は、仕入先の FormView コントロールから、仕入先のパラメーターを取得する必要があることを示します。](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-171">[![Indicate that the supplierID Parameter Should Come from the Suppliers FormView Control](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image24.png)</span></span>

<span data-ttu-id="19f97-172">**図 10**: *`supplierID`* パラメーターが `Suppliers` FormView コントロールから取得される必要があることを示します ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image26.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-172">**Figure 10**: Indicate that the *`supplierID`* Parameter Should Come from the `Suppliers` FormView Control ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image26.png))</span></span>

<span data-ttu-id="19f97-173">ObjectDataSource ウィザードを完了すると、GridView には、各 product s データフィールドの BoundField または CheckBoxField が含まれます。</span><span class="sxs-lookup"><span data-stu-id="19f97-173">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product s data fields.</span></span> <span data-ttu-id="19f97-174">ここでは、`ProductName` と `UnitPrice` BoundFields を `Discontinued` CheckBoxField と共に表示するように、をトリミングしてみましょう。さらに、テキストが通貨として書式設定されるように、`UnitPrice` BoundField の書式を設定してみましょう。</span><span class="sxs-lookup"><span data-stu-id="19f97-174">Let s trim this down to show just the `ProductName` and `UnitPrice` BoundFields along with the `Discontinued` CheckBoxField; furthermore, let s format the `UnitPrice` BoundField such that its text is formatted as a currency.</span></span> <span data-ttu-id="19f97-175">GridView と `SuppliersProductsDataSource` ObjectDataSource s 宣言マークアップは、次のマークアップのようになります。</span><span class="sxs-lookup"><span data-stu-id="19f97-175">Your GridView and `SuppliersProductsDataSource` ObjectDataSource s declarative markup should look similar to the following markup:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample3.aspx)]

<span data-ttu-id="19f97-176">この時点で、このチュートリアルではマスター/詳細レポートを表示します。ユーザーは、上部にある FormView からサプライヤーを選択し、下部にある GridView を通じて、その供給業者によって提供される製品を表示できます。</span><span class="sxs-lookup"><span data-stu-id="19f97-176">At this point our tutorial displays a master/details report, allowing the user to pick a supplier from the FormView at the top and to view the products provided by that supplier through the GridView at the bottom.</span></span> <span data-ttu-id="19f97-177">図11は、FormView から東京 Traders 社のサプライヤーを選択するときのこのページのスクリーンショットを示しています。</span><span class="sxs-lookup"><span data-stu-id="19f97-177">Figure 11 shows a screen shot of this page when selecting the Tokyo Traders supplier from the FormView.</span></span>

<span data-ttu-id="19f97-178">[選択した仕入先の製品が GridView に表示さ ![](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-178">[![The Selected Supplier s Products are Displayed in the GridView](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image27.png)</span></span>

<span data-ttu-id="19f97-179">**図 11**: 選択した仕入先の製品が GridView に表示される ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image29.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-179">**Figure 11**: The Selected Supplier s Products are Displayed in the GridView ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image29.png))</span></span>

## <a name="step-4-creating-dal-and-bll-methods-to-discontinue-all-products-for-a-supplier"></a><span data-ttu-id="19f97-180">手順 4: Supplier および BLL メソッドを作成して業者のすべての製品を中止する</span><span class="sxs-lookup"><span data-stu-id="19f97-180">Step 4: Creating DAL and BLL Methods to Discontinue All Products for a Supplier</span></span>

<span data-ttu-id="19f97-181">クリックすると、すべての仕入先製品が停止されるように、FormView にボタンを追加する前に、まず、このアクションを実行する DAL と BLL の両方にメソッドを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-181">Before we can add a Button to the FormView that, when clicked, discontinues all of the supplier s products, we first need to add a method to both the DAL and BLL that performs this action.</span></span> <span data-ttu-id="19f97-182">特に、このメソッドには `DiscontinueAllProductsForSupplier(supplierID)`という名前が付けられます。</span><span class="sxs-lookup"><span data-stu-id="19f97-182">In particular, this method will be named `DiscontinueAllProductsForSupplier(supplierID)`.</span></span> <span data-ttu-id="19f97-183">FormView s ボタンをクリックすると、ビジネスロジック層でこのメソッドが呼び出され、選択した業者の `SupplierID`が渡されます。次に、BLL は、対応するデータアクセス層メソッドにコールダウンします。これにより、指定された仕入先製品を中断するデータベースに `UPDATE` ステートメントが発行されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-183">When the FormView s Button is clicked, we'll invoke this method in the Business Logic Layer, passing in the selected supplier s `SupplierID`; the BLL will then call down to the corresponding Data Access Layer method, which will issue an `UPDATE` statement to the database that discontinues the specified supplier s products.</span></span>

<span data-ttu-id="19f97-184">前のチュートリアルで行ったように、まず、DAL メソッドを作成し、次に BLL メソッドを作成し、最後に ASP.NET ページに機能を実装します。</span><span class="sxs-lookup"><span data-stu-id="19f97-184">As we have done in our previous tutorials, we'll use a bottom-up approach, starting with creating the DAL method, then the BLL method, and finally implementing the functionality in the ASP.NET page.</span></span> <span data-ttu-id="19f97-185">`App_Code/DAL` フォルダーの `Northwind.xsd` 型指定されたデータセットを開き、`ProductsTableAdapter` に新しいメソッドを追加します (`ProductsTableAdapter` を右クリックし、[クエリの追加] を選択します)。</span><span class="sxs-lookup"><span data-stu-id="19f97-185">Open the `Northwind.xsd` Typed DataSet in the `App_Code/DAL` folder and add a new method to the `ProductsTableAdapter` (right-click on the `ProductsTableAdapter` and choose Add Query).</span></span> <span data-ttu-id="19f97-186">これにより、TableAdapter クエリの構成ウィザードが表示されます。このウィザードでは、新しいメソッドを追加するプロセスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="19f97-186">Doing so will bring up the TableAdapter Query Configuration wizard, which walks us through the process of adding the new method.</span></span> <span data-ttu-id="19f97-187">まず、DAL メソッドがアドホック SQL ステートメントを使用することを示します。</span><span class="sxs-lookup"><span data-stu-id="19f97-187">Start by indicating that our DAL method will use an ad-hoc SQL statement.</span></span>

<span data-ttu-id="19f97-188">[アドホック SQL ステートメントを使用して DAL メソッドを作成 ![には](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image30.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-188">[![Create the DAL Method Using an Ad-Hoc SQL Statement](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image30.png)</span></span>

<span data-ttu-id="19f97-189">**図 12**: アドホック SQL ステートメントを使用して DAL メソッドを作成[する (クリックすると、フルサイズのイメージが表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image32.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-189">**Figure 12**: Create the DAL Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image32.png))</span></span>

<span data-ttu-id="19f97-190">次に、ウィザードによって、作成するクエリの種類を入力するように求められます。</span><span class="sxs-lookup"><span data-stu-id="19f97-190">Next, the wizard prompts us as to what type of query to create.</span></span> <span data-ttu-id="19f97-191">`DiscontinueAllProductsForSupplier(supplierID)` メソッドでは `Products` データベーステーブルを更新する必要があるため、`Discontinued` フィールドを1に設定し、指定した *`supplierID`* によって提供されるすべての製品について、データを更新するクエリを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-191">Since the `DiscontinueAllProductsForSupplier(supplierID)` method will need to update the `Products` database table, setting the `Discontinued` field to 1 for all products provided by the specified *`supplierID`*, we need to create a query that updates data.</span></span>

<span data-ttu-id="19f97-192">[更新クエリの種類を選択 ![には](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-192">[![Choose the UPDATE Query Type](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image33.png)</span></span>

<span data-ttu-id="19f97-193">**図 13**: 更新クエリの種類を選択[する (クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image35.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-193">**Figure 13**: Choose the UPDATE Query Type ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image35.png))</span></span>

<span data-ttu-id="19f97-194">次のウィザード画面には、TableAdapter の既存の `UPDATE` ステートメントが用意されており、`Products` DataTable に定義されている各フィールドを更新します。</span><span class="sxs-lookup"><span data-stu-id="19f97-194">The next wizard screen provides the TableAdapter s existing `UPDATE` statement, which updates each of the fields defined in the `Products` DataTable.</span></span> <span data-ttu-id="19f97-195">このクエリテキストを次のステートメントに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="19f97-195">Replace this query text with the following statement:</span></span>

[!code-sql[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample4.sql)]

<span data-ttu-id="19f97-196">このクエリを入力して [次へ] をクリックすると、最後のウィザード画面が表示され、新しいメソッド名の使用 `DiscontinueAllProductsForSupplier`が求められます。</span><span class="sxs-lookup"><span data-stu-id="19f97-196">After entering this query and clicking Next, the last wizard screen asks for the new method s name use `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="19f97-197">[完了] ボタンをクリックしてウィザードを完了します。</span><span class="sxs-lookup"><span data-stu-id="19f97-197">Complete the wizard by clicking the Finish button.</span></span> <span data-ttu-id="19f97-198">データセットデザイナーに戻ると、`DiscontinueAllProductsForSupplier(@SupplierID)`という名前の `ProductsTableAdapter` に新しいメソッドが表示されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-198">Upon returning to the DataSet Designer you should see a new method in the `ProductsTableAdapter` named `DiscontinueAllProductsForSupplier(@SupplierID)`.</span></span>

<span data-ttu-id="19f97-199">[新しい DAL メソッド DiscontinueAllProductsForSupplier に名前を ![](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image36.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-199">[![Name the New DAL Method DiscontinueAllProductsForSupplier](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image36.png)</span></span>

<span data-ttu-id="19f97-200">**図 14**: 新しい DAL メソッドに名前を指定[する `DiscontinueAllProductsForSupplier` (クリックしてフルサイズのイメージを表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image38.png))</span><span class="sxs-lookup"><span data-stu-id="19f97-200">**Figure 14**: Name the New DAL Method `DiscontinueAllProductsForSupplier` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image38.png))</span></span>

<span data-ttu-id="19f97-201">データアクセス層で `DiscontinueAllProductsForSupplier(supplierID)` メソッドを作成した後、次のタスクでは、ビジネスロジック層で `DiscontinueAllProductsForSupplier(supplierID)` メソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="19f97-201">With the `DiscontinueAllProductsForSupplier(supplierID)` method created in the Data Access Layer, our next task is to create the `DiscontinueAllProductsForSupplier(supplierID)` method in the Business Logic Layer.</span></span> <span data-ttu-id="19f97-202">これを行うには、`ProductsBLL` クラスファイルを開き、次のように追加します。</span><span class="sxs-lookup"><span data-stu-id="19f97-202">To accomplish this, open the `ProductsBLL` class file and add the following:</span></span>

[!code-vb[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample5.vb)]

<span data-ttu-id="19f97-203">このメソッドは、指定された *`supplierID`* パラメーター値を渡して、DAL 内の `DiscontinueAllProductsForSupplier(supplierID)` メソッドを単に呼び出します。</span><span class="sxs-lookup"><span data-stu-id="19f97-203">This method simply calls down to the `DiscontinueAllProductsForSupplier(supplierID)` method in the DAL, passing along the provided *`supplierID`* parameter value.</span></span> <span data-ttu-id="19f97-204">特定の状況でのみ仕入先の製品を廃止することを許可したビジネスルールがある場合は、そのルールを BLL に実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-204">If there were any business rules that only allowed a supplier s products to be discontinued under certain circumstances, those rules should be implemented here, in the BLL.</span></span>

> [!NOTE]
> <span data-ttu-id="19f97-205">`ProductsBLL` クラスの `UpdateProduct` のオーバーロードとは異なり、`DiscontinueAllProductsForSupplier(supplierID)` メソッドシグネチャには `DataObjectMethodAttribute` 属性 (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`) は含まれません。</span><span class="sxs-lookup"><span data-stu-id="19f97-205">Unlike the `UpdateProduct` overloads in the `ProductsBLL` class, the `DiscontinueAllProductsForSupplier(supplierID)` method signature does not include the `DataObjectMethodAttribute` attribute (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`).</span></span> <span data-ttu-id="19f97-206">これにより、[更新] タブの [ObjectDataSource s データソースの構成ウィザード] ドロップダウンリストの `DiscontinueAllProductsForSupplier(supplierID)` 方法ができません。ASP.NET のページでイベントハンドラーから `DiscontinueAllProductsForSupplier(supplierID)` メソッドを直接呼び出すため、この属性は省略しました。</span><span class="sxs-lookup"><span data-stu-id="19f97-206">This precludes the `DiscontinueAllProductsForSupplier(supplierID)` method from the ObjectDataSource s Configure Data Source wizard s drop-down list in the UPDATE tab. I ve omitted this attribute because we'll be calling the `DiscontinueAllProductsForSupplier(supplierID)` method directly from an event handler in our ASP.NET page.</span></span>

## <a name="step-5-adding-a-discontinue-all-products-button-to-the-formview"></a><span data-ttu-id="19f97-207">手順 5: FormView に [すべての製品を中止] ボタンを追加する</span><span class="sxs-lookup"><span data-stu-id="19f97-207">Step 5: Adding a Discontinue All Products Button to the FormView</span></span>

<span data-ttu-id="19f97-208">BLL と DAL の `DiscontinueAllProductsForSupplier(supplierID)` メソッドを完了すると、選択した業者のすべての製品を中止する機能を追加する最後の手順として、FormView s `ItemTemplate`にボタン Web コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="19f97-208">With the `DiscontinueAllProductsForSupplier(supplierID)` method in the BLL and DAL complete, the final step for adding the ability to discontinue all products for the selected supplier is to add a Button Web control to the FormView s `ItemTemplate`.</span></span> <span data-ttu-id="19f97-209">仕入先の電話番号の下にボタンテキストを追加して、すべての製品と `DiscontinueAllProductsForSupplier`の `ID` プロパティ値を中止してみましょう。</span><span class="sxs-lookup"><span data-stu-id="19f97-209">Let s add such a Button below the supplier s phone number with the button text, Discontinue All Products and an `ID` property value of `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="19f97-210">このボタン Web コントロールをデザイナーから追加するには、FormView s スマートタグの [テンプレートの編集] リンクをクリックするか (図15を参照)、または宣言型の構文を直接使用します。</span><span class="sxs-lookup"><span data-stu-id="19f97-210">You can add this Button Web control through the Designer by clicking on the Edit Templates link in the FormView s smart tag (see Figure 15), or directly through the declarative syntax.</span></span>

<span data-ttu-id="19f97-211">[[すべての製品を中止] ボタン Web コントロールを FormView s ItemTemplate に追加 ![には](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-211">[![Add a Discontinue All Products Button Web Control to the FormView s ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image39.png)</span></span>

<span data-ttu-id="19f97-212">**図 15**: [すべての製品を中止] ボタン Web コントロールを FormView s `ItemTemplate` に追加する ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image41.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-212">**Figure 15**: Add a Discontinue All Products Button Web Control to the FormView s `ItemTemplate` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image41.png))</span></span>

<span data-ttu-id="19f97-213">ページにアクセスしているユーザーがボタンをクリックすると、ポストバック ensues と FormView s [`ItemCommand` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx)が発生します。</span><span class="sxs-lookup"><span data-stu-id="19f97-213">When the Button is clicked by a user visiting the page, a postback ensues and the FormView s [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx) fires.</span></span> <span data-ttu-id="19f97-214">このボタンがクリックされたときの応答でカスタムコードを実行するには、このイベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="19f97-214">To execute custom code in response to this Button being clicked, we can create an event handler for this event.</span></span> <span data-ttu-id="19f97-215">ただし、FormView 内*でボタン、* LinkButton、または ImageButton Web コントロールがクリックされるたびに、`ItemCommand` イベントが発生することを理解してください。</span><span class="sxs-lookup"><span data-stu-id="19f97-215">Understand, though, that the `ItemCommand` event fires whenever *any* Button, LinkButton, or ImageButton Web control is clicked within the FormView.</span></span> <span data-ttu-id="19f97-216">つまり、ユーザーが FormView 内のあるページから別のページに移動すると、`ItemCommand` イベントが発生します。挿入、更新、または削除をサポートする FormView で、ユーザーが [新規]、[編集]、または [削除] をクリックしたときにも同じことが言えます。</span><span class="sxs-lookup"><span data-stu-id="19f97-216">That means that when the user moves from one page to another in the FormView, the `ItemCommand` event fires; same thing when the user clicks New, Edit, or Delete in a FormView that supports inserting, updating, or deleting.</span></span>

<span data-ttu-id="19f97-217">`ItemCommand` はどのボタンがクリックされたかに関係なく起動されるため、イベントハンドラーでは、[すべての製品を中止] ボタンがクリックされたかどうか、または他のボタンであるかどうかを確認する方法が必要になります。</span><span class="sxs-lookup"><span data-stu-id="19f97-217">Since the `ItemCommand` fires regardless of what button is clicked, in the event handler we need a way to determine if the Discontinue All Products Button was clicked or if it was some other button.</span></span> <span data-ttu-id="19f97-218">これを実現するには、ボタン Web コントロール s `CommandName` プロパティを特定の値に設定します。</span><span class="sxs-lookup"><span data-stu-id="19f97-218">To accomplish this, we can set the Button Web control s `CommandName` property to some identifying value.</span></span> <span data-ttu-id="19f97-219">このボタンをクリックすると、この `CommandName` 値が `ItemCommand` イベントハンドラーに渡され、[すべての製品を中止] ボタンがクリックされたかどうかを確認できるようになります。</span><span class="sxs-lookup"><span data-stu-id="19f97-219">When the Button is clicked, this `CommandName` value is passed into the `ItemCommand` event handler, enabling us to determine whether the Discontinue All Products Button was the button clicked.</span></span> <span data-ttu-id="19f97-220">[すべての製品を中止] ボタンの [`CommandName`] プロパティを DiscontinueProducts に設定します。</span><span class="sxs-lookup"><span data-stu-id="19f97-220">Set the Discontinue All Products Button s `CommandName` property to DiscontinueProducts .</span></span>

<span data-ttu-id="19f97-221">最後に、クライアント側の [確認] ダイアログボックスを使用して、ユーザーが選択した業者の製品を本当に停止したいと考えています。</span><span class="sxs-lookup"><span data-stu-id="19f97-221">Finally, let s use a client-side confirm dialog box to ensure that the user really wants to discontinue the selected supplier s products.</span></span> <span data-ttu-id="19f97-222">チュートリアル「[削除時のクライアント側の確認を追加する](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-vb.md)」で説明したように、これは少しの JavaScript で実現できます。</span><span class="sxs-lookup"><span data-stu-id="19f97-222">As we saw in the [Adding Client-Side Confirmation When Deleting](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-vb.md) tutorial, this can be accomplished with a bit of JavaScript.</span></span> <span data-ttu-id="19f97-223">特に、ボタン Web コントロール s OnClientClick プロパティを `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');` に設定します。</span><span class="sxs-lookup"><span data-stu-id="19f97-223">In particular, set the Button Web control s OnClientClick property to `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span></span>

<span data-ttu-id="19f97-224">これらの変更を行った後、FormView の宣言構文は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="19f97-224">After making these changes, the FormView s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample6.aspx)]

<span data-ttu-id="19f97-225">次に、FormView s `ItemCommand` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="19f97-225">Next, create an event handler for the FormView s `ItemCommand` event.</span></span> <span data-ttu-id="19f97-226">このイベントハンドラーでは、最初に [すべての製品を中止] ボタンがクリックされたかどうかを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-226">In this event handler we need to first determine whether the Discontinue All Products Button was clicked.</span></span> <span data-ttu-id="19f97-227">そのような場合は、`ProductsBLL` クラスのインスタンスを作成し、その `DiscontinueAllProductsForSupplier(supplierID)` メソッドを呼び出して、選択した FormView の `SupplierID` を渡します。</span><span class="sxs-lookup"><span data-stu-id="19f97-227">If so, we want to create an instance of the `ProductsBLL` class and invoke its `DiscontinueAllProductsForSupplier(supplierID)` method, passing in the `SupplierID` of the selected FormView:</span></span>

[!code-vb[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample7.vb)]

<span data-ttu-id="19f97-228">FormView で現在選択されている業者の `SupplierID` には、FormView s [`SelectedValue` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx)を使用してアクセスできることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="19f97-228">Note that the `SupplierID` of the current selected supplier in the FormView can be accessed using the FormView s [`SelectedValue` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx).</span></span> <span data-ttu-id="19f97-229">`SelectedValue` プロパティは、FormView に表示されるレコードの最初のデータキー値を返します。</span><span class="sxs-lookup"><span data-stu-id="19f97-229">The `SelectedValue` property returns the first data key value for the record being displayed in the FormView.</span></span> <span data-ttu-id="19f97-230">FormView s [`DataKeyNames` プロパティ](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx)は、データキー値の取得元のデータフィールドを示します。これは、手順 2. で ObjectDataSource を FormView にバインドするときに、Visual Studio によって自動的に `SupplierID` するように設定されています。</span><span class="sxs-lookup"><span data-stu-id="19f97-230">The FormView s [`DataKeyNames` property](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx), which indicates the data fields from which the data key values are pulled from, was automatically set to `SupplierID` by Visual Studio when binding the ObjectDataSource to the FormView back in Step 2.</span></span>

<span data-ttu-id="19f97-231">`ItemCommand` イベントハンドラーが作成されたら、しばらく時間を取ってページをテストします。</span><span class="sxs-lookup"><span data-stu-id="19f97-231">With the `ItemCommand` event handler created, take a moment to test out the page.</span></span> <span data-ttu-id="19f97-232">Cooperativa de Quesos ' ラスベガスの "供給業者 (FormView の5番目のサプライヤー) に移動します。</span><span class="sxs-lookup"><span data-stu-id="19f97-232">Browse to the Cooperativa de Quesos 'Las Cabras' supplier (it s the fifth supplier in the FormView for me).</span></span> <span data-ttu-id="19f97-233">このサプライヤーは、Queso Cabrales と Queso Manの両方の製品を提供しています。どちらも廃止され*ていません*。</span><span class="sxs-lookup"><span data-stu-id="19f97-233">This supplier provides two products, Queso Cabrales and Queso Manchego La Pastora, both of which are *not* discontinued.</span></span>

<span data-ttu-id="19f97-234">Cooperativa de Quesos ' ラスベガスがビジネスを終了し、その製品を廃止することを想像してください。</span><span class="sxs-lookup"><span data-stu-id="19f97-234">Imagine that Cooperativa de Quesos 'Las Cabras' has gone out of business and therefore its products are to be discontinued.</span></span> <span data-ttu-id="19f97-235">[すべての製品を中止] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="19f97-235">Click the Discontinue All Products Button.</span></span> <span data-ttu-id="19f97-236">これにより、[クライアント側の確認] ダイアログボックスが表示されます (図16を参照)。</span><span class="sxs-lookup"><span data-stu-id="19f97-236">This will display the client-side confirm dialog box (see Figure 16).</span></span>

<span data-ttu-id="19f97-237">[![Cooperativa de Quesos のラスベガスが2つのアクティブな製品を提供する](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-237">[![Cooperativa de Quesos Las Cabras Supplies Two Active Products](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image42.png)</span></span>

<span data-ttu-id="19f97-238">**図 16**: Cooperativa De Quesos のラスベガスで2つのアクティブな製品が提供される ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image44.png)される)</span><span class="sxs-lookup"><span data-stu-id="19f97-238">**Figure 16**: Cooperativa de Quesos Las Cabras Supplies Two Active Products ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image44.png))</span></span>

<span data-ttu-id="19f97-239">[クライアント側の確認] ダイアログボックスで [OK] をクリックすると、フォームの送信が続行され、FormView s `ItemCommand` イベントが発生するポストバックが発生します。</span><span class="sxs-lookup"><span data-stu-id="19f97-239">If you click OK in the client-side confirm dialog box, the form submission will proceed, causing a postback in which the FormView s `ItemCommand` event will fire.</span></span> <span data-ttu-id="19f97-240">次に、作成したイベントハンドラーが実行され、`DiscontinueAllProductsForSupplier(supplierID)` メソッドが呼び出され、Queso Cabrales と Queso Manの両方の製品が中止されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-240">The event handler we created will then execute, invoking the `DiscontinueAllProductsForSupplier(supplierID)` method and discontinuing both the Queso Cabrales and Queso Manchego La Pastora products.</span></span>

<span data-ttu-id="19f97-241">GridView のビューステートを無効にした場合、GridView はすべてのポストバックの基になるデータストアに再バインドされるため、この2つの製品が廃止されたことを反映してすぐに更新されます (図17を参照)。</span><span class="sxs-lookup"><span data-stu-id="19f97-241">If you have disabled the GridView s view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect that these two products are now discontinued (see Figure 17).</span></span> <span data-ttu-id="19f97-242">ただし、GridView でビューステートが無効になっていない場合は、この変更を行った後、データを GridView に手動で再バインドする必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-242">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="19f97-243">これを実現するには、`DiscontinueAllProductsForSupplier(supplierID)` メソッドを呼び出した直後に GridView s `DataBind()` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-243">To accomplish this, simply make a call to the GridView s `DataBind()` method immediately after invoking the `DiscontinueAllProductsForSupplier(supplierID)` method.</span></span>

<span data-ttu-id="19f97-244">[[すべての製品を中止] ボタンをクリックした後 ![、仕入先の製品がそれに応じて更新されます。](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-244">[![After Clicking the Discontinue All Products Button, the Supplier s Products are Updated Accordingly](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image45.png)</span></span>

<span data-ttu-id="19f97-245">**図 17**: [すべての製品を中止] ボタンをクリックすると、仕入先の製品がそれに応じて更新されます ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image47.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-245">**Figure 17**: After Clicking the Discontinue All Products Button, the Supplier s Products are Updated Accordingly ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image47.png))</span></span>

## <a name="step-6-creating-an-updateproduct-overload-in-the-business-logic-layer-for-adjusting-a-product-s-price"></a><span data-ttu-id="19f97-246">手順 6: 製品の価格を調整するためのビジネスロジック層での UpdateProduct オーバーロードの作成</span><span class="sxs-lookup"><span data-stu-id="19f97-246">Step 6: Creating an UpdateProduct Overload in the Business Logic Layer for Adjusting a Product s Price</span></span>

<span data-ttu-id="19f97-247">FormView の [すべての製品を中止] ボタンと同様に、GridView で製品の価格を増減するボタンを追加するには、最初に適切なデータアクセス層とビジネスロジック層のメソッドを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-247">Like with the Discontinue All Products Button in the FormView, in order to add buttons for increasing and decreasing the price for a product in the GridView we need to first add the appropriate Data Access Layer and Business Logic Layer methods.</span></span> <span data-ttu-id="19f97-248">DAL の1つの製品行を更新するメソッドが既にあるため、BLL の `UpdateProduct` メソッドに新しいオーバーロードを作成することによって、そのような機能を提供できます。</span><span class="sxs-lookup"><span data-stu-id="19f97-248">Since we already have a method that updates a single product row in the DAL, we can provide such functionality by creating a new overload for the `UpdateProduct` method in the BLL.</span></span>

<span data-ttu-id="19f97-249">過去の `UpdateProduct` のオーバーロードは、一部の製品フィールドをスカラー入力値として取得し、指定された製品のフィールドだけを更新しました。</span><span class="sxs-lookup"><span data-stu-id="19f97-249">Our past `UpdateProduct` overloads have taken in some combination of product fields as scalar input values and have then updated just those fields for the specified product.</span></span> <span data-ttu-id="19f97-250">このオーバーロードでは、この標準とは若干異なるため、製品の `ProductID` と、`UnitPrice` の調整に使用する割合 (新しい、調整された `UnitPrice` 自体に渡すのではなく) を渡します。</span><span class="sxs-lookup"><span data-stu-id="19f97-250">For this overload we'll vary slightly from this standard and instead pass in the product s `ProductID` and the percentage by which to adjust the `UnitPrice` (as opposed to passing in the new, adjusted `UnitPrice` itself).</span></span> <span data-ttu-id="19f97-251">この方法では、現在の製品 `UnitPrice`を決定する必要がないため、ASP.NET page 分離コードクラスで記述する必要があるコードが簡略化されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-251">This approach will simplify the code we need to write in the ASP.NET page code-behind class, since we don t have to bother with determining the current product s `UnitPrice`.</span></span>

<span data-ttu-id="19f97-252">このチュートリアルの `UpdateProduct` のオーバーロードを次に示します。</span><span class="sxs-lookup"><span data-stu-id="19f97-252">The `UpdateProduct` overload for this tutorial is shown below:</span></span>

[!code-vb[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample8.vb)]

<span data-ttu-id="19f97-253">このオーバーロードは、DAL の `GetProductByProductID(productID)` メソッドを使用して、指定された製品に関する情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="19f97-253">This overload retrieves information about the specified product through the DAL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="19f97-254">次に、製品の `UnitPrice` にデータベース `NULL` 値が割り当てられているかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="19f97-254">It then checks to see whether the product s `UnitPrice` is assigned a database `NULL` value.</span></span> <span data-ttu-id="19f97-255">その場合、価格は変更されません。</span><span class="sxs-lookup"><span data-stu-id="19f97-255">If it is, the price is left unaltered.</span></span> <span data-ttu-id="19f97-256">ただし、`NULL` 以外の `UnitPrice` 値がある場合、メソッドは、指定されたパーセント (`unitPriceAdjustmentPercent`) で `UnitPrice` 製品を更新します。</span><span class="sxs-lookup"><span data-stu-id="19f97-256">If, however, there is a non-`NULL` `UnitPrice` value, the method updates the product s `UnitPrice` by the specified percent (`unitPriceAdjustmentPercent`).</span></span>

## <a name="step-7-adding-the-increase-and-decrease-buttons-to-the-gridview"></a><span data-ttu-id="19f97-257">手順 7: GridView に [拡大] ボタンと [縮小] ボタンを追加する</span><span class="sxs-lookup"><span data-stu-id="19f97-257">Step 7: Adding the Increase and Decrease Buttons to the GridView</span></span>

<span data-ttu-id="19f97-258">GridView (および DetailsView) は、両方ともフィールドのコレクションで構成されています。</span><span class="sxs-lookup"><span data-stu-id="19f97-258">The GridView (and DetailsView) are both made up of a collection of fields.</span></span> <span data-ttu-id="19f97-259">BoundFields、CheckBoxFields、および TemplateFields に加えて、ASP.NET には ButtonField が含まれています。これは、その名前が示すとおり、各行のボタン、LinkButton、または ImageButton を持つ列として表示されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-259">In addition to BoundFields, CheckBoxFields, and TemplateFields, ASP.NET includes the ButtonField, which, as its name implies, renders as a column with a Button, LinkButton, or ImageButton for each row.</span></span> <span data-ttu-id="19f97-260">FormView と同様に、GridView ページングボタン内の*いずれか*のボタンをクリックする、ボタンの編集または削除、並べ替えボタンなどを行うと、ポストバックが発生し、gridview s [`RowCommand` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx)が発生します。</span><span class="sxs-lookup"><span data-stu-id="19f97-260">Similar to the FormView, clicking *any* button within the GridView paging buttons, Edit or Delete buttons, sorting buttons, and so on causes a postback and raises the GridView s [`RowCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx).</span></span>

<span data-ttu-id="19f97-261">ButtonField には、`CommandName` プロパティの各ボタンに指定された値を割り当てる `CommandName` プロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="19f97-261">The ButtonField has a `CommandName` property that assigns the specified value to each of its Buttons `CommandName` properties.</span></span> <span data-ttu-id="19f97-262">FormView と同様に、`CommandName` 値は、クリックされたボタンを判断するために `RowCommand` イベントハンドラーによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-262">Like with the FormView, the `CommandName` value is used by the `RowCommand` event handler to determine which button was clicked.</span></span>

<span data-ttu-id="19f97-263">2つの新しい ButtonFields を GridView に追加します。1つはボタンテキスト価格 + 10%、もう1つはテキスト価格で10% です。</span><span class="sxs-lookup"><span data-stu-id="19f97-263">Let s add two new ButtonFields to the GridView, one with a button text Price +10% and the other with the text Price -10%.</span></span> <span data-ttu-id="19f97-264">これらの ButtonFields を追加するには、GridView s スマートタグから [列の編集] リンクをクリックし、左上の一覧から Buttonfields フィールドの種類を選択して、[追加] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="19f97-264">To add these ButtonFields, click on the Edit Columns link from the GridView s smart tag, select the ButtonField field type from the list in the upper left and click the Add button.</span></span>

![GridView に2つの ButtonFields を追加する](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image48.png)

<span data-ttu-id="19f97-266">**図 18**: GridView に2つの buttonfields を追加する</span><span class="sxs-lookup"><span data-stu-id="19f97-266">**Figure 18**: Add Two ButtonFields to the GridView</span></span>

<span data-ttu-id="19f97-267">2つの ButtonFields を移動して、最初の2つの GridView フィールドとして表示されるようにします。</span><span class="sxs-lookup"><span data-stu-id="19f97-267">Move the two ButtonFields so that they appear as the first two GridView fields.</span></span> <span data-ttu-id="19f97-268">次に、これら2つの ButtonFields の `Text` プロパティを Price + 10% および Price-10% に設定し、`CommandName` プロパティを IncreasePrice と DecreasePrice にそれぞれ設定します。</span><span class="sxs-lookup"><span data-stu-id="19f97-268">Next, set the `Text` properties of these two ButtonFields to Price +10% and Price -10% and the `CommandName` properties to IncreasePrice and DecreasePrice, respectively.</span></span> <span data-ttu-id="19f97-269">既定では、ButtonField はボタンの列をリンクボタンとしてレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="19f97-269">By default, a ButtonField renders its column of buttons as LinkButtons.</span></span> <span data-ttu-id="19f97-270">ただし、これは、ButtonField s [`ButtonType` プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx)を使用して変更できます。</span><span class="sxs-lookup"><span data-stu-id="19f97-270">This can be changed, however, through the ButtonField s [`ButtonType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx).</span></span> <span data-ttu-id="19f97-271">これらの2つの ButtonFields を通常のプッシュボタンとしてレンダリングしてみましょう。したがって、`ButtonType` プロパティを `Button`に設定します。</span><span class="sxs-lookup"><span data-stu-id="19f97-271">Let s have these two ButtonFields rendered as regular push buttons; therefore, set the `ButtonType` property to `Button`.</span></span> <span data-ttu-id="19f97-272">図19は、これらの変更が加えられた後の [フィールド] ダイアログボックスを示しています。次に、GridView の宣言型マークアップを示します。</span><span class="sxs-lookup"><span data-stu-id="19f97-272">Figure 19 shows the Fields dialog box after these changes have been made; following that is the GridView s declarative markup.</span></span>

![ButtonFields Text、CommandName、およびです (buttontype の各プロパティの構成](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image49.png)

<span data-ttu-id="19f97-274">**図 19**: buttonfields `Text`、`CommandName`、および `ButtonType` の各プロパティを構成する</span><span class="sxs-lookup"><span data-stu-id="19f97-274">**Figure 19**: Configure the ButtonFields `Text`, `CommandName`, and `ButtonType` Properties</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample9.aspx)]

<span data-ttu-id="19f97-275">これらの ButtonFields を作成したら、最後の手順として、GridView s `RowCommand` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="19f97-275">With these ButtonFields created, the final step is to create an event handler for the GridView s `RowCommand` event.</span></span> <span data-ttu-id="19f97-276">このイベントハンドラーは、Price + 10% または Price-10% のボタンがクリックされたことが原因で発生した場合、によって、ボタンがクリックされた行の `ProductID` を判断し、`ProductsBLL` クラス s `UpdateProduct` メソッドを呼び出して、`ProductID`と共に適切な `UnitPrice` 率調整を渡します。</span><span class="sxs-lookup"><span data-stu-id="19f97-276">This event handler, if fired because either the Price +10% or Price -10% buttons were clicked, needs to determine the `ProductID` for the row whose button was clicked and then invoke the `ProductsBLL` class s `UpdateProduct` method, passing in the appropriate `UnitPrice` percentage adjustment along with the `ProductID`.</span></span> <span data-ttu-id="19f97-277">次のコードでは、これらのタスクを実行します。</span><span class="sxs-lookup"><span data-stu-id="19f97-277">The following code performs these tasks:</span></span>

[!code-vb[Main](adding-and-responding-to-buttons-to-a-gridview-vb/samples/sample10.vb)]

<span data-ttu-id="19f97-278">Price + 10% または Price-10% のボタンがクリックされた行の `ProductID` を確認するには、GridView の `DataKeys` コレクションを参照する必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-278">In order to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we need to consult the GridView s `DataKeys` collection.</span></span> <span data-ttu-id="19f97-279">このコレクションは、各 GridView 行の `DataKeyNames` プロパティに指定されているフィールドの値を保持します。</span><span class="sxs-lookup"><span data-stu-id="19f97-279">This collection holds the values of the fields specified in the `DataKeyNames` property for each GridView row.</span></span> <span data-ttu-id="19f97-280">ObjectDataSource を GridView にバインドするときに、GridView s `DataKeyNames` プロパティが Visual Studio によって ProductID に設定されているため、`DataKeys(rowIndex).Value` 指定された*rowIndex*の `ProductID` が提供されます。</span><span class="sxs-lookup"><span data-stu-id="19f97-280">Since the GridView s `DataKeyNames` property was set to ProductID by Visual Studio when binding the ObjectDataSource to the GridView, `DataKeys(rowIndex).Value` provides the `ProductID` for the specified *rowIndex*.</span></span>

<span data-ttu-id="19f97-281">ButtonField は、`e.CommandArgument` パラメーターを通じてボタンがクリックされた行の*rowIndex*を自動的に渡します。</span><span class="sxs-lookup"><span data-stu-id="19f97-281">The ButtonField automatically passes in the *rowIndex* of the row whose button was clicked through the `e.CommandArgument` parameter.</span></span> <span data-ttu-id="19f97-282">そのため、Price + 10% または Price-10% のボタンをクリックした行の `ProductID` を確認するには、次のように使用します: `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`。</span><span class="sxs-lookup"><span data-stu-id="19f97-282">Therefore, to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we use: `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`.</span></span>

<span data-ttu-id="19f97-283">[すべての製品を中止] ボタンと同様に、GridView のビューステートを無効にした場合、GridView はすべてのポストバックの基になるデータストアに再バインドされます。そのため、クリックしたときに発生した価格の変化を反映するように、直ちに更新が行われます。いずれかのボタン。</span><span class="sxs-lookup"><span data-stu-id="19f97-283">As with the Discontinue All Products button, if you have disabled the GridView s view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect a price change that occurs from clicking either of the buttons.</span></span> <span data-ttu-id="19f97-284">ただし、GridView でビューステートが無効になっていない場合は、この変更を行った後、データを GridView に手動で再バインドする必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-284">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="19f97-285">これを実現するには、`UpdateProduct` メソッドを呼び出した直後に GridView s `DataBind()` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-285">To accomplish this, simply make a call to the GridView s `DataBind()` method immediately after invoking the `UpdateProduct` method.</span></span>

<span data-ttu-id="19f97-286">図20は、おばあちゃん友野 's Homestead によって提供される製品を表示するときのページを示しています。</span><span class="sxs-lookup"><span data-stu-id="19f97-286">Figure 20 shows the page when viewing the products provided by Grandma Kelly's Homestead.</span></span> <span data-ttu-id="19f97-287">図21は、おばあちゃんの Boysenberry 拡散に対して Price + 10% ボタンを2回クリックした後の結果を示しています。 Northwoods Cranberry ソースの場合は、1回の価格-10% ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="19f97-287">Figure 21 shows the results after the Price +10% button has been clicked twice for Grandma's Boysenberry Spread and the Price -10% button once for Northwoods Cranberry Sauce.</span></span>

<span data-ttu-id="19f97-288">[GridView に Price + 10% と Price-10% のボタンが含まれている ![](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-288">[![The GridView Includes Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image50.png)</span></span>

<span data-ttu-id="19f97-289">**図 20**: GridView には、price + 10% および price-10% のボタンが含まれています ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image52.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-289">**Figure 20**: The GridView Includes Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image52.png))</span></span>

<span data-ttu-id="19f97-290">[1番目と3番目の製品の価格は、[価格 + 10%] ボタンと [Price-10%] ボタンによって更新されてい ![](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="19f97-290">[![The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image53.png)</span></span>

<span data-ttu-id="19f97-291">**図 21**: 1 番目と3番目の製品の価格が価格 + 10% と料金10% のボタンで更新されました ([クリックすると、フルサイズの画像が表示](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image55.png)されます)</span><span class="sxs-lookup"><span data-stu-id="19f97-291">**Figure 21**: The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-vb/_static/image55.png))</span></span>

> [!NOTE]
> <span data-ttu-id="19f97-292">GridView (および DetailsView) には、TemplateFields にボタン、リンクボタン、または ImageButtons を追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="19f97-292">The GridView (and DetailsView) can also have Buttons, LinkButtons, or ImageButtons added to their TemplateFields.</span></span> <span data-ttu-id="19f97-293">BoundField の場合と同様に、これらのボタンをクリックするとポストバックが実行され、GridView の `RowCommand` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="19f97-293">As with the BoundField, these Buttons, when clicked, will induce a postback, raising the GridView s `RowCommand` event.</span></span> <span data-ttu-id="19f97-294">ただし、TemplateField にボタンを追加する場合、ボタンの `CommandArgument` は、ButtonFields を使用する場合と同様に、行のインデックスに自動的に設定されるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="19f97-294">When adding buttons in a TemplateField, however, the Button s `CommandArgument` is not automatically set to the index of the row as it is when using ButtonFields.</span></span> <span data-ttu-id="19f97-295">`RowCommand` イベントハンドラー内でクリックされたボタンの行インデックスを確認する必要がある場合は、次のようなコードを使用して、TemplateField 内の宣言構文でボタン s `CommandArgument` プロパティを手動で設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-295">If you need to determine the row index of the button that was clicked within the `RowCommand` event handler, you'll need to manually set the Button s `CommandArgument` property in its declarative syntax within the TemplateField, using code like:</span></span>  
> <span data-ttu-id="19f97-296">`<asp:Button runat="server" ... CommandArgument='<%# CType(Container, GridViewRow).RowIndex %>' />`.</span><span class="sxs-lookup"><span data-stu-id="19f97-296">`<asp:Button runat="server" ... CommandArgument='<%# CType(Container, GridViewRow).RowIndex %>' />`.</span></span>

## <a name="summary"></a><span data-ttu-id="19f97-297">要約</span><span class="sxs-lookup"><span data-stu-id="19f97-297">Summary</span></span>

<span data-ttu-id="19f97-298">GridView、DetailsView、および FormView コントロールには、ボタン、リンクボタン、または ImageButtons を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="19f97-298">The GridView, DetailsView, and FormView controls all can include Buttons, LinkButtons, or ImageButtons.</span></span> <span data-ttu-id="19f97-299">このようなボタンをクリックすると、ポストバックが発生し、FormView および DetailsView コントロールと GridView の `RowCommand` イベントで `ItemCommand` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="19f97-299">Such buttons, when clicked, cause a postback and raise the `ItemCommand` event in the FormView and DetailsView controls and the `RowCommand` event in the GridView.</span></span> <span data-ttu-id="19f97-300">これらのデータ Web コントロールには、レコードの削除や編集など、コマンドに関連する一般的な操作を処理するための機能が組み込まれています。</span><span class="sxs-lookup"><span data-stu-id="19f97-300">These data Web controls have built-in functionality to handle common command-related actions, such as deleting or editing records.</span></span> <span data-ttu-id="19f97-301">ただし、ボタンをクリックすると、独自のカスタムコードを実行して応答することもできます。</span><span class="sxs-lookup"><span data-stu-id="19f97-301">However, we can also use buttons that, when clicked, respond with executing our own custom code.</span></span>

<span data-ttu-id="19f97-302">これを実現するには、`ItemCommand` イベントまたは `RowCommand` イベントのイベントハンドラーを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="19f97-302">To accomplish this, we need to create an event handler for the `ItemCommand` or `RowCommand` event.</span></span> <span data-ttu-id="19f97-303">このイベントハンドラーでは、最初に受信 `CommandName` 値を確認して、クリックされたボタンを特定し、適切なカスタムアクションを実行します。</span><span class="sxs-lookup"><span data-stu-id="19f97-303">In this event handler we first check the incoming `CommandName` value to determine which button was clicked and then take appropriate custom action.</span></span> <span data-ttu-id="19f97-304">このチュートリアルでは、ボタンと ButtonFields を使用して、指定された業者のすべての製品を中止する方法、または特定の製品の価格を10% 増減する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="19f97-304">In this tutorial we saw how to use buttons and ButtonFields to discontinue all products for a specified supplier or to increase or decrease the price of a particular product by 10%.</span></span>

<span data-ttu-id="19f97-305">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="19f97-305">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="19f97-306">作成者について</span><span class="sxs-lookup"><span data-stu-id="19f97-306">About the Author</span></span>

<span data-ttu-id="19f97-307">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="19f97-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="19f97-308">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="19f97-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="19f97-309">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="19f97-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="19f97-310">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="19f97-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="19f97-311">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="19f97-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="19f97-312">前へ</span><span class="sxs-lookup"><span data-stu-id="19f97-312">Previous</span></span>](adding-and-responding-to-buttons-to-a-gridview-cs.md)
