---
uid: web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
title: 'マスター/詳細: 詳細 DataList (C#) を使用して、マスターレコードの箇条書きリストを使用します。Microsoft Docs'
author: rick-anderson
description: このチュートリアルでは、前のチュートリアルの2ページのマスター/詳細レポートを1つのページに圧縮します。これにより、名前の付いたカテゴリ名の一覧が t... で表示されます。
ms.author: riande
ms.date: 10/17/2006
ms.assetid: c727bb73-7b59-41a1-8dc3-623c6d69e7c2
msc.legacyurl: /web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: 4549ab8e64599b09c300c158bedfd5d85efafc4d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74591870"
---
# <a name="masterdetail-using-a-bulleted-list-of-master-records-with-a-details-datalist-c"></a><span data-ttu-id="c9fbf-103">マスター レコードの箇条書きと詳細 DataList を使用してマスター/詳細を表示する (C#)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-103">Master/Detail Using a Bulleted List of Master Records with a Details DataList (C#)</span></span>

<span data-ttu-id="c9fbf-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c9fbf-105">[サンプルアプリのダウンロード](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe)または[PDF のダウンロード](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe) or [Download PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span></span>

> <span data-ttu-id="c9fbf-106">このチュートリアルでは、前のチュートリアルの2ページのマスター/詳細レポートを1つのページに圧縮して、画面の左側にカテゴリ名の箇条書きリストを表示し、画面の右側に選択したカテゴリの製品を表示します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-106">In this tutorial we'll compress the two-page master/detail report of the previous tutorial into a single page, showing a bulleted list of category names on the left side of the screen and the selected category's products on the right of the screen.</span></span>

## <a name="introduction"></a><span data-ttu-id="c9fbf-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="c9fbf-107">Introduction</span></span>

<span data-ttu-id="c9fbf-108">前の[チュートリアル](master-detail-filtering-acess-two-pages-datalist-cs.md)では、マスター/詳細レポートを2ページに分割する方法を見てきました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-108">In the [preceding tutorial](master-detail-filtering-acess-two-pages-datalist-cs.md) we looked at how to separate a master/detail report across two pages.</span></span> <span data-ttu-id="c9fbf-109">マスターページでは、Repeater コントロールを使用して、カテゴリの箇条書きリストを表示していました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-109">In the master page we used a Repeater control to render a bulleted list of categories.</span></span> <span data-ttu-id="c9fbf-110">各カテゴリ名はハイパーリンクでした。クリックすると、ユーザーは [詳細] ページに移動します。このページには、選択したカテゴリに属する製品が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-110">Each category name was a hyperlink that, when clicked, would take the user to the details page, where a two-column DataList showed those products belonging to the selected category.</span></span>

<span data-ttu-id="c9fbf-111">このチュートリアルでは、2ページのチュートリアルを1つのページに圧縮し、各カテゴリ名を LinkButton として表示し、画面の左側にカテゴリ名の箇条書きリストを表示します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-111">In this tutorial we'll compress the two-page tutorial into a single page, showing a bulleted list of category names on the left side of the screen with each category name rendered as a LinkButton.</span></span> <span data-ttu-id="c9fbf-112">Category name LinkButtons のいずれかをクリックすると、ポストバックが誘発され、選択したカテゴリの製品が画面右側の2列の DataList にバインドされます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-112">Clicking one of the category name LinkButtons induces a postback and binds the selected category s products to a two-column DataList on the right of the screen.</span></span> <span data-ttu-id="c9fbf-113">各カテゴリの名前を表示するだけでなく、左側のリピータは特定のカテゴリの製品の合計数を示しています (図1を参照)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-113">In addition to displaying each category s name, the Repeater on the left shows how many total products there are for a given category (see Figure 1).</span></span>

<span data-ttu-id="c9fbf-114">[カテゴリの名前と製品の合計数が左側に表示され ![](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-114">[![The Category s Name and Total Number of Products are Displayed on the Left](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span></span>

<span data-ttu-id="c9fbf-115">**図 1**: カテゴリの名前と製品の合計数が左側に表示される ([クリックすると、フルサイズの画像が表示](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-115">**Figure 1**: The Category s Name and Total Number of Products are Displayed on the Left ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span></span>

## <a name="step-1-displaying-a-repeater-in-the-left-portion-of-the-screen"></a><span data-ttu-id="c9fbf-116">手順 1: 画面の左側の部分にリピータを表示する</span><span class="sxs-lookup"><span data-stu-id="c9fbf-116">Step 1: Displaying a Repeater in the Left Portion of the Screen</span></span>

<span data-ttu-id="c9fbf-117">このチュートリアルでは、選択したカテゴリの製品の左側に、カテゴリの箇条書きの一覧が表示されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-117">For this tutorial we need to have the bulleted list of categories appear to the left of the selected category s products.</span></span> <span data-ttu-id="c9fbf-118">Web ページ内のコンテンツを配置するには、標準の HTML 要素の段落タグ、改行しないスペース、`<table>` s などを使用するか、カスケードスタイルシート (CSS) 手法を使用します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-118">Content within a web page can be positioned using standard HTML elements paragraph tags, non-breaking spaces, `<table>` s, and so on or through cascading stylesheet (CSS) techniques.</span></span> <span data-ttu-id="c9fbf-119">これまでのすべてのチュートリアルでは、配置に CSS 手法が使用されていました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-119">All of our tutorials thus far have used CSS techniques for positioning.</span></span> <span data-ttu-id="c9fbf-120">[マスターページとサイトナビゲーション](../introduction/master-pages-and-site-navigation-cs.md)のチュートリアルで、マスターページにナビゲーションユーザーインターフェイスを構築したときに、ナビゲーションリストとメインコンテンツの正確なピクセルオフセットを示す*絶対配置*を使用していました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-120">When we built the navigation user interface in our master page in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we used *absolute positioning*, indicating the precise pixel offset for the navigation list and the main content.</span></span> <span data-ttu-id="c9fbf-121">または、CSS を使用して、1つの要素を別の要素の右側または左側に*フローティング*で配置することもできます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-121">Alternatively, CSS can be used to position one element to the right or left of another through *floating*.</span></span> <span data-ttu-id="c9fbf-122">DataList を使用して、選択したカテゴリの製品の左側に、DataList の左側にあるリストを表示できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-122">We can have the bulleted list of categories appear to the left of the selected category s products by floating the Repeater to the left of the DataList</span></span>

<span data-ttu-id="c9fbf-123">`DataListRepeaterFiltering` フォルダーから `CategoriesAndProducts.aspx` ページを開き、Repeater と DataList というページに追加します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-123">Open the `CategoriesAndProducts.aspx` page from the `DataListRepeaterFiltering` folder and add to the page a Repeater and a DataList.</span></span> <span data-ttu-id="c9fbf-124">Repeater の `ID` を `Categories` に設定し、DataList を `CategoryProducts`に設定します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-124">Set the Repeater s `ID` to `Categories` and the DataList s to `CategoryProducts`.</span></span> <span data-ttu-id="c9fbf-125">ソースビューに移動し、Repeater コントロールと DataList コントロールを独自の `<div>` 要素内に配置します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-125">Go to the Source view and put the Repeater and DataList controls within their own `<div>` elements.</span></span> <span data-ttu-id="c9fbf-126">つまり、まず `<div>` 要素内で Repeater を囲み、次に、独自の `<div>` 要素内の DataList をリピータの直後に記述します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-126">That is, enclose the Repeater within a `<div>` element first and then the DataList in its own `<div>` element directly after the Repeater.</span></span> <span data-ttu-id="c9fbf-127">この時点で、マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-127">Your markup at this point should look similar to the following:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample1.aspx)]

<span data-ttu-id="c9fbf-128">Repeater を DataList の左側にフローティングさせるには、次のように `float` CSS スタイル属性を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-128">To float the Repeater to the left of the DataList, we need to use the `float` CSS style attribute, like so:</span></span>

[!code-html[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample2.html)]

<span data-ttu-id="c9fbf-129">`float: left;` は、最初の `<div>` 要素を2番目の要素の左側にフローティングします。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-129">The `float: left;` floats the first `<div>` element to the left of the second one.</span></span> <span data-ttu-id="c9fbf-130">`width` と `padding-right` の設定は、最初の `<div>` s `width`、および `<div>` 要素のコンテンツとその右余白の間に追加される余白を示します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-130">The `width` and `padding-right` settings indicate the first `<div>` s `width` and how much padding is added between the `<div>` element s content and its right margin.</span></span> <span data-ttu-id="c9fbf-131">CSS の浮動要素の詳細については、 [Floatutorial](http://css.maxdesign.com.au/floatutorial/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-131">For more information on floating elements in CSS check out the [Floatutorial](http://css.maxdesign.com.au/floatutorial/).</span></span>

<span data-ttu-id="c9fbf-132">最初の `<p>` element s `style` 属性を使用してスタイル設定を直接指定するのではなく、`FloatLeft`という名前の `Styles.css` に新しい CSS クラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-132">Rather than specify the style setting directly through the first `<p>` element s `style` attribute, let s instead create a new CSS class in `Styles.css` named `FloatLeft`:</span></span>

[!code-css[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample3.css)]

<span data-ttu-id="c9fbf-133">その後、`<div>` を `<div class="FloatLeft">`に置き換えることができます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-133">Then we can replace the `<div>` with `<div class="FloatLeft">`.</span></span>

<span data-ttu-id="c9fbf-134">CSS クラスを追加し、[`CategoriesAndProducts.aspx`] ページでマークアップを構成した後、デザイナーにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-134">After adding the CSS class and configuring the markup in the `CategoriesAndProducts.aspx` page, go to the Designer.</span></span> <span data-ttu-id="c9fbf-135">データソースまたはテンプレートをまだ構成していないので、このダイアログボックスの左側には [Repeater] が表示されます (ただし、現在は灰色のボックスとして表示されています)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-135">You should see the Repeater floating to the left of the DataList (although right now both just appear as gray boxes since we ve yet to configure their data sources or templates).</span></span>

<span data-ttu-id="c9fbf-136">[![、Repeater が DataList の左側にフローティングされます。](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-136">[![The Repeater is Floated to the Left of the DataList](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span></span>

<span data-ttu-id="c9fbf-137">**図 2**: Repeater が DataList の左側にフロートする ([クリックすると、フルサイズの画像が表示](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-137">**Figure 2**: The Repeater is Floated to the Left of the DataList ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span></span>

## <a name="step-2-determining-the-number-of-products-for-each-category"></a><span data-ttu-id="c9fbf-138">手順 2: 各カテゴリの製品数を確認する</span><span class="sxs-lookup"><span data-stu-id="c9fbf-138">Step 2: Determining the Number of Products for Each Category</span></span>

<span data-ttu-id="c9fbf-139">リピータと DataList を囲むマークアップが完了したら、カテゴリデータを Repeater コントロールにバインドする準備ができました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-139">With the Repeater and DataList s surrounding markup complete, we re ready to bind the category data to the Repeater control.</span></span> <span data-ttu-id="c9fbf-140">ただし、図1のカテゴリの箇条書きリストが示されているように、各カテゴリの名前に加えて、カテゴリに関連付けられている製品の数も表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-140">However, as the bulleted list of categories in Figure 1 shows, in addition to each category s name we also need to display the number of products associated with the category.</span></span> <span data-ttu-id="c9fbf-141">この情報にアクセスするには、次のいずれかの方法があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-141">To access this information we can either:</span></span>

- <span data-ttu-id="c9fbf-142">**この情報は、ASP.NET ページの分離コードクラスから確認してください。**</span><span class="sxs-lookup"><span data-stu-id="c9fbf-142">**Determine this information from the ASP.NET page s code-behind class.**</span></span> <span data-ttu-id="c9fbf-143">特定の *`categoryID`* を指定すると、`ProductsBLL` クラス s `GetProductsByCategoryID(categoryID)` メソッドを呼び出すことによって、関連付けられている製品の数を特定できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-143">Given a particular *`categoryID`* we can determine the number of associated products by calling the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="c9fbf-144">このメソッドは `ProductsDataTable` オブジェクトを返します。この `Count` オブジェクトは、指定された *`categoryID`* の製品数である `ProductsRow` s の数を示します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-144">This method returns a `ProductsDataTable` object whose `Count` property indicates how many `ProductsRow` s exists, which is the number of products for the specified *`categoryID`*.</span></span> <span data-ttu-id="c9fbf-145">リピータにバインドされている各カテゴリについて、`ProductsBLL` クラス s `GetProductsByCategoryID(categoryID)` メソッドを呼び出し、そのカウントを出力に含める、リピータの `ItemDataBound` イベントハンドラーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-145">We can create an `ItemDataBound` event handler for the Repeater that, for each category bound to the Repeater, calls the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and includes its count in the output.</span></span>
- <span data-ttu-id="c9fbf-146">**`NumberOfProducts` 列を含めるように、型指定されたデータセットの `CategoriesDataTable` を更新します。**</span><span class="sxs-lookup"><span data-stu-id="c9fbf-146">**Update the `CategoriesDataTable` in the Typed DataSet to include a `NumberOfProducts` column.**</span></span> <span data-ttu-id="c9fbf-147">次に、`CategoriesDataTable` の `GetCategories()` メソッドを更新してこの情報を含めるか、または `GetCategories()` をそのままにして、`GetCategoriesAndNumberOfProducts()`という新しい `CategoriesDataTable` メソッドを作成できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-147">We can then update the `GetCategories()` method in the `CategoriesDataTable` to include this information or, alternatively, leave `GetCategories()` as-is and create a new `CategoriesDataTable` method called `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="c9fbf-148">では、これらの両方の手法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-148">Let s explore both of these techniques.</span></span> <span data-ttu-id="c9fbf-149">データアクセス層を更新する必要がないため、最初の方法は簡単に実装できます。ただし、データベースとの通信を増やす必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-149">The first approach is simpler to implement since we don t need to update the Data Access Layer; however, it requires more communications with the database.</span></span> <span data-ttu-id="c9fbf-150">`ItemDataBound` イベントハンドラーの `ProductsBLL` クラス s `GetProductsByCategoryID(categoryID)` メソッドを呼び出すと、リピータに表示される各カテゴリに対して、追加のデータベース呼び出しが追加されます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-150">The call to the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method in the `ItemDataBound` event handler adds an extra database call for each category displayed in the Repeater.</span></span> <span data-ttu-id="c9fbf-151">この手法では、 *n* + 1 データベースが呼び出されます。ここで、 *n*はリピータに表示されるカテゴリの数です。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-151">With this technique there are *N* + 1 database calls, where *N* is the number of categories displayed in the Repeater.</span></span> <span data-ttu-id="c9fbf-152">2番目の方法では、`CategoriesBLL` クラス s `GetCategories()` (または `GetCategoriesAndNumberOfProducts()`) メソッドから、各カテゴリに関する情報と共に製品数が返されます。これにより、データベースへのトリップが1回だけになります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-152">With the second approach, the product count is returned with information about each category from the `CategoriesBLL` class s `GetCategories()` (or `GetCategoriesAndNumberOfProducts()`) method, thereby resulting in just one trip to the database.</span></span>

## <a name="determining-the-number-of-products-in-the-itemdatabound-event-handler"></a><span data-ttu-id="c9fbf-153">ItemDataBound バインドイベントハンドラー内の製品の数を確認する</span><span class="sxs-lookup"><span data-stu-id="c9fbf-153">Determining the Number of Products in the ItemDataBound Event Handler</span></span>

<span data-ttu-id="c9fbf-154">リピータ s `ItemDataBound` イベントハンドラーの各カテゴリの製品数を特定しても、既存のデータアクセス層を変更する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-154">Determining the number of products for each category in the Repeater s `ItemDataBound` event handler does not require any modifications to our existing Data Access Layer.</span></span> <span data-ttu-id="c9fbf-155">すべての変更は、[`CategoriesAndProducts.aspx`] ページ内で直接行うことができます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-155">All modifications can be made directly within the `CategoriesAndProducts.aspx` page.</span></span> <span data-ttu-id="c9fbf-156">まず、Repeater s スマートタグを介して `CategoriesDataSource` という名前の新しい ObjectDataSource を追加します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-156">Start by adding a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="c9fbf-157">次に、`CategoriesBLL` クラス s `GetCategories()` メソッドからデータを取得するように `CategoriesDataSource` ObjectDataSource を構成します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-157">Next, configure the `CategoriesDataSource` ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories()` method.</span></span>

<span data-ttu-id="c9fbf-158">[GetCategories () メソッドを使用するように ObjectDataSource を構成 ![](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-158">[![Configure the ObjectDataSource to Use the CategoriesBLL class s GetCategories() Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span></span>

<span data-ttu-id="c9fbf-159">**図 3**: `CategoriesBLL` クラス s `GetCategories()` メソッドを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="c9fbf-159">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` class s `GetCategories()` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span></span>

<span data-ttu-id="c9fbf-160">`Categories` リピータの各項目をクリック可能にする必要があります。クリックすると、`CategoryProducts` DataList によって選択したカテゴリの製品が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-160">Each item in the `Categories` Repeater needs to be clickable and, when clicked, cause the `CategoryProducts` DataList to display those products for the selected category.</span></span> <span data-ttu-id="c9fbf-161">これを行うには、前のチュートリアルで説明したように、各カテゴリにハイパーリンクを設定し、同じページ (`CategoriesAndProducts.aspx`) にリンクしてから、クエリ文字列を使用して `CategoryID` を渡します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-161">This can be accomplished by making each category a hyperlink, linking back to this same page (`CategoriesAndProducts.aspx`), but passing the `CategoryID` through the querystring, much like we saw in the previous tutorial.</span></span> <span data-ttu-id="c9fbf-162">この方法の利点は、特定のカテゴリの製品を表示するページにブックマークを付けて、検索エンジンでインデックスを作成できることです。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-162">The advantage of this approach is that a page displaying a particular category s products can be bookmarked and indexed by a search engine.</span></span>

<span data-ttu-id="c9fbf-163">または、各カテゴリを LinkButton にすることもできます。これは、このチュートリアルで使用するアプローチです。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-163">Alternatively, we can make each category a LinkButton, which is the approach we'll use for this tutorial.</span></span> <span data-ttu-id="c9fbf-164">LinkButton は、ユーザーのブラウザーでハイパーリンクとしてレンダリングされますが、クリックするとポストバックが誘発されます。ポストバック時に、DataList s ObjectDataSource を更新して、選択したカテゴリに属する製品を表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-164">The LinkButton renders in the user s browser as a hyperlink but, when clicked, induces a postback; on postback, the DataList s ObjectDataSource needs to be refreshed to display those products belonging to the selected category.</span></span> <span data-ttu-id="c9fbf-165">このチュートリアルでは、ハイパーリンクを使用する方が、LinkButton を使用するよりもわかりやすくなります。ただし、LinkButton を使用する方が有利な場合もあります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-165">For this tutorial, using a hyperlink makes more sense than using a LinkButton; however, there may be other scenarios where using a LinkButton is more advantageous.</span></span> <span data-ttu-id="c9fbf-166">この例ではハイパーリンクのアプローチが理想的ですが、では、LinkButton の使用方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-166">While the hyperlink approach would be ideal for this example, let s instead explore using the LinkButton.</span></span> <span data-ttu-id="c9fbf-167">ここで説明するように、LinkButton を使用すると、ハイパーリンクでは発生しないいくつかの課題が発生します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-167">As we'll see, using a LinkButton introduces some challenges that would not otherwise arise with a hyperlink.</span></span> <span data-ttu-id="c9fbf-168">このため、このチュートリアルで LinkButton を使用すると、これらの課題が強調表示されるため、ハイパーリンクの代わりに LinkButton を使用する必要があるシナリオに対するソリューションを提供できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-168">Therefore, using a LinkButton in this tutorial will highlight these challenges and help provide solutions for those scenarios where we may want to use a LinkButton instead of a hyperlink.</span></span>

> [!NOTE]
> <span data-ttu-id="c9fbf-169">このチュートリアルは、LinkButton の代わりに HyperLink コントロールまたは `<a>` 要素を使用して繰り返すことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-169">You are encouraged to repeat this tutorial using a HyperLink control or `<a>` element in lieu of the LinkButton.</span></span>

<span data-ttu-id="c9fbf-170">次のマークアップは、Repeater および ObjectDataSource の宣言型の構文を示しています。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-170">The following markup shows the declarative syntax for the Repeater and the ObjectDataSource.</span></span> <span data-ttu-id="c9fbf-171">Repeater テンプレートは、各項目を LinkButton として使用して箇条書きを表示することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-171">Note that the Repeater s templates render a bulleted list with each item as a LinkButton:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample4.aspx)]

> [!NOTE]
> <span data-ttu-id="c9fbf-172">このチュートリアルでは、リピータのビューステートが有効になっている必要があります (リピータの宣言構文からの `EnableViewState="False"` が省略されていることに注意してください)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-172">For this tutorial the Repeater must have its view state enabled (note the omission of the `EnableViewState="False"` from the Repeater s declarative syntax).</span></span> <span data-ttu-id="c9fbf-173">手順3では、`ItemCommand` イベントのイベントハンドラーを作成します。ここでは、DataList s ObjectDataSource s `SelectParameters` コレクションを更新します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-173">In step 3 we'll be creating an event handler for the Repeater s `ItemCommand` event in which we'll be updating the DataList s ObjectDataSource s `SelectParameters` collection.</span></span> <span data-ttu-id="c9fbf-174">ただし、Repeater の `ItemCommand`は、ビューステートが無効になっている場合には起動しません。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-174">The Repeater s `ItemCommand`, however, won't fire if view state is disabled.</span></span> <span data-ttu-id="c9fbf-175">Repeater s `ItemCommand` イベントの発生時にビューステートを有効にする必要がある理由の詳細については、 [ASP.NET の質問](http://scottonwriting.net/sowblog/posts/1263.aspx)と[その解決策](http://scottonwriting.net/sowBlog/posts/1268.aspx)に関する Stumper を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-175">See [A Stumper of an ASP.NET Question](http://scottonwriting.net/sowblog/posts/1263.aspx) and [its solution](http://scottonwriting.net/sowBlog/posts/1268.aspx) for more information on why view state must be enabled for a Repeater s `ItemCommand` event to fire.</span></span>

<span data-ttu-id="c9fbf-176">`ViewCategory` の `ID` プロパティ値を持つ LinkButton の `Text` プロパティが設定されていません。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-176">The LinkButton with the `ID` property value of `ViewCategory` does not have its `Text` property set.</span></span> <span data-ttu-id="c9fbf-177">カテゴリ名を表示するだけの場合は、次のように、データバインディング構文を使用して、Text プロパティを宣言的に設定します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-177">If we had just wanted to display the category name, we would have set the Text property declaratively, through databinding syntax, like so:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample5.aspx)]

<span data-ttu-id="c9fbf-178">ただし、カテゴリの名前*と*そのカテゴリに属する製品の数の両方を表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-178">However, we want to show both the category s name *and* the number of products belonging to that category.</span></span> <span data-ttu-id="c9fbf-179">この情報は、次のコードに示すように、`ProductBLL` クラス s `GetCategoriesByProductID(categoryID)` メソッドを呼び出し、結果の `ProductsDataTable`で返されるレコードの数を決定することによって、Repeater s `ItemDataBound` イベントハンドラーから取得できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-179">This information can be retrieved from the Repeater s `ItemDataBound` event handler by making a call to the `ProductBLL` class s `GetCategoriesByProductID(categoryID)` method and determining how many records are returned in the resulting `ProductsDataTable`, as the following code illustrates:</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="c9fbf-180">まず、データ項目 (`ItemType` が `Item` または `AlternatingItem`) を操作し、現在の `RepeaterItem`にバインドされたばかりの `CategoriesRow` インスタンスを参照していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-180">We start out by ensuring that we re working with a data item (one whose `ItemType` is `Item` or `AlternatingItem`) and then reference the `CategoriesRow` instance that has just been bound to the current `RepeaterItem`.</span></span> <span data-ttu-id="c9fbf-181">次に、`ProductsBLL` クラスのインスタンスを作成し、その `GetCategoriesByProductID(categoryID)` メソッドを呼び出し、`Count` プロパティを使用して返されるレコードの数を決定することによって、このカテゴリの製品の数を決定します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-181">Next, we determine the number of products for this category by creating an instance of the `ProductsBLL` class, calling its `GetCategoriesByProductID(categoryID)` method, and determining the number of records returned using the `Count` property.</span></span> <span data-ttu-id="c9fbf-182">最後に、ItemTemplate の `ViewCategory` LinkButton は references で、その `Text` プロパティは [*区分*値] (*numberofproductsincategory*) に設定されます。ここで、 *numberofproductsincategory*は小数点以下をゼロにした数値として書式設定されます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-182">Finally, the `ViewCategory` LinkButton in the ItemTemplate is references and its `Text` property is set to *CategoryName* (*NumberOfProductsInCategory*), where *NumberOfProductsInCategory* is formatted as a number with zero decimal places.</span></span>

> [!NOTE]
> <span data-ttu-id="c9fbf-183">別の方法として、ASP.NET ページの分離コードクラスに*書式関数*を追加して、カテゴリの `CategoryName` と `CategoryID` 値を受け取り、カテゴリの製品数と連結した `CategoryName` を返すこともできます (`GetCategoriesByProductID(categoryID)` メソッドを呼び出すことによって決定)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-183">Alternatively, we could have added a *formatting function* to the ASP.NET page s code-behind class that accepts a category s `CategoryName` and `CategoryID` values and returns the `CategoryName` concatenated with the number of products in the category (as determined by calling the `GetCategoriesByProductID(categoryID)` method).</span></span> <span data-ttu-id="c9fbf-184">このような書式設定関数の結果は、`ItemDataBound` イベントハンドラーの必要性を置き換えるために、LinkButton の Text プロパティに宣言によって割り当てられる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-184">The results of such a formatting function could be declaratively assigned to the LinkButton s Text property replacing the need for the `ItemDataBound` event handler.</span></span> <span data-ttu-id="c9fbf-185">書式設定関数の使用方法の詳細については、 [GridView コントロールの Using TemplateFields](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)を参照するか、データのチュートリアルに[基づいて DataList と Repeater を書式設定](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md)してください。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-185">Refer to the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) or [Formatting the DataList and Repeater Based Upon Data](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md) tutorials for more information on using formatting functions.</span></span>

<span data-ttu-id="c9fbf-186">このイベントハンドラーを追加した後、ブラウザーを使用してページをテストします。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-186">After adding this event handler, take a moment to test the page through a browser.</span></span> <span data-ttu-id="c9fbf-187">各カテゴリが箇条書きで一覧表示され、カテゴリの名前とカテゴリに関連付けられている製品の数が表示されます (図4を参照)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-187">Note how each category is listed in a bulleted list, displaying the category s name and the number of products associated with the category (see Figure 4).</span></span>

<span data-ttu-id="c9fbf-188">[各カテゴリの名前と製品数が ![表示されます。](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-188">[![Each Category s Name and Number of Products are Displayed](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span></span>

<span data-ttu-id="c9fbf-189">**図 4**: 各カテゴリの名前と製品の数が表示されます ([クリックすると、フルサイズの画像が表示](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-189">**Figure 4**: Each Category s Name and Number of Products are Displayed ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span></span>

## <a name="updating-thecategoriesdatatableandcategoriestableadapterto-include-the-number-of-products-for-each-category"></a><span data-ttu-id="c9fbf-190">各カテゴリの製品数を含むように`CategoriesDataTable`と`CategoriesTableAdapter`を更新する</span><span class="sxs-lookup"><span data-stu-id="c9fbf-190">Updating the`CategoriesDataTable`and`CategoriesTableAdapter`to Include the Number of Products for Each Category</span></span>

<span data-ttu-id="c9fbf-191">各カテゴリの製品数をリピータにバインドするのではなく、データアクセス層の `CategoriesDataTable` と `CategoriesTableAdapter` を調整してこの情報をネイティブに含めることで、このプロセスを効率化できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-191">Rather than determining the number of products for each category as it s bound to the Repeater, we can streamline this process by adjusting the `CategoriesDataTable` and `CategoriesTableAdapter` in the Data Access Layer to include this information natively.</span></span> <span data-ttu-id="c9fbf-192">これを実現するには、`CategoriesDataTable` に新しい列を追加して、関連付けられている製品の数を保持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-192">To achieve this, we must add a new column to `CategoriesDataTable` to hold the number of associated products.</span></span> <span data-ttu-id="c9fbf-193">DataTable に新しい列を追加するには、型指定されたデータセット (`App_Code\DAL\Northwind.xsd`) を開き、変更する DataTable を右クリックして、[追加/列] を選択します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-193">To add a new column to a DataTable, open the Typed DataSet (`App_Code\DAL\Northwind.xsd`), right-click on the DataTable to modify, and choose Add / Column.</span></span> <span data-ttu-id="c9fbf-194">`CategoriesDataTable` に新しい列を追加します (図5を参照)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-194">Add a new column to the `CategoriesDataTable` (see Figure 5).</span></span>

<span data-ttu-id="c9fbf-195">[新しい列をカテゴリデータソースに追加 ![には](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-195">[![Add a New Column to the CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span></span>

<span data-ttu-id="c9fbf-196">**図 5**: `CategoriesDataSource` に新しい列を追加する ([クリックすると、フルサイズの画像が表示](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-196">**Figure 5**: Add a New Column to the `CategoriesDataSource` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span></span>

<span data-ttu-id="c9fbf-197">これにより、`Column1`という名前の新しい列が追加されます。これは、別の名前を入力するだけで変更できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-197">This will add a new column named `Column1`, which you can change by simply typing in a different name.</span></span> <span data-ttu-id="c9fbf-198">この新しい列の名前を `NumberOfProducts`に変更します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-198">Rename this new column to `NumberOfProducts`.</span></span> <span data-ttu-id="c9fbf-199">次に、この列のプロパティを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-199">Next, we need to configure this column s properties.</span></span> <span data-ttu-id="c9fbf-200">新しい列をクリックし、プロパティウィンドウにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-200">Click on the new column and go to the Properties window.</span></span> <span data-ttu-id="c9fbf-201">図6に示すように、列の `DataType` プロパティを `System.String` から `System.Int32` に変更し、`ReadOnly` プロパティを `True`に設定します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-201">Change the column s `DataType` property from `System.String` to `System.Int32` and set the `ReadOnly` property to `True`, as shown in Figure 6.</span></span>

![新しい列の DataType プロパティと ReadOnly プロパティを設定します。](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image16.png)

<span data-ttu-id="c9fbf-203">**図 6**: 新しい列の `DataType` と `ReadOnly` のプロパティを設定する</span><span class="sxs-lookup"><span data-stu-id="c9fbf-203">**Figure 6**: Set the `DataType` and `ReadOnly` Properties of the New Column</span></span>

<span data-ttu-id="c9fbf-204">`CategoriesDataTable` には `NumberOfProducts` の列がありますが、その値は、対応する TableAdapter のクエリによって設定されていません。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-204">While the `CategoriesDataTable` now has a `NumberOfProducts` column, its value is not set by any of the corresponding TableAdapter s queries.</span></span> <span data-ttu-id="c9fbf-205">カテゴリ情報を取得するたびにこのような情報が返されるようにする場合は、`GetCategories()` メソッドを更新してこの情報を返すことができます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-205">We can update the `GetCategories()` method to return this information if we want such information returned every time category information is retrieved.</span></span> <span data-ttu-id="c9fbf-206">ただし、少数のインスタンス (このチュートリアルの場合のみ) で、カテゴリに関連付けられている製品の数を取得する必要があるだけの場合は、`GetCategories()` をそのままにして、この情報を返す新しいメソッドを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-206">If, however, we only need to grab the number of associated products for the categories in rare instances (such as just for this tutorial), then we can leave `GetCategories()` as-is and create a new method that returns this information.</span></span> <span data-ttu-id="c9fbf-207">この後者の方法を使用して、`GetCategoriesAndNumberOfProducts()`という名前の新しいメソッドを作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-207">Let s use this latter approach, creating a new method named `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="c9fbf-208">この新しい `GetCategoriesAndNumberOfProducts()` メソッドを追加するには、`CategoriesTableAdapter` を右クリックし、[新しいクエリ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-208">To add this new `GetCategoriesAndNumberOfProducts()` method, right-click on the `CategoriesTableAdapter` and choose New Query.</span></span> <span data-ttu-id="c9fbf-209">これにより、前のチュートリアルで何度も使用されていた TableAdapter クエリ構成ウィザードが起動します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-209">This brings up the TableAdapter Query Configuration Wizard, which we ve used numerous times in previous tutorials.</span></span> <span data-ttu-id="c9fbf-210">この方法では、クエリで行を返すアドホック SQL ステートメントが使用されていることを示すことによって、ウィザードを開始します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-210">For this method, start the wizard by indicating that the query uses an ad-hoc SQL statement that returns rows.</span></span>

<span data-ttu-id="c9fbf-211">[アドホック SQL ステートメントを使用してメソッドを作成 ![には](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-211">[![Create the Method Using an Ad-Hoc SQL Statement](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span></span>

<span data-ttu-id="c9fbf-212">**図 7**: アドホック SQL ステートメントを使用してメソッドを作成[する (クリックすると、フルサイズのイメージが表示](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-212">**Figure 7**: Create the Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span></span>

<span data-ttu-id="c9fbf-213">[SQL ステートメントが行を返す ![](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-213">[![The SQL Statement Returns Rows](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span></span>

<span data-ttu-id="c9fbf-214">**図 8**: SQL ステートメントによって行が返される ([クリックすると、フルサイズの画像が表示](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-214">**Figure 8**: The SQL Statement Returns Rows ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span></span>

<span data-ttu-id="c9fbf-215">次のウィザード画面で、使用するクエリを入力するように求められます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-215">The next wizard screen prompts us for the query to use.</span></span> <span data-ttu-id="c9fbf-216">カテゴリに関連付けられている製品の数と共に、カテゴリ s `CategoryID`、`CategoryName`、および `Description` フィールドを返すには、次の `SELECT` ステートメントを使用します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-216">To return each category s `CategoryID`, `CategoryName`, and `Description` fields, along with the number of products associated with the category, use the following `SELECT` statement:</span></span>

[!code-sql[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample7.sql)]

<span data-ttu-id="c9fbf-217">[使用するクエリを指定 ![には](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-217">[![Specify the Query to Use](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span></span>

<span data-ttu-id="c9fbf-218">**図 9**: 使用するクエリを指定する ([クリックすると、フルサイズの画像が表示](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-218">**Figure 9**: Specify the Query to Use ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span></span>

<span data-ttu-id="c9fbf-219">カテゴリに関連付けられている製品の数を計算するサブクエリには、`NumberOfProducts`という別名が付いていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-219">Note that the subquery that computes the number of products associated with the category is aliased as `NumberOfProducts`.</span></span> <span data-ttu-id="c9fbf-220">この名前付けの一致により、このサブクエリによって返される値が `CategoriesDataTable` s `NumberOfProducts` 列に関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-220">This naming match causes the value returned by this subquery to be associated with the `CategoriesDataTable` s `NumberOfProducts` column.</span></span>

<span data-ttu-id="c9fbf-221">このクエリを入力したら、最後の手順として、新しいメソッドの名前を選択します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-221">After entering this query, the last step is to choose the name for the new method.</span></span> <span data-ttu-id="c9fbf-222">`FillWithNumberOfProducts` と `GetCategoriesAndNumberOfProducts` を使用して DataTable にデータを格納し、それぞれ DataTable パターンを返します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-222">Use `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span>

<span data-ttu-id="c9fbf-223">[新しい TableAdapter のメソッド FillWithNumberOfProducts と Getカテゴリおよび Getproducts の ![名前](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-223">[![Name the New TableAdapter s Methods FillWithNumberOfProducts and GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span></span>

<span data-ttu-id="c9fbf-224">**図 10**: 新しい TableAdapter のメソッド `FillWithNumberOfProducts` と `GetCategoriesAndNumberOfProducts` の名前を指定[する (クリックすると、フルサイズのイメージが表示](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-224">**Figure 10**: Name the New TableAdapter s Methods `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span></span>

<span data-ttu-id="c9fbf-225">この時点で、データアクセス層は、カテゴリごとの製品数を含むように拡張されています。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-225">At this point the Data Access Layer has been extended to include the number of products per category.</span></span> <span data-ttu-id="c9fbf-226">すべてのプレゼンテーション層は、別のビジネスロジックレイヤーを通じて DAL へのすべての呼び出しをルーティングするため、対応する `GetCategoriesAndNumberOfProducts` メソッドを `CategoriesBLL` クラスに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-226">Since all our presentation layer routes all calls to the DAL through a separate Business Logic Layer we need to add a corresponding `GetCategoriesAndNumberOfProducts` method to the `CategoriesBLL` class:</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="c9fbf-227">DAL と BLL が完成したので、このデータを `CategoriesAndProducts.aspx`の `Categories` リピータにバインドする準備ができました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-227">With the DAL and BLL complete, we re ready to bind this data to the `Categories` Repeater in `CategoriesAndProducts.aspx`!</span></span> <span data-ttu-id="c9fbf-228">[`ItemDataBound` イベントハンドラーで製品の数を決定する] セクションからリピータの ObjectDataSource を既に作成している場合は、この ObjectDataSource を削除し、Repeater s `DataSourceID` プロパティの設定を削除します。また、ASP.NET 分離コードクラスの `Handles Categories.OnItemDataBound` 構文を削除することによって、イベントハンドラーからリピータ s `ItemDataBound` イベントの送信を解除します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-228">If you ve already created an ObjectDataSource for the Repeater from the Determining the Number of Products in the `ItemDataBound` Event Handler section, delete this ObjectDataSource and remove the Repeater s `DataSourceID` property setting; also unwire the Repeater s `ItemDataBound` event from the event handler by removing the `Handles Categories.OnItemDataBound` syntax in the ASP.NET code-behind class.</span></span>

<span data-ttu-id="c9fbf-229">リピータが元の状態に戻ったら、Repeater s スマートタグを介して `CategoriesDataSource` という名前の新しい ObjectDataSource を追加します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-229">With the Repeater back in its original state, add a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="c9fbf-230">`CategoriesBLL` クラスを使用するように ObjectDataSource を構成しますが、`GetCategories()` メソッドを使用するのではなく、代わりに `GetCategoriesAndNumberOfProducts()` を使用します (図11を参照)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-230">Configure the ObjectDataSource to use the `CategoriesBLL` class, but instead of having it use the `GetCategories()` method, have it use `GetCategoriesAndNumberOfProducts()` instead (see Figure 11).</span></span>

<span data-ttu-id="c9fbf-231">[Get分類 Andnumberofproducts メソッドを使用するように ObjectDataSource を構成 ![には](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-231">[![Configure the ObjectDataSource to Use the GetCategoriesAndNumberOfProducts Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span></span>

<span data-ttu-id="c9fbf-232">**図 11**: `GetCategoriesAndNumberOfProducts` メソッドを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="c9fbf-232">**Figure 11**: Configure the ObjectDataSource to Use the `GetCategoriesAndNumberOfProducts` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span></span>

<span data-ttu-id="c9fbf-233">次に、`ItemTemplate` を更新して、LinkButton `Text` プロパティが databinding 構文を使用して宣言に割り当てられ、`CategoryName` と `NumberOfProducts` の両方のデータフィールドが含まれるようにします。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-233">Next, update the `ItemTemplate` so that the LinkButton s `Text` property is declaratively assigned using databinding syntax and includes both the `CategoryName` and `NumberOfProducts` data fields.</span></span> <span data-ttu-id="c9fbf-234">リピータと `CategoriesDataSource` ObjectDataSource の完全な宣言マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-234">The complete declarative markup for the Repeater and the `CategoriesDataSource` ObjectDataSource follow:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample9.aspx)]

<span data-ttu-id="c9fbf-235">`NumberOfProducts` 列を含むように DAL を更新することによって表示される出力は、`ItemDataBound` イベントハンドラーアプローチを使用する場合と同じです (図4を参照して、名前と製品の数を示すリピータのスクリーンショットを参照してください)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-235">The output rendered by updating the DAL to include a `NumberOfProducts` column is the same as using the `ItemDataBound` event handler approach (refer back to Figure 4 to see a screen shot of the Repeater showing the category names and number of products).</span></span>

## <a name="step-3-displaying-the-selected-category-s-products"></a><span data-ttu-id="c9fbf-236">手順 3: 選択したカテゴリの製品を表示する</span><span class="sxs-lookup"><span data-stu-id="c9fbf-236">Step 3: Displaying the Selected Category s Products</span></span>

<span data-ttu-id="c9fbf-237">この時点で、`Categories` リピータは、カテゴリの一覧と各カテゴリの製品数を表示しています。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-237">At this point we have the `Categories` Repeater displaying the list of categories along with the number of products in each category.</span></span> <span data-ttu-id="c9fbf-238">リピータは、各カテゴリに対して LinkButton を使用します。この場合、クリックするとポストバックが発生します。その時点で、選択したカテゴリの製品を `CategoryProducts` DataList に表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-238">The Repeater uses a LinkButton for each category that, when clicked, causes a postback, at which point we need to display those products for the selected category in the `CategoryProducts` DataList.</span></span>

<span data-ttu-id="c9fbf-239">私たちが直面する課題の1つは、DataList に、選択したカテゴリの製品のみが表示されるようにする方法です。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-239">One challenge facing us is how to have the DataList display just those products for the selected category.</span></span> <span data-ttu-id="c9fbf-240">詳細な[detailsview チュートリアルで選択可能なマスター GridView を使用したマスター/詳細](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)では、選択した行の詳細が同じページの DetailsView に表示されている行を含む gridview を作成する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-240">In the [Master/Detail Using a Selectable Master GridView with a Details DetailsView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial we saw how to build a GridView whose rows could be selected, with the selected row s details being displayed in a DetailsView on the same page.</span></span> <span data-ttu-id="c9fbf-241">GridView は、`ProductsBLL` s `GetProducts()` メソッドを使用してすべての製品に関する情報を返しましたが、DetailsView は `GetProductsByProductID(productID)` メソッドを使用して選択された製品に関する情報を取得しました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-241">The GridView s ObjectDataSource returned information about all products using the `ProductsBLL` s `GetProducts()` method while the DetailsView s ObjectDataSource retrieved information about the selected product using the `GetProductsByProductID(productID)` method.</span></span> <span data-ttu-id="c9fbf-242">*`productID`* パラメーター値は、GridView の `SelectedValue` プロパティの値に関連付けて宣言によって指定されました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-242">The *`productID`* parameter value was provided declaratively by associating it with the value of the GridView s `SelectedValue` property.</span></span> <span data-ttu-id="c9fbf-243">残念ながら、リピータには `SelectedValue` プロパティがないため、パラメーターソースとして使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-243">Unfortunately, the Repeater does not have a `SelectedValue` property and cannot serve as a parameter source.</span></span>

> [!NOTE]
> <span data-ttu-id="c9fbf-244">これは、リピータで LinkButton を使用するときに表示される問題の1つです。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-244">This is one of those challenges that appear when using the LinkButton in a Repeater.</span></span> <span data-ttu-id="c9fbf-245">代わりに、ハイパーリンクを使用してクエリ文字列を使用して `CategoryID` を渡すと、そのクエリ文字列フィールドをパラメーター s 値のソースとして使用できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-245">Had we used a hyperlink to pass in the `CategoryID` through the querystring instead, we could use that QueryString field as the source for the parameter s value.</span></span>

<span data-ttu-id="c9fbf-246">ただし、リピータの `SelectedValue` プロパティがないことについて心配する前に、まず DataList を ObjectDataSource にバインドし、その `ItemTemplate`を指定してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-246">Before we worry about the lack of a `SelectedValue` property for the Repeater, though, let s first bind the DataList to an ObjectDataSource and specify its `ItemTemplate`.</span></span>

<span data-ttu-id="c9fbf-247">DataList s スマートタグから、`CategoryProductsDataSource` という名前の新しい ObjectDataSource を追加し、`ProductsBLL` class s `GetProductsByCategoryID(categoryID)` メソッドを使用するように構成します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-247">From the DataList s smart tag, opt to add a new ObjectDataSource named `CategoryProductsDataSource` and configure it to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="c9fbf-248">このチュートリアルの DataList には読み取り専用のインターフェイスが用意されているので、[挿入]、[更新]、および [削除] の各タブのドロップダウンリストを (なし) に自由に設定できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-248">Since the DataList in this tutorial offers a read-only interface, feel free to set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="c9fbf-249">[製品の Bll クラス s Get$ Bycategoryid (categoryID) メソッドを使用するように ObjectDataSource を構成 ![](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-249">[![Configure the ObjectDataSource to Use ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span></span>

<span data-ttu-id="c9fbf-250">**図 12**: `ProductsBLL` クラス s `GetProductsByCategoryID(categoryID)` メソッドを使用するように ObjectDataSource を構成する ([クリックしてフルサイズのイメージを表示する](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="c9fbf-250">**Figure 12**: Configure the ObjectDataSource to Use `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span></span>

<span data-ttu-id="c9fbf-251">`GetProductsByCategoryID(categoryID)` メソッドは入力パラメーター ( *`categoryID`* ) を必要とするため、データソースの構成ウィザードを使用して、パラメーター s Source を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-251">Since the `GetProductsByCategoryID(categoryID)` method expects an input parameter (*`categoryID`*), the Configure Data Source wizard allows us to specify the parameter s source.</span></span> <span data-ttu-id="c9fbf-252">GridView または DataList にカテゴリが一覧表示されているので、[パラメーターのソース] ドロップダウンリストを [制御] に設定し、ControlID をデータ Web コントロールの `ID` に設定します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-252">Had the categories been listed in a GridView or a DataList, we d set the Parameter source drop-down list to Control and the ControlID to the `ID` of the data Web control.</span></span> <span data-ttu-id="c9fbf-253">ただし、リピータには `SelectedValue` プロパティがないため、パラメーターソースとして使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-253">However, since the Repeater lacks a `SelectedValue` property it cannot be used as a parameter source.</span></span> <span data-ttu-id="c9fbf-254">このチェックボックスをオンにすると、[ControlID] ドロップダウンリストには、DataList の `ID` であるコントロール `ID``CategoryProducts`が1つだけ含まれていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-254">If you check, you'll find that the ControlID drop-down list only contains one control `ID``CategoryProducts`, the `ID` of the DataList.</span></span>

<span data-ttu-id="c9fbf-255">ここでは、[パラメーターソース] ドロップダウンリストを [なし] に設定します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-255">For now, set the Parameter source drop-down list to None.</span></span> <span data-ttu-id="c9fbf-256">ここでは、Repeater でカテゴリ LinkButton がクリックされたときに、プログラムによってこのパラメーター値を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-256">We'll end up programmatically assigning this parameter value when a category LinkButton is clicked in the Repeater.</span></span>

<span data-ttu-id="c9fbf-257">[categoryID パラメーターのパラメーターソースを指定し ![](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-257">[![Do Not Specify a Parameter Source for the categoryID Parameter](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span></span>

<span data-ttu-id="c9fbf-258">**図 13**: *`categoryID`* パラメーターのパラメーターソースを指定しない ([クリックしてフルサイズのイメージを表示する](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="c9fbf-258">**Figure 13**: Do Not Specify a Parameter Source for the *`categoryID`* Parameter ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span></span>

<span data-ttu-id="c9fbf-259">データソースの構成ウィザードを完了すると、Visual Studio によって DataList s `ItemTemplate`が自動生成されます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-259">After completing the Configure Data Source wizard, Visual Studio auto-generates the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="c9fbf-260">この既定の `ItemTemplate` を、前のチュートリアルで使用したテンプレートに置き換えます。また、[DataList s `RepeatColumns`] プロパティを [2] に設定します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-260">Replace this default `ItemTemplate` with the template we used in the preceding tutorial; also, set the DataList s `RepeatColumns` property to 2.</span></span> <span data-ttu-id="c9fbf-261">これらの変更を行った後、DataList の宣言型マークアップとそれに関連付けられている ObjectDataSource は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-261">After making these changes the declarative markup for your DataList and its associated ObjectDataSource should look like the following:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample10.aspx)]

<span data-ttu-id="c9fbf-262">現時点では、`CategoryProductsDataSource` ObjectDataSource s *`categoryID`* パラメーターは設定されていないため、ページを表示するときに製品は表示されません。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-262">Currently, the `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* parameter is never set, so no products are displayed when viewing the page.</span></span> <span data-ttu-id="c9fbf-263">このパラメーター値は、リピータでクリックしたカテゴリの `CategoryID` に基づいて設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-263">What we need to do is have this parameter value set based on the `CategoryID` of the clicked category in the Repeater.</span></span> <span data-ttu-id="c9fbf-264">これには2つの課題があります。まず、リピータの `ItemTemplate` がクリックされたタイミングを判断する方法について説明します。次に、LinkButton がクリックされた対応するカテゴリの `CategoryID` を特定するにはどうすればよいでしょうか。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-264">This introduces two challenges: first, how do we determine when a LinkButton in the Repeater s `ItemTemplate` has been clicked; and second, how can we determine the `CategoryID` of the corresponding category whose LinkButton was clicked?</span></span>

<span data-ttu-id="c9fbf-265">ボタンおよび ImageButton コントロールのような LinkButton には、`Click` イベントと[`Command` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx)があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-265">The LinkButton like the Button and ImageButton controls has a `Click` event and a [`Command` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx).</span></span> <span data-ttu-id="c9fbf-266">`Click` イベントは、LinkButton がクリックされたことを確認するために設計されています。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-266">The `Click` event is designed to simply note that the LinkButton has been clicked.</span></span> <span data-ttu-id="c9fbf-267">ただし、LinkButton がクリックされたことを示すだけでなく、イベントハンドラーに追加情報を渡す必要もあります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-267">At times, however, in addition to noting that the LinkButton has been clicked we also need to pass some extra information to the event handler.</span></span> <span data-ttu-id="c9fbf-268">この場合、LinkButton [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx)と[`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx)のプロパティにこの追加情報を割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-268">If this is the case, the LinkButton s [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx) and [`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx) properties can be assigned this extra information.</span></span> <span data-ttu-id="c9fbf-269">次に、LinkButton がクリックされると、その `Command` イベント (`Click` イベントではなく) が発生し、イベントハンドラーに `CommandName` および `CommandArgument` プロパティの値が渡されます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-269">Then, when the LinkButton is clicked, its `Command` event fires (instead of its `Click` event) and the event handler is passed the values of the `CommandName` and `CommandArgument` properties.</span></span>

<span data-ttu-id="c9fbf-270">リピータ内のテンプレート内から `Command` イベントが発生すると、Repeater s [`ItemCommand` イベント](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx)が発生し、クリックされた LinkButton (またはボタンまたは ImageButton) の `CommandName` と `CommandArgument` の値が渡されます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-270">When a `Command` event is raised from within a template in the Repeater, the Repeater s [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx) fires and is passed the `CommandName` and `CommandArgument` values of the clicked LinkButton (or Button or ImageButton).</span></span> <span data-ttu-id="c9fbf-271">そのため、リピータのカテゴリ LinkButton がクリックされたことを確認するには、次の手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-271">Therefore, to determine when a category LinkButton in the Repeater has been clicked, we need to do the following:</span></span>

1. <span data-ttu-id="c9fbf-272">Repeater の `ItemTemplate` にある LinkButton の `CommandName` プロパティを、何らかの値に設定します (ListProducts を使用しました)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-272">Set the `CommandName` property of the LinkButton in the Repeater s `ItemTemplate` to some value (I ve used ListProducts ).</span></span> <span data-ttu-id="c9fbf-273">この `CommandName` 値を設定すると、linkbutton がクリックされたときに LinkButton `Command` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-273">By setting this `CommandName` value, the LinkButton s `Command` event fires when the LinkButton is clicked.</span></span>
2. <span data-ttu-id="c9fbf-274">LinkButton s `CommandArgument` プロパティを、現在の項目の `CategoryID`の値に設定します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-274">Set the LinkButton s `CommandArgument` property to the value of the current item s `CategoryID`.</span></span>
3. <span data-ttu-id="c9fbf-275">Repeater s `ItemCommand` イベントのイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-275">Create an event handler for the Repeater s `ItemCommand` event.</span></span> <span data-ttu-id="c9fbf-276">イベントハンドラーで、`CategoryProductsDataSource` ObjectDataSource s `CategoryID` パラメーターを、渡された `CommandArgument`の値に設定します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-276">In the event handler, set the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span>

<span data-ttu-id="c9fbf-277">次の `ItemTemplate` のカテゴリリピータのマークアップは、手順 1. と 2. を実装しています。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-277">The following `ItemTemplate` markup for the Categories Repeater implements steps 1 and 2.</span></span> <span data-ttu-id="c9fbf-278">Databinding 構文を使用して、データ項目 `CategoryID` に `CommandArgument` 値が割り当てられていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-278">Note how the `CommandArgument` value is assigned the data item s `CategoryID` using databinding syntax:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample11.aspx)]

<span data-ttu-id="c9fbf-279">`ItemCommand` イベントハンドラーを作成する場合は常に、必ず最初に受信 `CommandName` 値を確認することをお勧めします *。これは、Repeater*内の Button、LinkButton、または ImageButton によって発生した `Command`*イベントによっ*て `ItemCommand` イベントが発生するためです。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-279">Whenever creating an `ItemCommand` event handler it is prudent to always first check the incoming `CommandName` value because *any* `Command` event raised by *any* Button, LinkButton, or ImageButton within the Repeater will cause the `ItemCommand` event to fire.</span></span> <span data-ttu-id="c9fbf-280">現在、このような LinkButton は1つしかありませんが、将来 (またはチームの他の開発者) は、Repeater にボタン Web コントロールを追加することがあります。これは、クリックすると同じ `ItemCommand` イベントハンドラーを生成します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-280">While we currently only have one such LinkButton now, in the future we (or another developer on our team) might add additional button Web controls to the Repeater that, when clicked, raises the same `ItemCommand` event handler.</span></span> <span data-ttu-id="c9fbf-281">したがって、常に `CommandName` プロパティをチェックし、予想される値に一致する場合にのみプログラムロジックを続行することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-281">Therefore, it s best to always make sure you check the `CommandName` property and only proceed with your programmatic logic if it matches up to the value expected.</span></span>

<span data-ttu-id="c9fbf-282">渡された `CommandName` 値が ListProducts と等しいことを確認した後、イベントハンドラーは、渡された `CommandArgument`の値に `CategoryProductsDataSource` ObjectDataSource s `CategoryID` パラメーターを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-282">After ensuring that the passed-in `CommandName` value equals ListProducts, the event handler then assigns the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span> <span data-ttu-id="c9fbf-283">ObjectDataSource s `SelectParameters` に対するこの変更により、自動的に DataList が自動的にデータソースに再バインドされ、新しく選択したカテゴリの製品が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-283">This modification to the ObjectDataSource s `SelectParameters` automatically causes the DataList to rebind itself to the data source, showing the products for the newly selected category.</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample12.cs)]

<span data-ttu-id="c9fbf-284">これらの追加により、チュートリアルは完了です。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-284">With these additions, our tutorial is complete!</span></span> <span data-ttu-id="c9fbf-285">ブラウザーでテストしてみましょう。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-285">Take a moment to test it out in a browser.</span></span> <span data-ttu-id="c9fbf-286">図14に、最初にページにアクセスしたときの画面を示します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-286">Figure 14 shows the screen when first visiting the page.</span></span> <span data-ttu-id="c9fbf-287">カテゴリはまだ選択されていないため、製品は表示されません。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-287">Since a category has yet to be selected, no products are displayed.</span></span> <span data-ttu-id="c9fbf-288">[生成] などのカテゴリをクリックすると、それらの製品が2列ビューで製品カテゴリに表示されます (図15を参照)。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-288">Clicking on a category, such as Produce, displays those products in the Product category in a two-column view (see Figure 15).</span></span>

<span data-ttu-id="c9fbf-289">[ページに最初にアクセスしたときに製品が表示されない ![](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-289">[![No Products are Displayed When First Visiting the Page](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span></span>

<span data-ttu-id="c9fbf-290">**図 14**: 最初にページにアクセスしたときに製品が表示されない ([クリックしてフルサイズの画像を表示する](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="c9fbf-290">**Figure 14**: No Products are Displayed When First Visiting the Page ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span></span>

<span data-ttu-id="c9fbf-291">[[生成] カテゴリをクリック ![と、一致する製品が右側に表示されます](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-291">[![Clicking the Produce Category Lists the Matching Products to the Right](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span></span>

<span data-ttu-id="c9fbf-292">**図 15**: [生成] カテゴリをクリックすると、一致する製品が右側に表示されます ([クリックすると、フルサイズの画像が表示](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png)されます)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-292">**Figure 15**: Clicking the Produce Category Lists the Matching Products to the Right ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span></span>

## <a name="summary"></a><span data-ttu-id="c9fbf-293">要約</span><span class="sxs-lookup"><span data-stu-id="c9fbf-293">Summary</span></span>

<span data-ttu-id="c9fbf-294">このチュートリアルと前に説明したように、マスター/詳細レポートは、2つのページ間で分散することも、1つに統合することもできます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-294">As we saw in this tutorial and the preceding one, master/detail reports can be spread out across two pages, or consolidated on one.</span></span> <span data-ttu-id="c9fbf-295">ただし、マスター/詳細レポートを1ページに表示する場合は、ページ上のマスターレコードと詳細レコードのレイアウトを最適化するためのいくつかの課題が生じます。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-295">Displaying a master/details report on a single page, however, introduces some challenges on how best to layout the master and details records on the page.</span></span> <span data-ttu-id="c9fbf-296">詳細な DetailsView チュートリアルがある*選択可能なマスター GridView を使用したマスター/詳細*では、マスターレコードの上に詳細レコードが表示されていました。このチュートリアルでは、CSS の手法を使用して、マスターレコードを詳細の左側にフローティングしました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-296">In the *Master/Detail Using a Selectable Master GridView with a Details DetailsView* tutorial we had the details records appear above the master records; in this tutorial we used CSS techniques to have the master records float to the left of the details.</span></span>

<span data-ttu-id="c9fbf-297">マスター/詳細レポートの表示と共に、各カテゴリに関連付けられている製品の数を取得する方法に加えて、LinkButton (またはボタンまたは ImageButton) がリピータ内からクリックされたときにサーバー側のロジックを実行する方法についても説明しました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-297">Along with displaying master/details reports, we also had the opportunity to explore how to retrieve the number of products associated with each category as well as how to perform server-side logic when a LinkButton (or Button or ImageButton) is clicked from within a Repeater.</span></span>

<span data-ttu-id="c9fbf-298">このチュートリアルでは、DataList と Repeater を使用したマスター/詳細レポートの検査を完了します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-298">This tutorial completes our examination of master/detail reports with the DataList and Repeater.</span></span> <span data-ttu-id="c9fbf-299">次の一連のチュートリアルでは、DataList コントロールに編集機能と削除機能を追加する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-299">Our next set of tutorials will illustrate how to add editing and deleting capabilities to the DataList control.</span></span>

<span data-ttu-id="c9fbf-300">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-300">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="c9fbf-301">関連項目</span><span class="sxs-lookup"><span data-stu-id="c9fbf-301">Further Reading</span></span>

<span data-ttu-id="c9fbf-302">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-302">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="c9fbf-303">CSS を使用したフローティング CSS 要素に関するチュートリアルの[Floatutorial](http://css.maxdesign.com.au/floatutorial/)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/) a tutorial on floating CSS elements with CSS</span></span>
- <span data-ttu-id="c9fbf-304">[Css で](http://www.brainjar.com/css/positioning/)の要素の配置の詳細については、「css」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-304">[CSS Positioning](http://www.brainjar.com/css/positioning/) more information on positioning elements with CSS</span></span>
- <span data-ttu-id="c9fbf-305">`<table>` s とその他の HTML 要素を使用して配置するための[html を使用したコンテンツのレイアウト](http://www.w3schools.com/html/html_layout.asp)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-305">[Laying Out Content with HTML](http://www.w3schools.com/html/html_layout.asp) using `<table>` s and other HTML elements for positioning</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c9fbf-306">作成者について</span><span class="sxs-lookup"><span data-stu-id="c9fbf-306">About the Author</span></span>

<span data-ttu-id="c9fbf-307">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c9fbf-308">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c9fbf-309">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c9fbf-310">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="c9fbf-311">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="c9fbf-312">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-312">Special Thanks To</span></span>

<span data-ttu-id="c9fbf-313">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-313">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c9fbf-314">このチュートリアルのリードレビューアーは Zack Jones でした。</span><span class="sxs-lookup"><span data-stu-id="c9fbf-314">Lead reviewer for this tutorial was Zack Jones.</span></span> <span data-ttu-id="c9fbf-315">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="c9fbf-315">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c9fbf-316">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-316">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c9fbf-317">[前へ](master-detail-filtering-acess-two-pages-datalist-cs.md)
> [次へ](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c9fbf-317">[Previous](master-detail-filtering-acess-two-pages-datalist-cs.md)
[Next](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span></span>
