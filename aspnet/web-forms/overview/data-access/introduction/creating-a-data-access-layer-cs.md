---
uid: web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
title: データアクセス層 (C#) を作成するMicrosoft Docs
author: rick-anderson
description: このチュートリアルでは、最初から開始し、型指定されたデータセットを使用してデータアクセス層 (DAL) を作成し、データベース内の情報にアクセスします。
ms.author: riande
ms.date: 04/05/2010
ms.assetid: cfe2a6a0-1e56-4dc8-9537-c8ec76ba96a4
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 5aaf97dc8448dcb7b94ef2e4e23f34fd37ac4426
ms.sourcegitcommit: 6f0e10e4ca61a1e5534b09c655fd35cdc6886c8a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/15/2019
ms.locfileid: "74115249"
---
# <a name="creating-a-data-access-layer-c"></a><span data-ttu-id="56f5c-103">データ アクセス層を作成する (C#)</span><span class="sxs-lookup"><span data-stu-id="56f5c-103">Creating a Data Access Layer (C#)</span></span>

<span data-ttu-id="56f5c-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="56f5c-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

[<span data-ttu-id="56f5c-105">PDF のダウンロード</span><span class="sxs-lookup"><span data-stu-id="56f5c-105">Download PDF</span></span>](creating-a-data-access-layer-cs/_static/datatutorial01cs1.pdf)

> <span data-ttu-id="56f5c-106">このチュートリアルでは、最初から開始し、型指定されたデータセットを使用してデータアクセス層 (DAL) を作成し、データベース内の情報にアクセスします。</span><span class="sxs-lookup"><span data-stu-id="56f5c-106">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), using typed DataSets, to access the information in a database.</span></span>

## <a name="introduction"></a><span data-ttu-id="56f5c-107">概要</span><span class="sxs-lookup"><span data-stu-id="56f5c-107">Introduction</span></span>

<span data-ttu-id="56f5c-108">Web 開発者として、データの操作を中心にしています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-108">As web developers, our lives revolve around working with data.</span></span> <span data-ttu-id="56f5c-109">データを格納するデータベース、データを取得および変更するコード、収集して集計するための web ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-109">We create databases to store the data, code to retrieve and modify it, and web pages to collect and summarize it.</span></span> <span data-ttu-id="56f5c-110">これは、ASP.NET 2.0 でこれらの共通パターンを実装するための手法を紹介する、長いシリーズの最初のチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="56f5c-110">This is the first tutorial in a lengthy series that will explore techniques for implementing these common patterns in ASP.NET 2.0.</span></span> <span data-ttu-id="56f5c-111">まず、型指定されたデータセットを使用するデータアクセス層 (DAL)、カスタムビジネスルールを適用するビジネスロジック層 (BLL)、および共通ページレイアウトを共有する ASP.NET ページで構成されるプレゼンテーション層で構成される[ソフトウェアアーキテクチャ](http://en.wikipedia.org/wiki/Software_architecture)の作成から始めます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-111">We'll start with creating a [software architecture](http://en.wikipedia.org/wiki/Software_architecture) composed of a Data Access Layer (DAL) using Typed DataSets, a Business Logic Layer (BLL) that enforces custom business rules, and a presentation layer composed of ASP.NET pages that share a common page layout.</span></span> <span data-ttu-id="56f5c-112">このバックエンドの基礎を説明した後、レポートを作成し、web アプリケーションのデータを表示、要約、収集、検証する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-112">Once this backend groundwork has been laid, we'll move into reporting, showing how to display, summarize, collect, and validate data from a web application.</span></span> <span data-ttu-id="56f5c-113">これらのチュートリアルは簡潔にすることを目的としており、プロセスを視覚的に説明するためのさまざまなスクリーンショットを含む詳細な手順を説明しています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-113">These tutorials are geared to be concise and provide step-by-step instructions with plenty of screen shots to walk you through the process visually.</span></span> <span data-ttu-id="56f5c-114">各チュートリアルは、およびC# Visual Basic バージョンで使用でき、使用されている完全なコードのダウンロードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-114">Each tutorial is available in C# and Visual Basic versions and includes a download of the complete code used.</span></span> <span data-ttu-id="56f5c-115">(この最初のチュートリアルでは非常に時間がかかりますが、残りの部分はより多くの消化チャンクで示されています)。</span><span class="sxs-lookup"><span data-stu-id="56f5c-115">(This first tutorial is quite lengthy, but the rest are presented in much more digestible chunks.)</span></span>

<span data-ttu-id="56f5c-116">これらのチュートリアルでは、**アプリ\_データ**ディレクトリに配置されている Microsoft SQL Server 2005 Express Edition バージョンの Northwind データベースを使用します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-116">For these tutorials we'll be using a Microsoft SQL Server 2005 Express Edition version of the Northwind database placed in the **App\_Data** directory.</span></span> <span data-ttu-id="56f5c-117">データベースファイルに加えて、 **App\_Data**フォルダーには、別のデータベースバージョンを使用する場合に備えて、データベースを作成するための SQL スクリプトも含まれています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-117">In addition to the database file, the **App\_Data** folder also contains the SQL scripts for creating the database, in case you want to use a different database version.</span></span> <span data-ttu-id="56f5c-118">これらのスクリプトは、必要に応じて[Microsoft から直接ダウンロード](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)することもできます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-118">These scripts can be also be [downloaded directly from Microsoft](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en), if you'd prefer.</span></span> <span data-ttu-id="56f5c-119">別の SQL Server バージョンの Northwind データベースを使用する場合は、アプリケーションの**web.config**ファイルの**NORTHWNDConnectionString**設定を更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-119">If you use a different SQL Server version of the Northwind database, you will need to update the **NORTHWNDConnectionString** setting in the application's **Web.config** file.</span></span> <span data-ttu-id="56f5c-120">Web アプリケーションは、Visual Studio 2005 Professional Edition をファイルシステムベースの Web サイトプロジェクトとして使用して構築されました。</span><span class="sxs-lookup"><span data-stu-id="56f5c-120">The web application was built using Visual Studio 2005 Professional Edition as a file system-based Web site project.</span></span> <span data-ttu-id="56f5c-121">ただし、すべてのチュートリアルは、Visual Studio 2005、 [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/)の無料版でも同様に機能します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-121">However, all of the tutorials will work equally well with the free version of Visual Studio 2005, [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/).</span></span>  
  
<span data-ttu-id="56f5c-122">このチュートリアルでは、最初から開始し、データアクセス層 (DAL) を作成します。次に、2番目のチュートリアルでビジネスロジック層 (BLL) を作成し、3番目のページレイアウトとナビゲーションを操作します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-122">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), followed by creating the Business Logic Layer (BLL) in the second tutorial, and working on page layout and navigation in the third.</span></span> <span data-ttu-id="56f5c-123">3番目のチュートリアルの後のチュートリアルは、最初の3つの基盤に基づいて構築されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-123">The tutorials after the third one will build upon the foundation laid in the first three.</span></span> <span data-ttu-id="56f5c-124">この最初のチュートリアルでは詳しく説明しているので、Visual Studio を起動して始めましょう。</span><span class="sxs-lookup"><span data-stu-id="56f5c-124">We've got a lot to cover in this first tutorial, so fire up Visual Studio and let's get started!</span></span>

## <a name="step-1-creating-a-web-project-and-connecting-to-the-database"></a><span data-ttu-id="56f5c-125">手順 1: Web プロジェクトの作成とデータベースへの接続</span><span class="sxs-lookup"><span data-stu-id="56f5c-125">Step 1: Creating a Web Project and Connecting to the Database</span></span>

<span data-ttu-id="56f5c-126">データアクセス層 (DAL) を作成するには、まず web サイトを作成し、データベースをセットアップする必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-126">Before we can create our Data Access Layer (DAL), we first need to create a web site and setup our database.</span></span> <span data-ttu-id="56f5c-127">まず、新しいファイルシステムベースの ASP.NET web サイトを作成します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-127">Start by creating a new file system-based ASP.NET web site.</span></span> <span data-ttu-id="56f5c-128">これを行うには、[ファイル] メニューの [新しい Web サイト] をクリックし、[新しい Web サイト] ダイアログボックスを表示します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-128">To accomplish this, go to the File menu and choose New Web Site, displaying the New Web Site dialog box.</span></span> <span data-ttu-id="56f5c-129">ASP.NET Web サイトテンプレートを選択し、[場所] ドロップダウンリストを [ファイルシステム] に設定して、Web サイトを配置するフォルダーを選択C#し、言語をに設定します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-129">Choose the ASP.NET Web Site template, set the Location drop-down list to File System, choose a folder to place the web site, and set the language to C#.</span></span>

<span data-ttu-id="56f5c-130">[新しいファイルシステムベースの Web サイトを作成 ![には](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-130">[![Create a New File System-Based Web Site](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span></span>

<span data-ttu-id="56f5c-131">**図 1**: 新しいファイルシステムベースの Web サイトを作成[する (クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-131">**Figure 1**: Create a New File System-Based Web Site ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image3.png))</span></span>

<span data-ttu-id="56f5c-132">これにより、 **default.aspx** ASP.NET ページと**App\_Data**フォルダーを使用して新しい web サイトが作成されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-132">This will create a new web site with a **Default.aspx** ASP.NET page and an **App\_Data** folder.</span></span>

<span data-ttu-id="56f5c-133">Web サイトが作成されたので、次の手順では、Visual Studio のサーバーエクスプローラーでデータベースへの参照を追加します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-133">With the web site created, the next step is to add a reference to the database in Visual Studio's Server Explorer.</span></span> <span data-ttu-id="56f5c-134">サーバーエクスプローラーにデータベースを追加することで、Visual Studio 内からテーブル、ストアドプロシージャ、ビューなどを追加できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-134">By adding a database to the Server Explorer you can add tables, stored procedures, views, and so on all from within Visual Studio.</span></span> <span data-ttu-id="56f5c-135">また、クエリビルダーを使用して、テーブルデータを表示したり、独自のクエリを作成したりすることもできます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-135">You can also view table data or create your own queries either by hand or graphically via the Query Builder.</span></span> <span data-ttu-id="56f5c-136">さらに、DAL 用に型指定されたデータセットを作成する場合は、型指定されたデータセットを構築するデータベースを Visual Studio にポイントする必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-136">Furthermore, when we build the Typed DataSets for the DAL we'll need to point Visual Studio to the database from which the Typed DataSets should be constructed.</span></span> <span data-ttu-id="56f5c-137">この接続情報はその時点で提供できますが、Visual Studio では、サーバーエクスプローラーに既に登録されているデータベースのドロップダウンリストが自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-137">While we can provide this connection information at that point in time, Visual Studio automatically populates a drop-down list of the databases already registered in the Server Explorer.</span></span>

<span data-ttu-id="56f5c-138">Northwind データベースをサーバーエクスプローラーに追加する手順は、**アプリ\_Data**フォルダーで SQL Server 2005 Express Edition データベースを使用するかどうか、または代わりに使用する Microsoft SQL Server 2000 または2005データベースサーバーのセットアップがあるかどうかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-138">The steps for adding the Northwind database to the Server Explorer depend on whether you want to use the SQL Server 2005 Express Edition database in the **App\_Data** folder or if you have a Microsoft SQL Server 2000 or 2005 database server setup that you want to use instead.</span></span>

## <a name="using-a-database-in-the-app_data-folder"></a><span data-ttu-id="56f5c-139">App\_Data フォルダー内のデータベースの使用</span><span class="sxs-lookup"><span data-stu-id="56f5c-139">Using a Database in the App\_Data Folder</span></span>

<span data-ttu-id="56f5c-140">接続する SQL Server 2000 または2005データベースサーバーがない場合、または単にデータベースサーバーにデータベースを追加する必要がない場合は、ダウンロードした web サイトの**アプリ\_データ**フォルダー (northwnd.mdf) にある SQL Server 2005 Express Edition バージョンの Northwind データベースを使用でき**ます。MDF**)。</span><span class="sxs-lookup"><span data-stu-id="56f5c-140">If you do not have a SQL Server 2000 or 2005 database server to connect to, or you simply want to avoid having to add the database to a database server, you can use the SQL Server 2005 Express Edition version of the Northwind database that is located in the downloaded website's **App\_Data** folder (**NORTHWND.MDF**).</span></span>

<span data-ttu-id="56f5c-141">**App\_Data**フォルダーに配置されたデータベースがサーバーエクスプローラーに自動的に追加されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-141">A database placed in the **App\_Data** folder is automatically added to the Server Explorer.</span></span> <span data-ttu-id="56f5c-142">コンピューターに SQL Server 2005 Express Edition がインストールされていると仮定すると、NORTHWND.MDF という名前のノードが表示されます。サーバーエクスプローラーの MDF。テーブル、ビュー、ストアドプロシージャなどを展開し、探索することができます (図2を参照)。</span><span class="sxs-lookup"><span data-stu-id="56f5c-142">Assuming you have SQL Server 2005 Express Edition installed on your machine you should see a node named NORTHWND.MDF in the Server Explorer, which you can expand and explore its tables, views, stored procedure, and so on (see Figure 2).</span></span>

<span data-ttu-id="56f5c-143">**アプリの\_データ**フォルダーには、Microsoft access の **.mdb**ファイルも保持できます。このファイルは、対応する SQL Server と同様に、サーバーエクスプローラーに自動的に追加されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-143">The **App\_Data** folder can also hold Microsoft Access **.mdb** files, which, like their SQL Server counterparts, are automatically added to the Server Explorer.</span></span> <span data-ttu-id="56f5c-144">SQL Server オプションを使用しない場合は、常に[Microsoft access バージョンの Northwind データベースファイルをダウンロード](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN)して、**アプリの\_データ**ディレクトリにドロップできます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-144">If you don't want to use any of the SQL Server options, you can always [download a Microsoft Access version of the Northwind database file](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN) and drop into the **App\_Data** directory.</span></span> <span data-ttu-id="56f5c-145">ただし、Access データベースは SQL Server ほど機能が豊富ではなく、web サイトのシナリオで使用するように設計されていないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="56f5c-145">Keep in mind, however, that Access databases aren't as feature-rich as SQL Server, and aren't designed to be used in web site scenarios.</span></span> <span data-ttu-id="56f5c-146">さらに、35以上のチュートリアルでは、Access でサポートされていないデータベースレベルの機能がいくつか使用されています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-146">Furthermore, a couple of the 35+ tutorials will utilize certain database-level features that aren't supported by Access.</span></span>

## <a name="connecting-to-the-database-in-a-microsoft-sql-server-2000-or-2005-database-server"></a><span data-ttu-id="56f5c-147">Microsoft SQL Server 2000 または2005データベースサーバーでのデータベースへの接続</span><span class="sxs-lookup"><span data-stu-id="56f5c-147">Connecting to the Database in a Microsoft SQL Server 2000 or 2005 Database Server</span></span>

<span data-ttu-id="56f5c-148">または、データベースサーバーにインストールされている Northwind データベースに接続することもできます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-148">Alternatively, you may connect to a Northwind database installed on a database server.</span></span> <span data-ttu-id="56f5c-149">データベースサーバーに Northwind データベースがまだインストールされていない場合は、まず、このチュートリアルのダウンロードに含まれているインストールスクリプトを実行するか、 [northwind およびインストールスクリプトの SQL Server 2000 バージョン](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)を Microsoft の web サイトから直接ダウンロードして、データベースサーバーに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-149">If the database server does not already have the Northwind database installed, you first must add it to database server by running the installation script included in this tutorial's download or by [downloading the SQL Server 2000 version of Northwind and installation script](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en) directly from Microsoft's web site.</span></span>

<span data-ttu-id="56f5c-150">データベースがインストールされたら、Visual Studio のサーバーエクスプローラーにアクセスし、[データ接続] ノードを右クリックして、[接続の追加] を選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-150">Once you have the database installed, go to the Server Explorer in Visual Studio, right-click on the Data Connections node, and choose Add Connection.</span></span> <span data-ttu-id="56f5c-151">サーバーエクスプローラーが表示されない場合は、ビューまたはサーバーエクスプローラーにアクセスするか、Ctrl + Alt + S キーを押します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-151">If you don't see the Server Explorer go to the View / Server Explorer, or hit Ctrl+Alt+S.</span></span> <span data-ttu-id="56f5c-152">[接続の追加] ダイアログボックスが表示されます。このダイアログボックスでは、接続先のサーバー、認証情報、およびデータベース名を指定できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-152">This will bring up the Add Connection dialog box, where you can specify the server to connect to, the authentication information, and the database name.</span></span> <span data-ttu-id="56f5c-153">データベース接続情報を正しく構成し、[OK] ボタンをクリックすると、データベースは [データ接続] ノードの下にノードとして追加されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-153">Once you have successfully configured the database connection information and clicked the OK button, the database will be added as a node underneath the Data Connections node.</span></span> <span data-ttu-id="56f5c-154">データベースノードを展開して、テーブル、ビュー、ストアドプロシージャなどを調べることができます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-154">You can expand the database node to explore its tables, views, stored procedures, and so on.</span></span>

![データベースサーバーの Northwind データベースに接続を追加する](creating-a-data-access-layer-cs/_static/image4.png)

<span data-ttu-id="56f5c-156">**図 2**: データベースサーバーの Northwind データベースに接続を追加する</span><span class="sxs-lookup"><span data-stu-id="56f5c-156">**Figure 2**: Add a Connection to Your Database Server's Northwind Database</span></span>

## <a name="step-2-creating-the-data-access-layer"></a><span data-ttu-id="56f5c-157">手順 2: データアクセス層の作成</span><span class="sxs-lookup"><span data-stu-id="56f5c-157">Step 2: Creating the Data Access Layer</span></span>

<span data-ttu-id="56f5c-158">データを操作する場合は、データ固有のロジックをプレゼンテーション層に直接埋め込む方法があります (web アプリケーションでは、ASP.NET ページがプレゼンテーション層を構成します)。</span><span class="sxs-lookup"><span data-stu-id="56f5c-158">When working with data one option is to embed the data-specific logic directly into the presentation layer (in a web application, the ASP.NET pages make up the presentation layer).</span></span> <span data-ttu-id="56f5c-159">これは、ASP.NET ページのコード部分で ADO.NET コードを記述したり、マークアップ部分からの SqlDataSource コントロールを使用したりすることがあります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-159">This may take the form of writing ADO.NET code in the ASP.NET page's code portion or using the SqlDataSource control from the markup portion.</span></span> <span data-ttu-id="56f5c-160">どちらの場合も、この方法を使用すると、データアクセスロジックがプレゼンテーション層と緊密に結合されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-160">In either case, this approach tightly couples the data access logic with the presentation layer.</span></span> <span data-ttu-id="56f5c-161">ただし、データアクセスロジックをプレゼンテーション層から分離することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="56f5c-161">The recommended approach, however, is to separate the data access logic from the presentation layer.</span></span> <span data-ttu-id="56f5c-162">この分離レイヤーは、データアクセス層として使用され、略して DAL は、通常、別個のクラスライブラリプロジェクトとして実装されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-162">This separate layer is referred to as the Data Access Layer, DAL for short, and is typically implemented as a separate Class Library project.</span></span> <span data-ttu-id="56f5c-163">この多層アーキテクチャのメリットについては、このチュートリアルの最後にある「詳細情報」セクションを参照してください。これらの利点については、このシリーズで説明します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-163">The benefits of this layered architecture are well documented (see the "Further Readings" section at the end of this tutorial for information on these advantages) and is the approach we will take in this series.</span></span>

<span data-ttu-id="56f5c-164">データベースへの接続の作成、 **SELECT**、 **INSERT**、 **UPDATE**、および**DELETE**コマンドの発行など、基になるデータソースに固有のすべてのコードは、DAL に配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-164">All code that is specific to the underlying data source such as creating a connection to the database, issuing **SELECT**, **INSERT**, **UPDATE**, and **DELETE** commands, and so on should be located in the DAL.</span></span> <span data-ttu-id="56f5c-165">プレゼンテーション層には、このようなデータアクセスコードへの参照を含めないでください。ただし、すべてのデータ要求に対して DAL を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-165">The presentation layer should not contain any references to such data access code, but should instead make calls into the DAL for any and all data requests.</span></span> <span data-ttu-id="56f5c-166">通常、データアクセス層には、基になるデータベースデータにアクセスするためのメソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-166">Data Access Layers typically contain methods for accessing the underlying database data.</span></span> <span data-ttu-id="56f5c-167">たとえば、Northwind データベースには、販売用の製品とそれが属するカテゴリを記録する**products**テーブルと**categories**テーブルがあります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-167">The Northwind database, for example, has **Products** and **Categories** tables that record the products for sale and the categories to which they belong.</span></span> <span data-ttu-id="56f5c-168">この DAL では、次のような方法があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-168">In our DAL we will have methods like:</span></span>

- <span data-ttu-id="56f5c-169">**GetCategories ()。** すべてのカテゴリに関する情報が返されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-169">**GetCategories(),** which will return information about all of the categories</span></span>
- <span data-ttu-id="56f5c-170">**Getproducts ()。** すべての製品に関する情報が返されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-170">**GetProducts()**, which will return information about all of the products</span></span>
- <span data-ttu-id="56f5c-171">**Getproducts Bycategoryid (*categoryid*)。** 指定されたカテゴリに属するすべての製品を返します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-171">**GetProductsByCategoryID(*categoryID*)**, which will return all products that belong to a specified category</span></span>
- <span data-ttu-id="56f5c-172">**Getproductbyproductid (*productid*)。** 特定の製品に関する情報を返します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-172">**GetProductByProductID(*productID*)**, which will return information about a particular product</span></span>

<span data-ttu-id="56f5c-173">これらのメソッドは、呼び出されると、データベースに接続し、適切なクエリを発行して、結果を返します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-173">These methods, when invoked, will connect to the database, issue the appropriate query, and return the results.</span></span> <span data-ttu-id="56f5c-174">これらの結果を返す方法は重要です。</span><span class="sxs-lookup"><span data-stu-id="56f5c-174">How we return these results is important.</span></span> <span data-ttu-id="56f5c-175">これらのメソッドは、単にデータベースクエリによって設定されたデータセットまたは DataReader を返すことができますが、これらの結果は、*厳密に型指定*されたオブジェクトを使用して返す必要があります</span><span class="sxs-lookup"><span data-stu-id="56f5c-175">These methods could simply return a DataSet or DataReader populated by the database query, but ideally these results should be returned using *strongly-typed objects*.</span></span> <span data-ttu-id="56f5c-176">厳密に型指定されたオブジェクトとは、コンパイル時にスキーマが厳格に定義されているオブジェクトのことです。一方、弱い型指定のオブジェクトとは、スキーマが実行時までわからないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-176">A strongly-typed object is one whose schema is rigidly defined at compile time, whereas the opposite, a loosely-typed object, is one whose schema is not known until runtime.</span></span>

<span data-ttu-id="56f5c-177">たとえば、DataReader とデータセット (既定では) は、値の設定に使用されるデータベースクエリによって返される列によってスキーマが定義されているため、疎に型指定されたオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="56f5c-177">For example, the DataReader and the DataSet (by default) are loosely-typed objects since their schema is defined by the columns returned by the database query used to populate them.</span></span> <span data-ttu-id="56f5c-178">疎型の DataTable から特定の列にアクセスするには、次のような構文を使用する必要があります。  <strong><em>datatable</em>です。Rows [<em>index</em>] ["<em>columnName</em>"]</strong>。</span><span class="sxs-lookup"><span data-stu-id="56f5c-178">To access a particular column from a loosely-typed DataTable we need to use syntax like: <strong><em>DataTable</em>.Rows[<em>index</em>]["<em>columnName</em>"]</strong>.</span></span> <span data-ttu-id="56f5c-179">この例では、DataTable の厳密な型指定は、文字列または序数のインデックスを使用して列名にアクセスする必要があることを示しています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-179">The DataTable's loose typing in this example is exhibited by the fact that we need to access the column name using a string or ordinal index.</span></span> <span data-ttu-id="56f5c-180">一方、厳密に型指定された DataTable では、それぞれの列がプロパティとして実装され、次のようなコードが作成さ<strong>れます。行 [<em>インデックス</em>]。*columnName</strong>* 。</span><span class="sxs-lookup"><span data-stu-id="56f5c-180">A strongly-typed DataTable, on the other hand, will have each of its columns implemented as properties, resulting in code that looks like: <strong><em>DataTable</em>.Rows[<em>index</em>].*columnName</strong>*.</span></span>

<span data-ttu-id="56f5c-181">厳密に型指定されたオブジェクトを返すために、開発者は独自のカスタムビジネスオブジェクトを作成したり、型指定されたデータセットを使用したりできます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-181">To return strongly-typed objects, developers can either create their own custom business objects or use Typed DataSets.</span></span> <span data-ttu-id="56f5c-182">ビジネスオブジェクトは、ビジネスオブジェクトが表す基になるデータベーステーブルの列をプロパティに反映するクラスとして、開発者によって実装されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-182">A business object is implemented by the developer as a class whose properties typically reflect the columns of the underlying database table the business object represents.</span></span> <span data-ttu-id="56f5c-183">型指定されたデータセットは、データベーススキーマに基づいて Visual Studio によって生成されるクラスであり、そのメンバーはこのスキーマに従って厳密に型指定されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-183">A Typed DataSet is a class generated for you by Visual Studio based on a database schema and whose members are strongly-typed according to this schema.</span></span> <span data-ttu-id="56f5c-184">型指定されたデータセット自体は、ADO.NET データセット、DataTable、および DataRow クラスを拡張するクラスで構成されています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-184">The Typed DataSet itself consists of classes that extend the ADO.NET DataSet, DataTable, and DataRow classes.</span></span> <span data-ttu-id="56f5c-185">厳密に型指定された Datatable に加えて、型指定されたデータセットには Tableadapter も含まれるようになりました。 Tableadapter は、データセットの Datatable にデータを格納し、Datatable 内の変更をデータベースに反映するためのメソッドを持つクラスです。</span><span class="sxs-lookup"><span data-stu-id="56f5c-185">In addition to strongly-typed DataTables, Typed DataSets now also include TableAdapters, which are classes with methods for populating the DataSet's DataTables and propagating modifications within the DataTables back to the database.</span></span>

> [!NOTE]
> <span data-ttu-id="56f5c-186">型指定されたデータセットを使用する場合とカスタムビジネスオブジェクトを使用する場合の長所と短所の詳細については、「[データ層コンポーネントの設計」および「階層を介したデータの引き渡し](https://msdn.microsoft.com/library/ms978496.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="56f5c-186">For more information on the advantages and disadvantages of using Typed DataSets versus custom business objects, refer to [Designing Data Tier Components and Passing Data Through Tiers](https://msdn.microsoft.com/library/ms978496.aspx).</span></span>

<span data-ttu-id="56f5c-187">これらのチュートリアルのアーキテクチャには、厳密に型指定されたデータセットを使用します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-187">We'll use strongly-typed DataSets for these tutorials' architecture.</span></span> <span data-ttu-id="56f5c-188">図3は、型指定されたデータセットを使用するアプリケーションのさまざまな層間のワークフローを示しています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-188">Figure 3 illustrates the workflow between the different layers of an application that uses Typed DataSets.</span></span>

<span data-ttu-id="56f5c-189">[すべてのデータアクセスコードが DAL に作業 ![](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-189">[![All Data Access Code is Relegated to the DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span></span>

<span data-ttu-id="56f5c-190">**図 3**: すべてのデータアクセスコードが DAL に作業 ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image7.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-190">**Figure 3**: All Data Access Code is Relegated to the DAL ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image7.png))</span></span>

## <a name="creating-a-typed-dataset-and-table-adapter"></a><span data-ttu-id="56f5c-191">型指定されたデータセットとテーブルアダプターの作成</span><span class="sxs-lookup"><span data-stu-id="56f5c-191">Creating a Typed DataSet and Table Adapter</span></span>

<span data-ttu-id="56f5c-192">DAL の作成を開始するには、まず、型指定されたデータセットをプロジェクトに追加します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-192">To begin creating our DAL, we start by adding a Typed DataSet to our project.</span></span> <span data-ttu-id="56f5c-193">これを行うには、ソリューションエクスプローラーでプロジェクトノードを右クリックし、[新しい項目の追加] を選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-193">To accomplish this, right-click on the project node in the Solution Explorer and choose Add a New Item.</span></span> <span data-ttu-id="56f5c-194">テンプレートの一覧から [データセット] オプションを選択し、「 **Northwind. xsd**」という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-194">Select the DataSet option from the list of templates and name it **Northwind.xsd**.</span></span>

<span data-ttu-id="56f5c-195">[新しいデータセットをプロジェクトに追加することを選択 ![](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-195">[![Choose to Add a New DataSet to Your Project](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span></span>

<span data-ttu-id="56f5c-196">**図 4**: プロジェクトに新しいデータセットを追加することを選択する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image10.png)される)</span><span class="sxs-lookup"><span data-stu-id="56f5c-196">**Figure 4**: Choose to Add a New DataSet to Your Project ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image10.png))</span></span>

<span data-ttu-id="56f5c-197">[追加] をクリックした後、データセットを**アプリ\_コード**フォルダーに追加するよう求められたら、[はい] を選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-197">After clicking Add, when prompted to add the DataSet to the **App\_Code** folder, choose Yes.</span></span> <span data-ttu-id="56f5c-198">次に、型指定されたデータセットのデザイナーが表示され、TableAdapter 構成ウィザードが開始されます。これにより、最初の TableAdapter を型指定されたデータセットに追加できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-198">The Designer for the Typed DataSet will then be displayed, and the TableAdapter Configuration Wizard will start, allowing you to add your first TableAdapter to the Typed DataSet.</span></span>

<span data-ttu-id="56f5c-199">型指定されたデータセットは、厳密に型指定されたデータのコレクションとして機能します。これは、厳密に型指定された DataTable インスタンスで構成されており、それぞれが厳密に型指定された DataRow インスタンスで構成されています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-199">A Typed DataSet serves as a strongly-typed collection of data; it is composed of strongly-typed DataTable instances, each of which is in turn composed of strongly-typed DataRow instances.</span></span> <span data-ttu-id="56f5c-200">ここでは、このチュートリアルシリーズで使用する必要がある基になるデータベーステーブルごとに、厳密に型指定された DataTable を作成します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-200">We will create a strongly-typed DataTable for each of the underlying database tables that we need to work with in this tutorials series.</span></span> <span data-ttu-id="56f5c-201">**Products**テーブルの DataTable の作成から始めましょう。</span><span class="sxs-lookup"><span data-stu-id="56f5c-201">Let's start with creating a DataTable for the **Products** table.</span></span>

<span data-ttu-id="56f5c-202">厳密に型指定された Datatable には、基になるデータベーステーブルからデータにアクセスする方法に関する情報が含まれていないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="56f5c-202">Keep in mind that strongly-typed DataTables do not include any information on how to access data from their underlying database table.</span></span> <span data-ttu-id="56f5c-203">DataTable にデータを設定するためにデータを取得するには、データアクセス層として機能する TableAdapter クラスを使用します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-203">In order to retrieve the data to populate the DataTable, we use a TableAdapter class, which functions as our Data Access Layer.</span></span> <span data-ttu-id="56f5c-204">**製品**の DataTable の場合、TableAdapter には**getproducts ()** 、 **getproductbycategoryid (*categoryid*)** などのメソッドが含まれます。これはプレゼンテーション層から呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-204">For our **Products** DataTable, the TableAdapter will contain the methods **GetProducts()**, **GetProductByCategoryID(*categoryID*)**, and so on that we'll invoke from the presentation layer.</span></span> <span data-ttu-id="56f5c-205">DataTable のロールは、レイヤー間でデータを渡すために使用される、厳密に型指定されたオブジェクトとして機能します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-205">The DataTable's role is to serve as the strongly-typed objects used to pass data between the layers.</span></span>

<span data-ttu-id="56f5c-206">TableAdapter 構成ウィザードでは、最初に、使用するデータベースを選択するように求めるメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-206">The TableAdapter Configuration Wizard begins by prompting you to select which database to work with.</span></span> <span data-ttu-id="56f5c-207">ドロップダウンリストには、サーバーエクスプローラー内のそれらのデータベースが表示されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-207">The drop-down list shows those databases in the Server Explorer.</span></span> <span data-ttu-id="56f5c-208">Northwind データベースをサーバーエクスプローラーに追加しなかった場合は、この時点で [新しい接続] ボタンをクリックすると、この操作を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-208">If you did not add the Northwind database to the Server Explorer, you can click the New Connection button at this time to do so.</span></span>

<span data-ttu-id="56f5c-209">[ドロップダウンリストから Northwind データベースを選択 ![には](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-209">[![Choose the Northwind Database from the Drop-Down List](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span></span>

<span data-ttu-id="56f5c-210">**図 5**: ドロップダウンリストから Northwind データベースを選択[する (クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image13.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-210">**Figure 5**: Choose the Northwind Database from the Drop-Down List ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image13.png))</span></span>

<span data-ttu-id="56f5c-211">データベースを選択して [次へ] をクリックすると、 **web.config ファイルに**接続文字列を保存するかどうかを確認するメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-211">After selecting the database and clicking Next, you'll be asked if you want to save the connection string in the **Web.config** file.</span></span> <span data-ttu-id="56f5c-212">接続文字列を保存することで、TableAdapter クラスにハードコーディングされないようにすることができます。これにより、接続文字列情報が将来変更された場合の処理が簡単になります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-212">By saving the connection string you'll avoid having it hard coded in the TableAdapter classes, which simplifies things if the connection string information changes in the future.</span></span> <span data-ttu-id="56f5c-213">構成ファイルに接続文字列を保存することを選択した場合は、 **&lt;connectionStrings&gt;** セクションに配置されます。これは、[必要に応じて暗号化](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)してセキュリティを強化することも、後で IIS GUI 管理ツール内の新しい ASP.NET 2.0 プロパティページを使用して変更することもできます。これは、管理者にとって理想的です。</span><span class="sxs-lookup"><span data-stu-id="56f5c-213">If you opt to save the connection string in the configuration file it's placed in the **&lt;connectionStrings&gt;** section, which can be [optionally encrypted](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx) for improved security or modified later through the new ASP.NET 2.0 Property Page within the IIS GUI Admin Tool, which is more ideal for administrators.</span></span>

<span data-ttu-id="56f5c-214">[接続文字列を web.config に保存 ![には](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-214">[![Save the Connection String to Web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span></span>

<span data-ttu-id="56f5c-215">**図 6**: 接続文字列を Web.config に保存する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image16.png)され**ます**)</span><span class="sxs-lookup"><span data-stu-id="56f5c-215">**Figure 6**: Save the Connection String to **Web.config** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image16.png))</span></span>

<span data-ttu-id="56f5c-216">次に、厳密に型指定された最初の DataTable のスキーマを定義し、厳密に型指定されたデータセットを作成するときに TableAdapter で使用する最初のメソッドを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-216">Next, we need to define the schema for the first strongly-typed DataTable and provide the first method for our TableAdapter to use when populating the strongly-typed DataSet.</span></span> <span data-ttu-id="56f5c-217">この2つの手順は、DataTable に反映するテーブルから列を返すクエリを作成することによって、同時に実行されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-217">These two steps are accomplished simultaneously by creating a query that returns the columns from the table that we want reflected in our DataTable.</span></span> <span data-ttu-id="56f5c-218">ウィザードの最後で、このクエリにメソッド名を指定します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-218">At the end of the wizard we'll give a method name to this query.</span></span> <span data-ttu-id="56f5c-219">これが完了したら、プレゼンテーション層からこのメソッドを呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-219">Once that's been accomplished, this method can be invoked from our presentation layer.</span></span> <span data-ttu-id="56f5c-220">メソッドは、定義されたクエリを実行し、厳密に型指定された DataTable を設定します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-220">The method will execute the defined query and populate a strongly-typed DataTable.</span></span>

<span data-ttu-id="56f5c-221">SQL クエリの定義を開始するには、まず TableAdapter でクエリを発行する方法を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-221">To get started defining the SQL query we must first indicate how we want the TableAdapter to issue the query.</span></span> <span data-ttu-id="56f5c-222">アドホック SQL ステートメントを使用するか、新しいストアドプロシージャを作成するか、既存のストアドプロシージャを使用することができます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-222">We can use an ad-hoc SQL statement, create a new stored procedure, or use an existing stored procedure.</span></span> <span data-ttu-id="56f5c-223">これらのチュートリアルでは、アドホック SQL ステートメントを使用します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-223">For these tutorials we'll use ad-hoc SQL statements.</span></span> <span data-ttu-id="56f5c-224">ストアドプロシージャの使用例については、 [Brian Noyes](http://briannoyes.net/)の記事「 [Visual Studio 2005 データセットデザイナーを使用してデータアクセス層を構築](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="56f5c-224">Refer to [Brian Noyes](http://briannoyes.net/)'s article, [Build a Data Access Layer with the Visual Studio 2005 DataSet Designer](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner) for an example of using stored procedures.</span></span>

<span data-ttu-id="56f5c-225">[アドホック SQL ステートメントを使用してデータのクエリを実行 ![には](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-225">[![Query the Data Using an Ad-Hoc SQL Statement](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span></span>

<span data-ttu-id="56f5c-226">**図 7**: アドホック SQL ステートメントを使用してデータにクエリを実行[する (クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image19.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-226">**Figure 7**: Query the Data Using an Ad-Hoc SQL Statement ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image19.png))</span></span>

<span data-ttu-id="56f5c-227">この時点で、手動で SQL クエリを入力できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-227">At this point we can type in the SQL query by hand.</span></span> <span data-ttu-id="56f5c-228">TableAdapter で最初のメソッドを作成する場合は、通常、対応する DataTable で表現する必要がある列を返すクエリを使用します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-228">When creating the first method in the TableAdapter you typically want to have the query return those columns that need to be expressed in the corresponding DataTable.</span></span> <span data-ttu-id="56f5c-229">これを実現するには、 **Products**テーブルからすべての列とすべての行を返すクエリを作成します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-229">We can accomplish this by creating a query that returns all columns and all rows from the **Products** table:</span></span>

<span data-ttu-id="56f5c-230">[テキストボックスに SQL クエリを入力 ![には](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-230">[![Enter the SQL Query Into the Textbox](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span></span>

<span data-ttu-id="56f5c-231">**図 8**: テキストボックスに SQL クエリを入力[する (クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image22.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-231">**Figure 8**: Enter the SQL Query Into the Textbox ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image22.png))</span></span>

<span data-ttu-id="56f5c-232">または、図9に示すように、クエリビルダーを使用し、クエリをグラフィカルに作成します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-232">Alternatively, use the Query Builder and graphically construct the query, as shown in Figure 9.</span></span>

<span data-ttu-id="56f5c-233">[クエリエディターを使用してクエリをグラフィカルに作成 ![には](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-233">[![Create the Query Graphically, through the Query Editor](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span></span>

<span data-ttu-id="56f5c-234">**図 9**: クエリエディターを使用してクエリをグラフィカルに作成[する (クリックしてフルサイズのイメージを表示する](creating-a-data-access-layer-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="56f5c-234">**Figure 9**: Create the Query Graphically, through the Query Editor ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image25.png))</span></span>

<span data-ttu-id="56f5c-235">クエリを作成した後、次の画面に移動する前に、[詳細オプション] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="56f5c-235">After creating the query, but before moving onto the next screen, click the Advanced Options button.</span></span> <span data-ttu-id="56f5c-236">Web サイトプロジェクトでは、[Insert、Update、および Delete ステートメントの生成] が既定で選択されている唯一の詳細設定オプションです。クラスライブラリまたは Windows プロジェクトからこのウィザードを実行する場合は、[オプティミスティック同時実行制御を使用する] オプションも選択されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-236">In Web Site Projects, "Generate Insert, Update, and Delete statements" is the only advanced option selected by default; if you run this wizard from a Class Library or a Windows Project the "Use optimistic concurrency" option will also be selected.</span></span> <span data-ttu-id="56f5c-237">ここでは、[オプティミスティック同時実行制御を使用する] オプションをオフのままにします。</span><span class="sxs-lookup"><span data-stu-id="56f5c-237">Leave the "Use optimistic concurrency" option unchecked for now.</span></span> <span data-ttu-id="56f5c-238">オプティミスティック同時実行制御については、今後のチュートリアルで確認します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-238">We'll examine optimistic concurrency in future tutorials.</span></span>

<span data-ttu-id="56f5c-239">[![[Insert、Update、および Delete ステートメントを生成する] オプションのみを選択します。](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-239">[![Select Only the Generate Insert, Update, and Delete statements Option](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span></span>

<span data-ttu-id="56f5c-240">**図 10**: [Insert、Update、および Delete ステートメントを生成する] オプションのみを選択[する (クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image28.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-240">**Figure 10**: Select Only the Generate Insert, Update, and Delete statements Option ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image28.png))</span></span>

<span data-ttu-id="56f5c-241">詳細設定オプションを確認したら、[次へ] をクリックして最後の画面に進みます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-241">After verifying the advanced options, click Next to proceed to the final screen.</span></span> <span data-ttu-id="56f5c-242">ここでは、TableAdapter に追加するメソッドを選択するよう求められます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-242">Here we are asked to select which methods to add to the TableAdapter.</span></span> <span data-ttu-id="56f5c-243">データの読み込みには、次の2つのパターンがあります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-243">There are two patterns for populating data:</span></span>

- <span data-ttu-id="56f5c-244">この方法で DataTable にデータを**格納**します。 datatable をパラメーターとして受け取り、クエリの結果に基づいてデータを設定するメソッドが作成されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-244">**Fill a DataTable** with this approach a method is created that takes in a DataTable as a parameter and populates it based on the results of the query.</span></span> <span data-ttu-id="56f5c-245">たとえば、ADO.NET DataAdapter クラスは、このパターンを**Fill ()** メソッドと共に実装します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-245">The ADO.NET DataAdapter class, for example, implements this pattern with its **Fill()** method.</span></span>
- <span data-ttu-id="56f5c-246">この方法で**datatable を返し**ます。メソッドは datatable を作成してデータを格納し、メソッドの戻り値として返します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-246">**Return a DataTable** with this approach the method creates and fills the DataTable for you and returns it as the methods return value.</span></span>

<span data-ttu-id="56f5c-247">TableAdapter では、これらのパターンのいずれかまたは両方を実装できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-247">You can have the TableAdapter implement one or both of these patterns.</span></span> <span data-ttu-id="56f5c-248">ここで指定したメソッドの名前を変更することもできます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-248">You can also rename the methods provided here.</span></span> <span data-ttu-id="56f5c-249">両方のチェックボックスをオンのままにしておきますが、これらのチュートリアルでは後者のパターンのみを使用します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-249">Let's leave both checkboxes checked, even though we'll only be using the latter pattern throughout these tutorials.</span></span> <span data-ttu-id="56f5c-250">また、代わりに汎用の**GetData**メソッドを**getproducts**に変更してみましょう。</span><span class="sxs-lookup"><span data-stu-id="56f5c-250">Also, let's rename the rather generic **GetData** method to **GetProducts**.</span></span>

<span data-ttu-id="56f5c-251">オンにすると、最後のチェックボックス "GenerateDBDirectMethods" によって、TableAdapter の**Insert ()** 、 **Update ()** 、および**Delete ()** の各メソッドが作成されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-251">If checked, the final checkbox, "GenerateDBDirectMethods," creates **Insert()**, **Update()**, and **Delete()** methods for the TableAdapter.</span></span> <span data-ttu-id="56f5c-252">このオプションをオフのままにした場合、すべての更新は、型指定されたデータセット、DataTable、単一の DataRow、または Datarow の配列を受け取る TableAdapter の唯一の**Update ()** メソッドを使用して実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-252">If you leave this option unchecked, all updates will need to be done through the TableAdapter's sole **Update()** method, which takes in the Typed DataSet, a DataTable, a single DataRow, or an array of DataRows.</span></span> <span data-ttu-id="56f5c-253">(図9の詳細プロパティから [Insert、Update、および Delete ステートメントを生成する] オプションをオフにした場合、このチェックボックスの設定は効果がありません)。このチェックボックスはオンのままにしておきます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-253">(If you've unchecked the "Generate Insert, Update, and Delete statements" option from the advanced properties in Figure 9 this checkbox's setting will have no effect.) Let's leave this checkbox selected.</span></span>

<span data-ttu-id="56f5c-254">[メソッド名を GetData から GetProducts に変更 ![には](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-254">[![Change the Method Name from GetData to GetProducts](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span></span>

<span data-ttu-id="56f5c-255">**図 11**: メソッド名を**GetData**から**getproducts**に変更する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image31.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-255">**Figure 11**: Change the Method Name from **GetData** to **GetProducts** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image31.png))</span></span>

<span data-ttu-id="56f5c-256">[完了] をクリックしてウィザードを完了します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-256">Complete the wizard by clicking Finish.</span></span> <span data-ttu-id="56f5c-257">ウィザードを閉じると、先ほど作成した DataTable を示すデータセットデザイナーに戻ります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-257">After the wizard closes we are returned to the DataSet Designer which shows the DataTable we just created.</span></span> <span data-ttu-id="56f5c-258">**Products** DataTable (**ProductID**、 **ProductName**など) の列の一覧に加えて、 **ProductsTableAdapter** (**Fill ()** および**getproducts ()** ) のメソッドも表示されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-258">You can see the list of columns in the **Products** DataTable (**ProductID**, **ProductName**, and so on), as well as the methods of the **ProductsTableAdapter** (**Fill()** and **GetProducts()**).</span></span>

<span data-ttu-id="56f5c-259">[![Products DataTable と ProductsTableAdapter が、型指定されたデータセットに追加されました。](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-259">[![The Products DataTable and ProductsTableAdapter have been Added to the Typed DataSet](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span></span>

<span data-ttu-id="56f5c-260">**図 12**: **Products** DataTable と**ProductsTableAdapter**が型指定されたデータセットに追加された (クリックすると、[フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image34.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-260">**Figure 12**: The **Products** DataTable and **ProductsTableAdapter** have been Added to the Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image34.png))</span></span>

<span data-ttu-id="56f5c-261">この時点で、1つの DataTable (**Northwind products**) と、 **getproducts ()** メソッドを使用した厳密に型指定された DataAdapter クラス (**NorthwindTableAdapters**) を持つ型指定されたデータセットがあります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-261">At this point we have a Typed DataSet with a single DataTable (**Northwind.Products**) and a strongly-typed DataAdapter class (**NorthwindTableAdapters.ProductsTableAdapter**) with a **GetProducts()** method.</span></span> <span data-ttu-id="56f5c-262">これらのオブジェクトを使用して、次のようなコードからすべての製品の一覧にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-262">These objects can be used to access a list of all products from code like:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample1.html)]

<span data-ttu-id="56f5c-263">このコードでは、データアクセス固有のコードを1ビット記述する必要はありませんでした。</span><span class="sxs-lookup"><span data-stu-id="56f5c-263">This code did not require us to write one bit of data access-specific code.</span></span> <span data-ttu-id="56f5c-264">ADO.NET クラスをインスタンス化する必要はありませんでした。接続文字列、SQL クエリ、またはストアドプロシージャを参照する必要はありませんでした。</span><span class="sxs-lookup"><span data-stu-id="56f5c-264">We did not have to instantiate any ADO.NET classes, we didn't have to refer to any connection strings, SQL queries, or stored procedures.</span></span> <span data-ttu-id="56f5c-265">代わりに、TableAdapter によって、低レベルのデータアクセスコードが提供されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-265">Instead, the TableAdapter provides the low-level data access code for us.</span></span>

<span data-ttu-id="56f5c-266">この例で使用される各オブジェクトも厳密に型指定されているため、Visual Studio で IntelliSense とコンパイル時の型チェックを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-266">Each object used in this example is also strongly-typed, allowing Visual Studio to provide IntelliSense and compile-time type checking.</span></span> <span data-ttu-id="56f5c-267">また、TableAdapter によって返されるすべての Datatable を ASP.NET データ Web コントロール (GridView、DetailsView、DropDownList、CheckBoxList など) にバインドすることもできます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-267">And best of all the DataTables returned by the TableAdapter can be bound to ASP.NET data Web controls, such as the GridView, DetailsView, DropDownList, CheckBoxList, and several others.</span></span> <span data-ttu-id="56f5c-268">次の例は、 **Getproducts ()** メソッドによって返される DataTable を、scan Load イベントハンドラーの **\_ページ**内の3行のコードだけで GridView にバインドする方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-268">The following example illustrates binding the DataTable returned by the **GetProducts()** method to a GridView in just a scant three lines of code within the **Page\_Load** event handler.</span></span>

<span data-ttu-id="56f5c-269">AllProducts .aspx</span><span class="sxs-lookup"><span data-stu-id="56f5c-269">AllProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample2.aspx)]

<span data-ttu-id="56f5c-270">AllProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="56f5c-270">AllProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample3.cs)]

<span data-ttu-id="56f5c-271">[製品の一覧が GridView に表示される ![](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-271">[![The List of Products is Displayed in a GridView](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span></span>

<span data-ttu-id="56f5c-272">**図 13**: 製品の一覧が GridView に表示される ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image37.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-272">**Figure 13**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image37.png))</span></span>

<span data-ttu-id="56f5c-273">この例では、ASP.NET ページの**ページ\_Load**イベントハンドラーに3行のコードを記述する必要がありましたが、今後のチュートリアルでは、ObjectDataSource を使用して DAL からデータを宣言によって取得する方法を確認します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-273">While this example required that we write three lines of code in our ASP.NET page's **Page\_Load** event handler, in future tutorials we'll examine how to use the ObjectDataSource to declaratively retrieve the data from the DAL.</span></span> <span data-ttu-id="56f5c-274">ObjectDataSource を使用すると、コードを記述する必要がなくなり、ページングや並べ替えもサポートされます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-274">With the ObjectDataSource we'll not have to write any code and will get paging and sorting support as well!</span></span>

## <a name="step-3-adding-parameterized-methods-to-the-data-access-layer"></a><span data-ttu-id="56f5c-275">手順 3: データアクセス層へのパラメーター化されたメソッドの追加</span><span class="sxs-lookup"><span data-stu-id="56f5c-275">Step 3: Adding Parameterized Methods to the Data Access Layer</span></span>

<span data-ttu-id="56f5c-276">この時点で、 **ProductsTableAdapter**クラスには、 **getproducts ()** という1つのメソッドがあります。このメソッドは、データベース内のすべての製品を返します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-276">At this point our **ProductsTableAdapter** class has but one method, **GetProducts()**, which returns all of the products in the database.</span></span> <span data-ttu-id="56f5c-277">すべての製品を使用できるということは確かに便利ですが、特定の製品、または特定のカテゴリに属するすべての製品に関する情報を取得することが必要になる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-277">While being able to work with all products is definitely useful, there are times when we'll want to retrieve information about a specific product, or all products that belong to a particular category.</span></span> <span data-ttu-id="56f5c-278">データアクセス層にこのような機能を追加するには、パラメーター化されたメソッドを TableAdapter に追加します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-278">To add such functionality to our Data Access Layer we can add parameterized methods to the TableAdapter.</span></span>

<span data-ttu-id="56f5c-279">ここで、 **Get$ Bycategoryid (*categoryid*)** メソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-279">Let's add the **GetProductsByCategoryID(*categoryID*)** method.</span></span> <span data-ttu-id="56f5c-280">DAL に新しいメソッドを追加するには、データセットデザイナーに戻り、 **[ProductsTableAdapter]** セクションを右クリックして、[クエリの追加] を選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-280">To add a new method to the DAL, return to the DataSet Designer, right-click in the **ProductsTableAdapter** section, and choose Add Query.</span></span>

![TableAdapter を右クリックし、[クエリの追加] を選択します。](creating-a-data-access-layer-cs/_static/image38.png)

<span data-ttu-id="56f5c-282">**図 14**: TableAdapter を右クリックし、[クエリの追加] を選択する</span><span class="sxs-lookup"><span data-stu-id="56f5c-282">**Figure 14**: Right-Click on the TableAdapter and Choose Add Query</span></span>

<span data-ttu-id="56f5c-283">まず、アドホック SQL ステートメントまたは新規または既存のストアドプロシージャを使用してデータベースにアクセスするかどうかを確認するメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-283">We are first prompted about whether we want to access the database using an ad-hoc SQL statement or a new or existing stored procedure.</span></span> <span data-ttu-id="56f5c-284">アドホック SQL ステートメントをもう一度使用してみましょう。</span><span class="sxs-lookup"><span data-stu-id="56f5c-284">Let's choose to use an ad-hoc SQL statement again.</span></span> <span data-ttu-id="56f5c-285">次に、使用する SQL クエリの種類を尋ねられます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-285">Next, we are asked what type of SQL query we'd like to use.</span></span> <span data-ttu-id="56f5c-286">指定されたカテゴリに属するすべての製品を返す必要があるため、行を返す**SELECT**ステートメントを記述します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-286">Since we want to return all products that belong to a specified category, we want to write a **SELECT** statement which returns rows.</span></span>

<span data-ttu-id="56f5c-287">[行を返す SELECT ステートメントの作成を選択 ![には](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-287">[![Choose to Create a SELECT Statement Which Returns Rows](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span></span>

<span data-ttu-id="56f5c-288">**図 15**: 行を返す**SELECT**ステートメントの作成を選択する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image41.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-288">**Figure 15**: Choose to Create a **SELECT** Statement Which Returns Rows ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image41.png))</span></span>

<span data-ttu-id="56f5c-289">次の手順では、データへのアクセスに使用する SQL クエリを定義します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-289">The next step is to define the SQL query used to access the data.</span></span> <span data-ttu-id="56f5c-290">特定のカテゴリに属する製品のみを返すようにするため、 <strong>Getproducts ()</strong>と同じ<strong>SELECT</strong>ステートメントを使用しますが、次の<strong>where</strong>句を追加します。ここで、 <strong>CategoryID = @CategoryID</strong>です。</span><span class="sxs-lookup"><span data-stu-id="56f5c-290">Since we want to return only those products that belong to a particular category, I use the same <strong>SELECT</strong> statement from <strong>GetProducts()</strong>, but add the following <strong>WHERE</strong> clause: <strong>WHERE CategoryID = @CategoryID</strong>.</span></span> <span data-ttu-id="56f5c-291"><strong>@CategoryID</strong>パラメーターは、作成するメソッドが、対応する型 (つまり、null 許容の整数) の入力パラメーターを必要とすることを TableAdapter ウィザードに示します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-291">The <strong>@CategoryID</strong> parameter indicates to the TableAdapter wizard that the method we're creating will require an input parameter of the corresponding type (namely, a nullable integer).</span></span>

<span data-ttu-id="56f5c-292">[指定したカテゴリの製品のみを返すクエリを入力 ![](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-292">[![Enter a Query to Only Return Products in a Specified Category](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span></span>

<span data-ttu-id="56f5c-293">**図 16**: 指定したカテゴリの製品のみを返すクエリを入力する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image44.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-293">**Figure 16**: Enter a Query to Only Return Products in a Specified Category ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image44.png))</span></span>

<span data-ttu-id="56f5c-294">最後の手順では、使用するデータアクセスパターンを選択したり、生成されるメソッドの名前をカスタマイズしたりすることができます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-294">In the final step we can choose which data access patterns to use, as well as customize the names of the methods generated.</span></span> <span data-ttu-id="56f5c-295">Fill パターンの場合は、名前を<strong>Fillbycategoryid</strong>に変更し、DataTable return パターン ( <strong>Get*X</strong>* メソッド) を返すには、 <strong>get$ bycategoryid</strong>を使用します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-295">For the Fill pattern, let's change the name to <strong>FillByCategoryID</strong> and for the return a DataTable return pattern (the <strong>Get*X</strong>* methods), let's use <strong>GetProductsByCategoryID</strong>.</span></span>

<span data-ttu-id="56f5c-296">[TableAdapter メソッドの名前を選択 ![には](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-296">[![Choose the Names for the TableAdapter Methods](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span></span>

<span data-ttu-id="56f5c-297">**図 17**: TableAdapter メソッドの名前を選択する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image47.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-297">**Figure 17**: Choose the Names for the TableAdapter Methods ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image47.png))</span></span>

<span data-ttu-id="56f5c-298">ウィザードを完了すると、データセットデザイナーに新しい TableAdapter メソッドが追加されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-298">After completing the wizard, the DataSet Designer includes the new TableAdapter methods.</span></span>

![これで、製品のカテゴリ別にクエリを実行できるようになりました](creating-a-data-access-layer-cs/_static/image48.png)

<span data-ttu-id="56f5c-300">**図 18**: カテゴリ別に製品を照会できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="56f5c-300">**Figure 18**: The Products Can Now be Queried by Category</span></span>

<span data-ttu-id="56f5c-301">同じ手法を使用して**Getproductbyproductid (*productID*)** メソッドを追加してみましょう。</span><span class="sxs-lookup"><span data-stu-id="56f5c-301">Take a moment to add a **GetProductByProductID(*productID*)** method using the same technique.</span></span>

<span data-ttu-id="56f5c-302">これらのパラメーター化クエリは、データセットデザイナーから直接テストできます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-302">These parameterized queries can be tested directly from the DataSet Designer.</span></span> <span data-ttu-id="56f5c-303">TableAdapter のメソッドを右クリックし、[データのプレビュー] を選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-303">Right-click on the method in the TableAdapter and choose Preview Data.</span></span> <span data-ttu-id="56f5c-304">次に、パラメーターに使用する値を入力し、[プレビュー] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="56f5c-304">Next, enter the values to use for the parameters and click Preview.</span></span>

<span data-ttu-id="56f5c-305">[飲料カテゴリに属する製品 ![が表示されます。](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-305">[![Those Products Belonging to the Beverages Category are Shown](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span></span>

<span data-ttu-id="56f5c-306">**図 19**: 飲み物カテゴリに属する製品が表示されます ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image51.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-306">**Figure 19**: Those Products Belonging to the Beverages Category are Shown ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image51.png))</span></span>

<span data-ttu-id="56f5c-307">DAL の**Getproducts Bycategoryid (*categoryID*)** メソッドを使用して、指定したカテゴリの製品のみを表示する ASP.NET ページを作成できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="56f5c-307">With the **GetProductsByCategoryID(*categoryID*)** method in our DAL, we can now create an ASP.NET page that displays only those products in a specified category.</span></span> <span data-ttu-id="56f5c-308">次の例では、飲料カテゴリに含まれるすべての製品を示しています。このカテゴリには、 **CategoryID**が1です。</span><span class="sxs-lookup"><span data-stu-id="56f5c-308">The following example shows all products that are in the Beverages category, which have a **CategoryID** of 1.</span></span>

<span data-ttu-id="56f5c-309">飲み物</span><span class="sxs-lookup"><span data-stu-id="56f5c-309">Beverages.asp</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample4.aspx)]

<span data-ttu-id="56f5c-310">Beverages.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="56f5c-310">Beverages.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample5.cs)]

<span data-ttu-id="56f5c-311">[[飲料] カテゴリの製品 ![表示されます。](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-311">[![Those Products in the Beverages Category are Displayed](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span></span>

<span data-ttu-id="56f5c-312">**図 20**: 飲料カテゴリのこれらの製品が表示される ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image54.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-312">**Figure 20**: Those Products in the Beverages Category are Displayed ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image54.png))</span></span>

## <a name="step-4-inserting-updating-and-deleting-data"></a><span data-ttu-id="56f5c-313">手順 4: データの挿入、更新、および削除</span><span class="sxs-lookup"><span data-stu-id="56f5c-313">Step 4: Inserting, Updating, and Deleting Data</span></span>

<span data-ttu-id="56f5c-314">データの挿入、更新、および削除には、一般的に使用される2つのパターンがあります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-314">There are two patterns commonly used for inserting, updating, and deleting data.</span></span> <span data-ttu-id="56f5c-315">最初のパターンでは、データベースダイレクトパターンを呼び出します。このパターンでは、呼び出されたときに、1つのデータベースレコードで動作するデータベースに対して**INSERT**、 **UPDATE**、または**DELETE**コマンドを発行するメソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-315">The first pattern, which I'll call the database direct pattern, involves creating methods that, when invoked, issue an **INSERT**, **UPDATE**, or **DELETE** command to the database that operates on a single database record.</span></span> <span data-ttu-id="56f5c-316">通常、このようなメソッドは、挿入、更新、または削除する値に対応する一連のスカラー値 (整数、文字列、ブール値、DateTimes など) で渡されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-316">Such methods are typically passed in a series of scalar values (integers, strings, Booleans, DateTimes, and so on) that correspond to the values to insert, update, or delete.</span></span> <span data-ttu-id="56f5c-317">たとえば、 **Products**テーブルに対してこのパターンを使用した場合、delete メソッドは、削除するレコードの**ProductID**を示す整数パラメーターを受け取ります。一方、Insert メソッドは、 **ProductName**の文字列、 **UnitPrice**の10進数、 **UnitsOnStock**の整数などを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-317">For example, with this pattern for the **Products** table the delete method would take in an integer parameter, indicating the **ProductID** of the record to delete, while the insert method would take in a string for the **ProductName**, a decimal for the **UnitPrice**, an integer for the **UnitsOnStock**, and so on.</span></span>

<span data-ttu-id="56f5c-318">[挿入、更新、および削除の各要求がデータベースに直ちに送信さ ![](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-318">[![Each Insert, Update, and Delete Request is Sent to the Database Immediately](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span></span>

<span data-ttu-id="56f5c-319">**図 21**: 挿入、更新、および削除の各要求がすぐにデータベースに送信される ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image57.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-319">**Figure 21**: Each Insert, Update, and Delete Request is Sent to the Database Immediately ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image57.png))</span></span>

<span data-ttu-id="56f5c-320">もう1つのパターン (バッチ更新パターンと呼ばれます) は、1つのメソッド呼び出しでデータセット、DataTable、または Datarow のコレクション全体を更新することです。</span><span class="sxs-lookup"><span data-stu-id="56f5c-320">The other pattern, which I'll refer to as the batch update pattern, is to update an entire DataSet, DataTable, or collection of DataRows in one method call.</span></span> <span data-ttu-id="56f5c-321">このパターンでは、開発者が DataTable 内の Datarow を削除、挿入、変更し、それらの Datarow または DataTable を update メソッドに渡します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-321">With this pattern a developer deletes, inserts, and modifies the DataRows in a DataTable and then passes those DataRows or DataTable into an update method.</span></span> <span data-ttu-id="56f5c-322">このメソッドは、渡された Datarow を列挙し、変更、追加、または削除された (DataRow の[RowState プロパティ](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx)値を使用して) かどうかを判断し、各レコードに対して適切なデータベース要求を発行します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-322">This method then enumerates the DataRows passed in, determines whether or not they've been modified, added, or deleted (via the DataRow's [RowState property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) value), and issues the appropriate database request for each record.</span></span>

<span data-ttu-id="56f5c-323">[更新メソッドが呼び出されたときに、すべての変更がデータベースと同期さ ![](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-323">[![All Changes are Synchronized with the Database When the Update Method is Invoked](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span></span>

<span data-ttu-id="56f5c-324">**図 22**: 更新メソッドが呼び出されたときにすべての変更がデータベースと同期される ([クリックしてフルサイズの画像を表示する](creating-a-data-access-layer-cs/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="56f5c-324">**Figure 22**: All Changes are Synchronized with the Database When the Update Method is Invoked ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image60.png))</span></span>

<span data-ttu-id="56f5c-325">TableAdapter では、既定でバッチ更新パターンが使用されますが、DB direct パターンもサポートされています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-325">The TableAdapter uses the batch update pattern by default, but also supports the DB direct pattern.</span></span> <span data-ttu-id="56f5c-326">TableAdapter の作成時に詳細プロパティから [Insert、Update、Delete ステートメントの生成] オプションを選択したため、 **ProductsTableAdapter**には、バッチ更新パターンを実装する**update ()** メソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-326">Since we selected the "Generate Insert, Update, and Delete statements" option from the Advanced Properties when creating our TableAdapter, the **ProductsTableAdapter** contains an **Update()** method, which implements the batch update pattern.</span></span> <span data-ttu-id="56f5c-327">具体的には、TableAdapter には、型指定されたデータセット、厳密に型指定された DataTable、または1つ以上の Datarow に渡すことができる**Update ()** メソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-327">Specifically, the TableAdapter contains an **Update()** method that can be passed the Typed DataSet, a strongly-typed DataTable, or one or more DataRows.</span></span> <span data-ttu-id="56f5c-328">最初に TableAdapter を作成するときに [GenerateDBDirectMethods] チェックボックスをオンにした場合、 **Insert ()** 、 **Update ()** 、および**Delete ()** の各メソッドを使用して DB direct パターンも実装されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-328">If you left the "GenerateDBDirectMethods" checkbox checked when first creating the TableAdapter the DB direct pattern will also be implemented via **Insert()**, **Update()**, and **Delete()** methods.</span></span>

<span data-ttu-id="56f5c-329">どちらのデータ変更パターンでも、TableAdapter の**InsertCommand**、 **UpdateCommand**、および**DeleteCommand**プロパティを使用して、 **INSERT**、 **UPDATE**、および**DELETE**コマンドをデータベースに発行します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-329">Both data modification patterns use the TableAdapter's **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties to issue their **INSERT**, **UPDATE**, and **DELETE** commands to the database.</span></span> <span data-ttu-id="56f5c-330">データセットデザイナーで TableAdapter をクリックし、プロパティウィンドウに移動することで、 **InsertCommand**、 **UpdateCommand**、および**DeleteCommand**の各プロパティを確認および変更できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-330">You can inspect and modify the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties by clicking on the TableAdapter in the DataSet Designer and then going to the Properties window.</span></span> <span data-ttu-id="56f5c-331">(TableAdapter が選択されていること、および**ProductsTableAdapter**オブジェクトがプロパティウィンドウのドロップダウンリストで選択されていることを確認してください)。</span><span class="sxs-lookup"><span data-stu-id="56f5c-331">(Make sure you have selected the TableAdapter, and that the **ProductsTableAdapter** object is the one selected in the drop-down list in the Properties window.)</span></span>

<span data-ttu-id="56f5c-332">[TableAdapter に InsertCommand、UpdateCommand、および DeleteCommand プロパティがある ![](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-332">[![The TableAdapter has InsertCommand, UpdateCommand, and DeleteCommand Properties](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span></span>

<span data-ttu-id="56f5c-333">**図 23**: TableAdapter には**InsertCommand**、 **UpdateCommand**、および**DeleteCommand**プロパティがあります ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image63.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-333">**Figure 23**: The TableAdapter has **InsertCommand**, **UpdateCommand**, and **DeleteCommand** Properties ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image63.png))</span></span>

<span data-ttu-id="56f5c-334">これらのデータベースコマンドのプロパティのいずれかを確認または変更するには、 **CommandText**サブプロパティをクリックします。これにより、クエリビルダーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-334">To examine or modify any of these database command properties, click on the **CommandText** subproperty, which will bring up the Query Builder.</span></span>

<span data-ttu-id="56f5c-335">[クエリビルダーで INSERT、UPDATE、および DELETE ステートメントを構成 ![には](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-335">[![Configure the INSERT, UPDATE, and DELETE Statements in the Query Builder](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span></span>

<span data-ttu-id="56f5c-336">**図 24**: クエリビルダーで**INSERT**、 **UPDATE**、および**DELETE**ステートメントを構成する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image66.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-336">**Figure 24**: Configure the **INSERT**, **UPDATE**, and **DELETE** Statements in the Query Builder ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image66.png))</span></span>

<span data-ttu-id="56f5c-337">次のコード例では、バッチ更新パターンを使用して、廃止されておらず、25単位の在庫があるすべての製品の価格を2倍にする方法を示します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-337">The following code example shows how to use the batch update pattern to double the price of all products that are not discontinued and that have 25 units in stock or less:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample6.cs)]

<span data-ttu-id="56f5c-338">次のコードは、DB ダイレクトパターンを使用して、プログラムで特定の製品を削除してから更新し、新しい製品を追加する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-338">The code below illustrates how to use the DB direct pattern to programmatically delete a particular product, then update one, and then add a new one:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample7.cs)]

## <a name="creating-custom-insert-update-and-delete-methods"></a><span data-ttu-id="56f5c-339">カスタムの Insert、Update、および Delete メソッドの作成</span><span class="sxs-lookup"><span data-stu-id="56f5c-339">Creating Custom Insert, Update, and Delete Methods</span></span>

<span data-ttu-id="56f5c-340">DB ダイレクトメソッドによって作成される**Insert ()** 、 **Update ()** 、および**Delete ()** の各メソッドは、特に多くの列を持つテーブルでは、少し面倒な場合があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-340">The **Insert()**, **Update()**, and **Delete()** methods created by the DB direct method can be a bit cumbersome, especially for tables with many columns.</span></span> <span data-ttu-id="56f5c-341">前のコード例では、IntelliSense のヘルプを使用せずに、 **Update ()** および**Insert ()** の各メソッドに対して各入力パラメーターにマップされている**Products**テーブル列は特に明確ではありません。</span><span class="sxs-lookup"><span data-stu-id="56f5c-341">Looking at the previous code example, without IntelliSense's help it's not particularly clear what **Products** table column maps to each input parameter to the **Update()** and **Insert()** methods.</span></span> <span data-ttu-id="56f5c-342">1つまたは2つの列のみを更新する必要がある場合や、新しく挿入されたレコードの**id** (自動インクリメント) フィールドの値を返すようにカスタマイズされた**Insert ()** メソッドが必要な場合があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-342">There may be times when we only want to update a single column or two, or want a customized **Insert()** method that will, perhaps, return the value of the newly inserted record's **IDENTITY** (auto-increment) field.</span></span>

<span data-ttu-id="56f5c-343">このようなカスタムメソッドを作成するには、データセットデザイナーに戻ります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-343">To create such a custom method, return to the DataSet Designer.</span></span> <span data-ttu-id="56f5c-344">TableAdapter を右クリックし、[クエリの追加] を選択して、TableAdapter ウィザードに戻ります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-344">Right-click on the TableAdapter and choose Add Query, returning to the TableAdapter wizard.</span></span> <span data-ttu-id="56f5c-345">2番目の画面では、作成するクエリの種類を指定できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-345">On the second screen we can indicate the type of query to create.</span></span> <span data-ttu-id="56f5c-346">新しい製品を追加し、新しく追加したレコードの**ProductID**の値を返すメソッドを作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="56f5c-346">Let's create a method that adds a new product and then returns the value of the newly added record's **ProductID**.</span></span> <span data-ttu-id="56f5c-347">そのため、**挿入**クエリを作成することを選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-347">Therefore, opt to create an **INSERT** query.</span></span>

<span data-ttu-id="56f5c-348">[Products テーブルに新しい行を追加するメソッドを作成 ![には](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-348">[![Create a Method to Add a New Row to the Products Table](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span></span>

<span data-ttu-id="56f5c-349">**図 25**: **Products**テーブルに新しい行を追加するメソッドを作成する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image69.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-349">**Figure 25**: Create a Method to Add a New Row to the **Products** Table ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image69.png))</span></span>

<span data-ttu-id="56f5c-350">次の画面で、 **InsertCommand**の**CommandText**が表示されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-350">On the next screen the **InsertCommand**'s **CommandText** appears.</span></span> <span data-ttu-id="56f5c-351">クエリの最後に**SELECT SCOPE\_identity ()** を追加することによって、このクエリを拡張します。これにより、同じスコープ内の**id**列に挿入された最後の id 値が返されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-351">Augment this query by adding **SELECT SCOPE\_IDENTITY()** at the end of the query, which will return the last identity value inserted into an **IDENTITY** column in the same scope.</span></span> <span data-ttu-id="56f5c-352">(**スコープ\_id ()** の詳細と、 [@@IDENTITYの代わりに scope\_identity () を使用](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx)する理由の詳細については、[技術ドキュメント](https://msdn.microsoft.com/library/ms190315.aspx)を参照してください。**SELECT**ステートメントを追加する前に、必ずセミコロンで**挿入**ステートメントを終了してください。</span><span class="sxs-lookup"><span data-stu-id="56f5c-352">(See the [technical documentation](https://msdn.microsoft.com/library/ms190315.aspx) for more information about **SCOPE\_IDENTITY()** and why you probably want to [use SCOPE\_IDENTITY() in lieu of @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).) Make sure that you end the **INSERT** statement with a semi-colon before adding the **SELECT** statement.</span></span>

<span data-ttu-id="56f5c-353">[SCOPE_IDENTITY () 値を返すようにクエリを拡張 ![](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-353">[![Augment the Query to Return the SCOPE_IDENTITY() Value](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span></span>

<span data-ttu-id="56f5c-354">**図 26**:**スコープ\_IDENTITY ()** 値を返すようにクエリを拡張する ([クリックしてフルサイズのイメージを表示する](creating-a-data-access-layer-cs/_static/image72.png))</span><span class="sxs-lookup"><span data-stu-id="56f5c-354">**Figure 26**: Augment the Query to Return the **SCOPE\_IDENTITY()** Value ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image72.png))</span></span>

<span data-ttu-id="56f5c-355">最後に、新しいメソッドに**Insertproduct**という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-355">Finally, name the new method **InsertProduct**.</span></span>

<span data-ttu-id="56f5c-356">[新しいメソッド名を InsertProduct に設定 ![](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-356">[![Set the New Method Name to InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span></span>

<span data-ttu-id="56f5c-357">**図 27**: 新しいメソッド名を**insertproduct**に設定する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image75.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-357">**Figure 27**: Set the New Method Name to **InsertProduct** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image75.png))</span></span>

<span data-ttu-id="56f5c-358">データセットデザイナーに戻ると、 **ProductsTableAdapter**に新しいメソッド**insertproduct**が含まれていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-358">When you return to the DataSet Designer you'll see that the **ProductsTableAdapter** contains a new method, **InsertProduct**.</span></span> <span data-ttu-id="56f5c-359">この新しいメソッドに**Products**テーブル内の各列のパラメーターがない場合、**挿入**ステートメントをセミコロンで終了することを忘れた可能性があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-359">If this new method doesn't have a parameter for each column in the **Products** table, chances are you forgot to terminate the **INSERT** statement with a semi-colon.</span></span> <span data-ttu-id="56f5c-360">**Insertproduct**メソッドを構成し、 **INSERT**ステートメントと**SELECT**ステートメントをセミコロンで区切るようにします。</span><span class="sxs-lookup"><span data-stu-id="56f5c-360">Configure the **InsertProduct** method and ensure you have a semi-colon delimiting the **INSERT** and **SELECT** statements.</span></span>

<span data-ttu-id="56f5c-361">既定では、insert メソッドはクエリ以外のメソッドを発行します。つまり、影響を受ける行の数を返すことを意味します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-361">By default, insert methods issue non-query methods, meaning that they return the number of affected rows.</span></span> <span data-ttu-id="56f5c-362">ただし、 **Insertproduct**メソッドでは、クエリによって返された値を返し、影響を受けた行数は返さないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-362">However, we want the **InsertProduct** method to return the value returned by the query, not the number of rows affected.</span></span> <span data-ttu-id="56f5c-363">これを実現するには、 **Insertproduct**メソッドの**executemode**プロパティを**スカラー**に調整します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-363">To accomplish this, adjust the **InsertProduct** method's **ExecuteMode** property to **Scalar**.</span></span>

<span data-ttu-id="56f5c-364">[ExecuteMode プロパティをスカラーに変更 ![には](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-364">[![Change the ExecuteMode Property to Scalar](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span></span>

<span data-ttu-id="56f5c-365">**図 28**: **executemode**プロパティを**スカラー**に変更する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image78.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-365">**Figure 28**: Change the **ExecuteMode** Property to **Scalar** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image78.png))</span></span>

<span data-ttu-id="56f5c-366">次のコードは、この新しい**Insertproduct**メソッドの動作を示しています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-366">The following code shows this new **InsertProduct** method in action:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample8.cs)]

## <a name="step-5-completing-the-data-access-layer"></a><span data-ttu-id="56f5c-367">手順 5: データアクセス層を完成させる</span><span class="sxs-lookup"><span data-stu-id="56f5c-367">Step 5: Completing the Data Access Layer</span></span>

<span data-ttu-id="56f5c-368">**ProductsTableAdapters**クラスは**Products**テーブルから**CategoryID**および**仕入**先の値を返しますが、 **Categories**テーブルまたは**仕入先**テーブルの**CompanyName**列の [**区分**値] 列は含まれていませんが、これらは製品情報を表示するときに表示する列である可能性があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="56f5c-368">Note that the **ProductsTableAdapters** class returns the **CategoryID** and **SupplierID** values from the **Products** table, but doesn't include the **CategoryName** column from the **Categories** table or the **CompanyName** column from the **Suppliers** table, although these are likely the columns we want to display when showing product information.</span></span> <span data-ttu-id="56f5c-369">TableAdapter の初期メソッド**Getproducts ()** を拡張して、 **[区分]** 値 と **[CompanyName]** の両方の列の値を含めることができます。これにより、これらの新しい列が含まれるように、厳密に型指定された DataTable が更新されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-369">We can augment the TableAdapter's initial method, **GetProducts()**, to include both the **CategoryName** and **CompanyName** column values, which will update the strongly-typed DataTable to include these new columns as well.</span></span>

<span data-ttu-id="56f5c-370">ただし、この方法では、データの挿入、更新、および削除の TableAdapter のメソッドがこの初期の方法に基づいているため、問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-370">This can present a problem, however, as the TableAdapter's methods for inserting, updating, and deleting data are based off of this initial method.</span></span> <span data-ttu-id="56f5c-371">幸い、挿入、更新、および削除のための自動生成されたメソッドは、 **SELECT**句のサブクエリの影響を受けません。</span><span class="sxs-lookup"><span data-stu-id="56f5c-371">Fortunately, the auto-generated methods for inserting, updating, and deleting are not affected by subqueries in the **SELECT** clause.</span></span> <span data-ttu-id="56f5c-372">**結合**を使用するのではなく、**カテゴリ**や**サプライヤー**にクエリをサブクエリとして追加することで、データを変更するためにこれらのメソッドを再作成する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-372">By taking care to add our queries to **Categories** and **Suppliers** as subqueries, rather than **JOIN** s, we'll avoid having to rework those methods for modifying data.</span></span> <span data-ttu-id="56f5c-373">**ProductsTableAdapter**の**getproducts ()** メソッドを右クリックし、[構成] を選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-373">Right-click on the **GetProducts()** method in the **ProductsTableAdapter** and choose Configure.</span></span> <span data-ttu-id="56f5c-374">次に、 **SELECT**句を次のように調整します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-374">Then, adjust the **SELECT** clause so that it looks like:</span></span>

[!code-sql[Main](creating-a-data-access-layer-cs/samples/sample9.sql)]

<span data-ttu-id="56f5c-375">[GetProducts () メソッドの SELECT ステートメントを ![更新します。](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-375">[![Update the SELECT Statement for the GetProducts() Method](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span></span>

<span data-ttu-id="56f5c-376">**図 29**: **getproducts ()** メソッドの**SELECT**ステートメントを更新する ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image81.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-376">**Figure 29**: Update the **SELECT** Statement for the **GetProducts()** Method ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image81.png))</span></span>

<span data-ttu-id="56f5c-377">**Getproducts ()** メソッドを更新してこの新しいクエリを使用すると、DataTable に2つの新しい列 (**区分**テーブルと**SupplierName**) が追加されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-377">After updating the **GetProducts()** method to use this new query the DataTable will include two new columns: **CategoryName** and **SupplierName**.</span></span>

![Products DataTable には2つの新しい列があります。](creating-a-data-access-layer-cs/_static/image82.png)

<span data-ttu-id="56f5c-379">**図 30**: **Products** DataTable に2つの新しい列がある</span><span class="sxs-lookup"><span data-stu-id="56f5c-379">**Figure 30**: The **Products** DataTable has Two New Columns</span></span>

<span data-ttu-id="56f5c-380">**Get$ Bycategoryid (*categoryID*)** メソッドの**SELECT**句も更新します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-380">Take a moment to update the **SELECT** clause in the **GetProductsByCategoryID(*categoryID*)** method as well.</span></span>

<span data-ttu-id="56f5c-381">**Getproducts ()** を更新する場合は、[ **JOIN**構文を使用する **] を選択**すると、データセットデザイナーで DB direct パターンを使用してデータベースデータの挿入、更新、および削除を行うためのメソッドを自動生成できなくなります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-381">If you update the **GetProducts()** **SELECT** using **JOIN** syntax the DataSet Designer won't be able to auto-generate the methods for inserting, updating, and deleting database data using the DB direct pattern.</span></span> <span data-ttu-id="56f5c-382">代わりに、このチュートリアルの前の「 **Insertproduct**メソッド」で行ったのと同じように手動で作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-382">Instead, you'll have to manually create them much like we did with the **InsertProduct** method earlier in this tutorial.</span></span> <span data-ttu-id="56f5c-383">さらに、バッチ更新パターンを使用する場合は、手動で**InsertCommand**、 **UpdateCommand**、および**DeleteCommand**プロパティの値を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-383">Furthermore, you'll manually have to provide the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** property values if you want to use the batch updating pattern.</span></span>

## <a name="adding-the-remaining-tableadapters"></a><span data-ttu-id="56f5c-384">残りの Tableadapter の追加</span><span class="sxs-lookup"><span data-stu-id="56f5c-384">Adding the Remaining TableAdapters</span></span>

<span data-ttu-id="56f5c-385">これまでは、1つのデータベーステーブルに対して1つの TableAdapter を操作するだけでした。</span><span class="sxs-lookup"><span data-stu-id="56f5c-385">Up until now, we've only looked at working with a single TableAdapter for a single database table.</span></span> <span data-ttu-id="56f5c-386">ただし、Northwind データベースには、web アプリケーションで使用する必要がある関連テーブルがいくつか含まれています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-386">However, the Northwind database contains several related tables that we'll need to work with in our web application.</span></span> <span data-ttu-id="56f5c-387">型指定されたデータセットには、関連する複数の Datatable を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-387">A Typed DataSet can contain multiple, related DataTables.</span></span> <span data-ttu-id="56f5c-388">そのため、DAL を完了するには、これらのチュートリアルで使用する他のテーブルの Datatable を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-388">Therefore, to complete our DAL we need to add DataTables for the other tables we'll be using in these tutorials.</span></span> <span data-ttu-id="56f5c-389">型指定されたデータセットに新しい TableAdapter を追加するには、データセットデザイナーを開き、デザイナーで右クリックして、[追加/TableAdapter] を選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-389">To add a new TableAdapter to a Typed DataSet, open the DataSet Designer, right-click in the Designer, and choose Add / TableAdapter.</span></span> <span data-ttu-id="56f5c-390">これにより、新しい DataTable と TableAdapter が作成され、このチュートリアルの前半で説明したウィザードが表示されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-390">This will create a new DataTable and TableAdapter and walk you through the wizard we examined earlier in this tutorial.</span></span>

<span data-ttu-id="56f5c-391">次のクエリを使用して、次の Tableadapter とメソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-391">Take a few minutes to create the following TableAdapters and methods using the following queries.</span></span> <span data-ttu-id="56f5c-392">**ProductsTableAdapter**のクエリには、各製品のカテゴリ名と仕入先名を取得するサブクエリが含まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="56f5c-392">Note that the queries in the **ProductsTableAdapter** include the subqueries to grab each product's category and supplier names.</span></span> <span data-ttu-id="56f5c-393">また、 **ProductsTableAdapter**クラスの**getproducts ()** メソッドと**getproducts bycategoryid (*categoryid*)** メソッドを既に追加してある場合もあります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-393">Additionally, if you've been following along, you've already added the **ProductsTableAdapter** class's **GetProducts()** and **GetProductsByCategoryID(*categoryID*)** methods.</span></span>

- <span data-ttu-id="56f5c-394">**ProductsTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="56f5c-394">**ProductsTableAdapter**</span></span>

  - <span data-ttu-id="56f5c-395">**Getproducts**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-395">**GetProducts**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample10.sql)]
  - <span data-ttu-id="56f5c-396">**Get製品 Bycategoryid**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-396">**GetProductsByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample11.sql)]
  - <span data-ttu-id="56f5c-397">**Get製品 By仕入**先:</span><span class="sxs-lookup"><span data-stu-id="56f5c-397">**GetProductsBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample12.sql)]
  - <span data-ttu-id="56f5c-398">**Getproductbyproductid**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-398">**GetProductByProductID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample13.sql)]
- <span data-ttu-id="56f5c-399">**CategoriesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="56f5c-399">**CategoriesTableAdapter**</span></span>

  - <span data-ttu-id="56f5c-400">**GetCategories**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-400">**GetCategories**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample14.sql)]
  - <span data-ttu-id="56f5c-401">**Getカテゴリ Bycategoryid**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-401">**GetCategoryByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample15.sql)]
- <span data-ttu-id="56f5c-402">**SuppliersTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="56f5c-402">**SuppliersTableAdapter**</span></span>

  - <span data-ttu-id="56f5c-403">**Getsuppliers**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-403">**GetSuppliers**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample16.sql)]
  - <span data-ttu-id="56f5c-404">**GetSuppliersByCountry**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-404">**GetSuppliersByCountry**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample17.sql)]
  - <span data-ttu-id="56f5c-405">**GetSupplierBySupplierID**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-405">**GetSupplierBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample18.sql)]
- <span data-ttu-id="56f5c-406">**EmployeesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="56f5c-406">**EmployeesTableAdapter**</span></span>

  - <span data-ttu-id="56f5c-407">**GetEmployees**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-407">**GetEmployees**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample19.sql)]
  - <span data-ttu-id="56f5c-408">**GetEmployeesByManager**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-408">**GetEmployeesByManager**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample20.sql)]
  - <span data-ttu-id="56f5c-409">**GetEmployeeByEmployeeID**:</span><span class="sxs-lookup"><span data-stu-id="56f5c-409">**GetEmployeeByEmployeeID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample21.sql)]

<span data-ttu-id="56f5c-410">[4つの Tableadapter が追加された後のデータセットデザイナーの ![](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-410">[![The DataSet Designer After the Four TableAdapters Have Been Added](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span></span>

<span data-ttu-id="56f5c-411">**図 31**: 4 つの Tableadapter を追加した後のデータセットデザイナー ([クリックすると、フルサイズのイメージが表示](creating-a-data-access-layer-cs/_static/image85.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-411">**Figure 31**: The DataSet Designer After the Four TableAdapters Have Been Added ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image85.png))</span></span>

## <a name="adding-custom-code-to-the-dal"></a><span data-ttu-id="56f5c-412">DAL へのカスタムコードの追加</span><span class="sxs-lookup"><span data-stu-id="56f5c-412">Adding Custom Code to the DAL</span></span>

<span data-ttu-id="56f5c-413">型指定されたデータセットに追加された Tableadapter と Datatable は、XML スキーマ定義ファイル (**Northwind .xsd**) として表現されます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-413">The TableAdapters and DataTables added to the Typed DataSet are expressed as an XML Schema Definition file (**Northwind.xsd**).</span></span> <span data-ttu-id="56f5c-414">このスキーマ情報を表示するには、ソリューションエクスプローラーで**Northwind .xsd**ファイルを右クリックし、[コードの表示] を選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-414">You can view this schema information by right-clicking on the **Northwind.xsd** file in the Solution Explorer and choosing View Code.</span></span>

<span data-ttu-id="56f5c-415">[Northwinds 型指定されたデータセットの XML スキーマ定義 (XSD) ファイルの ![](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-415">[![The XML Schema Definition (XSD) File for the Northwinds Typed DataSet](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span></span>

<span data-ttu-id="56f5c-416">**図 32**: Northwinds に型指定されたデータセットの XML スキーマ定義 (XSD) ファイル ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image88.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-416">**Figure 32**: The XML Schema Definition (XSD) File for the Northwinds Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image88.png))</span></span>

<span data-ttu-id="56f5c-417">このスキーマ情報は、コンパイルC#時または実行時 (必要な場合) に、デザイン時にコードに変換または Visual Basic します。その時点でデバッガーでステップスルーすることができます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-417">This schema information is translated into C# or Visual Basic code at design time when compiled or at runtime (if needed), at which point you can step through it with the debugger.</span></span> <span data-ttu-id="56f5c-418">この自動生成されたコードを表示するには、クラスビューに移動し、TableAdapter または型指定されたデータセットクラスにドリルダウンします。</span><span class="sxs-lookup"><span data-stu-id="56f5c-418">To view this auto-generated code go to the Class View and drill down to the TableAdapter or Typed DataSet classes.</span></span> <span data-ttu-id="56f5c-419">画面にクラスビューが表示されない場合は、[表示] メニューに移動し、そこから選択するか、Ctrl + Shift + C キーを押します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-419">If you don't see the Class View on your screen, go to the View menu and select it from there, or hit Ctrl+Shift+C.</span></span> <span data-ttu-id="56f5c-420">クラスビューから、型指定されたデータセットと TableAdapter クラスのプロパティ、メソッド、およびイベントを確認できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-420">From the Class View you can see the properties, methods, and events of the Typed DataSet and TableAdapter classes.</span></span> <span data-ttu-id="56f5c-421">特定のメソッドのコードを表示するには、クラスビューでメソッド名をダブルクリックするか、それを右クリックして [定義へのジャンプ] を選択します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-421">To view the code for a particular method, double-click the method name in the Class View or right-click on it and choose Go To Definition.</span></span>

![[定義へのジャンプ] を選択して、自動生成されたコードを調べクラスビュー](creating-a-data-access-layer-cs/_static/image89.png)

<span data-ttu-id="56f5c-423">**図 33**: [クラスビューからの定義へのジャンプ] を選択して、自動生成されたコードを検査する</span><span class="sxs-lookup"><span data-stu-id="56f5c-423">**Figure 33**: Inspect the Auto-Generated Code by Selecting Go To Definition from the Class View</span></span>

<span data-ttu-id="56f5c-424">自動生成されるコードは、かなりの時間の節約になりますが、多くの場合、コードは非常に一般的であり、アプリケーションの固有のニーズを満たすようにカスタマイズする必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-424">While auto-generated code can be a great time saver, the code is often very generic and needs to be customized to meet the unique needs of an application.</span></span> <span data-ttu-id="56f5c-425">ただし、自動生成されたコードを拡張するリスクは、コードを生成したツールによって "再生成" され、カスタマイズが上書きされる可能性があるということです。</span><span class="sxs-lookup"><span data-stu-id="56f5c-425">The risk of extending auto-generated code, though, is that the tool that generated the code might decide it's time to "regenerate" and overwrite your customizations.</span></span> <span data-ttu-id="56f5c-426">.NET 2.0 の新しい部分クラスの概念を使用すると、複数のファイルにクラスを簡単に分割できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-426">With .NET 2.0's new partial class concept, it's easy to split a class across multiple files.</span></span> <span data-ttu-id="56f5c-427">これにより、Visual Studio によるカスタマイズの上書きを気にせずに、独自のメソッド、プロパティ、およびイベントを自動生成されたクラスに追加できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-427">This enables us to add our own methods, properties, and events to the auto-generated classes without having to worry about Visual Studio overwriting our customizations.</span></span>

<span data-ttu-id="56f5c-428">DAL をカスタマイズする方法を示すために、 **Getproducts ()** メソッドを**SuppliersRow**クラスに追加してみましょう。</span><span class="sxs-lookup"><span data-stu-id="56f5c-428">To demonstrate how to customize the DAL, let's add a **GetProducts()** method to the **SuppliersRow** class.</span></span> <span data-ttu-id="56f5c-429">**SuppliersRow**クラスは、**仕入先**テーブル内の1つのレコードを表します。各供給業者は、プロバイダーをゼロにすることができます。したがって、 **Getproducts ()** は、指定された仕入先の製品を返します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-429">The **SuppliersRow** class represents a single record in the **Suppliers** table; each supplier can provider zero to many products, so **GetProducts()** will return those products of the specified supplier.</span></span> <span data-ttu-id="56f5c-430">これを実現するには、 **SuppliersRow.cs**という名前の新しいクラスファイルを**アプリ\_コード**フォルダーに作成し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-430">To accomplish this create a new class file in the **App\_Code** folder named **SuppliersRow.cs** and add the following code:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample22.cs)]

<span data-ttu-id="56f5c-431">この部分クラスは、定義した**Getproducts ()** メソッドを含めるように**SuppliersRow**クラスをビルドするときに、コンパイラに指示します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-431">This partial class instructs the compiler that when building the **Northwind.SuppliersRow** class to include the **GetProducts()** method we just defined.</span></span> <span data-ttu-id="56f5c-432">プロジェクトをビルドし、クラスビューに戻ると、 **SuppliersRow**のメソッドとして**getproducts ()** が表示されるようになります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-432">If you build your project and then return to the Class View you'll see **GetProducts()** now listed as a method of **Northwind.SuppliersRow**.</span></span>

![GetProducts () メソッドが SuppliersRow クラスの一部になりました。](creating-a-data-access-layer-cs/_static/image90.png)

<span data-ttu-id="56f5c-434">**図 34**: **getproducts ()** メソッドが、 **SuppliersRow**クラスの一部になっている</span><span class="sxs-lookup"><span data-stu-id="56f5c-434">**Figure 34**: The **GetProducts()** Method is Now Part of the **Northwind.SuppliersRow** Class</span></span>

<span data-ttu-id="56f5c-435">次のコードに示すように、 **Getproducts ()** メソッドを使用して、特定の業者の製品セットを列挙できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="56f5c-435">The **GetProducts()** method can now be used to enumerate the set of products for a particular supplier, as the following code shows:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample23.html)]

<span data-ttu-id="56f5c-436">このデータは、任意の ASP で表示することもできます。NET のデータ Web コントロール。</span><span class="sxs-lookup"><span data-stu-id="56f5c-436">This data can also be displayed in any of ASP.NET's data Web controls.</span></span> <span data-ttu-id="56f5c-437">次のページでは、GridView コントロールと2つのフィールドが使用されています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-437">The following page uses a GridView control with two fields:</span></span>

- <span data-ttu-id="56f5c-438">各業者の名前を表示する BoundField</span><span class="sxs-lookup"><span data-stu-id="56f5c-438">A BoundField that displays the name of each supplier, and</span></span>
- <span data-ttu-id="56f5c-439">各仕入先の**Getproducts ()** メソッドによって返される結果にバインドされる BulletedList コントロールを含む TemplateField。</span><span class="sxs-lookup"><span data-stu-id="56f5c-439">A TemplateField that contains a BulletedList control that is bound to the results returned by the **GetProducts()** method for each supplier.</span></span>

<span data-ttu-id="56f5c-440">このようなマスター/詳細レポートを今後のチュートリアルで表示する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-440">We'll examine how to display such master-detail reports in future tutorials.</span></span> <span data-ttu-id="56f5c-441">ここでは、この例は、 **SuppliersRow**クラスに追加されたカスタムメソッドの使用方法を示すように設計されています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-441">For now, this example is designed to illustrate using the custom method added to the **Northwind.SuppliersRow** class.</span></span>

<span data-ttu-id="56f5c-442">SuppliersAndProducts</span><span class="sxs-lookup"><span data-stu-id="56f5c-442">SuppliersAndProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample24.aspx)]

<span data-ttu-id="56f5c-443">SuppliersAndProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="56f5c-443">SuppliersAndProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample25.cs)]

<span data-ttu-id="56f5c-444">[仕入先の会社名が左側の列に一覧表示されている ![、右側に製品が表示されます。](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span><span class="sxs-lookup"><span data-stu-id="56f5c-444">[![The Supplier's Company Name is Listed in the Left Column, Their Products in the Right](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span></span>

<span data-ttu-id="56f5c-445">**図 35**: 仕入先の会社名が左側の列に一覧表示され、右側に製品が表示される ([クリックすると、フルサイズの画像が表示](creating-a-data-access-layer-cs/_static/image93.png)されます)</span><span class="sxs-lookup"><span data-stu-id="56f5c-445">**Figure 35**: The Supplier's Company Name is Listed in the Left Column, Their Products in the Right ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image93.png))</span></span>

## <a name="summary"></a><span data-ttu-id="56f5c-446">まとめ</span><span class="sxs-lookup"><span data-stu-id="56f5c-446">Summary</span></span>

<span data-ttu-id="56f5c-447">Web アプリケーションを構築する場合、DAL は、プレゼンテーション層の作成を開始する前に最初に実行する手順の1つである必要があります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-447">When building a web application creating the DAL should be one of your first steps, occurring before you start creating your presentation layer.</span></span> <span data-ttu-id="56f5c-448">Visual Studio では、型指定されたデータセットに基づいて DAL を作成するタスクは、コード行を記述しなくても10-15 分で実現できます。</span><span class="sxs-lookup"><span data-stu-id="56f5c-448">With Visual Studio, creating a DAL based on Typed DataSets is a task that can be accomplished in 10-15 minutes without writing a line of code.</span></span> <span data-ttu-id="56f5c-449">前のチュートリアルでは、この DAL を基にしています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-449">The tutorials moving forward will build upon this DAL.</span></span> <span data-ttu-id="56f5c-450">次の[チュートリアル](creating-a-business-logic-layer-cs.md)では、さまざまなビジネスルールを定義し、それらを個別のビジネスロジックレイヤーに実装する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-450">In the [next tutorial](creating-a-business-logic-layer-cs.md) we'll define a number of business rules and see how to implement them in a separate Business Logic Layer.</span></span>

<span data-ttu-id="56f5c-451">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="56f5c-451">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="56f5c-452">関連項目</span><span class="sxs-lookup"><span data-stu-id="56f5c-452">Further Reading</span></span>

<span data-ttu-id="56f5c-453">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="56f5c-453">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="56f5c-454">VS 2005 および ASP.NET 2.0 での厳密に型指定された Tableadapter と Datatable を使用した DAL の構築</span><span class="sxs-lookup"><span data-stu-id="56f5c-454">Building a DAL using Strongly Typed TableAdapters and DataTables in VS 2005 and ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/435498)
- [<span data-ttu-id="56f5c-455">データ層コンポーネントの設計と層によるデータの受け渡し</span><span class="sxs-lookup"><span data-stu-id="56f5c-455">Designing Data Tier Components and Passing Data Through Tiers</span></span>](https://msdn.microsoft.com/library/ms978496.aspx)
- [<span data-ttu-id="56f5c-456">Visual Studio 2005 データセットデザイナーを使用してデータアクセス層を構築する</span><span class="sxs-lookup"><span data-stu-id="56f5c-456">Build a Data Access Layer with the Visual Studio 2005 DataSet Designer</span></span>](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)
- [<span data-ttu-id="56f5c-457">ASP.NET 2.0 アプリケーションの構成情報の暗号化</span><span class="sxs-lookup"><span data-stu-id="56f5c-457">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="56f5c-458">TableAdapter の概要</span><span class="sxs-lookup"><span data-stu-id="56f5c-458">TableAdapter Overview</span></span>](https://msdn.microsoft.com/library/bz9tthwx.aspx)
- [<span data-ttu-id="56f5c-459">型指定されたデータセットの操作</span><span class="sxs-lookup"><span data-stu-id="56f5c-459">Working with a Typed DataSet</span></span>](https://msdn.microsoft.com/library/esbykkzb.aspx)
- [<span data-ttu-id="56f5c-460">Visual Studio 2005 および ASP.NET 2.0 での厳密に型指定されたデータアクセスの使用</span><span class="sxs-lookup"><span data-stu-id="56f5c-460">Using Strongly-Typed Data Access in Visual Studio 2005 and ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/020806-1.aspx)
- [<span data-ttu-id="56f5c-461">TableAdapter メソッドを拡張する方法</span><span class="sxs-lookup"><span data-stu-id="56f5c-461">How to Extend TableAdapter Methods</span></span>](https://blogs.msdn.com/vbteam/archive/2005/05/04/ExtendingTableAdapters.aspx)
- [<span data-ttu-id="56f5c-462">ストアドプロシージャからスカラーデータを取得する</span><span class="sxs-lookup"><span data-stu-id="56f5c-462">Retrieving Scalar Data from a Stored Procedure</span></span>](http://aspnet.4guysfromrolla.com/articles/062905-1.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="56f5c-463">このチュートリアルに含まれるトピックのビデオトレーニング</span><span class="sxs-lookup"><span data-stu-id="56f5c-463">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="56f5c-464">ASP.NET アプリケーションのデータ アクセス層</span><span class="sxs-lookup"><span data-stu-id="56f5c-464">Data Access Layers in ASP.NET Applications</span></span>](../../../videos/data-access/adonet-data-services/data-access-layers-in-aspnet-applications.md)
- [<span data-ttu-id="56f5c-465">データセットを Datagrid に手動でバインドする方法</span><span class="sxs-lookup"><span data-stu-id="56f5c-465">How to Manually Bind a Dataset to a Datagrid</span></span>](../../../videos/data-access/adonet-data-services/how-to-manually-bind-a-dataset-to-a-datagrid.md)
- [<span data-ttu-id="56f5c-466">ASP アプリケーションからデータセットとフィルターを操作する方法</span><span class="sxs-lookup"><span data-stu-id="56f5c-466">How to Work with Datasets and Filters from an ASP Application</span></span>](../../../videos/data-access/adonet-data-services/how-to-work-with-datasets-and-filters-from-an-asp-application.md)

## <a name="about-the-author"></a><span data-ttu-id="56f5c-467">作成者について</span><span class="sxs-lookup"><span data-stu-id="56f5c-467">About the Author</span></span>

<span data-ttu-id="56f5c-468">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="56f5c-469">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="56f5c-469">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="56f5c-470">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="56f5c-470">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="56f5c-471">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="56f5c-471">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="56f5c-472">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="56f5c-472">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="56f5c-473">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="56f5c-473">Special Thanks To</span></span>

<span data-ttu-id="56f5c-474">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="56f5c-474">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="56f5c-475">このチュートリアルのリードレビュー担当者は、Ron Green、Hilton Giesenow、Patterson が、Liz Shulok、Abel Gomez、および Carlos Santos でした。</span><span class="sxs-lookup"><span data-stu-id="56f5c-475">Lead reviewers for this tutorial were Ron Green, Hilton Giesenow, Dennis Patterson, Liz Shulok, Abel Gomez, and Carlos Santos.</span></span> <span data-ttu-id="56f5c-476">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="56f5c-476">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="56f5c-477">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="56f5c-477">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="56f5c-478">次へ</span><span class="sxs-lookup"><span data-stu-id="56f5c-478">Next</span></span>](creating-a-business-logic-layer-cs.md)
