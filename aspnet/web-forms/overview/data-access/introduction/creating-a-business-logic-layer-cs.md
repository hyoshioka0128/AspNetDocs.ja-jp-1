---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: ビジネスロジック層 (C#) を作成するMicrosoft Docs
author: rick-anderson
description: このチュートリアルでは、データ交換の仲介者として機能するビジネスロジック層 (BLL) にビジネスルールを一元化する方法について説明します。
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: df96f3e7422a0537bf1b003a33fe8d71a671ac33
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78490402"
---
# <a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="0ffc1-103">ビジネス ロジック層を作成する (C#)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-103">Creating a Business Logic Layer (C#)</span></span>

<span data-ttu-id="0ffc1-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0ffc1-105">[サンプルアプリのダウンロード](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe)または[PDF のダウンロード](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-105">[Download Sample App](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="0ffc1-106">このチュートリアルでは、プレゼンテーション層と DAL 間のデータ交換の仲介役として機能するビジネスロジック層 (BLL) にビジネスルールを一元化する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>

## <a name="introduction"></a><span data-ttu-id="0ffc1-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="0ffc1-107">Introduction</span></span>

<span data-ttu-id="0ffc1-108">[最初のチュートリアル](creating-a-data-access-layer-cs.md)で作成したデータアクセス層 (DAL) は、データアクセスロジックをプレゼンテーションロジックから明確に分離します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="0ffc1-109">ただし、DAL では、データアクセスの詳細がプレゼンテーション層から明確に分離されますが、適用されるビジネスルールは適用されません。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="0ffc1-110">たとえば、アプリケーションの場合、`Discontinued` フィールドが1に設定されているときは `Products` テーブルの `CategoryID` または `SupplierID` フィールドを変更しないようにするか、勤続ルールを適用して、従業員が雇用されたユーザーによって従業員が管理される状況を禁止することができます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="0ffc1-111">もう1つの一般的なシナリオは、特定のロールのユーザーのみが製品を削除したり、`UnitPrice` 値を変更したりできるということです。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="0ffc1-112">このチュートリアルでは、これらのビジネスルールを、プレゼンテーション層と DAL 間のデータ交換の仲介役として機能するビジネスロジック層 (BLL) に集約する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="0ffc1-113">実際のアプリケーションでは、BLL を別のクラスライブラリプロジェクトとして実装する必要があります。ただし、これらのチュートリアルでは、プロジェクトの構造を簡略化するために、BLL を `App_Code` フォルダー内の一連のクラスとして実装します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="0ffc1-114">図1は、プレゼンテーション層、BLL、および DAL 間のアーキテクチャの関係を示しています。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>

![BLL は、プレゼンテーション層とデータアクセス層を分離し、ビジネスルールを適用します。](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="0ffc1-116">**図 1**: BLL によって、プレゼンテーション層とデータアクセス層が分離され、ビジネスルールが適用される</span><span class="sxs-lookup"><span data-stu-id="0ffc1-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>

## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="0ffc1-117">手順 1: BLL クラスの作成</span><span class="sxs-lookup"><span data-stu-id="0ffc1-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="0ffc1-118">BLL は、DAL 内の各 TableAdapter 用に1つずつ、4つのクラスで構成されます。これらの BLL クラスにはそれぞれ、適切なビジネスルールを適用して、DAL 内のそれぞれの TableAdapter から取得、挿入、更新、および削除するためのメソッドが用意されています。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="0ffc1-119">DAL および BLL に関連するクラスをより明確に分離するには、`App_Code` フォルダー、`DAL` および `BLL`に2つのサブフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="0ffc1-120">ソリューションエクスプローラーの `App_Code` フォルダーを右クリックし、[新しいフォルダー] を選択します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="0ffc1-121">これらの2つのフォルダーを作成したら、最初のチュートリアルで作成した型指定されたデータセットを `DAL` サブフォルダーに移動します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="0ffc1-122">次に、4つの BLL クラスファイルを `BLL` サブフォルダーに作成します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="0ffc1-123">これを行うには、[`BLL`] サブフォルダーを右クリックし、[新しい項目の追加] をクリックして、[クラス] テンプレートを選択します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="0ffc1-124">`ProductsBLL`、`CategoriesBLL`、`SuppliersBLL`、および `EmployeesBLL`の4つのクラスに名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>

![App_Code フォルダーに4つの新しいクラスを追加する](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="0ffc1-126">**図 2**: `App_Code` フォルダーに4つの新しいクラスを追加する</span><span class="sxs-lookup"><span data-stu-id="0ffc1-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>

<span data-ttu-id="0ffc1-127">次に、各クラスにメソッドを追加して、最初のチュートリアルで Tableadapter 用に定義されたメソッドをラップするだけです。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="0ffc1-128">現時点では、これらのメソッドは、DAL に直接を呼び出します。必要なビジネスロジックを追加するには、後でを返します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="0ffc1-129">Visual Studio Standard Edition 以上を使用している場合 (つまり、Visual Web Developer を使用して*いない*場合)、必要に応じて[クラスデザイナー](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp)を使用してクラスを視覚的にデザインできます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="0ffc1-130">Visual Studio のこの新機能の詳細については、[クラスデザイナーのブログ](https://blogs.msdn.com/classdesigner/default.aspx)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>

<span data-ttu-id="0ffc1-131">`ProductsBLL` クラスでは、合計7つのメソッドを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="0ffc1-132">すべての製品を返す `GetProducts()`</span><span class="sxs-lookup"><span data-stu-id="0ffc1-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="0ffc1-133">指定された製品 ID を持つ製品を返す `GetProductByProductID(productID)`</span><span class="sxs-lookup"><span data-stu-id="0ffc1-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="0ffc1-134">指定されたカテゴリのすべての製品を返す `GetProductsByCategoryID(categoryID)`</span><span class="sxs-lookup"><span data-stu-id="0ffc1-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="0ffc1-135">指定された業者からすべての製品を返す `GetProductsBySupplier(supplierID)`</span><span class="sxs-lookup"><span data-stu-id="0ffc1-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="0ffc1-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` は、渡された値を使用して新しい製品をデータベースに挿入します。新しく挿入されたレコードの `ProductID` 値を返します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="0ffc1-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` は、渡された値を使用してデータベース内の既存の製品を更新します。1行だけ更新された場合は `true` を返します。それ以外の場合は `false`</span><span class="sxs-lookup"><span data-stu-id="0ffc1-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="0ffc1-138">指定された製品をデータベースから削除 `DeleteProduct(productID)`</span><span class="sxs-lookup"><span data-stu-id="0ffc1-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="0ffc1-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="0ffc1-139">ProductsBLL.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="0ffc1-140">単にデータ `GetProducts`、`GetProductByProductID`、`GetProductsByCategoryID`、および `GetProductBySuppliersID` を返すメソッドは、単に DAL にコールダウンするだけで非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="0ffc1-141">一部のシナリオでは、このレベルで実装する必要があるビジネスルール (現在ログオンしているユーザーに基づく承認規則や、ユーザーが所属するロールなど) がある場合は、これらのメソッドをそのままにします。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="0ffc1-142">これらのメソッドでは、BLL はプロキシとしてのみ機能し、プレゼンテーション層はデータアクセス層から基になるデータにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="0ffc1-143">`AddProduct` メソッドと `UpdateProduct` メソッドは、両方ともパラメーターとしてさまざまな product フィールドの値を受け取り、新しい製品を追加したり、既存の製品を更新したりします。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="0ffc1-144">`Product` テーブルの列の多くは `NULL` の値 (`CategoryID`、`SupplierID`、および `UnitPrice`を受け取ることができるため、いくつかの列に名前を付けることができます。これらの列にマップする `AddProduct` と `UpdateProduct` の入力パラメーターは、 [null 許容型](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx)を使用します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="0ffc1-145">Null 許容型は .NET 2.0 の新機能であり、値型を `null`する必要があるかどうかを示す手法を提供します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="0ffc1-146">でC#は、型の後に `?` を追加することで (`int? x;`など)、値型を null 許容型としてフラグを付けることができます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="0ffc1-147">詳細については、 [ C#プログラミングガイド](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx)の「 [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) 」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="0ffc1-148">この3つのメソッドはいずれも、行が挿入、更新、または削除されたかどうかを示すブール値を返します。これは、操作によって影響を受ける行がない可能性があるためです。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="0ffc1-149">たとえば、ページ開発者が、存在しない製品の `ProductID` を渡す `DeleteProduct` を呼び出すと、データベースに対して発行された `DELETE` ステートメントは影響を受けないため、`DeleteProduct` メソッドは `false`を返します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="0ffc1-150">新しい製品を追加したり、既存の製品を更新したりするときには、`ProductsRow` インスタンスを使用するのではなく、新しいまたは変更された製品のフィールド値をスカラーの一覧として取得することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="0ffc1-151">`ProductsRow` クラスは、既定のパラメーターなしのコンストラクターを持たない ADO.NET `DataRow` クラスから派生するため、この方法が選択されました。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="0ffc1-152">新しい `ProductsRow` インスタンスを作成するには、まず `ProductsDataTable` インスタンスを作成し、その `NewProductRow()` メソッド (`AddProduct`で実行) を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="0ffc1-153">この欠点は、ObjectDataSource を使用して製品を挿入および更新するときに、そのようになります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="0ffc1-154">つまり、ObjectDataSource は入力パラメーターのインスタンスの作成を試みます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="0ffc1-155">BLL メソッドが `ProductsRow` インスタンスを必要とする場合、ObjectDataSource は1つのインスタンスを作成しようとしますが、既定のパラメーターなしのコンストラクターがないため失敗します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="0ffc1-156">この問題の詳細については、次の2つの ASP.NET フォーラムの投稿を参照してください。[厳密に型指定されたデータセットを使用した Objectdatasources の更新](https://forums.asp.net/1098630/ShowPost.aspx)と、 [ObjectDataSource と厳密に型指定されたデータセットに関する問題](https://forums.asp.net/1048212/ShowPost.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="0ffc1-157">次に、`AddProduct` と `UpdateProduct`の両方で、コードは `ProductsRow` インスタンスを作成し、渡されただけの値を設定します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="0ffc1-158">DataRow の DataColumns に値を代入すると、さまざまなフィールドレベルの検証チェックが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="0ffc1-159">したがって、渡された値を DataRow に手動で配置することで、BLL メソッドに渡されるデータの有効性を確保することができます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="0ffc1-160">残念ながら、Visual Studio によって生成される厳密に型指定された DataRow クラスでは、null 許容型は使用されません。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="0ffc1-161">代わりに、DataRow 内の特定の DataColumn が `NULL` データベース値に対応する必要があることを示すには、`SetColumnNameNull()` メソッドを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="0ffc1-162">`UpdateProduct`、最初に製品を読み込み、`GetProductByProductID(productID)`を使用して更新します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="0ffc1-163">これはデータベースへの不要なトリップのように思えるかもしれませんが、オプティミスティック同時実行制御について説明する今後のチュートリアルでは、この余分な旅行に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="0ffc1-164">オプティミスティック同時実行制御は、同じデータに対して同時に作業している2人のユーザーが、誤って別の変更を上書きしないようにするための手法です。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="0ffc1-165">レコード全体を取得することにより、DataRow の列のサブセットのみを変更する更新メソッドを作成しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="0ffc1-166">`SuppliersBLL` クラスを探索すると、このような例が表示されます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="0ffc1-167">最後に、`ProductsBLL` クラスには、 [DataObject 属性](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx)が適用されていることに注意してください (ファイルの先頭付近にある class ステートメントの直前にある `[System.ComponentModel.DataObject]` 構文)。メソッドには[DataObjectMethodAttribute 属性](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx)があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="0ffc1-168">`DataObject` 属性は、クラスを[ObjectDataSource コントロール](https://msdn.microsoft.com/library/9a4kyhcx.aspx)へのバインドに適したオブジェクトとしてマークしますが、`DataObjectMethodAttribute` はメソッドの目的を示します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="0ffc1-169">今後のチュートリアルで説明するように、ASP.NET 2.0 の ObjectDataSource を使用すると、クラスのデータに簡単に宣言できます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="0ffc1-170">ObjectDataSource のウィザードで、使用可能なクラスの一覧をフィルター処理してバインドするには、既定では `DataObjects` としてマークされたクラスのみがウィザードのドロップダウンリストに表示されます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="0ffc1-171">`ProductsBLL` クラスはこれらの属性がなくても機能しますが、これらを追加すると、ObjectDataSource のウィザードでの操作が簡単になります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="0ffc1-172">その他のクラスの追加</span><span class="sxs-lookup"><span data-stu-id="0ffc1-172">Adding the Other Classes</span></span>

<span data-ttu-id="0ffc1-173">`ProductsBLL` クラスが完成したら、カテゴリ、仕入先、および従業員を操作するためのクラスを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="0ffc1-174">前の例の概念を使用して、次のクラスとメソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="0ffc1-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="0ffc1-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="0ffc1-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="0ffc1-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="0ffc1-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="0ffc1-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="0ffc1-178">注目すべき1つの方法は、`SuppliersBLL` クラスの `UpdateSupplierAddress` メソッドです。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="0ffc1-179">このメソッドは、業者のアドレス情報だけを更新するためのインターフェイスを提供します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="0ffc1-180">内部的には、このメソッドは、指定された `supplierID` (`GetSupplierBySupplierID`を使用) の `SupplierDataRow` オブジェクトを読み取り、そのアドレス関連のプロパティを設定して、`SupplierDataTable`の `Update` メソッドにを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="0ffc1-181">`UpdateSupplierAddress` メソッドは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-181">The `UpdateSupplierAddress` method follows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="0ffc1-182">BLL クラスの完全な実装については、この記事のダウンロードを参照してください。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="0ffc1-183">手順 2: BLL クラスを使用して型指定されたデータセットにアクセスする</span><span class="sxs-lookup"><span data-stu-id="0ffc1-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="0ffc1-184">最初のチュートリアルでは、型指定されたデータセットをプログラムで直接操作する例を紹介しましたが、BLL クラスを追加すると、代わりに BLL に対してプレゼンテーション層が機能する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="0ffc1-185">最初のチュートリアルの `AllProducts.aspx` 例では、次のコードに示すように、`ProductsTableAdapter` を使用して製品の一覧を GridView にバインドしました。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="0ffc1-186">新しい BLL クラスを使用するには、変更する必要があるのは、単に `ProductsTableAdapter` オブジェクトを `ProductBLL` オブジェクトに置き換えるだけです。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="0ffc1-187">BLL クラスは、ObjectDataSource を使用して (型指定されたデータセットと同様に) 宣言によってアクセスすることもできます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="0ffc1-188">ObjectDataSource については、次のチュートリアルで詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>

<span data-ttu-id="0ffc1-189">[製品の一覧が GridView に表示される ![](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="0ffc1-190">**図 3**: 製品の一覧が GridView に表示される ([クリックすると、フルサイズの画像が表示](creating-a-business-logic-layer-cs/_static/image5.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>

## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="0ffc1-191">手順 3: DataRow クラスへのフィールドレベルの検証の追加</span><span class="sxs-lookup"><span data-stu-id="0ffc1-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="0ffc1-192">フィールドレベルの検証は、挿入または更新時のビジネスオブジェクトのプロパティ値に関連するチェックです。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="0ffc1-193">製品のフィールドレベルの検証規則には、次のようなものがあります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="0ffc1-194">`ProductName` フィールドは40文字以下でなければなりません</span><span class="sxs-lookup"><span data-stu-id="0ffc1-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="0ffc1-195">`QuantityPerUnit` フィールドの長さは20文字以下でなければなりません</span><span class="sxs-lookup"><span data-stu-id="0ffc1-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="0ffc1-196">`ProductID`、`ProductName`、および `Discontinued` フィールドが必要ですが、他のすべてのフィールドは省略可能です。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="0ffc1-197">`UnitPrice`、`UnitsInStock`、`UnitsOnOrder`、および `ReorderLevel` の各フィールドには0以上の値を指定する必要があります</span><span class="sxs-lookup"><span data-stu-id="0ffc1-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="0ffc1-198">これらのルールは、データベースレベルで表すことができます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="0ffc1-199">`ProductName` フィールドと `QuantityPerUnit` フィールドの文字数の制限は `Products` テーブルの列のデータ型によってキャプチャされます (`nvarchar(40)` と `nvarchar(20)`それぞれ)。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="0ffc1-200">データベーステーブル列で `NULL` が許可されている場合、フィールドが必須であり、省略可能であるかどうか。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="0ffc1-201">0以上の値だけが `UnitPrice`、`UnitsInStock`、`UnitsOnOrder`、または `ReorderLevel` の列になるように、4つの[check 制約](https://msdn.microsoft.com/library/ms188258.aspx)が存在します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="0ffc1-202">これらの規則は、データベースで適用するだけでなく、データセットレベルでも適用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="0ffc1-203">実際には、データテーブルの DataColumns のセットごとに、フィールドの長さと値が必須かどうか、または省略可能かどうかが既にキャプチャされています。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="0ffc1-204">自動的に入力された既存のフィールドレベルの検証を表示するには、データセットデザイナーにアクセスし、いずれかの Datatable からフィールドを選択して、プロパティウィンドウにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="0ffc1-205">図4に示すように、`ProductsDataTable` の `QuantityPerUnit` DataColumn の最大長は20文字で、`NULL` 値が許可されています。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="0ffc1-206">`ProductsDataRow`の `QuantityPerUnit` プロパティを20文字より長い文字列値に設定しようとすると、`ArgumentException` がスローされます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>

<span data-ttu-id="0ffc1-207">[DataColumn が ![基本的なフィールドレベルの検証を提供する](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="0ffc1-208">**図 4**: DataColumn は基本的なフィールドレベルの検証を提供します ([クリックすると、フルサイズの画像が表示](creating-a-business-logic-layer-cs/_static/image8.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>

<span data-ttu-id="0ffc1-209">残念ながら、プロパティウィンドウを通じて `UnitPrice` 値が0以上である必要があるなど、境界チェックを指定することはできません。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="0ffc1-210">この種類のフィールドレベルの検証を提供するには、DataTable の[Columnchanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx)イベントのイベントハンドラーを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="0ffc1-211">[前のチュートリアル](creating-a-data-access-layer-cs.md)で説明したように、型指定されたデータセットによって作成されるデータセット、datatable、および DataRow オブジェクトは、部分クラスを使用して拡張できます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="0ffc1-212">この手法を使用すると、`ProductsDataTable` クラスの `ColumnChanging` イベントハンドラーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="0ffc1-213">まず、`ProductsDataTable.ColumnChanging.cs`という名前の `App_Code` フォルダーにクラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>

<span data-ttu-id="0ffc1-214">[App_Code フォルダーに新しいクラスを追加 ![には](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="0ffc1-215">**図 5**: `App_Code` フォルダーに新しいクラスを追加する ([クリックすると、フルサイズの画像が表示](creating-a-business-logic-layer-cs/_static/image11.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>

<span data-ttu-id="0ffc1-216">次に、`UnitPrice`、`UnitsInStock`、`UnitsOnOrder`、および `ReorderLevel` 列の値が0以上であることを確認する `ColumnChanging` イベントのイベントハンドラーを作成します。`NULL`</span><span class="sxs-lookup"><span data-stu-id="0ffc1-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="0ffc1-217">このような列が範囲外の場合は、`ArgumentException`をスローします。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="0ffc1-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="0ffc1-218">ProductsDataTable.ColumnChanging.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="0ffc1-219">手順 4: BLL のクラスにカスタムビジネスルールを追加する</span><span class="sxs-lookup"><span data-stu-id="0ffc1-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="0ffc1-220">フィールドレベルの検証に加えて、次のように、1つの列レベルでは表現できないさまざまなエンティティまたは概念を含む高度なカスタムビジネスルールが存在する場合があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="0ffc1-221">製品が廃止された場合、その `UnitPrice` を更新することはできません</span><span class="sxs-lookup"><span data-stu-id="0ffc1-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="0ffc1-222">従業員の居住国は、管理者の居住国と同じである必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="0ffc1-223">供給業者によって提供される唯一の製品である場合、製品を廃止することはできません。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="0ffc1-224">BLL クラスには、アプリケーションのビジネスルールに準拠していることを確認するためのチェックが含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="0ffc1-225">これらのチェックは、適用するメソッドに直接追加できます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="0ffc1-226">ビジネスルールによって、特定の供給業者からの唯一の製品である製品を廃止済みとしてマークできなかったとします。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="0ffc1-227">つまり、製品*x*が supplier *Y*から購入した唯一の製品である場合、 *x*を廃止済みとしてマークできませんでした。ただし、supplier *Y*で*は、a*、 *B*、および*C*という3つの製品が提供されている場合、これらのいずれかを "廃止" としてマークできます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="0ffc1-228">しかし、ビジネスルールと一般的な意味は常に揃っていません。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="0ffc1-229">`UpdateProducts` 方法でこのビジネスルールを適用するには、まず、`Discontinued` が `true` に設定されているかどうかを確認し、その場合は `GetProductsBySupplierID` を呼び出して、この製品の供給業者から購入した製品の数を確認します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="0ffc1-230">この業者から購入した製品が1つだけの場合は、`ApplicationException`がスローされます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="0ffc1-231">プレゼンテーション層での検証エラーへの対応</span><span class="sxs-lookup"><span data-stu-id="0ffc1-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="0ffc1-232">プレゼンテーション層から BLL を呼び出すときに、発生する可能性のある例外を処理するか、ASP.NET にバブルアップさせるかを決定できます (これにより、`HttpApplication`の `Error` イベントが発生します)。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="0ffc1-233">プログラムを使用して BLL を操作するときに例外を処理するには、 [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx)ブロック。次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="0ffc1-234">今後のチュートリアルで説明するように、データ Web コントロールを使用してデータを挿入、更新、または削除するときに、BLL からバブルアップする例外の処理は、`try...catch` ブロックでコードをラップする必要があるのではなく、イベントハンドラーで直接処理できます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="0ffc1-235">まとめ</span><span class="sxs-lookup"><span data-stu-id="0ffc1-235">Summary</span></span>

<span data-ttu-id="0ffc1-236">適切に設計されたアプリケーションは、それぞれが特定のロールをカプセル化する別個の層に作られています。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="0ffc1-237">この記事シリーズの最初のチュートリアルでは、型指定されたデータセットを使用してデータアクセス層を作成しました。このチュートリアルでは、アプリケーションの `App_Code` フォルダーにある一連のクラスとしてビジネスロジック層を構築し、DAL を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="0ffc1-238">BLL は、アプリケーションのフィールドレベルおよびビジネスレベルのロジックを実装しています。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="0ffc1-239">このチュートリアルで行ったように、別の BLL を作成するだけでなく、部分クラスを使用して Tableadapter のメソッドを拡張することもできます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="0ffc1-240">ただし、この方法を使用しても、既存のメソッドをオーバーライドすることはできません。また、この記事で説明した方法と同様に、DAL と BLL を分離することもできません。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="0ffc1-241">DAL と BLL が完成したら、プレゼンテーション層から始めることができます。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="0ffc1-242">次の[チュートリアル](master-pages-and-site-navigation-cs.md)では、データアクセスのトピックから簡単な迂回を作成し、チュートリアル全体で使用する一貫性のあるページレイアウトを定義します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="0ffc1-243">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="0ffc1-244">著者について</span><span class="sxs-lookup"><span data-stu-id="0ffc1-244">About the Author</span></span>

<span data-ttu-id="0ffc1-245">1998以来、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)は 7 asp/創設者 of [4GuysFromRolla.com](http://www.4guysfromrolla.com)の執筆者であり、Microsoft Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0ffc1-246">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0ffc1-247">彼の最新の書籍は[ *、ASP.NET 2.0 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="0ffc1-248">mitchell@4GuysFromRolla.comでアクセスでき[ます。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="0ffc1-249">または彼のブログを参照してください。これは[http://ScottOnWriting.NET](http://ScottOnWriting.NET)にあります。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="0ffc1-250">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-250">Special Thanks To</span></span>

<span data-ttu-id="0ffc1-251">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="0ffc1-252">このチュートリアルのリードレビュー担当者は、Liz Shulok、Patterson が、Carlos Santos、Hilton Giesenow でした。</span><span class="sxs-lookup"><span data-stu-id="0ffc1-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="0ffc1-253">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="0ffc1-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="0ffc1-254">その場合は、mitchell@4GuysFromRolla.comの行を削除[します。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0ffc1-255">[前へ](creating-a-data-access-layer-cs.md)
> [次へ](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="0ffc1-255">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
