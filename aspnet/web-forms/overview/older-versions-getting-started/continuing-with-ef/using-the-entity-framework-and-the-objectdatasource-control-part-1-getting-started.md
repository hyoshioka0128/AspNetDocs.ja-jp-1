---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: 使用するには、Entity Framework 4.0 と ObjectDataSource コントロール、パート 1。Getting Started |Microsoft Docs
author: tdykstra
description: このチュートリアル シリーズでは、Entity Framework のチュートリアル シリーズの概要を作成した Contoso University web アプリケーションに基づいています。 Yo 場合.
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 2f14707eb058d438495dd2bc4c17b976c471fc97
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131342"
---
# <a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="e5070-104">使用するには、Entity Framework 4.0 と ObjectDataSource コントロール、パート 1。作業の開始</span><span class="sxs-lookup"><span data-stu-id="e5070-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>

<span data-ttu-id="e5070-105">によって[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="e5070-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="e5070-106">このチュートリアル シリーズは、Contoso University web アプリケーションによって作成される、 [、Entity Framework 4.0 の概要](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)チュートリアル シリーズです。</span><span class="sxs-lookup"><span data-stu-id="e5070-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="e5070-107">前のチュートリアルを完了していない場合は、このチュートリアルの開始点としてできます[アプリケーションをダウンロードする](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a)に、作成します。</span><span class="sxs-lookup"><span data-stu-id="e5070-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="e5070-108">できます[アプリケーションをダウンロードする](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa)完全なチュートリアル シリーズで作成します。</span><span class="sxs-lookup"><span data-stu-id="e5070-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="e5070-109">Contoso University のサンプルの web アプリケーションでは、Entity Framework 4.0 と Visual Studio 2010 を使用して ASP.NET Web フォーム アプリケーションを作成する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="e5070-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="e5070-110">サンプル アプリケーションは、架空の Contoso University の web サイトです。</span><span class="sxs-lookup"><span data-stu-id="e5070-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="e5070-111">学生の受け付け、講座の作成、講師の割り当てなどの機能が含まれています。</span><span class="sxs-lookup"><span data-stu-id="e5070-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="e5070-112">このチュートリアルでは、c# で例を示します。</span><span class="sxs-lookup"><span data-stu-id="e5070-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="e5070-113">[ダウンロード可能なサンプル](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa)c# および Visual Basic の両方でコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e5070-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="e5070-114">最初のデータベースします。</span><span class="sxs-lookup"><span data-stu-id="e5070-114">Database First</span></span>
> 
> <span data-ttu-id="e5070-115">Entity Framework でのデータを使用する 3 つの方法があります。*データベース ファースト*、*モデル ファースト*、および*コード ファースト*します。</span><span class="sxs-lookup"><span data-stu-id="e5070-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="e5070-116">このチュートリアルでは、データベースの最初の。</span><span class="sxs-lookup"><span data-stu-id="e5070-116">This tutorial is for Database First.</span></span> <span data-ttu-id="e5070-117">シナリオに最適なものを選択する方法に関するこれらのワークフローとガイダンスの違いについては、次を参照してください。 [Entity Framework 開発ワークフロー](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf)します。</span><span class="sxs-lookup"><span data-stu-id="e5070-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="e5070-118">Web フォーム</span><span class="sxs-lookup"><span data-stu-id="e5070-118">Web Forms</span></span>
> 
> <span data-ttu-id="e5070-119">Getting Started シリーズなどは、このチュートリアル シリーズは、ASP.NET Web フォーム モデルを使用して、Visual Studio で ASP.NET Web フォームを操作する方法を把握するという前提で。</span><span class="sxs-lookup"><span data-stu-id="e5070-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="e5070-120">表示されない場合、 [ASP.NET 4.5 Web フォームの概要](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md)します。</span><span class="sxs-lookup"><span data-stu-id="e5070-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="e5070-121">ASP.NET MVC フレームワークで作業する場合を参照してください。 [ASP.NET MVC を使用して Entity Framework の概要](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md)します。</span><span class="sxs-lookup"><span data-stu-id="e5070-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="e5070-122">ソフトウェアのバージョン</span><span class="sxs-lookup"><span data-stu-id="e5070-122">Software versions</span></span>
> 
> | <span data-ttu-id="e5070-123">**このチュートリアルで示すように**</span><span class="sxs-lookup"><span data-stu-id="e5070-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="e5070-124">**でも使用できます。**</span><span class="sxs-lookup"><span data-stu-id="e5070-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="e5070-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="e5070-125">Windows 7</span></span> | <span data-ttu-id="e5070-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="e5070-126">Windows 8</span></span> |
> | <span data-ttu-id="e5070-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="e5070-127">Visual Studio 2010</span></span> | <span data-ttu-id="e5070-128">Visual Studio 2010 Express for Web です。</span><span class="sxs-lookup"><span data-stu-id="e5070-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="e5070-129">このチュートリアルは以降のバージョンの Visual Studio でテストされていません。</span><span class="sxs-lookup"><span data-stu-id="e5070-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="e5070-130">メニューのダイアログ ボックス、およびテンプレートで多くの違いがあります。</span><span class="sxs-lookup"><span data-stu-id="e5070-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="e5070-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="e5070-131">.NET 4</span></span> | <span data-ttu-id="e5070-132">.NET 4.5 は .NET 4 では、旧バージョンと互換性のあるが、このチュートリアルは .NET 4.5 でテストされていません。</span><span class="sxs-lookup"><span data-stu-id="e5070-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="e5070-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="e5070-133">Entity Framework 4</span></span> | <span data-ttu-id="e5070-134">このチュートリアルは Entity Framework の以降のバージョンでテストされていません。</span><span class="sxs-lookup"><span data-stu-id="e5070-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="e5070-135">既定では、Entity Framework 5 以降では、EF で使用、`DbContext API`は EF 4.1 で導入されました。</span><span class="sxs-lookup"><span data-stu-id="e5070-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="e5070-136">EntityDataSource コントロールが使用するように設計、 `ObjectContext` API。</span><span class="sxs-lookup"><span data-stu-id="e5070-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="e5070-137">コントロールを EntityDataSource を使用する方法については、 `DbContext` API を参照してください[このブログの投稿](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="e5070-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="e5070-138">質問</span><span class="sxs-lookup"><span data-stu-id="e5070-138">Questions</span></span>
> 
> <span data-ttu-id="e5070-139">チュートリアルに直接関連付けられていない質問がある場合を投稿、 [ASP.NET Entity Framework フォーラム](https://forums.asp.net/1227.aspx)、 [Entity Framework と LINQ to エンティティ フォーラム](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/)、または[StackOverflow.com](http://stackoverflow.com/)します。</span><span class="sxs-lookup"><span data-stu-id="e5070-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>

<span data-ttu-id="e5070-140">`EntityDataSource`コントロールでは、非常に高速にアプリケーションを作成することができますが、通常必要膨大なビジネス ロジックとデータ アクセス ロジックを保持すること、 *.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="e5070-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="e5070-141">作成するには多くの開発時間が事前投資できます、アプリケーションで複雑化し、継続的なメンテナンスを必要とする場合は、 *n 層*または*層*アプリケーション構造これは、保守しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="e5070-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="e5070-142">このアーキテクチャを実装するには、ビジネス ロジック層 (BLL) とデータ アクセス層 (DAL) からプレゼンテーション層を分離します。</span><span class="sxs-lookup"><span data-stu-id="e5070-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="e5070-143">この構造体を実装する方法の 1 つが使用するには、`ObjectDataSource`コントロールの代わりに、`EntityDataSource`コントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="e5070-144">使用すると、`ObjectDataSource`コントロール、データ アクセス コードを実装しでを呼び出す *.aspx*ページが多くの同じコントロールを使用するその他のデータ ソース コントロールの機能です。</span><span class="sxs-lookup"><span data-stu-id="e5070-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="e5070-145">これにより、n 層のアプローチの利点とデータ アクセスの Web フォーム コントロールを使用する利点を組み合わせることができます。</span><span class="sxs-lookup"><span data-stu-id="e5070-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="e5070-146">`ObjectDataSource`コントロールより柔軟で他の方法でも同様です。</span><span class="sxs-lookup"><span data-stu-id="e5070-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="e5070-147">独自のデータ アクセス コードを記述するためがしやすくは以上の読み取り、挿入、更新、または特定のエンティティの種類を削除は、タスクを`EntityDataSource`コントロールを実行するように設計します。</span><span class="sxs-lookup"><span data-stu-id="e5070-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="e5070-148">たとえば、エンティティが更新されるたびにログ記録を実行、エンティティを削除すると、または自動的に確認および更新を関連するデータの外部キー値を持つ行を挿入するときに、必要に応じてたびにデータをアーカイブできます。</span><span class="sxs-lookup"><span data-stu-id="e5070-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="e5070-149">ビジネス ロジック、およびリポジトリ クラス</span><span class="sxs-lookup"><span data-stu-id="e5070-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="e5070-150">`ObjectDataSource`作成するクラスを呼び出すことによって動作を制御します。</span><span class="sxs-lookup"><span data-stu-id="e5070-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="e5070-151">クラスには取得し、データを更新するメソッドが含まれています、これらのメソッドの名前を指定して、`ObjectDataSource`マークアップ内のコントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="e5070-152">レンダリングまたはポストバックの処理中に、`ObjectDataSource`指定したメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e5070-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="e5070-153">基本的な CRUD 操作、クラスで使用するために作成するだけでなく、`ObjectDataSource`コントロールは、ビジネス ロジックを実行する必要があるときに、`ObjectDataSource`の読み取りやデータを更新します。</span><span class="sxs-lookup"><span data-stu-id="e5070-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="e5070-154">たとえば、部署を更新するときに、1 人のユーザーが 1 つ以上の部門の管理者にすることはできませんので、他の部門が、同じ管理者ありませんを検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5070-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="e5070-155">一部の`ObjectDataSource`ドキュメントについてなど、 [ObjectDataSource クラスの概要](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx)、コントロールと呼ばれるクラスを呼び出し、*ビジネス オブジェクト*ビジネス ロジックとデータ アクセス ロジックの両方を含む.</span><span class="sxs-lookup"><span data-stu-id="e5070-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="e5070-156">このチュートリアルでは、ビジネス ロジックとデータ アクセス ロジックの別のクラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="e5070-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="e5070-157">データ アクセス ロジックをカプセル化するクラスと呼ばれる、*リポジトリ*します。</span><span class="sxs-lookup"><span data-stu-id="e5070-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="e5070-158">ビジネス ロジック クラスには、ビジネス ロジックのメソッドとデータ アクセス メソッドの両方が含まれていますが、データ アクセス メソッドは、データ アクセス タスクを実行するリポジトリを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="e5070-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="e5070-159">BLL と自動化された単体を容易にする DAL の抽象化レイヤーを作成することも、BLL のテストします。</span><span class="sxs-lookup"><span data-stu-id="e5070-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="e5070-160">この抽象化レイヤーを実装するには、インターフェイスを作成し、ビジネス ロジック クラスでリポジトリをインスタンス化するときに、インターフェイスを使用します。</span><span class="sxs-lookup"><span data-stu-id="e5070-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="e5070-161">これにより、リポジトリ インターフェイスを実装する任意のオブジェクトへの参照にビジネス ロジック クラスを提供することが可能にします。</span><span class="sxs-lookup"><span data-stu-id="e5070-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="e5070-162">通常の操作の場合は、Entity Framework で動作するリポジトリ オブジェクトを提供します。</span><span class="sxs-lookup"><span data-stu-id="e5070-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="e5070-163">テストするには、コレクションとして定義されているクラス変数など、操作に簡単にする方法で格納されているデータで動作するリポジトリ オブジェクトを提供します。</span><span class="sxs-lookup"><span data-stu-id="e5070-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="e5070-164">次の図は、リポジトリなしのデータ アクセス ロジックを含むビジネス ロジック クラスと、リポジトリを使用する 1 つの違いを示します。</span><span class="sxs-lookup"><span data-stu-id="e5070-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="e5070-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="e5070-166">Web ページの作成は、まず、`ObjectDataSource`基本的なデータ アクセス タスクのみを実行するために、リポジトリに直接コントロールがバインドされています。</span><span class="sxs-lookup"><span data-stu-id="e5070-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="e5070-167">次のチュートリアルでは、検証ロジックとビジネス ロジック クラスを作成し、バインド、`ObjectDataSource`リポジトリ クラスの代わりにそのクラスへのコントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="e5070-168">検証ロジックの単体テストも作成されます。</span><span class="sxs-lookup"><span data-stu-id="e5070-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="e5070-169">このシリーズの 3 番目のチュートリアルでは、並べ替えおよびフィルター処理、アプリケーションに機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="e5070-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="e5070-170">このチュートリアルで作成したページを使用、`Departments`で作成したデータ モデルのエンティティ セット、[入門チュートリアル シリーズ](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)します。</span><span class="sxs-lookup"><span data-stu-id="e5070-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="e5070-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="e5070-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="e5070-173">データベースとデータ モデルを更新しています</span><span class="sxs-lookup"><span data-stu-id="e5070-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="e5070-174">作成したデータ モデルに対応する変更を必要とする、データベースに 2 つの変更を加えて、このチュートリアルを開始するが、 [Entity Framework と Web フォーム概要](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)チュートリアル。</span><span class="sxs-lookup"><span data-stu-id="e5070-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="e5070-175">これらのチュートリアルの 1 つは、データベースを変更した後、データベースとデータ モデルを同期するには、手動でのデザイナーで変更を加えた。</span><span class="sxs-lookup"><span data-stu-id="e5070-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="e5070-176">このチュートリアルでは、デザイナーを使用して**データベースからモデルを更新**データ モデルを自動的に更新するためのツール。</span><span class="sxs-lookup"><span data-stu-id="e5070-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="e5070-177">データベースへのリレーションシップの追加</span><span class="sxs-lookup"><span data-stu-id="e5070-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="e5070-178">Visual studio で作成した Contoso University web アプリケーションを開き、 [Entity Framework と Web フォーム概要](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)チュートリアル シリーズでし、開きます、`SchoolDiagram`データベース ダイアグラム。</span><span class="sxs-lookup"><span data-stu-id="e5070-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="e5070-179">確認する場合、`Department`テーブル データベース ダイアグラムで表示されますが、`Administrator`列。</span><span class="sxs-lookup"><span data-stu-id="e5070-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="e5070-180">この列への外部キーには、`Person`テーブルがない外部キー リレーションシップが、データベースで定義されています。</span><span class="sxs-lookup"><span data-stu-id="e5070-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="e5070-181">リレーションシップを作成し、Entity Framework がこの関係を自動的に処理できるように、データ モデルを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5070-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="e5070-182">データベース ダイアグラムを右クリックし、`Department`テーブル、および選択**リレーションシップ**します。</span><span class="sxs-lookup"><span data-stu-id="e5070-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="e5070-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="e5070-184">**Foreign Key Relationships**ボックス**追加**の省略記号をクリックし、**テーブルと列の指定**します。</span><span class="sxs-lookup"><span data-stu-id="e5070-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="e5070-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="e5070-186">**テーブルと列** ダイアログ ボックスで、主キー テーブルを設定し、フィールドを`Person`と`PersonID`、および外部キー テーブルを設定し、フィールドを`Department`と`Administrator`します。</span><span class="sxs-lookup"><span data-stu-id="e5070-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="e5070-187">(これを行うと、リレーションシップの名前がから変更`FK_Department_Department`に`FK_Department_Person`)。</span><span class="sxs-lookup"><span data-stu-id="e5070-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="e5070-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="e5070-189">をクリックして**ok**で、**テーブルと列**ボックスで、**閉じる**で、 **Foreign Key Relationships**ボックス、および変更を保存します。</span><span class="sxs-lookup"><span data-stu-id="e5070-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="e5070-190">保存するかどうかを要求している場合、`Person`と`Department`テーブル、 をクリックして**はい**。</span><span class="sxs-lookup"><span data-stu-id="e5070-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="e5070-191">削除してしまった場合`Person`は既にデータに対応する行、`Administrator`列で、この変更を保存できません。</span><span class="sxs-lookup"><span data-stu-id="e5070-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="e5070-192">その場合は、エディターでは、テーブルを使用して、**サーバー エクスプ ローラー**ことを確認する、`Administrator`値すべて`Department`行に実際に存在するレコードの ID が含まれています、`Person`テーブル。</span><span class="sxs-lookup"><span data-stu-id="e5070-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="e5070-193">行を削除できませんが、変更を保存した後、`Person`テーブルの人物が部門の管理者である場合。</span><span class="sxs-lookup"><span data-stu-id="e5070-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="e5070-194">実稼働アプリケーションでは、データベースの制約により、削除、または連鎖削除を指定するときに特定のエラー メッセージを指定するは。</span><span class="sxs-lookup"><span data-stu-id="e5070-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="e5070-195">連鎖削除を指定する方法の例は、次を参照してください。 [。 Entity Framework と ASP.NET – 開始パート 2 を取得する](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md)します。</span><span class="sxs-lookup"><span data-stu-id="e5070-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>

### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="e5070-196">データベースにビューを追加します。</span><span class="sxs-lookup"><span data-stu-id="e5070-196">Adding a View to the Database</span></span>

<span data-ttu-id="e5070-197">新しい*Departments.aspx*部門の管理者をユーザーが選択できるように、「姓, 名」の形式で名前を持つ、インストラクターのドロップダウン リストを提供したいページを作成することで、します。</span><span class="sxs-lookup"><span data-stu-id="e5070-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="e5070-198">そのために容易にできるように、データベースでビューが作成されます。</span><span class="sxs-lookup"><span data-stu-id="e5070-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="e5070-199">ビューは、ドロップダウン リストで必要なデータだけで構成されます: (適切に書式設定) 完全な名前とレコードのキー。</span><span class="sxs-lookup"><span data-stu-id="e5070-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="e5070-200">**サーバー エクスプ ローラー**、展開*School.mdf*を右クリックし、**ビュー**フォルダー、および選択**新しいビューの追加**します。</span><span class="sxs-lookup"><span data-stu-id="e5070-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="e5070-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="e5070-202">をクリックして**閉じる**ときに、**テーブルの追加** ダイアログ ボックスが表示され、次の SQL ステートメントを SQL ペインに貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="e5070-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="e5070-203">ビューとして保存`vInstructorName`します。</span><span class="sxs-lookup"><span data-stu-id="e5070-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="e5070-204">データ モデルを更新します。</span><span class="sxs-lookup"><span data-stu-id="e5070-204">Updating the Data Model</span></span>

<span data-ttu-id="e5070-205">*DAL*フォルダーを開き、 *SchoolModel.edmx*ファイルで、デザイン サーフェイスを右クリックし、選択**データベースからモデルを更新**します。</span><span class="sxs-lookup"><span data-stu-id="e5070-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="e5070-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="e5070-207">**データベース オブジェクトの選択**ダイアログ ボックスで、**追加**タブし、作成したビューを選択します。</span><span class="sxs-lookup"><span data-stu-id="e5070-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="e5070-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="e5070-209">**[完了]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="e5070-209">Click **Finish**.</span></span>

<span data-ttu-id="e5070-210">デザイナーで、表示、ツールが作成されたことを`vInstructorName`エンティティとの関連付けを新しく、`Department`と`Person`エンティティ。</span><span class="sxs-lookup"><span data-stu-id="e5070-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="e5070-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="e5070-212">**出力**と**エラー一覧**ツールがプライマリに自動的に作成されたことを通知する警告メッセージが表示される windows の新しいキーの`vInstructorName`ビュー。</span><span class="sxs-lookup"><span data-stu-id="e5070-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="e5070-213">これは通常の動作です。</span><span class="sxs-lookup"><span data-stu-id="e5070-213">This is expected behavior.</span></span>

<span data-ttu-id="e5070-214">新しいを参照するとき`vInstructorName`コード内のエンティティ、たくに小文字"v"を付けることのデータベースの規則を使用します。</span><span class="sxs-lookup"><span data-stu-id="e5070-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="e5070-215">そのため、エンティティとモデルのエンティティ セットを変更します。</span><span class="sxs-lookup"><span data-stu-id="e5070-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="e5070-216">開く、**モデル ブラウザー**します。</span><span class="sxs-lookup"><span data-stu-id="e5070-216">Open the **Model Browser**.</span></span> <span data-ttu-id="e5070-217">表示`vInstructorName`としてエンティティ型とビューを一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="e5070-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="e5070-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="e5070-219">**SchoolModel** (いない**SchoolModel.Store**)、右クリック**vInstructorName**を選択し、**プロパティ**。</span><span class="sxs-lookup"><span data-stu-id="e5070-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="e5070-220">**プロパティ**ウィンドウで、変更、**名前**プロパティを"InstructorName"に変更、**エンティティ セット名**プロパティを"InstructorNames"。</span><span class="sxs-lookup"><span data-stu-id="e5070-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="e5070-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="e5070-222">保存して、データ モデルを終了し、プロジェクトをリビルドします。</span><span class="sxs-lookup"><span data-stu-id="e5070-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="e5070-223">リポジトリのクラスと ObjectDataSource コントロールを使用してください。</span><span class="sxs-lookup"><span data-stu-id="e5070-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="e5070-224">新しいクラス ファイルを作成、 *DAL*フォルダー、名前を付けます*SchoolRepository.cs*、既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="e5070-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="e5070-225">このコードにより、1 つ`GetDepartments`内のエンティティのすべてを返すメソッド、`Departments`エンティティ セット。</span><span class="sxs-lookup"><span data-stu-id="e5070-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="e5070-226">アクセスすることがわかっているため、`Person`ナビゲーション プロパティのすべての行に返されたを指定する一括を使用してそのプロパティの読み込み、`Include`メソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="e5070-227">クラスを実装しても、`IDisposable`オブジェクトが破棄されたときに、データベース接続が解放されるようにするインターフェイス。</span><span class="sxs-lookup"><span data-stu-id="e5070-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="e5070-228">一般的な方法では、各エンティティ型のリポジトリ クラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="e5070-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="e5070-229">このチュートリアルでは、複数のエンティティ型の 1 つのリポジトリ クラスが使用されます。</span><span class="sxs-lookup"><span data-stu-id="e5070-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="e5070-230">リポジトリ パターンの詳細については、内の投稿を参照してください。 [、Entity Framework チームのブログ](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx)と[Julie Lerman のブログ](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/)します。</span><span class="sxs-lookup"><span data-stu-id="e5070-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>

<span data-ttu-id="e5070-231">`GetDepartments`メソッドを返します、`IEnumerable`オブジェクトではなく、`IQueryable`リポジトリ オブジェクト自体が破棄された後でも、返されたコレクションが使用可能なことを確認するにはオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="e5070-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="e5070-232">`IQueryable`オブジェクトによってデータベース アクセス、アクセスはなく、リポジトリ オブジェクトは、データ バインド コントロールが、データをレンダリングしようとしています。 時間によって破棄される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e5070-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="e5070-233">などの別の種類のコレクションを返すことができます、`IList`オブジェクトの代わりに、`IEnumerable`オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="e5070-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="e5070-234">ただし、返す、`IEnumerable`オブジェクトは、一般的な読み取り専用リスト処理タスクをなど、実行できることにより、`foreach`ループと、LINQ クエリことはできませんを追加またはそのような変更であることを示唆する、コレクション内の項目を削除データベースに保存します。</span><span class="sxs-lookup"><span data-stu-id="e5070-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="e5070-235">作成、 *Departments.aspx*を使用するページ、 *Site.Master*マスター ページ、およびでは、次のマークアップを追加、`Content`という名前のコントロール`Content2`:</span><span class="sxs-lookup"><span data-stu-id="e5070-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="e5070-236">このマークアップを作成、`ObjectDataSource`コントロールを作成したリポジトリ クラスを使用して、`GridView`データを表示するコントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="e5070-237">`GridView`コントロールを指定します**編集**と**削除**コマンドがまだそれらをサポートするコードを追加していません。</span><span class="sxs-lookup"><span data-stu-id="e5070-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="e5070-238">複数の列を使用して、`DynamicField`そのデータの自動書式設定と検証機能の利用を制御します。</span><span class="sxs-lookup"><span data-stu-id="e5070-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="e5070-239">呼び出す必要があるこれらの場合、`EnableDynamicData`メソッドで、`Page_Init`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="e5070-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="e5070-240">(`DynamicControl`でコントロールが使用されていない、`Administrator`フィールドため、ナビゲーション プロパティでは動作しません)。</span><span class="sxs-lookup"><span data-stu-id="e5070-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="e5070-241">`Vertical-Align="Top"`属性重要になる後では、入れ子になった列を追加するときに`GridView`グリッド コントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="e5070-242">開く、 *Departments.aspx.cs*ファイルを開き、次の追加`using`ステートメント。</span><span class="sxs-lookup"><span data-stu-id="e5070-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="e5070-243">次のページのハンドラーを追加し、`Init`イベント。</span><span class="sxs-lookup"><span data-stu-id="e5070-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="e5070-244">*DAL*フォルダーという新しいクラス ファイルを作成*Department.cs*既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="e5070-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="e5070-245">このコードは、データ モデルにメタデータを追加します。</span><span class="sxs-lookup"><span data-stu-id="e5070-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="e5070-246">指定します、`Budget`のプロパティ、`Department`エンティティは、そのデータ型が実際には通貨を表します`Decimal`、し、値が 0 ~ $1,000,000.00 の範囲でなければならないことを指定します。</span><span class="sxs-lookup"><span data-stu-id="e5070-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="e5070-247">指定する、`StartDate`プロパティは、形式年/月/日の日付として書式設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5070-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="e5070-248">実行、 *Departments.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="e5070-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="e5070-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="e5070-250">書式設定文字列で指定しなかったことに注意して、 *Departments.aspx*ページのマークアップを**予算**または**Start Date**列、既定の通貨と日付これらの書式設定が適用されて、`DynamicField`コントロールに提供されているメタデータを使用して、 *Department.cs*ファイル。</span><span class="sxs-lookup"><span data-stu-id="e5070-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="e5070-251">追加の挿入および削除の機能</span><span class="sxs-lookup"><span data-stu-id="e5070-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="e5070-252">開いている*SchoolRepository.cs*、作成するには、次のコードを追加、`Insert`メソッドと`Delete`メソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="e5070-253">コードは、という名前のメソッドも含まれています。`GenerateDepartmentID`で使用するための次の使用可能なレコード キー値を計算する、`Insert`メソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="e5070-254">これは、これを自動的に計算する、データベースが構成されていないために必要な`Department`テーブル。</span><span class="sxs-lookup"><span data-stu-id="e5070-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="e5070-255">Attach メソッド</span><span class="sxs-lookup"><span data-stu-id="e5070-255">The Attach Method</span></span>

<span data-ttu-id="e5070-256">`DeleteDepartment`メソッドの呼び出し、`Attach`メソッドがメモリ内のエンティティとデータベースの間、オブジェクト コンテキストのオブジェクト状態マネージャーに保持されているリンクを再確立するには、行を表します。</span><span class="sxs-lookup"><span data-stu-id="e5070-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="e5070-257">これは、メソッド呼び出しの前に発生する必要があります、`SaveChanges`メソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="e5070-258">用語*オブジェクト コンテキスト*から派生した Entity Framework クラスを参照、`ObjectContext`クラス、エンティティ セットとエンティティにアクセスするために使用します。</span><span class="sxs-lookup"><span data-stu-id="e5070-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="e5070-259">このプロジェクトのコードでクラスの名前は`SchoolEntities`、そのインスタンスの名前は常に`context`します。</span><span class="sxs-lookup"><span data-stu-id="e5070-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="e5070-260">オブジェクト コンテキストの*オブジェクト状態マネージャー*から派生したクラスには、`ObjectStateManager`クラス。</span><span class="sxs-lookup"><span data-stu-id="e5070-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="e5070-261">オブジェクトの連絡先は、エンティティ オブジェクトを格納して、それぞれに対応するテーブルの行またはデータベース内の行と同期されているかどうかを追跡するオブジェクト状態マネージャーを使用します。</span><span class="sxs-lookup"><span data-stu-id="e5070-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="e5070-262">エンティティを読み取るときに、オブジェクト コンテキストはオブジェクト状態マネージャーに格納しのオブジェクトの表現は、データベースと同期されているかどうかを追跡します。</span><span class="sxs-lookup"><span data-stu-id="e5070-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="e5070-263">たとえば、プロパティ値を変更する場合は、フラグがプロパティを変更するにはデータベースと同期が不要になったことを示す設定されます。</span><span class="sxs-lookup"><span data-stu-id="e5070-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="e5070-264">その後呼び出す、`SaveChanges`メソッド、オブジェクト コンテキストでは、オブジェクト状態マネージャーは、エンティティの現在の状態と、データベースの状態の相違点だけを知っているため、データベースで実行することがわかっています。</span><span class="sxs-lookup"><span data-stu-id="e5070-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="e5070-265">ただし、このプロセス通常機能しません、web アプリケーションで、ページが表示されたら、と共に、オブジェクトの状態マネージャー内のすべてのエンティティを読み取るオブジェクト コンテキスト インスタンスが破棄されるためです。</span><span class="sxs-lookup"><span data-stu-id="e5070-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="e5070-266">オブジェクト コンテキスト インスタンスに変更を適用する必要がありますが、ポストバック処理がインスタンス化するか新しいします。</span><span class="sxs-lookup"><span data-stu-id="e5070-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="e5070-267">場合、`DeleteDepartment`メソッド、`ObjectDataSource`コントロール再作成しますエンティティの元のバージョンをビュー ステートの値からが再作成この`Department`オブジェクト状態マネージャーにエンティティが存在しません。</span><span class="sxs-lookup"><span data-stu-id="e5070-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="e5070-268">呼び出した場合、`DeleteObject`この再作成されたエンティティのメソッドは、オブジェクト コンテキストにエンティティがデータベースと同期するかどうかがわからないため、呼び出しが失敗します。</span><span class="sxs-lookup"><span data-stu-id="e5070-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="e5070-269">ただし、呼び出し、`Attach`メソッドがオブジェクト コンテキストの以前のインスタンスで、エンティティが読み取られたときに自動的に実行された最初のデータベースで再作成されたエンティティと値の間の追跡を再確立します。</span><span class="sxs-lookup"><span data-stu-id="e5070-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="e5070-270">ありますが、オブジェクト状態マネージャー内のエンティティを追跡するためにオブジェクト コンテキストをしたくないし、実行を防ぐためにフラグを設定することができます。</span><span class="sxs-lookup"><span data-stu-id="e5070-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="e5070-271">この例は、このシリーズの以降のチュートリアルに表示されます。</span><span class="sxs-lookup"><span data-stu-id="e5070-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="e5070-272">SaveChanges メソッド</span><span class="sxs-lookup"><span data-stu-id="e5070-272">The SaveChanges Method</span></span>

<span data-ttu-id="e5070-273">この単純なリポジトリ クラスは、CRUD 操作を実行する方法の基本原則を示しています。</span><span class="sxs-lookup"><span data-stu-id="e5070-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="e5070-274">この例で、`SaveChanges`各更新後すぐにメソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="e5070-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="e5070-275">実稼働アプリケーションで呼び出すする可能性があります、`SaveChanges`データベースが更新されたときより詳細に制御を提供する別のメソッドからのメソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="e5070-276">(次のチュートリアルの最後の unit of work パターンは関連する更新プログラムを調整する 1 つの方法を説明するホワイト ペーパーへのリンクが検索されます)。また、例では、`DeleteDepartment`メソッドでは、同時実行の競合を処理するためのコードは含まれません。 そのためにコードをこのシリーズの後のチュートリアルで追加します。</span><span class="sxs-lookup"><span data-stu-id="e5070-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="e5070-277">インストラクターの名前を挿入するときに選択を取得します。</span><span class="sxs-lookup"><span data-stu-id="e5070-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="e5070-278">ユーザーは、新しい部門を作成するときに、ドロップダウン リストでインストラクターの一覧から管理者を選択できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5070-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="e5070-279">そのため、次のコードを追加*SchoolRepository.cs*先ほど作成したビューを使用したインストラクターのリストを取得するメソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="e5070-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="e5070-280">部門を挿入するためのページを作成します。</span><span class="sxs-lookup"><span data-stu-id="e5070-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="e5070-281">作成、 *DepartmentsAdd.aspx*を使用するページ、 *Site.Master*ページとでは、次のマークアップを追加、`Content`という名前のコントロール`Content2`:</span><span class="sxs-lookup"><span data-stu-id="e5070-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="e5070-282">このマークアップでは、2 つ作成されます`ObjectDataSource`には、新規に挿入するため 1`Department`エンティティと instructor 名を取得する 1 つずつ、`DropDownList`部門の管理者を選択するために使用されるコントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="e5070-283">マークアップは、作成、`DetailsView`コントロールのハンドラーを指定しますの新しい部門を入力制御`ItemInserting`イベント設定できるように、`Administrator`外部キーの値。</span><span class="sxs-lookup"><span data-stu-id="e5070-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="e5070-284">最後には、`ValidationSummary`エラー メッセージを表示するコントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="e5070-285">開いている*DepartmentsAdd.aspx.cs*し、以下の追加`using`ステートメント。</span><span class="sxs-lookup"><span data-stu-id="e5070-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="e5070-286">次のクラスの変数とメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="e5070-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="e5070-287">`Page_Init`メソッド Dynamic Data 機能を有効にします。</span><span class="sxs-lookup"><span data-stu-id="e5070-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="e5070-288">ハンドラーは、`DropDownList`コントロールの`Init`イベント ハンドラーをコントロールへの参照を保存します、`DetailsView`コントロールの`Inserting`イベントでは、その参照を使用して、取得、`PersonID`の値が選択したインストラクターと更新プログラム`Administrator`の外部キー プロパティ、`Department`エンティティ。</span><span class="sxs-lookup"><span data-stu-id="e5070-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="e5070-289">ページの実行、新しい部署の情報を追加し、クリックして、**挿入**リンク。</span><span class="sxs-lookup"><span data-stu-id="e5070-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="e5070-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="e5070-291">もう 1 つの新しい部署の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="e5070-291">Enter values for another new department.</span></span> <span data-ttu-id="e5070-292">1,000,000.00 よりも大きい数値を入力、**予算**フィールドと次のフィールド タブ。</span><span class="sxs-lookup"><span data-stu-id="e5070-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="e5070-293">フィールドに、アスタリスクが表示され、上にマウス ポインターを保持する場合は、そのフィールドのメタデータで指定したエラー メッセージを表示できます。</span><span class="sxs-lookup"><span data-stu-id="e5070-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="e5070-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="e5070-295">をクリックして**挿入**、によって表示されるエラー メッセージが表示して、`ValidationSummary`ページの下部にあるコントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="e5070-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="e5070-297">次に、ブラウザーを終了し、開く、 *Departments.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="e5070-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="e5070-298">削除機能を追加、 *Departments.aspx*ページを追加することで、`DeleteMethod`属性を`ObjectDataSource`コントロール、および`DataKeyNames`属性を`GridView`コントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="e5070-299">これらのコントロールの開始タグは次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="e5070-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="e5070-300">ページを実行します。</span><span class="sxs-lookup"><span data-stu-id="e5070-300">Run the page.</span></span>

<span data-ttu-id="e5070-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="e5070-302">削除を実行したときに追加した部門、 *DepartmentsAdd.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="e5070-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="e5070-303">更新プログラムの機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="e5070-303">Adding Update Functionality</span></span>

<span data-ttu-id="e5070-304">開いている*SchoolRepository.cs*し、以下の追加`Update`メソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="e5070-305">クリックすると**Update**で、 *Departments.aspx*  ページで、`ObjectDataSource`コントロールでは、2 つ作成されます`Department`に渡すエンティティ、`UpdateDepartment`メソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="e5070-306">ビューステートに格納されている元の値が含まれていて、もう一方に入力された新しい値を格納、`GridView`コントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="e5070-307">内のコード、`UpdateDepartment`メソッドが渡す、`Department`元の値を持つエンティティ、`Attach`エンティティとデータベースの間の追跡を確立するためのメソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="e5070-308">このコードではその後、`Department`エンティティに新しい値を持つ、`ApplyCurrentValues`メソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="e5070-309">オブジェクト コンテキストでは、新旧の値を比較します。</span><span class="sxs-lookup"><span data-stu-id="e5070-309">The object context compares the old and new values.</span></span> <span data-ttu-id="e5070-310">新しい値が古い値と異なる場合は、オブジェクト コンテキストは、プロパティの値を変更します。</span><span class="sxs-lookup"><span data-stu-id="e5070-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="e5070-311">`SaveChanges`メソッドは、データベースで変更された列のみを更新します。</span><span class="sxs-lookup"><span data-stu-id="e5070-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="e5070-312">(ただし場合、このエンティティの update 関数は、ストアド プロシージャにマップされて、行全体が更新されますに関係なく、列が変更されました。)</span><span class="sxs-lookup"><span data-stu-id="e5070-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="e5070-313">開く、 *Departments.aspx*ファイルを開き、次の属性を追加、`DepartmentsObjectDataSource`コントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="e5070-314">このエラーの原因の古い値をビューステートに格納されたで新しい値を持つとを比較できるように、`Update`メソッド。</span><span class="sxs-lookup"><span data-stu-id="e5070-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="e5070-315">これを元の値パラメーターの名前は、コントロールに知らせます`origDepartment`します。</span><span class="sxs-lookup"><span data-stu-id="e5070-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="e5070-316">開始タグのマークアップ、`ObjectDataSource`コントロール次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="e5070-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="e5070-317">追加、`OnRowUpdating="DepartmentsGridView_RowUpdating"`属性を`GridView`コントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="e5070-318">これを使用して、設定するのには、`Administrator`プロパティの値、ユーザーがドロップダウン リストで選択行に基づいています。</span><span class="sxs-lookup"><span data-stu-id="e5070-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="e5070-319">`GridView`次の例では、開始タグを今すぐに似ています。</span><span class="sxs-lookup"><span data-stu-id="e5070-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="e5070-320">追加、`EditItemTemplate`の制御、`Administrator`列を`GridView`直後、制御、`ItemTemplate`その列の制御。</span><span class="sxs-lookup"><span data-stu-id="e5070-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="e5070-321">これは、`EditItemTemplate`コントロールに似ていますが、`InsertItemTemplate`を制御、 *DepartmentsAdd.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="e5070-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="e5070-322">違いを使用して、コントロールの初期値を設定すること、`SelectedValue`属性。</span><span class="sxs-lookup"><span data-stu-id="e5070-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="e5070-323">前に、`GridView`コントロールを追加、`ValidationSummary`で行ったように制御、 *DepartmentsAdd.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="e5070-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="e5070-324">開いている*Departments.aspx.cs* 、部分クラス宣言の直後後を参照するプライベート フィールドを作成する次のコードを追加し、`DropDownList`コントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="e5070-325">ハンドラーを追加し、`DropDownList`コントロールの`Init`イベントと`GridView`コントロールの`RowUpdating`イベント。</span><span class="sxs-lookup"><span data-stu-id="e5070-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="e5070-326">ハンドラーは、`Init`イベントへの参照を保存する、`DropDownList`クラス フィールド内のコントロール。</span><span class="sxs-lookup"><span data-stu-id="e5070-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="e5070-327">ハンドラーは、`RowUpdating`イベントでは、参照を使用して、ユーザーが入力した値を取得し、それを適用、`Administrator`のプロパティ、`Department`エンティティ。</span><span class="sxs-lookup"><span data-stu-id="e5070-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="e5070-328">使用して、 *DepartmentsAdd.aspx*ページに、新しい部門を追加し、実行、 *Departments.aspx*ページし、をクリックして**編集**追加した行にします。</span><span class="sxs-lookup"><span data-stu-id="e5070-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="e5070-329">追加しなかった行を編集することはできません (つまり、データベース内に既に)、データベースでは無効なデータのためデータベースで作成された行の管理者とは、受講者です。</span><span class="sxs-lookup"><span data-stu-id="e5070-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="e5070-330">これらのいずれかを編集しようとする場合のようなエラーを報告するエラー ページが表示されます。 `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="e5070-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>

<span data-ttu-id="e5070-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="e5070-332">無効な入力すると**予算**金額し、順にクリックします**Update**、同じアスタリスクとに示したエラー メッセージを参照してください、 *Departments.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="e5070-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="e5070-333">フィールドの値を変更または別の管理者を選択し、クリックして**Update**します。</span><span class="sxs-lookup"><span data-stu-id="e5070-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="e5070-334">変更が表示されます。</span><span class="sxs-lookup"><span data-stu-id="e5070-334">The change is displayed.</span></span>

<span data-ttu-id="e5070-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="e5070-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="e5070-336">これで完了の使用の概要、`ObjectDataSource`コントロールの基本的な CRUD (作成、読み取り、更新、削除)、Entity Framework での操作。</span><span class="sxs-lookup"><span data-stu-id="e5070-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="e5070-337">単純な n 層アプリケーションを構築したがビジネス ロジック層は、データ アクセス層は、自動化された単体テストが複雑になっても密に結合されています。</span><span class="sxs-lookup"><span data-stu-id="e5070-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="e5070-338">次のチュートリアルでは、単体テストを容易にするリポジトリ パターンを実装する方法を確認します。</span><span class="sxs-lookup"><span data-stu-id="e5070-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="e5070-339">次へ</span><span class="sxs-lookup"><span data-stu-id="e5070-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
