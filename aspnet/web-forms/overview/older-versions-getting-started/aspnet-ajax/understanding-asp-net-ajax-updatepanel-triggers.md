---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
title: ASP.NET AJAX UpdatePanel トリガーについてMicrosoft Docs
author: scottcate
description: Visual Studio のマークアップエディターで作業するときに、UpdatePanel コントロールの2つの子要素があることを (IntelliSense から) 確認できます。 Wh のいずれか
ms.author: riande
ms.date: 03/12/2008
ms.assetid: faab8503-2984-48a9-8a40-7728461abc50
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
msc.type: authoredcontent
ms.openlocfilehash: b1cc869f373d4f8283b4d92af74707c3f11fef61
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78440542"
---
# <a name="understanding-aspnet-ajax-updatepanel-triggers"></a><span data-ttu-id="4a4ad-104">ASP.NET AJAX UpdatePanel トリガーについて理解する</span><span class="sxs-lookup"><span data-stu-id="4a4ad-104">Understanding ASP.NET AJAX UpdatePanel Triggers</span></span>

<span data-ttu-id="4a4ad-105">[Scott Cate](https://github.com/scottcate)</span><span class="sxs-lookup"><span data-stu-id="4a4ad-105">by [Scott Cate](https://github.com/scottcate)</span></span>

<span data-ttu-id="4a4ad-106">[[Download PDF]\(PDF をダウンロード\)](https://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial02_Triggers_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="4a4ad-106">[Download PDF](https://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial02_Triggers_cs.pdf)</span></span>

> <span data-ttu-id="4a4ad-107">Visual Studio のマークアップエディターで作業するときに、UpdatePanel コントロールの2つの子要素があることを (IntelliSense から) 確認できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-107">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an UpdatePanel control.</span></span> <span data-ttu-id="4a4ad-108">そのうちの1つは、要素が存在する UpdatePanel コントロールの部分的なレンダリングをトリガーする、ページ上のコントロール (または、使用している場合はユーザーコントロール) を指定する Triggers 要素です。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-108">One of which is the Triggers element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the element resides.</span></span>

## <a name="introduction"></a><span data-ttu-id="4a4ad-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="4a4ad-109">Introduction</span></span>

<span data-ttu-id="4a4ad-110">Microsoft の ASP.NET テクノロジは、オブジェクト指向プログラミングモデルとイベントドリブンプログラミングモデルを提供し、コンパイル済みコードの利点と結び付けます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-110">Microsoft's ASP.NET technology brings an object-oriented and event-driven programming model and unites it with the benefits of compiled code.</span></span> <span data-ttu-id="4a4ad-111">ただし、そのサーバー側の処理モデルには、テクノロジに固有のいくつかの欠点があります。その多くは、Microsoft ASP.NET 3.5 AJAX 拡張機能に含まれる新機能によって対処できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-111">However, its server-side processing model has several drawbacks inherent in the technology, many of which can be addressed by the new features included in the Microsoft ASP.NET 3.5 AJAX Extensions.</span></span> <span data-ttu-id="4a4ad-112">これらの拡張機能により、ページの完全な更新を必要としないページの部分的なレンダリング、クライアントスクリプト (ASP.NET プロファイリング API を含む) を使用した Web サービスへのアクセス機能、広範なクライアント側 API など、多くの豊富なクライアント機能が有効になります。ASP.NET のサーバー側コントロールセットで見られる多くのコントロールスキームをミラー化するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-112">These extensions enable many new rich client features, including partial rendering of pages without requiring a full page refresh, the ability to access Web Services via client script (including the ASP.NET profiling API), and an extensive client-side API designed to mirror many of the control schemes seen in the ASP.NET server-side control set.</span></span>

<span data-ttu-id="4a4ad-113">このホワイトペーパーでは、ASP.NET AJAX `UpdatePanel` コンポーネントの XML トリガー機能について考察します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-113">This whitepaper examines the XML Triggers functionality of the ASP.NET AJAX `UpdatePanel` component.</span></span> <span data-ttu-id="4a4ad-114">XML トリガーを使用すると、特定の UpdatePanel コントロールに部分的なレンダリングを発生させる可能性のあるコンポーネントを細かく制御できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-114">XML Triggers give granular control over the components that can cause partial rendering for specific UpdatePanel controls.</span></span>

<span data-ttu-id="4a4ad-115">このホワイトペーパーは、.NET Framework 3.5 と Visual Studio 2008 のベータ2リリースに基づいています。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-115">This whitepaper is based on the Beta 2 release of the .NET Framework 3.5 and Visual Studio 2008.</span></span> <span data-ttu-id="4a4ad-116">ASP.NET AJAX 拡張機能は、以前は ASP.NET 2.0 を対象としたアドオンアセンブリであり、.NET Framework の基本クラスライブラリに統合されています。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-116">The ASP.NET AJAX Extensions, previously an add-on assembly targeted at ASP.NET 2.0, are now integrated into the .NET Framework Base Class Library.</span></span> <span data-ttu-id="4a4ad-117">また、このホワイトペーパーでは、visual Web Developer Express ではなく Visual Studio 2008 を使用することを前提としています。また、Visual Studio のユーザーインターフェイスに従ってチュートリアルを提供します (ただし、コード一覧は、次の項目に関係なく完全に互換性があります)。開発環境)。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-117">This whitepaper also assumes that you will be working with Visual Studio 2008, not Visual Web Developer Express, and will provide walkthroughs according to the user interface of Visual Studio (although code listings will be entirely compatible regardless of development environment).</span></span>

## <a name="triggers"></a><span data-ttu-id="4a4ad-118">*トリガー*</span><span class="sxs-lookup"><span data-stu-id="4a4ad-118">*Triggers*</span></span>

<span data-ttu-id="4a4ad-119">既定では、特定の UpdatePanel のトリガーには、ポストバックを呼び出す子コントロールが自動的に含まれます。たとえば、`AutoPostBack` プロパティが**true**に設定されているテキストボックスコントロールなどです。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-119">Triggers for a given UpdatePanel, by default, automatically include any child controls that invoke a postback, including (for example) TextBox controls that have their `AutoPostBack` property set to **true**.</span></span> <span data-ttu-id="4a4ad-120">ただし、トリガーは、マークアップを使用して宣言的に含めることもできます。これは、UpdatePanel コントロール宣言の `<triggers>` セクション内で行います。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-120">However, triggers can also be included declaratively using markup; this is done within the `<triggers>` section of the UpdatePanel control declaration.</span></span> <span data-ttu-id="4a4ad-121">トリガーには、`Triggers` コレクションプロパティを使用してアクセスできますが、`Page_Load` イベント内で、ページの ScriptManager オブジェクトの `RegisterAsyncPostBackControl(Control)` メソッドを使用して、実行時に部分的な render トリガーを登録することをお勧めします (たとえば、デザイン時にコントロールを使用できない場合など)。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-121">Although triggers can be accessed via the `Triggers` collection property, it is recommended that you register any partial render triggers at run-time (for instance, if a control is not available at design time) by using the `RegisterAsyncPostBackControl(Control)` method of the ScriptManager object for your page, within the `Page_Load` event.</span></span> <span data-ttu-id="4a4ad-122">ページはステートレスであるため、作成するたびにこれらのコントロールを再登録する必要があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-122">Remember that Pages are stateless, and so you should re-register these controls every time they are created.</span></span>

<span data-ttu-id="4a4ad-123">自動子トリガーの追加を無効にすることもできます (したがって、ポストバックを作成する子コントロールは、`ChildrenAsTriggers` プロパティを**false**に設定することによって、部分的なレンダリングを自動的にトリガーしません)。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-123">Automatic child trigger inclusion can also be disabled (so that child controls that create postbacks do not automatically trigger partial renders) by setting the `ChildrenAsTriggers` property to **false**.</span></span> <span data-ttu-id="4a4ad-124">これにより、ページレンダリングを呼び出すことができる特定のコントロールを柔軟に割り当てることができ、推奨されるので、開発者はイベントに応答して、発生する可能性のあるイベントを処理することはできません。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-124">This allows you the greatest flexibility in assigning which specific controls may invoke a page render, and is recommended, so that a developer will opt-in to respond to an event, rather than handling any events that may arise.</span></span>

<span data-ttu-id="4a4ad-125">UpdatePanel コントロールが入れ子になっている場合、UpdateMode が**Conditional**に設定されているときに、子 updatepanel がトリガーされても、親がではない場合は、子 updatepanel だけが更新されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-125">Note that when UpdatePanel controls are nested, when the UpdateMode is set to **Conditional**, if the child UpdatePanel is triggered, but the parent is not, then only the child UpdatePanel will refresh.</span></span> <span data-ttu-id="4a4ad-126">ただし、親 UpdatePanel が更新されると、子 UpdatePanel も更新されます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-126">However, if the parent UpdatePanel is refreshed, then the child UpdatePanel will also be refreshed.</span></span>

## <a name="the-lttriggersgt-element"></a><span data-ttu-id="4a4ad-127">*&lt;は&gt; 要素をトリガーします*</span><span class="sxs-lookup"><span data-stu-id="4a4ad-127">*The &lt;Triggers&gt; Element*</span></span>

<span data-ttu-id="4a4ad-128">Visual Studio のマークアップエディターで作業する場合、`UpdatePanel` コントロールの2つの子要素があることを (IntelliSense から) 確認できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-128">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an `UpdatePanel` control.</span></span> <span data-ttu-id="4a4ad-129">最も頻繁に見られる要素は `<ContentTemplate>` 要素です。この要素は、基本的に、更新パネル (部分レンダリングを有効にするコンテンツ) によって保持されるコンテンツをカプセル化します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-129">The most-frequently seen element is the `<ContentTemplate>` element, which essentially encapsulates the content that will be held by the update panel (the content for which we are enabling partial rendering).</span></span> <span data-ttu-id="4a4ad-130">もう1つの要素は `<Triggers>` 要素です。この要素は、ページ上のコントロール (使用している場合はユーザーコントロール) を指定します。これにより、&lt;トリガー&gt; 要素が存在する UpdatePanel コントロールの部分的なレンダリングがトリガーされます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-130">The other element is the `<Triggers>` element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the &lt;Triggers&gt; element resides.</span></span>

<span data-ttu-id="4a4ad-131">`<Triggers>` 要素には、`<asp:AsyncPostBackTrigger>` と `<asp:PostBackTrigger>`の2つの子ノードのそれぞれに任意の数を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-131">The `<Triggers>` element can contain any number each of two child nodes: `<asp:AsyncPostBackTrigger>` and `<asp:PostBackTrigger>`.</span></span> <span data-ttu-id="4a4ad-132">2つの属性、`ControlID` と `EventName`を受け取り、現在のカプセル化の単位内で任意のコントロールを指定できます (たとえば、UpdatePanel コントロールが Web ユーザーコントロール内に存在する場合、ユーザーコントロールが配置されているページのコントロールを参照しないようにする必要があります)。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-132">They both accept two attributes, `ControlID` and `EventName`, and can specify any Control within the current unit of encapsulation (for instance, if your UpdatePanel control resides within a Web User Control, you should not attempt to reference a Control on the Page on which the User Control will reside).</span></span>

<span data-ttu-id="4a4ad-133">`<asp:AsyncPostBackTrigger>` 要素は、このトリガーが子である UpdatePanel だけでなく、カプセル化の単位で*任意*の updatepanel コントロールの子として存在するコントロールから任意のイベントを対象とすることができる場合に特に便利です。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-133">The `<asp:AsyncPostBackTrigger>` element is particularly useful in that it can target any event from a Control that exists as a child of *any* UpdatePanel control in the unit of encapsulation, not just the UpdatePanel under which this trigger is a child.</span></span> <span data-ttu-id="4a4ad-134">したがって、部分ページ更新をトリガーするコントロールを作成できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-134">Thus, any control can be made to trigger a partial page update.</span></span>

<span data-ttu-id="4a4ad-135">同様に、`<asp:PostBackTrigger>` 要素を使用して部分ページレンダリングをトリガーすることもできますが、その場合はサーバーへの完全なラウンドトリップを必要とします。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-135">Similarly, the `<asp:PostBackTrigger>` element can be used to trigger a partial page render, but one that requires a full round-trip to the server.</span></span> <span data-ttu-id="4a4ad-136">また、このトリガー要素を使用して、コントロールが通常は部分ページレンダリングをトリガーする場合に、完全なページレンダリングを強制的に実行することもできます (たとえば、UpdatePanel コントロールの `<ContentTemplate>` 要素に `Button` コントロールが存在する場合)。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-136">This trigger element can also be used to force a full page render when a control would otherwise normally trigger a partial page render (for instance, when a `Button` control exists in the `<ContentTemplate>` element of an UpdatePanel control).</span></span> <span data-ttu-id="4a4ad-137">ここでも、PostBackTrigger 要素は、カプセル化の現在の単位で、任意の UpdatePanel コントロールの子である任意のコントロールを指定できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-137">Again, the PostBackTrigger element can specify any control that is a child of any UpdatePanel control in the current unit of encapsulation.</span></span>

## <a name="lttriggersgt-element-reference"></a><span data-ttu-id="4a4ad-138">*&lt;トリガー&gt; 要素参照*</span><span class="sxs-lookup"><span data-stu-id="4a4ad-138">*&lt;Triggers&gt; Element Reference*</span></span>

<span data-ttu-id="4a4ad-139">*マークアップの子孫:*</span><span class="sxs-lookup"><span data-stu-id="4a4ad-139">*Markup Descendants:*</span></span>

| <span data-ttu-id="4a4ad-140">**Tag**</span><span class="sxs-lookup"><span data-stu-id="4a4ad-140">**Tag**</span></span> | <span data-ttu-id="4a4ad-141">**説明**</span><span class="sxs-lookup"><span data-stu-id="4a4ad-141">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="4a4ad-142">&lt;asp: AsyncPostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="4a4ad-142">&lt;asp:AsyncPostBackTrigger&gt;</span></span> | <span data-ttu-id="4a4ad-143">このトリガー参照を含む UpdatePanel の部分ページ更新を発生させるコントロールとイベントを指定します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-143">Specifies a control and event that will cause a partial page update for the UpdatePanel that contains this trigger reference.</span></span> |
| <span data-ttu-id="4a4ad-144">&lt;asp: PostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="4a4ad-144">&lt;asp:PostBackTrigger&gt;</span></span> | <span data-ttu-id="4a4ad-145">ページ全体の更新を発生させるコントロールとイベントを指定します (ページ全体の更新)。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-145">Specifies a control and event that will cause a full page update (a full page refresh).</span></span> <span data-ttu-id="4a4ad-146">このタグを使用すると、コントロールが部分的なレンダリングをトリガーする場合に、完全な更新を強制的に実行できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-146">This tag can be used to force a full refresh when a control would otherwise trigger partial rendering.</span></span> |

## <a name="walkthrough-cross-updatepanel-triggers"></a><span data-ttu-id="4a4ad-147">*チュートリアル: UpdatePanel 間トリガー*</span><span class="sxs-lookup"><span data-stu-id="4a4ad-147">*Walkthrough: Cross-UpdatePanel Triggers*</span></span>

1. <span data-ttu-id="4a4ad-148">部分的なレンダリングを有効にする ScriptManager オブジェクトが設定された新しい ASP.NET ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-148">Create a new ASP.NET page with a ScriptManager object set to enable partial rendering.</span></span> <span data-ttu-id="4a4ad-149">2つの UpdatePanels をこのページに追加します。1つ目は、ラベルコントロール (Label1) と2つのボタンコントロール (Button1 および Button2) を含めます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-149">Add two UpdatePanels to this page - in the first, include a Label control ( Label1 ) and two Button controls ( Button1 and Button2 ).</span></span> <span data-ttu-id="4a4ad-150">Button1 をクリックして両方を更新する必要があります。これを更新するには、[] をクリックする必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-150">Button1 should say Click to Update Both and Button2 should say Click to Update This, or something along those lines.</span></span> <span data-ttu-id="4a4ad-151">2番目の UpdatePanel では、ラベルコントロール (Label2) のみを含めますが、その ForeColor プロパティを既定値以外に設定して区別します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-151">In the second UpdatePanel, include only a Label control ( Label2 ), but set its ForeColor property to something other than the default to differentiate it.</span></span>
2. <span data-ttu-id="4a4ad-152">両方の UpdatePanel タグの UpdateMode プロパティを**条件付き**に設定します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-152">Set the UpdateMode property of both UpdatePanel tags to **Conditional**.</span></span>

<span data-ttu-id="4a4ad-153">**リスティング 1: default.aspx のマークアップ:**</span><span class="sxs-lookup"><span data-stu-id="4a4ad-153">**Listing 1: Markup for default.aspx:**</span></span> 

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample1.aspx)]

1. <span data-ttu-id="4a4ad-154">Button1 の Click イベントハンドラーで、Label1 と Label2 を任意の時間に依存する (ToLongTimeString () など) に設定します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-154">In the Click event handler for Button1, set Label1.Text and Label2.Text to something time-dependent (such as DateTime.Now.ToLongTimeString()).</span></span> <span data-ttu-id="4a4ad-155">Button2 の Click イベントハンドラーについては、Label1 を時間に依存する値に設定します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-155">For the Click event handler for Button2, set only Label1.Text to the time-dependent value.</span></span>

<span data-ttu-id="4a4ad-156">**リスト 2: default.aspx.cs の分離コード (トリム):**</span><span class="sxs-lookup"><span data-stu-id="4a4ad-156">**Listing 2: Codebehind (trimmed) in default.aspx.cs:**</span></span> 

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample2.cs)]

1. <span data-ttu-id="4a4ad-157">F5 キーを押して、プロジェクトをビルドして実行します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-157">Press F5 to build and run the project.</span></span> <span data-ttu-id="4a4ad-158">[両方のパネルを更新] をクリックすると、両方のラベルがテキストを変更することに注意してください。ただし、[このパネルを更新する] をクリックすると、Label1 の更新プログラムのみが表示できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-158">Note that, when you click Update Both Panels, both labels change text; however, when you click Update This Panel, only Label1 updates.</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image2.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image1.png)

<span data-ttu-id="4a4ad-159">([クリックすると、フルサイズの画像が表示](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png)される)</span><span class="sxs-lookup"><span data-stu-id="4a4ad-159">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png))</span></span>

## <a name="under-the-hood"></a><span data-ttu-id="4a4ad-160">*内部的な処理*</span><span class="sxs-lookup"><span data-stu-id="4a4ad-160">*Under the Hood*</span></span>

<span data-ttu-id="4a4ad-161">先ほど作成した例を利用して、ASP.NET AJAX が行っていることと、UpdatePanel のクロスパネルトリガーの動作を確認できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-161">Utilizing the example we just constructed, we can take a look at what ASP.NET AJAX is doing and how our UpdatePanel cross-panel triggers work.</span></span> <span data-ttu-id="4a4ad-162">これを行うには、生成されたページソース HTML と、消火バグと呼ばれる Mozilla Firefox 拡張機能を使用します。これにより、AJAX ポストバックを簡単に調べることができます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-162">To do so, we will work with the generated page source HTML, as well as the Mozilla Firefox extension called FireBug - with it, we can easily examine the AJAX postbacks.</span></span> <span data-ttu-id="4a4ad-163">また、Lutz Roeder によって .NET リフレクターツールを使用します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-163">We will also use the .NET Reflector tool by Lutz Roeder.</span></span> <span data-ttu-id="4a4ad-164">これらのツールはいずれもオンラインで利用可能であり、インターネット検索で見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-164">Both of these tools are freely available online, and can be found with an internet search.</span></span>

<span data-ttu-id="4a4ad-165">ページソースコードを確認すると、通常はほとんど何も表示されません。UpdatePanel コントロールは `<div>` コンテナーとしてレンダリングされ、`<asp:ScriptManager>`によって提供されるスクリプトリソースを確認できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-165">An examination of the page source code shows almost nothing out of the ordinary; the UpdatePanel controls are rendered as `<div>` containers, and we can see the script resource includes provided by the `<asp:ScriptManager>`.</span></span> <span data-ttu-id="4a4ad-166">AJAX クライアントスクリプトライブラリの内部にある PageRequestManager への新しい AJAX 固有の呼び出しもあります。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-166">There are also some new AJAX-specific calls to the PageRequestManager that are internal to the AJAX client script library.</span></span> <span data-ttu-id="4a4ad-167">最後に、2つの UpdatePanel コンテナーが表示されます。1つは、`<span>` コンテナーとしてレンダリングされた2つの `<asp:Label>` コントロールを含む `<input>` ボタンを表示します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-167">Finally, we see the two UpdatePanel containers - one with the rendered `<input>` buttons with the two `<asp:Label>` controls rendered as `<span>` containers.</span></span> <span data-ttu-id="4a4ad-168">(消火バグの DOM ツリーを調べると、ラベルが淡色表示され、表示可能なコンテンツが生成されていないことがわかります)。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-168">(If you inspect the DOM tree in FireBug, you will notice that the labels are dimmed to indicate that they are not producing visible content).</span></span>

<span data-ttu-id="4a4ad-169">[このパネルを更新] ボタンをクリックすると、上部の UpdatePanel が現在のサーバー時刻で更新されることがわかります。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-169">Click the Update This Panel button, and notice the top UpdatePanel will be updated with the current server time.</span></span> <span data-ttu-id="4a4ad-170">[消火バグ] で、[コンソール] タブを選択して、要求を確認できるようにします。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-170">In FireBug, choose the Console tab so that you can examine the request.</span></span> <span data-ttu-id="4a4ad-171">POST 要求パラメーターを最初に確認します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-171">Examine the POST request parameters first:</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image5.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image4.png)

<span data-ttu-id="4a4ad-172">([クリックすると、フルサイズの画像が表示](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png)される)</span><span class="sxs-lookup"><span data-stu-id="4a4ad-172">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png))</span></span>

<span data-ttu-id="4a4ad-173">UpdatePanel は、ScriptManager1 パラメーターを使用して起動されたコントロールツリーを正確にサーバー側の AJAX コードに示しています。これは、`UpdatePanel1` コントロールの `Button1` です。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-173">Note that the UpdatePanel has indicated to the server-side AJAX code precisely which control tree was fired via the ScriptManager1 parameter: `Button1` of the `UpdatePanel1` control.</span></span> <span data-ttu-id="4a4ad-174">次に、[両方のパネルを更新する] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-174">Now, click on the Update Both Panels button.</span></span> <span data-ttu-id="4a4ad-175">次に、応答を調べると、パイプで区切られた一連の変数が文字列に設定されています。具体的には、上部の UpdatePanel (`UpdatePanel1`) がブラウザーに送信された HTML の全体を表示しています。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-175">Then, examining the response, we see a pipe-delimited series of variables set in a string; specifically, we see the top UpdatePanel, `UpdatePanel1`, has the entirety of its HTML sent to the browser.</span></span> <span data-ttu-id="4a4ad-176">AJAX クライアントスクリプトライブラリは、`.innerHTML` プロパティを使用して、UpdatePanel の元の HTML コンテンツを新しいコンテンツに置き換えます。これにより、サーバーは変更されたコンテンツを HTML としてサーバーから送信します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-176">The AJAX client script library substitutes the UpdatePanel's original HTML content with the new content via the `.innerHTML` property, and so the server sends the changed content from the server as HTML.</span></span>

<span data-ttu-id="4a4ad-177">次に、[両方のパネルを更新] ボタンをクリックし、サーバーの結果を確認します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-177">Now, click on the Update Both Panels button and examine the results from the server.</span></span> <span data-ttu-id="4a4ad-178">結果は非常に似ています。どちらの UpdatePanels でも、サーバーから新しい HTML を受け取ります。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-178">The results are very similar - both UpdatePanels receive new HTML from the server.</span></span> <span data-ttu-id="4a4ad-179">前のコールバックと同様に、追加のページ状態が送信されます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-179">As with the previous callback, additional page state is sent.</span></span>

<span data-ttu-id="4a4ad-180">ご覧のように、AJAX ポストバックの実行には特殊なコードが使用されていないため、AJAX クライアントスクリプトライブラリは、追加のコードを使用せずにフォームポストバックをインターセプトすることができます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-180">As we can see, because no special code is utilized to perform an AJAX postback, the AJAX client script library is able to intercept form postbacks without any additional code.</span></span> <span data-ttu-id="4a4ad-181">サーバーコントロールは自動的に JavaScript を利用して、自動的にフォームの検証と状態のコードを自動的に送信します。これは、主に自動スクリプトリソースのインクルード、PostBackOptions クラスによって実現されます。、および ClientScriptManager クラス。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-181">Server controls automatically utilize JavaScript so that they do not automatically submit the form - ASP.NET automatically injects code for form validation and state already, primarily achieved by automatic script resource inclusion, the PostBackOptions class, and the ClientScriptManager class.</span></span>

<span data-ttu-id="4a4ad-182">たとえば、CheckBox コントロールについて考えてみます.NET リフレクターでクラスの逆アセンブリを確認します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-182">For instance, consider a CheckBox control; examine the class disassembly in .NET Reflector.</span></span> <span data-ttu-id="4a4ad-183">これを行うには、System.web アセンブリが開いていることを確認し、`RenderInputTag` メソッドを開いて `System.Web.UI.WebControls.CheckBox` クラスに移動します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-183">To do so, ensure that your System.Web assembly is open, and navigate to the `System.Web.UI.WebControls.CheckBox` class, opening the `RenderInputTag` method.</span></span> <span data-ttu-id="4a4ad-184">`AutoPostBack` プロパティをチェックする条件を探します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-184">Look for a conditional that checks the `AutoPostBack` property:</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image8.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image7.png)

<span data-ttu-id="4a4ad-185">([クリックすると、フルサイズの画像が表示](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png)される)</span><span class="sxs-lookup"><span data-stu-id="4a4ad-185">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png))</span></span>

<span data-ttu-id="4a4ad-186">`CheckBox` コントロールで自動ポストバックが有効になっている場合 (AutoPostBack プロパティが true の場合)、結果の `<input>` タグは、その `onclick` 属性の ASP.NET イベント処理スクリプトを使用してレンダリングされます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-186">When automatic postback is enabled on a `CheckBox` control (via the AutoPostBack property being true), the resultant `<input>` tag is therefore rendered with an ASP.NET event handling script in its `onclick` attribute.</span></span> <span data-ttu-id="4a4ad-187">フォームの送信を傍受すると、ASP.NET AJAX がページ nonintrusively に挿入され、場合によっては不正確な文字列置換を使用することによって発生する可能性のある重大な変更を回避できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-187">The interception of the form's submission, then, allows ASP.NET AJAX to be injected into the page nonintrusively, helping to avoid any potential breaking changes that might occur by utilizing a possibly-imprecise string replacement.</span></span> <span data-ttu-id="4a4ad-188">さらに、これにより、*任意の*カスタム ASP.NET コントロールで、UpdatePanel コンテナー内での使用をサポートするコードを追加しなくても、ASP.NET AJAX の機能を利用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-188">Furthermore, this enables *any* custom ASP.NET control to utilize the power of ASP.NET AJAX without any additional code to support its use within an UpdatePanel container.</span></span>

<span data-ttu-id="4a4ad-189">`<triggers>` 機能は \_updateControls への PageRequestManager 呼び出しで初期化される値に対応しています (ASP.NET AJAX クライアントスクリプトライブラリでは、アンダースコアで始まるメソッド、イベント、およびフィールド名が内部としてマークされ、ライブラリ自体の外部で使用するためのものではないという規則が使用されています)。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-189">The `<triggers>` functionality corresponds to the values initialized in the PageRequestManager call to \_updateControls (note that the ASP.NET AJAX client script library utilizes the convention that methods, events, and field names that begin with an underscore are marked as internal, and are not meant for use outside of the library itself).</span></span> <span data-ttu-id="4a4ad-190">このメソッドを使用すると、AJAX ポストバックの原因となっているコントロールを調べることができます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-190">With it, we can observe which controls are intended to cause AJAX postbacks.</span></span>

<span data-ttu-id="4a4ad-191">たとえば、2つの追加のコントロールをページに追加し、1つのコントロールを UpdatePanels の外部に残して、UpdatePanel 内に1つ残しておきます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-191">For example, let's add two additional controls to the page, leaving one control outside of the UpdatePanels entirely, and leaving one within an UpdatePanel.</span></span> <span data-ttu-id="4a4ad-192">上部の UpdatePanel 内に CheckBox コントロールを追加し、リスト内で定義されている多数の色を持つ DropDownList をドロップします。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-192">We will add a CheckBox control within the upper UpdatePanel, and drop a DropDownList with a number of colors defined within the list.</span></span> <span data-ttu-id="4a4ad-193">新しいマークアップは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-193">Here is the new markup:</span></span>

<span data-ttu-id="4a4ad-194">**リスト 3: 新しいマークアップ**</span><span class="sxs-lookup"><span data-stu-id="4a4ad-194">**Listing 3: New Markup**</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample3.aspx)]

<span data-ttu-id="4a4ad-195">新しい分離コードを次に示します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-195">And here is the new code-behind:</span></span>

<span data-ttu-id="4a4ad-196">**リスト 4: 分離コード**</span><span class="sxs-lookup"><span data-stu-id="4a4ad-196">**Listing 4: Codebehind**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample4.cs)]

<span data-ttu-id="4a4ad-197">このページの背後にあるのは、ドロップダウンリストでは、2つ目のラベルを表示するために3色のいずれかを選択し、チェックボックスで太字になっているかどうか、およびラベルに日付と時刻のどちらが表示されているかを確認するということです。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-197">The idea behind this page is that the drop-down list selects one of three colors to show the second label, that the check box determines both whether it is bold, and whether the labels display the date as well as the time.</span></span> <span data-ttu-id="4a4ad-198">チェックボックスをオンにしても AJAX の更新は行われませんが、UpdatePanel 内に格納されていない場合でも、ドロップダウンリストは必要です。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-198">The check box should not cause an AJAX update, but the drop-down list should, even though it is not housed within an UpdatePanel.</span></span>

[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image11.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image10.png)

<span data-ttu-id="4a4ad-199">([クリックすると、フルサイズの画像が表示](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png)される)</span><span class="sxs-lookup"><span data-stu-id="4a4ad-199">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png))</span></span>

<span data-ttu-id="4a4ad-200">上のスクリーンショットでわかるように、クリックされた最新のボタンは、このパネルを更新する右側のボタンでした。このパネルは、一番下の時間に依存しないように更新します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-200">As is apparent in the above screen shot, the most-recent button to be clicked was the right button Update This Panel, which updated the top time independent of the bottom time.</span></span> <span data-ttu-id="4a4ad-201">日付は一番下のラベルに表示されるため、クリックの間で日付も切り替えられました。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-201">The date was also switched off between clicks, as the date is visible in the bottom label.</span></span> <span data-ttu-id="4a4ad-202">最後に、一番下のラベルの色が表示されます。ラベルのテキストよりも最近更新されました。これは、コントロールの状態が重要であり、ユーザーが AJAX ポストバックによって保存されることを期待していることを示しています。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-202">Finally of interest is the bottom label's color: it was updated more recently than the label's text, which demonstrates that control state is important, and users expect it to be preserved through AJAX postbacks.</span></span> <span data-ttu-id="4a4ad-203">*ただし*、時刻は更新されませんでした。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-203">*However*, the time was not updated.</span></span> <span data-ttu-id="4a4ad-204">この時間は、ASP.NET ランタイムによって解釈されるページの \_\_VIEWSTATE フィールドの永続化を通じて、コントロールがサーバーで再レンダリングされたときに自動的に再設定されます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-204">The time was automatically repopulated through the persistence of the \_\_VIEWSTATE field of the page being interpreted by the ASP.NET runtime when the control was being re-rendered on the server.</span></span> <span data-ttu-id="4a4ad-205">ASP.NET AJAX サーバーコードでは、コントロールの状態が変化しているメソッドは認識されません。単にビューステートから再起動し、適切なイベントを実行します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-205">The ASP.NET AJAX server code does not recognize in which methods the controls are changing state; it simply repopulates from view state and then runs the events that are appropriate.</span></span>

<span data-ttu-id="4a4ad-206">ただし、これは指摘されるはずですが、ページ\_読み込みイベント内の時間を初期化したので、時間が正しくインクリメントされました。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-206">It should be pointed out, however, that had I initialized the time within the Page\_Load event, the time would have been incremented correctly.</span></span> <span data-ttu-id="4a4ad-207">そのため、開発者は、適切なイベントハンドラーの実行中に適切なコードが実行されていることを慎重に考慮し、コントロールイベントハンドラーが適切な場合にページ\_の読み込みを使用しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-207">Consequently, developers should be wary that the appropriate code is being run during the appropriate event handlers, and avoid use of Page\_Load when a control event handler would be appropriate.</span></span>

## <a name="summary"></a><span data-ttu-id="4a4ad-208">まとめ</span><span class="sxs-lookup"><span data-stu-id="4a4ad-208">Summary</span></span>

<span data-ttu-id="4a4ad-209">ASP.NET AJAX Extensions UpdatePanel コントロールは汎用性があり、更新を引き起こす可能性のあるコントロールイベントを識別するための多数のメソッドを利用できます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-209">The ASP.NET AJAX Extensions UpdatePanel control is versatile, and can utilize a number of methods for identifying control events that should cause it to be updated.</span></span> <span data-ttu-id="4a4ad-210">子コントロールによって自動的に更新されることをサポートしますが、ページ上の他の場所にあるコントロールイベントに応答することもできます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-210">It supports being updated automatically by its child controls, but can also respond to control events elsewhere on the page.</span></span>

<span data-ttu-id="4a4ad-211">サーバー処理の負荷の可能性を低減するために、UpdatePanel の `ChildrenAsTriggers` プロパティを `false`に設定し、そのイベントを既定ではなくオプトインするように設定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-211">To reduce potential for server processing load, it is recommended that the `ChildrenAsTriggers` property of an UpdatePanel be set to `false`, and that events be opted-into rather than included by default.</span></span> <span data-ttu-id="4a4ad-212">これにより、検証や入力フィールドへの変更など、不要なイベントによって望ましくない可能性のある影響が発生するのを防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-212">This also prevents any unneeded events from causing potentially-unwanted effects, including validation, and changes to input fields.</span></span> <span data-ttu-id="4a4ad-213">この種のバグは、ページがユーザーに対して透過的に更新されるため、分離するのが困難な場合があります。したがって、原因がすぐに明らかになるとは限りません。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-213">These types of bugs may be difficult to isolate, because the page updates transparently to the user, and the cause may therefore not be immediately obvious.</span></span>

<span data-ttu-id="4a4ad-214">ASP.NET AJAX フォームポストインターセプトモデルの内部動作を調べることで、ASP.NET によって既に提供されているフレームワークを利用していることを確認できました。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-214">By examining the inner workings of the ASP.NET AJAX form post interception model, we were able to determine that it utilizes the framework already provided by ASP.NET.</span></span> <span data-ttu-id="4a4ad-215">これにより、同じフレームワークを使用して設計されたコントロールとの最大の互換性が維持され、ページ用に記述された追加の JavaScript に対して最小限の関与が実現します。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-215">In doing so, it preserves maximum compatibility with controls designed using the same framework, and intrudes minimally on any additional JavaScript written for the page.</span></span>

## <a name="bio"></a><span data-ttu-id="4a4ad-216">略歴</span><span class="sxs-lookup"><span data-stu-id="4a4ad-216">Bio</span></span>

<span data-ttu-id="4a4ad-217">渡 Paveza は、Terralever ([www.terralever.com](http://www.terralever.com)) にあるシニア .net アプリケーション開発者であり、tempe の主要な対話型マーケティング企業です。 AZ.</span><span class="sxs-lookup"><span data-stu-id="4a4ad-217">Rob Paveza is a senior .NET application developer at Terralever ([www.terralever.com](http://www.terralever.com)), a leading interactive marketing firm in Tempe, AZ.</span></span> <span data-ttu-id="4a4ad-218">彼は[robpaveza@gmail.com](mailto:robpaveza@gmail.com)にアクセスできます。彼のブログは[http://geekswithblogs.net/robp/](http://geekswithblogs.net/robp/)にあります。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-218">He can be reached at [robpaveza@gmail.com](mailto:robpaveza@gmail.com), and his blog is located at [http://geekswithblogs.net/robp/](http://geekswithblogs.net/robp/).</span></span>

<span data-ttu-id="4a4ad-219">Scott Cate は1997以来 Microsoft の Web テクノロジを使用しています。また、myKB.com ([www.myKB.com](http://www.myKB.com)) の大統領で、サポート技術情報のソフトウェアソリューションに重点を置いた ASP.NET ベースのアプリケーションを作成することを専門としています。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-219">Scott Cate has been working with Microsoft Web technologies since 1997 and is the President of myKB.com ([www.myKB.com](http://www.myKB.com)) where he specializes in writing ASP.NET based applications focused on Knowledge Base Software solutions.</span></span> <span data-ttu-id="4a4ad-220">Scott は、 [scott.cate@myKB.com](mailto:scott.cate@myKB.com)または彼のブログ ( [ScottCate.com](http://ScottCate.com) ) で、電子メールで連絡を受けることができます。</span><span class="sxs-lookup"><span data-stu-id="4a4ad-220">Scott can be contacted via email at [scott.cate@myKB.com](mailto:scott.cate@myKB.com) or his blog at [ScottCate.com](http://ScottCate.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4a4ad-221">[前へ](understanding-partial-page-updates-with-asp-net-ajax.md)
> [次へ](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span><span class="sxs-lookup"><span data-stu-id="4a4ad-221">[Previous](understanding-partial-page-updates-with-asp-net-ajax.md)
[Next](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span></span>
