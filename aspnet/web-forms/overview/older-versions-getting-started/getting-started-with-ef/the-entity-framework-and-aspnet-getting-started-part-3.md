---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-3
title: Entity Framework 4.0 Database First および ASP.NET 4 Web フォームでのはじめに-パート 3 |Microsoft Docs
author: tdykstra
description: Contoso 大学のサンプル web アプリケーションは、Entity Framework を使用して ASP.NET Web フォームアプリケーションを作成する方法を示しています。 サンプルアプリケーションは...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: ccdc3f8c-2568-40a7-8f8b-3c23d2e05388
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-3
msc.type: authoredcontent
ms.openlocfilehash: 88debb11a9157dce9ff000b1cb459b876dbceaf3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78522640"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-3"></a><span data-ttu-id="02757-104">Entity Framework 4.0 Database First および ASP.NET 4 Web フォームでのはじめに-パート3</span><span class="sxs-lookup"><span data-stu-id="02757-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 3</span></span>

<span data-ttu-id="02757-105">[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="02757-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="02757-106">Contoso 大学のサンプル web アプリケーションは、Entity Framework 4.0 と Visual Studio 2010 を使用して ASP.NET Web フォームアプリケーションを作成する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="02757-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="02757-107">チュートリアルシリーズの詳細については、[シリーズの最初のチュートリアル](the-entity-framework-and-aspnet-getting-started-part-1.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="02757-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="filtering-ordering-and-grouping-data"></a><span data-ttu-id="02757-108">データのフィルター処理、並べ替え、およびグループ化</span><span class="sxs-lookup"><span data-stu-id="02757-108">Filtering, Ordering, and Grouping Data</span></span>

<span data-ttu-id="02757-109">前のチュートリアルでは、`EntityDataSource` コントロールを使用してデータを表示および編集しています。</span><span class="sxs-lookup"><span data-stu-id="02757-109">In the previous tutorial you used the `EntityDataSource` control to display and edit data.</span></span> <span data-ttu-id="02757-110">このチュートリアルでは、データのフィルター処理、並べ替え、およびグループ化を行います。</span><span class="sxs-lookup"><span data-stu-id="02757-110">In this tutorial you'll filter, order, and group data.</span></span> <span data-ttu-id="02757-111">`EntityDataSource` コントロールのプロパティを設定してこの操作を行う場合、構文は他のデータソースコントロールとは異なります。</span><span class="sxs-lookup"><span data-stu-id="02757-111">When you do this by setting properties of the `EntityDataSource` control, the syntax is different from other data source controls.</span></span> <span data-ttu-id="02757-112">ただし、ここで説明するように、`QueryExtender` コントロールを使用して、これらの違いを最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="02757-112">As you'll see, however, you can use the `QueryExtender` control to minimize these differences.</span></span>

<span data-ttu-id="02757-113">*Students ページを*変更して、学生をフィルター処理し、名前で並べ替え、名前を検索します。</span><span class="sxs-lookup"><span data-stu-id="02757-113">You'll change the *Students.aspx* page to filter for students, sort by name, and search on name.</span></span> <span data-ttu-id="02757-114">また *、[course] ページ*を変更して、選択した学科のコースを表示し、名前でコースを検索します。</span><span class="sxs-lookup"><span data-stu-id="02757-114">You'll also change the *Courses.aspx* page to display courses for the selected department and search for courses by name.</span></span> <span data-ttu-id="02757-115">最後に、student の統計情報を*About .aspx*ページに追加します。</span><span class="sxs-lookup"><span data-stu-id="02757-115">Finally, you'll add student statistics to the *About.aspx* page.</span></span>

<span data-ttu-id="02757-116">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="02757-116">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image1.png)</span></span>

<span data-ttu-id="02757-117">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="02757-117">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image3.png)</span></span>

<span data-ttu-id="02757-118">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="02757-118">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image5.png)</span></span>

<span data-ttu-id="02757-119">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="02757-119">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image7.png)</span></span>

## <a name="using-the-entitydatasource-where-property-to-filter-data"></a><span data-ttu-id="02757-120">EntityDataSource "Where" プロパティを使用してデータをフィルター処理する</span><span class="sxs-lookup"><span data-stu-id="02757-120">Using the EntityDataSource "Where" Property to Filter Data</span></span>

<span data-ttu-id="02757-121">前のチュートリアルで作成した*student .aspx*ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="02757-121">Open the *Students.aspx* page that you created in the previous tutorial.</span></span> <span data-ttu-id="02757-122">現在構成されているように、ページの `GridView` コントロールには、`People` エンティティセットのすべての名前が表示されます。</span><span class="sxs-lookup"><span data-stu-id="02757-122">As currently configured, the `GridView` control in the page displays all the names from the `People` entity set.</span></span> <span data-ttu-id="02757-123">ただし、学生だけを表示したい場合は、null 以外の登録日がある `Person` エンティティを選択します。</span><span class="sxs-lookup"><span data-stu-id="02757-123">However, you want to show only students, which you can find by selecting `Person` entities that have non-null enrollment dates.</span></span>

<span data-ttu-id="02757-124">**デザイン**ビューに切り替え、[`EntityDataSource`] コントロールを選択します。</span><span class="sxs-lookup"><span data-stu-id="02757-124">Switch to **Design** view and select the `EntityDataSource` control.</span></span> <span data-ttu-id="02757-125">**[プロパティ]** ウィンドウで、 `Where` プロパティを `it.EnrollmentDate is not null`に設定します。</span><span class="sxs-lookup"><span data-stu-id="02757-125">In the **Properties** window, set the `Where` property to `it.EnrollmentDate is not null`.</span></span>

<span data-ttu-id="02757-126">[![Image01](the-entity-framework-and-aspnet-getting-started-part-3/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="02757-126">[![Image01](the-entity-framework-and-aspnet-getting-started-part-3/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image9.png)</span></span>

<span data-ttu-id="02757-127">`EntityDataSource` コントロールの `Where` プロパティで使用する構文は Entity SQL です。</span><span class="sxs-lookup"><span data-stu-id="02757-127">The syntax you use in the `Where` property of the `EntityDataSource` control is Entity SQL.</span></span> <span data-ttu-id="02757-128">Entity SQL は Transact-sql に似ていますが、データベースオブジェクトではなくエンティティで使用するようにカスタマイズされています。</span><span class="sxs-lookup"><span data-stu-id="02757-128">Entity SQL is similar to Transact-SQL, but it's customized for use with entities rather than database objects.</span></span> <span data-ttu-id="02757-129">`it.EnrollmentDate is not null`式では、`it` は、クエリによって返されたエンティティへの参照を表します。</span><span class="sxs-lookup"><span data-stu-id="02757-129">In the expression `it.EnrollmentDate is not null`, the word `it` represents a reference to the entity returned by the query.</span></span> <span data-ttu-id="02757-130">したがって、`it.EnrollmentDate` は、`EntityDataSource` コントロールが返す `Person` エンティティの `EnrollmentDate` プロパティを参照します。</span><span class="sxs-lookup"><span data-stu-id="02757-130">Therefore, `it.EnrollmentDate` refers to the `EnrollmentDate` property of the `Person` entity that the `EntityDataSource` control returns.</span></span>

<span data-ttu-id="02757-131">ページを実行します。</span><span class="sxs-lookup"><span data-stu-id="02757-131">Run the page.</span></span> <span data-ttu-id="02757-132">学生リストに学生のみが含まれるようになりました。</span><span class="sxs-lookup"><span data-stu-id="02757-132">The students list now contains only students.</span></span> <span data-ttu-id="02757-133">(登録日がない場所に表示される行はありません)。</span><span class="sxs-lookup"><span data-stu-id="02757-133">(There are no rows displayed where there's no enrollment date.)</span></span>

<span data-ttu-id="02757-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="02757-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-3/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image11.png)</span></span>

## <a name="using-the-entitydatasource-orderby-property-to-order-data"></a><span data-ttu-id="02757-135">EntityDataSource "OrderBy" プロパティを使用してデータを並べ替える</span><span class="sxs-lookup"><span data-stu-id="02757-135">Using the EntityDataSource "OrderBy" Property to Order Data</span></span>

<span data-ttu-id="02757-136">また、この一覧が最初に表示されたときに名前の順序で表示されるようにします。</span><span class="sxs-lookup"><span data-stu-id="02757-136">You also want this list to be in name order when it's first displayed.</span></span> <span data-ttu-id="02757-137">**[デザイン]** ビューで*student*ページを開いたまま、`EntityDataSource` コントロールを選択した状態で、 **[プロパティ]** ウィンドウで**OrderBy**プロパティを `it.LastName`に設定します。</span><span class="sxs-lookup"><span data-stu-id="02757-137">With the *Students.aspx* page still open in **Design** view, and with the `EntityDataSource` control still selected, in the **Properties** window set the **OrderBy** property to `it.LastName`.</span></span>

<span data-ttu-id="02757-138">[![Image05](the-entity-framework-and-aspnet-getting-started-part-3/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="02757-138">[![Image05](the-entity-framework-and-aspnet-getting-started-part-3/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image13.png)</span></span>

<span data-ttu-id="02757-139">ページを実行します。</span><span class="sxs-lookup"><span data-stu-id="02757-139">Run the page.</span></span> <span data-ttu-id="02757-140">学生リストは、姓の順に並べられています。</span><span class="sxs-lookup"><span data-stu-id="02757-140">The students list is now in order by last name.</span></span>

<span data-ttu-id="02757-141">[![Image04](the-entity-framework-and-aspnet-getting-started-part-3/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="02757-141">[![Image04](the-entity-framework-and-aspnet-getting-started-part-3/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image15.png)</span></span>

## <a name="using-a-control-parameter-to-set-the-where-property"></a><span data-ttu-id="02757-142">コントロールパラメーターを使用して "Where" プロパティを設定する</span><span class="sxs-lookup"><span data-stu-id="02757-142">Using a Control Parameter to Set the "Where" Property</span></span>

<span data-ttu-id="02757-143">他のデータソースコントロールと同様に、パラメーター値を `Where` プロパティに渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="02757-143">As with other data source controls, you can pass parameter values to the `Where` property.</span></span> <span data-ttu-id="02757-144">チュートリアルのパート2で作成した [course *] ページで*、この方法を使用して、ユーザーがドロップダウンリストから選択した学科に関連付けられているコースを表示できます。</span><span class="sxs-lookup"><span data-stu-id="02757-144">On the *Courses.aspx* page that you created in part 2 of the tutorial, you can use this method to display courses that are associated with the department that a user selects from the drop-down list.</span></span>

<span data-ttu-id="02757-145">Course*を開き、[* **デザイン**] ビューに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="02757-145">Open *Courses.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="02757-146">2つ目の `EntityDataSource` コントロールをページに追加し、`CoursesEntityDataSource`という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="02757-146">Add a second `EntityDataSource` control to the page, and name it `CoursesEntityDataSource`.</span></span> <span data-ttu-id="02757-147">それを `SchoolEntities` モデルに接続し、[`Courses`] を**EntitySetName**値として選択します。</span><span class="sxs-lookup"><span data-stu-id="02757-147">Connect it to the `SchoolEntities` model, and select `Courses` as the **EntitySetName** value.</span></span>

<span data-ttu-id="02757-148">**[プロパティ]** ウィンドウで、 **[Where]** プロパティボックスの省略記号をクリックします。</span><span class="sxs-lookup"><span data-stu-id="02757-148">In the **Properties** window, click the ellipsis in the **Where** property box.</span></span> <span data-ttu-id="02757-149">( **[プロパティ]** ウィンドウを使用する前に、`CoursesEntityDataSource` コントロールが選択されていることを確認してください)。</span><span class="sxs-lookup"><span data-stu-id="02757-149">(Make sure the `CoursesEntityDataSource` control is still selected before using the **Properties** window.)</span></span>

<span data-ttu-id="02757-150">[![Image06](the-entity-framework-and-aspnet-getting-started-part-3/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="02757-150">[![Image06](the-entity-framework-and-aspnet-getting-started-part-3/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image17.png)</span></span>

<span data-ttu-id="02757-151">**[式エディター]** ダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="02757-151">The **Expression Editor** dialog box is displayed.</span></span> <span data-ttu-id="02757-152">このダイアログボックスで、 **[指定されたパラメーターに基づいて Where 式を自動的に生成する]** を選択し、 **[パラメーターの追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="02757-152">In this dialog box, select **Automatically generate the Where expression based on the provided parameters**, and then click **Add Parameter**.</span></span> <span data-ttu-id="02757-153">パラメーターに `DepartmentID`という名前を付け、 **[ソース]** の値として **[コントロール]** を選択し、 **ControlID**値として **[DepartmentsDropDownList]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="02757-153">Name the parameter `DepartmentID`, select **Control** as the **Parameter source** value, and select **DepartmentsDropDownList** as the **ControlID** value.</span></span>

<span data-ttu-id="02757-154">[![Image07](the-entity-framework-and-aspnet-getting-started-part-3/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="02757-154">[![Image07](the-entity-framework-and-aspnet-getting-started-part-3/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image19.png)</span></span>

<span data-ttu-id="02757-155">**[詳細プロパティの表示]** をクリックし、 **[式エディター]** ダイアログボックスの **[プロパティ]** ウィンドウで、[`Type`] プロパティを `Int32`に変更します。</span><span class="sxs-lookup"><span data-stu-id="02757-155">Click **Show advanced properties**, and in the **Properties** window of the **Expression Editor** dialog box, change the `Type` property to `Int32`.</span></span>

<span data-ttu-id="02757-156">[![Image15](the-entity-framework-and-aspnet-getting-started-part-3/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="02757-156">[![Image15](the-entity-framework-and-aspnet-getting-started-part-3/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image21.png)</span></span>

<span data-ttu-id="02757-157">完了したら **[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="02757-157">When you're done, click **OK**.</span></span>

<span data-ttu-id="02757-158">ドロップダウンリストの下で、ページに `GridView` コントロールを追加し、`CoursesGridView`という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="02757-158">Below the drop-down list, add a `GridView` control to the page and name it `CoursesGridView`.</span></span> <span data-ttu-id="02757-159">`CoursesEntityDataSource` データソースコントロールに接続し、 **[スキーマの更新]** をクリックし、 **[列の編集]** をクリックして、`DepartmentID` 列を削除します。</span><span class="sxs-lookup"><span data-stu-id="02757-159">Connect it to the `CoursesEntityDataSource` data source control, click **Refresh Schema**, click **Edit Columns**, and remove the `DepartmentID` column.</span></span> <span data-ttu-id="02757-160">`GridView` コントロールのマークアップは、次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="02757-160">The `GridView` control markup resembles the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample1.aspx)]

<span data-ttu-id="02757-161">ユーザーがドロップダウンリストで選択した部署を変更すると、関連するコースの一覧が自動的に変更されます。</span><span class="sxs-lookup"><span data-stu-id="02757-161">When the user changes the selected department in the drop-down list, you want the list of associated courses to change automatically.</span></span> <span data-ttu-id="02757-162">これを行うには、ドロップダウンリストを選択し、 **[プロパティ]** ウィンドウの [`AutoPostBack`] プロパティを `True`に設定します。</span><span class="sxs-lookup"><span data-stu-id="02757-162">To make this happen, select the drop-down list, and in the **Properties** window set the `AutoPostBack` property to `True`.</span></span>

<span data-ttu-id="02757-163">[![Image08](the-entity-framework-and-aspnet-getting-started-part-3/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="02757-163">[![Image08](the-entity-framework-and-aspnet-getting-started-part-3/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image23.png)</span></span>

<span data-ttu-id="02757-164">デザイナーの使用が終了したので、**ソース**ビューに切り替えて、`CoursesEntityDataSource` コントロールの `ConnectionString` と `DefaultContainer` name プロパティを `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` 属性に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="02757-164">Now that you're finished using the designer, switch to **Source** view and replace the `ConnectionString` and `DefaultContainer` name properties of the `CoursesEntityDataSource` control with the `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="02757-165">完了すると、コントロールのマークアップは次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="02757-165">When you're done, the markup for the control will look like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample2.aspx)]

<span data-ttu-id="02757-166">ページを実行し、ドロップダウンリストを使用して異なる部門を選択します。</span><span class="sxs-lookup"><span data-stu-id="02757-166">Run the page and use the drop-down list to select different departments.</span></span> <span data-ttu-id="02757-167">選択した部門によって提供されるコースのみが、`GridView` コントロールに表示されます。</span><span class="sxs-lookup"><span data-stu-id="02757-167">Only courses that are offered by the selected department are displayed in the `GridView` control.</span></span>

<span data-ttu-id="02757-168">[![Image09](the-entity-framework-and-aspnet-getting-started-part-3/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="02757-168">[![Image09](the-entity-framework-and-aspnet-getting-started-part-3/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image25.png)</span></span>

## <a name="using-the-entitydatasource-groupby-property-to-group-data"></a><span data-ttu-id="02757-169">EntityDataSource "GroupBy" プロパティを使用してデータをグループ化する</span><span class="sxs-lookup"><span data-stu-id="02757-169">Using the EntityDataSource "GroupBy" Property to Group Data</span></span>

<span data-ttu-id="02757-170">Contoso 大学が [About] ページに生徒の本文の統計をいくつか配置したいとします。</span><span class="sxs-lookup"><span data-stu-id="02757-170">Suppose Contoso University wants to put some student-body statistics on its About page.</span></span> <span data-ttu-id="02757-171">具体的には、学生の数の内訳を、登録した日付で表示したいと考えています。</span><span class="sxs-lookup"><span data-stu-id="02757-171">Specifically, it wants to show a breakdown of numbers of students by the date they enrolled.</span></span>

<span data-ttu-id="02757-172">*About .aspx*を開き、**ソース**ビューで、`BodyContent` コントロールの既存の内容を、`h2` タグの "Student Body Statistics" に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="02757-172">Open *About.aspx*, and in **Source** view, replace the existing contents of the `BodyContent` control with "Student Body Statistics" between `h2` tags:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample3.aspx)]

<span data-ttu-id="02757-173">見出しの後に `EntityDataSource` コントロールを追加し、`StudentStatisticsEntityDataSource`という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="02757-173">After the heading, add an `EntityDataSource` control and name it `StudentStatisticsEntityDataSource`.</span></span> <span data-ttu-id="02757-174">`SchoolEntities`に接続し、`People` エンティティセットを選択して、ウィザードの **[選択**] ボックスを変更せずにそのままにします。</span><span class="sxs-lookup"><span data-stu-id="02757-174">Connect it to `SchoolEntities`, select the `People` entity set, and leave the **Select** box in the wizard unchanged.</span></span> <span data-ttu-id="02757-175">**[プロパティ]** ウィンドウで、次のプロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="02757-175">Set the following properties in the **Properties** window:</span></span>

- <span data-ttu-id="02757-176">学生のみをフィルター処理するには、[`Where`] プロパティを [`it.EnrollmentDate is not null`] に設定します。</span><span class="sxs-lookup"><span data-stu-id="02757-176">To filter for students only, set the `Where` property to `it.EnrollmentDate is not null`.</span></span>
- <span data-ttu-id="02757-177">登録日に結果をグループ化するには、`GroupBy` プロパティを `it.EnrollmentDate`に設定します。</span><span class="sxs-lookup"><span data-stu-id="02757-177">To group the results by the enrollment date, set the `GroupBy` property to `it.EnrollmentDate`.</span></span>
- <span data-ttu-id="02757-178">学生の登録日と数を選択するには、`Select` プロパティを `it.EnrollmentDate, Count(it.EnrollmentDate) AS NumberOfStudents`に設定します。</span><span class="sxs-lookup"><span data-stu-id="02757-178">To select the enrollment date and the number of students, set the `Select` property to `it.EnrollmentDate, Count(it.EnrollmentDate) AS NumberOfStudents`.</span></span>
- <span data-ttu-id="02757-179">登録日によって結果を並べ替えるには、`OrderBy` プロパティを `it.EnrollmentDate`に設定します。</span><span class="sxs-lookup"><span data-stu-id="02757-179">To order the results by the enrollment date, set the `OrderBy` property to `it.EnrollmentDate`.</span></span>

<span data-ttu-id="02757-180">**ソース**ビューで、`ConnectionString` と `DefaultContainer` name プロパティを `ContextTypeName` プロパティに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="02757-180">In **Source** view, replace the `ConnectionString` and `DefaultContainer` name properties with a `ContextTypeName` property.</span></span> <span data-ttu-id="02757-181">`EntityDataSource` コントロールのマークアップは、次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="02757-181">The `EntityDataSource` control markup now resembles the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample4.aspx)]

<span data-ttu-id="02757-182">`Select`、`GroupBy`、および `Where` プロパティの構文は、現在のエンティティを指定する `it` キーワードを除き、Transact-sql に似ています。</span><span class="sxs-lookup"><span data-stu-id="02757-182">The syntax of the `Select`, `GroupBy`, and `Where` properties resembles Transact-SQL except for the `it` keyword that specifies the current entity.</span></span>

<span data-ttu-id="02757-183">次のマークアップを追加して、データを表示する `GridView` コントロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="02757-183">Add the following markup to create a `GridView` control to display the data.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample5.aspx)]

<span data-ttu-id="02757-184">ページを実行して、登録日別に生徒の数を示す一覧を表示します。</span><span class="sxs-lookup"><span data-stu-id="02757-184">Run the page to see a list showing the number of students by enrollment date.</span></span>

<span data-ttu-id="02757-185">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="02757-185">[![Image10](the-entity-framework-and-aspnet-getting-started-part-3/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image27.png)</span></span>

## <a name="using-the-queryextender-control-for-filtering-and-ordering"></a><span data-ttu-id="02757-186">フィルター処理と順序付けに QueryExtender コントロールを使用する</span><span class="sxs-lookup"><span data-stu-id="02757-186">Using the QueryExtender Control for Filtering and Ordering</span></span>

<span data-ttu-id="02757-187">`QueryExtender` コントロールは、マークアップでフィルター処理と並べ替えを指定する方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="02757-187">The `QueryExtender` control provides a way to specify filtering and sorting in markup.</span></span> <span data-ttu-id="02757-188">構文は、使用しているデータベース管理システム (DBMS) に依存しません。</span><span class="sxs-lookup"><span data-stu-id="02757-188">The syntax is independent of the database management system (DBMS) you're using.</span></span> <span data-ttu-id="02757-189">また、一般に Entity Framework に依存しません。ただし、ナビゲーションプロパティに使用する構文は、Entity Framework に固有です。</span><span class="sxs-lookup"><span data-stu-id="02757-189">It's also generally independent of the Entity Framework, with the exception that syntax you use for navigation properties is unique to the Entity Framework.</span></span>

<span data-ttu-id="02757-190">チュートリアルのこの部分では、`QueryExtender` コントロールを使用してデータのフィルター処理と並べ替えを行います。また、いずれかの並べ替えフィールドがナビゲーションプロパティになります。</span><span class="sxs-lookup"><span data-stu-id="02757-190">In this part of the tutorial you'll use a `QueryExtender` control to filter and order data, and one of the order-by fields will be a navigation property.</span></span>

<span data-ttu-id="02757-191">(マークアップではなくコードを使用して、`EntityDataSource` コントロールによって自動的に生成されるクエリを拡張する場合は、`QueryCreated` イベントを処理することによってこれを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="02757-191">(If you prefer to use code instead of markup to extend the queries that are automatically generated by the `EntityDataSource` control, you can do that by handling the `QueryCreated` event.</span></span> <span data-ttu-id="02757-192">これは、`QueryExtender` コントロールが `EntityDataSource` コントロールクエリも拡張する方法です)。</span><span class="sxs-lookup"><span data-stu-id="02757-192">This is how the `QueryExtender` control extends `EntityDataSource` control queries also.)</span></span>

<span data-ttu-id="02757-193">*[Course] ページを*開き、前の手順で追加したマークアップの下に、次のマークアップを挿入して、見出し、検索文字列を入力するためのテキストボックス、検索ボタン、および `Courses` エンティティセットにバインドされている `EntityDataSource` コントロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="02757-193">Open the *Courses.aspx* page, and below the markup you added previously, insert the following markup to create a heading, a text box for entering search strings, a search button, and an `EntityDataSource` control that's bound to the `Courses` entity set.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample6.aspx)]

<span data-ttu-id="02757-194">`EntityDataSource` コントロールの `Include` プロパティが `Department`に設定されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="02757-194">Notice that the `EntityDataSource` control's `Include` property is set to `Department`.</span></span> <span data-ttu-id="02757-195">データベースでは、`Course` テーブルに部門名が含まれていません。これには、`DepartmentID` の外部キー列が含まれています。</span><span class="sxs-lookup"><span data-stu-id="02757-195">In the database, the `Course` table does not contain the department name; it contains a `DepartmentID` foreign key column.</span></span> <span data-ttu-id="02757-196">データベースに対して直接クエリを実行した場合は、学科名をコースデータと共に取得するために、`Course` テーブルと `Department` テーブルを結合する必要があります。</span><span class="sxs-lookup"><span data-stu-id="02757-196">If you were querying the database directly, to get the department name along with course data, you would have to join the `Course` and `Department` tables.</span></span> <span data-ttu-id="02757-197">`Include` プロパティを `Department`に設定することにより、Entity Framework が `Course` エンティティを取得するときに関連する `Department` エンティティを取得する処理を行う必要があることを指定します。</span><span class="sxs-lookup"><span data-stu-id="02757-197">By setting the `Include` property to `Department`, you specify that the Entity Framework should do the work of getting the related `Department` entity when it gets a `Course` entity.</span></span> <span data-ttu-id="02757-198">`Department` エンティティは、`Course` エンティティの `Department` ナビゲーションプロパティに格納されます。</span><span class="sxs-lookup"><span data-stu-id="02757-198">The `Department` entity is then stored in the `Department` navigation property of the `Course` entity.</span></span> <span data-ttu-id="02757-199">(既定では、データモデルデザイナーによって生成された `SchoolEntities` クラスは、必要に応じて関連データを取得します。また、データソースコントロールをそのクラスにバインドしているので、`Include` プロパティを設定する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="02757-199">(By default, the `SchoolEntities` class that was generated by the data model designer retrieves related data when it's needed, and you've bound the data source control to that class, so setting the `Include` property is not necessary.</span></span> <span data-ttu-id="02757-200">ただし、これを設定すると、ページのパフォーマンスが向上します。それ以外の場合、Entity Framework は、`Course` エンティティおよび関連する `Department` エンティティのデータを取得するためにデータベースを個別に呼び出します。</span><span class="sxs-lookup"><span data-stu-id="02757-200">However, setting it improves performance of the page, because otherwise the Entity Framework would make separate calls to the database to retrieve data for the `Course` entities and for the related `Department` entities.)</span></span>

<span data-ttu-id="02757-201">`EntityDataSource` コントロールを作成した後、次のマークアップを挿入して、その `EntityDataSource` コントロールにバインドされている `QueryExtender` コントロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="02757-201">After the `EntityDataSource` control you just created, insert the following markup to create a `QueryExtender` control that's bound to that `EntityDataSource` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample7.aspx)]

<span data-ttu-id="02757-202">`SearchExpression` 要素は、テキストボックスに入力された値にタイトルが一致するコースを選択するように指定します。</span><span class="sxs-lookup"><span data-stu-id="02757-202">The `SearchExpression` element specifies that you want to select courses whose titles match the value entered in the text box.</span></span> <span data-ttu-id="02757-203">`SearchType` プロパティでは `StartsWith`が指定されているため、テキストボックスに入力した文字数だけが比較されます。</span><span class="sxs-lookup"><span data-stu-id="02757-203">Only as many characters as are entered in the text box will be compared, because the `SearchType` property specifies `StartsWith`.</span></span>

<span data-ttu-id="02757-204">`OrderByExpression` 要素は、結果セットが学科名内のコースタイトルで並べ替えられることを指定します。</span><span class="sxs-lookup"><span data-stu-id="02757-204">The `OrderByExpression` element specifies that the result set will be ordered by course title within department name.</span></span> <span data-ttu-id="02757-205">部署名が指定されていることに注意してください: `Department.Name`。</span><span class="sxs-lookup"><span data-stu-id="02757-205">Notice how department name is specified: `Department.Name`.</span></span> <span data-ttu-id="02757-206">`Course` エンティティと `Department` エンティティ間のアソシエーションは一対一であるため、`Department` ナビゲーションプロパティには `Department` エンティティが含まれます。</span><span class="sxs-lookup"><span data-stu-id="02757-206">Because the association between the `Course` entity and the `Department` entity is one-to-one, the `Department` navigation property contains a `Department` entity.</span></span> <span data-ttu-id="02757-207">(これが一対多のリレーションシップである場合、プロパティにはコレクションが含まれます)。部署名を取得するには、`Department` エンティティの `Name` プロパティを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="02757-207">(If this were a one-to-many relationship, the property would contain a collection.) To get the department name, you must specify the `Name` property of the `Department` entity.</span></span>

<span data-ttu-id="02757-208">最後に、`GridView` コントロールを追加してコースの一覧を表示します。</span><span class="sxs-lookup"><span data-stu-id="02757-208">Finally, add a `GridView` control to display the list of courses:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample8.aspx)]

<span data-ttu-id="02757-209">最初の列は、部署名を表示するテンプレートフィールドです。</span><span class="sxs-lookup"><span data-stu-id="02757-209">The first column is a template field that displays the department name.</span></span> <span data-ttu-id="02757-210">Databinding 式は、`QueryExtender` コントロールの場合と同様に `Department.Name`を指定します。</span><span class="sxs-lookup"><span data-stu-id="02757-210">The databinding expression specifies `Department.Name`, just as you saw in the `QueryExtender` control.</span></span>

<span data-ttu-id="02757-211">ページを実行します。</span><span class="sxs-lookup"><span data-stu-id="02757-211">Run the page.</span></span> <span data-ttu-id="02757-212">最初の表示では、すべてのコースの一覧が部署別、そしてコースタイトル別に表示されます。</span><span class="sxs-lookup"><span data-stu-id="02757-212">The initial display shows a list of all courses in order by department and then by course title.</span></span>

<span data-ttu-id="02757-213">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="02757-213">[![Image11](the-entity-framework-and-aspnet-getting-started-part-3/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image29.png)</span></span>

<span data-ttu-id="02757-214">"M" を入力し、 **[検索]** をクリックすると、タイトルが "m" で始まるすべてのコースが表示されます (検索では大文字と小文字が区別されません)。</span><span class="sxs-lookup"><span data-stu-id="02757-214">Enter an "m" and click **Search** to see all courses whose titles begin with "m" (the search is not case sensitive).</span></span>

<span data-ttu-id="02757-215">[![Image12](the-entity-framework-and-aspnet-getting-started-part-3/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="02757-215">[![Image12](the-entity-framework-and-aspnet-getting-started-part-3/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image31.png)</span></span>

## <a name="using-the-like-operator-to-filter-data"></a><span data-ttu-id="02757-216">"Like" 演算子を使用したデータのフィルター処理</span><span class="sxs-lookup"><span data-stu-id="02757-216">Using the "Like" Operator to Filter Data</span></span>

<span data-ttu-id="02757-217">`Like` コントロールの `EntityDataSource` プロパティで `Where` 演算子を使用することにより、`QueryExtender` コントロールの `StartsWith`、`Contains`、および `EndsWith` 検索の種類と同様の効果を得ることができます。</span><span class="sxs-lookup"><span data-stu-id="02757-217">You can achieve an effect similar to the `QueryExtender` control's `StartsWith`, `Contains`, and `EndsWith` search types by using a `Like` operator in the `EntityDataSource` control's `Where` property.</span></span> <span data-ttu-id="02757-218">チュートリアルのこの部分では、`Like` 演算子を使用して、名前で学生を検索する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="02757-218">In this part of the tutorial, you'll see how to use the `Like` operator to search for a student by name.</span></span>

<span data-ttu-id="02757-219">**ソース**ビューで*student を*開きます。</span><span class="sxs-lookup"><span data-stu-id="02757-219">Open *Students.aspx* in **Source** view.</span></span> <span data-ttu-id="02757-220">`GridView` コントロールの後に、次のマークアップを追加します。</span><span class="sxs-lookup"><span data-stu-id="02757-220">After the `GridView` control, add the following markup:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-3/samples/sample9.aspx)]

<span data-ttu-id="02757-221">このマークアップは、前に示したものと似ていますが、`Where` のプロパティ値は除きます。</span><span class="sxs-lookup"><span data-stu-id="02757-221">This markup is similar to what you've seen earlier except for the `Where` property value.</span></span> <span data-ttu-id="02757-222">`Where` 式の2番目の部分では、テキストボックスに入力されたものの姓と名の両方を検索する部分文字列検索 (`LIKE %FirstMidName% or LIKE %LastName%`) を定義します。</span><span class="sxs-lookup"><span data-stu-id="02757-222">The second part of the `Where` expression defines a substring search (`LIKE %FirstMidName% or LIKE %LastName%`) that searches both the first and last names for whatever is entered in the text box.</span></span>

<span data-ttu-id="02757-223">ページを実行します。</span><span class="sxs-lookup"><span data-stu-id="02757-223">Run the page.</span></span> <span data-ttu-id="02757-224">`StudentName` パラメーターの既定値は "%" であるため、最初はすべての学生が表示されます。</span><span class="sxs-lookup"><span data-stu-id="02757-224">Initially you see all of the students because the default value for the `StudentName` parameter is "%".</span></span>

<span data-ttu-id="02757-225">[![Image13](the-entity-framework-and-aspnet-getting-started-part-3/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="02757-225">[![Image13](the-entity-framework-and-aspnet-getting-started-part-3/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image33.png)</span></span>

<span data-ttu-id="02757-226">テキストボックスに「g」という文字を入力し、 **[検索]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="02757-226">Enter the letter "g" in the text box and click **Search**.</span></span> <span data-ttu-id="02757-227">姓または名のいずれかに "g" を持つ学生の一覧が表示されます。</span><span class="sxs-lookup"><span data-stu-id="02757-227">You see a list of students that have a "g" in either the first or last name.</span></span>

<span data-ttu-id="02757-228">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="02757-228">[![Image14](the-entity-framework-and-aspnet-getting-started-part-3/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-3/_static/image35.png)</span></span>

<span data-ttu-id="02757-229">個々のテーブルのデータの表示、更新、フィルター処理、並べ替え、およびグループ化が完了しました。</span><span class="sxs-lookup"><span data-stu-id="02757-229">You've now displayed, updated, filtered, ordered, and grouped data from individual tables.</span></span> <span data-ttu-id="02757-230">次のチュートリアルでは、関連データ (マスター詳細シナリオ) の操作を開始します。</span><span class="sxs-lookup"><span data-stu-id="02757-230">In the next tutorial you'll begin to work with related data (master-detail scenarios).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="02757-231">[前へ](the-entity-framework-and-aspnet-getting-started-part-2.md)
> [次へ](the-entity-framework-and-aspnet-getting-started-part-4.md)</span><span class="sxs-lookup"><span data-stu-id="02757-231">[Previous](the-entity-framework-and-aspnet-getting-started-part-2.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-4.md)</span></span>
