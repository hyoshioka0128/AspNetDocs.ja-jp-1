---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-7
title: Entity Framework 4.0 Database First および ASP.NET 4 Web フォームでのはじめに-パート 7 |Microsoft Docs
author: tdykstra
description: Contoso 大学のサンプル web アプリケーションは、Entity Framework を使用して ASP.NET Web フォームアプリケーションを作成する方法を示しています。 サンプルアプリケーションは...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: f8afb245-b705-419c-8790-0b295e90d5e2
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-7
msc.type: authoredcontent
ms.openlocfilehash: 18d4b44c5e23fd6942c3adf48a33a5602e6df6d0
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78488524"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-7"></a><span data-ttu-id="cfe34-104">Entity Framework 4.0 Database First および ASP.NET 4 Web フォームでのはじめに-パート7</span><span class="sxs-lookup"><span data-stu-id="cfe34-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 7</span></span>

<span data-ttu-id="cfe34-105">[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="cfe34-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="cfe34-106">Contoso 大学のサンプル web アプリケーションは、Entity Framework 4.0 と Visual Studio 2010 を使用して ASP.NET Web フォームアプリケーションを作成する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="cfe34-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="cfe34-107">チュートリアルシリーズの詳細については、[シリーズの最初のチュートリアル](the-entity-framework-and-aspnet-getting-started-part-1.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="cfe34-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="using-stored-procedures"></a><span data-ttu-id="cfe34-108">ストアド プロシージャの使用</span><span class="sxs-lookup"><span data-stu-id="cfe34-108">Using Stored Procedures</span></span>

<span data-ttu-id="cfe34-109">前のチュートリアルでは、階層ごとのテーブル継承パターンを実装しています。</span><span class="sxs-lookup"><span data-stu-id="cfe34-109">In the previous tutorial you implemented a table-per-hierarchy inheritance pattern.</span></span> <span data-ttu-id="cfe34-110">このチュートリアルでは、ストアドプロシージャを使用してデータベースアクセスをより細かく制御する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-110">This tutorial will show you how to use stored procedures to gain more control over database access.</span></span>

<span data-ttu-id="cfe34-111">Entity Framework では、データベースアクセスにストアドプロシージャを使用するように指定できます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-111">The Entity Framework lets you specify that it should use stored procedures for database access.</span></span> <span data-ttu-id="cfe34-112">任意のエンティティ型について、その型のエンティティを作成、更新、または削除するために使用するストアドプロシージャを指定できます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-112">For any entity type, you can specify a stored procedure to use for creating, updating, or deleting entities of that type.</span></span> <span data-ttu-id="cfe34-113">次に、データモデルで、エンティティのセットの取得などのタスクを実行するために使用できるストアドプロシージャへの参照を追加できます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-113">Then in the data model you can add references to stored procedures that you can use to perform tasks such as retrieving sets of entities.</span></span>

<span data-ttu-id="cfe34-114">ストアドプロシージャの使用は、データベースアクセスの一般的な要件です。</span><span class="sxs-lookup"><span data-stu-id="cfe34-114">Using stored procedures is a common requirement for database access.</span></span> <span data-ttu-id="cfe34-115">場合によっては、データベース管理者は、セキュリティ上の理由により、すべてのデータベースアクセスでストアドプロシージャを通過することが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="cfe34-115">In some cases a database administrator may require that all database access go through stored procedures for security reasons.</span></span> <span data-ttu-id="cfe34-116">場合によっては、Entity Framework がデータベースを更新するときに使用するプロセスの一部にビジネスロジックを組み込むこともできます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-116">In other cases you may want to build business logic into some of the processes that the Entity Framework uses when it updates the database.</span></span> <span data-ttu-id="cfe34-117">たとえば、エンティティが削除されるたびに、そのエンティティをアーカイブデータベースにコピーすることができます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-117">For example, whenever an entity is deleted you might want to copy it to an archive database.</span></span> <span data-ttu-id="cfe34-118">または、行が更新されるたびに、変更を行ったユーザーを記録する行をログテーブルに書き込むことができます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-118">Or whenever a row is updated you might want to write a row to a logging table that records who made the change.</span></span> <span data-ttu-id="cfe34-119">これらのタスクは、Entity Framework がエンティティを削除するかエンティティを更新するたびに呼び出されるストアドプロシージャで実行できます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-119">You can perform these kinds of tasks in a stored procedure that's called whenever the Entity Framework deletes an entity or updates an entity.</span></span>

<span data-ttu-id="cfe34-120">前のチュートリアルと同様に、新しいページは作成されません。</span><span class="sxs-lookup"><span data-stu-id="cfe34-120">As in the previous tutorial, you'll not create any new pages.</span></span> <span data-ttu-id="cfe34-121">代わりに、既に作成した一部のページに対して Entity Framework がデータベースにアクセスする方法を変更します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-121">Instead, you'll change the way the Entity Framework accesses the database for some of the pages you already created.</span></span>

<span data-ttu-id="cfe34-122">このチュートリアルでは、`Student` と `Instructor` エンティティを挿入するためのストアドプロシージャをデータベースに作成します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-122">In this tutorial you'll create stored procedures in the database for inserting `Student` and `Instructor` entities.</span></span> <span data-ttu-id="cfe34-123">これらのデータモデルをデータモデルに追加し、データベースに `Student` および `Instructor` エンティティを追加するために Entity Framework でそれらを使用するように指定します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-123">You'll add them to the data model, and you'll specify that the Entity Framework should use them for adding `Student` and `Instructor` entities to the database.</span></span> <span data-ttu-id="cfe34-124">また、`Course` エンティティを取得するために使用できるストアドプロシージャも作成します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-124">You'll also create a stored procedure that you can use to retrieve `Course` entities.</span></span>

## <a name="creating-stored-procedures-in-the-database"></a><span data-ttu-id="cfe34-125">データベースでのストアドプロシージャの作成</span><span class="sxs-lookup"><span data-stu-id="cfe34-125">Creating Stored Procedures in the Database</span></span>

<span data-ttu-id="cfe34-126">(このチュートリアルでダウンロード可能なプロジェクトの*School .mdf*ファイルを使用している場合は、ストアドプロシージャが既に存在しているため、このセクションをスキップできます)。</span><span class="sxs-lookup"><span data-stu-id="cfe34-126">(If you're using the *School.mdf* file from the project available for download with this tutorial, you can skip this section because the stored procedures already exist.)</span></span>

<span data-ttu-id="cfe34-127">**サーバーエクスプローラー**で、[ *School .mdf*] を展開し、 **[ストアドプロシージャ]** を右クリックして、 **[新しいストアドプロシージャの追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-127">In **Server Explorer**, expand *School.mdf*, right-click **Stored Procedures**, and select **Add New Stored Procedure**.</span></span>

<span data-ttu-id="cfe34-128">[![image15](the-entity-framework-and-aspnet-getting-started-part-7/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-128">[![image15](the-entity-framework-and-aspnet-getting-started-part-7/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image1.png)</span></span>

<span data-ttu-id="cfe34-129">次の SQL ステートメントをコピーし、[ストアドプロシージャ] ウィンドウに貼り付けて、スケルトンストアドプロシージャを置き換えます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-129">Copy the following SQL statements and paste them into the stored procedure window, replacing the skeleton stored procedure.</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample1.sql)]

<span data-ttu-id="cfe34-130">[![image14](the-entity-framework-and-aspnet-getting-started-part-7/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-130">[![image14](the-entity-framework-and-aspnet-getting-started-part-7/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image3.png)</span></span>

<span data-ttu-id="cfe34-131">`Student` エンティティには、`PersonID`、`LastName`、`FirstName`、および `EnrollmentDate`の4つのプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="cfe34-131">`Student` entities have four properties: `PersonID`, `LastName`, `FirstName`, and `EnrollmentDate`.</span></span> <span data-ttu-id="cfe34-132">データベースは ID 値を自動的に生成し、ストアドプロシージャは他の3つのパラメーターを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="cfe34-132">The database generates the ID value automatically, and the stored procedure accepts parameters for the other three.</span></span> <span data-ttu-id="cfe34-133">このストアドプロシージャは、新しい行のレコードキーの値を返します。これにより、Entity Framework は、メモリ内に保持されているエンティティのバージョンで追跡できるようになります。</span><span class="sxs-lookup"><span data-stu-id="cfe34-133">The stored procedure returns the value of the new row's record key so that the Entity Framework can keep track of that in the version of the entity it keeps in memory.</span></span>

<span data-ttu-id="cfe34-134">ストアドプロシージャウィンドウを保存して閉じます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-134">Save and close the stored procedure window.</span></span>

<span data-ttu-id="cfe34-135">次の SQL ステートメントを使用して、同じ方法で `InsertInstructor` ストアドプロシージャを作成します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-135">Create an `InsertInstructor` stored procedure in the same manner, using the following SQL statements:</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample2.sql)]

<span data-ttu-id="cfe34-136">`Student` エンティティと `Instructor` エンティティの `Update` ストアドプロシージャも作成します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-136">Create `Update` stored procedures for `Student` and `Instructor` entities also.</span></span> <span data-ttu-id="cfe34-137">(データベースには、`Instructor` と `Student` の両方のエンティティに対して機能する `DeletePerson` ストアドプロシージャが既に存在します。)</span><span class="sxs-lookup"><span data-stu-id="cfe34-137">(The database already has a `DeletePerson` stored procedure which will work for both `Instructor` and `Student` entities.)</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample3.sql)]

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample4.sql)]

<span data-ttu-id="cfe34-138">このチュートリアルでは、各エンティティ型に対して、挿入、更新、および削除の3つのすべての関数をマップします。</span><span class="sxs-lookup"><span data-stu-id="cfe34-138">In this tutorial you'll map all three functions -- insert, update, and delete -- for each entity type.</span></span> <span data-ttu-id="cfe34-139">Entity Framework version 4 では、これらの関数のうち1つまたは2つだけをストアドプロシージャにマップすることができます。ただし、次の例外があります。 update 関数をマップしても delete 関数をマップしない場合、Entity Framework は例外をスローします。エンティティを削除しようとしています。</span><span class="sxs-lookup"><span data-stu-id="cfe34-139">The Entity Framework version 4 allows you to map just one or two of these functions to stored procedures without mapping the others, with one exception: if you map the update function but not the delete function, the Entity Framework will throw an exception when you attempt to delete an entity.</span></span> <span data-ttu-id="cfe34-140">Entity Framework バージョン3.5 では、ストアドプロシージャのマッピングがこれほど柔軟性がありませんでした。1つの関数をマップした場合は、3つすべてをマップする必要がありました。</span><span class="sxs-lookup"><span data-stu-id="cfe34-140">In the Entity Framework version 3.5, you did not have this much flexibility in mapping stored procedures: if you mapped one function you were required to map all three.</span></span>

<span data-ttu-id="cfe34-141">更新データではなく読み取りを行うストアドプロシージャを作成するには、次の SQL ステートメントを使用して、すべての `Course` エンティティを選択するストアドプロシージャを作成します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-141">To create a stored procedure that reads rather than updates data, create one that selects all `Course` entities, using the following SQL statements:</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample5.sql)]

## <a name="adding-the-stored-procedures-to-the-data-model"></a><span data-ttu-id="cfe34-142">ストアドプロシージャをデータモデルに追加する</span><span class="sxs-lookup"><span data-stu-id="cfe34-142">Adding the Stored Procedures to the Data Model</span></span>

<span data-ttu-id="cfe34-143">これで、ストアドプロシージャがデータベースに定義されましたが、Entity Framework で使用できるようにするには、それらをデータモデルに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="cfe34-143">The stored procedures are now defined in the database, but they must be added to the data model to make them available to the Entity Framework.</span></span> <span data-ttu-id="cfe34-144">*SchoolModel*を開き、デザイン画面を右クリックして、 **[データベースからモデルを更新]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-144">Open *SchoolModel.edmx*, right-click the design surface, and select **Update Model from Database**.</span></span> <span data-ttu-id="cfe34-145">**[データベースオブジェクトの選択]** ダイアログボックスの **[追加]** タブで、 **[ストアドプロシージャ]** を展開し、新しく作成したストアドプロシージャと `DeletePerson` ストアドプロシージャを選択して、 **[完了]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="cfe34-145">In the **Add** tab of the **Choose Your Database Objects** dialog box, expand **Stored Procedures**, select the newly created stored procedures and the `DeletePerson` stored procedure, and then click **Finish**.</span></span>

<span data-ttu-id="cfe34-146">[![image20](the-entity-framework-and-aspnet-getting-started-part-7/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-146">[![image20](the-entity-framework-and-aspnet-getting-started-part-7/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image5.png)</span></span>

## <a name="mapping-the-stored-procedures"></a><span data-ttu-id="cfe34-147">ストアドプロシージャのマッピング</span><span class="sxs-lookup"><span data-stu-id="cfe34-147">Mapping the Stored Procedures</span></span>

<span data-ttu-id="cfe34-148">データモデルデザイナーで、`Student` エンティティを右クリックし、 **[ストアドプロシージャマッピング]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-148">In the data model designer, right-click the `Student` entity and select **Stored Procedure Mapping**.</span></span>

<span data-ttu-id="cfe34-149">[![image21](the-entity-framework-and-aspnet-getting-started-part-7/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-149">[![image21](the-entity-framework-and-aspnet-getting-started-part-7/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image7.png)</span></span>

<span data-ttu-id="cfe34-150">**[マッピングの詳細]** ウィンドウが表示されます。このウィンドウでは、Entity Framework がこの種類のエンティティの挿入、更新、および削除に使用するストアドプロシージャを指定できます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-150">The **Mapping Details** window appears, in which you can specify stored procedures that the Entity Framework should use for inserting, updating, and deleting entities of this type.</span></span>

<span data-ttu-id="cfe34-151">[![image22](the-entity-framework-and-aspnet-getting-started-part-7/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-151">[![image22](the-entity-framework-and-aspnet-getting-started-part-7/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image9.png)</span></span>

<span data-ttu-id="cfe34-152">**挿入**関数を**insertstudent**に設定します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-152">Set the **Insert** function to **InsertStudent**.</span></span> <span data-ttu-id="cfe34-153">このウィンドウには、ストアドプロシージャのパラメーターの一覧が表示されます。各パラメーターは、エンティティプロパティにマップされている必要があります。</span><span class="sxs-lookup"><span data-stu-id="cfe34-153">The window shows a list of stored procedure parameters, each of which must be mapped to an entity property.</span></span> <span data-ttu-id="cfe34-154">これらの2つは、名前が同じであるため、自動的にマップされます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-154">Two of these are mapped automatically because the names are the same.</span></span> <span data-ttu-id="cfe34-155">`FirstName`という名前のエンティティプロパティはないため、使用可能なエンティティプロパティを示すドロップダウンリストから `FirstMidName` を手動で選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="cfe34-155">There's no entity property named `FirstName`, so you must manually select `FirstMidName` from a drop-down list that shows available entity properties.</span></span> <span data-ttu-id="cfe34-156">(これは、最初のチュートリアルで `FirstName` プロパティの名前を `FirstMidName` に変更したためです)。</span><span class="sxs-lookup"><span data-stu-id="cfe34-156">(This is because you changed the name of the `FirstName` property to `FirstMidName` in the first tutorial.)</span></span>

<span data-ttu-id="cfe34-157">[![image23](the-entity-framework-and-aspnet-getting-started-part-7/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-157">[![image23](the-entity-framework-and-aspnet-getting-started-part-7/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image11.png)</span></span>

<span data-ttu-id="cfe34-158">同じ **[マッピングの詳細]** ウィンドウで、`Update` 関数を `UpdateStudent` ストアドプロシージャにマップします (`Insert` ストアドプロシージャの場合と同様に、`FirstName`のパラメーター値として `FirstMidName` を指定していることを確認してください)。 `Delete` は `DeletePerson` ストアドプロシージャに対して関数を指定します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-158">In the same **Mapping Details** window, map the `Update` function to the `UpdateStudent` stored procedure (make sure you specify `FirstMidName` as the parameter value for `FirstName`, as you did for the `Insert` stored procedure) and the `Delete` function to the `DeletePerson` stored procedure.</span></span>

<span data-ttu-id="cfe34-159">[![image01](the-entity-framework-and-aspnet-getting-started-part-7/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-159">[![image01](the-entity-framework-and-aspnet-getting-started-part-7/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image13.png)</span></span>

<span data-ttu-id="cfe34-160">同じ手順に従って、インストラクターの挿入、更新、および削除のストアドプロシージャを `Instructor` エンティティにマップします。</span><span class="sxs-lookup"><span data-stu-id="cfe34-160">Follow the same procedure to map the insert, update, and delete stored procedures for instructors to the `Instructor` entity.</span></span>

<span data-ttu-id="cfe34-161">[![image02](the-entity-framework-and-aspnet-getting-started-part-7/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-161">[![image02](the-entity-framework-and-aspnet-getting-started-part-7/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image15.png)</span></span>

<span data-ttu-id="cfe34-162">データを更新するのではなく、読み取りを行うストアドプロシージャの場合は、 **[モデルブラウザー]** ウィンドウを使用して、ストアドプロシージャを返すエンティティ型にマップします。</span><span class="sxs-lookup"><span data-stu-id="cfe34-162">For stored procedures that read rather than update data, you use the **Model Browser** window to map the stored procedure to the entity type it returns.</span></span> <span data-ttu-id="cfe34-163">データモデルデザイナーでデザイン画面を右クリックし、 **[モデルブラウザー]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-163">In the data model designer, right-click the design surface and select **Model Browser**.</span></span> <span data-ttu-id="cfe34-164">**SchoolModel**ノードを開き、 **[ストアドプロシージャ]** ノードを開きます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-164">Open the **SchoolModel.Store** node and then open the **Stored Procedures** node.</span></span> <span data-ttu-id="cfe34-165">次に `GetCourses` ストアドプロシージャを右クリックし、 **[関数インポートの追加]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-165">Then right-click the `GetCourses` stored procedure and select **Add Function Import**.</span></span>

<span data-ttu-id="cfe34-166">[![image24](the-entity-framework-and-aspnet-getting-started-part-7/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-166">[![image24](the-entity-framework-and-aspnet-getting-started-part-7/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image17.png)</span></span>

<span data-ttu-id="cfe34-167">**[関数インポートの追加]** ダイアログボックスの [選択した**エンティティ** **のコレクションを返す**] をクリックし、返されるエンティティ型として [`Course`] を選択します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-167">In the **Add Function Import** dialog box, under **Returns a Collection Of** select **Entities**, and then select `Course` as the entity type returned.</span></span> <span data-ttu-id="cfe34-168">完了したら **[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="cfe34-168">When you're done, click **OK**.</span></span> <span data-ttu-id="cfe34-169">*.Edmx*ファイルを保存して閉じます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-169">Save and close the *.edmx* file.</span></span>

<span data-ttu-id="cfe34-170">[![image25](the-entity-framework-and-aspnet-getting-started-part-7/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-170">[![image25](the-entity-framework-and-aspnet-getting-started-part-7/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image19.png)</span></span>

## <a name="using-insert-update-and-delete-stored-procedures"></a><span data-ttu-id="cfe34-171">Insert、Update、Delete の各ストアドプロシージャの使用</span><span class="sxs-lookup"><span data-stu-id="cfe34-171">Using Insert, Update, and Delete Stored Procedures</span></span>

<span data-ttu-id="cfe34-172">データを挿入、更新、および削除するストアドプロシージャは、データモデルに追加して適切なエンティティにマップした後に、Entity Framework によって自動的に使用されます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-172">Stored procedures to insert, update, and delete data are used by the Entity Framework automatically after you've added them to the data model and mapped them to the appropriate entities.</span></span> <span data-ttu-id="cfe34-173">StudentsAdd ページを実行できるようになりました *。* 新しい Entity Framework 学生を作成するたびに、`InsertStudent` ストアドプロシージャを使用して `Student` テーブルに新しい行が追加されます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-173">You can now run the *StudentsAdd.aspx* page, and every time you create a new student, the Entity Framework will use the `InsertStudent` stored procedure to add the new row to the `Student` table.</span></span>

<span data-ttu-id="cfe34-174">[![image03](the-entity-framework-and-aspnet-getting-started-part-7/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-174">[![image03](the-entity-framework-and-aspnet-getting-started-part-7/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image21.png)</span></span>

<span data-ttu-id="cfe34-175">*Student ページを*実行すると、新しい学生が一覧に表示されます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-175">Run the *Students.aspx* page and the new student appears in the list.</span></span>

<span data-ttu-id="cfe34-176">[![image04](the-entity-framework-and-aspnet-getting-started-part-7/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-176">[![image04](the-entity-framework-and-aspnet-getting-started-part-7/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image23.png)</span></span>

<span data-ttu-id="cfe34-177">名前を変更して update 関数が動作することを確認し、学生を削除して delete 関数が動作することを確認します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-177">Change the name to verify that the update function works, and then delete the student to verify that the delete function works.</span></span>

<span data-ttu-id="cfe34-178">[![image05](the-entity-framework-and-aspnet-getting-started-part-7/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="cfe34-178">[![image05](the-entity-framework-and-aspnet-getting-started-part-7/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image25.png)</span></span>

## <a name="using-select-stored-procedures"></a><span data-ttu-id="cfe34-179">Select ストアドプロシージャの使用</span><span class="sxs-lookup"><span data-stu-id="cfe34-179">Using Select Stored Procedures</span></span>

<span data-ttu-id="cfe34-180">Entity Framework では、`GetCourses`などのストアドプロシージャは自動的には実行されず、`EntityDataSource` コントロールでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="cfe34-180">The Entity Framework does not automatically run stored procedures such as `GetCourses`, and you cannot use them with the `EntityDataSource` control.</span></span> <span data-ttu-id="cfe34-181">これらを使用するには、コードから呼び出します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-181">To use them, you call them from code.</span></span>

<span data-ttu-id="cfe34-182">*InstructorsCourses.aspx.cs*ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-182">Open the *InstructorsCourses.aspx.cs* file.</span></span> <span data-ttu-id="cfe34-183">`PopulateDropDownLists` メソッドは、LINQ to entities クエリを使用してすべての course エンティティを取得します。これにより、リストをループ処理し、インストラクターが割り当てられているものと割り当て解除されているエンティティを特定できます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-183">The `PopulateDropDownLists` method uses a LINQ-to-Entities query to retrieve all course entities so that it can loop through the list and determine which ones an instructor is assigned to and which ones are unassigned:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample6.cs)]

<span data-ttu-id="cfe34-184">これを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-184">Replace this with the following code:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample7.cs)]

<span data-ttu-id="cfe34-185">このページでは、`GetCourses` ストアドプロシージャを使用して、すべてのコースの一覧を取得します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-185">The page now uses the `GetCourses` stored procedure to retrieve the list of all courses.</span></span> <span data-ttu-id="cfe34-186">ページを実行して、以前と同じように動作することを確認します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-186">Run the page to verify that it works as it did before.</span></span>

<span data-ttu-id="cfe34-187">(ストアドプロシージャによって取得されたエンティティのナビゲーションプロパティは、`ObjectContext` の既定の設定によっては、それらのエンティティに関連するデータが自動的に設定されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="cfe34-187">(Navigation properties of entities retrieved by a stored procedure might not be automatically populated with the data related to those entities, depending on `ObjectContext` default settings.</span></span> <span data-ttu-id="cfe34-188">詳細については、MSDN ライブラリの「[関連オブジェクトの読み込み](https://msdn.microsoft.com/library/bb896272.aspx)」を参照してください。)</span><span class="sxs-lookup"><span data-stu-id="cfe34-188">For more information, see [Loading Related Objects](https://msdn.microsoft.com/library/bb896272.aspx) in the MSDN Library.)</span></span>

<span data-ttu-id="cfe34-189">次のチュートリアルでは、動的データ機能を使用して、データの書式設定と検証規則を簡単にプログラミングおよびテストできるようにする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="cfe34-189">In the next tutorial, you'll learn how to use Dynamic Data functionality to make it easier to program and test data formatting and validation rules.</span></span> <span data-ttu-id="cfe34-190">データ書式指定文字列などの各 web ページの規則に対してを指定する代わりに、フィールドが必要であるかどうかを指定する代わりに、データモデルのメタデータにこのような規則を指定して、すべてのページに自動的に適用されます。</span><span class="sxs-lookup"><span data-stu-id="cfe34-190">Instead of specifying on each web page rules such as data format strings and whether or not a field is required, you can specify such rules in data model metadata and they're automatically applied on every page.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="cfe34-191">[前へ](the-entity-framework-and-aspnet-getting-started-part-6.md)
> [次へ](the-entity-framework-and-aspnet-getting-started-part-8.md)</span><span class="sxs-lookup"><span data-stu-id="cfe34-191">[Previous](the-entity-framework-and-aspnet-getting-started-part-6.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-8.md)</span></span>
