---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
title: Entity Framework 4.0 Database First および ASP.NET 4 Web フォームでのはじめに-パート 2 |Microsoft Docs
author: tdykstra
description: Contoso 大学のサンプル web アプリケーションは、Entity Framework を使用して ASP.NET Web フォームアプリケーションを作成する方法を示しています。 サンプルアプリケーションは...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: fb63a326-a4ae-4b0c-a4f5-412327197216
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
msc.type: authoredcontent
ms.openlocfilehash: bd6a2e29e6f0df04e39be29160e2e08cc99c4706
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78456448"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-2"></a><span data-ttu-id="a95d8-104">Entity Framework 4.0 Database First および ASP.NET 4 Web フォームでのはじめに-パート2</span><span class="sxs-lookup"><span data-stu-id="a95d8-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 2</span></span>

<span data-ttu-id="a95d8-105">[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="a95d8-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="a95d8-106">Contoso 大学のサンプル web アプリケーションは、Entity Framework 4.0 と Visual Studio 2010 を使用して ASP.NET Web フォームアプリケーションを作成する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="a95d8-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="a95d8-107">チュートリアルシリーズの詳細については、[シリーズの最初のチュートリアル](the-entity-framework-and-aspnet-getting-started-part-1.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a95d8-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="the-entitydatasource-control"></a><span data-ttu-id="a95d8-108">EntityDataSource コントロール</span><span class="sxs-lookup"><span data-stu-id="a95d8-108">The EntityDataSource Control</span></span>

<span data-ttu-id="a95d8-109">前のチュートリアルでは、web サイト、データベース、およびデータモデルを作成しました。</span><span class="sxs-lookup"><span data-stu-id="a95d8-109">In the previous tutorial you created a web site, a database, and a data model.</span></span> <span data-ttu-id="a95d8-110">このチュートリアルでは、ASP.NET が提供する `EntityDataSource` コントロールを使用して、Entity Framework データモデルを簡単に操作できるようにします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-110">In this tutorial you work with the `EntityDataSource` control that ASP.NET provides in order to make it easy to work with an Entity Framework data model.</span></span> <span data-ttu-id="a95d8-111">学生データを表示および編集するための `GridView` コントロール、新しい学生を追加するための `DetailsView` コントロール、部署を選択するための `DropDownList` コントロール (関連付けられたコースを表示するために後で使用する) を作成します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-111">You'll create a `GridView` control for displaying and editing student data, a `DetailsView` control for adding new students, and a `DropDownList` control for selecting a department (which you'll use later for displaying associated courses).</span></span>

<span data-ttu-id="a95d8-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span></span>

<span data-ttu-id="a95d8-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span></span>

<span data-ttu-id="a95d8-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span></span>

<span data-ttu-id="a95d8-115">このアプリケーションでは、データベースを更新するページに入力検証を追加することはできません。また、一部のエラー処理は、実稼働アプリケーションで必要になるほど堅牢ではありません。</span><span class="sxs-lookup"><span data-stu-id="a95d8-115">Note that in this application you won't be adding input validation to pages that update the database, and some of the error handling will not be as robust as would be required in a production application.</span></span> <span data-ttu-id="a95d8-116">このチュートリアルでは、Entity Framework に重点を置いているので、時間がかかりすぎないようにします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-116">That keeps the tutorial focused on the Entity Framework and keeps it from getting too long.</span></span> <span data-ttu-id="a95d8-117">これらの機能をアプリケーションに追加する方法の詳細については、「 [ASP.NET Web ページでのユーザー入力の検証](https://msdn.microsoft.com/library/7kh55542.aspx)」および「 [ASP.NET ページとアプリケーションでのエラー処理](https://msdn.microsoft.com/library/w16865z6.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a95d8-117">For details about how to add these features to your application, see [Validating User Input in ASP.NET Web Pages](https://msdn.microsoft.com/library/7kh55542.aspx) and [Error Handling in ASP.NET Pages and Applications](https://msdn.microsoft.com/library/w16865z6.aspx).</span></span>

## <a name="adding-and-configuring-the-entitydatasource-control"></a><span data-ttu-id="a95d8-118">EntityDataSource コントロールの追加と構成</span><span class="sxs-lookup"><span data-stu-id="a95d8-118">Adding and Configuring the EntityDataSource Control</span></span>

<span data-ttu-id="a95d8-119">まず、`People` エンティティセットから `Person` エンティティを読み取るように `EntityDataSource` コントロールを構成します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-119">You'll begin by configuring an `EntityDataSource` control to read `Person` entities from the `People` entity set.</span></span>

<span data-ttu-id="a95d8-120">Visual Studio が開いていること、およびパート1で作成したプロジェクトを操作していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-120">Make sure you have Visual Studio open and that you're working with the project you created in part 1.</span></span> <span data-ttu-id="a95d8-121">データモデルを作成した後、または前回変更を行った後にプロジェクトをビルドしていない場合は、ここでプロジェクトをビルドします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-121">If you haven't built the project since you created the data model or since the last change you made to it, build the project now.</span></span> <span data-ttu-id="a95d8-122">データモデルへの変更は、プロジェクトがビルドされるまで、デザイナーでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="a95d8-122">Changes to the data model are not made available to the designer until the project is built.</span></span>

<span data-ttu-id="a95d8-123">**マスターページテンプレートを使用して Web フォーム**を使用して新しい web ページを作成し、「 *Students*」という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-123">Create a new web page using the **Web Form using Master Page** template, and name it *Students.aspx*.</span></span>

<span data-ttu-id="a95d8-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span></span>

<span data-ttu-id="a95d8-125">マスターページとして「 *.master* 」と指定します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-125">Specify *Site.Master* as the master page.</span></span> <span data-ttu-id="a95d8-126">これらのチュートリアル用に作成したすべてのページで、このマスターページが使用されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-126">All of the pages you create for these tutorials will use this master page.</span></span>

<span data-ttu-id="a95d8-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span></span>

<span data-ttu-id="a95d8-128">**ソース**ビューで、次の例に示すように、`Content2`という名前の `Content` コントロールに `h2` 見出しを追加します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-128">In **Source** view, add an `h2` heading to the `Content` control named `Content2`, as shown in the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample1.aspx)]

<span data-ttu-id="a95d8-129">**ツールボックス**の **[データ]** タブから `EntityDataSource` コントロールをページにドラッグし、見出しの下にドロップして、ID を `StudentsEntityDataSource`に変更します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-129">From the **Data** tab of the **Toolbox**, drag an `EntityDataSource` control to the page, drop it below the heading, and change the ID to `StudentsEntityDataSource`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample2.aspx)]

<span data-ttu-id="a95d8-130">**デザイン**ビューに切り替え、データソースコントロールのスマートタグをクリックします。次に、 **[データソースの構成]** をクリックして、**データソースの構成**ウィザードを起動します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-130">Switch to **Design** view, click the data source control's smart tag, and then click **Configure Data Source** to launch the **Configure Data Source** wizard.</span></span>

<span data-ttu-id="a95d8-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span></span>

<span data-ttu-id="a95d8-132">ObjectContext の**構成**ウィザードの手順で、 **[名前付き接続]** の値として **[SchoolEntities]** を選択し、 **DefaultContainerName**値として **[SchoolEntities]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-132">In the **Configure ObjectContext** wizard step, select **SchoolEntities** as the value for **Named Connection**, and select **SchoolEntities** as the **DefaultContainerName** value.</span></span> <span data-ttu-id="a95d8-133">続けて、 **[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-133">Then click **Next**.</span></span>

<span data-ttu-id="a95d8-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span></span>

<span data-ttu-id="a95d8-135">注: この時点で次のダイアログボックスが表示される場合は、続行する前にプロジェクトをビルドする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-135">Note: If you get the following dialog box at this point, you have to build the project before proceeding.</span></span>

<span data-ttu-id="a95d8-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span></span>

<span data-ttu-id="a95d8-137">**[データ選択の構成]** ステップで、 **[EntitySetName]** の値として **[People]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-137">In the **Configure Data Selection** step, select **People** as the value for **EntitySetName**.</span></span> <span data-ttu-id="a95d8-138">**[選択]** で、Ll を **[選択する]** チェックボックスがオンになっていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-138">Under **Select**, make sure the **Select A** ll check box is selected.</span></span> <span data-ttu-id="a95d8-139">次に、更新と削除を有効にするオプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-139">Then select the options to enable update and delete.</span></span> <span data-ttu-id="a95d8-140">完了したら、 **[完了]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-140">When you're done, click **Finish**.</span></span>

<span data-ttu-id="a95d8-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span></span>

## <a name="configuring-database-rules-to-allow-deletion"></a><span data-ttu-id="a95d8-142">削除を許可するデータベースルールの構成</span><span class="sxs-lookup"><span data-stu-id="a95d8-142">Configuring Database Rules to Allow Deletion</span></span>

<span data-ttu-id="a95d8-143">ユーザーが `Person` テーブルから学生を削除できるページを作成します。このテーブルには、他のテーブル (`Course`、`StudentGrade`、および `OfficeAssignment`) との3つのリレーションシップがあります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-143">You'll be creating a page that lets users delete students from the `Person` table, which has three relationships with other tables (`Course`, `StudentGrade`, and `OfficeAssignment`).</span></span> <span data-ttu-id="a95d8-144">既定では、他のいずれかのテーブルに関連する行がある場合、データベースによって `Person` の行が削除されるのを防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-144">By default, the database will prevent you from deleting a row in `Person` if there are related rows in one of the other tables.</span></span> <span data-ttu-id="a95d8-145">最初に関連する行を手動で削除することも、`Person` 行を削除したときにデータベースを自動的に削除するように構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-145">You can manually delete the related rows first, or you can configure the database to delete them automatically when you delete a `Person` row.</span></span> <span data-ttu-id="a95d8-146">このチュートリアルの student レコードでは、関連データを自動的に削除するようにデータベースを構成します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-146">For student records in this tutorial, you'll configure the database to delete the related data automatically.</span></span> <span data-ttu-id="a95d8-147">学生は `StudentGrade` テーブルにのみ関連する行を持つことができるため、3つのリレーションシップのうち1つだけを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-147">Because students can have related rows only in the `StudentGrade` table, you need to configure only one of the three relationships.</span></span>

<span data-ttu-id="a95d8-148">このチュートリアルで作成したプロジェクトからダウンロードした*School .mdf*ファイルを使用している場合は、これらの構成の変更が既に行われているため、このセクションをスキップできます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-148">If you're using the *School.mdf* file that you downloaded from the project that goes with this tutorial, you can skip this section because these configuration changes have already been done.</span></span> <span data-ttu-id="a95d8-149">スクリプトを実行してデータベースを作成した場合は、次の手順を実行してデータベースを構成します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-149">If you created the database by running a script, configure the database by performing the following procedures.</span></span>

<span data-ttu-id="a95d8-150">**サーバーエクスプローラー**で、パート1で作成したデータベースダイアグラムを開きます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-150">In **Server Explorer**, open the database diagram that you created in part 1.</span></span> <span data-ttu-id="a95d8-151">`Person` と `StudentGrade` (テーブル間の線) の間のリレーションシップを右クリックし、 **[プロパティ]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-151">Right-click the relationship between `Person` and `StudentGrade` (the line between tables), and then select **Properties**.</span></span>

<span data-ttu-id="a95d8-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span></span>

<span data-ttu-id="a95d8-153">**[プロパティ]** ウィンドウで、 **[挿入と更新の指定]** を展開し、 **DeleteRule**プロパティを**Cascade**に設定します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-153">In the **Properties** window, expand **INSERT and UPDATE Specification** and set the **DeleteRule** property to **Cascade**.</span></span>

<span data-ttu-id="a95d8-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span></span>

<span data-ttu-id="a95d8-155">ダイアグラムを保存して閉じます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-155">Save and close the diagram.</span></span> <span data-ttu-id="a95d8-156">データベースを更新するかどうかを確認するメッセージが表示されたら、 **[はい]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-156">If you're asked whether you want to update the database, click **Yes**.</span></span>

<span data-ttu-id="a95d8-157">モデルで、メモリ内のエンティティがデータベースで実行されているものと同期されるようにするには、データモデルで対応するルールを設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-157">To make sure that the model keeps entities that are in memory in sync with what the database is doing, you must set corresponding rules in the data model.</span></span> <span data-ttu-id="a95d8-158">*SchoolModel*を開き、`Person` と `StudentGrade`の間の関連行を右クリックし、 **[プロパティ]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-158">Open *SchoolModel.edmx*, right-click the association line between `Person` and `StudentGrade`, and then select **Properties**.</span></span>

<span data-ttu-id="a95d8-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span></span>

<span data-ttu-id="a95d8-160">**[プロパティ]** ウィンドウで、 **End1 OnDelete**を**Cascade**に設定します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-160">In the **Properties** window, set **End1 OnDelete** to **Cascade**.</span></span>

<span data-ttu-id="a95d8-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span></span>

<span data-ttu-id="a95d8-162">*SchoolModel*ファイルを保存して閉じてから、プロジェクトをリビルドします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-162">Save and close the *SchoolModel.edmx* file, and then rebuild the project.</span></span>

<span data-ttu-id="a95d8-163">一般に、データベースが変更された場合、モデルを同期する方法にはいくつかの選択肢があります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-163">In general, when the database changes, you have several choices for how to sync up the model:</span></span>

- <span data-ttu-id="a95d8-164">特定の種類の変更 (テーブル、ビュー、またはストアドプロシージャの追加や更新など) については、デザイナー内で右クリックし、 **[データベースからモデルを更新]** を選択して、デザイナーが変更を自動的に行うようにします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-164">For certain kinds of changes (such as adding or refreshing tables, views, or stored procedures), right-click in the designer and select **Update Model from Database** to have the designer make the changes automatically.</span></span>
- <span data-ttu-id="a95d8-165">データモデルを再生成します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-165">Regenerate the data model.</span></span>
- <span data-ttu-id="a95d8-166">このような手動更新を行います。</span><span class="sxs-lookup"><span data-stu-id="a95d8-166">Make manual updates like this one.</span></span>

<span data-ttu-id="a95d8-167">この場合、モデルを再生成するか、リレーションシップの変更によって影響を受けるテーブルを更新することができますが、その場合は、フィールド名を再度変更する必要があります (`FirstName` から `FirstMidName`)。</span><span class="sxs-lookup"><span data-stu-id="a95d8-167">In this case, you could have regenerated the model or refreshed the tables affected by the relationship change, but then you'd have to make the field-name change again (from `FirstName` to `FirstMidName`).</span></span>

## <a name="using-a-gridview-control-to-read-and-update-entities"></a><span data-ttu-id="a95d8-168">GridView コントロールを使用したエンティティの読み取りと更新</span><span class="sxs-lookup"><span data-stu-id="a95d8-168">Using a GridView Control to Read and Update Entities</span></span>

<span data-ttu-id="a95d8-169">このセクションでは、`GridView` コントロールを使用して、学生の表示、更新、または削除を行います。</span><span class="sxs-lookup"><span data-stu-id="a95d8-169">In this section you'll use a `GridView` control to display, update, or delete students.</span></span>

<span data-ttu-id="a95d8-170">*Student .aspx*に移動し、 **[デザイン]** ビューに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-170">Open or switch to *Students.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="a95d8-171">**ツールボックス**の **[データ]** タブから、`GridView` コントロールを `EntityDataSource` コントロールの右側にドラッグし、`StudentsGridView`という名前を付けて、スマートタグをクリックし、データソースとして **[StudentsEntityDataSource]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-171">From the **Data** tab of the **Toolbox**, drag a `GridView` control to the right of the `EntityDataSource` control, name it `StudentsGridView`, click the smart tag, and then select **StudentsEntityDataSource** as the data source.</span></span>

<span data-ttu-id="a95d8-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span></span>

<span data-ttu-id="a95d8-173">**スキーマの更新** をクリックし (確認を求められたら **はい**をクリックします)、**ページング**を有効にする、**並べ替え**を有効にする、**編集**を有効にする、および **削除を**有効</span><span class="sxs-lookup"><span data-stu-id="a95d8-173">Click **Refresh Schema** (click **Yes** if you're prompted to confirm), then click **Enable Paging**, **Enable Sorting**, **Enable Editing**, and **Enable Deleting**.</span></span>

<span data-ttu-id="a95d8-174">**[列の編集]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-174">Click **Edit Columns**.</span></span>

<span data-ttu-id="a95d8-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span></span>

<span data-ttu-id="a95d8-176">**[選択されたフィールド]** ボックスで、 **PersonID**、 **LastName**、および**HireDate**を削除します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-176">In the **Selected fields** box, delete **PersonID**, **LastName**, and **HireDate**.</span></span> <span data-ttu-id="a95d8-177">通常、ユーザーにはレコードキーを表示せず、採用日は学生には関係しません。また、名前の両方の部分を1つのフィールドに入力するので、名前フィールドのいずれか1つだけが必要です。</span><span class="sxs-lookup"><span data-stu-id="a95d8-177">You typically don't display a record key to users, hire date is not relevant to students, and you'll put both parts of the name in one field, so you only need one of the name fields.)</span></span>

<span data-ttu-id="a95d8-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span></span>

<span data-ttu-id="a95d8-179">**[Firstmidname]** フィールドを選択し、 **[このフィールドを TemplateField に変換する]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-179">Select the **FirstMidName** field and then click **Convert this field into a TemplateField**.</span></span>

<span data-ttu-id="a95d8-180">**EnrollmentDate**に対しても同じ操作を行います。</span><span class="sxs-lookup"><span data-stu-id="a95d8-180">Do the same for **EnrollmentDate**.</span></span>

<span data-ttu-id="a95d8-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span></span>

<span data-ttu-id="a95d8-182">[ **OK]** をクリックし、[**ソース**ビュー] に切り替えます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-182">Click **OK** and then switch to **Source** view.</span></span> <span data-ttu-id="a95d8-183">残りの変更は、マークアップで直接行う方が簡単です。</span><span class="sxs-lookup"><span data-stu-id="a95d8-183">The remaining changes will be easier to do directly in markup.</span></span> <span data-ttu-id="a95d8-184">`GridView` コントロールマークアップは、次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-184">The `GridView` control markup now looks like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample3.aspx)]

<span data-ttu-id="a95d8-185">コマンドフィールドの後の最初の列は、現在名を表示しているテンプレートフィールドです。</span><span class="sxs-lookup"><span data-stu-id="a95d8-185">The first column after the command field is a template field that currently displays the first name.</span></span> <span data-ttu-id="a95d8-186">このテンプレートフィールドのマークアップを次の例のように変更します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-186">Change the markup for this template field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample4.aspx)]

<span data-ttu-id="a95d8-187">表示モードでは、2つの `Label` コントロールに姓と名が表示されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-187">In display mode, two `Label` controls display the first and last name.</span></span> <span data-ttu-id="a95d8-188">編集モードでは、姓と名を変更できるように、2つのテキストボックスが用意されています。</span><span class="sxs-lookup"><span data-stu-id="a95d8-188">In edit mode, two text boxes are provided so you can change the first and last name.</span></span> <span data-ttu-id="a95d8-189">表示モードの `Label` コントロールと同様に、データベースに直接接続するデータソースコントロールを ASP.NET する場合と同じように `Bind` と `Eval` 式を使用します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-189">As with the `Label` controls in display mode, you use `Bind` and `Eval` expressions exactly as you would with ASP.NET data source controls that connect directly to databases.</span></span> <span data-ttu-id="a95d8-190">唯一の違いは、データベース列ではなくエンティティプロパティを指定することです。</span><span class="sxs-lookup"><span data-stu-id="a95d8-190">The only difference is that you're specifying entity properties instead of database columns.</span></span>

<span data-ttu-id="a95d8-191">最後の列は、登録日を表示するテンプレートフィールドです。</span><span class="sxs-lookup"><span data-stu-id="a95d8-191">The last column is a template field that displays the enrollment date.</span></span> <span data-ttu-id="a95d8-192">このフィールドのマークアップを次の例のように変更します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-192">Change the markup for this field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample5.aspx)]

<span data-ttu-id="a95d8-193">表示モードと編集モードの両方で、書式文字列 "{0, d}" を指定すると、日付が "short date" 形式で表示されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-193">In both display and edit mode, the format string "{0,d}" causes the date to be displayed in the "short date" format.</span></span> <span data-ttu-id="a95d8-194">(このコンピューターは、このチュートリアルで示されている画面イメージとは異なる形式で表示されるように構成されている場合があります)。</span><span class="sxs-lookup"><span data-stu-id="a95d8-194">(Your computer might be configured to display this format differently from the screen images shown in this tutorial.)</span></span>

<span data-ttu-id="a95d8-195">これらの各テンプレートフィールドでは、デザイナーでは既定で `Bind` 式が使用されていましたが、これは `ItemTemplate` 要素の `Eval` 式に変更されています。</span><span class="sxs-lookup"><span data-stu-id="a95d8-195">Notice that in each of these template fields, the designer used a `Bind` expression by default, but you've changed that to an `Eval` expression in the `ItemTemplate` elements.</span></span> <span data-ttu-id="a95d8-196">`Bind` 式を使用すると、コード内のデータにアクセスする必要がある場合に、`GridView` コントロールのプロパティでデータを使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-196">The `Bind` expression makes the data available in `GridView` control properties in case you need to access the data in code.</span></span> <span data-ttu-id="a95d8-197">このページでは、コード内でこのデータにアクセスする必要はないため、`Eval`を使用できますが、これはより効率的です。</span><span class="sxs-lookup"><span data-stu-id="a95d8-197">In this page you don't need to access this data in code, so you can use `Eval`, which is more efficient.</span></span> <span data-ttu-id="a95d8-198">詳細については、「データ[コントロールからのデータの取得](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a95d8-198">For more information, see [Getting your data out of the data controls](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx).</span></span>

## <a name="revising-entitydatasource-control-markup-to-improve-performance"></a><span data-ttu-id="a95d8-199">パフォーマンスを向上させるために EntityDataSource コントロールのマークアップを改訂する</span><span class="sxs-lookup"><span data-stu-id="a95d8-199">Revising EntityDataSource Control Markup to Improve Performance</span></span>

<span data-ttu-id="a95d8-200">`EntityDataSource` コントロールのマークアップで、`ConnectionString` 属性と `DefaultContainerName` 属性を削除し、`ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` 属性に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-200">In the markup for the `EntityDataSource` control, remove the `ConnectionString` and `DefaultContainerName` attributes and replace them with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="a95d8-201">これは、オブジェクトコンテキストクラスにハードコーディングされている接続とは異なる接続を使用する必要がある場合を除き、`EntityDataSource` コントロールを作成するたびに行う必要がある変更です。</span><span class="sxs-lookup"><span data-stu-id="a95d8-201">This is a change you should make every time you create an `EntityDataSource` control, unless you need to use a connection that is different from the one that's hard-coded in the object context class.</span></span> <span data-ttu-id="a95d8-202">`ContextTypeName` 属性を使用すると、次のような利点があります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-202">Using the `ContextTypeName` attribute provides the following benefits:</span></span>

- <span data-ttu-id="a95d8-203">パフォーマンスが向上します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-203">Better performance.</span></span> <span data-ttu-id="a95d8-204">`EntityDataSource` コントロールが `ConnectionString` 属性と `DefaultContainerName` 属性を使用してデータモデルを初期化すると、すべての要求にメタデータを読み込むための追加作業が実行されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-204">When the `EntityDataSource` control initializes the data model using the `ConnectionString` and `DefaultContainerName` attributes, it performs additional work to load metadata on every request.</span></span> <span data-ttu-id="a95d8-205">これは、`ContextTypeName` 属性を指定する場合は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="a95d8-205">This isn't necessary if you specify the `ContextTypeName` attribute.</span></span>
- <span data-ttu-id="a95d8-206">遅延読み込みは、Entity Framework 4.0 の生成されたオブジェクトコンテキストクラス (このチュートリアルでは `SchoolEntities` など) で既定で有効になっています。</span><span class="sxs-lookup"><span data-stu-id="a95d8-206">Lazy loading is turned on by default in generated object context classes (such as `SchoolEntities` in this tutorial) in Entity Framework 4.0.</span></span> <span data-ttu-id="a95d8-207">これは、必要に応じて、ナビゲーションプロパティが関連データと共に自動的に読み込まれることを意味します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-207">This means that navigation properties are loaded with related data automatically right when you need it.</span></span> <span data-ttu-id="a95d8-208">遅延読み込みの詳細については、このチュートリアルの後半で説明します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-208">Lazy loading is explained in more detail later in this tutorial.</span></span>
- <span data-ttu-id="a95d8-209">オブジェクトコンテキストクラス (この場合は `SchoolEntities` クラス) に適用したカスタマイズは、`EntityDataSource` コントロールを使用するコントロールで使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-209">Any customizations that you've applied to the object context class (in this case, the `SchoolEntities` class) will be available to controls that use the `EntityDataSource` control.</span></span> <span data-ttu-id="a95d8-210">オブジェクトコンテキストクラスのカスタマイズは、このチュートリアルシリーズでは説明されていない高度なトピックです。</span><span class="sxs-lookup"><span data-stu-id="a95d8-210">Customizing the object context class is an advanced topic that is not covered in this tutorial series.</span></span> <span data-ttu-id="a95d8-211">詳細については、「 [Entity Framework 生成された型の拡張](https://msdn.microsoft.com/library/dd456844.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a95d8-211">For more information, see [Extending Entity Framework Generated Types](https://msdn.microsoft.com/library/dd456844.aspx).</span></span>

<span data-ttu-id="a95d8-212">マークアップは次の例のようになります (プロパティの順序が異なる場合があります)。</span><span class="sxs-lookup"><span data-stu-id="a95d8-212">The markup will now resemble the following example (the order of the properties might be different):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample6.aspx)]

<span data-ttu-id="a95d8-213">`EnableFlattening` 属性は、外部キー列がエンティティプロパティとして公開されていないため、以前のバージョンの Entity Framework で必要な機能を参照します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-213">The `EnableFlattening` attribute refers to a feature that was needed in earlier versions of the Entity Framework because foreign key columns were not exposed as entity properties.</span></span> <span data-ttu-id="a95d8-214">現在のバージョンでは、*外部キーの関連付け*を使用できるようになっています。つまり、外部キーのプロパティは、すべての多対多のアソシエーションに対して公開されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-214">The current version makes it possible to use *foreign key associations*, which means foreign key properties are exposed for all but many-to-many associations.</span></span> <span data-ttu-id="a95d8-215">エンティティに外部キープロパティがあり、[複合型](https://msdn.microsoft.com/library/bb738472.aspx)がない場合は、この属性を `False`に設定したままにすることができます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-215">If your entities have foreign key properties and no [complex types](https://msdn.microsoft.com/library/bb738472.aspx), you can leave this attribute set to `False`.</span></span> <span data-ttu-id="a95d8-216">既定値は `True`ので、マークアップから属性を削除しないでください。</span><span class="sxs-lookup"><span data-stu-id="a95d8-216">Don't remove the attribute from the markup, because the default value is `True`.</span></span> <span data-ttu-id="a95d8-217">詳細については、「オブジェクトのフラット化」 [(EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a95d8-217">For more information, see [Flattening Objects (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx).</span></span>

<span data-ttu-id="a95d8-218">ページを実行すると、学生と従業員の一覧が表示されます (次のチュートリアルでは、生徒にのみフィルターを適用します)。</span><span class="sxs-lookup"><span data-stu-id="a95d8-218">Run the page and you see a list of students and employees (you'll filter for just students in the next tutorial).</span></span> <span data-ttu-id="a95d8-219">姓と名が一緒に表示されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-219">The first name and last name are displayed together.</span></span>

<span data-ttu-id="a95d8-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span></span>

<span data-ttu-id="a95d8-221">表示を並べ替えるには、列名をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-221">To sort the display, click a column name.</span></span>

<span data-ttu-id="a95d8-222">任意の行の **[編集]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-222">Click **Edit** in any row.</span></span> <span data-ttu-id="a95d8-223">テキストボックスが表示され、姓と名を変更できます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-223">Text boxes are displayed where you can change the first and last name.</span></span>

<span data-ttu-id="a95d8-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span></span>

<span data-ttu-id="a95d8-225">**[削除]** ボタンも機能します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-225">The **Delete** button also works.</span></span> <span data-ttu-id="a95d8-226">登録日がある行の [削除] をクリックすると、行が表示されなくなります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-226">Click delete for a row that has an enrollment date and the row disappears.</span></span> <span data-ttu-id="a95d8-227">(登録日のない行は講師を表し、参照整合性エラーが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-227">(Rows without an enrollment date represent instructors and you may get a referential integrity error.</span></span> <span data-ttu-id="a95d8-228">次のチュートリアルでは、このリストにフィルターを適用して、学生だけを含めます)。</span><span class="sxs-lookup"><span data-stu-id="a95d8-228">In the next tutorial you'll filter this list to include just students.)</span></span>

## <a name="displaying-data-from-a-navigation-property"></a><span data-ttu-id="a95d8-229">ナビゲーションプロパティからのデータの表示</span><span class="sxs-lookup"><span data-stu-id="a95d8-229">Displaying Data from a Navigation Property</span></span>

<span data-ttu-id="a95d8-230">ここで、各学生が登録されているコースの数を知りたいとします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-230">Now suppose you want to know how many courses each student is enrolled in.</span></span> <span data-ttu-id="a95d8-231">Entity Framework は、`Person` エンティティの `StudentGrades` ナビゲーションプロパティにその情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-231">The Entity Framework provides that information in the `StudentGrades` navigation property of the `Person` entity.</span></span> <span data-ttu-id="a95d8-232">データベースの設計では、学年が割り当てられていなくても学生を講座に登録することはできないため、このチュートリアルでは、コースに関連付けられている `StudentGrade` テーブル行内の行が、コースに登録されているものと同じであることを想定できます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-232">Because the database design does not allow a student to be enrolled in a course without having a grade assigned, for this tutorial you can assume that having a row in the `StudentGrade` table row that is associated with a course is the same as being enrolled in the course.</span></span> <span data-ttu-id="a95d8-233">(`Courses` ナビゲーションプロパティは、インストラクターだけを対象としています)。</span><span class="sxs-lookup"><span data-stu-id="a95d8-233">(The `Courses` navigation property is only for instructors.)</span></span>

<span data-ttu-id="a95d8-234">`EntityDataSource` コントロールの `ContextTypeName` 属性を使用すると、そのプロパティにアクセスしたときに、ナビゲーションプロパティの情報が Entity Framework によって自動的に取得されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-234">When you use the `ContextTypeName` attribute of the `EntityDataSource` control, the Entity Framework automatically retrieves information for a navigation property when you access that property.</span></span> <span data-ttu-id="a95d8-235">これは*遅延読み込み*と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-235">This is called *lazy loading*.</span></span> <span data-ttu-id="a95d8-236">ただし、追加情報が必要になるたびにデータベースが個別に呼び出されるため、これは非効率的になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-236">However, this can be inefficient, because it results in a separate call to the database each time additional information is needed.</span></span> <span data-ttu-id="a95d8-237">`EntityDataSource` コントロールによって返されるすべてのエンティティのナビゲーションプロパティからのデータが必要な場合は、データベースへの1回の呼び出しで、関連するデータをエンティティ自体と共に取得する方が効率的です。</span><span class="sxs-lookup"><span data-stu-id="a95d8-237">If you need data from the navigation property for every entity returned by the `EntityDataSource` control, it's more efficient to retrieve the related data along with the entity itself in a single call to the database.</span></span> <span data-ttu-id="a95d8-238">これは、*一括読み込み*と呼ばれ、`EntityDataSource` コントロールの `Include` プロパティを設定することによって、ナビゲーションプロパティの一括読み込みを指定します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-238">This is called *eager loading*, and you specify eager loading for a navigation property by setting the `Include` property of the `EntityDataSource` control.</span></span>

<span data-ttu-id="a95d8-239">*Students*では、各学生のコース数を表示したいので、一括読み込みが最適な選択肢です。</span><span class="sxs-lookup"><span data-stu-id="a95d8-239">In *Students.aspx*, you want to show the number of courses for every student, so eager loading is the best choice.</span></span> <span data-ttu-id="a95d8-240">すべての学生を表示していても、いくつかのコース (マークアップに加えていくつかのコードを記述する必要があります) のコースのみを表示している場合は、遅延読み込みの方が適している可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-240">If you were displaying all students but showing the number of courses only for a few of them (which would require writing some code in addition to the markup), lazy loading might be a better choice.</span></span>

<span data-ttu-id="a95d8-241">*Student .aspx*に切り替えて、**デザイン**ビューに切り替え、[`StudentsEntityDataSource`] を選択します。次に、 **[プロパティ]** ウィンドウで、 **Include**プロパティを**StudentGrades**に設定します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-241">Open or switch to *Students.aspx*, switch to **Design** view, select `StudentsEntityDataSource`, and in the **Properties** window set the **Include** property to **StudentGrades**.</span></span> <span data-ttu-id="a95d8-242">(複数のナビゲーションプロパティを取得する場合は、名前をコンマで区切って指定できます (たとえば、 **StudentGrades、** course)。</span><span class="sxs-lookup"><span data-stu-id="a95d8-242">(If you wanted to get multiple navigation properties, you could specify their names separated by commas — for example, **StudentGrades, Courses**.)</span></span>

<span data-ttu-id="a95d8-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span></span>

<span data-ttu-id="a95d8-244">**ソース**ビューに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-244">Switch to **Source** view.</span></span> <span data-ttu-id="a95d8-245">`StudentsGridView` コントロールで、最後の `asp:TemplateField` 要素の後に、次の新しいテンプレートフィールドを追加します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-245">In the `StudentsGridView` control, after the last `asp:TemplateField` element, add the following new template field:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample7.aspx)]

<span data-ttu-id="a95d8-246">`Eval` 式では、ナビゲーションプロパティ `StudentGrades`を参照できます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-246">In the `Eval` expression, you can reference the navigation property `StudentGrades`.</span></span> <span data-ttu-id="a95d8-247">このプロパティにはコレクションが含まれているため、学生が登録されているコースの数を表示するために使用できる `Count` のプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-247">Because this property contains a collection, it has a `Count` property that you can use to display the number of courses in which the student is enrolled.</span></span> <span data-ttu-id="a95d8-248">後のチュートリアルでは、コレクションではなく単一のエンティティを含むナビゲーションプロパティからデータを表示する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-248">In a later tutorial you'll see how to display data from navigation properties that contain single entities instead of collections.</span></span> <span data-ttu-id="a95d8-249">(`BoundField` 要素を使用して、ナビゲーションプロパティのデータを表示することはできません)。</span><span class="sxs-lookup"><span data-stu-id="a95d8-249">(Note that you cannot use `BoundField` elements to display data from navigation properties.)</span></span>

<span data-ttu-id="a95d8-250">ページを実行すると、各学生が登録したコースの数が表示されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-250">Run the page and you now see how many courses each student is enrolled in.</span></span>

<span data-ttu-id="a95d8-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span></span>

## <a name="using-a-detailsview-control-to-insert-entities"></a><span data-ttu-id="a95d8-252">DetailsView コントロールを使用してエンティティを挿入する</span><span class="sxs-lookup"><span data-stu-id="a95d8-252">Using a DetailsView Control to Insert Entities</span></span>

<span data-ttu-id="a95d8-253">次の手順では、新しい学生を追加できる `DetailsView` コントロールを持つページを作成します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-253">The next step is to create a page that has a `DetailsView` control that will let you add new students.</span></span> <span data-ttu-id="a95d8-254">ブラウザーを閉じてから、新しい web ページを作成し*ます。*</span><span class="sxs-lookup"><span data-stu-id="a95d8-254">Close the browser and then create a new web page using the *Site.Master* master page.</span></span> <span data-ttu-id="a95d8-255">ページに*StudentsAdd*という名前を指定し、**ソース**ビューに切り替えます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-255">Name the page *StudentsAdd.aspx*, and then switch to **Source** view.</span></span>

<span data-ttu-id="a95d8-256">次のマークアップを追加して、`Content2`という名前の `Content` コントロールの既存のマークアップを置き換えます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-256">Add the following markup to replace the existing markup for the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample8.aspx)]

<span data-ttu-id="a95d8-257">このマークアップは、挿入を可能にする以外は、 *student*で作成したコントロールに似た `EntityDataSource` コントロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-257">This markup creates an `EntityDataSource` control that is similar to the one you created in *Students.aspx*, except it enables insertion.</span></span> <span data-ttu-id="a95d8-258">`GridView` コントロールと同様に、`DetailsView` コントロールのバインドされたフィールドは、エンティティのプロパティを参照することを除いて、データベースに直接接続するデータコントロールの場合とまったく同じようにコード化されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-258">As with the `GridView` control, the bound fields of the `DetailsView` control are coded exactly as they would be for a data control that connects directly to a database, except that they reference entity properties.</span></span> <span data-ttu-id="a95d8-259">この場合、`DetailsView` コントロールは行の挿入にのみ使用されるため、既定のモードを `Insert`に設定します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-259">In this case, the `DetailsView` control is used only for inserting rows, so you have set the default mode to `Insert`.</span></span>

<span data-ttu-id="a95d8-260">ページを実行し、新しい学生を追加します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-260">Run the page and add a new student.</span></span>

<span data-ttu-id="a95d8-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span></span>

<span data-ttu-id="a95d8-262">新しい学生を挿入した後は何も起こりませんが、ここで student*を実行すると、新しい*学生情報が表示されます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-262">Nothing will happen after you insert a new student, but if you now run *Students.aspx*, you'll see the new student information.</span></span>

## <a name="displaying-data-in-a-drop-down-list"></a><span data-ttu-id="a95d8-263">ドロップダウンリストでのデータの表示</span><span class="sxs-lookup"><span data-stu-id="a95d8-263">Displaying Data in a Drop-Down List</span></span>

<span data-ttu-id="a95d8-264">次の手順では、`EntityDataSource` コントロールを使用して、`DropDownList` コントロールをエンティティセットにバインドします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-264">In the following steps you'll databind a `DropDownList` control to an entity set using an `EntityDataSource` control.</span></span> <span data-ttu-id="a95d8-265">チュートリアルのこの部分では、この一覧についてはあまりいきません。</span><span class="sxs-lookup"><span data-stu-id="a95d8-265">In this part of the tutorial, you won't do much with this list.</span></span> <span data-ttu-id="a95d8-266">ただし、その後の部分では、一覧を使用して、ユーザーが部署を選択して部門に関連付けられているコースを表示できるようにします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-266">In subsequent parts, though, you'll use the list to let users select a department to display courses associated with the department.</span></span>

<span data-ttu-id="a95d8-267">「Course」という名前の新しい web ページを作成*します。*</span><span class="sxs-lookup"><span data-stu-id="a95d8-267">Create a new web page named *Courses.aspx*.</span></span> <span data-ttu-id="a95d8-268">**ソース**ビューで、`Content2`という名前の `Content` コントロールに見出しを追加します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-268">In **Source** view, add a heading to the `Content` control that's named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample9.aspx)]

<span data-ttu-id="a95d8-269">**デザイン**ビューで、前と同じように `EntityDataSource` コントロールをページに追加します。ただし、この時刻の名前は `DepartmentsEntityDataSource`ます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-269">In **Design** view, add an `EntityDataSource` control to the page as you did before, except this time name it `DepartmentsEntityDataSource`.</span></span> <span data-ttu-id="a95d8-270">**EntitySetName**値と**して [department] を選択**し、 **[DepartmentID]** および **[Name]** プロパティのみを選択します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-270">Select **Departments** as the **EntitySetName** value, and select only the **DepartmentID** and **Name** properties.</span></span>

<span data-ttu-id="a95d8-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span></span>

<span data-ttu-id="a95d8-272">**ツールボックス**の **[標準]** タブで `DropDownList` コントロールをページにドラッグし、`DepartmentsDropDownList`という名前を付けて、スマートタグをクリックし、 **[データソースの選択]** を選択してデータソース**構成ウィザード**を開始します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-272">From the **Standard** tab of the **Toolbox**, drag a `DropDownList` control to the page, name it `DepartmentsDropDownList`, click the smart tag, and select **Choose Data Source** to start the **DataSource Configuration Wizard**.</span></span>

<span data-ttu-id="a95d8-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span></span>

<span data-ttu-id="a95d8-274">**データソースの選択** ステップで、データソースとして **DepartmentsEntityDataSource** を選択し、**スキーマの更新** をクリックします。次に、表示するデータフィールドとして **名前** を選択し、値のデータ フィールドに**DepartmentID**を選択します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-274">In the **Choose a Data Source** step, select **DepartmentsEntityDataSource** as the data source, click **Refresh Schema**, and then select **Name** as the data field to display and **DepartmentID** as the value data field.</span></span> <span data-ttu-id="a95d8-275">**[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="a95d8-275">Click **OK**.</span></span>

<span data-ttu-id="a95d8-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span></span>

<span data-ttu-id="a95d8-277">Entity Framework を使用してコントロールをデータバインドするために使用するメソッドは、エンティティとエンティティのプロパティを指定する点を除いて、他の ASP.NET データソースコントロールと同じです。</span><span class="sxs-lookup"><span data-stu-id="a95d8-277">The method you use to databind the control using the Entity Framework is the same as with other ASP.NET data source controls except you're specifying entities and entity properties.</span></span>

<span data-ttu-id="a95d8-278">**ソース**ビューに切り替えて、`DropDownList` コントロールの直前に "Select a department:" を追加します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-278">Switch to **Source** view and add "Select a department:" immediately before the `DropDownList` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample10.aspx)]

<span data-ttu-id="a95d8-279">この時点で、`ConnectionString` 属性と `DefaultContainerName` 属性を `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` 属性で置き換えることによって、この時点で `EntityDataSource` コントロールのマークアップを変更します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-279">As a reminder, change the markup for the `EntityDataSource` control at this point by replacing the `ConnectionString` and `DefaultContainerName` attributes with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="a95d8-280">`EntityDataSource` コントロールのマークアップを変更する前に、データソースコントロールにリンクされているデータバインドコントロールを作成しておくと、多くの場合は待機することをお勧めします。これは、変更を行った後に、デザイナーがデータバインドコントロールの **[スキーマの更新]** オプションを提供しないためです。</span><span class="sxs-lookup"><span data-stu-id="a95d8-280">It's often best to wait until after you've created the data-bound control that is linked to the data source control before you change the `EntityDataSource` control markup, because after you make the change, the designer will not provide you with a **Refresh Schema** option in the data-bound control.</span></span>

<span data-ttu-id="a95d8-281">ページを実行すると、ドロップダウンリストから部門を選択できます。</span><span class="sxs-lookup"><span data-stu-id="a95d8-281">Run the page and you can select a department from the drop-down list.</span></span>

<span data-ttu-id="a95d8-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span><span class="sxs-lookup"><span data-stu-id="a95d8-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span></span>

<span data-ttu-id="a95d8-283">これで、`EntityDataSource` コントロールの使用方法の概要が完成します。</span><span class="sxs-lookup"><span data-stu-id="a95d8-283">This completes the introduction to using the `EntityDataSource` control.</span></span> <span data-ttu-id="a95d8-284">このコントロールの操作は、通常、他の ASP.NET データソースコントロールとは異なりますが、テーブルや列ではなくエンティティとプロパティを参照する点が異なります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-284">Working with this control is generally no different from working with other ASP.NET data source controls, except that you reference entities and properties instead of tables and columns.</span></span> <span data-ttu-id="a95d8-285">唯一の例外は、ナビゲーションプロパティにアクセスする場合です。</span><span class="sxs-lookup"><span data-stu-id="a95d8-285">The only exception is when you want to access navigation properties.</span></span> <span data-ttu-id="a95d8-286">次のチュートリアルでは、データのフィルター処理、グループ化、および並べ替えを行うときに、`EntityDataSource` コントロールで使用する構文も、他のデータソースコントロールとは異なる場合があることがわかります。</span><span class="sxs-lookup"><span data-stu-id="a95d8-286">In the next tutorial you'll see that the syntax you use with `EntityDataSource` control might also differ from other data source controls when you filter, group, and order data.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a95d8-287">[前へ](the-entity-framework-and-aspnet-getting-started-part-1.md)
> [次へ](the-entity-framework-and-aspnet-getting-started-part-3.md)</span><span class="sxs-lookup"><span data-stu-id="a95d8-287">[Previous](the-entity-framework-and-aspnet-getting-started-part-1.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-3.md)</span></span>
