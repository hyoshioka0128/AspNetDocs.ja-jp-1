---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
title: 運用データベース (c#) を使用する実稼働 Web アプリケーションの構成 |Microsoft Docs
author: rick-anderson
description: 前のチュートリアルで既に説明した、これは開発および運用環境間で異なる構成情報珍しくありません。 これは、es.
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 0177dabd-d888-449f-91b2-24190cf5e842
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
msc.type: authoredcontent
ms.openlocfilehash: 1e93a5314129b2a05ede603ae9c01cd57b574f88
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/06/2019
ms.locfileid: "65127039"
---
# <a name="configuring-the-production-web-application-to-use-the-production-database-c"></a><span data-ttu-id="64b34-104">実稼働データベースを使用するように Web アプリケーションを構成する (C#)</span><span class="sxs-lookup"><span data-stu-id="64b34-104">Configuring the Production Web Application to Use the Production Database (C#)</span></span>

<span data-ttu-id="64b34-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="64b34-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="64b34-106">[コードのダウンロード](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_CS.zip)または[PDF のダウンロード](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="64b34-106">[Download Code](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_CS.zip) or [Download PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_cs.pdf)</span></span>

> <span data-ttu-id="64b34-107">前のチュートリアルで既に説明した、これは開発および運用環境間で異なる構成情報珍しくありません。</span><span class="sxs-lookup"><span data-stu-id="64b34-107">As discussed in earlier tutorials, it is not uncommon for configuration information to differ between the development and production environments.</span></span> <span data-ttu-id="64b34-108">これは、データベースの接続文字列は、開発および運用環境の間で異なるとデータ ドリブン web アプリケーション、特に当てはまります。</span><span class="sxs-lookup"><span data-stu-id="64b34-108">This is especially true for data-driven web applications, as the database connection strings differ between the development and production environments.</span></span> <span data-ttu-id="64b34-109">このチュートリアルより詳細に適切な接続文字列を含める、運用環境を構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="64b34-109">This tutorial explores ways to configure the production environment to include the appropriate connection string in more detail.</span></span>

## <a name="introduction"></a><span data-ttu-id="64b34-110">はじめに</span><span class="sxs-lookup"><span data-stu-id="64b34-110">Introduction</span></span>

<span data-ttu-id="64b34-111">データ ドリブン web アプリケーションは通常、運用環境で場合より開発で別のデータベースを使用します。</span><span class="sxs-lookup"><span data-stu-id="64b34-111">Data-driven web applications usually use a different database when in development than when in production.</span></span> <span data-ttu-id="64b34-112">Web ホスト プロバイダーによってホストされ、ローカルで開発をアプリケーションでは、開発用データベース通常存在、開発者のコンピューター上、実稼働データベースが、web ホスティング企業の施設でのデータベース サーバーでホストされているときにします。</span><span class="sxs-lookup"><span data-stu-id="64b34-112">For applications hosted by a web host provider and developed locally, the development database typically resides on the developer s computer while the production database is hosted on a database server at the web hosting company s facility.</span></span> <span data-ttu-id="64b34-113">データ ドリブン web アプリケーションを展開するには、開発用データベースを実稼働データベース サーバーにコピーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="64b34-113">Deploying a data-driven web application entails copying the development database to the production database server.</span></span> <span data-ttu-id="64b34-114">前のチュートリアルでは、この手順を実行する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="64b34-114">In the previous tutorial we looked at ways to accomplish this step.</span></span>

<span data-ttu-id="64b34-115">Web アプリケーションは、情報を使用して、*接続文字列*データベースとの接続を確立します。</span><span class="sxs-lookup"><span data-stu-id="64b34-115">The web application uses the information in a *connection string* to establish a connection with the database.</span></span> <span data-ttu-id="64b34-116">通常格納されている接続文字列`Web.config`、データベース サーバー名、データベース、セキュリティ コンテキスト、およびその他の情報の名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="64b34-116">The connection string, which is typically stored in `Web.config`, specifies the database server name, the name of the database, the security context, and other information.</span></span> <span data-ttu-id="64b34-117">Web アプリケーションによって使用されるデータベースは、開発または実稼働環境で web アプリケーションが実行されているかどうかに依存しているため、接続文字列が 2 つの環境間とは異なる必要があります。</span><span class="sxs-lookup"><span data-stu-id="64b34-117">Because the database used by the web application depends on whether the web application is running in the development or production environments, the connection strings must differ between the two environments.</span></span>

<span data-ttu-id="64b34-118">開発および運用環境間で異なる構成については珍しくありません。</span><span class="sxs-lookup"><span data-stu-id="64b34-118">It is not uncommon for configuration information to differ between the development and production environments.</span></span> <span data-ttu-id="64b34-119">*一般的な構成の相違点の間で開発および運用*チュートリアルには、上の簡単な説明だけでなく、これら 2 つの環境間で個別の構成情報を維持するための手法がについて説明しましたデータベース接続文字列。</span><span class="sxs-lookup"><span data-stu-id="64b34-119">The *Common Configuration Differences Between Development and Production* tutorial discussed techniques for maintaining separate configuration information between these two environments, as well as a brief discussion on database connection strings.</span></span> <span data-ttu-id="64b34-120">このチュートリアルより詳細に適切な接続文字列を含める、運用環境を構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="64b34-120">This tutorial explores ways to configure the production environment to include the appropriate connection string in more detail.</span></span>

## <a name="examining-the-connection-string-information"></a><span data-ttu-id="64b34-121">接続文字列情報を調べる</span><span class="sxs-lookup"><span data-stu-id="64b34-121">Examining the Connection String Information</span></span>

<span data-ttu-id="64b34-122">書籍レビューの web アプリケーションで使用される接続文字列が、アプリケーションの構成ファイルに格納されている`Web.config`します。</span><span class="sxs-lookup"><span data-stu-id="64b34-122">The connection string used by the Book Reviews web application is stored in the application s configuration file, `Web.config`.</span></span> <span data-ttu-id="64b34-123">`Web.config` といううまい名前の接続文字列を格納するための特別なセクションが含まれる[ &lt;connectionStrings&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="64b34-123">`Web.config` includes a special section for storing connection strings, aptly named [&lt;connectionStrings&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx).</span></span> <span data-ttu-id="64b34-124">`Web.config`ファイルの書籍レビューの web サイトがある 1 つの接続文字列をという名前のこのセクションで定義されている`ReviewsConnectionString`:</span><span class="sxs-lookup"><span data-stu-id="64b34-124">The `Web.config` file for the Book Reviews website has one connection string defined in this section named `ReviewsConnectionString`:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample1.xml)]

<span data-ttu-id="64b34-125">接続文字列 – データ ソース = \SQLEXPRESS;。AttachDbFilename = |DataDirectory|\Reviews.mdf;Integrated Security = True;ユーザー インスタンスは True を = - は、セミコロンと各オプションで区切られたオプションと値のペアと等号で区切られた値を持つさまざまなオプションと値で構成されます。</span><span class="sxs-lookup"><span data-stu-id="64b34-125">The connection string - Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\Reviews.mdf;Integrated Security=True;User Instance=True - is composed of a number of options and values, with option/value pairs delimited by a semicolon and each option and value delimited by an equals sign.</span></span> <span data-ttu-id="64b34-126">この接続文字列で使用される 4 つのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="64b34-126">The four options used in this connection string are:</span></span>

- <span data-ttu-id="64b34-127">`Data Source` -(ある場合)、データベース サーバーとデータベース サーバーのインスタンス名の場所を指定します。</span><span class="sxs-lookup"><span data-stu-id="64b34-127">`Data Source` - specifies the location of the database server and the database server instance name (if any).</span></span> <span data-ttu-id="64b34-128">値、`.\SQLEXPRESS`例を示しますが、データベース サーバーとインスタンス名。</span><span class="sxs-lookup"><span data-stu-id="64b34-128">The value, `.\SQLEXPRESS`, is an example where there is a database server and an instance name.</span></span> <span data-ttu-id="64b34-129">期間は、データベース サーバーは、アプリケーションと同じコンピューターを指定しますインスタンス名が`SQLEXPRESS`します。</span><span class="sxs-lookup"><span data-stu-id="64b34-129">The period specifies that the database server is on the same computer as the application; the instance name is `SQLEXPRESS`.</span></span>
- <span data-ttu-id="64b34-130">`AttachDbFilename` -データベース ファイルの場所を指定します。</span><span class="sxs-lookup"><span data-stu-id="64b34-130">`AttachDbFilename` - specifies the location of the database file.</span></span> <span data-ttu-id="64b34-131">値には、プレース ホルダーが含まれています。 `|DataDirectory|`、アプリケーションの秒の完全なパスに解決される`App_Data`実行時にフォルダー。</span><span class="sxs-lookup"><span data-stu-id="64b34-131">The value contains the placeholder `|DataDirectory|`, which is resolved to the full path of the application s `App_Data` folder at runtime.</span></span>
- <span data-ttu-id="64b34-132">`Integrated Security` -(false)、データベースまたは現在の Windows にアカウントの資格情報 (true) に接続するときに指定されたユーザー名/パスワードを使用するかどうかを示すブール値。</span><span class="sxs-lookup"><span data-stu-id="64b34-132">`Integrated Security` - a Boolean value that indicates whether to use a specified username/password when connecting to the database (false) or the current Windows account credentials (true).</span></span>
- <span data-ttu-id="64b34-133">`User Instance` -SQL Server Express エディションにローカル コンピューターの管理者以外のユーザー接続し、SQL Server Express Edition のデータベースへの接続を許可するかどうかを示す特定の構成オプション。</span><span class="sxs-lookup"><span data-stu-id="64b34-133">`User Instance` - a configuration option specific to the SQL Server Express Editions that indicates whether to allow non-Administrative users on the local computer attach and connect to a SQL Server Express Edition database.</span></span> <span data-ttu-id="64b34-134">参照してください[SQL Server Express ユーザー インスタンス](https://msdn.microsoft.com/library/ms254504.aspx)この設定の詳細についてはします。</span><span class="sxs-lookup"><span data-stu-id="64b34-134">See [SQL Server Express User Instances](https://msdn.microsoft.com/library/ms254504.aspx) for more information on this setting.</span></span>

<span data-ttu-id="64b34-135">使用可能な接続文字列オプションは、データベースに接続して使用されている ADO.NET データベース プロバイダーによって異なります。</span><span class="sxs-lookup"><span data-stu-id="64b34-135">The allowable connection string options depend on the database you are connecting to and the ADO.NET database provider being used.</span></span> <span data-ttu-id="64b34-136">たとえば、データベースとは異なります、Oracle データベースに接続するために使用する Microsoft SQL Server に接続するため接続文字列。</span><span class="sxs-lookup"><span data-stu-id="64b34-136">For example, the connection string for connecting to a Microsoft SQL Server database differs from that used to connect to an Oracle database.</span></span> <span data-ttu-id="64b34-137">同様に、SqlClient プロバイダーを使用して Microsoft SQL Server データベースに接続するときに、OLE DB プロバイダーを使用するよりも、別の接続文字列を使用します。</span><span class="sxs-lookup"><span data-stu-id="64b34-137">Likewise, connecting to a Microsoft SQL Server database using the SqlClient provider uses a different connection string than when using the OLE-DB provider.</span></span>

<span data-ttu-id="64b34-138">ようにサイトを使用して手動でデータベース接続文字列を構築できます[ConnectionStrings.com](http://www.connectionstrings.com/)としてリソースをどのようなオプションを使用できます。</span><span class="sxs-lookup"><span data-stu-id="64b34-138">You can build the database connection string by hand using a site like [ConnectionStrings.com](http://www.connectionstrings.com/) as a resource for what options are available.</span></span> <span data-ttu-id="64b34-139">Visual Studio でサーバー エクスプ ローラーに、データベースを追加するより簡単な方法は、ただし、し、[プロパティ] ウィンドウから接続文字列を取得します。</span><span class="sxs-lookup"><span data-stu-id="64b34-139">However, an easier approach is to add the database to the Server Explorer in Visual Studio and then to grab the connection string from the Properties window.</span></span> <span data-ttu-id="64b34-140">この後者の手法を使用して、実稼働データベース サーバーへの接続文字列を構築するためのことができます。</span><span class="sxs-lookup"><span data-stu-id="64b34-140">Let s use this latter technique for constructing the connection string to the production database server.</span></span>

<span data-ttu-id="64b34-141">Visual Studio を開き、サーバー エクスプ ローラー ウィンドウに移動します (Visual Web developer では、このウィンドウと呼ばれるデータベース エクスプ ローラー)。</span><span class="sxs-lookup"><span data-stu-id="64b34-141">Open Visual Studio and then navigate to the Server Explorer window (in Visual Web Developer, this window is called Database Explorer).</span></span> <span data-ttu-id="64b34-142">データ接続オプションを右クリックし、コンテキスト メニューから 接続の追加オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="64b34-142">Right-click on the Data Connections option and choose the Add Connection option from the context menu.</span></span> <span data-ttu-id="64b34-143">図 1 に示すようにウィザードが表示されます。</span><span class="sxs-lookup"><span data-stu-id="64b34-143">This brings up the wizard shown in Figure 1.</span></span> <span data-ttu-id="64b34-144">適切なデータ ソースを選択し、[続行] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="64b34-144">Choose the appropriate data source and click Continue.</span></span>

<span data-ttu-id="64b34-145">[![サーバー エクスプ ローラーに新しいデータベースを追加します。](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image2.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="64b34-145">[![Choose to Add a New Database to the Server Explorer](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image2.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image1.jpg)</span></span> 

<span data-ttu-id="64b34-146">**図 1**:サーバー エクスプ ローラーに新しいデータベースを追加する ([フルサイズの画像を表示する をクリックします](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image3.jpg))。</span><span class="sxs-lookup"><span data-stu-id="64b34-146">**Figure 1**: Choose to Add a New Database to the Server Explorer ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image3.jpg))</span></span>

<span data-ttu-id="64b34-147">次に、さまざまなデータベース接続情報を指定 (図 2 参照)。</span><span class="sxs-lookup"><span data-stu-id="64b34-147">Next, specify the various database connection information (see Figure 2).</span></span> <span data-ttu-id="64b34-148">Web ホスティング会社にサインアップしたときに、データベース サーバー名、データベース名、ユーザー名とパスワードを使用して、データベースに接続して、具合のデータベースに接続する方法の情報を指定した必要があります。</span><span class="sxs-lookup"><span data-stu-id="64b34-148">When you signed up with your web hosting company they should have provided information on how to connect to the database - the database server name, the database name, the username and password to use to connect to the database, and so on.</span></span> <span data-ttu-id="64b34-149">この情報を入力したら、このウィザードを完了して、データベースをサーバー エクスプ ローラーに追加する [ok] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="64b34-149">After entering this information click OK to complete this wizard and to add the database to the Server Explorer.</span></span>

<span data-ttu-id="64b34-150">[![データベースの接続情報を指定します](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image5.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="64b34-150">[![Specify the Database Connection Information](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image5.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image4.jpg)</span></span> 

<span data-ttu-id="64b34-151">**図 2**:データベースの接続情報を指定します ([フルサイズの画像を表示する をクリックします](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image6.jpg))。</span><span class="sxs-lookup"><span data-stu-id="64b34-151">**Figure 2**: Specify the Database Connection Information ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image6.jpg))</span></span>

<span data-ttu-id="64b34-152">サーバー エクスプ ローラーで、実稼働環境のデータベースが表示されます。</span><span class="sxs-lookup"><span data-stu-id="64b34-152">The production environment database should now be listed in the Server Explorer.</span></span> <span data-ttu-id="64b34-153">サーバー エクスプ ローラーからデータベースを選択し、[プロパティ] ウィンドウに移動します。</span><span class="sxs-lookup"><span data-stu-id="64b34-153">Select the database from the Server Explorer and go to the Properties window.</span></span> <span data-ttu-id="64b34-154">あるデータベースの接続文字列で接続文字列をという名前のプロパティが表示されます。</span><span class="sxs-lookup"><span data-stu-id="64b34-154">There you will find a property named Connection String with the database s connection string.</span></span> <span data-ttu-id="64b34-155">運用環境と、SqlClient プロバイダーを Microsoft SQL Server データベースを使用するいると仮定すると、接続文字列は、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="64b34-155">Assuming you are using a Microsoft SQL Server database on production and the SqlClient provider your connection string should look similar to the following:</span></span>

<span data-ttu-id="64b34-156"><strong>データ ソース =<em>serverName</em>;Initial Catalog =<em>databaseName</em>;Persist Security Info = True;ユーザー ID =<em>username</em>;パスワード =*パスワード</strong>*</span><span class="sxs-lookup"><span data-stu-id="64b34-156"><strong>Data Source=<em>serverName</em>; Initial Catalog=<em>databaseName</em>; Persist Security Info=True; User ID=<em>username</em>; Password=*password</strong>*</span></span>

<span data-ttu-id="64b34-157">場所*serverName*、 *databaseName*、*ユーザー名*、および*パスワード*データベース サーバー名、データベースの値には名、およびユーザー名、および web ホスト会社から提供されたパスワード。</span><span class="sxs-lookup"><span data-stu-id="64b34-157">Where *serverName*, *databaseName*, *username*, and *password* are with the values for the database server name, the database name, and the username and password supplied to you by your web host company.</span></span>

## <a name="deploying-the-book-reviews-web-application"></a><span data-ttu-id="64b34-158">書籍レビューの Web アプリケーションを展開します。</span><span class="sxs-lookup"><span data-stu-id="64b34-158">Deploying the Book Reviews Web Application</span></span>

<span data-ttu-id="64b34-159">前のチュートリアルでは、開発用データベースを運用環境にコピー スルーしますが、でした、データ駆動型アプリケーションの展開を検討していません。</span><span class="sxs-lookup"><span data-stu-id="64b34-159">The preceding tutorial stepped through copying the development database to the production environment, but did not explore deploying the data-driven application.</span></span> <span data-ttu-id="64b34-160">この時点で、実稼働環境では、データベースが含まれていますが、静的レビューで、書籍レビューのアプリケーションのバージョンを使用しています。</span><span class="sxs-lookup"><span data-stu-id="64b34-160">At this point the production environment contains the database but is using the version of the Book Reviews application with static reviews.</span></span> <span data-ttu-id="64b34-161">最新の構成情報と、実稼働サーバーに、新しいデータ ドリブン アプリケーションをデプロイする必要があります。</span><span class="sxs-lookup"><span data-stu-id="64b34-161">We need to deploy the new, data-driven application to the production server along with the updated configuration information.</span></span>

<span data-ttu-id="64b34-162">データ ドリブン アプリケーションを開発環境から運用環境に展開する時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="64b34-162">Take a moment to deploy the data-driven application from the development environment to production.</span></span> <span data-ttu-id="64b34-163">このプロセスは、前のチュートリアルの詳細について説明しました。</span><span class="sxs-lookup"><span data-stu-id="64b34-163">This process was covered in detail in previous tutorials.</span></span> <span data-ttu-id="64b34-164">リフレッシャーが必要な場合を参照してください、 *FTP クライアントを使用して、web サイトを展開する*または*展開 web サイトを使用して Visual Studio*チュートリアル。</span><span class="sxs-lookup"><span data-stu-id="64b34-164">If you need a refresher, see the *Deploying Your Website Using an FTP Client* or the *Deploying Your Website Using Visual Studio* tutorials.</span></span> <span data-ttu-id="64b34-165">実稼働データベースの接続文字列は、1 つの代替。 つまり、運用環境で使用することを確認する必要があります`Web.config`ファイルを配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="64b34-165">You will need to ensure that the production database connection string is the one used in the production environment, which means that an alternate `Web.config` file must be deployed.</span></span> <span data-ttu-id="64b34-166">具体的には、これは変更`Web.config`ファイルの`<connectionStrings>`要素は、実稼働データベースの接続文字列を含める必要があり、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="64b34-166">Specifically, this modified `Web.config` file s `<connectionStrings>` element needs to contain the production database connection string and should look similar to the following:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample2.xml)]

<span data-ttu-id="64b34-167">内の接続文字列に注意してください、`<connectionStrings>`要素の名前は同じ (`ReviewsConnectionString`)、開発データベースの接続文字列ではなく、実稼働データベースの接続文字列が含まれていますが、します。</span><span class="sxs-lookup"><span data-stu-id="64b34-167">Note that the connection string in the `<connectionStrings>` element is named the same (`ReviewsConnectionString`), but now contains the production database connection string instead of the development database connection string.</span></span>

<span data-ttu-id="64b34-168">形式化されたデプロイのワークフローがない限り、手動で変更するか、 `Web.config` (開発データベースの接続文字列を使用してに戻すことを記憶を展開する前に、実稼働データベースの接続文字列を使用するファイルその後)、別の管理または`Web.config`ファイルを実稼働環境の構成情報、実稼働環境に展開プロセスの一部としてアップロードを取得します。</span><span class="sxs-lookup"><span data-stu-id="64b34-168">Unless you have a more formalized deployment workflow, either manually modify the `Web.config` file to use the production database connection string before deploying (remembering to revert it back to using the development database connection string afterwards) or maintain a separate `Web.config` file with the production environment configuration information that gets uploaded to the production environment as part of the deployment process.</span></span>

> [!NOTE]
> <span data-ttu-id="64b34-169">誤ってデプロイする場合、`Web.config`運用上のアプリケーションがデータベースに接続しようとすると、エラーになりますが、開発データベースの接続文字列を含むファイル。</span><span class="sxs-lookup"><span data-stu-id="64b34-169">If you accidentally deploy a `Web.config` file that contains the development database connection string then there will be an error when the application on production attempts to connect to the database.</span></span> <span data-ttu-id="64b34-170">としてマニフェストにこのエラーを`SqlException`で、サーバーが見つからなかったか、アクセスできなかったことを報告するメッセージ。</span><span class="sxs-lookup"><span data-stu-id="64b34-170">This error manifests as a `SqlException` with a message reporting that the server was not found or was not accessible.</span></span>

<span data-ttu-id="64b34-171">サイトを運用環境にデプロイすると、ブラウザーを使用して実稼働サイトを参照してください。</span><span class="sxs-lookup"><span data-stu-id="64b34-171">Once the site has been deployed to production, visit the production site through your browser.</span></span> <span data-ttu-id="64b34-172">データ ドリブン アプリケーションをローカルに実行する場合と同じユーザー エクスペリエンスをお楽しみくださいし、表示されます。</span><span class="sxs-lookup"><span data-stu-id="64b34-172">You should see and enjoy the same user experience as when running the data-driven application locally.</span></span> <span data-ttu-id="64b34-173">もちろん実稼働環境で、web サイトにアクセスすると、サイトが搭載されています、実稼働データベース サーバーが、開発、データベースでは、開発環境で web サイトにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="64b34-173">Of course when you visit the website on production the site is powered by the production database server, whereas visiting the website in the development environment uses the database in development.</span></span> <span data-ttu-id="64b34-174">図 3 は、*教える自分で ASP.NET 3.5 in 24 時間*(ブラウザーのアドレス バーに URL に注意してください) の実稼働環境で web サイトからのページを確認します。</span><span class="sxs-lookup"><span data-stu-id="64b34-174">Figure 3 shows the *Teach Yourself ASP.NET 3.5 in 24 Hours* review page from the website in the production environment (note the URL in the browser s Address bar).</span></span>

<span data-ttu-id="64b34-175">[![データ ドリブン アプリケーションでは、ここで使用可能なに運用環境です。](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image8.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="64b34-175">[![The Data-Driven Application is Now Available On Production!](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image8.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image7.jpg)</span></span> 

<span data-ttu-id="64b34-176">**図 3**:データ ドリブン アプリケーションでは、ここで使用可能なに運用環境です。</span><span class="sxs-lookup"><span data-stu-id="64b34-176">**Figure 3**: The Data-Driven Application is Now Available On Production!</span></span> <span data-ttu-id="64b34-177">([フルサイズの画像を表示する をクリックします](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image9.jpg))。</span><span class="sxs-lookup"><span data-stu-id="64b34-177">([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image9.jpg))</span></span>

### <a name="storing-connection-strings-in-a-separate-configuration-file"></a><span data-ttu-id="64b34-178">別の構成ファイルで接続文字列を保存します。</span><span class="sxs-lookup"><span data-stu-id="64b34-178">Storing Connection Strings in a Separate Configuration File</span></span>

<span data-ttu-id="64b34-179">開発および運用環境に個別の構成情報を維持するための一般的な手法は 2 つのバージョンの`Web.config`: 開発環境と運用環境のいずれかのいずれか。</span><span class="sxs-lookup"><span data-stu-id="64b34-179">A common technique for maintaining separate configuration information on the development and production environments is to have two versions of the `Web.config`: one for the development environment and one for production.</span></span> <span data-ttu-id="64b34-180">展開に適切な`Web.config`バージョンを実稼働環境にコピーできます。</span><span class="sxs-lookup"><span data-stu-id="64b34-180">At deploy-time the appropriate `Web.config` version can be copied to the production environment.</span></span> <span data-ttu-id="64b34-181">理想的には、展開ワークフローの一部としてこのプロセスを自動化するとします。</span><span class="sxs-lookup"><span data-stu-id="64b34-181">Ideally, this process would be automated as part of the deployment workflow.</span></span>

<span data-ttu-id="64b34-182">2 つの個別のメンテナンスではなく`Web.config`ファイルは、必要に応じてより詳細な相違点を提供します。</span><span class="sxs-lookup"><span data-stu-id="64b34-182">Instead of maintaining two separate `Web.config` files you can, optionally, provide more granular differences.</span></span> <span data-ttu-id="64b34-183">構成する要素、`Web.config`ファイルで参照される、外部構成ファイルで定義できる、`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="64b34-183">The elements that make up the `Web.config` file can be defined in an external configuration files that are then referenced in the `Web.config` file.</span></span> <span data-ttu-id="64b34-184">いずれかが簡単に言えば`Web.config`ファイルの両方の環境は、接続文字列を含む databaseConnectionStrings.config ファイルを参照するアプリケーションで使用され、環境ごとに一意になります。</span><span class="sxs-lookup"><span data-stu-id="64b34-184">In a nutshell you can have one `Web.config` file for both environments that references a databaseConnectionStrings.config file, which would contain the connection strings used by the application and would be unique for each environment.</span></span> <span data-ttu-id="64b34-185">個別のファイルに異なる構成情報を分離することを読みやすいように提供する検索し、単純な`Web.config`ファイルと明確にで開発および運用環境の構成の違いについて説明します。</span><span class="sxs-lookup"><span data-stu-id="64b34-185">I find that separating the differing configuration information into separate files provides a tidier and simpler `Web.config` file and more clearly outlines the configuration differences between the development and production environments.</span></span>

<span data-ttu-id="64b34-186">この手法を使用するという名前の web アプリケーションで新しいフォルダーを作成して開始`ConfigSections`します。</span><span class="sxs-lookup"><span data-stu-id="64b34-186">To use this technique, start by creating a new folder in the web application named `ConfigSections`.</span></span> <span data-ttu-id="64b34-187">次に、databaseConnectionStrings.dev.config databaseConnectionStrings.production.config というこの新しいフォルダーに 2 つのファイルを追加します。次に、コピー、`<connectionStrings>`要素から`Web.config`databaseConnectionStrings.dev.config と databaseConnectionStrings.production.config ファイルにし、内の接続文字列を変更しますdatabaseConnectionStrings.production.config ファイルの実稼働データベースの接続文字列を指定できるようにします。</span><span class="sxs-lookup"><span data-stu-id="64b34-187">Next, add two files to this new folder named databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config. Next, copy the `<connectionStrings>` element from `Web.config` into the databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config files, and then modify the connection string in the databaseConnectionStrings.production.config file so that it specifies the production database connection string.</span></span> <span data-ttu-id="64b34-188">たとえば、databaseConnectionStrings.dev.config ファイルを含める必要があります、`<connectionStrings>`開発用データベースを参照する接続文字列を持つ要素。</span><span class="sxs-lookup"><span data-stu-id="64b34-188">For example, the databaseConnectionStrings.dev.config file should contain just the `<connectionStrings>` element with a connection string that references the development database:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample3.xml)]

<span data-ttu-id="64b34-189">同様に、databaseConnectionStrings.production.config ファイルがだけ指定する必要があります、`<connectionStrings>`要素が、実稼働データベースの接続文字列であります。</span><span class="sxs-lookup"><span data-stu-id="64b34-189">Similarly, the databaseConnectionStrings.production.config file should contain just a `<connectionStrings>` element, but one that has the production database connection string.</span></span>

<span data-ttu-id="64b34-190">DatabaseConnectionStrings.dev.config ファイルのコピーを作成し、databaseConnectionStrings.config という名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="64b34-190">Make a copy of the databaseConnectionStrings.dev.config file and name it databaseConnectionStrings.config.</span></span>

> [!NOTE]
> <span data-ttu-id="64b34-191">できるファイルの名前を構成 databaseConnectionStrings.config、以外のものを場合は d など`connectionStrings.config`または`dbInfo.config`します。</span><span class="sxs-lookup"><span data-stu-id="64b34-191">You can name the configuration file something other than databaseConnectionStrings.config, if you d like, such as `connectionStrings.config` or `dbInfo.config`.</span></span> <span data-ttu-id="64b34-192">ただし、ファイルに名前を必ず、`.config`拡張機能として`.config`ファイルは、既定で処理されない、ASP.NET エンジン。</span><span class="sxs-lookup"><span data-stu-id="64b34-192">However, be sure to name the file with a `.config` extension as `.config` files are, by default, not served by the ASP.NET engine.</span></span> <span data-ttu-id="64b34-193">などの場合、別の名前、ファイル、 `connectionStrings.txt`、ユーザーは、ブラウザーをポイントでした[www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt)し、ファイルの内容を表示。</span><span class="sxs-lookup"><span data-stu-id="64b34-193">If you name the file something else, like `connectionStrings.txt`, a user could point their browser to [www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt) and view the contents of the file!</span></span>

<span data-ttu-id="64b34-194">この時点で、`ConfigSections`フォルダーは、3 つのファイル (図 4 参照) を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="64b34-194">At this point the `ConfigSections` folder should contain three files (see Figure 4).</span></span> <span data-ttu-id="64b34-195">DatabaseConnectionStrings.dev.config と databaseConnectionStrings.production.config ファイルには、開発および運用環境では、接続文字列がそれぞれ含まれます。</span><span class="sxs-lookup"><span data-stu-id="64b34-195">The databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config files contain the connection strings for the development and production environments, respectively.</span></span> <span data-ttu-id="64b34-196">DatabaseConnectionStrings.config ファイルには、実行時に web アプリケーションによって使用される接続文字列情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="64b34-196">The databaseConnectionStrings.config file contains the connection string information that will be used by the web application at runtime.</span></span> <span data-ttu-id="64b34-197">その結果、databaseConnectionStrings.config ファイルが運用環境で databaseConnectionStrings.config ファイルと同じになりますが、開発環境で databaseConnectionStrings.dev.config ファイルに同じであります。databaseConnectionStrings.production.config します。</span><span class="sxs-lookup"><span data-stu-id="64b34-197">Consequently, the databaseConnectionStrings.config file should be identical to the databaseConnectionStrings.dev.config file in the development environment, whereas on production the databaseConnectionStrings.config file should be identical to databaseConnectionStrings.production.config.</span></span>

<span data-ttu-id="64b34-198">[![ConfigSections](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image11.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="64b34-198">[![ConfigSections](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image11.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image10.jpg)</span></span> 

<span data-ttu-id="64b34-199">**図 4**:ConfigSections ([フルサイズの画像を表示する をクリックします](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image12.jpg))。</span><span class="sxs-lookup"><span data-stu-id="64b34-199">**Figure 4**: ConfigSections ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image12.jpg))</span></span>

<span data-ttu-id="64b34-200">今すぐに指示する必要があります`Web.config`databaseConnectionStrings.config ファイルの接続文字列のストアを使用します。</span><span class="sxs-lookup"><span data-stu-id="64b34-200">We now need to instruct `Web.config` to use the databaseConnectionStrings.config file for its connection string store.</span></span> <span data-ttu-id="64b34-201">`Web.config`を開いて、既存の `<connectionStrings>` 要素を次の XAML に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="64b34-201">Open `Web.config` and replace the existing `<connectionStrings>` element with the following:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample4.xml)]

<span data-ttu-id="64b34-202">`configSource`属性に関連する物理パスを指定します、`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="64b34-202">The `configSource` attribute specifies a physical path relative to the `Web.config` file.</span></span> <span data-ttu-id="64b34-203">場合、外部`.config`と同じディレクトリ内のファイルが`Web.config`のファイル名にこの属性を設定、`.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="64b34-203">If the external `.config` file is in the same directory as `Web.config` then set this attribute to the file name of the `.config` file.</span></span> <span data-ttu-id="64b34-204">場合に、サブディレクトリ内 databaseConnectionStrings.config は、指定を ConfigSections\databaseConnectionStrings.config のように、フォルダーとファイル名を区切るためにバック スラッシュを使用してサブフォルダーです。</span><span class="sxs-lookup"><span data-stu-id="64b34-204">If it s in a subdirectory, as is the case with databaseConnectionStrings.config, specify the subfolder using a backslash to delimit the folder and file names, like ConfigSections\databaseConnectionStrings.config.</span></span>

<span data-ttu-id="64b34-205">この変更により、開発および運用環境を含む同じ`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="64b34-205">With this modification, the development and production environments contain the same `Web.config` file.</span></span> <span data-ttu-id="64b34-206">ここで唯一の違いは、databaseConnectionStrings.config ファイルです。</span><span class="sxs-lookup"><span data-stu-id="64b34-206">Now the only difference is the databaseConnectionStrings.config file.</span></span> <span data-ttu-id="64b34-207">運用環境に databaseConnectionStrings.production.config ファイルをコピーし、databaseConnectionStrings.config に変更します。今後、実稼働データベースの接続文字列への変更がある場合は、必要があります databaseConnectionStrings.production.config ファイルにすることし、運用環境にそのファイルをアップロードする databaseConnectionStrings.config 名前を変更します。</span><span class="sxs-lookup"><span data-stu-id="64b34-207">Copy the databaseConnectionStrings.production.config file to production and rename it to databaseConnectionStrings.config. If, in the future, there are changes to the production database connection string you will need to make them to the databaseConnectionStrings.production.config file and then upload that file to production, renaming it databaseConnectionStrings.config.</span></span>

> [!NOTE]
> <span data-ttu-id="64b34-208">いずれかの情報を指定することがあります`Web.config`内の要素別のファイルおよび使用して、`configSource`内からそのファイルを参照する属性`Web.config`します。</span><span class="sxs-lookup"><span data-stu-id="64b34-208">You may specify the information for any `Web.config` element in a separate file and use the `configSource` attribute to reference that file from within `Web.config`.</span></span>

## <a name="summary"></a><span data-ttu-id="64b34-209">まとめ</span><span class="sxs-lookup"><span data-stu-id="64b34-209">Summary</span></span>

<span data-ttu-id="64b34-210">通常、データ駆動型アプリケーションは、開発および運用環境で異なるデータベースを使用します。</span><span class="sxs-lookup"><span data-stu-id="64b34-210">Data-driven applications usually use different databases in the development and production environments.</span></span> <span data-ttu-id="64b34-211">その結果、web アプリケーションの構成に格納されているデータベースの接続文字列は、環境ごとに一意である必要があります。</span><span class="sxs-lookup"><span data-stu-id="64b34-211">Consequently, the database connection strings stored in the web application s configuration must be unique per environment.</span></span> <span data-ttu-id="64b34-212">このチュートリアルでは、実稼働データベースの接続文字列と 2 つの環境での一意の接続文字列情報を管理する方法を決定する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="64b34-212">In this tutorial we looked at how to determine the production database connection string and ways to maintain unique connection string information in the two environments.</span></span>

<span data-ttu-id="64b34-213">満足のプログラミングです。</span><span class="sxs-lookup"><span data-stu-id="64b34-213">Happy Programming!</span></span>

#### <a name="further-reading"></a><span data-ttu-id="64b34-214">関連項目</span><span class="sxs-lookup"><span data-stu-id="64b34-214">Further Reading</span></span>

<span data-ttu-id="64b34-215">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="64b34-215">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="64b34-216">接続文字列と構成ファイル</span><span class="sxs-lookup"><span data-stu-id="64b34-216">Connection Strings and Configuration Files</span></span>](https://msdn.microsoft.com/library/ms254494.aspx)
- [<span data-ttu-id="64b34-217">データベースの構成文字列は @ ConnectionStrings.com</span><span class="sxs-lookup"><span data-stu-id="64b34-217">Database Configuration Strings Information @ ConnectionStrings.com</span></span>](http://www.connectionstrings.com/)
- [<span data-ttu-id="64b34-218">Web.config ファイルから設定を移動します。</span><span class="sxs-lookup"><span data-stu-id="64b34-218">Move Settings Out of the Web.config File</span></span>](http://www.asp101.com/tips/index.asp?id=154)
- [<span data-ttu-id="64b34-219">技術ドキュメント、 &lt;connectionStrings&gt;要素</span><span class="sxs-lookup"><span data-stu-id="64b34-219">Technical Documentation for the &lt;connectionStrings&gt; Element</span></span>](https://msdn.microsoft.com/library/bf7sd233.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="64b34-220">[前へ](deploying-a-database-cs.md)
> [次へ](configuring-a-website-that-uses-application-services-cs.md)</span><span class="sxs-lookup"><span data-stu-id="64b34-220">[Previous](deploying-a-database-cs.md)
[Next](configuring-a-website-that-uses-application-services-cs.md)</span></span>
