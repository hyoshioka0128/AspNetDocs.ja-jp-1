---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-cs
title: ELMAH (C#) を使用してエラーの詳細をログに記録するMicrosoft Docs
author: rick-anderson
description: エラーログモジュールとハンドラー (ELMAH) は、運用環境で実行時エラーをログに記録するための別の方法を提供します。 ELMAH は無料のオープンソースエラーです...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 11f6fe44-64ef-4a38-a3b4-35c7bb992352
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-elmah-cs
msc.type: authoredcontent
ms.openlocfilehash: 5018023eced23e7a70eab90e649f85862c548940
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74570494"
---
# <a name="logging-error-details-with-elmah-c"></a><span data-ttu-id="a7084-104">ELMAH でエラーの詳細をログに記録する (C#)</span><span class="sxs-lookup"><span data-stu-id="a7084-104">Logging Error Details with ELMAH (C#)</span></span>

<span data-ttu-id="a7084-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a7084-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a7084-106">[コードのダウンロード](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_14_CS.zip)または[PDF のダウンロード](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial14_ELMAH_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="a7084-106">[Download Code](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_14_CS.zip) or [Download PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial14_ELMAH_cs.pdf)</span></span>

> <span data-ttu-id="a7084-107">エラーログモジュールとハンドラー (ELMAH) は、運用環境で実行時エラーをログに記録するための別の方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="a7084-107">Error Logging Modules And Handlers (ELMAH) offers another approach to logging runtime errors in a production environment.</span></span> <span data-ttu-id="a7084-108">ELMAH は、オープンソースのエラーログライブラリです。このライブラリには、エラーのフィルター処理や、web ページからのエラーログの表示、RSS フィードの表示、コンマ区切りファイルとしてのダウンロードなどの機能が含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-108">ELMAH is a free, open source error logging library that includes features like error filtering and the ability to view the error log from a web page, as an RSS feed, or to download it as a comma-delimited file.</span></span> <span data-ttu-id="a7084-109">このチュートリアルでは、ELMAH のダウンロードと構成について説明します。</span><span class="sxs-lookup"><span data-stu-id="a7084-109">This tutorial walks through downloading and configuring ELMAH.</span></span>

## <a name="introduction"></a><span data-ttu-id="a7084-110">はじめに</span><span class="sxs-lookup"><span data-stu-id="a7084-110">Introduction</span></span>

<span data-ttu-id="a7084-111">[前のチュートリアル](logging-error-details-with-asp-net-health-monitoring-cs.md)では、ASP を検証しています。ネットワークの正常性監視システム。広範な Web イベントを記録するための、すぐに使用できるライブラリが用意されています。</span><span class="sxs-lookup"><span data-stu-id="a7084-111">The [preceding tutorial](logging-error-details-with-asp-net-health-monitoring-cs.md) examined ASP.NET's health monitoring system, which offers an out of the box library for recording a wide array of Web events.</span></span> <span data-ttu-id="a7084-112">多くの開発者は、正常性監視を使用して、未処理の例外の詳細をログに記録し、電子メールで送信します。</span><span class="sxs-lookup"><span data-stu-id="a7084-112">Many developers use health monitoring to log and email the details of unhandled exceptions.</span></span> <span data-ttu-id="a7084-113">ただし、このシステムにはいくつかの問題点があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-113">However, there are a few pain points with this system.</span></span> <span data-ttu-id="a7084-114">1つ目は、ログに記録されたイベントに関する情報を表示するためのユーザーインターフェイスがないことです。</span><span class="sxs-lookup"><span data-stu-id="a7084-114">First and foremost is the lack any sort of user interface for viewing information about the logged events.</span></span> <span data-ttu-id="a7084-115">過去10回のエラーの概要を表示する場合、または先週発生したエラーの詳細を表示する場合は、データベースをからかうするか、電子メールの受信トレイをスキャンするか、または `aspnet_WebEvent_Events` テーブルからの情報を表示する web ページを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-115">If you want to see a summary of the 10 last errors, or view the details of an error that happened last week, you must either poke through the database, scan through your email Inbox, or build a web page that displays information from the `aspnet_WebEvent_Events` table.</span></span>

<span data-ttu-id="a7084-116">もう1つの問題点は、稼動状況の監視の複雑さを中心にしています。</span><span class="sxs-lookup"><span data-stu-id="a7084-116">Another pain point centers around health monitoring's complexity.</span></span> <span data-ttu-id="a7084-117">正常性の監視を使用して大量のイベントを記録することができます。また、イベントをログに記録する方法とタイミングを指定するさまざまなオプションがあるため、正常性監視システムを正しく構成することは煩雑タスクになる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-117">Because health monitoring can be used to record a plethora of different events, and because there are a variety of options for instructing how and when events are logged, correctly configuring the health monitoring system can be an onerous task.</span></span> <span data-ttu-id="a7084-118">最後に、互換性の問題があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-118">Finally, there are compatibility issues.</span></span> <span data-ttu-id="a7084-119">正常性の監視は、バージョン2.0 の .NET Framework に最初に追加されたため、ASP.NET バージョン1.x を使用して作成された古い web アプリケーションでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="a7084-119">Because health monitoring was first added to the .NET Framework in version 2.0, it is not available for older web applications built using ASP.NET version 1.x.</span></span> <span data-ttu-id="a7084-120">さらに、前のチュートリアルで使用した `SqlWebEventProvider` クラスは、エラーの詳細をデータベースに記録するために、Microsoft SQL Server データベースでのみ機能します。</span><span class="sxs-lookup"><span data-stu-id="a7084-120">Moreover, the `SqlWebEventProvider` class, which we used in the preceding tutorial to logs error details to a database, only works with Microsoft SQL Server databases.</span></span> <span data-ttu-id="a7084-121">XML ファイルや Oracle データベースなどの代替データストアにエラーを記録する必要がある場合は、カスタムログプロバイダークラスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-121">You will need to create a custom log provider class should you need to log errors to an alternate data store, such as an XML file or Oracle database.</span></span>

<span data-ttu-id="a7084-122">正常性監視システムの代替手段は、 [Atif た](http://www.raboof.com/)によって作成された無料のオープンソースのエラーログシステムである、エラーログモジュールとハンドラー (ELMAH) です。</span><span class="sxs-lookup"><span data-stu-id="a7084-122">An alternative to the health monitoring system is Error Logging Modules And Handlers (ELMAH), a free, open-source error logging system created by [Atif Aziz](http://www.raboof.com/).</span></span> <span data-ttu-id="a7084-123">2つのシステムの最も顕著な違いは、エラーの一覧と、web ページおよび RSS フィードからの特定のエラーの詳細を表示する ELAMH の機能です。</span><span class="sxs-lookup"><span data-stu-id="a7084-123">The most notable difference between the two systems is ELAMH's ability to display a list of errors and the details of a specific error from a web page and as an RSS feed.</span></span> <span data-ttu-id="a7084-124">ELMAH は、エラーをログに記録するだけなので、正常性の監視よりも簡単に構成できます。</span><span class="sxs-lookup"><span data-stu-id="a7084-124">ELMAH is easier to configure than health monitoring because it only logs errors.</span></span> <span data-ttu-id="a7084-125">さらに、ELMAH には、ASP.NET 1.x、ASP.NET 2.0、および ASP.NET 3.5 アプリケーションのサポートが含まれており、さまざまなログソースプロバイダーが付属しています。</span><span class="sxs-lookup"><span data-stu-id="a7084-125">Furthermore, ELMAH includes support for ASP.NET 1.x, ASP.NET 2.0, and ASP.NET 3.5 applications, and ships with a variety of log source providers.</span></span>

<span data-ttu-id="a7084-126">このチュートリアルでは、ASP.NET アプリケーションに ELMAH を追加するために必要な手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="a7084-126">This tutorial walks through the steps involved in adding ELMAH to an ASP.NET application.</span></span> <span data-ttu-id="a7084-127">では、始めましょう。</span><span class="sxs-lookup"><span data-stu-id="a7084-127">Let's get started!</span></span>

> [!NOTE]
> <span data-ttu-id="a7084-128">正常性監視システムと ELMAH の両方に、独自の長所と短所があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-128">The health monitoring system and ELMAH both have their own sets of pros and cons.</span></span> <span data-ttu-id="a7084-129">両方のシステムを試して、ニーズに最も適したものを決定することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a7084-129">I encourage you to try both systems and decide what one best suits your needs.</span></span>

## <a name="adding-elmah-to-an-aspnet-web-application"></a><span data-ttu-id="a7084-130">ASP.NET Web アプリケーションに ELMAH を追加する</span><span class="sxs-lookup"><span data-stu-id="a7084-130">Adding ELMAH to an ASP.NET Web Application</span></span>

<span data-ttu-id="a7084-131">ELMAH を新規または既存の ASP.NET アプリケーションに統合することは、5分未満で簡単で簡単なプロセスです。</span><span class="sxs-lookup"><span data-stu-id="a7084-131">Integrating ELMAH into a new or existing ASP.NET application is an easy and straightforward process that takes under five minutes.</span></span> <span data-ttu-id="a7084-132">簡単に言うと、次の4つの簡単な手順を行います。</span><span class="sxs-lookup"><span data-stu-id="a7084-132">In a nutshell, it involves four simple steps:</span></span>

1. <span data-ttu-id="a7084-133">ELMAH をダウンロードし、web アプリケーションに `Elmah.dll` アセンブリを追加します。</span><span class="sxs-lookup"><span data-stu-id="a7084-133">Download ELMAH and add the `Elmah.dll` assembly to your web application,</span></span>
2. <span data-ttu-id="a7084-134">`Web.config`に ELMAH の HTTP モジュールとハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="a7084-134">Register ELMAH's HTTP Modules and Handler in `Web.config`,</span></span>
3. <span data-ttu-id="a7084-135">ELMAH の構成オプションを指定します。</span><span class="sxs-lookup"><span data-stu-id="a7084-135">Specify ELMAH's configuration options, and</span></span>
4. <span data-ttu-id="a7084-136">必要に応じて、エラーログのソースインフラストラクチャを作成します。</span><span class="sxs-lookup"><span data-stu-id="a7084-136">Create the error log source infrastructure, if needed.</span></span>

<span data-ttu-id="a7084-137">ここでは、これら4つの手順を1つずつ順番に説明します。</span><span class="sxs-lookup"><span data-stu-id="a7084-137">Let's walk through each of these four steps, one at a time.</span></span>

### <a name="step-1-downloading-the-elmah-project-files-and-addingelmahdllto-your-web-application"></a><span data-ttu-id="a7084-138">手順 1: ELMAH プロジェクトファイルのダウンロードと Web アプリケーションへの`Elmah.dll`の追加</span><span class="sxs-lookup"><span data-stu-id="a7084-138">Step 1: Downloading the ELMAH Project Files and Adding`Elmah.dll`To Your Web Application</span></span>

<span data-ttu-id="a7084-139">ELMAH 1.0 BETA 3 (ビルド 10617)、書き込み時の最新バージョンは、このチュートリアルで利用できるダウンロードに含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-139">ELMAH 1.0 BETA 3 (Build 10617), the most recent version at the time of writing, is included in the download available with this tutorial.</span></span> <span data-ttu-id="a7084-140">または、 [ELMAH web サイト](https://code.google.com/p/elmah/)にアクセスして最新バージョンを取得したり、ソースコードをダウンロードしたりすることもできます。</span><span class="sxs-lookup"><span data-stu-id="a7084-140">Alternatively, you may visit the [ELMAH website](https://code.google.com/p/elmah/) to get the most recent version or to download the source code.</span></span> <span data-ttu-id="a7084-141">ELMAH ダウンロードをデスクトップ上のフォルダーに抽出し、ELMAH アセンブリファイル (`Elmah.dll`) を探します。</span><span class="sxs-lookup"><span data-stu-id="a7084-141">Extract the ELMAH download to a folder on your desktop and locate the ELMAH assembly file (`Elmah.dll`).</span></span>

> [!NOTE]
> <span data-ttu-id="a7084-142">`Elmah.dll` ファイルは、ダウンロードの `Bin` フォルダーにあります。このフォルダーには、異なる .NET Framework バージョンのサブフォルダーと、リリースビルドとデバッグビルドのサブフォルダーがあります。</span><span class="sxs-lookup"><span data-stu-id="a7084-142">The `Elmah.dll` file is located in the download's `Bin` folder, which has subfolders for different .NET Framework versions and for Release and Debug builds.</span></span> <span data-ttu-id="a7084-143">適切なフレームワークのバージョンについては、リリースビルドを使用してください。</span><span class="sxs-lookup"><span data-stu-id="a7084-143">Use the Release build for the appropriate framework version.</span></span> <span data-ttu-id="a7084-144">たとえば、ASP.NET 3.5 web アプリケーションをビルドする場合は、`Bin\net-3.5\Release` フォルダーから `Elmah.dll` ファイルをコピーします。</span><span class="sxs-lookup"><span data-stu-id="a7084-144">For instance, if you are building an ASP.NET 3.5 web application, copy the `Elmah.dll` file from the `Bin\net-3.5\Release` folder.</span></span>

<span data-ttu-id="a7084-145">次に、Visual Studio を開き、ソリューションエクスプローラーで web サイト名を右クリックし、コンテキストメニューから [参照の追加] を選択して、アセンブリをプロジェクトに追加します。</span><span class="sxs-lookup"><span data-stu-id="a7084-145">Next, open Visual Studio and add the assembly to your project by right-clicking on the website name in the Solution Explorer and choosing Add Reference from the context menu.</span></span> <span data-ttu-id="a7084-146">[参照の追加] ダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-146">This brings up the Add Reference dialog box.</span></span> <span data-ttu-id="a7084-147">[参照] タブに移動し、`Elmah.dll` ファイルを選択します。</span><span class="sxs-lookup"><span data-stu-id="a7084-147">Navigate to the Browse tab and choose the `Elmah.dll` file.</span></span> <span data-ttu-id="a7084-148">この操作により、`Elmah.dll` ファイルが web アプリケーションの `Bin` フォルダーに追加されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-148">This action adds the `Elmah.dll` file to the web application's `Bin` folder.</span></span>

> [!NOTE]
> <span data-ttu-id="a7084-149">Web アプリケーションプロジェクト (WAP) の種類では、ソリューションエクスプローラーに `Bin` フォルダーは表示されません。</span><span class="sxs-lookup"><span data-stu-id="a7084-149">The Web Application Project (WAP) type does not show the `Bin` folder in the Solution Explorer.</span></span> <span data-ttu-id="a7084-150">代わりに、[参照] フォルダーの下にこれらの項目が表示されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-150">Instead, it lists these items under the References folder.</span></span>

<span data-ttu-id="a7084-151">`Elmah.dll` アセンブリには、ELMAH システムによって使用されるクラスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-151">The `Elmah.dll` assembly includes the classes used by the ELMAH system.</span></span> <span data-ttu-id="a7084-152">これらのクラスは、次の3つのカテゴリのいずれかに分類されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-152">These classes fall into one of three categories:</span></span>

- <span data-ttu-id="a7084-153">**Http モジュール**-http モジュールは、`Error` イベントなどの `HttpApplication` イベントのイベントハンドラーを定義するクラスです。</span><span class="sxs-lookup"><span data-stu-id="a7084-153">**HTTP Modules** - an HTTP Module is a class that defines event handlers for `HttpApplication` events, such as the `Error` event.</span></span> <span data-ttu-id="a7084-154">ELMAH には複数の HTTP モジュールが含まれており、最も連動なものは次の3つです。</span><span class="sxs-lookup"><span data-stu-id="a7084-154">ELMAH includes multiple HTTP Modules, the three most germane ones being:</span></span> 

    - <span data-ttu-id="a7084-155">`ErrorLogModule`-未処理の例外をログソースに記録します。</span><span class="sxs-lookup"><span data-stu-id="a7084-155">`ErrorLogModule` - logs unhandled exceptions to a log source.</span></span>
    - <span data-ttu-id="a7084-156">`ErrorMailModule`-未処理の例外の詳細を電子メールメッセージで送信します。</span><span class="sxs-lookup"><span data-stu-id="a7084-156">`ErrorMailModule` - sends the details of an unhandled exception in an email message.</span></span>
    - <span data-ttu-id="a7084-157">`ErrorFilterModule`-開発者が指定したフィルターを適用して、ログに記録される例外と無視される例外を決定します。</span><span class="sxs-lookup"><span data-stu-id="a7084-157">`ErrorFilterModule` - applies developer-specified filters to determine what exceptions are logged and what ones are ignored.</span></span>
- <span data-ttu-id="a7084-158">**Http ハンドラー** -http ハンドラーは、特定の種類の要求のマークアップを生成するクラスです。</span><span class="sxs-lookup"><span data-stu-id="a7084-158">**HTTP Handlers** - an HTTP Handler is a class that is responsible for generating the markup for a particular type of request.</span></span> <span data-ttu-id="a7084-159">ELMAH には、エラーの詳細を web ページとして、RSS フィードとして、またはコンマ区切りファイル (CSV) として表示する HTTP ハンドラーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-159">ELMAH includes HTTP Handlers that render error details as a web page, as an RSS feed, or as a comma-delimited file (CSV).</span></span>
- <span data-ttu-id="a7084-160">**エラーログのソース**-ELMAH では、メモリ、Microsoft SQL Server データベース、Microsoft access データベース、Oracle データベース、XML ファイル、SQLite データベース、または Vista DB データベースに対して、エラーを記録することができます。</span><span class="sxs-lookup"><span data-stu-id="a7084-160">**Error Log Sources** - out of the box ELMAH can log errors to memory, to a Microsoft SQL Server database, to a Microsoft Access database, to an Oracle database, to an XML file, to a SQLite database, or to a Vista DB database.</span></span> <span data-ttu-id="a7084-161">正常性監視システムと同様に、ELMAH のアーキテクチャはプロバイダーモデルを使用して構築されています。つまり、必要に応じて、独自のカスタムログソースプロバイダーを作成し、シームレスに統合することができます。</span><span class="sxs-lookup"><span data-stu-id="a7084-161">Like the health monitoring system, ELMAH's architecture was built using the provider model, meaning that you can create and seamlessly integrate your own custom log source providers, if needed.</span></span>

### <a name="step-2-registering-elmahs-http-module-and-handler"></a><span data-ttu-id="a7084-162">手順 2: ELMAH の HTTP モジュールとハンドラーの登録</span><span class="sxs-lookup"><span data-stu-id="a7084-162">Step 2: Registering ELMAH's HTTP Module and Handler</span></span>

<span data-ttu-id="a7084-163">`Elmah.dll` ファイルには、未処理の例外を自動的にログに記録したり、web ページからエラーの詳細を表示したりするために必要な HTTP モジュールとハンドラーが含まれていますが、web アプリケーションの構成に明示的に登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-163">While the `Elmah.dll` file contains the HTTP Modules and Handler needed to automatically log unhandled exceptions and to display error details from a web page, these must be explicitly registered in the web application's configuration.</span></span> <span data-ttu-id="a7084-164">`ErrorLogModule` HTTP モジュールは、登録されると、`HttpApplication`の `Error` イベントをサブスクライブします。</span><span class="sxs-lookup"><span data-stu-id="a7084-164">The `ErrorLogModule` HTTP Module, once registered, subscribes to the `HttpApplication`'s `Error` event.</span></span> <span data-ttu-id="a7084-165">このイベントが発生するたびに、`ErrorLogModule` によって、指定したログソースに例外の詳細が記録されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-165">Whenever this event is raised the `ErrorLogModule` logs the details of the exception to a specified log source.</span></span> <span data-ttu-id="a7084-166">ログソースプロバイダーの定義方法については、次のセクション「ELMAH の構成」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7084-166">We'll see how to define the log source provider in the next section, "Configuring ELMAH."</span></span> <span data-ttu-id="a7084-167">`ErrorLogPageFactory` HTTP ハンドラーファクトリは、web ページからエラーログを表示するときにマークアップを生成します。</span><span class="sxs-lookup"><span data-stu-id="a7084-167">The `ErrorLogPageFactory` HTTP Handler factory is responsible for generating the markup when viewing the error log from a web page.</span></span>

<span data-ttu-id="a7084-168">HTTP モジュールとハンドラーを登録するための具体的な構文は、サイトの電源を入れている web サーバーによって異なります。</span><span class="sxs-lookup"><span data-stu-id="a7084-168">The specific syntax for registering HTTP Modules and Handlers depends upon the web server that is powering the site.</span></span> <span data-ttu-id="a7084-169">ASP.NET 開発サーバーおよび Microsoft の IIS バージョン6.0 以前では、HTTP モジュールとハンドラーは、`<system.web>` 要素内に表示される `<httpModules>` および `<httpHandlers>` セクションに登録されています。</span><span class="sxs-lookup"><span data-stu-id="a7084-169">For the ASP.NET Development Server and Microsoft's IIS version 6.0 and earlier, HTTP Modules and Handlers are registered in the `<httpModules>` and `<httpHandlers>` sections, which appear within the `<system.web>` element.</span></span> <span data-ttu-id="a7084-170">IIS 7.0 を使用している場合は、`<system.webServer>` 要素の `<modules>` と `<handlers>` のセクションに登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-170">If you are using IIS 7.0 then they need to be registered in the `<system.webServer>` element's `<modules>` and `<handlers>` sections.</span></span> <span data-ttu-id="a7084-171">さいわい、使用する web サーバーに関係なく、*両方*の場所で HTTP モジュールとハンドラーを定義できます。</span><span class="sxs-lookup"><span data-stu-id="a7084-171">Fortunately, you can define the HTTP Modules and Handlers in *both* places regardless of the web server being used.</span></span> <span data-ttu-id="a7084-172">このオプションは、使用されている web サーバーに関係なく、開発環境と運用環境で同じ構成を使用できるようにするため、最もポータブルなオプションです。</span><span class="sxs-lookup"><span data-stu-id="a7084-172">This option is the most portable one as it allows the same configuration to be used in the development and production environments regardless of the web server being used.</span></span>

<span data-ttu-id="a7084-173">まず、`ErrorLogModule` HTTP モジュールと `ErrorLogPageFactory` HTTP ハンドラーを `<system.web>`の `<httpModules>` および `<httpHandlers>` セクションに登録します。</span><span class="sxs-lookup"><span data-stu-id="a7084-173">Start by registering the `ErrorLogModule` HTTP Module and the `ErrorLogPageFactory` HTTP Handler in the `<httpModules>` and `<httpHandlers>` section in `<system.web>`.</span></span> <span data-ttu-id="a7084-174">構成でこれらの2つの要素が既に定義されている場合は、ELMAH の HTTP モジュールおよびハンドラーの `<add>` 要素を含めるだけです。</span><span class="sxs-lookup"><span data-stu-id="a7084-174">If your configuration already defines these two elements then simply include the `<add>` element for ELMAH's HTTP Module and Handler.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample1.xml)]

<span data-ttu-id="a7084-175">次に、`<system.webServer>` 要素に ELMAH の HTTP モジュールとハンドラーを登録します。</span><span class="sxs-lookup"><span data-stu-id="a7084-175">Next, register ELMAH's HTTP Module and Handler in the `<system.webServer>` element.</span></span> <span data-ttu-id="a7084-176">以前と同様に、この要素が構成にまだ存在していない場合は、それを追加します。</span><span class="sxs-lookup"><span data-stu-id="a7084-176">As before, if this element is not already present in your configuration then add it.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample2.xml)]

<span data-ttu-id="a7084-177">既定では、HTTP モジュールとハンドラーが `<system.web>` セクションに登録されている場合、IIS 7 はを示します。</span><span class="sxs-lookup"><span data-stu-id="a7084-177">By default, IIS 7 complains if HTTP Modules and Handlers are registered in the `<system.web>` section.</span></span> <span data-ttu-id="a7084-178">`<validation>` 要素の `validateIntegratedModeConfiguration` 属性は、このようなエラーメッセージを非表示にするように IIS 7 に指示します。</span><span class="sxs-lookup"><span data-stu-id="a7084-178">The `validateIntegratedModeConfiguration` attribute in the `<validation>` element instructs IIS 7 to suppress such error messages.</span></span>

<span data-ttu-id="a7084-179">`ErrorLogPageFactory` HTTP ハンドラーを登録するための構文には、`elmah.axd`に設定されている `path` 属性が含まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a7084-179">Note that the syntax for registering the `ErrorLogPageFactory` HTTP Handler includes a `path` attribute, which is set to `elmah.axd`.</span></span> <span data-ttu-id="a7084-180">この属性は、`elmah.axd` という名前のページに対して要求が到着した場合に、`ErrorLogPageFactory` HTTP ハンドラーによって要求が処理されることを web アプリケーションに通知します。</span><span class="sxs-lookup"><span data-stu-id="a7084-180">This attribute informs the web application that if a request arrives for a page named `elmah.axd` then the request should be processed by the `ErrorLogPageFactory` HTTP Handler.</span></span> <span data-ttu-id="a7084-181">このチュートリアルの後半では、`ErrorLogPageFactory` HTTP ハンドラーの動作について説明します。</span><span class="sxs-lookup"><span data-stu-id="a7084-181">We'll see the `ErrorLogPageFactory` HTTP Handler in action later in this tutorial.</span></span>

### <a name="step-3-configuring-elmah"></a><span data-ttu-id="a7084-182">手順 3: ELMAH の構成</span><span class="sxs-lookup"><span data-stu-id="a7084-182">Step 3: Configuring ELMAH</span></span>

<span data-ttu-id="a7084-183">ELMAH は、`<elmah>`という名前のカスタム構成セクションで、web サイトの `Web.config` ファイルでその構成オプションを検索します。</span><span class="sxs-lookup"><span data-stu-id="a7084-183">ELMAH looks for its configuration options in the website's `Web.config` file in a custom configuration section named `<elmah>`.</span></span> <span data-ttu-id="a7084-184">`Web.config` でカスタムセクションを使用するには、まず `<configSections>` 要素で定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-184">In order to use a custom section in `Web.config` it must first be defined in the `<configSections>` element.</span></span> <span data-ttu-id="a7084-185">`Web.config` ファイルを開き、次のマークアップを `<configSections>`に追加します。</span><span class="sxs-lookup"><span data-stu-id="a7084-185">Open the `Web.config` file and add the following markup to the `<configSections>`:</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample3.xml)]

> [!NOTE]
> <span data-ttu-id="a7084-186">ASP.NET 1.x アプリケーションの ELMAH を構成する場合は、上の `<section>` の要素から `requirePermission="false"` 属性を削除します。</span><span class="sxs-lookup"><span data-stu-id="a7084-186">If you are configuring ELMAH for an ASP.NET 1.x application then remove the `requirePermission="false"` attribute from the `<section>` elements above.</span></span>

<span data-ttu-id="a7084-187">上記の構文では、カスタム `<elmah>` セクションとそのサブセクション (`<security>`、`<errorLog>`、`<errorMail>`、および `<errorFilter>`) が登録されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-187">The above syntax registers the custom `<elmah>` section and its subsections: `<security>`, `<errorLog>`, `<errorMail>`, and `<errorFilter>`.</span></span>

<span data-ttu-id="a7084-188">次に、`Web.config`に `<elmah>` セクションを追加します。</span><span class="sxs-lookup"><span data-stu-id="a7084-188">Next, add the `<elmah>` section to `Web.config`.</span></span> <span data-ttu-id="a7084-189">このセクションは、`<system.web>` 要素と同じレベルに表示されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-189">This section should appear at the same level as the `<system.web>` element.</span></span> <span data-ttu-id="a7084-190">`<elmah>` セクション内で、`<security>` と `<errorLog>` のセクションを次のように追加します。</span><span class="sxs-lookup"><span data-stu-id="a7084-190">Inside the `<elmah>` section add the `<security>` and `<errorLog>` sections like so:</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample4.xml)]

<span data-ttu-id="a7084-191">`<security>` セクションの `allowRemoteAccess` 属性は、リモートアクセスが許可されているかどうかを示します。</span><span class="sxs-lookup"><span data-stu-id="a7084-191">The `<security>` section's `allowRemoteAccess` attribute indicates whether remote access is allowed.</span></span> <span data-ttu-id="a7084-192">この値が0に設定されている場合、エラーログ web ページはローカルにのみ表示されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-192">If this value is set to 0, then the error log web page can only be viewed locally.</span></span> <span data-ttu-id="a7084-193">この属性が1に設定されている場合、リモートとローカルの両方のユーザーについて、エラーログ web ページが有効になります。</span><span class="sxs-lookup"><span data-stu-id="a7084-193">If this attribute is set to 1 then the error log web page is enabled for both remote and local visitors.</span></span> <span data-ttu-id="a7084-194">ここでは、リモート訪問者のエラーログ web ページを無効にしてみましょう。</span><span class="sxs-lookup"><span data-stu-id="a7084-194">For now, let's disable the error log web page for remote visitors.</span></span> <span data-ttu-id="a7084-195">セキュリティに関する考慮事項について説明した後、後でリモートアクセスを許可します。</span><span class="sxs-lookup"><span data-stu-id="a7084-195">We'll allow remote access later after we have an opportunity to discuss the security concerns of doing so.</span></span>

<span data-ttu-id="a7084-196">`<errorLog>` セクションでは、エラーの詳細が記録される場所を指定するエラーログのソースを定義します。これは、正常性監視システムの `<providers>` セクションに似ています。</span><span class="sxs-lookup"><span data-stu-id="a7084-196">The `<errorLog>` section defines the error log source, which dictates where the error details are recorded; it is similar to the `<providers>` section in the health monitoring system.</span></span> <span data-ttu-id="a7084-197">上記の構文では、エラーログソースとして `SqlErrorLog` クラスを指定しています。これにより、`connectionStringName` 属性値によって指定された Microsoft SQL Server データベースにエラーが記録されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-197">The above syntax specifies the `SqlErrorLog` class as the error log source, which logs the errors to a Microsoft SQL Server database specified by the `connectionStringName` attribute value.</span></span>

> [!NOTE]
> <span data-ttu-id="a7084-198">ELMAH には、XML ファイル、Microsoft Access データベース、Oracle データベース、およびその他のデータストアにエラーを記録するために使用できる追加のエラーログプロバイダーが付属しています。</span><span class="sxs-lookup"><span data-stu-id="a7084-198">ELMAH ships with additional error log providers that can be used to log errors to an XML file, a Microsoft Access database, an Oracle database, and other data stores.</span></span> <span data-ttu-id="a7084-199">これらの代替エラーログプロバイダーの使用方法については、ELMAH ダウンロードに含まれているサンプル `Web.config` ファイルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7084-199">Refer to the sample `Web.config` file that is included with the ELMAH download for information on how to use these alternate error log providers.</span></span>

### <a name="step-4-creating-the-error-log-source-infrastructure"></a><span data-ttu-id="a7084-200">手順 4: エラーログのソースインフラストラクチャの作成</span><span class="sxs-lookup"><span data-stu-id="a7084-200">Step 4: Creating the Error Log Source Infrastructure</span></span>

<span data-ttu-id="a7084-201">ELMAH の `SqlErrorLog` プロバイダーは、指定された Microsoft SQL Server データベースにエラーの詳細を記録します。</span><span class="sxs-lookup"><span data-stu-id="a7084-201">ELMAH's `SqlErrorLog` provider logs error details to a specified Microsoft SQL Server database.</span></span> <span data-ttu-id="a7084-202">`SqlErrorLog` プロバイダーは、このデータベースに `ELMAH_Error` という名前のテーブルと、`ELMAH_GetErrorsXml`、`ELMAH_GetErrorXml`、および `ELMAH_LogError`の3つのストアドプロシージャがあることを想定しています。</span><span class="sxs-lookup"><span data-stu-id="a7084-202">The `SqlErrorLog` provider expects this database to have a table named `ELMAH_Error` and three stored procedures: `ELMAH_GetErrorsXml`, `ELMAH_GetErrorXml`, and `ELMAH_LogError`.</span></span> <span data-ttu-id="a7084-203">ELMAH ダウンロードには、このテーブルとこれらのストアドプロシージャを作成するための T-sql を含む `db` フォルダーに `SQLServer.sql` という名前のファイルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-203">The ELMAH download includes a file named `SQLServer.sql` in the `db` folder that contains the T-SQL for creating this table and these stored procedures.</span></span> <span data-ttu-id="a7084-204">`SqlErrorLog` プロバイダーを使用するには、データベースで次のステートメントを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-204">You'll need to run these statements on your database to use the `SqlErrorLog` provider.</span></span>

<span data-ttu-id="a7084-205">**図 1**と**2**は、`SqlErrorLog` プロバイダーが必要とするデータベースオブジェクトが追加された後の Visual Studio のデータベースエクスプローラーを示しています。</span><span class="sxs-lookup"><span data-stu-id="a7084-205">**Figures 1** and **2** show the Database Explorer in Visual Studio after the database objects needed by the `SqlErrorLog` provider have been added.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image2.png)](logging-error-details-with-elmah-cs/_static/image1.png)

<span data-ttu-id="a7084-206">**図 1**: `SqlErrorLog` プロバイダーが `ELMAH_Error` テーブルにエラーを記録する</span><span class="sxs-lookup"><span data-stu-id="a7084-206">**Figure 1**: The `SqlErrorLog` Provider Logs Errors to the `ELMAH_Error` Table</span></span>

[![](logging-error-details-with-elmah-cs/_static/image4.png)](logging-error-details-with-elmah-cs/_static/image3.png)

<span data-ttu-id="a7084-207">**図 2**: `SqlErrorLog` プロバイダーが3つのストアドプロシージャを使用する</span><span class="sxs-lookup"><span data-stu-id="a7084-207">**Figure 2**: The `SqlErrorLog` Provider Uses Three Stored Procedures</span></span>

## <a name="elmah-in-action"></a><span data-ttu-id="a7084-208">ELMAH のアクション</span><span class="sxs-lookup"><span data-stu-id="a7084-208">ELMAH In Action</span></span>

<span data-ttu-id="a7084-209">この時点で、web アプリケーションに ELMAH を追加し、`ErrorLogModule` HTTP モジュールと `ErrorLogPageFactory` HTTP ハンドラーを登録し、`Web.config`で ELMAH の構成オプションを指定し、`SqlErrorLog` エラーログプロバイダーに必要なデータベースオブジェクトを追加しました。</span><span class="sxs-lookup"><span data-stu-id="a7084-209">At this point we have added ELMAH to the web application, registered the `ErrorLogModule` HTTP Module and the `ErrorLogPageFactory` HTTP Handler, specified ELMAH's configuration options in `Web.config`, and added the needed database objects for the `SqlErrorLog` error log provider.</span></span> <span data-ttu-id="a7084-210">これで、ELMAH の動作を確認する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="a7084-210">We are now ready to see ELMAH in action!</span></span> <span data-ttu-id="a7084-211">書籍のレビューの web サイトにアクセスし、`Genre.aspx?ID=foo`などの実行時エラーを生成するページや、`NoSuchPage.aspx`などの存在しないページにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="a7084-211">Visit the Book Reviews website and visit a page that generates a runtime error, such as `Genre.aspx?ID=foo`, or a non-existent page, such as `NoSuchPage.aspx`.</span></span> <span data-ttu-id="a7084-212">これらのページにアクセスしたときに表示される内容は、`<customErrors>` の構成と、ローカルまたはリモートのどちらにアクセスしているかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="a7084-212">What you see when visiting these pages depends on the `<customErrors>` configuration and whether you're visiting locally or remotely.</span></span> <span data-ttu-id="a7084-213">(このトピックについては、「 [*カスタムエラーページの表示*」チュートリアル](displaying-a-custom-error-page-cs.md)を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="a7084-213">(Refer back to the [*Displaying a Custom Error Page* tutorial](displaying-a-custom-error-page-cs.md) for a refresher on this topic.)</span></span>

<span data-ttu-id="a7084-214">ELMAH は、未処理の例外が発生したときにユーザーに表示される内容に影響しません。詳細をログに記録するだけです。</span><span class="sxs-lookup"><span data-stu-id="a7084-214">ELMAH doesn't affect what content is shown to the user when an unhandled exception occurs; it just logs its details.</span></span> <span data-ttu-id="a7084-215">このエラーログには、web サイトのルート (`http://localhost/BookReviews/elmah.axd`など) から `elmah.axd` web ページからアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="a7084-215">This error log is accessible from the web page `elmah.axd` from the root of your website, such as `http://localhost/BookReviews/elmah.axd`.</span></span> <span data-ttu-id="a7084-216">(このファイルはプロジェクトに物理的に存在しませんが、要求がに対して提供されると、ランタイムは、ブラウザーに返されたマークアップを生成する `ErrorLogPageFactory` HTTP ハンドラーに要求をディスパッチ `elmah.axd` ます)。</span><span class="sxs-lookup"><span data-stu-id="a7084-216">(This file does not physically exist in your project, but when a request comes in for `elmah.axd` the runtime dispatches it to the `ErrorLogPageFactory` HTTP Handler, which generates the markup sent back to the browser.)</span></span>

> [!NOTE]
> <span data-ttu-id="a7084-217">また、[`elmah.axd`] ページを使用して、ELMAH にテストエラーを生成するように指示することもできます。</span><span class="sxs-lookup"><span data-stu-id="a7084-217">You can also use the `elmah.axd` page to instruct ELMAH to generate a test error.</span></span> <span data-ttu-id="a7084-218">`elmah.axd/test` (のよう `http://localhost/BookReviews/elmah.axd/test`に) にアクセスすると、ELMAH は `Elmah.TestException`型の例外をスローします。これには、"これはテスト例外であり、無視しても安全です。" というエラーメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-218">Visiting `elmah.axd/test` (as in, `http://localhost/BookReviews/elmah.axd/test`) causes ELMAH to throw an exception of type `Elmah.TestException`, which has the error message: " This is a test exception that can be safely ignored."</span></span>

<span data-ttu-id="a7084-219">**図 3**は、開発環境から `elmah.axd` にアクセスするときのエラーログを示しています。</span><span class="sxs-lookup"><span data-stu-id="a7084-219">**Figure 3** shows the error log when visiting `elmah.axd` from the development environment.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image6.png)](logging-error-details-with-elmah-cs/_static/image5.png)

<span data-ttu-id="a7084-220">**図 3**: `Elmah.axd` Web ページのエラーログを表示する</span><span class="sxs-lookup"><span data-stu-id="a7084-220">**Figure 3**: `Elmah.axd` Displays the Error Log from a Web Page</span></span>  
<span data-ttu-id="a7084-221">([クリックすると、フルサイズの画像が表示](logging-error-details-with-elmah-cs/_static/image7.png)される)</span><span class="sxs-lookup"><span data-stu-id="a7084-221">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image7.png))</span></span>

<span data-ttu-id="a7084-222">**図 3**のエラーログには6つのエラーエントリが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-222">The error log in **Figure 3** contains six error entries.</span></span> <span data-ttu-id="a7084-223">各エントリには、HTTP 状態コード (これらのエラーの場合は404または 500)、種類、説明、エラーが発生したときにログオンしたユーザーの名前、および日付と時刻が含まれます。</span><span class="sxs-lookup"><span data-stu-id="a7084-223">Each entry includes the HTTP status code (404 or 500, for these errors), the type, the description, the name of the logged on user when the error occurred, and the date and time.</span></span> <span data-ttu-id="a7084-224">[詳細] リンクをクリックすると、エラーの詳細 (**図 4**を参照) に示されているのと同じエラーメッセージを含むページが、エラー発生時のサーバー変数の値と共に表示されます (**図 5**を参照)。</span><span class="sxs-lookup"><span data-stu-id="a7084-224">Clicking the Details link displays a page that includes the same error message shown in the Error Details Yellow Screen of Death (see **Figure 4**) along with the values of the server variables at the time of the error (see **Figure 5**).</span></span> <span data-ttu-id="a7084-225">また、エラーの詳細が保存されている未加工の XML を表示することもできます。これには、HTTP POST ヘッダーの値などの追加情報が含まれます。</span><span class="sxs-lookup"><span data-stu-id="a7084-225">You can also view the raw XML in which the error details are saved, which includes additional information such as the values in the HTTP POST header.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image9.png)](logging-error-details-with-elmah-cs/_static/image8.png)

<span data-ttu-id="a7084-226">**図 4**: エラーの詳細を表示する YSOD</span><span class="sxs-lookup"><span data-stu-id="a7084-226">**Figure 4**: View the Error Details YSOD</span></span>  
<span data-ttu-id="a7084-227">([クリックすると、フルサイズの画像が表示](logging-error-details-with-elmah-cs/_static/image10.png)される)</span><span class="sxs-lookup"><span data-stu-id="a7084-227">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image10.png))</span></span>

[![](logging-error-details-with-elmah-cs/_static/image12.png)](logging-error-details-with-elmah-cs/_static/image11.png)

<span data-ttu-id="a7084-228">**図 5**: エラー発生時のサーバー変数コレクションの値を調べる</span><span class="sxs-lookup"><span data-stu-id="a7084-228">**Figure 5**: Explore the Values of the Server Variables Collection at the Time of the Error</span></span>  
<span data-ttu-id="a7084-229">([クリックすると、フルサイズの画像が表示](logging-error-details-with-elmah-cs/_static/image13.png)される)</span><span class="sxs-lookup"><span data-stu-id="a7084-229">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image13.png))</span></span>

<span data-ttu-id="a7084-230">運用 web サイトに ELMAH をデプロイするには、次のことが伴います。</span><span class="sxs-lookup"><span data-stu-id="a7084-230">Deploying ELMAH to the production website entails:</span></span>

- <span data-ttu-id="a7084-231">運用環境の `Bin` フォルダーに `Elmah.dll` ファイルをコピーする</span><span class="sxs-lookup"><span data-stu-id="a7084-231">Copying the `Elmah.dll` file to the `Bin` folder on production,</span></span>
- <span data-ttu-id="a7084-232">運用環境で使用される `Web.config` ファイルに ELMAH 固有の構成設定をコピーする</span><span class="sxs-lookup"><span data-stu-id="a7084-232">Copying the ELMAH-specific configuration settings to the `Web.config` file used on production, and</span></span>
- <span data-ttu-id="a7084-233">運用データベースにエラーログソースインフラストラクチャを追加します。</span><span class="sxs-lookup"><span data-stu-id="a7084-233">Adding the error log source infrastructure to the production database.</span></span>

<span data-ttu-id="a7084-234">前のチュートリアルでは、開発から運用にファイルをコピーするための手法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="a7084-234">We've explored techniques for copying files from development to production in previous tutorials.</span></span> <span data-ttu-id="a7084-235">実稼働データベースでエラーログソースインフラストラクチャを取得する最も簡単な方法は、SQL Server Management Studio を使用して運用データベースに接続し、`SqlServer.sql` スクリプトファイルを実行して、必要なテーブルとストアドプロシージャを作成することです。</span><span class="sxs-lookup"><span data-stu-id="a7084-235">Perhaps the easiest way to get the error log source infrastructure on the production database is to use SQL Server Management Studio to connect to the production database and then execute the `SqlServer.sql` script file, which will create the needed table and stored procedures.</span></span>

### <a name="viewing-the-error-details-page-on-production"></a><span data-ttu-id="a7084-236">運用環境のエラーの詳細ページを表示する</span><span class="sxs-lookup"><span data-stu-id="a7084-236">Viewing the Error Details Page on Production</span></span>

<span data-ttu-id="a7084-237">サイトを運用環境にデプロイしたら、運用 web サイトにアクセスして、未処理の例外を生成します。</span><span class="sxs-lookup"><span data-stu-id="a7084-237">After deploying your site to production, visit the production website and generate an unhandled exception.</span></span> <span data-ttu-id="a7084-238">開発環境と同様に、ELMAH は、未処理の例外が発生したときに表示されるエラーページには影響しません。代わりに、エラーをログに記録するだけです。</span><span class="sxs-lookup"><span data-stu-id="a7084-238">As in the development environment, ELMAH has no affect on the error page displayed when an unhandled exception occurs; instead, it merely logs the error.</span></span> <span data-ttu-id="a7084-239">運用環境からエラーログページ (`elmah.axd`) にアクセスしようとすると、**図 6**に示されている禁止ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-239">If you attempt to visit the error log page (`elmah.axd`) from the production environment, you will be greeted with the Forbidden page shown in **Figure 6**.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image15.png)](logging-error-details-with-elmah-cs/_static/image14.png)

<span data-ttu-id="a7084-240">**図 6**: 既定では、リモート訪問者がエラーログ Web ページを表示できない</span><span class="sxs-lookup"><span data-stu-id="a7084-240">**Figure 6**: By Default, Remote Visitors Cannot View the Error Log Web Page</span></span>  
<span data-ttu-id="a7084-241">([クリックすると、フルサイズの画像が表示](logging-error-details-with-elmah-cs/_static/image16.png)される)</span><span class="sxs-lookup"><span data-stu-id="a7084-241">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image16.png))</span></span>

<span data-ttu-id="a7084-242">ELMAH 構成の `<security>` セクションでは、`allowRemoteAccess` 属性を0に設定しています。これにより、リモートユーザーがエラーログを表示することが禁止されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-242">Recall that in the ELMAH configuration's `<security>` section we set the `allowRemoteAccess` attribute to 0, which prohibits remote users from viewing the error log.</span></span> <span data-ttu-id="a7084-243">エラーの詳細によってセキュリティの脆弱性やその他の機密情報が明らかになる可能性があるので、匿名の訪問者がエラーログを表示できないようにすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="a7084-243">It's important to prohibit anonymous visitors from viewing the error log, as the error details might reveal security vulnerabilities or other sensitive information.</span></span> <span data-ttu-id="a7084-244">この属性を1に設定して、エラーログへのリモートアクセスを有効にする場合は、承認されたユーザーのみがアクセスできるように `elmah.axd` パスをロックすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="a7084-244">If you decide to set this attribute to 1 and enable remote access to the error log then it is important to lock down the `elmah.axd` path so that only authorized visitors can access it.</span></span> <span data-ttu-id="a7084-245">これは、`Web.config` ファイルに `<location>` 要素を追加することによって実現できます。</span><span class="sxs-lookup"><span data-stu-id="a7084-245">This can be achieved by adding a `<location>` element to the `Web.config` file.</span></span>

<span data-ttu-id="a7084-246">次の構成では、管理者ロールのユーザーのみがエラーログ web ページにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="a7084-246">The following configuration permits only users in the Admin role to access the error log web page:</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample5.xml)]

> [!NOTE]
> <span data-ttu-id="a7084-247">管理者ロールとシステムの3人のユーザー (Scott、Jisun、および Alice) は、アプリケーションサービスチュートリアルを使用した[ *web サイトの構成*](configuring-a-website-that-uses-application-services-cs.md)に追加されました。</span><span class="sxs-lookup"><span data-stu-id="a7084-247">The Admin role and the three users in the system - Scott, Jisun, and Alice - were added in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-cs.md).</span></span> <span data-ttu-id="a7084-248">Scott および Jisun というユーザーは、管理者ロールのメンバーです。</span><span class="sxs-lookup"><span data-stu-id="a7084-248">Users Scott and Jisun are members of the Admin role.</span></span> <span data-ttu-id="a7084-249">認証と承認の詳細については、 [Web サイトのセキュリティ](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)に関するチュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7084-249">For more information on authentication and authorization, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

<span data-ttu-id="a7084-250">これで、運用環境のエラーログをリモートユーザーが表示できるようになりました。エラーログ web ページのスクリーンショットについては、**図 3**、 **4**、および**5**を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7084-250">The error log on the production environment can now be viewed by remote users; refer back to **Figures 3**, **4**, and **5** for screen shots of the error log web page.</span></span> <span data-ttu-id="a7084-251">ただし、匿名ユーザーまたは管理者以外のユーザーがエラーログページを表示しようとすると、**図 7**に示すように、ログインページ (`Login.aspx`) に自動的にリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="a7084-251">However, if an anonymous or non-Admin user attempts to view the error log page they are automatically redirected to the login page (`Login.aspx`), as **Figure 7** shows.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image18.png)](logging-error-details-with-elmah-cs/_static/image17.png)

<span data-ttu-id="a7084-252">**図 7**: 承認されていないユーザーがログインページに自動的にリダイレクトされる</span><span class="sxs-lookup"><span data-stu-id="a7084-252">**Figure 7**: Unauthorized Users are Automatically Redirected to the Login Page</span></span>  
<span data-ttu-id="a7084-253">([クリックすると、フルサイズの画像が表示](logging-error-details-with-elmah-cs/_static/image19.png)される)</span><span class="sxs-lookup"><span data-stu-id="a7084-253">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image19.png))</span></span>

### <a name="programmatically-logging-errors"></a><span data-ttu-id="a7084-254">プログラムによるエラーのログ記録</span><span class="sxs-lookup"><span data-stu-id="a7084-254">Programmatically Logging Errors</span></span>

<span data-ttu-id="a7084-255">ELMAH の `ErrorLogModule` HTTP モジュールは、未処理の例外を指定されたログソースに自動的に記録します。</span><span class="sxs-lookup"><span data-stu-id="a7084-255">ELMAH's `ErrorLogModule` HTTP Module automatically logs unhandled exceptions to the specified log source.</span></span> <span data-ttu-id="a7084-256">または、`ErrorSignal` クラスとその `Raise` メソッドを使用して、ハンドルされない例外を発生させずにエラーをログに記録することもできます。</span><span class="sxs-lookup"><span data-stu-id="a7084-256">Alternatively, you can log an error without having to raise an unhandled exception by using the `ErrorSignal` class and its `Raise` method.</span></span> <span data-ttu-id="a7084-257">`Raise` メソッドには `Exception` オブジェクトが渡され、その例外がスローされ、処理されずに ASP.NET ランタイムに到達したかのようにログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-257">The `Raise` method is passed an `Exception` object and logs it as if that exception had been thrown and had reached the ASP.NET runtime without being handled.</span></span> <span data-ttu-id="a7084-258">ただし、`Raise` メソッドが呼び出された後も要求は正常に実行されますが、スローされた未処理の例外によって要求の通常の実行が中断され、ASP.NET ランタイムによって構成されたエラーページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-258">The difference, however, is that the request continues executing normally after the `Raise` method has been called, whereas a thrown, unhandled exception interrupts the request's normal execution and causes the ASP.NET runtime to display the configured error page.</span></span>

<span data-ttu-id="a7084-259">`ErrorSignal` クラスは、何らかのアクションが失敗する可能性がある場合に便利ですが、実行されている操作全体の致命的なエラーではありません。</span><span class="sxs-lookup"><span data-stu-id="a7084-259">The `ErrorSignal` class is useful in situations where there is some action that may fail, but its failure is not catastrophic to the overall operation being performed.</span></span> <span data-ttu-id="a7084-260">たとえば、web サイトには、ユーザーの入力を取得してデータベースに格納し、その情報が処理されたことを知らせる電子メールをユーザーに送信するフォームが含まれている場合があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-260">For instance, a website may contain a form that takes the user's input, stores it in a database, and then sends the user an email informing them that they information was processed.</span></span> <span data-ttu-id="a7084-261">情報がデータベースに正常に保存されても、電子メールメッセージの送信時にエラーが発生する場合はどうすればよいですか。</span><span class="sxs-lookup"><span data-stu-id="a7084-261">What should happen if the information is saved to the database successfully, but there is an error when sending the email message?</span></span> <span data-ttu-id="a7084-262">1つの方法として、例外をスローして、そのユーザーをエラーページに送信する方法があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-262">One option would be to throw an exception and send the user to the error page.</span></span> <span data-ttu-id="a7084-263">ただし、ユーザーが入力した情報が保存されていないと思われることがあります。</span><span class="sxs-lookup"><span data-stu-id="a7084-263">However, this might confuse the user into thinking that the information they entered was not saved.</span></span> <span data-ttu-id="a7084-264">別の方法として、電子メール関連のエラーをログに記録する方法もありますが、ユーザーの操作を変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="a7084-264">Another approach would be to log the email-related error, but not alter the user's experience in any way.</span></span> <span data-ttu-id="a7084-265">ここでは、`ErrorSignal` クラスが役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="a7084-265">This is where the `ErrorSignal` class is useful.</span></span>

[!code-csharp[Main](logging-error-details-with-elmah-cs/samples/sample6.cs)]

## <a name="error-notification-via-email"></a><span data-ttu-id="a7084-266">電子メールによるエラー通知</span><span class="sxs-lookup"><span data-stu-id="a7084-266">Error Notification Via Email</span></span>

<span data-ttu-id="a7084-267">エラーの詳細を指定された受信者に電子メールで送信するように、データベースにエラーを記録することもできます。</span><span class="sxs-lookup"><span data-stu-id="a7084-267">Along with logging errors to a database, ELMAH can also be configured to email error details to a specified recipient.</span></span> <span data-ttu-id="a7084-268">この機能は `ErrorMailModule` HTTP モジュールによって提供されます。そのため、エラーの詳細を電子メールで送信するには、この HTTP モジュールを `Web.config` に登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-268">This functionality is provided by the `ErrorMailModule` HTTP Module; therefore, you must register this HTTP Module in `Web.config` in order to send error details via email.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample7.xml)]

<span data-ttu-id="a7084-269">次に、電子メールの送信者と受信者、件名、および電子メールが非同期に送信されるかどうかを示す `<elmah>` 要素の `<errorMail>` セクションに、エラーの電子メールに関する情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="a7084-269">Next, specify information about the error email in the `<elmah>` element's `<errorMail>` section, indicating the email's sender and recipient, the subject, and whether the email is sent asynchronously.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample8.xml)]

<span data-ttu-id="a7084-270">上記の設定を適用すると、実行時エラーが発生するたびに、エラーの詳細と共に support@example.com に電子メールが送信されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-270">With the above settings in place, whenever a runtime error occurs ELMAH sends an email to support@example.com with the error details.</span></span> <span data-ttu-id="a7084-271">ELMAH のエラーメールには、エラーの詳細 web ページ、エラーメッセージ、スタックトレース、およびサーバー変数 (**図 4**および**5**を参照) に表示されているものと同じ情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-271">ELMAH's error email includes the same information shown in the error details web page, namely the error message, the stack trace, and the server variables (refer back to **Figures 4** and **5**).</span></span> <span data-ttu-id="a7084-272">エラーメールには、例外の詳細も添付ファイルとしてのデスコンテンツ (`YSOD.html`) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-272">The error email also includes the Exception Details Yellow Screen of Death content as an attachment (`YSOD.html`).</span></span>

<span data-ttu-id="a7084-273">**図 8**に、`Genre.aspx?ID=foo`にアクセスして生成された ELMAH のエラーメールを示します。</span><span class="sxs-lookup"><span data-stu-id="a7084-273">**Figure 8** shows ELMAH's error email generated by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="a7084-274">**図 8**はエラーメッセージとスタックトレースのみを示していますが、サーバー変数は電子メールの本文にさらに下に含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-274">While **Figure 8** shows only the error message and stack trace, the server variables are included further down in the email's body.</span></span>

[![](logging-error-details-with-elmah-cs/_static/image21.png)](logging-error-details-with-elmah-cs/_static/image20.png)

<span data-ttu-id="a7084-275">**図 8**: ELMAH でエラーの詳細を電子メールで送信するように構成する</span><span class="sxs-lookup"><span data-stu-id="a7084-275">**Figure 8**: You Can Configure ELMAH To Send Error Details Via Email</span></span>  
<span data-ttu-id="a7084-276">([クリックすると、フルサイズの画像が表示](logging-error-details-with-elmah-cs/_static/image22.png)される)</span><span class="sxs-lookup"><span data-stu-id="a7084-276">([Click to view full-size image](logging-error-details-with-elmah-cs/_static/image22.png))</span></span>

## <a name="only-logging-errors-of-interest"></a><span data-ttu-id="a7084-277">目的のエラーのみをログに記録する</span><span class="sxs-lookup"><span data-stu-id="a7084-277">Only Logging Errors Of Interest</span></span>

<span data-ttu-id="a7084-278">既定では、ELMAH は、404などの HTTP エラーを含む、未処理のすべての例外の詳細をログに記録します。</span><span class="sxs-lookup"><span data-stu-id="a7084-278">By default, ELMAH logs the details of every unhandled exception, including 404 and other HTTP errors.</span></span> <span data-ttu-id="a7084-279">エラーフィルタリングを使用して、これらのエラーやその他の種類のエラーを無視するように ELMAH に指示できます。</span><span class="sxs-lookup"><span data-stu-id="a7084-279">You can instruct ELMAH to ignore these or other types of errors using error filtering.</span></span> <span data-ttu-id="a7084-280">フィルター処理ロジックは、ELMAH の `ErrorFilterModule` HTTP モジュールによって実行されます。フィルター処理ロジックを使用するには、`Web.config` に登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-280">The filtering logic is performed by ELMAH's `ErrorFilterModule` HTTP Module, which you'll need to register in `Web.config` in order to use the filtering logic.</span></span> <span data-ttu-id="a7084-281">フィルター処理の規則は、[`<errorFilter>`] セクションで指定します。</span><span class="sxs-lookup"><span data-stu-id="a7084-281">The rules for filtering are specified in the `<errorFilter>` section.</span></span>

<span data-ttu-id="a7084-282">次のマークアップは、エラー404をログに記録しないように ELMAH に指示します。</span><span class="sxs-lookup"><span data-stu-id="a7084-282">The following markup instructs ELMAH to not log 404 errors.</span></span>

[!code-xml[Main](logging-error-details-with-elmah-cs/samples/sample9.xml)]

> [!NOTE]
> <span data-ttu-id="a7084-283">エラーフィルターを使用するには、`ErrorFilterModule` HTTP モジュールを登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7084-283">Don't forget, in order to use error filtering you must register the `ErrorFilterModule` HTTP Module.</span></span>

<span data-ttu-id="a7084-284">`<test>` セクション内の `<equal>` 要素は、アサーションと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="a7084-284">The `<equal>` element inside the `<test>` section is referred to as an assertion.</span></span> <span data-ttu-id="a7084-285">アサーションが true と評価された場合、エラーは ELMAH のログからフィルター処理されます。</span><span class="sxs-lookup"><span data-stu-id="a7084-285">If the assertion evaluates to true then the error is filtered from ELMAH's log.</span></span> <span data-ttu-id="a7084-286">使用できるアサーションは、`<greater>`、`<greater-or-equal>`、`<not-equal>`、`<lesser>`、`<lesser-or-equal>`などです。</span><span class="sxs-lookup"><span data-stu-id="a7084-286">There are other assertions available, including: `<greater>`, `<greater-or-equal>`, `<not-equal>`, `<lesser>`, `<lesser-or-equal>`, and so on.</span></span> <span data-ttu-id="a7084-287">また、`<and>` と `<or>` ブール演算子を使用してアサーションを組み合わせることもできます。</span><span class="sxs-lookup"><span data-stu-id="a7084-287">You can also combine assertions using the `<and>` and `<or>` Boolean operators.</span></span> <span data-ttu-id="a7084-288">さらに、単純な JavaScript 式をアサーションとして含めることも、独自のアサーションをまたはC# Visual Basic に記述することもできます。</span><span class="sxs-lookup"><span data-stu-id="a7084-288">What's more, you can even include a simple JavaScript expression as an assertion, or write your own assertions in C# or Visual Basic.</span></span>

<span data-ttu-id="a7084-289">ELMAH のエラーフィルタリング機能の詳細については、 [elmah wiki](https://code.google.com/p/elmah/w/list)の[「エラーのフィルター処理」セクション](https://code.google.com/p/elmah/wiki/ErrorFiltering)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7084-289">For more information on ELMAH's error filtering capabilities, refer to the [Error Filtering section](https://code.google.com/p/elmah/wiki/ErrorFiltering) in the [ELMAH wiki](https://code.google.com/p/elmah/w/list).</span></span>

## <a name="summary"></a><span data-ttu-id="a7084-290">要約</span><span class="sxs-lookup"><span data-stu-id="a7084-290">Summary</span></span>

<span data-ttu-id="a7084-291">ELMAH は、ASP.NET web アプリケーションのエラーをログに記録するためのシンプルで、かつ強力なメカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="a7084-291">ELMAH provides a simple, yet powerful mechanism for logging errors in an ASP.NET web application.</span></span> <span data-ttu-id="a7084-292">Microsoft の正常性監視システムと同様に、ELMAH はデータベースにエラーを記録し、電子メールでエラーの詳細を開発者に送信することができます。</span><span class="sxs-lookup"><span data-stu-id="a7084-292">Like Microsoft's health monitoring system, ELMAH can log errors to a database and can send the error details to a developer via email.</span></span> <span data-ttu-id="a7084-293">正常性監視システムとは異なり、ELMAH には、Microsoft SQL Server、Microsoft Access、Oracle、XML ファイルなど、さまざまな種類のエラーログデータストアの既定のサポートが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a7084-293">Unlike the health monitoring system, ELMAH includes out of the box support for a wider range of error log data stores, including: Microsoft SQL Server, Microsoft Access, Oracle, XML files, and several others.</span></span> <span data-ttu-id="a7084-294">また、ELMAH には、エラーログと、web ページからの特定のエラーに関する詳細情報を表示するための組み込みのメカニズムが用意されています (`elmah.axd`)。</span><span class="sxs-lookup"><span data-stu-id="a7084-294">Moreover, ELMAH offers a built-in mechanism for viewing the error log and details about a specific error from a web page, `elmah.axd`.</span></span> <span data-ttu-id="a7084-295">また、[`elmah.axd`] ページでは、エラー情報を RSS フィードまたはコンマ区切り値ファイル (CSV) として表示することもできます。このファイルは、Microsoft Excel を使用して読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="a7084-295">The `elmah.axd` page can also render error information as an RSS feed or as a comma-separated value file (CSV), which you can read using Microsoft Excel.</span></span> <span data-ttu-id="a7084-296">また、宣言型またはプログラムによるアサーションを使用して、ログからのエラーをフィルター処理するように ELMAH に指示することもできます。</span><span class="sxs-lookup"><span data-stu-id="a7084-296">You can also instruct ELMAH to filter errors from the log using declarative or programmatic assertions.</span></span> <span data-ttu-id="a7084-297">および ELMAH は、ASP.NET バージョン1.x アプリケーションで使用できます。</span><span class="sxs-lookup"><span data-stu-id="a7084-297">And ELMAH can be used with ASP.NET version 1.x applications.</span></span>

<span data-ttu-id="a7084-298">配置されたすべてのアプリケーションには、未処理の例外を自動的にログに記録し、開発チームに通知を送信するためのメカニズムが必要です。</span><span class="sxs-lookup"><span data-stu-id="a7084-298">Every deployed application should have some mechanism for automatically logging unhandled exceptions and sending notification to the development team.</span></span> <span data-ttu-id="a7084-299">正常性の監視を使用して実行するか、または ELMAH をセカンダリにするかを指定します。</span><span class="sxs-lookup"><span data-stu-id="a7084-299">Whether this is accomplished using health monitoring or ELMAH is secondary.</span></span> <span data-ttu-id="a7084-300">つまり、正常性の監視と ELMAH のどちらを使用するかに関係なく、両方のシステムを評価し、ニーズに最も合ったものを選択します。</span><span class="sxs-lookup"><span data-stu-id="a7084-300">In other words, it doesn't really matter much whether you use health monitoring or ELMAH; evaluate both systems and then choose the one that best fits your needs.</span></span> <span data-ttu-id="a7084-301">根本的に重要なのは、運用環境でハンドルされない例外をログに記録するメカニズムがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="a7084-301">What is fundamentally important is that some mechanism be put in place to log unhandled exceptions in the production environment.</span></span>

<span data-ttu-id="a7084-302">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="a7084-302">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="a7084-303">関連項目</span><span class="sxs-lookup"><span data-stu-id="a7084-303">Further Reading</span></span>

<span data-ttu-id="a7084-304">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="a7084-304">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="a7084-305">ELMAH-エラーログモジュールとハンドラー</span><span class="sxs-lookup"><span data-stu-id="a7084-305">ELMAH - Error Logging Modules and Handlers</span></span>](http://dotnetslackers.com/articles/aspnet/ErrorLoggingModulesAndHandlers.aspx)
- <span data-ttu-id="a7084-306">[ELMAH プロジェクトページ](https://code.google.com/p/elmah/)(ソースコード、サンプル、wiki)</span><span class="sxs-lookup"><span data-stu-id="a7084-306">[ELMAH Project Page](https://code.google.com/p/elmah/) (source code, samples, wiki)</span></span>
- <span data-ttu-id="a7084-307">[Web アプリケーションに ELMAH をプラグインして未処理の例外をキャッチする](http://screencastaday.com/ScreenCasts/43_Plugging_Elmah_into_Web_Application_to_Catch_Unhandled_Exceptions.aspx)(ビデオ)</span><span class="sxs-lookup"><span data-stu-id="a7084-307">[Plugging ELMAH Into a Web Application to Catch Unhandled Exceptions](http://screencastaday.com/ScreenCasts/43_Plugging_Elmah_into_Web_Application_to_Catch_Unhandled_Exceptions.aspx) (video)</span></span>
- [<span data-ttu-id="a7084-308">セキュリティエラーログページ</span><span class="sxs-lookup"><span data-stu-id="a7084-308">Security Error Log Pages</span></span>](https://code.google.com/p/elmah/wiki/SecuringErrorLogPages)
- [<span data-ttu-id="a7084-309">HTTP モジュールとハンドラーを使用してプラグ可能な ASP.NET コンポーネントを作成する</span><span class="sxs-lookup"><span data-stu-id="a7084-309">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="a7084-310">Web サイトのセキュリティに関するチュートリアル</span><span class="sxs-lookup"><span data-stu-id="a7084-310">Website Security Tutorials</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)

> [!div class="step-by-step"]
> <span data-ttu-id="a7084-311">[前へ](logging-error-details-with-asp-net-health-monitoring-cs.md)
> [次へ](precompiling-your-website-cs.md)</span><span class="sxs-lookup"><span data-stu-id="a7084-311">[Previous](logging-error-details-with-asp-net-health-monitoring-cs.md)
[Next](precompiling-your-website-cs.md)</span></span>
