---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-vb
title: ASP.NET Health Monitoring を使用してエラーの詳細をログに記録する (VB) |Microsoft Docs
author: rick-anderson
description: Microsoft の正常性監視システムは、ハンドルされない例外など、さまざまな web イベントをログに記録するための簡単でカスタマイズ可能な方法を提供します。 このチュートリアルでは、そのについて説明します。
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 09a6c74e-936a-4c04-8547-5bb313a4e4a3
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-vb
msc.type: authoredcontent
ms.openlocfilehash: f57aca41771adfd9a7c7f38da1916db9197262da
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74587832"
---
# <a name="logging-error-details-with-aspnet-health-monitoring-vb"></a><span data-ttu-id="9ae64-104">ASP.NET の状態監視でエラーの詳細をログに記録する (VB)</span><span class="sxs-lookup"><span data-stu-id="9ae64-104">Logging Error Details with ASP.NET Health Monitoring (VB)</span></span>

<span data-ttu-id="9ae64-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9ae64-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9ae64-106">[コードのダウンロード](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_VB.zip)または[PDF のダウンロード](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="9ae64-106">[Download Code](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_VB.zip) or [Download PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_vb.pdf)</span></span>

> <span data-ttu-id="9ae64-107">Microsoft の正常性監視システムは、ハンドルされない例外など、さまざまな web イベントをログに記録するための簡単でカスタマイズ可能な方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-107">Microsoft's health monitoring system provides an easy and customizable way to log various web events, including unhandled exceptions.</span></span> <span data-ttu-id="9ae64-108">このチュートリアルでは、未処理の例外をデータベースに記録し、電子メールメッセージを使用して開発者に通知するように、正常性監視システムを設定する手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-108">This tutorial walks through setting up the health monitoring system to log unhandled exceptions to a database and to notify developers via an email message.</span></span>

## <a name="introduction"></a><span data-ttu-id="9ae64-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="9ae64-109">Introduction</span></span>

<span data-ttu-id="9ae64-110">ログ記録は、デプロイされたアプリケーションの正常性を監視し、発生する可能性のある問題を診断するのに便利なツールです。</span><span class="sxs-lookup"><span data-stu-id="9ae64-110">Logging is a useful tool for monitoring the health of a deployed application and for diagnosing any problems that may arise.</span></span> <span data-ttu-id="9ae64-111">配置されたアプリケーションで発生したエラーを記録して、問題を解決できるようにすることは、特に重要です。</span><span class="sxs-lookup"><span data-stu-id="9ae64-111">It is especially important to log errors that occur in a deployed application so that they can be remedied.</span></span> <span data-ttu-id="9ae64-112">ASP.NET アプリケーションでハンドルされない例外が発生するたびに、`Error` イベントが発生します。[前のチュートリアル](processing-unhandled-exceptions-vb.md)では、`Error` イベントのイベントハンドラーを作成して、エラーを開発者に通知し、その詳細をログに記録する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="9ae64-112">The `Error` event is raised whenever an unhandled exception occurs in an ASP.NET application; the [preceding tutorial](processing-unhandled-exceptions-vb.md) showed how to notify a developer of an error and log its details by creating an event handler for the `Error` event.</span></span> <span data-ttu-id="9ae64-113">ただし、このタスクは ASP で実行できるため、エラーの詳細を記録し、開発者に通知するための `Error` イベントハンドラーを作成する必要はありません。NET の*正常性監視システム*。</span><span class="sxs-lookup"><span data-stu-id="9ae64-113">However, creating an `Error` event handler to log the error's details and notify a developer is unnecessary, as this task can be performed by ASP.NET's *health monitoring system*.</span></span>

<span data-ttu-id="9ae64-114">正常性監視システムは ASP.NET 2.0 で導入され、アプリケーションまたは要求の有効期間中に発生するイベントをログに記録することによって、デプロイされた ASP.NET アプリケーションの正常性を監視するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-114">The health monitoring system was introduced in ASP.NET 2.0 and is designed to monitor the health of a deployed ASP.NET application by logging events that occur during the application or request's lifetime.</span></span> <span data-ttu-id="9ae64-115">正常性監視システムによってログに記録されるイベントは、*正常性監視イベント*または*Web イベント*と呼ばれ、次のものが含まれます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-115">The events logged by the health monitoring system are referred to as *health monitoring events* or *Web events*, and include:</span></span>

- <span data-ttu-id="9ae64-116">アプリケーションの有効期間イベント (アプリケーションの開始時や停止時など)</span><span class="sxs-lookup"><span data-stu-id="9ae64-116">Application lifetime events, such as when an application starts or stops</span></span>
- <span data-ttu-id="9ae64-117">失敗したログイン試行と失敗した URL 承認要求を含むセキュリティイベント</span><span class="sxs-lookup"><span data-stu-id="9ae64-117">Security events, including failed login attempts and failed URL authorization requests</span></span>
- <span data-ttu-id="9ae64-118">他の種類のエラーの中で、ハンドルされない例外、ビューステート解析例外、要求検証例外、コンパイルエラーなど、アプリケーションエラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-118">Application errors, including unhandled exceptions, view state parsing exceptions, request validation exceptions, and compilation errors, among other types of errors.</span></span>

<span data-ttu-id="9ae64-119">正常性監視イベントが発生すると、指定した任意の数の*ログソースにログ*を記録できます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-119">When a health monitoring event is raised it can be logged to any number of specified *log sources*.</span></span> <span data-ttu-id="9ae64-120">正常性監視システムには、Microsoft SQL Server データベース、Windows イベントログ、または電子メールメッセージを使用して、Web イベントをログに記録するログソースが付属しています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-120">The health monitoring system ships with log sources that log Web events to a Microsoft SQL Server database, to the Windows Event Log, or via an email message, among others.</span></span> <span data-ttu-id="9ae64-121">独自のログソースを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-121">You can also create your own log sources.</span></span>

<span data-ttu-id="9ae64-122">正常性監視システムログが使用されているログソースと共に、`Web.config`で定義されているイベント。</span><span class="sxs-lookup"><span data-stu-id="9ae64-122">The events the health monitoring system logs, along with the log sources used, are defined in `Web.config`.</span></span> <span data-ttu-id="9ae64-123">構成マークアップが数行あるので、正常性監視を使用して、未処理の例外をすべてデータベースに記録し、電子メールで例外を通知することができます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-123">With a few lines of configuration markup you can use health monitoring to log all unhandled exceptions to a database and to notify you of the exception via email.</span></span>

## <a name="exploring-the-health-monitoring-systems-configuration"></a><span data-ttu-id="9ae64-124">正常性監視システムの構成の調査</span><span class="sxs-lookup"><span data-stu-id="9ae64-124">Exploring the Health Monitoring System's Configuration</span></span>

<span data-ttu-id="9ae64-125">正常性監視システムの動作は、構成情報によって定義されます。これは、`Web.config`の[`<healthMonitoring>` 要素](https://msdn.microsoft.com/library/2fwh2ss9.aspx)にあります。</span><span class="sxs-lookup"><span data-stu-id="9ae64-125">The health monitoring system's behavior is defined by its configuration information, which is located in the [`<healthMonitoring>` element](https://msdn.microsoft.com/library/2fwh2ss9.aspx) in `Web.config`.</span></span> <span data-ttu-id="9ae64-126">この構成セクションでは、特に次の3つの重要な情報を定義します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-126">This configuration section defines, among other things, the following three important pieces of information:</span></span>

1. <span data-ttu-id="9ae64-127">発生した正常性監視イベントは、ログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-127">The health monitoring events that, when raised, should be logged,</span></span>
2. <span data-ttu-id="9ae64-128">ログソース</span><span class="sxs-lookup"><span data-stu-id="9ae64-128">The log sources, and</span></span>
3. <span data-ttu-id="9ae64-129">(1) で定義されている各正常性監視イベントを、(2) で定義されているログソースにマップする方法。</span><span class="sxs-lookup"><span data-stu-id="9ae64-129">How each health monitoring event defined in (1) is mapped to the log sources defined in (2).</span></span>

<span data-ttu-id="9ae64-130">この情報は、3つの子構成要素 ( [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx)、 [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx)、および[`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx)) を使用して指定します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-130">This information is specified through three children configuration elements: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx), and [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectively.</span></span>

<span data-ttu-id="9ae64-131">既定の正常性監視システムの構成情報は、`%WINDIR%\Microsoft.NET\Framework\version\CONFIG` フォルダーの `Web.config` ファイルにあります。</span><span class="sxs-lookup"><span data-stu-id="9ae64-131">The default health monitoring system configuration information can be found in the `Web.config` file in `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` folder.</span></span> <span data-ttu-id="9ae64-132">この既定の構成情報は、簡略化のために一部のマークアップが削除されたものです。以下に示します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-132">This default configuration information, with some markup removed for brevity, is shown below:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample1.xml)]

<span data-ttu-id="9ae64-133">対象の正常性監視イベントは、`<eventMappings>` 要素で定義されます。これにより、状態監視イベントのクラスにわかりやすい名前が付けられます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-133">The health monitoring events of interest are defined in the `<eventMappings>` element, which gives a human-friendly name to a class of health monitoring events.</span></span> <span data-ttu-id="9ae64-134">上のマークアップでは、`<eventMappings>` 要素によって、種類が `WebBaseErrorEvent` の正常性監視イベントに "すべてのエラー" という名前のユーザーフレンドリ名と、`WebFailureAuditEvent`種類の正常性監視イベントに "失敗の監査" という名前が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-134">In the markup above, the `<eventMappings>` element assigns the human-friendly name "All Errors" to the health monitoring events of type `WebBaseErrorEvent` and the name "Failure Audits" to health monitoring events of type `WebFailureAuditEvent`.</span></span>

<span data-ttu-id="9ae64-135">`<providers>` 要素は、ログソースを定義し、ユーザーにわかりやすい名前を付けて、ログソース固有の構成情報を指定します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-135">The `<providers>` element defines the log sources, giving them a human-friendly name and specifying any log source-specific configuration information.</span></span> <span data-ttu-id="9ae64-136">最初の `<add>` 要素は、"EventLogProvider" プロバイダーを定義します。このプロバイダーは、`EventLogWebEventProvider` クラスを使用して、指定された正常性監視イベントをログに記録します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-136">The first `<add>` element defines the "EventLogProvider" provider, which logs the specified health monitoring events using the `EventLogWebEventProvider` class.</span></span> <span data-ttu-id="9ae64-137">`EventLogWebEventProvider` クラスは、イベントを Windows イベントログに記録します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-137">The `EventLogWebEventProvider` class logs the event to the Windows Event Log.</span></span> <span data-ttu-id="9ae64-138">2番目の `<add>` 要素は、"SqlWebEventProvider" プロバイダーを定義します。このプロバイダーは、`SqlWebEventProvider` クラスを使用して、Microsoft SQL Server データベースにイベントを記録します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-138">The second `<add>` element defines the "SqlWebEventProvider" provider, which logs events to a Microsoft SQL Server database via the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="9ae64-139">"SqlWebEventProvider" 構成では、他の構成オプションの間にデータベースの接続文字列 (`connectionStringName`) を指定します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-139">The "SqlWebEventProvider" configuration specifies the database's connection string (`connectionStringName`) among other configuration options.</span></span>

<span data-ttu-id="9ae64-140">`<rules>` 要素は、`<eventMappings>` 要素で指定されたイベントを `<providers>` 要素のログソースにマップします。</span><span class="sxs-lookup"><span data-stu-id="9ae64-140">The `<rules>` element maps the events specified in the `<eventMappings>` element to log sources in the `<providers>` element.</span></span> <span data-ttu-id="9ae64-141">既定では、ASP.NET web アプリケーションは、未処理の例外と監査エラーをすべて Windows イベントログに記録します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-141">By default, ASP.NET web applications log all unhandled exceptions and audit failures to the Windows Event Log.</span></span>

## <a name="logging-events-to-a-database"></a><span data-ttu-id="9ae64-142">データベースへのイベントのログ記録</span><span class="sxs-lookup"><span data-stu-id="9ae64-142">Logging Events to a Database</span></span>

<span data-ttu-id="9ae64-143">正常性監視システムの既定の構成は、アプリケーションの `Web.config` ファイルに `<healthMonitoring>` セクションを追加することで、web アプリケーションによって web アプリケーションごとにカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-143">The health monitoring system's default configuration can be customized on a web application-by-web application basis by adding a `<healthMonitoring>` section to the application's `Web.config` file.</span></span> <span data-ttu-id="9ae64-144">`<add>` 要素を使用して、`<eventMappings>`、`<providers>`、および `<rules>` セクションに追加の要素を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-144">You can include additional elements in the `<eventMappings>`, `<providers>`, and `<rules>` sections by using the `<add>` element.</span></span> <span data-ttu-id="9ae64-145">既定の構成から設定を削除するには、`<remove>` 要素を使用するか、または `<clear />` を使用して、これらのセクションのいずれかからすべての既定値を削除します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-145">To remove a setting from the default configuration use the `<remove>` element, or use `<clear />` to remove all default values from one of these sections.</span></span> <span data-ttu-id="9ae64-146">`SqlWebEventProvider` クラスを使用して、すべての未処理の例外を Microsoft SQL Server データベースに記録するように Book review web アプリケーションを構成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="9ae64-146">Let's configure the Book Reviews web application to log all unhandled exceptions to a Microsoft SQL Server database using the `SqlWebEventProvider` class.</span></span>

<span data-ttu-id="9ae64-147">`SqlWebEventProvider` クラスは、正常性監視システムの一部であり、指定された SQL Server データベースに正常性監視イベントを記録します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-147">The `SqlWebEventProvider` class is part of the health monitoring system and logs a health monitoring event to a specified SQL Server database.</span></span> <span data-ttu-id="9ae64-148">`SqlWebEventProvider` クラスでは、指定されたデータベースに `aspnet_WebEvent_LogEvent`という名前のストアドプロシージャが含まれていることを想定しています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-148">The `SqlWebEventProvider` class expects that the specified database includes a stored procedure named `aspnet_WebEvent_LogEvent`.</span></span> <span data-ttu-id="9ae64-149">このストアドプロシージャにはイベントの詳細が渡され、イベントの詳細が格納されます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-149">This stored procedure is passed the details of the event and is tasked with storing the event details.</span></span> <span data-ttu-id="9ae64-150">このストアドプロシージャを作成したり、イベントの詳細を格納するテーブルを作成したりする必要がないということをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9ae64-150">The good news is that you do not need to create this stored procedure nor the table to store the event details.</span></span> <span data-ttu-id="9ae64-151">これらのオブジェクトは、`aspnet_regsql.exe` ツールを使用してデータベースに追加できます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-151">You can add these objects to your database using the `aspnet_regsql.exe` tool.</span></span>

> [!NOTE]
> <span data-ttu-id="9ae64-152">`aspnet_regsql.exe` ツールは、ASP のサポートを追加したときに[*アプリケーションサービスチュートリアルを使用する web サイトの構成*](configuring-a-website-that-uses-application-services-vb.md)について説明しました。NET のアプリケーションサービス。</span><span class="sxs-lookup"><span data-stu-id="9ae64-152">The `aspnet_regsql.exe` tool was discussed back in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-vb.md) when we added support for ASP.NET's application services.</span></span> <span data-ttu-id="9ae64-153">その結果、書籍のレビュー web サイトのデータベースには、`aspnet_WebEvent_Events`という名前のテーブルにイベント情報を格納する `aspnet_WebEvent_LogEvent` ストアドプロシージャが既に含まれています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-153">Consequently, the Book Reviews website's database already contains the `aspnet_WebEvent_LogEvent` stored procedure, which stores the event information into a table named `aspnet_WebEvent_Events`.</span></span>

<span data-ttu-id="9ae64-154">必要なストアドプロシージャとテーブルがデータベースに追加されたら、すべての未処理の例外をデータベースに記録するように正常性監視に指示します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-154">Once you have the necessary stored procedure and table added to your database, all that remains is to instruct health monitoring to log all unhandled exceptions to the database.</span></span> <span data-ttu-id="9ae64-155">これを行うには、web サイトの `Web.config` ファイルに次のマークアップを追加します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-155">Accomplish this by adding the following markup to your website's `Web.config` file:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample2.xml)]

<span data-ttu-id="9ae64-156">上の状態監視構成マークアップでは `<clear />` 要素を使用して、定義済みの正常性監視の構成情報を `<eventMappings>`、`<providers>`、および `<rules>` の各セクションからワイプします。</span><span class="sxs-lookup"><span data-stu-id="9ae64-156">The health monitoring configuration markup above uses `<clear />` elements to wipe the pre-defined health monitoring configuration information from the `<eventMappings>`, `<providers>`, and `<rules>` sections.</span></span> <span data-ttu-id="9ae64-157">次に、各セクションに1つのエントリを追加します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-157">It then adds a single entry to each of these sections.</span></span>

- <span data-ttu-id="9ae64-158">`<eventMappings>` 要素は、"すべてのエラー" という名前の1つの正常性監視イベントを定義します。これは、未処理の例外が発生するたびに発生します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-158">The `<eventMappings>` element defines a single health monitoring event of interest named "All Errors", which is raised whenever an unhandled exception occurs.</span></span>
- <span data-ttu-id="9ae64-159">`<providers>` 要素は、`SqlWebEventProvider` クラスを使用する "Sqlwe傾斜 Entprovider" という名前の単一のログソースを定義します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-159">The `<providers>` element defines a single log source named "SqlWebEventProvider" that uses the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="9ae64-160">`connectionStringName` 属性は、`<connectionStrings>` セクションで定義された接続文字列の名前である "ReviewsConnectionString" に設定されています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-160">The `connectionStringName` attribute has been set to "ReviewsConnectionString", which is the name of our connection string defined in the `<connectionStrings>` section.</span></span>
- <span data-ttu-id="9ae64-161">最後に、&lt;rules&gt; 要素は、"発生" というイベントが "SqlWebEventProvider" プロバイダーを使用してログに記録される必要があることを示します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-161">Finally, the &lt;rules&gt; element indicates that when an "All Errors" event transpires that it should be logged using the "SqlWebEventProvider" provider.</span></span>

<span data-ttu-id="9ae64-162">この構成情報は、すべての未処理の例外を書籍レビューデータベースに記録するように、正常性監視システムに指示します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-162">This configuration information instructs the health monitoring system to log all unhandled exceptions to the Book Reviews database.</span></span>

> [!NOTE]
> <span data-ttu-id="9ae64-163">`WebBaseErrorEvent` イベントは、サーバーエラーに対してのみ発生します。これは、見つからない ASP.NET リソースの要求など、HTTP エラーに対しては発生しません。</span><span class="sxs-lookup"><span data-stu-id="9ae64-163">The `WebBaseErrorEvent` event is only raised for server errors; it is not raised for HTTP errors, such as a request for an ASP.NET resource that is not found.</span></span> <span data-ttu-id="9ae64-164">これは、サーバーと HTTP の両方のエラーに対して発生する `HttpApplication` クラスの `Error` イベントの動作とは異なります。</span><span class="sxs-lookup"><span data-stu-id="9ae64-164">This differs from the behavior of the `HttpApplication` class's `Error` event, which is raised for both server and HTTP errors.</span></span>

<span data-ttu-id="9ae64-165">正常性監視システムの動作を確認するには、web サイトにアクセスし、`Genre.aspx?ID=foo`にアクセスしてランタイムエラーを生成します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-165">To see the health monitoring system in action, visit the website and generate a runtime error by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="9ae64-166">適切なエラーページが表示されます。これには、例外の詳細 (ローカルにアクセスした場合) またはカスタムエラーページ (運用環境のサイトにアクセスした場合) が表示されます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-166">You should see the appropriate error page - either the Exception Details Yellow Screen of Death (when visiting locally) or the custom error page (when visiting the site in production).</span></span> <span data-ttu-id="9ae64-167">バックグラウンドでは、正常性監視システムによってエラー情報がデータベースに記録されています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-167">Behind the scenes, the health monitoring system logged the error information to the database.</span></span> <span data-ttu-id="9ae64-168">`aspnet_WebEvent_Events` テーブルには1つのレコードが存在する必要があります (**図 1**を参照)。このレコードには、直前に発生したランタイムエラーに関する情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-168">There should be one record in the `aspnet_WebEvent_Events` table (see **Figure 1**); this record contains information about the runtime error that just occurred.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-vb/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-vb/_static/image1.png)

<span data-ttu-id="9ae64-169">**図 1**: エラーの詳細が `aspnet_WebEvent_Events` テーブルに記録された</span><span class="sxs-lookup"><span data-stu-id="9ae64-169">**Figure 1**: The Error Details Were Logged to the `aspnet_WebEvent_Events` Table</span></span>  
<span data-ttu-id="9ae64-170">([クリックすると、フルサイズの画像が表示](logging-error-details-with-asp-net-health-monitoring-vb/_static/image3.png)される)</span><span class="sxs-lookup"><span data-stu-id="9ae64-170">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-vb/_static/image3.png))</span></span>

### <a name="displaying-the-error-log-in-a-web-page"></a><span data-ttu-id="9ae64-171">Web ページへのエラーログの表示</span><span class="sxs-lookup"><span data-stu-id="9ae64-171">Displaying the Error Log In a Web Page</span></span>

<span data-ttu-id="9ae64-172">Web サイトの現在の構成では、未処理の例外がすべてデータベースに記録されます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-172">With the website's current configuration, the health monitoring system logs all unhandled exceptions to the database.</span></span> <span data-ttu-id="9ae64-173">ただし、正常性の監視では、web ページを使用してエラーログを表示するメカニズムは提供されません。</span><span class="sxs-lookup"><span data-stu-id="9ae64-173">However, health monitoring does not provide any mechanism to view the error log through a web page.</span></span> <span data-ttu-id="9ae64-174">ただし、この情報をデータベースから表示する ASP.NET ページを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-174">However, you could build an ASP.NET page that displays this information from the database.</span></span> <span data-ttu-id="9ae64-175">(間もなく表示されるように、エラーの詳細を電子メールメッセージで送信するように選択できます)。</span><span class="sxs-lookup"><span data-stu-id="9ae64-175">(As we'll see momentarily, you can opt to have the error details sent to you in an email message.)</span></span>

<span data-ttu-id="9ae64-176">このようなページを作成する場合は、承認されたユーザーのみがエラーの詳細を表示できるようにするための手順を実行してください。</span><span class="sxs-lookup"><span data-stu-id="9ae64-176">If you create such a page, make sure you take steps to allow only authorized users to view the error details.</span></span> <span data-ttu-id="9ae64-177">サイトで既にユーザーアカウントが使用されている場合は、URL 承認規則を使用して、ページへのアクセスを特定のユーザーまたはロールに制限することができます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-177">If your site already employs user accounts then you can use URL authorization rules to restrict access to the page to certain users or roles.</span></span> <span data-ttu-id="9ae64-178">ログインしたユーザーに基づいて web ページへのアクセスを許可または制限する方法の詳細については、「マイ[Web サイトのセキュリティ](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)に関するチュートリアル」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9ae64-178">For more information on how to grant or restrict access to web pages based on the logged in user, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

> [!NOTE]
> <span data-ttu-id="9ae64-179">以降のチュートリアルでは、ELMAH という名前の別のエラーログと通知システムについて説明します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-179">The subsequent tutorial explores an alternative error logging and notification system named ELMAH.</span></span> <span data-ttu-id="9ae64-180">ELMAH には、web ページと RSS フィードの両方からのエラーログを表示するための組み込みメカニズムが含まれています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-180">ELMAH includes a built-in mechanism to view the error log from both a web page and as an RSS feed.</span></span>

## <a name="logging-events-to-email"></a><span data-ttu-id="9ae64-181">イベントを電子メールに記録する</span><span class="sxs-lookup"><span data-stu-id="9ae64-181">Logging Events to Email</span></span>

<span data-ttu-id="9ae64-182">正常性監視システムには、イベントを電子メールメッセージに "記録" するログソースプロバイダーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-182">The health monitoring system includes a log source provider that "logs" an event to an email message.</span></span> <span data-ttu-id="9ae64-183">ログソースには、電子メールメッセージの本文でデータベースに記録されるものと同じ情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-183">The log source includes the same information that is logged to the database in the email message body.</span></span> <span data-ttu-id="9ae64-184">このログソースを使用すると、特定の状態監視イベントが発生したときに開発者に通知することができます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-184">You can use this log source to notify a developer when a certain health monitoring event occurs.</span></span>

<span data-ttu-id="9ae64-185">例外が発生するたびに電子メールを受信するように、書籍レビュー web サイトの構成を更新してみましょう。</span><span class="sxs-lookup"><span data-stu-id="9ae64-185">Let's update the Book Reviews website's configuration so that we receive an email whenever an exception occurs.</span></span> <span data-ttu-id="9ae64-186">これを実現するには、次の3つのタスクを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9ae64-186">To accomplish this we need to perform three tasks:</span></span>

1. <span data-ttu-id="9ae64-187">電子メールを送信するように ASP.NET web アプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-187">Configure the ASP.NET web application to send email.</span></span> <span data-ttu-id="9ae64-188">これを行うには、`<system.net>` 構成要素を使用して電子メールメッセージを送信する方法を指定します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-188">This is accomplished by specifying how email messages are sent via the `<system.net>` configuration element.</span></span> <span data-ttu-id="9ae64-189">ASP.NET アプリケーションで電子メールメッセージを送信する方法の詳細については、「 [ASP.NET で電子メールを送信する」](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)および「 [.net の FAQ](http://systemnetmail.com/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9ae64-189">For more information on sending email messages in an ASP.NET application refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>
2. <span data-ttu-id="9ae64-190">`<providers>` 要素に電子メールログのソースプロバイダーを登録します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-190">Register the email log source provider in the `<providers>` element, and</span></span>
3. <span data-ttu-id="9ae64-191">ステップ (2) で追加されたログソースプロバイダーに "すべてのエラー" イベントをマップするエントリを `<rules>` 要素に追加します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-191">Add an entry to the `<rules>` element that maps the "All Errors" event to the log source provider added in step (2).</span></span>

<span data-ttu-id="9ae64-192">正常性監視システムには、`SimpleMailWebEventProvider` と `TemplatedMailWebEventProvider`の2つの電子メールログソースプロバイダークラスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-192">The health monitoring system includes two email log source provider classes: `SimpleMailWebEventProvider` and `TemplatedMailWebEventProvider`.</span></span> <span data-ttu-id="9ae64-193">[`SimpleMailWebEventProvider` クラス](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx)は、イベントの詳細を含むプレーンテキストの電子メールメッセージを送信します。電子メールの本文のカスタマイズはほとんどありません。</span><span class="sxs-lookup"><span data-stu-id="9ae64-193">The [`SimpleMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) sends a plain-text email message that includes the event details and provides little customization of the email body.</span></span> <span data-ttu-id="9ae64-194">[`TemplatedMailWebEventProvider` クラス](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx)では、表示されるマークアップが電子メールメッセージの本文として使用される ASP.NET ページを指定します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-194">With the [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) you specify an ASP.NET page whose rendered markup is used as the body for the email message.</span></span> <span data-ttu-id="9ae64-195">[`TemplatedMailWebEventProvider` クラス](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx)を使用すると、電子メールメッセージの内容と形式をはるかに細かく制御できますが、電子メールメッセージの本文を生成する ASP.NET ページを作成する必要があるため、より高度な作業が必要になります。</span><span class="sxs-lookup"><span data-stu-id="9ae64-195">The [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) gives you much greater control over the contents and format of the email message, but requires a bit more upfront work as you have to create the ASP.NET page that generates the email message's body.</span></span> <span data-ttu-id="9ae64-196">このチュートリアルでは、`SimpleMailWebEventProvider` クラスの使用に重点を置いて説明します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-196">This tutorial focuses on using the `SimpleMailWebEventProvider` class.</span></span>

<span data-ttu-id="9ae64-197">`Web.config` ファイルの正常性監視システムの `<providers>` 要素を更新して、`SimpleMailWebEventProvider` クラスのログソースを含めます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-197">Update the health monitoring system's `<providers>` element in the `Web.config` file to include a log source for the `SimpleMailWebEventProvider` class:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample3.xml)]

<span data-ttu-id="9ae64-198">上のマークアップでは、ログソースプロバイダーとして `SimpleMailWebEventProvider` クラスが使用され、フレンドリ名 "Emailwe傾斜 Entprovider" が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-198">The above markup uses the `SimpleMailWebEventProvider` class as the log source provider, and assigns it the friendly name "EmailWebEventProvider".</span></span> <span data-ttu-id="9ae64-199">さらに、`<add>` 属性には、電子メールメッセージの宛先アドレスや差出人アドレスなどの追加の構成オプションが含まれています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-199">Moreover, the `<add>` attribute includes additional configuration options, such as the To and From addresses of the email message.</span></span>

<span data-ttu-id="9ae64-200">電子メールログソースが定義されている状態で、このソースを使用して未処理の例外を "ログに記録" するように、正常性監視システムに指示します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-200">With the email log source defined, all that remains is to instruct the health monitoring system to use this source to "log" unhandled exceptions.</span></span> <span data-ttu-id="9ae64-201">これを行うには、`<rules>` セクションに新しい規則を追加します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-201">This is accomplished by adding a new rule in the `<rules>` section:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample4.xml)]

<span data-ttu-id="9ae64-202">`<rules>` セクションに2つのルールが含まれるようになりました。</span><span class="sxs-lookup"><span data-stu-id="9ae64-202">The `<rules>` section now includes two rules.</span></span> <span data-ttu-id="9ae64-203">最初の1つは "すべてのエラーを電子メールで送信する" という名前で、未処理の例外をすべて "Emailwe傾斜" ログソースに送信します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-203">The first one, named "All Errors To Email", sends all unhandled exceptions to the "EmailWebEventProvider" log source.</span></span> <span data-ttu-id="9ae64-204">このルールは、web サイト上のエラーに関する詳細情報を、指定された宛先アドレスに送信する効果を持ちます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-204">This rule has the effect of sending details about errors on the website to the specified To address.</span></span> <span data-ttu-id="9ae64-205">"データベースへのすべてのエラー" ルールによって、エラーの詳細がサイトのデータベースに記録されます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-205">The "All Errors To Database" rule logs the error details to the site's database.</span></span> <span data-ttu-id="9ae64-206">その結果、サイトでハンドルされない例外が発生するたびに、その詳細がデータベースに記録され、指定された電子メールアドレスに送信されます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-206">Consequently, whenever an unhandled exception occurs on the site its details are both logged to the database and sent to specified email address.</span></span>

<span data-ttu-id="9ae64-207">**図 2**は、`Genre.aspx?ID=foo`にアクセスするときに `SimpleMailWebEventProvider` クラスによって生成される電子メールを示しています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-207">**Figure 2** shows the email generated by the `SimpleMailWebEventProvider` class when visiting `Genre.aspx?ID=foo`.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-vb/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-vb/_static/image4.png)

<span data-ttu-id="9ae64-208">**図 2**: エラーの詳細が電子メールメッセージで送信される</span><span class="sxs-lookup"><span data-stu-id="9ae64-208">**Figure 2**: The Error Details are Sent in an Email Message</span></span>  
<span data-ttu-id="9ae64-209">([クリックすると、フルサイズの画像が表示](logging-error-details-with-asp-net-health-monitoring-vb/_static/image6.png)される)</span><span class="sxs-lookup"><span data-stu-id="9ae64-209">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-vb/_static/image6.png))</span></span>

## <a name="summary"></a><span data-ttu-id="9ae64-210">要約</span><span class="sxs-lookup"><span data-stu-id="9ae64-210">Summary</span></span>

<span data-ttu-id="9ae64-211">ASP.NET health monitoring システムは、管理者が展開された web アプリケーションの正常性を監視できるように設計されています。</span><span class="sxs-lookup"><span data-stu-id="9ae64-211">The ASP.NET health monitoring system is designed to allow administrators to monitor the health of a deployed web application.</span></span> <span data-ttu-id="9ae64-212">正常性監視イベントは、アプリケーションが停止したとき、ユーザーがサイトに正常にログオンしたとき、またはハンドルされない例外が発生したときなど、特定のアクションが展開されると発生します。</span><span class="sxs-lookup"><span data-stu-id="9ae64-212">Health monitoring events are raised when certain actions unfold, such as when the application stops, when a user successfully logs onto the site, or when an unhandled exception occurs.</span></span> <span data-ttu-id="9ae64-213">これらのイベントは、任意の数のログソースに記録できます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-213">These events can be logged to any number of log sources.</span></span> <span data-ttu-id="9ae64-214">このチュートリアルでは、未処理の例外の詳細をデータベースおよび電子メールメッセージを使用してログに記録する方法を示しました。</span><span class="sxs-lookup"><span data-stu-id="9ae64-214">This tutorial showed how to log the details of unhandled exceptions to a database and through an email message.</span></span>

<span data-ttu-id="9ae64-215">このチュートリアルでは、正常性監視を使用して未処理の例外をログに記録する方法に重点を置いていますが、正常性の監視は、デプロイされた ASP.NET アプリケーションの全体的な正常性を測定するように設計されており、豊富な正常性監視イベントとログソースを含みません。こちらをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="9ae64-215">This tutorial focused on using health monitoring to log unhandled exceptions, but keep in mind that health monitoring is designed to measure the overall health of a deployed ASP.NET application and includes a wealth of health monitoring events and log sources not explored here.</span></span> <span data-ttu-id="9ae64-216">さらに、必要に応じて、独自の正常性監視イベントとログソースを作成できます。</span><span class="sxs-lookup"><span data-stu-id="9ae64-216">What's more, you can create your own health monitoring events and log sources, should the need arise.</span></span> <span data-ttu-id="9ae64-217">正常性の監視について詳しく知りたい場合は、まず、 [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)の[正常性監視](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)に関する FAQ を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9ae64-217">If you are interested in learning more about health monitoring, a good first step is to read through [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)'s [health monitoring FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span></span> <span data-ttu-id="9ae64-218">詳細については、「[方法: ASP.NET 2.0 の正常性監視を使用する」](https://msdn.microsoft.com/library/ms998306.aspx)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9ae64-218">Following that, consult [How To: Use Health Monitoring in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span></span>

<span data-ttu-id="9ae64-219">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="9ae64-219">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="9ae64-220">関連項目</span><span class="sxs-lookup"><span data-stu-id="9ae64-220">Further Reading</span></span>

<span data-ttu-id="9ae64-221">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="9ae64-221">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="9ae64-222">ASP.NET の正常性監視の概要</span><span class="sxs-lookup"><span data-stu-id="9ae64-222">ASP.NET Health Monitoring Overview</span></span>](https://msdn.microsoft.com/library/bb398933.aspx)
- [<span data-ttu-id="9ae64-223">ASP.NET の正常性監視システムの構成とカスタマイズ</span><span class="sxs-lookup"><span data-stu-id="9ae64-223">Configuring and Customizing the Health Monitoring System of ASP.NET</span></span>](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [<span data-ttu-id="9ae64-224">FAQ-ASP.NET 2.0 での正常性の監視</span><span class="sxs-lookup"><span data-stu-id="9ae64-224">FAQ - Health Monitoring in ASP.NET 2.0</span></span>](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [<span data-ttu-id="9ae64-225">方法: 正常性の監視通知用に電子メールを送信する</span><span class="sxs-lookup"><span data-stu-id="9ae64-225">How To: Send E-Mail for Health Monitoring Notifications</span></span>](https://msdn.microsoft.com/library/ms227553.aspx)
- [<span data-ttu-id="9ae64-226">方法: ASP.NET で正常性監視を使用する</span><span class="sxs-lookup"><span data-stu-id="9ae64-226">How To: Use Health Monitoring in ASP.NET</span></span>](https://msdn.microsoft.com/library/ms998306.aspx)
- [<span data-ttu-id="9ae64-227">ASP.NET の正常性の監視</span><span class="sxs-lookup"><span data-stu-id="9ae64-227">Health Monitoring in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="9ae64-228">[前へ](processing-unhandled-exceptions-vb.md)
> [次へ](logging-error-details-with-elmah-vb.md)</span><span class="sxs-lookup"><span data-stu-id="9ae64-228">[Previous](processing-unhandled-exceptions-vb.md)
[Next](logging-error-details-with-elmah-vb.md)</span></span>
