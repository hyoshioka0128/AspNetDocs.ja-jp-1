---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
title: データベースの開発と配置のためC#の戦略 () |Microsoft Docs
author: rick-anderson
description: データドリブンアプリケーションを初めて配置する場合は、開発環境内のデータベースを実稼働環境に無条件でコピーできます。 B...
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 3e8b0627-3eb7-488e-807e-067cba7cec05
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
msc.type: authoredcontent
ms.openlocfilehash: 4d9dbaf41926b43af171619ee34f58da84b5dab1
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78509386"
---
# <a name="strategies-for-database-development-and-deployment-c"></a><span data-ttu-id="8cfae-104">データベースの開発と配置のための戦略 (C#)</span><span class="sxs-lookup"><span data-stu-id="8cfae-104">Strategies for Database Development and Deployment (C#)</span></span>

<span data-ttu-id="8cfae-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8cfae-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8cfae-106">[[Download PDF]\(PDF をダウンロード\)](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial10_DBDevel_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="8cfae-106">[Download PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial10_DBDevel_cs.pdf)</span></span>

> <span data-ttu-id="8cfae-107">データドリブンアプリケーションを初めて配置する場合は、開発環境内のデータベースを実稼働環境に無条件でコピーできます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-107">When deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="8cfae-108">ただし、その後の配置でブラインドコピーを実行すると、運用データベースに入力されたすべてのデータが上書きされます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-108">But performing a blind copy in subsequent deployments will overwrite any data entered into the production database.</span></span> <span data-ttu-id="8cfae-109">その代わりに、データベースを配置するには、運用データベースへの最後の配置以降に開発データベースに加えられた変更を適用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-109">Instead, deploying a database involves applying the changes made to the development database since the last deployment onto the production database.</span></span> <span data-ttu-id="8cfae-110">このチュートリアルでは、これらの課題について考察し、最後の配置以降にデータベースに加えられた変更を chronicling して適用するためのさまざまな戦略を提供します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-110">This tutorial examines these challenges and offers various strategies to assist with chronicling and applying the changes made to the database since the last deployment.</span></span>

## <a name="introduction"></a><span data-ttu-id="8cfae-111">はじめに</span><span class="sxs-lookup"><span data-stu-id="8cfae-111">Introduction</span></span>

<span data-ttu-id="8cfae-112">前のチュートリアルで説明したように、ASP.NET アプリケーションを配置するには、開発環境から運用環境に関連するコンテンツをコピーすることが伴います。</span><span class="sxs-lookup"><span data-stu-id="8cfae-112">As discussed in previous tutorials, deploying an ASP.NET application entails copying the pertinent content from the development environment to the production environment.</span></span> <span data-ttu-id="8cfae-113">デプロイは1回限りのイベントではなく、新しいバージョンのソフトウェアがリリースされるたび、またはバグやセキュリティ上の懸念事項が特定され、対処されたときに発生するものです。</span><span class="sxs-lookup"><span data-stu-id="8cfae-113">Deployment is not a one-time event, but rather something that happens every time a new version of the software is released or when bugs or security concerns have been identified and addressed.</span></span> <span data-ttu-id="8cfae-114">ASP.NET のページ、イメージ、JavaScript ファイル、その他のファイルを運用環境にコピーする場合は、最後の配置以降にこれらのファイルがどのように変更されたかについて気にする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="8cfae-114">When copying ASP.NET pages, images, JavaScript files, and other such files to the production environment you do not need to concern yourself with how these file have been changed since the last deployment.</span></span> <span data-ttu-id="8cfae-115">ファイルを実稼働環境にコピーし、既存のコンテンツを上書きすることができます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-115">You can blindly copy the file to production, overwriting the existing content.</span></span> <span data-ttu-id="8cfae-116">残念ながら、この簡単な方法は、データベースの配置には適用されません。</span><span class="sxs-lookup"><span data-stu-id="8cfae-116">Unfortunately, this simplicity does not extend to deploying the database.</span></span>

<span data-ttu-id="8cfae-117">データドリブンアプリケーションを初めて配置する場合は、開発環境内のデータベースを実稼働環境に無条件でコピーできます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-117">When deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="8cfae-118">ただし、その後の配置でブラインドコピーを実行すると、運用データベースに入力されたすべてのデータが上書きされます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-118">But performing a blind copy in subsequent deployments will overwrite any data entered into the production database.</span></span> <span data-ttu-id="8cfae-119">その代わりに、データベースを配置するには、運用データベースへの最後の配置以降に開発データベースに加えられた*変更*を適用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-119">Instead, deploying a database involves applying the *changes* made to the development database since the last deployment onto the production database.</span></span> <span data-ttu-id="8cfae-120">このチュートリアルでは、これらの課題について考察し、最後の配置以降にデータベースに加えられた変更を chronicling して適用するためのさまざまな戦略を提供します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-120">This tutorial examines these challenges and offers various strategies to assist with chronicling and applying the changes made to the database since the last deployment.</span></span>

## <a name="the-challenges-of-deploying-a-database"></a><span data-ttu-id="8cfae-121">データベースの配置に関する課題</span><span class="sxs-lookup"><span data-stu-id="8cfae-121">The Challenges of Deploying a Database</span></span>

<span data-ttu-id="8cfae-122">データドリブンアプリケーションを初めて配置する前に、データベースが1つだけ存在します。つまり、開発環境にデータベースが1つだけ存在します。これは、データドリブンアプリケーションを初めて配置するときに、データベースを開発環境を運用環境に展開します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-122">Before a data-driven application has been deployed for the first time, there is only one database, namely the database in the development environment, which is why when deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="8cfae-123">しかし、アプリケーションをデプロイした後は、データベースのコピーが2つあります。1つは開発中で、もう1つは運用環境です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-123">But once the application has been deployed there are two copies of the database: one in development and one in production.</span></span>

<span data-ttu-id="8cfae-124">デプロイ間では、開発データベースと運用データベースが同期されなくなる可能性があります。実稼働データベース s スキーマは変更されませんが、新しい機能が追加されると、開発データベース s スキーマが変更される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-124">Between deployments the development and production databases can become out of sync. While the production database s schema remains unchanged, the development database s schema may change as new features are added.</span></span> <span data-ttu-id="8cfae-125">列、テーブル、ビュー、またはストアドプロシージャを追加または削除することができます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-125">You might add or remove columns, tables, views, or stored procedures.</span></span> <span data-ttu-id="8cfae-126">また、開発データベースに追加される重要なデータがある場合もあります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-126">There may also be important data that gets added to the development database.</span></span> <span data-ttu-id="8cfae-127">多くのデータドリブンアプリケーションには、ハードコーディングされた、ユーザーが編集できないアプリケーション固有のデータを含む参照テーブルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="8cfae-127">Many data-driven applications include lookup tables populated with hard-coded, application-specific data that are not user-editable.</span></span> <span data-ttu-id="8cfae-128">たとえば、オークションの web サイトには、auctioned されている項目の条件を説明するドロップダウンリストがあります。これには、new、Good、公正などがあります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-128">For example, an auction website might have a drop-down list with choices that describe the condition of the item being auctioned: New, Like New, Good, and Fair.</span></span> <span data-ttu-id="8cfae-129">これらのオプションをドロップダウンリストで直接ハードコーディングするのではなく、通常はデータベーステーブルに配置することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8cfae-129">Rather than hard-coding these options directly in the drop-down list it is usually better to place them in a database table.</span></span> <span data-ttu-id="8cfae-130">開発中に、"不十分" という名前の新しい条件がテーブルに追加された場合は、アプリケーションを配置するときに、この同じレコードを実稼働データベースのルックアップテーブルに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-130">If, during development, a new condition named Poor is added to the table then when deploying the application this same record needs to be added to the lookup table in the production database.</span></span>

<span data-ttu-id="8cfae-131">データベースを配置する場合は、開発環境から運用環境にデータベースをコピーするのが理想的です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-131">Ideally, deploying the database would involve copying the database from development to production.</span></span> <span data-ttu-id="8cfae-132">ただし、アプリケーションをデプロイして開発を再開した後は、実稼働データベースに実際のユーザーからの実際のデータが入力されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8cfae-132">But keep in mind that after you have deployed the application and resumed development, the production database is being populated with real data from real users.</span></span> <span data-ttu-id="8cfae-133">そのため、次の配置時に単に開発環境から運用環境にデータベースをコピーする場合は、実稼働データベースを上書きして、既存のデータを失うことになります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-133">Therefore, if you were to simply copy the database from development to production at the next deployment you would overwrite the production database and lose its existing data.</span></span> <span data-ttu-id="8cfae-134">最終的には、データベースを配置すると、前回の配置以降に開発データベースに加えられた変更を適用することになります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-134">The net result is that deploying the database boils down to applying the changes made to the development database since the last deployment.</span></span>

<span data-ttu-id="8cfae-135">データベースを配置するには、スキーマの変更と、場合によっては前回の配置以降のデータを適用する必要があるため、変更の履歴を保持する (または、デプロイ時に決定する) 必要があります。これにより、変更を運用環境に適用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-135">Because deploying a database involves applying the changes in the schema and, possibly, the data since the last deployment, a history of changes must be maintained (or determined at deploy-time) so that those changes can be applied on production.</span></span> <span data-ttu-id="8cfae-136">データモデルに対する変更を管理および適用するには、さまざまな方法があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-136">There are a variety of techniques for managing and applying changes to the data model.</span></span>

### <a name="defining-the-baseline"></a><span data-ttu-id="8cfae-137">ベースラインの定義</span><span class="sxs-lookup"><span data-stu-id="8cfae-137">Defining the Baseline</span></span>

<span data-ttu-id="8cfae-138">アプリケーションのデータベースへの変更を維持するには、開始状態 (変更が適用されるベースライン) が必要です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-138">To maintain the changes to your application s database you need to have some starting state, a baseline to which the changes are applied to.</span></span> <span data-ttu-id="8cfae-139">1つの極端な開始状態は、テーブル、ビュー、またはストアドプロシージャがない空のデータベースである可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-139">At one extreme the starting state could be an empty database with no tables, views, or stored procedures.</span></span> <span data-ttu-id="8cfae-140">このようなベースラインでは、最初の配置後に加えられたすべての変更と共に、すべてのデータベースのテーブル、ビュー、およびストアドプロシージャの作成が含まれている必要があるため、大きな変更ログが生成されます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-140">Such a baseline results in a large change log because it must include the creation of all of the database s tables, views, and stored procedures along with any changes made after the initial deployment.</span></span> <span data-ttu-id="8cfae-141">この範囲のもう一方の端には、最初に運用環境に配置されたデータベースのバージョンとしてベースラインを設定できます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-141">At the other end of the spectrum you could set the baseline as the version of the database that is initially deployed to the production environment.</span></span> <span data-ttu-id="8cfae-142">このオプションを選択すると、最初の配置後にデータベースに加えられた変更のみが含まれるため、変更ログが大幅に小さくなります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-142">This choice results in a much smaller change log because it only includes the changes made to the database following the first deployment.</span></span> <span data-ttu-id="8cfae-143">これが望ましい方法です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-143">This is the approach I prefer.</span></span> <span data-ttu-id="8cfae-144">もちろん、より大きな道路アプローチを選択して、データベースを最初に作成してからデータベースを最初に配置するまでの時点としてベースラインを定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-144">And of course you can choose a more middle of the road approach, defining the baseline as some point between the initial creation of the database and when the database is first deployed.</span></span>

<span data-ttu-id="8cfae-145">ベースラインを選択したら、ベースラインバージョンを再作成するために実行できる SQL スクリプトを生成することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="8cfae-145">Once you have chosen a baseline consider generating a SQL script that can be executed to recreate the baseline version.</span></span> <span data-ttu-id="8cfae-146">このようなスクリプトを使用すると、データベースのベースラインバージョンをすばやく再作成できます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-146">Such a script makes it possible to quickly recreate the baseline version of the database.</span></span> <span data-ttu-id="8cfae-147">この機能は、プロジェクトで作業している開発者が複数いる場合や、テストやステージングなどの追加の環境で、それぞれが独自のデータベースコピーを必要とする大規模なプロジェクトで特に便利です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-147">This functionality is especially useful in larger projects, where there may be multiple developers working on the project or additional environments, such as testing or staging, that each need their own copy of the database.</span></span>

<span data-ttu-id="8cfae-148">ベースラインバージョンの SQL スクリプトを生成するためのさまざまなツールが用意されています。</span><span class="sxs-lookup"><span data-stu-id="8cfae-148">There are a variety of tools at your disposal to generate a SQL script of the baseline version.</span></span> <span data-ttu-id="8cfae-149">SQL Server Management Studio (SSMS) で、データベースを右クリックし、[タスク] サブメニューにアクセスして、[スクリプトの生成] オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-149">From SQL Server Management Studio (SSMS) you can right-click on the database, go to the Tasks submenu, and choose the Generate Scripts option.</span></span> <span data-ttu-id="8cfae-150">これにより、スクリプトウィザードが起動します。このウィザードでは、データベース s オブジェクトを作成するための SQL コマンドを含むファイルを生成するように指示できます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-150">This launches the Script Wizard, which you can instruct to generate a file that contains the SQL commands to create your database s objects.</span></span> <span data-ttu-id="8cfae-151">もう1つのオプションとして、データベースのパブリッシュウィザードがあります。このウィザードでは、データベーススキーマだけでなく、データベーステーブル内のデータも作成できるように、SQL コマンドを生成できます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-151">Another option is the Database Publishing Wizard, which can generate the SQL commands to not only create the database schema, but also the data in the database tables.</span></span> <span data-ttu-id="8cfae-152">データベース発行ウィザードの詳細については、「*データベースの配置*」チュートリアルをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="8cfae-152">The Database Publishing Wizard was examined in detail back in the *Deploying a Database* tutorial.</span></span> <span data-ttu-id="8cfae-153">使用するツールに関係なく、最終的には、データベースのベースラインバージョンを再作成するために使用できるスクリプトファイルが必要になります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-153">Regardless of what tool you use, in the end you should have a script file that you can use to recreate the baseline version of your database, should the need arise.</span></span>

## <a name="documenting-the-database-changes-in-prose"></a><span data-ttu-id="8cfae-154">Prose でのデータベースの変更のドキュメント化</span><span class="sxs-lookup"><span data-stu-id="8cfae-154">Documenting the Database Changes in Prose</span></span>

<span data-ttu-id="8cfae-155">開発フェーズ中にデータモデルに対する変更のログを保持する最も簡単な方法は、変更を prose に記録することです。</span><span class="sxs-lookup"><span data-stu-id="8cfae-155">The simplest way to maintain a log of changes to the data model during the development phase is to record the changes in prose.</span></span> <span data-ttu-id="8cfae-156">たとえば、既に配置されたアプリケーションの開発時に、`Employees` テーブルに新しい列を追加し、`Orders` テーブルから列を削除し、新しいテーブル (`ProductCategories`) を追加する場合は、次の履歴を使用してテキストファイルまたは Microsoft Word 文書を保持します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-156">For example, if during development of an already-deployed application you add a new column to the `Employees` table, remove a column from the `Orders` table, and add a new table (`ProductCategories`), you would maintain a text file or Microsoft Word document with the following history:</span></span>

<a id="0.4_table01"></a>

| <span data-ttu-id="8cfae-157">**日付の変更**</span><span class="sxs-lookup"><span data-stu-id="8cfae-157">**Change Date**</span></span> | <span data-ttu-id="8cfae-158">**変更の詳細**</span><span class="sxs-lookup"><span data-stu-id="8cfae-158">**Change Details**</span></span> |
| --- | --- |
| <span data-ttu-id="8cfae-159">2009-02-03:</span><span class="sxs-lookup"><span data-stu-id="8cfae-159">2009-02-03:</span></span> | <span data-ttu-id="8cfae-160">`Employees` テーブルに列 `DepartmentID` (NULL ではない`int`) を追加しました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-160">Added column `DepartmentID` (`int`, NOT NULL) to the `Employees` table.</span></span> <span data-ttu-id="8cfae-161">`Departments.DepartmentID` から `Employees.DepartmentID`への外部キー制約が追加されました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-161">Added a foreign key constraint from `Departments.DepartmentID` to `Employees.DepartmentID`.</span></span> |
| <span data-ttu-id="8cfae-162">2009-02-05:</span><span class="sxs-lookup"><span data-stu-id="8cfae-162">2009-02-05:</span></span> | <span data-ttu-id="8cfae-163">`Orders` テーブルから列 `TotalWeight` を削除しました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-163">Removed column `TotalWeight` from the `Orders` table.</span></span> <span data-ttu-id="8cfae-164">関連する `OrderDetails` レコードに既にキャプチャされたデータ。</span><span class="sxs-lookup"><span data-stu-id="8cfae-164">Data already captured in associated `OrderDetails` records.</span></span> |
| <span data-ttu-id="8cfae-165">2009-02-12:</span><span class="sxs-lookup"><span data-stu-id="8cfae-165">2009-02-12:</span></span> | <span data-ttu-id="8cfae-166">`ProductCategories` テーブルを作成しました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-166">Created the `ProductCategories` table.</span></span> <span data-ttu-id="8cfae-167">列には、`ProductCategoryID` (`int`、`IDENTITY`、`NOT NULL`)、`CategoryName` (`nvarchar(50)`、`NOT NULL`)、`Active` (`bit`、`NOT NULL`) の3つの列があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-167">There are three columns: `ProductCategoryID` (`int`, `IDENTITY`, `NOT NULL`), `CategoryName` (`nvarchar(50)`, `NOT NULL`), and `Active` (`bit`, `NOT NULL`).</span></span> <span data-ttu-id="8cfae-168">`ProductCategoryID`に primary key 制約を追加し、既定値1を `Active`に追加しました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-168">Added a primary key constraint to `ProductCategoryID`, and a default value of 1 to `Active`.</span></span> |

<span data-ttu-id="8cfae-169">このアプローチにはいくつかの欠点があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-169">There are a number of drawbacks to this approach.</span></span> <span data-ttu-id="8cfae-170">手始めとして、automation については期待していません。</span><span class="sxs-lookup"><span data-stu-id="8cfae-170">For starters, there is no hope for automation.</span></span> <span data-ttu-id="8cfae-171">アプリケーションが配置されたときなど、これらの変更をデータベースに適用する必要がある場合、開発者は各変更を1つずつ手動で実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-171">Anytime these changes need to be applied to a database - such as when the application is deployed - a developer must manually implement each change, one at a time.</span></span> <span data-ttu-id="8cfae-172">さらに、変更ログを使用してベースラインから特定のバージョンのデータベースを再構築する必要がある場合は、ログのサイズが大きくなるほど時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-172">Moreover, if you need to reconstruct a particular version of the database from the baseline using the change log, doing so will take more and more time as the size of the log grows.</span></span> <span data-ttu-id="8cfae-173">この方法のもう1つの欠点は、各変更ログエントリの明確さと詳細レベルが、変更を記録しているユーザーに残されていることです。</span><span class="sxs-lookup"><span data-stu-id="8cfae-173">Another drawback to this method is that the clarity and level of detail of each change log entry is left to the person recording the change.</span></span> <span data-ttu-id="8cfae-174">複数の開発者がいるチームでは、他のユーザーよりも詳細で読みやすく、より正確なエントリを作成することがあります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-174">In a team with multiple developers some may make more detailed, more readable, or more precise entries than others.</span></span> <span data-ttu-id="8cfae-175">また、誤字やその他の人間に関連するデータ入力エラーが発生する可能性もあります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-175">Also, typos and other human-related data entry errors are possible.</span></span>

<span data-ttu-id="8cfae-176">Prose でデータベースの変更を文書化する主な利点は簡単です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-176">The primary benefit of documenting the database changes in prose is simplicity.</span></span> <span data-ttu-id="8cfae-177">データベースオブジェクトを作成および変更するための SQL 構文に関する知識は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="8cfae-177">You don t need familiarity with the SQL syntax for creating and altering database objects.</span></span> <span data-ttu-id="8cfae-178">代わりに、prose で変更を記録し、SQL Server Management Studio s グラフィカルユーザーインターフェイスを使用して実装することができます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-178">Instead, you can record the changes in prose and implement them through SQL Server Management Studio s graphical user interface.</span></span>

<span data-ttu-id="8cfae-179">Prose で変更ログを保持することは、非常に洗練されているわけではなく、特定のプロジェクトでは適切に機能しません。たとえば、スコープが大きくなっているものや、データモデルが頻繁に変更されている場合、複数の開発者が関与している場合などです。</span><span class="sxs-lookup"><span data-stu-id="8cfae-179">Maintaining your change log in prose is, admittedly, not very sophisticated and won't work well with certain projects, such as ones that are large in scope, have frequent changes to the data model, or involve multiple developers.</span></span> <span data-ttu-id="8cfae-180">しかし、このアプローチは、データモデルが頻繁に変更されていて、データベースオブジェクトを作成および変更するための SQL 構文において、ソロ開発者が強力な背景を持たない小規模な1人のプロジェクトで非常にうまく機能していることがわかりました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-180">But I have seen this approach work quite well in small, one-man projects that have only occasional changes to the data model and where the solo developer does not have a strong background in the SQL syntax for creating and altering database objects.</span></span>

> [!NOTE]
> <span data-ttu-id="8cfae-181">変更ログの情報は、技術的には展開時まで必要ですが、変更の履歴を保持することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8cfae-181">While the information in the change log is, technically, only needed until deploy-time, I recommend keeping a history of changes.</span></span> <span data-ttu-id="8cfae-182">ただし、1つの拡張した変更ログファイルを保持するのではなく、データベースのバージョンごとに異なる変更ログファイルを使用することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="8cfae-182">But rather than maintaining a single, ever growing change log file, consider having a different change log file for each database version.</span></span> <span data-ttu-id="8cfae-183">通常は、配置されるたびにデータベースのバージョンを作成します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-183">Typically you will want to version the database each time it is deployed.</span></span> <span data-ttu-id="8cfae-184">変更ログのログを保持するには、ベースラインから開始し、バージョン1以降の変更ログスクリプトを実行してデータベースバージョンを再作成し、再作成する必要があるバージョンに達するまで続行します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-184">By maintaining a log of change logs you can, starting from the baseline, recreate any database version by executing the change log scripts starting from version 1 and continuing until you reach the version you need to recreate.</span></span>

## <a name="recording-the-sql-change-statements"></a><span data-ttu-id="8cfae-185">SQL 変更ステートメントの記録</span><span class="sxs-lookup"><span data-stu-id="8cfae-185">Recording the SQL Change Statements</span></span>

<span data-ttu-id="8cfae-186">Prose の変更ログを維持するための主な欠点は、自動化が欠如していることです。</span><span class="sxs-lookup"><span data-stu-id="8cfae-186">The primary drawback of maintaining the change log in prose is the lack of automation.</span></span> <span data-ttu-id="8cfae-187">理想的には、配置時にデータベースの変更を実稼働データベースに実装することは、手順の一覧を手動で実行するのではなく、スクリプトを実行するボタンをクリックするだけで簡単に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-187">Ideally, implementing the database changes to the production database at deploy-time would be as easy as clicking a button to execute a script rather than having to manually perform a list of instructions.</span></span> <span data-ttu-id="8cfae-188">このような自動化は、データモデルの変更に使用する SQL コマンドを含む変更ログを保持することによって可能です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-188">Such automation is possible by maintaining a change log that contains those SQL commands used to alter the data model.</span></span>

<span data-ttu-id="8cfae-189">SQL 構文には、さまざまなデータベースオブジェクトを作成および変更するための多数のステートメントが含まれています。</span><span class="sxs-lookup"><span data-stu-id="8cfae-189">The SQL syntax includes a number of statements for creating and modifying various database objects.</span></span> <span data-ttu-id="8cfae-190">たとえば、 [*CREATE TABLE ステートメント*](https://msdn.microsoft.com/library/ms174979.aspx)を実行すると、指定した列と制約を持つ新しいテーブルが作成されます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-190">For example, the [*CREATE TABLE statement*](https://msdn.microsoft.com/library/ms174979.aspx), when executed, creates a new table with the specified columns and constraints.</span></span> <span data-ttu-id="8cfae-191">[*ALTER TABLE ステートメント*](https://msdn.microsoft.com/library/ms190273.aspx)は、既存のテーブルを変更し、その列または制約を追加、削除、または変更します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-191">The [*ALTER TABLE statement*](https://msdn.microsoft.com/library/ms190273.aspx) modifies an existing table, adding, removing, or modifying its columns or constraints.</span></span> <span data-ttu-id="8cfae-192">また、インデックス、ビュー、ユーザー定義関数、ストアドプロシージャ、トリガー、およびその他のデータベースオブジェクトを作成、変更、および削除するためのステートメントも用意されています。</span><span class="sxs-lookup"><span data-stu-id="8cfae-192">There are also statements to create, modify, and drop indexes, views, user-defined functions, stored procedures, triggers, and other database objects.</span></span>

<span data-ttu-id="8cfae-193">前の例に戻ると、既に配置されたアプリケーションの開発時に、`Employees` テーブルに新しい列を追加し、`Orders` テーブルから列を削除し、新しいテーブル (`ProductCategories`) を追加します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-193">Returning to our earlier example, image that during development of an already-deployed application you add a new column to the `Employees` table, remove a column from the `Orders` table, and add a new table (`ProductCategories`).</span></span> <span data-ttu-id="8cfae-194">このような操作を行うと、次の SQL コマンドを使用して変更ログファイルが生成されます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-194">Such actions would result in a change log file with the following SQL commands:</span></span>

[!code-sql[Main](strategies-for-database-development-and-deployment-cs/samples/sample1.sql)]

<span data-ttu-id="8cfae-195">配置時にこれらの変更を実稼働データベースにプッシュするには、ワンクリック操作があります。 SQL Server Management Studio を開き、実稼働データベースに接続して、新しいクエリウィンドウを開き、変更ログの内容を貼り付けて、[実行] をクリックしてスクリプトを実行します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-195">Pushing these changes to the production database at deploy-time is a one-click operation: open SQL Server Management Studio, connect to your production database, open a New Query window, paste the contents of the change log, and click Execute to run the script.</span></span>

## <a name="using-a-comparison-tool-to-synchronize-the-data-models"></a><span data-ttu-id="8cfae-196">比較ツールを使用したデータモデルの同期</span><span class="sxs-lookup"><span data-stu-id="8cfae-196">Using a Comparison Tool to Synchronize the Data Models</span></span>

<span data-ttu-id="8cfae-197">Prose でのデータベースの変更のドキュメントの作成は簡単ですが、変更を実装するには、開発者が運用データベースを1つずつ変更する必要があります。変更 SQL コマンドをドキュメント化することで、ボタンをクリックするのと同じように、これらの変更を実稼働データベースに簡単かつ迅速に実装できますが、データベースオブジェクトを作成および変更するための SQL ステートメントや構文の学習とマスタリングが必要になります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-197">Documenting database changes in prose is easy, but implementing the changes requires a developer to make each change on the production database one at a time; documenting the change SQL commands makes implementing those changes on the production database as easy and quick as clicking a button, but requires learning and mastering the SQL statements and syntax for creating and altering database objects.</span></span> <span data-ttu-id="8cfae-198">データベース比較ツールは、両方のアプローチから最適な方法を採用し、最悪のことを破棄します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-198">Database comparison tools take the best from both approaches and discard the worst.</span></span>

<span data-ttu-id="8cfae-199">データベース比較ツールは、2つのデータベースのスキーマまたはデータを比較し、データベースがどのように異なるかを示す概要レポートを表示します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-199">A database comparison tool compares the schema or data of two databases and displays a summary report showing you how the databases differ.</span></span> <span data-ttu-id="8cfae-200">次に、ボタンをクリックすると、1つまたは複数のデータベースオブジェクトを同期するための SQL コマンドを生成できます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-200">Then, with the click of a button, you can generate the SQL commands for synchronizing one or more database objects.</span></span> <span data-ttu-id="8cfae-201">簡単に言うと、データベース比較ツールを使用して、配置時に開発データベースと実稼働データベースを比較し、実行された SQL コマンドを含むファイルを生成します。これにより、変更が運用データベースのスキーマに適用されます。開発データベース s スキーマをミラー化します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-201">In a nutshell, you can use a database comparison tool to compare the development and production databases at deploy-time, generating a file that contains the SQL commands that, when executed, will apply the changes to the production database s schema so that it mirrors the development database s schema.</span></span>

<span data-ttu-id="8cfae-202">さまざまなベンダーによって提供されるさまざまなサードパーティ製のデータベース比較ツールがあります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-202">There are a variety of third-party database comparison tools offered by many different vendors.</span></span> <span data-ttu-id="8cfae-203">このような例の1つは、 [*Red Gate Software*](http://www.red-gate.com/)による[*SQL Compare*](http://www.red-gate.com/products/SQL_Compare/)です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-203">One such example is [*SQL Compare*](http://www.red-gate.com/products/SQL_Compare/), by [*Red Gate Software*](http://www.red-gate.com/).</span></span> <span data-ttu-id="8cfae-204">SQL Compare を使用して、開発データベーススキーマと実稼働データベーススキーマを比較し、同期するプロセスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-204">Let s walk through the process of using SQL Compare to compare and synchronize the development and production databases schemas.</span></span>

> [!NOTE]
> <span data-ttu-id="8cfae-205">このドキュメントの執筆時点では、SQL Compare の現在のバージョンは、Standard Edition のコスト $395 を使用したバージョン7.1 でした。</span><span class="sxs-lookup"><span data-stu-id="8cfae-205">At the time of this writing the current version of SQL Compare was version 7.1, with the Standard Edition costing $395.</span></span> <span data-ttu-id="8cfae-206">14日間の無料試用版をダウンロードすることによって、次の操作を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-206">You can follow along by downloading a free 14-day trial.</span></span>

<span data-ttu-id="8cfae-207">SQL 比較が開始されると、[比較プロジェクト] ダイアログボックスが開き、保存された SQL 比較プロジェクトが表示されます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-207">When SQL Compare starts the Comparison Projects dialog box opens, showing the saved SQL Compare projects.</span></span> <span data-ttu-id="8cfae-208">新しいプロジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-208">Create a new project.</span></span> <span data-ttu-id="8cfae-209">これにより、プロジェクト構成ウィザードが起動し、比較するデータベースに関する情報の入力が求められます (図1を参照)。</span><span class="sxs-lookup"><span data-stu-id="8cfae-209">This launches the Project Configuration wizard, which prompts for information about the databases to compare (see Figure 1).</span></span> <span data-ttu-id="8cfae-210">開発環境および運用環境のデータベースの情報を入力します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-210">Enter the information for the development and production environment databases.</span></span>

<span data-ttu-id="8cfae-211">[開発データベースと運用データベースを比較 ![には](strategies-for-database-development-and-deployment-cs/_static/image2.jpg)](strategies-for-database-development-and-deployment-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="8cfae-211">[![Compare the Development and Production Databases](strategies-for-database-development-and-deployment-cs/_static/image2.jpg)](strategies-for-database-development-and-deployment-cs/_static/image1.jpg)</span></span>

<span data-ttu-id="8cfae-212">**図 1**: 開発データベースと運用データベースを比較[する (クリックすると、フルサイズの画像が表示](strategies-for-database-development-and-deployment-cs/_static/image3.jpg)されます)</span><span class="sxs-lookup"><span data-stu-id="8cfae-212">**Figure 1**: Compare the Development and Production Databases ([Click to view full-size image](strategies-for-database-development-and-deployment-cs/_static/image3.jpg))</span></span>

> [!NOTE]
> <span data-ttu-id="8cfae-213">開発環境のデータベースが web サイトの `App_Data` フォルダー内の SQL Express Edition データベースファイルである場合は、図1のようにダイアログボックスから選択するために、データベースを SQL Server Express データベースサーバーに登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-213">If your development environment database is a SQL Express Edition database file in the `App_Data` folder of your website you will need to register the database in the SQL Server Express database server in order to select it from the dialog box shown in Figure 1.</span></span> <span data-ttu-id="8cfae-214">これを実現する最も簡単な方法は、SQL Server Management Studio (SSMS) を開き、SQL Server Express データベースサーバーに接続して、データベースをアタッチすることです。</span><span class="sxs-lookup"><span data-stu-id="8cfae-214">The easiest way to accomplish this is to open SQL Server Management Studio (SSMS), connect to the SQL Server Express database server, and attach the database.</span></span> <span data-ttu-id="8cfae-215">コンピューターに SSMS がインストールされていない場合は、無料の[*SQL Server 2008 Management Studio Basic バージョン*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en)をダウンロードしてインストールすることができます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-215">If you do not have SSMS installed on your computer you can download and install the free [*SQL Server 2008 Management Studio Basic version*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en).</span></span>

<span data-ttu-id="8cfae-216">比較するデータベースを選択するだけでなく、[オプション] タブでさまざまな比較設定を指定することもできます。有効にするオプションの1つとして、"制約とインデックス名の無視" があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-216">In addition to selecting the databases to compare, you can also specify a variety of comparison settings from the Options tab. One option you may want to turn on is the "Ignore constraint and index names."</span></span> <span data-ttu-id="8cfae-217">前のチュートリアルでは、アプリケーションサービスデータベースオブジェクトを開発データベースと運用データベースに追加しました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-217">Recall that in the preceding tutorial we added the application services database objects to the development and production databases.</span></span> <span data-ttu-id="8cfae-218">`aspnet_regsql.exe` ツールを使用して実稼働データベースでこれらのオブジェクトを作成した場合は、主キーと一意の制約名が開発データベースと実稼働データベースで異なっていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-218">If you used the `aspnet_regsql.exe` tool to create these objects on the production database then you will find that the primary key and unique constraint names differ between the development and production databases.</span></span> <span data-ttu-id="8cfae-219">その結果、SQL Compare によって、すべてのアプリケーションサービステーブルが異なるというフラグが付けられます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-219">Consequently, SQL Compare will flag all of the application services tables as differing.</span></span> <span data-ttu-id="8cfae-220">[制約とインデックス名を無視する] をオフのままにして、制約名を同期するか、これらの違いを無視するように SQL Compare に指示できます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-220">You can either leave the "Ignore constraint and index names" unchecked and synchronize the constraint names, or instruct SQL Compare to ignore these differences.</span></span>

<span data-ttu-id="8cfae-221">比較するデータベースを選択し、比較オプションを確認したら、[今すぐ比較] ボタンをクリックして比較を開始します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-221">After selecting the databases to compare (and reviewing the comparison options), click the Compare Now button to begin the comparison.</span></span> <span data-ttu-id="8cfae-222">次の数秒で、SQL 比較は2つのデータベースのスキーマを調べ、それらがどのように異なるかを示すレポートを生成します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-222">Over the next several seconds, SQL Compare examines the schemas of the two databases and generates a report of how they differ.</span></span> <span data-ttu-id="8cfae-223">このような不一致が SQL Compare インターフェイスにどのように記載されているかを示すために、開発データベースに何らかの変更を加えました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-223">I ve purposefully made some modifications to the development database to show how such discrepancies are noted in the SQL Compare interface.</span></span> <span data-ttu-id="8cfae-224">図2に示すように、`Authors` テーブルに `BirthDate` 列を追加し、`Books` テーブルから `ISBN` 列を削除した後、新しい `Ratings`テーブルを追加しました。これは、ユーザーがレビュー対象のブックをサイトにアクセスできるようにするためのものです。</span><span class="sxs-lookup"><span data-stu-id="8cfae-224">As Figure 2 shows, I ve added a `BirthDate` column to the `Authors` table, removed the `ISBN` column from the `Books` table, and added a new table, `Ratings`, which is meant to let users visiting the site rate the reviewed books.</span></span>

> [!NOTE]
> <span data-ttu-id="8cfae-225">このチュートリアルで行ったデータモデルの変更は、データベース比較ツールの使用方法を示すために行われました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-225">The data model changes made in this tutorial were done to illustrate using a database comparison tool.</span></span> <span data-ttu-id="8cfae-226">これらの変更は、今後のチュートリアルではデータベースにはありません。</span><span class="sxs-lookup"><span data-stu-id="8cfae-226">You will not find these changes in the database in future tutorials.</span></span>

<span data-ttu-id="8cfae-227">[![SQL 比較では、開発データベースと運用データベースの違いを示します。](strategies-for-database-development-and-deployment-cs/_static/image5.jpg)](strategies-for-database-development-and-deployment-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="8cfae-227">[![SQL Compare Lists the Differences Between the Development and Production Databases](strategies-for-database-development-and-deployment-cs/_static/image5.jpg)](strategies-for-database-development-and-deployment-cs/_static/image4.jpg)</span></span>

<span data-ttu-id="8cfae-228">**図 2**: SQL 比較では、開発データベースと実稼働データベースの違いを示します ([クリックすると、フルサイズの画像が表示](strategies-for-database-development-and-deployment-cs/_static/image6.jpg)されます)</span><span class="sxs-lookup"><span data-stu-id="8cfae-228">**Figure 2**: SQL Compare Lists the Differences Between the Development and Production Databases ([Click to view full-size image](strategies-for-database-development-and-deployment-cs/_static/image6.jpg))</span></span>

<span data-ttu-id="8cfae-229">SQL 比較では、データベースオブジェクトがグループに分割され、両方のデータベースに存在するオブジェクトはどれか、データベースには存在していても他方には存在しないオブジェクト、および同一のオブジェクトが表示されます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-229">SQL Compare breaks down the database objects into groups, quickly showing you what objects exist in both databases but are different, which objects exist in one database but not the other, and which objects are identical.</span></span> <span data-ttu-id="8cfae-230">ご覧のように、両方のデータベースに存在するオブジェクトは2つありますが、列が追加された `Authors` テーブルと `Books` テーブルが削除されています。</span><span class="sxs-lookup"><span data-stu-id="8cfae-230">As you can see, there are two objects that exist in both databases but are different: the `Authors` table, which had a column added, and the `Books` table, which had one removed.</span></span> <span data-ttu-id="8cfae-231">開発データベース、つまり新しく作成された `Ratings` テーブルにのみ存在するオブジェクトが1つあります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-231">There is one object that exists only in the development database, namely the newly created `Ratings` table.</span></span> <span data-ttu-id="8cfae-232">また、両方のデータベースに同一の117オブジェクトがあります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-232">And there are 117 objects that are identical in both databases.</span></span>

<span data-ttu-id="8cfae-233">データベースオブジェクトを選択すると、[SQL の相違点] ウィンドウが表示され、これらのオブジェクトがどのように異なるかが示されます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-233">Selecting a database object displays the SQL Differences window, which shows how these objects differ.</span></span> <span data-ttu-id="8cfae-234">図2の下部に表示される [SQL の相違点] ウィンドウでは、開発データベースの `Authors` テーブルに `BirthDate` 列があることが強調表示されています。これは、実稼働データベースの `Authors` テーブルにはありません。</span><span class="sxs-lookup"><span data-stu-id="8cfae-234">The SQL Differences window, displayed at the bottom in Figure 2, highlights that the `Authors` table in the development database has the `BirthDate` column, which is not found in the `Authors` table on the production database.</span></span>

<span data-ttu-id="8cfae-235">相違点を確認し、同期するオブジェクトを選択したら、次に、開発データベースに一致するように実稼働データベース s スキーマを更新するために必要な SQL コマンドを生成します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-235">After reviewing the differences and selecting which objects you want to synchronize, the next step is to generate the SQL commands needed to update the production database s schema to match the development database.</span></span> <span data-ttu-id="8cfae-236">これは、同期ウィザードを使用して行います。</span><span class="sxs-lookup"><span data-stu-id="8cfae-236">This is accomplished through the Synchronization Wizard.</span></span> <span data-ttu-id="8cfae-237">同期ウィザードは、同期するオブジェクトとアクションプランの概要を確認します (図3を参照)。</span><span class="sxs-lookup"><span data-stu-id="8cfae-237">The Synchronization Wizard confirms what objects to synchronize and summarizes the action plan (see Figure 3).</span></span> <span data-ttu-id="8cfae-238">データベースをすぐに同期することも、必要に応じて実行できる SQL コマンドを使用してスクリプトを生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-238">You can synchronize the databases immediately or generate a script with the SQL commands that can be run at your leisure.</span></span>

<span data-ttu-id="8cfae-239">[同期ウィザードを使用してデータベーススキーマを同期 ![には](strategies-for-database-development-and-deployment-cs/_static/image8.jpg)](strategies-for-database-development-and-deployment-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="8cfae-239">[![Use the Synchronization Wizard to Synchronize Your Databases Schemas](strategies-for-database-development-and-deployment-cs/_static/image8.jpg)](strategies-for-database-development-and-deployment-cs/_static/image7.jpg)</span></span>

<span data-ttu-id="8cfae-240">**図 3**: 同期ウィザードを使用してデータベーススキーマを同期する ([クリックすると、フルサイズの画像が表示](strategies-for-database-development-and-deployment-cs/_static/image9.jpg)されます)</span><span class="sxs-lookup"><span data-stu-id="8cfae-240">**Figure 3**: Use the Synchronization Wizard to Synchronize Your Databases Schemas ([Click to view full-size image](strategies-for-database-development-and-deployment-cs/_static/image9.jpg))</span></span>

<span data-ttu-id="8cfae-241">Red Gate Software s SQL Compare などのデータベース比較ツールを使用すると、開発データベーススキーマへの変更を、ポイントアンドクリックで簡単に運用データベースに適用することができます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-241">Database comparison tools like Red Gate Software s SQL Compare make applying the changes to the development database schema to the production database as easy as point and click.</span></span>

> [!NOTE]
> <span data-ttu-id="8cfae-242">SQL 比較では、2つのデータベース*スキーマ*を比較して同期します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-242">SQL Compare compares and synchronizes two databases *schemas*.</span></span> <span data-ttu-id="8cfae-243">残念ながら、2つのデータベーステーブル内のデータを比較して同期することはありません。</span><span class="sxs-lookup"><span data-stu-id="8cfae-243">Unfortunately, it does not compare and synchronize the data within two databases tables.</span></span> <span data-ttu-id="8cfae-244">Red Gate ソフトウェアには、2つのデータベース間でデータを比較して同期する[*Sql データ比較*](http://www.red-gate.com/products/SQL_Data_Compare/)という製品が用意されていますが、Sql の比較と、別の $395 のコストの別の製品です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-244">Red Gate Software does offer a product named [*SQL Data Compare*](http://www.red-gate.com/products/SQL_Data_Compare/) that compares and synchronizes the data between two databases, but it is a separate product from SQL Compare and costs another $395.</span></span>

## <a name="taking-the-application-offline-during-deployment"></a><span data-ttu-id="8cfae-245">デプロイ中にアプリケーションをオフラインにする</span><span class="sxs-lookup"><span data-stu-id="8cfae-245">Taking the Application Offline During Deployment</span></span>

<span data-ttu-id="8cfae-246">これらのチュートリアル全体で見てきたように、デプロイは、ASP.NET ページ、マスターページ、CSS ファイル、JavaScript ファイル、画像、およびその他の必要なコンテンツを開発環境から運用環境にコピーするという複数の手順を伴うプロセスです。environment必要に応じて、運用環境固有の構成情報をコピーします。最後の配置以降にデータモデルに変更を適用します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-246">As we ve seen throughout these tutorials, deployment is a process that involves multiple steps: copying the ASP.NET pages, master pages, CSS files, JavaScript files, images, and other necessary content from the development environment to the production environment; copying up the production environment-specific configuration information, if needed; and applying the changes to the data model since the last deployment.</span></span> <span data-ttu-id="8cfae-247">ファイルの数やデータベースの複雑さによっては、これらの手順が完了するまで数秒から数分かかることがあります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-247">Depending on the number of files and the complexity of your database changes, these steps can take anywhere from a few seconds to several minutes to complete.</span></span> <span data-ttu-id="8cfae-248">このウィンドウでは、web アプリケーションが流動的で、サイトにアクセスしているユーザーがエラーまたは予期しない動作をする場合があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-248">During this window the web application is in flux and users visiting the site may experience errors or unexpected behavior.</span></span>

<span data-ttu-id="8cfae-249">Web サイトをデプロイする場合は、デプロイが完了するまで web アプリケーションを "オフライン" にすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8cfae-249">When deploying a website it is best to take the web application "offline" until deployment has completed.</span></span> <span data-ttu-id="8cfae-250">アプリケーションをオフラインにし (展開プロセスが完了した後でバックアップを復元する)、ファイルをアップロードしてから削除するのと同じように簡単です。</span><span class="sxs-lookup"><span data-stu-id="8cfae-250">Taking the application offline (and bringing it back up once the deployment process has finished) is as easy as uploading a file and then deleting it.</span></span> <span data-ttu-id="8cfae-251">ASP.NET 2.0 以降では、アプリケーションのルートディレクトリに `app_offline.htm` という名前のファイルが存在するだけでは、web サイト全体が "オフライン" になります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-251">Starting with ASP.NET 2.0, the mere presence of a file named `app_offline.htm` in the application s root directory takes the entire website "offline."</span></span> <span data-ttu-id="8cfae-252">そのサイトの ASP.NET ページに対するすべての要求は、`app_offline.htm` ファイルの内容で自動的に応答します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-252">Any request to an ASP.NET page on that site is automatically responded with the contents of the `app_offline.htm` file.</span></span> <span data-ttu-id="8cfae-253">ファイルが削除されると、アプリケーションはオンラインに戻ります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-253">Once that file is removed, the application comes back online.</span></span>

<span data-ttu-id="8cfae-254">デプロイ中にアプリケーションをオフラインにすると、デプロイが完了すると、展開プロセスを開始する前に `app_offline.htm` ファイルを実稼働環境のルートディレクトリにアップロードするのと同じように簡単に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-254">Taking an application offline during deployment, then, is as simple as uploading an `app_offline.htm` file to the production environment s root directory prior to beginning the deployment process and then deleting it (or renaming it to something else) once deployment is complete.</span></span> <span data-ttu-id="8cfae-255">この手法の詳細については、John Peterson の記事「 [*ASP.NET アプリケーションをオフライン*](http://www.15seconds.com/issue/061207.htm)にする」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8cfae-255">For more information on this technique refer to John Peterson s article, Taking an [*ASP.NET Application Offline*](http://www.15seconds.com/issue/061207.htm).</span></span>

## <a name="summary"></a><span data-ttu-id="8cfae-256">まとめ</span><span class="sxs-lookup"><span data-stu-id="8cfae-256">Summary</span></span>

<span data-ttu-id="8cfae-257">データドリブンアプリケーションを配置する際の主な課題は、データベースの配置に関するものです。</span><span class="sxs-lookup"><span data-stu-id="8cfae-257">The main challenge in deploying a data-driven application centers around deploying the database.</span></span> <span data-ttu-id="8cfae-258">2つのバージョンのデータベース (開発環境に1つ、運用環境に存在する) があるため、開発時に新機能が追加されると、これら2つのデータベーススキーマは同期しなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8cfae-258">Because there are two versions of the database - one in the development environment and one in the production environment - these two databases schemas can become out of sync as new features are added in development.</span></span> <span data-ttu-id="8cfae-259">さらに、実稼働データベースは実際のユーザーからの実際のデータを使用して作成されているため、アプリケーションを構成するファイルを配置するときのように、変更された開発データベースで運用データベースを上書きすることはできません (ASP.NET ページ、画像ファイルなど)。</span><span class="sxs-lookup"><span data-stu-id="8cfae-259">What s more, because the production database as being populated with real data from real users, you cannot overwrite the production database with the modified development database like you can when deploying the files that make up the application (the ASP.NET pages, image files, and so forth).</span></span> <span data-ttu-id="8cfae-260">その代わりに、データベースを配置するには、前回の配置以降に運用データベースで開発データベースに加えられた変更の正確なセットを実装することが伴います。</span><span class="sxs-lookup"><span data-stu-id="8cfae-260">Instead, deploying a database entails implementing the precise set of changes made to the development database on the production database since the last deployment.</span></span>

<span data-ttu-id="8cfae-261">このチュートリアルでは、データベースの変更のログを保持して適用するための3つの方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="8cfae-261">This tutorial looked at three techniques for maintaining and applying a log of database changes.</span></span> <span data-ttu-id="8cfae-262">最も簡単な方法は、prose で変更を記録することです。</span><span class="sxs-lookup"><span data-stu-id="8cfae-262">The simplest approach is to record the changes in prose.</span></span> <span data-ttu-id="8cfae-263">これにより、これらの変更を実稼働データベースに手動で実装できるようになりますが、データベースオブジェクトを作成および変更するための SQL コマンドに関する知識は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="8cfae-263">While this tactic makes implementing these changes on the production database a manual process, it does not require knowledge of the SQL commands for creating and altering database objects.</span></span> <span data-ttu-id="8cfae-264">より高度なアプローチと、複数の開発者を持つ大規模なプロジェクトまたはプロジェクトのつながりがはるかに多い場合は、変更を一連の SQL コマンドとして記録することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8cfae-264">A more sophisticated approach, and one that is much more palatable in larger projects or projects with multiple developers, is to record the changes as a series of SQL commands.</span></span> <span data-ttu-id="8cfae-265">これにより、これらの変更をターゲットデータベースにロールアウトすることが大幅に hastens されます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-265">This greatly hastens rolling out these changes to the target database.</span></span> <span data-ttu-id="8cfae-266">どちらの方法も、Red Gate Software s SQL Compare などのデータベース比較ツールを使用して実現できます。</span><span class="sxs-lookup"><span data-stu-id="8cfae-266">The best of both approaches can be achieved by using a database comparison tool, such as Red Gate Software s SQL Compare.</span></span>

<span data-ttu-id="8cfae-267">このチュートリアルでは、データドリブンアプリケーションの配置について説明します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-267">This tutorial concludes our focus on deploying a data-driven application.</span></span> <span data-ttu-id="8cfae-268">次の一連のチュートリアルでは、運用環境でのエラーに対応する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-268">The next set of tutorials looks at how to respond to errors in the production environment.</span></span> <span data-ttu-id="8cfae-269">ここでは、黄色い画面ではなく、わかりやすいエラーページを表示する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-269">We'll look at how to display a friendly error page rather instead of the Yellow Screen of Death.</span></span> <span data-ttu-id="8cfae-270">エラーの詳細をログに記録する方法と、そのようなエラーが発生したときにアラートを通知する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="8cfae-270">And we'll see how to log the error s details and how to alert you when such errors occur.</span></span>

<span data-ttu-id="8cfae-271">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="8cfae-271">Happy Programming!</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8cfae-272">[前へ](configuring-a-website-that-uses-application-services-cs.md)
> [次へ](displaying-a-custom-error-page-cs.md)</span><span class="sxs-lookup"><span data-stu-id="8cfae-272">[Previous](configuring-a-website-that-uses-application-services-cs.md)
[Next](displaying-a-custom-error-page-cs.md)</span></span>
