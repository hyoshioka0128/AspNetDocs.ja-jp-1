---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-vb
title: アプリケーションサービスを使用する Web サイトの構成 (VB) |Microsoft Docs
author: rick-anderson
description: ASP.NET バージョン2.0 では、一連のアプリケーションサービスが導入されました。このサービスは、.NET Framework の一部であり、そのため、
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 9c31a42f-d8bb-4c0f-9ccc-597d4f70ac42
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-vb
msc.type: authoredcontent
ms.openlocfilehash: 19e7258b558372259c7554a36c6ad73ce572dfa8
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74588649"
---
# <a name="configuring-a-website-that-uses-application-services-vb"></a><span data-ttu-id="f7259-103">アプリケーション サービスを使用する Web サイトを構成する (VB)</span><span class="sxs-lookup"><span data-stu-id="f7259-103">Configuring a Website that Uses Application Services (VB)</span></span>

<span data-ttu-id="f7259-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f7259-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f7259-105">[コードのダウンロード](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_VB.zip)または[PDF のダウンロード](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="f7259-105">[Download Code](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_VB.zip) or [Download PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_vb.pdf)</span></span>

> <span data-ttu-id="f7259-106">ASP.NET バージョン2.0 では、一連のアプリケーションサービスが導入されました。これは .NET Framework の一部であり、web アプリケーションに豊富な機能を追加するために使用できるビルディングブロックサービスのスイートとして機能します。</span><span class="sxs-lookup"><span data-stu-id="f7259-106">ASP.NET version 2.0 introduced a series of application services, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="f7259-107">このチュートリアルでは、運用環境でアプリケーションサービスを使用するように web サイトを構成し、運用環境でのユーザーアカウントとロールの管理に関する一般的な問題に対処する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f7259-107">This tutorial explores how to configure a website in the production environment to use application services and addresses common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="introduction"></a><span data-ttu-id="f7259-108">はじめに</span><span class="sxs-lookup"><span data-stu-id="f7259-108">Introduction</span></span>

<span data-ttu-id="f7259-109">ASP.NET バージョン2.0 では、一連の*アプリケーションサービス*が導入されました。これは .NET Framework の一部であり、web アプリケーションに豊富な機能を追加するために使用できるビルディングブロックサービスのスイートとして機能します。</span><span class="sxs-lookup"><span data-stu-id="f7259-109">ASP.NET version 2.0 introduced a series of *application services*, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="f7259-110">アプリケーションサービスには次のものが含まれます。</span><span class="sxs-lookup"><span data-stu-id="f7259-110">The application services include:</span></span>

- <span data-ttu-id="f7259-111">**メンバーシップ**-ユーザーアカウントを作成および管理するための API です。</span><span class="sxs-lookup"><span data-stu-id="f7259-111">**Membership** - an API for creating and managing user accounts.</span></span>
- <span data-ttu-id="f7259-112">**ロール**-ユーザーをグループに分類するための API です。</span><span class="sxs-lookup"><span data-stu-id="f7259-112">**Roles** - an API for categorizing users into groups.</span></span>
- <span data-ttu-id="f7259-113">**Profile** -ユーザー固有のカスタムコンテンツを格納するための API。</span><span class="sxs-lookup"><span data-stu-id="f7259-113">**Profile** - an API for storing custom, user-specific content.</span></span>
- <span data-ttu-id="f7259-114">**サイトマップ**-階層の形式でサイトの論理構造を定義するための API。これは、メニューや階層リンクなどのナビゲーションコントロールを使用して表示できます。</span><span class="sxs-lookup"><span data-stu-id="f7259-114">**Site Map** - an API for defining a site s logical structure in the form of a hierarchy, which can then be displayed via navigation controls, such as menus and breadcrumbs.</span></span>
- <span data-ttu-id="f7259-115">**パーソナル化**-カスタマイズ設定を維持するための API。これは、ほとんどの場合、 [*web パーツ*](https://msdn.microsoft.com/library/e0s9t4ck.aspx)で使用されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-115">**Personalization** - an API for maintaining customization preferences, most often used with [*WebParts*](https://msdn.microsoft.com/library/e0s9t4ck.aspx).</span></span>
- <span data-ttu-id="f7259-116">**正常性の監視**-実行中の web アプリケーションのパフォーマンス、セキュリティ、エラー、およびその他のシステム正常性メトリックを監視するための API です。</span><span class="sxs-lookup"><span data-stu-id="f7259-116">**Health Monitoring** - an API for monitoring performance, security, errors, and other system health metrics for a running web application.</span></span>

<span data-ttu-id="f7259-117">アプリケーションサービス Api は、特定の実装に関連付けられていません。</span><span class="sxs-lookup"><span data-stu-id="f7259-117">The application services APIs are not tied to a specific implementation.</span></span> <span data-ttu-id="f7259-118">代わりに、特定の*プロバイダー*を使用するようにアプリケーションサービスに指示します。このプロバイダーは、特定のテクノロジを使用してサービスを実装します。</span><span class="sxs-lookup"><span data-stu-id="f7259-118">Instead, you instruct the application services to use a particular *provider*, and that provider implements the service using a particular technology.</span></span> <span data-ttu-id="f7259-119">Web ホスティング会社でホストされているインターネットベースの web アプリケーションで最もよく使用されるプロバイダーは、SQL Server データベースの実装を使用するプロバイダーです。</span><span class="sxs-lookup"><span data-stu-id="f7259-119">The most commonly used providers for Internet-based web applications hosted at a web hosting company are those providers that use a SQL Server database implementation.</span></span> <span data-ttu-id="f7259-120">たとえば、`SqlMembershipProvider` は、ユーザーアカウント情報を Microsoft SQL Server データベースに格納するメンバーシップ API のプロバイダーです。</span><span class="sxs-lookup"><span data-stu-id="f7259-120">For example, the `SqlMembershipProvider` is a provider for the Membership API that stores user account information in a Microsoft SQL Server database.</span></span>

<span data-ttu-id="f7259-121">アプリケーションサービスと SQL Server プロバイダーを使用すると、アプリケーションを展開するときにいくつかの課題が生じます。</span><span class="sxs-lookup"><span data-stu-id="f7259-121">Using the application services and SQL Server providers adds some challenges when deploying the application.</span></span> <span data-ttu-id="f7259-122">手始めとして、アプリケーションサービスデータベースオブジェクトは、開発データベースと運用データベースの両方で適切に作成され、適切に初期化されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-122">For starters, the application services database objects must be properly created on both the development and production databases and appropriately initialized.</span></span> <span data-ttu-id="f7259-123">また、重要な構成設定を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-123">There are also important configuration settings that need to be made.</span></span>

> [!NOTE]
> <span data-ttu-id="f7259-124">アプリケーションサービス Api は、API の実装の詳細を実行時に提供できるようにするデザインパターンである[*プロバイダーモデル*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)を使用して設計されています。</span><span class="sxs-lookup"><span data-stu-id="f7259-124">The application services APIs were designed using the [*provider model*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), a design pattern that allows for an API s implementation details to be provided at runtime.</span></span> <span data-ttu-id="f7259-125">.NET Framework には、`SqlMembershipProvider` や `SqlRoleProvider`など、使用できるアプリケーションサービスプロバイダーが多数付属しています。これは、SQL Server データベースの実装を使用するメンバーシップおよびロール Api のプロバイダーです。</span><span class="sxs-lookup"><span data-stu-id="f7259-125">The .NET Framework ships with a number of application service providers that can be used, such as the `SqlMembershipProvider` and `SqlRoleProvider`, which are providers for the Membership and Roles APIs that use a SQL Server database implementation.</span></span> <span data-ttu-id="f7259-126">カスタムプロバイダーを作成してプラグインすることもできます。</span><span class="sxs-lookup"><span data-stu-id="f7259-126">You can also create and plug-in a custom provider.</span></span> <span data-ttu-id="f7259-127">実際、書籍レビュー web アプリケーションには、サイトマップ API (`ReviewSiteMapProvider`) のカスタムプロバイダーが既に含まれています。これにより、データベース内の `Genres` と `Books` テーブルのデータからサイトマップが構築されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-127">In fact, the Book Reviews web application already contains a custom provider for the Site Map API (`ReviewSiteMapProvider`), which constructs the site map from the data in the `Genres` and `Books` tables in the database.</span></span>

<span data-ttu-id="f7259-128">このチュートリアルでは、まず、書籍レビュー web アプリケーションを拡張して、メンバーシップとロールの Api を使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f7259-128">This tutorial starts with a look at how I extended the Book Reviews web application to use the Membership and Roles APIs.</span></span> <span data-ttu-id="f7259-129">次に、アプリケーションサービスを使用する web アプリケーションを SQL Server データベース実装と共に配置し、最後に、運用環境でのユーザーアカウントとロールの管理に関する一般的な問題に対処します。</span><span class="sxs-lookup"><span data-stu-id="f7259-129">It then walks through deploying a web application that uses application services with a SQL Server database implementation, and concludes by addressing common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="updates-to-the-book-reviews-application"></a><span data-ttu-id="f7259-130">書籍レビューアプリケーションの更新</span><span class="sxs-lookup"><span data-stu-id="f7259-130">Updates to the Book Reviews Application</span></span>

<span data-ttu-id="f7259-131">これまでのいくつかのチュートリアルでは、書籍レビュー web アプリケーションが静的な web サイトから動的なデータドリブン web アプリケーションに更新され、ジャンルとレビューを管理するための管理ページが用意されています。</span><span class="sxs-lookup"><span data-stu-id="f7259-131">Over the past couple tutorials the Book Reviews web application was updated from a static website to a dynamic, data-driven web application complete with a set of administration pages for managing genres and reviews.</span></span> <span data-ttu-id="f7259-132">ただし、この管理セクションは現在保護されていません。管理ページの URL を知っている (または推測された) ユーザーは、サイトでのレビューの waltz と作成、編集、または削除を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="f7259-132">However, this administration section is currently not protected - any user who knows (or guesses) the administration page URL can waltz in and create, edit, or delete reviews on our site.</span></span> <span data-ttu-id="f7259-133">Web サイトの特定の部分を保護する一般的な方法は、ユーザーアカウントを実装してから、URL 承認規則を使用して特定のユーザーまたはロールへのアクセスを制限することです。</span><span class="sxs-lookup"><span data-stu-id="f7259-133">A common way to protect certain portions of a website is to implement user accounts and then use URL authorization rules to restrict access to certain users or roles.</span></span> <span data-ttu-id="f7259-134">このチュートリアルでダウンロードできる書籍レビュー web アプリケーションでは、ユーザーアカウントとロールがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="f7259-134">The Book Reviews web application available for download with this tutorial supports user accounts and roles.</span></span> <span data-ttu-id="f7259-135">管理者という名前のロールが1つ定義されており、このロールのユーザーのみが管理ページにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="f7259-135">It has a single role defined named Admin and only users in this role can access the administration pages.</span></span>

> [!NOTE]
> <span data-ttu-id="f7259-136">彼は、"Scott"、"Jisun"、"Alice" の3人のユーザーアカウントを作成しました。</span><span class="sxs-lookup"><span data-stu-id="f7259-136">I ve created three user accounts in the Book Reviews web application: Scott, Jisun, and Alice.</span></span> <span data-ttu-id="f7259-137">3人のユーザーはすべて、パスワードと同じパスワードを持って**います。**</span><span class="sxs-lookup"><span data-stu-id="f7259-137">All three users have the same password: **password!**</span></span> <span data-ttu-id="f7259-138">Scott と Jisun は管理者ロールに含まれていますが、Alice はありません。</span><span class="sxs-lookup"><span data-stu-id="f7259-138">Scott and Jisun are in the Admin role, Alice is not.</span></span> <span data-ttu-id="f7259-139">サイトの管理者以外のページには、匿名ユーザーが引き続きアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="f7259-139">The site s non-administration pages are still accessible to anonymous users.</span></span> <span data-ttu-id="f7259-140">つまり、サイトにアクセスするためにサインインする必要はありません。ただし、管理する場合は、管理者ロールのユーザーとしてサインインする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-140">That is, you do not need to sign in to visit the site, unless you want to administer it, in which case you must sign in as a user in the Admin role.</span></span>

<span data-ttu-id="f7259-141">[Book review application s] マスターページが更新され、認証および匿名ユーザー用に異なるユーザーインターフェイスが追加されました。</span><span class="sxs-lookup"><span data-stu-id="f7259-141">The Book Reviews application s master page has been updated to include a different user interface for authenticated and anonymous users.</span></span> <span data-ttu-id="f7259-142">匿名ユーザーがサイトにアクセスすると、右上隅にログインリンクが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-142">If an anonymous user visits the site she sees a Login link in the upper right corner.</span></span> <span data-ttu-id="f7259-143">認証されたユーザーには、"Welcome back, *username*!" というメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-143">An authenticated user sees the message, "Welcome back, *username*!"</span></span> <span data-ttu-id="f7259-144">また、ログアウトするためのリンクがあります。また、ログインページ (`~/Login.aspx`) もあります。これには、ビジターを認証するためのユーザーインターフェイスとロジックを提供するログイン Web コントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="f7259-144">and a link to log out. There s also a login page (`~/Login.aspx`), which contains a Login Web control that provides the user interface and logic for authenticating a visitor.</span></span> <span data-ttu-id="f7259-145">新しいアカウントを作成できるのは管理者だけです。</span><span class="sxs-lookup"><span data-stu-id="f7259-145">Only administrators can create new accounts.</span></span> <span data-ttu-id="f7259-146">(`~/Admin` フォルダー内のユーザーアカウントを作成および管理するためのページがあります)。</span><span class="sxs-lookup"><span data-stu-id="f7259-146">(There are pages for creating and managing user accounts in the `~/Admin` folder.)</span></span>

### <a name="configuring-the-membership-and-roles-apis"></a><span data-ttu-id="f7259-147">メンバーシップ Api とロール Api の構成</span><span class="sxs-lookup"><span data-stu-id="f7259-147">Configuring the Membership and Roles APIs</span></span>

<span data-ttu-id="f7259-148">書籍レビュー web アプリケーションは、メンバーシップとロール Api を使用してユーザーアカウントをサポートし、それらのユーザーをロール (つまり、管理者ロール) にグループ化します。</span><span class="sxs-lookup"><span data-stu-id="f7259-148">The Book Reviews web application uses the Membership and Roles APIs to support user accounts and to group those users into roles (namely, the Admin role).</span></span> <span data-ttu-id="f7259-149">`SqlMembershipProvider` および `SqlRoleProvider` プロバイダークラスが使用されます。これは、アカウントとロールの情報を SQL Server データベースに格納するためです。</span><span class="sxs-lookup"><span data-stu-id="f7259-149">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes are used because we want to store account and role information in a SQL Server database.</span></span>

> [!NOTE]
> <span data-ttu-id="f7259-150">このチュートリアルは、メンバーシップとロールの Api をサポートする web アプリケーションの構成に関する詳細な調査を目的としたものではありません。</span><span class="sxs-lookup"><span data-stu-id="f7259-150">This tutorial is not intended to be a detailed examination at configuring a web application to support the Membership and Roles APIs.</span></span> <span data-ttu-id="f7259-151">これらの Api と、それらを使用するように web サイトを構成するために必要な手順について詳しくは、 [*Web サイトのセキュリティ*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)に関するチュートリアルをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="f7259-151">For a thorough look at these APIs and the steps you need to take to configure a website to use them, please read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

<span data-ttu-id="f7259-152">SQL Server データベースでアプリケーションサービスを使用するには、まず、ユーザーアカウントとロール情報を格納するデータベースに、これらのプロバイダーによって使用されるデータベースオブジェクトを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-152">To use the application services with a SQL Server database you must first add the database objects used by these providers to the database where you want the user account and role information stored.</span></span> <span data-ttu-id="f7259-153">これらの必要なデータベースオブジェクトには、さまざまなテーブル、ビュー、およびストアドプロシージャが含まれます。</span><span class="sxs-lookup"><span data-stu-id="f7259-153">These requisite database objects include a variety of tables, views, and stored procedures.</span></span> <span data-ttu-id="f7259-154">特に指定しない限り、`SqlMembershipProvider` および `SqlRoleProvider` プロバイダークラスは、application s `App_Data` フォルダーにある `ASPNETDB` という SQL Server Express エディションのデータベースを使用します。このようなデータベースが存在しない場合は、実行時にこれらのプロバイダーによって必要なデータベースオブジェクトと共に自動的に作成されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-154">Unless specified otherwise, the `SqlMembershipProvider` and `SqlRoleProvider` provider classes use a SQL Server Express Edition database named `ASPNETDB` located in the application s `App_Data` folder; if such a database does not exist, it is automatically created with the necessary database objects by these providers at runtime.</span></span>

<span data-ttu-id="f7259-155">Web サイトのアプリケーション固有のデータが格納されているのと同じデータベースに、アプリケーションサービスデータベースオブジェクトを作成することは可能であり、通常は理想的です。</span><span class="sxs-lookup"><span data-stu-id="f7259-155">It is possible, and usually ideal, to create the application services database objects in the same database where the website s application-specific data is stored.</span></span> <span data-ttu-id="f7259-156">.NET Framework には、指定されたデータベースにデータベースオブジェクトをインストールする `aspnet_regsql.exe` という名前のツールが付属しています。</span><span class="sxs-lookup"><span data-stu-id="f7259-156">The .NET Framework ships with a tool named `aspnet_regsql.exe` that installs the database objects on a specified database.</span></span> <span data-ttu-id="f7259-157">このツールを使用して、これらのオブジェクトを `App_Data` フォルダー (開発データベース) の `Reviews.mdf` データベースに追加しました。</span><span class="sxs-lookup"><span data-stu-id="f7259-157">I have gone ahead and used this tool to add these objects to the `Reviews.mdf` database in the `App_Data` folder (the development database).</span></span> <span data-ttu-id="f7259-158">このツールの使用方法については、このチュートリアルの後半で、これらのオブジェクトを実稼働データベースに追加するときに説明します。</span><span class="sxs-lookup"><span data-stu-id="f7259-158">We'll see how to use this tool later in this tutorial when we add these objects to the production database.</span></span>

<span data-ttu-id="f7259-159">アプリケーションサービスデータベースオブジェクトを `ASPNETDB` 以外のデータベースに追加する場合は、適切なデータベースを使用するように `SqlMembershipProvider` および `SqlRoleProvider` プロバイダークラスの構成をカスタマイズする必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-159">If you add the application services database objects to a database other than `ASPNETDB` you will need to customize the `SqlMembershipProvider` and `SqlRoleProvider` provider classes configurations so that they use the appropriate database.</span></span> <span data-ttu-id="f7259-160">メンバーシッププロバイダーをカスタマイズするには、`Web.config`の `<system.web>` セクション内に[ *&lt;メンバーシップ&gt; 要素*](https://msdn.microsoft.com/library/1b9hw62f.aspx)を追加します。ロールプロバイダーを構成するには、 [ *&lt;roleManager&gt; 要素*](https://msdn.microsoft.com/library/ms164660.aspx)を使用します。</span><span class="sxs-lookup"><span data-stu-id="f7259-160">To customize the Membership provider add a [*&lt;membership&gt; element*](https://msdn.microsoft.com/library/1b9hw62f.aspx) within the `<system.web>` section in `Web.config`; use the [*&lt;roleManager&gt; element*](https://msdn.microsoft.com/library/ms164660.aspx) to configure the Roles provider.</span></span> <span data-ttu-id="f7259-161">次のスニペットは、「Book review application s `Web.config`」に記載されています。また、メンバーシップとロールの Api の構成設定についても説明しています。</span><span class="sxs-lookup"><span data-stu-id="f7259-161">The following snippet is taken from the Book Reviews application s `Web.config` and shows the configure settings for the Membership and Roles APIs.</span></span> <span data-ttu-id="f7259-162">`SqlMembershipProvider` と `SqlRoleProvider` プロバイダーをそれぞれ使用する新しいプロバイダー `ReviewMembership` と `ReviewRole` が登録されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="f7259-162">Note that both register a new provider - `ReviewMembership` and `ReviewRole` - that use the `SqlMembershipProvider` and `SqlRoleProvider` providers, respectively.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample1.xml)]

<span data-ttu-id="f7259-163">`Web.config` file s `<authentication>` 要素は、フォームベースの認証をサポートするように構成されています。</span><span class="sxs-lookup"><span data-stu-id="f7259-163">The `Web.config` file s `<authentication>` element has also been configured to support forms-based authentication.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample2.xml)]

### <a name="limiting-access-to-the-administration-pages"></a><span data-ttu-id="f7259-164">管理ページへのアクセスの制限</span><span class="sxs-lookup"><span data-stu-id="f7259-164">Limiting Access to the Administration Pages</span></span>

<span data-ttu-id="f7259-165">ASP.NET を使用すると、特定のファイルまたはフォルダーへのアクセスを、ユーザーまたはロールによって*URL 承認*機能を介して簡単に許可または拒否できます。</span><span class="sxs-lookup"><span data-stu-id="f7259-165">ASP.NET makes it easy to grant or deny access to a particular file or folder by user or by role via its *URL authorization* feature.</span></span> <span data-ttu-id="f7259-166">(URL 承認については、 *iis と ASP.NET 開発サーバー*チュートリアルの主な違いについて簡単に説明し、iis と ASP.NET 開発サーバーが静的コンテンツと動的コンテンツに対して異なる url 承認規則を適用する方法を示しています)。管理者ロールのユーザーを除き、`~/Admin` フォルダーへのアクセスを禁止する必要があるため、このフォルダーに URL 承認規則を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-166">(We briefly discussed URL authorization in the *Core Differences Between IIS and the ASP.NET Development Server* tutorial and showed how IIS and the ASP.NET Development Server apply URL authorization rules differently for static versus dynamic content.) Because we want to prohibit access to the `~/Admin` folder except for those users in the Admin role, we need to add URL authorization rules to this folder.</span></span> <span data-ttu-id="f7259-167">具体的には、URL 承認規則では、管理者ロールのユーザーに許可し、他のすべてのユーザーを拒否する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-167">Specifically, the URL authorization rules need to allow users in the Admin role and deny all other users.</span></span> <span data-ttu-id="f7259-168">これを行うには、次の内容で `~/Admin` フォルダーに `Web.config` ファイルを追加します。</span><span class="sxs-lookup"><span data-stu-id="f7259-168">This is accomplished by adding a `Web.config` file to the `~/Admin` folder with the following contents:</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample3.xml)]

<span data-ttu-id="f7259-169">ASP.NET s URL 承認機能の詳細と、この機能を使用してユーザーおよびロールの承認規則を確認する方法の詳細については、「 [*Web サイトのセキュリティチュートリアル*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)」の「[*ユーザーベースの承認*](../../older-versions-security/membership/user-based-authorization-vb.md)と[*ロールベースの承認*](../../older-versions-security/roles/role-based-authorization-vb.md)のチュートリアル」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f7259-169">For more information on ASP.NET s URL authorization feature and how to use it to spell out authorization rules for users and for roles, be sure to read the [*User-Based Authorization*](../../older-versions-security/membership/user-based-authorization-vb.md) and [*Role-Based Authorization*](../../older-versions-security/roles/role-based-authorization-vb.md) tutorials from my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

## <a name="deploying-a-web-application-that-uses-application-services"></a><span data-ttu-id="f7259-170">アプリケーションサービスを使用する Web アプリケーションの配置</span><span class="sxs-lookup"><span data-stu-id="f7259-170">Deploying a Web Application That Uses Application Services</span></span>

<span data-ttu-id="f7259-171">アプリケーションサービスを使用する web サイトおよびアプリケーションサービス情報をデータベースに格納するプロバイダーを配置する場合は、アプリケーションサービスに必要なデータベースオブジェクトを実稼働データベースに作成することが不可欠です。</span><span class="sxs-lookup"><span data-stu-id="f7259-171">When deploying a website that uses application services and a provider that stores the application services information in a database, it is imperative that the database objects needed by the application services be created on the production database.</span></span> <span data-ttu-id="f7259-172">初期状態では、実稼働データベースにはこれらのオブジェクトが含まれていないため、アプリケーションを最初に配置するとき (または、アプリケーションサービスを追加した後に初めて配置するとき) は、次のような必要なデータベースオブジェクトを取得するための追加の手順を実行する必要があります。実稼働データベース。</span><span class="sxs-lookup"><span data-stu-id="f7259-172">Initially the production database does not contain these objects, so when the application is first deployed (or when it is deployed for the first time after application services have been added), you must take extra steps to get these requisite database objects on the production database.</span></span>

<span data-ttu-id="f7259-173">開発環境で作成されたユーザーアカウントを運用環境にレプリケートする予定がある場合は、アプリケーションサービスを使用する web サイトをデプロイするときに、もう1つの問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-173">Another challenge can arise when deploying a website that uses application services if you intend to replicate the user accounts created in the development environment to the production environment.</span></span> <span data-ttu-id="f7259-174">メンバーシップとロールの構成によっては、開発環境で作成されたユーザーアカウントを実稼働データベースに正常にコピーした場合でも、これらのユーザーが運用環境で web アプリケーションにサインインできなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-174">Depending on the Membership and Roles configuration, it is possible that even if you successfully copy the user accounts that were created in the development environment to the production database, these users cannot sign into the web application in production.</span></span> <span data-ttu-id="f7259-175">この問題の原因を確認し、この問題が発生しないようにする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f7259-175">We'll look at the cause of this issue and discuss how to prevent it from happening.</span></span>

<span data-ttu-id="f7259-176">ASP.NET には、Visual Studio から起動できる便利な[*Web サイト管理ツール (WSAT)* ](https://msdn.microsoft.com/library/yy40ytx0.aspx)が付属しています。このツールを使用すると、ユーザーアカウント、ロール、および承認規則を web ベースのインターフェイスを介して管理できます。</span><span class="sxs-lookup"><span data-stu-id="f7259-176">ASP.NET ships with a nice [*Web Site Administration Tool (WSAT)*](https://msdn.microsoft.com/library/yy40ytx0.aspx) that can be launched from Visual Studio and allows the user account, roles, and authorization rules to be managed through a web-based interface.</span></span> <span data-ttu-id="f7259-177">残念ながら、WSAT はローカル web サイトに対してのみ機能します。つまり、運用環境で web アプリケーションのユーザーアカウント、ロール、および承認規則をリモートで管理するために使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="f7259-177">Unfortunately, the WSAT only works for local websites, meaning that it cannot be used to remotely manage user accounts, roles, and authorization rules for the web application in the production environment.</span></span> <span data-ttu-id="f7259-178">運用 web サイトから WSAT のような動作を実装するためのさまざまな方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f7259-178">We'll look at different ways to implement WSAT-like behavior from your production website.</span></span>

### <a name="adding-the-database-objects-using-aspnet_regsqlexe"></a><span data-ttu-id="f7259-179">Aspnet\_使用してデータベースオブジェクトを追加する</span><span class="sxs-lookup"><span data-stu-id="f7259-179">Adding the Database Objects Using aspnet\_regsql.exe</span></span>

<span data-ttu-id="f7259-180">*データベースの配置*に関するチュートリアルでは、開発データベースから実稼働データベースにテーブルとデータをコピーする方法を説明しました。これらの手法を使用すると、アプリケーションサービスデータベースオブジェクトを実稼働データベースにコピーすることができます。</span><span class="sxs-lookup"><span data-stu-id="f7259-180">The *Deploying a Database* tutorial showed how to copy the tables and data from the development database to the production database, and these techniques can certainly be used to copy the application services database objects to the production database.</span></span> <span data-ttu-id="f7259-181">もう1つのオプションは、アプリケーションサービスデータベースオブジェクトをデータベースから追加または削除する `aspnet_regsql.exe` ツールです。</span><span class="sxs-lookup"><span data-stu-id="f7259-181">Another option is the `aspnet_regsql.exe` tool, which adds or removes the application services database objects from a database.</span></span>

> [!NOTE]
> <span data-ttu-id="f7259-182">`aspnet_regsql.exe` ツールは、指定されたデータベースにデータベースオブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="f7259-182">The `aspnet_regsql.exe` tool creates the database objects on a specified database.</span></span> <span data-ttu-id="f7259-183">これらのデータベースオブジェクトのデータは、開発データベースから実稼働データベースに移行されません。</span><span class="sxs-lookup"><span data-stu-id="f7259-183">It does not migrate data in those database objects from the development database to the production database.</span></span> <span data-ttu-id="f7259-184">開発データベースのユーザーアカウントとロール情報を運用データベースにコピーする場合は、「*データベースの配置*」チュートリアルで説明されている手法を使用します。</span><span class="sxs-lookup"><span data-stu-id="f7259-184">If you mean to copy the user account and role information in the development database to the production database use the techniques covered in the *Deploying a Database* tutorial.</span></span>

<span data-ttu-id="f7259-185">`aspnet_regsql.exe` ツールを使用して、実稼働データベースにデータベースオブジェクトを追加する方法を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="f7259-185">Let s look at how to add the database objects to the production database using the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="f7259-186">まず、エクスプローラーを開き、コンピューター上の .NET Framework version 2.0 ディレクトリに移動します。% WINDIR% \NET\Framework\v2.0.50727.</span><span class="sxs-lookup"><span data-stu-id="f7259-186">Start by opening Windows Explorer and navigating to the .NET Framework version 2.0 directory on your computer, %WINDIR%\ Microsoft.NET\Framework\v2.0.50727.</span></span> <span data-ttu-id="f7259-187">`aspnet_regsql.exe` ツールが見つかります。</span><span class="sxs-lookup"><span data-stu-id="f7259-187">There you should find the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="f7259-188">このツールはコマンドラインから使用できますが、グラフィカルユーザーインターフェイスも含まれています。`aspnet_regsql.exe` ファイルをダブルクリックして、グラフィカルコンポーネントを起動します。</span><span class="sxs-lookup"><span data-stu-id="f7259-188">This tool can be used from the command-line, but it also includes a graphical user interface; double-click the `aspnet_regsql.exe` file to launch its graphical component.</span></span>

<span data-ttu-id="f7259-189">ツールを起動するには、その目的を説明するスプラッシュスクリーンを表示します。</span><span class="sxs-lookup"><span data-stu-id="f7259-189">The tool starts by displaying a splash screen explaining its purpose.</span></span> <span data-ttu-id="f7259-190">[次へ] をクリックして、図1に示す [セットアップオプションの選択] 画面に進みます。</span><span class="sxs-lookup"><span data-stu-id="f7259-190">Click Next to advance to the "Select a Setup Option" screen, which is shown in Figure 1.</span></span> <span data-ttu-id="f7259-191">ここでは、アプリケーションサービスデータベースオブジェクトを追加するか、データベースから削除するかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="f7259-191">From here you can choose to add the application services database objects or remove them from a database.</span></span> <span data-ttu-id="f7259-192">これらのオブジェクトを実稼働データベースに追加するには、[アプリケーションサービスの SQL Server を構成する] オプションを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f7259-192">Because we want to add these objects to the production database, select the "Configure SQL Server for application services" option and click Next.</span></span>

<span data-ttu-id="f7259-193">[![SQL Server の構成を選択してアプリケーションサービス](configuring-a-website-that-uses-application-services-vb/_static/image2.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="f7259-193">[![Choose to Configure SQL Server for Application Services](configuring-a-website-that-uses-application-services-vb/_static/image2.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image1.jpg)</span></span>

<span data-ttu-id="f7259-194">**図 1**: アプリケーションサービスの SQL Server の構成を選択する ([クリックすると、フルサイズの画像が表示](configuring-a-website-that-uses-application-services-vb/_static/image3.jpg)される)</span><span class="sxs-lookup"><span data-stu-id="f7259-194">**Figure 1**: Choose to Configure SQL Server for Application Services ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image3.jpg))</span></span>

<span data-ttu-id="f7259-195">[サーバーとデータベースの選択] 画面で、データベースに接続するための情報の入力を求められます。</span><span class="sxs-lookup"><span data-stu-id="f7259-195">In "Select the Server and Database" screen prompts for information to connect to the database.</span></span> <span data-ttu-id="f7259-196">Web ホスティング会社から提供されたデータベースサーバー、セキュリティ資格情報、およびデータベース名を入力し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f7259-196">Enter the database server, the security credentials, and the database name supplied to you by your web hosting company and click Next.</span></span>

> [!NOTE]
> <span data-ttu-id="f7259-197">データベースサーバーと資格情報を入力すると、データベースのドロップダウンリストを展開するときにエラーが表示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="f7259-197">After entering your database server and credentials you may get an error when expanding the database drop-down list.</span></span> <span data-ttu-id="f7259-198">`aspnet_regsql.exe` ツールは、`sysdatabases` システムテーブルにクエリを行ってサーバー上のデータベースの一覧を取得しますが、一部の web ホスティング企業はデータベースサーバーをロックダウンして、この情報が公開されていないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="f7259-198">The `aspnet_regsql.exe` tool queries the `sysdatabases` system table to retrieve a list of databases on the server, but some web hosting companies lock down their database servers so that this information is not publicly available.</span></span> <span data-ttu-id="f7259-199">このエラーが表示された場合は、ドロップダウンリストにデータベース名を直接入力できます。</span><span class="sxs-lookup"><span data-stu-id="f7259-199">If you get this error you can type the database name directly into the drop-down list.</span></span>

<span data-ttu-id="f7259-200">[データベースの接続情報を使用してツールを提供 ![](configuring-a-website-that-uses-application-services-vb/_static/image5.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="f7259-200">[![Supply the Tool With Your Database s Connection Information](configuring-a-website-that-uses-application-services-vb/_static/image5.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image4.jpg)</span></span>

<span data-ttu-id="f7259-201">**図 2**: データベース s の接続情報を使用してツールを指定[する (クリックすると、フルサイズの画像が表示](configuring-a-website-that-uses-application-services-vb/_static/image6.jpg)されます)</span><span class="sxs-lookup"><span data-stu-id="f7259-201">**Figure 2**: Supply the Tool With Your Database s Connection Information ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image6.jpg))</span></span>

<span data-ttu-id="f7259-202">次の画面には、実行しようとしている操作の概要が示されます。つまり、アプリケーションサービスデータベースオブジェクトが指定されたデータベースに追加されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-202">The subsequent screen summarizes the actions that are about to take place, namely that the application services database objects are going to be added to the specified database.</span></span> <span data-ttu-id="f7259-203">この操作を完了するには、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f7259-203">Click Next to complete this action.</span></span> <span data-ttu-id="f7259-204">しばらくすると、最後の画面が表示され、データベースオブジェクトが追加されたことがわかります (図3を参照)。</span><span class="sxs-lookup"><span data-stu-id="f7259-204">After a few moments, the final screen is displayed, noting that the database objects have been added (see Figure 3).</span></span>

<span data-ttu-id="f7259-205">[![成功しました。アプリケーションサービスデータベースオブジェクトが運用データベースに追加されました](configuring-a-website-that-uses-application-services-vb/_static/image8.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="f7259-205">[![Success! The Application Services Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-vb/_static/image8.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image7.jpg)</span></span>

<span data-ttu-id="f7259-206">**図 3**: 成功しました。</span><span class="sxs-lookup"><span data-stu-id="f7259-206">**Figure 3**: Success!</span></span> <span data-ttu-id="f7259-207">アプリケーションサービスデータベースオブジェクトが実稼働データベースに追加されました ([クリックすると、フルサイズの画像が表示](configuring-a-website-that-uses-application-services-vb/_static/image9.jpg)されます)</span><span class="sxs-lookup"><span data-stu-id="f7259-207">The Application Services Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image9.jpg))</span></span>

<span data-ttu-id="f7259-208">アプリケーションサービスデータベースオブジェクトが実稼働データベースに正常に追加されたことを確認するには、SQL Server Management Studio を開き、実稼働データベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="f7259-208">To verify that the application services database objects were successfully added to the production database, open SQL Server Management Studio and connect to your production database.</span></span> <span data-ttu-id="f7259-209">図4に示すように、データベース内のアプリケーションサービスデータベーステーブル、`aspnet_Applications`、`aspnet_Membership`、`aspnet_Users`などが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-209">As Figure 4 shows, you should now see the application services database tables in your database, `aspnet_Applications`, `aspnet_Membership`, `aspnet_Users`, and so forth.</span></span>

<span data-ttu-id="f7259-210">[![、データベースオブジェクトが実稼働データベースに追加されたことを確認します。](configuring-a-website-that-uses-application-services-vb/_static/image11.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="f7259-210">[![Confirm That the Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-vb/_static/image11.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image10.jpg)</span></span>

<span data-ttu-id="f7259-211">**図 4**: データベースオブジェクトが実稼働データベースに追加されたことを確認[する (クリックすると、フルサイズの画像が表示](configuring-a-website-that-uses-application-services-vb/_static/image12.jpg)されます)</span><span class="sxs-lookup"><span data-stu-id="f7259-211">**Figure 4**: Confirm That the Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image12.jpg))</span></span>

<span data-ttu-id="f7259-212">アプリケーションサービスの使用を開始した後、初めて web アプリケーションを配置するときにのみ、`aspnet_regsql.exe` ツールを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-212">You will only need to use the `aspnet_regsql.exe` tool when deploying your web application for the first time or for the first time after you have started using the application services.</span></span> <span data-ttu-id="f7259-213">これらのデータベースオブジェクトを実稼働データベースに配置した後は、再追加または変更する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="f7259-213">Once these database objects are on the production database they won't need to be re-added or modified.</span></span>

### <a name="copying-user-accounts-from-development-to-production"></a><span data-ttu-id="f7259-214">開発環境から運用環境へのユーザーアカウントのコピー</span><span class="sxs-lookup"><span data-stu-id="f7259-214">Copying User Accounts from Development to Production</span></span>

<span data-ttu-id="f7259-215">`SqlMembershipProvider` および `SqlRoleProvider` プロバイダークラスを使用してアプリケーションサービス情報を SQL Server データベースに格納する場合、ユーザーアカウントとロール情報は、`aspnet_Users`、`aspnet_Membership`、`aspnet_Roles`、`aspnet_UsersInRoles`など、さまざまなデータベーステーブルに格納されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-215">When using the `SqlMembershipProvider` and `SqlRoleProvider` provider classes to store the application services information in a SQL Server database, the user account and role information is stored in a variety of database tables, including `aspnet_Users`, `aspnet_Membership`, `aspnet_Roles`, and `aspnet_UsersInRoles`, among others.</span></span> <span data-ttu-id="f7259-216">開発時に開発環境でユーザーアカウントを作成する場合は、該当するデータベーステーブルから対応するレコードをコピーすることで、これらのユーザーアカウントを実稼働環境にレプリケートできます。</span><span class="sxs-lookup"><span data-stu-id="f7259-216">If during development you create user accounts in the development environment you can replicate those user accounts in production by copying the corresponding records from the applicable database tables.</span></span> <span data-ttu-id="f7259-217">データベース公開ウィザードを使用してアプリケーションサービスデータベースオブジェクトを配置した場合、レコードもコピーすることを選択した可能性があります。これにより、開発で作成されたユーザーアカウントも運用環境に存在することになります。</span><span class="sxs-lookup"><span data-stu-id="f7259-217">If you used the Database Publishing Wizard to deploy the application services database objects you may have also elected to copy the records, which would result in the user accounts created in development to also be on production.</span></span> <span data-ttu-id="f7259-218">ただし、構成設定によっては、アカウントが開発中に作成され、運用環境にコピーされたユーザーは、運用 web サイトからログインできないことがわかります。</span><span class="sxs-lookup"><span data-stu-id="f7259-218">But, depending on your configuration settings, you may find that those users whose accounts were created in development and copied to production are unable to login from the production website.</span></span> <span data-ttu-id="f7259-219">何をするのでしょうか。</span><span class="sxs-lookup"><span data-stu-id="f7259-219">What gives?</span></span>

<span data-ttu-id="f7259-220">`SqlMembershipProvider` および `SqlRoleProvider` プロバイダークラスは、1つのデータベースが複数のアプリケーションのユーザーストアとして機能するように設計されています。つまり、理論的には、同じ名前のユーザー名とロールを持つユーザーを持つことができます。</span><span class="sxs-lookup"><span data-stu-id="f7259-220">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes were designed such that a single database could serve as a user store for multiple applications, where each application could, in theory, have users with overlapping usernames and roles with the same name.</span></span> <span data-ttu-id="f7259-221">この柔軟性を実現するために、データベースは `aspnet_Applications` テーブルにアプリケーションの一覧を保持し、各ユーザーはこれらのアプリケーションのいずれかに関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="f7259-221">To allow for this flexibility, the database maintains a list of applications in the `aspnet_Applications` table, and each user is associated with one of these applications.</span></span> <span data-ttu-id="f7259-222">具体的には、`aspnet_Users` テーブルには、各ユーザーを `aspnet_Applications` テーブル内のレコードに結び付ける `ApplicationId` 列があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-222">Specifically, the `aspnet_Users` table has an `ApplicationId` column that ties each user to a record in the `aspnet_Applications` table.</span></span>

<span data-ttu-id="f7259-223">`aspnet_Applications` テーブルには、`ApplicationId` 列に加えて、アプリケーションのわかりやすい名前を提供する `ApplicationName` 列も含まれています。</span><span class="sxs-lookup"><span data-stu-id="f7259-223">In addition to the `ApplicationId` column, the `aspnet_Applications` table also includes an `ApplicationName` column, which provides a more human-friendly name for the application.</span></span> <span data-ttu-id="f7259-224">Web サイトでユーザーアカウントを使用しようとすると (ログインページからユーザーの資格情報を検証する場合など)、使用するアプリケーションを `SqlMembershipProvider` クラスに通知する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-224">When a website attempts to work with a user account, such as validating a user s credentials from the login page, it must tell the `SqlMembershipProvider` class what application to work with.</span></span> <span data-ttu-id="f7259-225">これは通常、アプリケーション名を指定することによって行われます。この値は、`applicationName` 属性を介して `Web.config` のプロバイダーの構成から取得されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-225">It usually does this by supplying the application name, and the this value comes from the provider s configuration in `Web.config` - specifically via the `applicationName` attribute.</span></span>

<span data-ttu-id="f7259-226">しかし、`Web.config`で `applicationName` 属性が指定されていない場合はどうなるでしょうか。</span><span class="sxs-lookup"><span data-stu-id="f7259-226">But what happens if the `applicationName` attribute is not specified in `Web.config`?</span></span> <span data-ttu-id="f7259-227">このような場合、メンバーシップシステムはアプリケーションのルートパスを `applicationName` 値として使用します。</span><span class="sxs-lookup"><span data-stu-id="f7259-227">In such a case the Membership system uses the application root path as the `applicationName` value.</span></span> <span data-ttu-id="f7259-228">`Web.config`で `applicationName` 属性が明示的に設定されていない場合は、開発環境と運用環境が異なるアプリケーションルートを使用する可能性があるため、アプリケーションサービスの異なるアプリケーション名に関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="f7259-228">If the `applicationName` attribute is not explicitly set in `Web.config`, then, there is the possibility that the development environment and production environment use a different application root and therefore will be associated with different application names in the application services.</span></span> <span data-ttu-id="f7259-229">このような不一致が発生した場合、開発環境で作成されたユーザーには、運用環境の `ApplicationId` 値と一致しない `ApplicationId` 値が設定されます。</span><span class="sxs-lookup"><span data-stu-id="f7259-229">If such a mismatch occurs then those users created in the development environment will have an `ApplicationId` value that does not match with the `ApplicationId` value for the production environment.</span></span> <span data-ttu-id="f7259-230">結果として、ユーザーはログインできなくなります。</span><span class="sxs-lookup"><span data-stu-id="f7259-230">The net result is that those users won't be able to login.</span></span>

> [!NOTE]
> <span data-ttu-id="f7259-231">`ApplicationId` 値が一致しない状態でユーザーアカウントが運用環境にコピーされた場合は、これらの不適切な `ApplicationId` 値を運用環境で使用されている `ApplicationId` に更新するクエリを記述できます。</span><span class="sxs-lookup"><span data-stu-id="f7259-231">If you find yourself in this situation - with user accounts copied to production with a mismatched `ApplicationId` value - you could write a query to update these incorrect `ApplicationId` values to the `ApplicationId` used on production.</span></span> <span data-ttu-id="f7259-232">更新されると、開発環境で作成されたアカウントを持つユーザーは、運用環境で web アプリケーションにサインインできるようになります。</span><span class="sxs-lookup"><span data-stu-id="f7259-232">Once updated, the users whose accounts were created on the development environment would now be able to sign into the web application on production.</span></span>

<span data-ttu-id="f7259-233">2つの環境が同じ `ApplicationId` を使用するようにするための簡単な手順があることは、すべてのアプリケーションサービスプロバイダーに対して `Web.config` に `applicationName` 属性を明示的に設定することです。</span><span class="sxs-lookup"><span data-stu-id="f7259-233">The good news is that there is a simple step you can take to ensure that the two environments use the same `ApplicationId` - explicitly set the `applicationName` attribute in `Web.config` for all of your application services providers.</span></span> <span data-ttu-id="f7259-234">`applicationName` 属性を明示的に `<membership>` と `<roleManager>` 要素の "BookReviews" に設定しています。このスニペットは `Web.config` 表示されています。</span><span class="sxs-lookup"><span data-stu-id="f7259-234">I explicitly set the `applicationName` attribute to "BookReviews" in the `<membership>` and `<roleManager>` elements as this snippet from `Web.config` shows.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample4.xml)]

<span data-ttu-id="f7259-235">`applicationName` 属性とその背後にある論理的根拠の設定の詳細については、 [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s のブログ投稿を参照してください。 [*ASP.NET メンバーシップやその他のプロバイダーを構成するときは、必ず applicationName プロパティを設定*](https://weblogs.asp.net/scottgu/443634)してください。</span><span class="sxs-lookup"><span data-stu-id="f7259-235">For more discussion on setting the `applicationName` attribute and the rationale behind it, refer to [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s blog post, [*Always set the applicationName property when configuring ASP.NET Membership and other Providers*](https://weblogs.asp.net/scottgu/443634).</span></span>

### <a name="managing-user-accounts-in-the-production-environment"></a><span data-ttu-id="f7259-236">運用環境でのユーザーアカウントの管理</span><span class="sxs-lookup"><span data-stu-id="f7259-236">Managing User Accounts in the Production Environment</span></span>

<span data-ttu-id="f7259-237">ASP.NET Web サイト管理ツール (WSAT) を使用すると、ユーザーアカウントの作成と管理、ロールの定義と適用、およびユーザーとロールベースの承認規則のスペルチェックを簡単に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="f7259-237">The ASP.NET Web Site Administration Tool (WSAT) makes it easy to create and manage user accounts, define and apply roles, and spell out user- and role-based authorization rules.</span></span> <span data-ttu-id="f7259-238">WSAT を Visual Studio から起動するには、ソリューションエクスプローラーに移動し、ASP.NET 構成アイコンをクリックするか、Web サイトまたはプロジェクトのメニューに移動し、[ASP.NET 構成] メニュー項目を選択します。</span><span class="sxs-lookup"><span data-stu-id="f7259-238">You can launch the WSAT from Visual Studio by going to the Solution Explorer and clicking the ASP.NET Configuration icon or by going to the Website or Project menus and selecting the ASP.NET Configuration menu item.</span></span> <span data-ttu-id="f7259-239">残念ながら、WSAT はローカル web サイトでのみ使用できます。</span><span class="sxs-lookup"><span data-stu-id="f7259-239">Unfortunately, the WSAT can only work with local websites.</span></span> <span data-ttu-id="f7259-240">したがって、ワークステーションの WSAT を使用して、運用環境で web サイトを管理することはできません。</span><span class="sxs-lookup"><span data-stu-id="f7259-240">Therefore, you cannot use the WSAT from your workstation to manage the website in the production environment.</span></span>

<span data-ttu-id="f7259-241">WSAT によって公開されているすべての機能は、メンバーシップとロールの Api を使用してプログラムで入手できます。さらに、WSAT 画面の多くは、標準の ASP.NET ログイン関連のコントロールを使用しています。</span><span class="sxs-lookup"><span data-stu-id="f7259-241">The good news is that all of the functionality exposed provided by the WSAT is available programmatically through the Membership and Roles APIs; furthermore, many of the WSAT screens use the standard ASP.NET Login-related controls.</span></span> <span data-ttu-id="f7259-242">つまり、必要な管理機能を提供する ASP.NET ページを web サイトに追加できます。</span><span class="sxs-lookup"><span data-stu-id="f7259-242">In short, you can add ASP.NET pages to your website that offer the necessary management capabilities.</span></span>

<span data-ttu-id="f7259-243">前のチュートリアルでは、ブックレビュー web アプリケーションを更新して `~/Admin` フォルダーを含め、このフォルダーは管理者ロールのユーザーのみを許可するように構成されていることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="f7259-243">Recall that an earlier tutorial updated the Book Reviews web application to include an `~/Admin` folder, and this folder has been configured to only allow users in the Admin role.</span></span> <span data-ttu-id="f7259-244">`CreateAccount.aspx` という名前のフォルダーに、管理者が新しいユーザーアカウントを作成するためのページを追加しました。</span><span class="sxs-lookup"><span data-stu-id="f7259-244">I added a page to that folder named `CreateAccount.aspx` from which an administrator can create a new user account.</span></span> <span data-ttu-id="f7259-245">このページでは、CreateUserWizard コントロールを使用して、新しいユーザーアカウントを作成するためのユーザーインターフェイスとバックエンドロジックを表示します。</span><span class="sxs-lookup"><span data-stu-id="f7259-245">This page uses the CreateUserWizard control to display the user interface and backend logic for creating a new user account.</span></span> <span data-ttu-id="f7259-246">さらに、新しいユーザーを管理者ロールに追加する必要があるかどうかを確認するチェックボックスを含めるようにコントロールをカスタマイズしました (図5を参照)。</span><span class="sxs-lookup"><span data-stu-id="f7259-246">What s more, I customized the control to include a CheckBox that prompts whether the new user should also be added to the Admin role (see Figure 5).</span></span> <span data-ttu-id="f7259-247">少しの作業では、WSAT によって提供されるユーザーおよびロールの管理関連タスクを実装するカスタムページのセットを作成できます。</span><span class="sxs-lookup"><span data-stu-id="f7259-247">With a little bit of work you can build a custom set of pages that implements the user and role management-related tasks that would otherwise be provided by the WSAT.</span></span>

> [!NOTE]
> <span data-ttu-id="f7259-248">ログイン関連の ASP.NET Web コントロールと共に Membership Api と Roles Api を使用する方法の詳細については、「 [*Web サイトのセキュリティ*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)に関するチュートリアル」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f7259-248">For more information on using the Membership and Roles APIs along with the Login-related ASP.NET Web controls, be sure to read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span> <span data-ttu-id="f7259-249">CreateUserWizard コントロールのカスタマイズの詳細については、「[*ユーザーアカウントの作成*](../../older-versions-security/membership/creating-user-accounts-vb.md)」および「[*その他のユーザー情報の保存*](../../older-versions-security/membership/storing-additional-user-information-vb.md)」を参照してください。または、 [*CreateUserWizard コントロールのカスタマイズ*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)に関する記事「 [*erich peterson*](http://www.erichpeterson.com/) s」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f7259-249">For more on customizing the CreateUserWizard control refer to the [*Creating User Accounts*](../../older-versions-security/membership/creating-user-accounts-vb.md) and [*Storing Additional User Information*](../../older-versions-security/membership/storing-additional-user-information-vb.md) tutorials, or check out [*Erich Peterson*](http://www.erichpeterson.com/) s article, [*Customizing the CreateUserWizard Control*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span></span>

<span data-ttu-id="f7259-250">[![管理者は新しいユーザーアカウントを作成できます。](configuring-a-website-that-uses-application-services-vb/_static/image14.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image13.jpg)</span><span class="sxs-lookup"><span data-stu-id="f7259-250">[![Administrators Can Create New User Accounts](configuring-a-website-that-uses-application-services-vb/_static/image14.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image13.jpg)</span></span>

<span data-ttu-id="f7259-251">**図 5**: 管理者は新しいユーザーアカウントを作成できます ([クリックすると、フルサイズの画像が表示](configuring-a-website-that-uses-application-services-vb/_static/image15.jpg)される)</span><span class="sxs-lookup"><span data-stu-id="f7259-251">**Figure 5**: Administrators Can Create New User Accounts ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image15.jpg))</span></span>

<span data-ttu-id="f7259-252">WSAT の完全な機能が必要な場合は、 [ *「独自の Web サイト管理ツールをロール*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)アウトする」をご覧ください。このツールでは、作成者 Dan clem がカスタムの WSAT に似たツールを構築するプロセスを説明しています。</span><span class="sxs-lookup"><span data-stu-id="f7259-252">If you need the full functionality of the WSAT check out [*Rolling Your Own Web Site Administration Tool*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx), in which author Dan Clem walks through the process of building a custom WSAT-like tool.</span></span> <span data-ttu-id="f7259-253">Dan は、アプリケーションのソースコード ( C#) を共有し、ホストされている web サイトに追加するための詳細な手順を示します。</span><span class="sxs-lookup"><span data-stu-id="f7259-253">Dan shares his application s source code (in C#) and provides step-by-step instructions for adding it to your hosted website.</span></span>

## <a name="summary"></a><span data-ttu-id="f7259-254">要約</span><span class="sxs-lookup"><span data-stu-id="f7259-254">Summary</span></span>

<span data-ttu-id="f7259-255">アプリケーションサービスデータベースの実装を使用する web アプリケーションを配置する場合は、まず、実稼働データベースに必要なデータベースオブジェクトがあることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f7259-255">When deploying a web application that uses the application services database implementation you must first ensure that the production database has the requisite database objects.</span></span> <span data-ttu-id="f7259-256">これらのオブジェクトは、「*データベースの配置*」チュートリアルで説明されている手法を使用して追加できます。または、このチュートリアルで説明したように、`aspnet_regsql.exe` ツールを使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="f7259-256">These objects can be added using the techniques discussed in the *Deploying a Database* tutorial; alternatively, you can use the `aspnet_regsql.exe` tool, as we saw in this tutorial.</span></span> <span data-ttu-id="f7259-257">開発環境および運用環境で使用されているアプリケーション名の同期を中心に説明した他の課題 (開発環境で作成されたユーザーとロールが運用環境で有効になるようにする場合は重要です) との手法運用環境でのユーザーとロールの管理。</span><span class="sxs-lookup"><span data-stu-id="f7259-257">Other challenges we touched on center around synchronizing the application name used in the development and production environments (which is important if you want users and roles created in the development environment to be valid on production) and techniques for managing the users and roles in the production environment.</span></span>

<span data-ttu-id="f7259-258">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="f7259-258">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="f7259-259">関連項目</span><span class="sxs-lookup"><span data-stu-id="f7259-259">Further Reading</span></span>

<span data-ttu-id="f7259-260">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="f7259-260">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="f7259-261">*ASP.NET SQL Server 登録ツール (aspnet_regsql)* </span><span class="sxs-lookup"><span data-stu-id="f7259-261">*ASP.NET SQL Server Registration Tool (aspnet_regsql.exe)*</span></span>](https://msdn.microsoft.com/library/ms229862.aspx)
- [<span data-ttu-id="f7259-262">*SQL Server 用のアプリケーションサービスデータベースの作成*</span><span class="sxs-lookup"><span data-stu-id="f7259-262">*Creating the Application Services Database for SQL Server*</span></span>](https://msdn.microsoft.com/library/x28wfk74.aspx)
- [<span data-ttu-id="f7259-263">*SQL Server でのメンバーシップスキーマの作成*</span><span class="sxs-lookup"><span data-stu-id="f7259-263">*Creating the Membership Schema in SQL Server*</span></span>](../../older-versions-security/membership/creating-the-membership-schema-in-sql-server-vb.md)
- [<span data-ttu-id="f7259-264">*ASP.NET s のメンバーシップ、ロール、およびプロファイルを調べています*</span><span class="sxs-lookup"><span data-stu-id="f7259-264">*Examining ASP.NET s Membership, Roles, and Profile*</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="f7259-265">*独自の Web サイト管理ツールをロールする*</span><span class="sxs-lookup"><span data-stu-id="f7259-265">*Rolling Your Own Web Site Administration Tool*</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="f7259-266">*Web サイトのセキュリティに関するチュートリアル*</span><span class="sxs-lookup"><span data-stu-id="f7259-266">*Website Security Tutorials*</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)
- [<span data-ttu-id="f7259-267">*Web サイト管理ツールの概要*</span><span class="sxs-lookup"><span data-stu-id="f7259-267">*Web Site Administration Tool Overview*</span></span>](https://msdn.microsoft.com/library/yy40ytx0.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="f7259-268">[前へ](configuring-the-production-web-application-to-use-the-production-database-vb.md)
> [次へ](strategies-for-database-development-and-deployment-vb.md)</span><span class="sxs-lookup"><span data-stu-id="f7259-268">[Previous](configuring-the-production-web-application-to-use-the-production-database-vb.md)
[Next](strategies-for-database-development-and-deployment-vb.md)</span></span>
