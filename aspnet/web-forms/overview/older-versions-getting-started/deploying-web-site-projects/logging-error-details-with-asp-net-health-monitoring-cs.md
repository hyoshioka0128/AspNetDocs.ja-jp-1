---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
title: ASP.NET 状態監視 (c#) によるエラーの詳細をログ記録 |Microsoft Docs
author: rick-anderson
description: Microsoft の正常性の監視システムは、ハンドルされない例外などのさまざまな web イベントを記録する簡単かつカスタマイズ可能な方法を提供します。 このチュートリアルでは、そのを使用しています.
ms.author: riande
ms.date: 06/09/2009
ms.assetid: b1abb452-642a-4ff3-8504-37b85590ff79
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
msc.type: authoredcontent
ms.openlocfilehash: 6b444de67f3bce3d09dd8c3c172895cf07f58df8
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/06/2019
ms.locfileid: "65134411"
---
# <a name="logging-error-details-with-aspnet-health-monitoring-c"></a><span data-ttu-id="966b1-104">ASP.NET の状態監視でエラーの詳細をログに記録する (C#)</span><span class="sxs-lookup"><span data-stu-id="966b1-104">Logging Error Details with ASP.NET Health Monitoring (C#)</span></span>

<span data-ttu-id="966b1-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="966b1-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="966b1-106">[コードのダウンロード](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip)または[PDF のダウンロード](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="966b1-106">[Download Code](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) or [Download PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span></span>

> <span data-ttu-id="966b1-107">Microsoft の正常性の監視システムは、ハンドルされない例外などのさまざまな web イベントを記録する簡単かつカスタマイズ可能な方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="966b1-107">Microsoft's health monitoring system provides an easy and customizable way to log various web events, including unhandled exceptions.</span></span> <span data-ttu-id="966b1-108">このチュートリアルでは、未処理の例外をデータベースにログインして、電子メール メッセージを使用して開発者に通知する状態監視システムの設定手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="966b1-108">This tutorial walks through setting up the health monitoring system to log unhandled exceptions to a database and to notify developers via an email message.</span></span>

## <a name="introduction"></a><span data-ttu-id="966b1-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="966b1-109">Introduction</span></span>

<span data-ttu-id="966b1-110">ログは、デプロイされたアプリケーションの正常性の監視と発生する可能性のある問題を診断するための便利なツールです。</span><span class="sxs-lookup"><span data-stu-id="966b1-110">Logging is a useful tool for monitoring the health of a deployed application and for diagnosing any problems that may arise.</span></span> <span data-ttu-id="966b1-111">解決するように、デプロイされたアプリケーションで発生するエラーをログに特に重要ですが。</span><span class="sxs-lookup"><span data-stu-id="966b1-111">It is especially important to log errors that occur in a deployed application so that they can be remedied.</span></span> <span data-ttu-id="966b1-112">`Error` ; ASP.NET アプリケーションでハンドルされない例外が発生するたびにイベントが発生した、[前のチュートリアル](processing-unhandled-exceptions-cs.md)エラーの開発者に通知し、のイベントハンドラーを作成してその詳細をログ記録する方法を示しました`Error`イベント。</span><span class="sxs-lookup"><span data-stu-id="966b1-112">The `Error` event is raised whenever an unhandled exception occurs in an ASP.NET application; the [preceding tutorial](processing-unhandled-exceptions-cs.md) showed how to notify a developer of an error and log its details by creating an event handler for the `Error` event.</span></span> <span data-ttu-id="966b1-113">ただし、作成、 `Error` ASP では、このタスクを実行できるように、エラーの詳細をログ記録し、開発者に通知するイベント ハンドラーは不要です。NET の*状態監視システム*します。</span><span class="sxs-lookup"><span data-stu-id="966b1-113">However, creating an `Error` event handler to log the error's details and notify a developer is unnecessary, as this task can be performed by ASP.NET's *health monitoring system*.</span></span>

<span data-ttu-id="966b1-114">状態監視システムは、ASP.NET 2.0 で導入され、アプリケーションまたは要求の有効期間中に発生するイベントのログ記録によってデプロイされた ASP.NET アプリケーションの正常性を監視するために設計されています。</span><span class="sxs-lookup"><span data-stu-id="966b1-114">The health monitoring system was introduced in ASP.NET 2.0 and is designed to monitor the health of a deployed ASP.NET application by logging events that occur during the application or request's lifetime.</span></span> <span data-ttu-id="966b1-115">状態監視システムによって記録されたイベントと呼びます*状態監視イベント*または*Web イベント*、含める。</span><span class="sxs-lookup"><span data-stu-id="966b1-115">The events logged by the health monitoring system are referred to as *health monitoring events* or *Web events*, and include:</span></span>

- <span data-ttu-id="966b1-116">アプリケーションが開始または停止などのアプリケーションの有効期間イベント</span><span class="sxs-lookup"><span data-stu-id="966b1-116">Application lifetime events, such as when an application starts or stops</span></span>
- <span data-ttu-id="966b1-117">など、セキュリティ イベントは、ログイン試行が失敗し、URL 承認の要求に失敗しました</span><span class="sxs-lookup"><span data-stu-id="966b1-117">Security events, including failed login attempts and failed URL authorization requests</span></span>
- <span data-ttu-id="966b1-118">含む、アプリケーション エラー未処理の例外、例外、要求の検証例外、およびその他の種類のエラーの間でのコンパイル エラーを解析ビュー ステート。</span><span class="sxs-lookup"><span data-stu-id="966b1-118">Application errors, including unhandled exceptions, view state parsing exceptions, request validation exceptions, and compilation errors, among other types of errors.</span></span>

<span data-ttu-id="966b1-119">任意の数に記録できます、正常性の監視イベントが発生したときに指定された*ログ ソース*。</span><span class="sxs-lookup"><span data-stu-id="966b1-119">When a health monitoring event is raised it can be logged to any number of specified *log sources*.</span></span> <span data-ttu-id="966b1-120">状態監視システムは、Windows イベント ログに、または他のユーザーの間で、電子メール メッセージを使用して、Microsoft SQL Server データベースに Web イベントを記録するログ ソースでは出荷されます。</span><span class="sxs-lookup"><span data-stu-id="966b1-120">The health monitoring system ships with log sources that log Web events to a Microsoft SQL Server database, to the Windows Event Log, or via an email message, among others.</span></span> <span data-ttu-id="966b1-121">独自のログ ソースを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="966b1-121">You can also create your own log sources.</span></span>

<span data-ttu-id="966b1-122">使用すると、ログ ソースと共に、状態監視システムに記録するイベントが定義されている`Web.config`します。</span><span class="sxs-lookup"><span data-stu-id="966b1-122">The events the health monitoring system logs, along with the log sources used, are defined in `Web.config`.</span></span> <span data-ttu-id="966b1-123">構成マークアップの数行では、データベースへすべてのハンドルされない例外を記録して通知する電子メールを使用して例外の監視の正常性を使用できます。</span><span class="sxs-lookup"><span data-stu-id="966b1-123">With a few lines of configuration markup you can use health monitoring to log all unhandled exceptions to a database and to notify you of the exception via email.</span></span>

## <a name="exploring-the-health-monitoring-systems-configuration"></a><span data-ttu-id="966b1-124">システムの構成の監視の正常性を調べる</span><span class="sxs-lookup"><span data-stu-id="966b1-124">Exploring the Health Monitoring System's Configuration</span></span>

<span data-ttu-id="966b1-125">ある、その構成情報によって正常性監視システムの動作が定義されている、 [ `<healthMonitoring>`要素](https://msdn.microsoft.com/library/2fwh2ss9.aspx)で`Web.config`します。</span><span class="sxs-lookup"><span data-stu-id="966b1-125">The health monitoring system's behavior is defined by its configuration information, which is located in the [`<healthMonitoring>` element](https://msdn.microsoft.com/library/2fwh2ss9.aspx) in `Web.config`.</span></span> <span data-ttu-id="966b1-126">この構成セクションには、次の 3 つ重要な情報がその他のものを定義します。</span><span class="sxs-lookup"><span data-stu-id="966b1-126">This configuration section defines, among other things, the following three important pieces of information:</span></span>

1. <span data-ttu-id="966b1-127">正常性イベントを監視するには、発生した、ログに記録する必要があります、</span><span class="sxs-lookup"><span data-stu-id="966b1-127">The health monitoring events that, when raised, should be logged,</span></span>
2. <span data-ttu-id="966b1-128">ログのソースと</span><span class="sxs-lookup"><span data-stu-id="966b1-128">The log sources, and</span></span>
3. <span data-ttu-id="966b1-129">各状態の監視 (1) で定義されているイベントをログ ソースにマップする方法は、(2) で定義されています。</span><span class="sxs-lookup"><span data-stu-id="966b1-129">How each health monitoring event defined in (1) is mapped to the log sources defined in (2).</span></span>

<span data-ttu-id="966b1-130">この情報は 3 つの子構成要素を指定: [ `<eventMappings>` ](https://msdn.microsoft.com/library/yc5yk01w.aspx)、 [ `<providers>` ](https://msdn.microsoft.com/library/zaa41kz1.aspx)、および[ `<rules>` ](https://msdn.microsoft.com/library/fe5wyxa0.aspx)、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="966b1-130">This information is specified through three children configuration elements: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx), and [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectively.</span></span>

<span data-ttu-id="966b1-131">既定の正常性監視システムの構成情報が記載されて、`Web.config`ファイル`%WINDIR%\Microsoft.NET\Framework\version\CONFIG`フォルダー。</span><span class="sxs-lookup"><span data-stu-id="966b1-131">The default health monitoring system configuration information can be found in the `Web.config` file in `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` folder.</span></span> <span data-ttu-id="966b1-132">簡潔にするため、削除、いくつかのマークアップでこの既定の構成情報が以下に示します。</span><span class="sxs-lookup"><span data-stu-id="966b1-132">This default configuration information, with some markup removed for brevity, is shown below:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample1.xml)]

<span data-ttu-id="966b1-133">関心のある監視イベントが定義されている正常性、`<eventMappings>`要素で、状態監視イベントのクラスへのわかりやすい名前を提供します。</span><span class="sxs-lookup"><span data-stu-id="966b1-133">The health monitoring events of interest are defined in the `<eventMappings>` element, which gives a human-friendly name to a class of health monitoring events.</span></span> <span data-ttu-id="966b1-134">上記のマークアップで、`<eventMappings>`要素は、正常性の種類のイベントの監視「すべてのエラー」わかりやすい名前を割り当てます`WebBaseErrorEvent`と、名前「失敗の監査」状態の種類のイベントを監視する`WebFailureAuditEvent`します。</span><span class="sxs-lookup"><span data-stu-id="966b1-134">In the markup above, the `<eventMappings>` element assigns the human-friendly name "All Errors" to the health monitoring events of type `WebBaseErrorEvent` and the name "Failure Audits" to health monitoring events of type `WebFailureAuditEvent`.</span></span>

<span data-ttu-id="966b1-135">`<providers>`要素は、わかりやすい名前を付与することと、ログ ソースに固有の構成情報を指定する、ログ ソースを定義します。</span><span class="sxs-lookup"><span data-stu-id="966b1-135">The `<providers>` element defines the log sources, giving them a human-friendly name and specifying any log source-specific configuration information.</span></span> <span data-ttu-id="966b1-136">最初の`<add>`要素は、"EventLogProvider"プロバイダーを使用してイベントを監視する指定された正常性のログを定義、`EventLogWebEventProvider`クラス。</span><span class="sxs-lookup"><span data-stu-id="966b1-136">The first `<add>` element defines the "EventLogProvider" provider, which logs the specified health monitoring events using the `EventLogWebEventProvider` class.</span></span> <span data-ttu-id="966b1-137">`EventLogWebEventProvider`クラスは、Windows イベント ログにイベントを記録します。</span><span class="sxs-lookup"><span data-stu-id="966b1-137">The `EventLogWebEventProvider` class logs the event to the Windows Event Log.</span></span> <span data-ttu-id="966b1-138">2 番目の`<add>`要素定義を使用して Microsoft SQL Server データベースにイベントを記録する"SqlWebEventProvider"プロバイダー、`SqlWebEventProvider`クラス。</span><span class="sxs-lookup"><span data-stu-id="966b1-138">The second `<add>` element defines the "SqlWebEventProvider" provider, which logs events to a Microsoft SQL Server database via the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="966b1-139">"SqlWebEventProvider"構成データベースの接続文字列を指定します (`connectionStringName`) 間での他の構成オプション。</span><span class="sxs-lookup"><span data-stu-id="966b1-139">The "SqlWebEventProvider" configuration specifies the database's connection string (`connectionStringName`) among other configuration options.</span></span>

<span data-ttu-id="966b1-140">`<rules>`要素で指定されたイベントをマップする、`<eventMappings>`要素ソースのログインに、`<providers>`要素。</span><span class="sxs-lookup"><span data-stu-id="966b1-140">The `<rules>` element maps the events specified in the `<eventMappings>` element to log sources in the `<providers>` element.</span></span> <span data-ttu-id="966b1-141">既定では、ASP.NET web アプリケーションはすべてのハンドルされない例外のログおよび Windows イベント ログに失敗します。</span><span class="sxs-lookup"><span data-stu-id="966b1-141">By default, ASP.NET web applications log all unhandled exceptions and audit failures to the Windows Event Log.</span></span>

## <a name="logging-events-to-a-database"></a><span data-ttu-id="966b1-142">データベースにイベントを記録</span><span class="sxs-lookup"><span data-stu-id="966b1-142">Logging Events to a Database</span></span>

<span data-ttu-id="966b1-143">状態監視システムの既定の構成は、追加することで web アプリケーション、web でアプリケーションごとにカスタマイズできます、`<healthMonitoring>`をアプリケーションのセクション`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="966b1-143">The health monitoring system's default configuration can be customized on a web application-by-web application basis by adding a `<healthMonitoring>` section to the application's `Web.config` file.</span></span> <span data-ttu-id="966b1-144">内の追加要素を含めることができます、 `<eventMappings>`、 `<providers>`、および`<rules>`セクションを使用して、`<add>`要素。</span><span class="sxs-lookup"><span data-stu-id="966b1-144">You can include additional elements in the `<eventMappings>`, `<providers>`, and `<rules>` sections by using the `<add>` element.</span></span> <span data-ttu-id="966b1-145">既定の構成で使用される設定を削除する、`<remove>`要素、または使用`<clear />`これらのセクションのいずれかからすべての既定値を削除します。</span><span class="sxs-lookup"><span data-stu-id="966b1-145">To remove a setting from the default configuration use the `<remove>` element, or use `<clear />` to remove all default values from one of these sections.</span></span> <span data-ttu-id="966b1-146">使用して Microsoft SQL Server データベースにすべての未処理の例外の記録に書籍レビューの web アプリケーションを構成しましょう、`SqlWebEventProvider`クラス。</span><span class="sxs-lookup"><span data-stu-id="966b1-146">Let's configure the Book Reviews web application to log all unhandled exceptions to a Microsoft SQL Server database using the `SqlWebEventProvider` class.</span></span>

<span data-ttu-id="966b1-147">`SqlWebEventProvider`クラスは、状態監視システムの一部であるし、性を監視する指定された SQL Server データベースにイベント ログに記録します。</span><span class="sxs-lookup"><span data-stu-id="966b1-147">The `SqlWebEventProvider` class is part of the health monitoring system and logs a health monitoring event to a specified SQL Server database.</span></span> <span data-ttu-id="966b1-148">`SqlWebEventProvider`クラスでは、指定されたデータベースがという名前のストアド プロシージャが含まれている必要があります`aspnet_WebEvent_LogEvent`します。</span><span class="sxs-lookup"><span data-stu-id="966b1-148">The `SqlWebEventProvider` class expects that the specified database includes a stored procedure named `aspnet_WebEvent_LogEvent`.</span></span> <span data-ttu-id="966b1-149">このストアド プロシージャでは、イベントの詳細が渡され、イベントの詳細を格納する機能を備えています。</span><span class="sxs-lookup"><span data-stu-id="966b1-149">This stored procedure is passed the details of the event and is tasked with storing the event details.</span></span> <span data-ttu-id="966b1-150">良い知らせは、このストアド プロシージャを作成する必要がないことも、プロシージャもイベントの詳細を格納するテーブル。</span><span class="sxs-lookup"><span data-stu-id="966b1-150">The good news is that you do not need to create this stored procedure nor the table to store the event details.</span></span> <span data-ttu-id="966b1-151">使用してデータベースにこれらのオブジェクトを追加することができます、`aspnet_regsql.exe`ツール。</span><span class="sxs-lookup"><span data-stu-id="966b1-151">You can add these objects to your database using the `aspnet_regsql.exe` tool.</span></span>

> [!NOTE]
> <span data-ttu-id="966b1-152">`aspnet_regsql.exe`に説明したツール、 [*サービスを構成する、web サイトを使用してアプリケーション*チュートリアル](configuring-a-website-that-uses-application-services-cs.md)ASP のサポートを追加するとき。NET のアプリケーションのサービスです。</span><span class="sxs-lookup"><span data-stu-id="966b1-152">The `aspnet_regsql.exe` tool was discussed back in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-cs.md) when we added support for ASP.NET's application services.</span></span> <span data-ttu-id="966b1-153">書籍レビューの web サイトのデータベースが既に存在する、その結果、`aspnet_WebEvent_LogEvent`ストアド プロシージャをという名前のテーブルにイベント情報を格納する`aspnet_WebEvent_Events`します。</span><span class="sxs-lookup"><span data-stu-id="966b1-153">Consequently, the Book Reviews website's database already contains the `aspnet_WebEvent_LogEvent` stored procedure, which stores the event information into a table named `aspnet_WebEvent_Events`.</span></span>

<span data-ttu-id="966b1-154">必要なストアド プロシージャとテーブル データベースに追加したら、残っているは正常性監視のすべてのハンドルされない例外をデータベースにログインするように指示します。</span><span class="sxs-lookup"><span data-stu-id="966b1-154">Once you have the necessary stored procedure and table added to your database, all that remains is to instruct health monitoring to log all unhandled exceptions to the database.</span></span> <span data-ttu-id="966b1-155">Web サイトの次のマークアップを追加することでこれを行う`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="966b1-155">Accomplish this by adding the following markup to your website's `Web.config` file:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample2.xml)]

<span data-ttu-id="966b1-156">正常性監視は上記の構成マークアップ`<clear />`要素から構成情報を監視する定義済みの正常性をワイプする、 `<eventMappings>`、 `<providers>`、および`<rules>`セクション。</span><span class="sxs-lookup"><span data-stu-id="966b1-156">The health monitoring configuration markup above uses `<clear />` elements to wipe the pre-defined health monitoring configuration information from the `<eventMappings>`, `<providers>`, and `<rules>` sections.</span></span> <span data-ttu-id="966b1-157">これらのセクションのそれぞれに 1 つのエントリを追加します。</span><span class="sxs-lookup"><span data-stu-id="966b1-157">It then adds a single entry to each of these sections.</span></span>

- <span data-ttu-id="966b1-158">`<eventMappings>`要素が 1 つ性を監視する目的は、ハンドルされない例外が発生したときに発生「すべてエラー」という名前のイベントを定義します。</span><span class="sxs-lookup"><span data-stu-id="966b1-158">The `<eventMappings>` element defines a single health monitoring event of interest named "All Errors", which is raised whenever an unhandled exception occurs.</span></span>
- <span data-ttu-id="966b1-159">`<providers>`要素を使用して"SqlWebEventProvider"という名前の 1 つのログ ソースを定義する、`SqlWebEventProvider`クラス。</span><span class="sxs-lookup"><span data-stu-id="966b1-159">The `<providers>` element defines a single log source named "SqlWebEventProvider" that uses the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="966b1-160">`connectionStringName` "ReviewsConnectionString"は、接続の名前を指定する属性が設定された文字列で定義されている、`<connectionStrings>`セクション。</span><span class="sxs-lookup"><span data-stu-id="966b1-160">The `connectionStringName` attribute has been set to "ReviewsConnectionString", which is the name of our connection string defined in the `<connectionStrings>` section.</span></span>
- <span data-ttu-id="966b1-161">最後に、&lt;ルール&gt;要素は、「すべてのエラー」イベントが発生するときに記録します"SqlWebEventProvider"プロバイダーを使用してを示します。</span><span class="sxs-lookup"><span data-stu-id="966b1-161">Finally, the &lt;rules&gt; element indicates that when an "All Errors" event transpires that it should be logged using the "SqlWebEventProvider" provider.</span></span>

<span data-ttu-id="966b1-162">この構成情報には、状態監視システムは、書籍レビューのデータベースにすべてのハンドルされない例外を記録するように指示します。</span><span class="sxs-lookup"><span data-stu-id="966b1-162">This configuration information instructs the health monitoring system to log all unhandled exceptions to the Book Reviews database.</span></span>

> [!NOTE]
> <span data-ttu-id="966b1-163">`WebBaseErrorEvent`イベントはサーバーのエラーのみ発生します。 存在しない ASP.NET リソースの要求などの HTTP エラーは発生しません。</span><span class="sxs-lookup"><span data-stu-id="966b1-163">The `WebBaseErrorEvent` event is only raised for server errors; it is not raised for HTTP errors, such as a request for an ASP.NET resource that is not found.</span></span> <span data-ttu-id="966b1-164">動作とこれに対し、`HttpApplication`クラスの`Error`サーバーと HTTP エラーの両方で発生するイベントです。</span><span class="sxs-lookup"><span data-stu-id="966b1-164">This differs from the behavior of the `HttpApplication` class's `Error` event, which is raised for both server and HTTP errors.</span></span>

<span data-ttu-id="966b1-165">監視アクションでシステム正常性を確認するには、web サイトにアクセスしにアクセスして、実行時エラーを生成`Genre.aspx?ID=foo`します。</span><span class="sxs-lookup"><span data-stu-id="966b1-165">To see the health monitoring system in action, visit the website and generate a runtime error by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="966b1-166">適切なエラー ページで、例外の詳細黄色い画面の死 (ときにローカルにアクセスして) または (実稼働環境でサイトにアクセスする) 場合は、カスタム エラー ページのいずれかが表示されます。</span><span class="sxs-lookup"><span data-stu-id="966b1-166">You should see the appropriate error page - either the Exception Details Yellow Screen of Death (when visiting locally) or the custom error page (when visiting the site in production).</span></span> <span data-ttu-id="966b1-167">バック グラウンドでは、状態監視システムは、データベースにエラー情報を記録します。</span><span class="sxs-lookup"><span data-stu-id="966b1-167">Behind the scenes, the health monitoring system logged the error information to the database.</span></span> <span data-ttu-id="966b1-168">1 件のレコードがあります、`aspnet_WebEvent_Events`テーブル (を参照してください**図 1**)。 このレコードには、発生したランタイム エラーに関する情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="966b1-168">There should be one record in the `aspnet_WebEvent_Events` table (see **Figure 1**); this record contains information about the runtime error that just occurred.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image1.png)

<span data-ttu-id="966b1-169">**図 1**:エラーの詳細をログに記録された、`aspnet_WebEvent_Events`テーブル</span><span class="sxs-lookup"><span data-stu-id="966b1-169">**Figure 1**: The Error Details Were Logged to the `aspnet_WebEvent_Events` Table</span></span>  
<span data-ttu-id="966b1-170">([フルサイズの画像を表示する をクリックします](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))。</span><span class="sxs-lookup"><span data-stu-id="966b1-170">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span></span>

### <a name="displaying-the-error-log-in-a-web-page"></a><span data-ttu-id="966b1-171">Web ページで、エラー ログを表示します。</span><span class="sxs-lookup"><span data-stu-id="966b1-171">Displaying the Error Log In a Web Page</span></span>

<span data-ttu-id="966b1-172">Web サイトの現在の構成では、状態監視システムは、データベースにすべてのハンドルされない例外を記録します。</span><span class="sxs-lookup"><span data-stu-id="966b1-172">With the website's current configuration, the health monitoring system logs all unhandled exceptions to the database.</span></span> <span data-ttu-id="966b1-173">ただし、正常性の監視は提供されませんを web ページを使用して、エラー ログを表示する任意のメカニズム。</span><span class="sxs-lookup"><span data-stu-id="966b1-173">However, health monitoring does not provide any mechanism to view the error log through a web page.</span></span> <span data-ttu-id="966b1-174">ただし、データベースからこの情報を表示する ASP.NET ページを構築できます。</span><span class="sxs-lookup"><span data-stu-id="966b1-174">However, you could build an ASP.NET page that displays this information from the database.</span></span> <span data-ttu-id="966b1-175">(一時的に表示されるよう、選択できますが、電子メール メッセージで送信エラーの詳細。)</span><span class="sxs-lookup"><span data-stu-id="966b1-175">(As we'll see momentarily, you can opt to have the error details sent to you in an email message.)</span></span>

<span data-ttu-id="966b1-176">このようなページを作成する場合は、エラーの詳細を表示するのには承認されたユーザーのみを許可するための手順を確認します。</span><span class="sxs-lookup"><span data-stu-id="966b1-176">If you create such a page, make sure you take steps to allow only authorized users to view the error details.</span></span> <span data-ttu-id="966b1-177">サイトが既にユーザー アカウントを使用する場合は、特定のユーザーまたはロール ページへのアクセスを制限する、URL 承認規則を使用できます。</span><span class="sxs-lookup"><span data-stu-id="966b1-177">If your site already employs user accounts then you can use URL authorization rules to restrict access to the page to certain users or roles.</span></span> <span data-ttu-id="966b1-178">ログインしているユーザーに基づいて、web ページへのアクセスを制限または許可する方法の詳細についてを参照してください、 [web サイトのセキュリティのチュートリアル](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)します。</span><span class="sxs-lookup"><span data-stu-id="966b1-178">For more information on how to grant or restrict access to web pages based on the logged in user, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

> [!NOTE]
> <span data-ttu-id="966b1-179">次のチュートリアルでは、ELMAH という名前の別のエラー ログと通知システムについて説明します。</span><span class="sxs-lookup"><span data-stu-id="966b1-179">The subsequent tutorial explores an alternative error logging and notification system named ELMAH.</span></span> <span data-ttu-id="966b1-180">ELMAH には、RSS フィードと web ページからのエラー ログを表示するための組み込みメカニズムが含まれています。</span><span class="sxs-lookup"><span data-stu-id="966b1-180">ELMAH includes a built-in mechanism to view the error log from both a web page and as an RSS feed.</span></span>

## <a name="logging-events-to-email"></a><span data-ttu-id="966b1-181">電子メールへのイベントをログ記録</span><span class="sxs-lookup"><span data-stu-id="966b1-181">Logging Events to Email</span></span>

<span data-ttu-id="966b1-182">状態監視システムには、電子メール メッセージをイベントに「記録」するログ ソース プロバイダーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="966b1-182">The health monitoring system includes a log source provider that "logs" an event to an email message.</span></span> <span data-ttu-id="966b1-183">ログ ソースには、電子メール メッセージの本文内のデータベースにログに記録されるのと同じ情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="966b1-183">The log source includes the same information that is logged to the database in the email message body.</span></span> <span data-ttu-id="966b1-184">このログ ソースを使用して、特定の正常性の監視イベントが発生すると、開発者に通知することができます。</span><span class="sxs-lookup"><span data-stu-id="966b1-184">You can use this log source to notify a developer when a certain health monitoring event occurs.</span></span>

<span data-ttu-id="966b1-185">例外されるたびに電子メールを受信するために発生 web サイトの構成、書籍レビューを更新してみましょう。</span><span class="sxs-lookup"><span data-stu-id="966b1-185">Let's update the Book Reviews website's configuration so that we receive an email whenever an exception occurs.</span></span> <span data-ttu-id="966b1-186">これを行うには、次の 3 つのタスクを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="966b1-186">To accomplish this we need to perform three tasks:</span></span>

1. <span data-ttu-id="966b1-187">電子メールを送信する ASP.NET web アプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="966b1-187">Configure the ASP.NET web application to send email.</span></span> <span data-ttu-id="966b1-188">使用して電子メール メッセージを送信する方法を指定することでこれは、`<system.net>`構成要素。</span><span class="sxs-lookup"><span data-stu-id="966b1-188">This is accomplished by specifying how email messages are sent via the `<system.net>` configuration element.</span></span> <span data-ttu-id="966b1-189">電子メールの送信の詳細については、ASP.NET アプリケーション内のメッセージを参照してください[ASP.NET で電子メールを送信する](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)と[System.Net.Mail FAQ](http://systemnetmail.com/)します。</span><span class="sxs-lookup"><span data-stu-id="966b1-189">For more information on sending email messages in an ASP.NET application refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>
2. <span data-ttu-id="966b1-190">電子メール ログ ソース プロバイダーを登録、`<providers>`要素、および</span><span class="sxs-lookup"><span data-stu-id="966b1-190">Register the email log source provider in the `<providers>` element, and</span></span>
3. <span data-ttu-id="966b1-191">エントリを追加、 `<rules>` 「すべてのエラー」イベントを (2) の手順で追加のログ ソース プロバイダーにマップされる要素。</span><span class="sxs-lookup"><span data-stu-id="966b1-191">Add an entry to the `<rules>` element that maps the "All Errors" event to the log source provider added in step (2).</span></span>

<span data-ttu-id="966b1-192">状態監視システムには、2 つの電子メール ログ ソース プロバイダー クラスが含まれています:`SimpleMailWebEventProvider`と`TemplatedMailWebEventProvider`します。</span><span class="sxs-lookup"><span data-stu-id="966b1-192">The health monitoring system includes two email log source provider classes: `SimpleMailWebEventProvider` and `TemplatedMailWebEventProvider`.</span></span> <span data-ttu-id="966b1-193">[ `SimpleMailWebEventProvider`クラス](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx)送信イベントを含むプレーン テキストの電子メール メッセージの詳細し、電子メールの本文の少しのカスタマイズを提供します。</span><span class="sxs-lookup"><span data-stu-id="966b1-193">The [`SimpleMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) sends a plain-text email message that includes the event details and provides little customization of the email body.</span></span> <span data-ttu-id="966b1-194">[ `TemplatedMailWebEventProvider`クラス](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx)が出力されるマークアップは、電子メール メッセージの本文として使用する ASP.NET ページを指定します。</span><span class="sxs-lookup"><span data-stu-id="966b1-194">With the [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) you specify an ASP.NET page whose rendered markup is used as the body for the email message.</span></span> <span data-ttu-id="966b1-195">[ `TemplatedMailWebEventProvider`クラス](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx)内容と、電子メール メッセージの形式を厳密に大きい制御を使用するが、さらに初期作業の電子メール メッセージの本文を生成する ASP.NET ページを作成する必要が必要です。</span><span class="sxs-lookup"><span data-stu-id="966b1-195">The [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) gives you much greater control over the contents and format of the email message, but requires a bit more upfront work as you have to create the ASP.NET page that generates the email message's body.</span></span> <span data-ttu-id="966b1-196">このチュートリアルを使用してでは説明、`SimpleMailWebEventProvider`クラス。</span><span class="sxs-lookup"><span data-stu-id="966b1-196">This tutorial focuses on using the `SimpleMailWebEventProvider` class.</span></span>

<span data-ttu-id="966b1-197">状態監視システムの更新`<providers>`内の要素、`Web.config`ファイルにログのソースを含め、`SimpleMailWebEventProvider`クラス。</span><span class="sxs-lookup"><span data-stu-id="966b1-197">Update the health monitoring system's `<providers>` element in the `Web.config` file to include a log source for the `SimpleMailWebEventProvider` class:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample3.xml)]

<span data-ttu-id="966b1-198">上記のマークアップを使用して、`SimpleMailWebEventProvider`ログ ソース プロバイダーでは、クラスとフレンドリ名"EmailWebEventProvider"が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="966b1-198">The above markup uses the `SimpleMailWebEventProvider` class as the log source provider, and assigns it the friendly name "EmailWebEventProvider".</span></span> <span data-ttu-id="966b1-199">さらに、`<add>`属性にはなど、To、および電子メール メッセージのアドレスからの追加の構成オプションが含まれています。</span><span class="sxs-lookup"><span data-stu-id="966b1-199">Moreover, the `<add>` attribute includes additional configuration options, such as the To and From addresses of the email message.</span></span>

<span data-ttu-id="966b1-200">定義されているメールのログ ソースに残っているはこのソース「未処理の例外のログ」を使用してシステムの監視の正常性を指示します。</span><span class="sxs-lookup"><span data-stu-id="966b1-200">With the email log source defined, all that remains is to instruct the health monitoring system to use this source to "log" unhandled exceptions.</span></span> <span data-ttu-id="966b1-201">これで新しい規則の追加によって実現されます、`<rules>`セクション。</span><span class="sxs-lookup"><span data-stu-id="966b1-201">This is accomplished by adding a new rule in the `<rules>` section:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample4.xml)]

<span data-ttu-id="966b1-202">`<rules>`セクションが 2 つの規則が含まれています。</span><span class="sxs-lookup"><span data-stu-id="966b1-202">The `<rules>` section now includes two rules.</span></span> <span data-ttu-id="966b1-203">「すべてのエラーへの電子メール」、という名前の最初の 1 つは、すべてのハンドルされない例外を"EmailWebEventProvider"ログのソースに送信します。</span><span class="sxs-lookup"><span data-stu-id="966b1-203">The first one, named "All Errors To Email", sends all unhandled exceptions to the "EmailWebEventProvider" log source.</span></span> <span data-ttu-id="966b1-204">このルールは、web サイトを指定したエラーの詳細を送信する効果をアドレスにします。</span><span class="sxs-lookup"><span data-stu-id="966b1-204">This rule has the effect of sending details about errors on the website to the specified To address.</span></span> <span data-ttu-id="966b1-205">"すべてのエラー データベースへのルールは、サイトのデータベースに、エラーの詳細を記録します。</span><span class="sxs-lookup"><span data-stu-id="966b1-205">The "All Errors To Database" rule logs the error details to the site's database.</span></span> <span data-ttu-id="966b1-206">その結果、その詳細が、サイトでハンドルされない例外が発生する両方データベースにログに記録は、指定した電子メール アドレスに送信します。</span><span class="sxs-lookup"><span data-stu-id="966b1-206">Consequently, whenever an unhandled exception occurs on the site its details are both logged to the database and sent to specified email address.</span></span>

<span data-ttu-id="966b1-207">**図 2**によって生成された電子メールを示しています、`SimpleMailWebEventProvider`クラスにアクセスすると`Genre.aspx?ID=foo`します。</span><span class="sxs-lookup"><span data-stu-id="966b1-207">**Figure 2** shows the email generated by the `SimpleMailWebEventProvider` class when visiting `Genre.aspx?ID=foo`.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image4.png)

<span data-ttu-id="966b1-208">**図 2**:エラーの詳細が電子メール メッセージで送信されます。</span><span class="sxs-lookup"><span data-stu-id="966b1-208">**Figure 2**: The Error Details are Sent in an Email Message</span></span>  
<span data-ttu-id="966b1-209">([フルサイズの画像を表示する をクリックします](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))。</span><span class="sxs-lookup"><span data-stu-id="966b1-209">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span></span>

## <a name="summary"></a><span data-ttu-id="966b1-210">まとめ</span><span class="sxs-lookup"><span data-stu-id="966b1-210">Summary</span></span>

<span data-ttu-id="966b1-211">ASP.NET 状態監視システムは、管理者デプロイされた web アプリケーションのヘルスを監視できるように設計されています。</span><span class="sxs-lookup"><span data-stu-id="966b1-211">The ASP.NET health monitoring system is designed to allow administrators to monitor the health of a deployed web application.</span></span> <span data-ttu-id="966b1-212">アプリケーションが停止したら、ユーザーが正常にログイン時のサイトになど、特定のアクションを展開するときに、または未処理の例外が発生した場合、状態監視イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="966b1-212">Health monitoring events are raised when certain actions unfold, such as when the application stops, when a user successfully logs onto the site, or when an unhandled exception occurs.</span></span> <span data-ttu-id="966b1-213">ログ ソースの任意の数には、これらのイベントを記録できます。</span><span class="sxs-lookup"><span data-stu-id="966b1-213">These events can be logged to any number of log sources.</span></span> <span data-ttu-id="966b1-214">このチュートリアルでは、データベースと、電子メール メッセージを通じて、未処理の例外の詳細を記録する方法を示しました。</span><span class="sxs-lookup"><span data-stu-id="966b1-214">This tutorial showed how to log the details of unhandled exceptions to a database and through an email message.</span></span>

<span data-ttu-id="966b1-215">このチュートリアルは、未処理の例外のログに留意する正常性の監視がデプロイされた ASP.NET アプリケーションの全体的な正常性の測定し、豊富な正常性イベントの監視が含まれていますが、ログ ソースを監視する health の使用に重点を置いてください。ここで説明します。</span><span class="sxs-lookup"><span data-stu-id="966b1-215">This tutorial focused on using health monitoring to log unhandled exceptions, but keep in mind that health monitoring is designed to measure the overall health of a deployed ASP.NET application and includes a wealth of health monitoring events and log sources not explored here.</span></span> <span data-ttu-id="966b1-216">詳細については、独自の正常性監視イベントとログのソースを作成することができます必要に応じて発生します。</span><span class="sxs-lookup"><span data-stu-id="966b1-216">What's more, you can create your own health monitoring events and log sources, should the need arise.</span></span> <span data-ttu-id="966b1-217">正常性の監視の詳細を習得に関心は、優れた第一歩ですに目を通して[Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)の[正常性の監視に関する FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="966b1-217">If you are interested in learning more about health monitoring, a good first step is to read through [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)'s [health monitoring FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span></span> <span data-ttu-id="966b1-218">次を参照してください[How To:ASP.NET 2.0 でヘルスの監視を使用して、](https://msdn.microsoft.com/library/ms998306.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="966b1-218">Following that, consult [How To: Use Health Monitoring in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span></span>

<span data-ttu-id="966b1-219">満足のプログラミングです。</span><span class="sxs-lookup"><span data-stu-id="966b1-219">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="966b1-220">関連項目</span><span class="sxs-lookup"><span data-stu-id="966b1-220">Further Reading</span></span>

<span data-ttu-id="966b1-221">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="966b1-221">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="966b1-222">ASP.NET 状態監視の概要</span><span class="sxs-lookup"><span data-stu-id="966b1-222">ASP.NET Health Monitoring Overview</span></span>](https://msdn.microsoft.com/library/bb398933.aspx)
- [<span data-ttu-id="966b1-223">構成および監視システムは ASP.NET の正常性をカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="966b1-223">Configuring and Customizing the Health Monitoring System of ASP.NET</span></span>](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [<span data-ttu-id="966b1-224">よく寄せられる質問 - ASP.NET 2.0 での監視の正常性</span><span class="sxs-lookup"><span data-stu-id="966b1-224">FAQ - Health Monitoring in ASP.NET 2.0</span></span>](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [<span data-ttu-id="966b1-225">方法: 状態監視通知の電子メールを送信します。</span><span class="sxs-lookup"><span data-stu-id="966b1-225">How To: Send E-Mail for Health Monitoring Notifications</span></span>](https://msdn.microsoft.com/library/ms227553.aspx)
- [<span data-ttu-id="966b1-226">方法: ASP.NET でヘルスの監視を使用して、</span><span class="sxs-lookup"><span data-stu-id="966b1-226">How To: Use Health Monitoring in ASP.NET</span></span>](https://msdn.microsoft.com/library/ms998306.aspx)
- [<span data-ttu-id="966b1-227">ASP.NET での監視の正常性</span><span class="sxs-lookup"><span data-stu-id="966b1-227">Health Monitoring in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="966b1-228">[前へ](processing-unhandled-exceptions-cs.md)
> [次へ](logging-error-details-with-elmah-cs.md)</span><span class="sxs-lookup"><span data-stu-id="966b1-228">[Previous](processing-unhandled-exceptions-cs.md)
[Next](logging-error-details-with-elmah-cs.md)</span></span>
