---
uid: web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-content-page-from-the-master-page-vb
title: マスターページからコンテンツページと対話する (VB) |Microsoft Docs
author: rick-anderson
description: マスターページのコードから、コンテンツページのメソッドの呼び出し、プロパティの設定などを行う方法について説明します。
ms.author: riande
ms.date: 07/11/2008
ms.assetid: a6e2e1a0-c925-43e9-b711-1f178fdd72d7
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-content-page-from-the-master-page-vb
msc.type: authoredcontent
ms.openlocfilehash: 5367ad1b7f2fa11c635ad95754c9bcc1edcb6c1d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74615544"
---
# <a name="interacting-with-the-content-page-from-the-master-page-vb"></a><span data-ttu-id="0c7a1-103">マスター ページからコンテンツ ページと対話する (VB)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-103">Interacting with the Content Page from the Master Page (VB)</span></span>

<span data-ttu-id="0c7a1-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0c7a1-105">[コードのダウンロード](https://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_07_VB.zip)または[PDF のダウンロード](https://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_07_VB.pdf)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-105">[Download Code](https://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_07_VB.zip) or [Download PDF](https://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_07_VB.pdf)</span></span>

> <span data-ttu-id="0c7a1-106">マスターページのコードから、コンテンツページのメソッドの呼び出し、プロパティの設定などを行う方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-106">Examines how to call methods, set properties, etc. of the Content Page from code in the Master Page.</span></span>

## <a name="introduction"></a><span data-ttu-id="0c7a1-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="0c7a1-107">Introduction</span></span>

<span data-ttu-id="0c7a1-108">前のチュートリアルでは、コンテンツページをプログラムでマスターページと対話させる方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-108">The preceding tutorial examined how to have the content page programmatically interact with its master page.</span></span> <span data-ttu-id="0c7a1-109">マスターページが更新され、最後に追加された5つの製品が一覧表示された GridView コントロールが追加されたことを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-109">Recall that we updated the master page to include a GridView control that listed the five most recently added products.</span></span> <span data-ttu-id="0c7a1-110">次に、ユーザーが新しい製品を追加できるコンテンツページを作成しました。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-110">We then created a content page from which the user could add a new product.</span></span> <span data-ttu-id="0c7a1-111">新しい製品を追加すると、追加した製品が含まれるように、マスターページに GridView を更新するように指示するために必要なコンテンツページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-111">Upon adding a new product, the content page needed to instruct the master page to refresh its GridView so that it would include the just-added product.</span></span> <span data-ttu-id="0c7a1-112">この機能を実現するには、GridView にバインドされたデータを更新するマスターページにパブリックメソッドを追加し、コンテンツページからそのメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-112">This functionality was accomplished by adding a public method to the master page that refreshed the data bound to the GridView, and then invoking that method from the content page.</span></span>

<span data-ttu-id="0c7a1-113">コンテンツページとマスターページの操作の最も一般的な形式は、コンテンツページからです。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-113">The most common form of content and master page interaction originates from the content page.</span></span> <span data-ttu-id="0c7a1-114">ただし、マスターページで現在のコンテンツページを動作させることができます。また、マスターページにユーザーインターフェイス要素が含まれていて、ユーザーがコンテンツページにも表示されるデータを変更できるようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-114">However, it is possible for the master page to rouse the current content page into action, and such functionality may be needed if the master page contains user interface elements that enable users to modify data that is also displayed on the content page.</span></span> <span data-ttu-id="0c7a1-115">GridView コントロールに製品情報を表示するコンテンツページと、クリックしたときにすべての製品の価格を倍にしたボタンコントロールを含むマスターページを考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-115">Consider a content page that displays the products information in a GridView control and a master page that includes a Button control that, when clicked, doubles the prices of all products.</span></span> <span data-ttu-id="0c7a1-116">前のチュートリアルの例と同様に、GridView は新しい価格を表示するために、[二重価格] ボタンをクリックした後に更新する必要がありますが、このシナリオでは、コンテンツページのアクションを作成する必要があるマスターページです。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-116">Much like the example in the preceding tutorial, the GridView needs to be refreshed after the double price Button is clicked so that it displays the new prices, but in this scenario it's the master page that needs to rouse the content page into action.</span></span>

<span data-ttu-id="0c7a1-117">このチュートリアルでは、コンテンツページで定義されているマスターページの機能を実行する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-117">This tutorial explores how to have the master page invoke functionality defined in the content page.</span></span>

### <a name="instigating-programmatic-interaction-via-an-event-and-event-handlers"></a><span data-ttu-id="0c7a1-118">Instigating イベントハンドラーとイベントハンドラーを使用したプログラムによる対話</span><span class="sxs-lookup"><span data-stu-id="0c7a1-118">Instigating Programmatic Interaction via an Event and Event Handlers</span></span>

<span data-ttu-id="0c7a1-119">マスターページからコンテンツページ機能を呼び出すことは、他の方法よりも難しくなります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-119">Invoking content page functionality from a master page is more challenging than the other way around.</span></span> <span data-ttu-id="0c7a1-120">コンテンツページには1つのマスターページがあるため、コンテンツページからプログラムによる操作を instigating するときには、どのようなパブリックメソッドとプロパティが破棄されているかがわかります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-120">Because a content page has a single master page, when instigating the programmatic interaction from the content page we know what public methods and properties are at our disposal.</span></span> <span data-ttu-id="0c7a1-121">ただし、マスターページにはさまざまなコンテンツページがあり、それぞれに独自のプロパティとメソッドのセットがあります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-121">A master page, however, can have many different content pages, each with its own set of properties and methods.</span></span> <span data-ttu-id="0c7a1-122">その後、ランタイムまでどのコンテンツページが呼び出されるかわからない場合に、マスターページにコードを記述して、コンテンツページで何らかのアクションを実行できます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-122">How, then, can we write code in the master page to perform some action in its content page when we don't know what content page will be invoked until runtime?</span></span>

<span data-ttu-id="0c7a1-123">Button コントロールなどの ASP.NET Web コントロールについて考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-123">Consider an ASP.NET Web control, such as the Button control.</span></span> <span data-ttu-id="0c7a1-124">ボタンコントロールは、任意の数の ASP.NET ページに表示でき、クリックされたことをページに通知するためのメカニズムを必要とします。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-124">A Button control can appear on any number of ASP.NET pages and needs a mechanism by which it can alert the page that it has been clicked.</span></span> <span data-ttu-id="0c7a1-125">これは、*イベント*を使用して行います。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-125">This is accomplished using *events*.</span></span> <span data-ttu-id="0c7a1-126">特に、ボタンコントロールがクリックされると、その `Click` イベントが発生します。ボタンを含む ASP.NET ページは、必要に応じて、*イベントハンドラー*を介してその通知に応答できます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-126">In particular, the Button control raises its `Click` event when it is clicked; the ASP.NET page that contains the Button can optionally respond to that notification via an *event handler*.</span></span>

<span data-ttu-id="0c7a1-127">この同じパターンを使用して、マスターページのコンテンツページで機能をトリガーすることができます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-127">This same pattern can be used to have a master page trigger functionality in its content pages:</span></span>

1. <span data-ttu-id="0c7a1-128">マスターページにイベントを追加します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-128">Add an event to the master page.</span></span>
2. <span data-ttu-id="0c7a1-129">マスターページがそのコンテンツページと通信する必要がある場合は常に、イベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-129">Raise the event whenever the master page needs to communicate with its content page.</span></span> <span data-ttu-id="0c7a1-130">たとえば、マスターページで、ユーザーが価格を2倍にしたことをコンテンツページに通知する必要がある場合、価格が2倍になった直後にそのイベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-130">For example, if the master page needs to alert its content page that the user has doubled the prices, its event would be raised immediately after the prices have been doubled.</span></span>
3. <span data-ttu-id="0c7a1-131">アクションを実行する必要があるコンテンツページにイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-131">Create an event handler in those content pages that need to take some action.</span></span>

<span data-ttu-id="0c7a1-132">このチュートリアルの残りの部分では、概要で説明されている例を実装します。つまり、データベース内の製品と、価格を倍にするボタンコントロールが含まれているマスターページを一覧表示するコンテンツページです。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-132">This remainder of this tutorial implements the example outlined in the Introduction; namely, a content page that lists the products in the database and a master page that includes a Button control to double the prices.</span></span>

## <a name="step-1-displaying-products-in-a-content-page"></a><span data-ttu-id="0c7a1-133">手順 1: コンテンツページで製品を表示する</span><span class="sxs-lookup"><span data-stu-id="0c7a1-133">Step 1: Displaying Products in a Content Page</span></span>

<span data-ttu-id="0c7a1-134">最初のビジネスの順序は、Northwind データベースから製品を一覧表示するコンテンツページを作成することです。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-134">Our first order of business is to create a content page that lists the products from the Northwind database.</span></span> <span data-ttu-id="0c7a1-135">(前のチュートリアルでは、[[*コンテンツ] ページからマスターページと対話*](interacting-with-the-master-page-from-the-content-page-vb.md)するために Northwind データベースをプロジェクトに追加しました)。まず、`Products.aspx`という名前の `~/Admin` フォルダーに新しい ASP.NET ページを追加し、`Site.master` マスターページにバインドします。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-135">(We added the Northwind database to the project in the preceding tutorial, [*Interacting with the Master Page from the Content Page*](interacting-with-the-master-page-from-the-content-page-vb.md).) Start by adding a new ASP.NET page to the `~/Admin` folder named `Products.aspx`, making sure to bind it to the `Site.master` master page.</span></span> <span data-ttu-id="0c7a1-136">図1は、このページが web サイトに追加された後のソリューションエクスプローラーを示しています。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-136">Figure 1 shows the Solution Explorer after this page has been added to the website.</span></span>

<span data-ttu-id="0c7a1-137">[新しい ASP.NET ページを管理フォルダーに追加 ![には](interacting-with-the-content-page-from-the-master-page-vb/_static/image2.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-137">[![Add a New ASP.NET Page to the Admin Folder](interacting-with-the-content-page-from-the-master-page-vb/_static/image2.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image1.png)</span></span>

<span data-ttu-id="0c7a1-138">**図 01**: `Admin` フォルダーに新しい ASP.NET ページを追加する ([クリックすると、フルサイズの画像が表示](interacting-with-the-content-page-from-the-master-page-vb/_static/image3.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-138">**Figure 01**: Add a New ASP.NET Page to the `Admin` Folder ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-vb/_static/image3.png))</span></span>

<span data-ttu-id="0c7a1-139">[ *「マスターページでタイトル、メタタグ、およびその他の HTML ヘッダーを指定*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-vb.md)する」チュートリアルでは、明示的に設定されていない場合にページのタイトルを生成する `BasePage` という名前のカスタム基本ページクラスを作成しました。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-139">Recall that in the [*Specifying the Title, Meta Tags, and Other HTML Headers in the Master Page*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-vb.md) tutorial we created a custom base page class named `BasePage` that generates the page's title if it is not explicitly set.</span></span> <span data-ttu-id="0c7a1-140">`Products.aspx` ページの分離コードクラスにアクセスし、`System.Web.UI.Page`からではなく `BasePage` から派生させます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-140">Go to the `Products.aspx` page's code-behind class and have it derive from `BasePage` (instead of from `System.Web.UI.Page`).</span></span>

<span data-ttu-id="0c7a1-141">最後に、このレッスンのエントリを含めるように `Web.sitemap` ファイルを更新します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-141">Finally, update the `Web.sitemap` file to include an entry for this lesson.</span></span> <span data-ttu-id="0c7a1-142">次のマークアップを `<siteMapNode>` の下に追加して、マスターページへのコンテンツの相互作用に関するレッスンを行います。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-142">Add the following markup beneath the `<siteMapNode>` for the Content to Master Page Interaction lesson:</span></span>

[!code-xml[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample1.xml)]

<span data-ttu-id="0c7a1-143">この `<siteMapNode>` 要素の追加は、レッスンの一覧に反映されます (図5を参照)。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-143">The addition of this `<siteMapNode>` element is reflected in the Lessons list (see Figure 5).</span></span>

<span data-ttu-id="0c7a1-144">`Products.aspx`に戻ります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-144">Return to `Products.aspx`.</span></span> <span data-ttu-id="0c7a1-145">`MainContent`のコンテンツコントロールで、GridView コントロールを追加し、`ProductsGrid`という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-145">In the Content control for `MainContent`, add a GridView control and name it `ProductsGrid`.</span></span> <span data-ttu-id="0c7a1-146">GridView を `ProductsDataSource`という名前の新しい SqlDataSource コントロールにバインドします。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-146">Bind the GridView to a new SqlDataSource control named `ProductsDataSource`.</span></span>

<span data-ttu-id="0c7a1-147">[GridView を新しい SqlDataSource コントロールにバインド ![には](interacting-with-the-content-page-from-the-master-page-vb/_static/image5.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-147">[![Bind the GridView to a New SqlDataSource Control](interacting-with-the-content-page-from-the-master-page-vb/_static/image5.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image4.png)</span></span>

<span data-ttu-id="0c7a1-148">**図 02**: GridView を新しい SqlDataSource コントロールにバインドする ([クリックすると、フルサイズの画像が表示](interacting-with-the-content-page-from-the-master-page-vb/_static/image6.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-148">**Figure 02**: Bind the GridView to a New SqlDataSource Control  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-vb/_static/image6.png))</span></span>

<span data-ttu-id="0c7a1-149">Northwind データベースを使用するようにウィザードを構成します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-149">Configure the wizard so that it uses the Northwind database.</span></span> <span data-ttu-id="0c7a1-150">前のチュートリアルを実行していた場合は、`Web.config`に `NorthwindConnectionString` という名前の接続文字列が既に存在している必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-150">If you worked through the previous tutorial then you should already have a connection string named `NorthwindConnectionString` in `Web.config`.</span></span> <span data-ttu-id="0c7a1-151">図3に示すように、ドロップダウンリストからこの接続文字列を選択します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-151">Choose this connection string from the drop-down list, as shown in Figure 3.</span></span>

<span data-ttu-id="0c7a1-152">[Northwind データベースを使用するように SqlDataSource を構成 ![には](interacting-with-the-content-page-from-the-master-page-vb/_static/image8.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-152">[![Configure the SqlDataSource to Use the Northwind Database](interacting-with-the-content-page-from-the-master-page-vb/_static/image8.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image7.png)</span></span>

<span data-ttu-id="0c7a1-153">**図 03**: Northwind データベースを使用するように SqlDataSource を構成する ([クリックすると、フルサイズの画像が表示](interacting-with-the-content-page-from-the-master-page-vb/_static/image9.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-153">**Figure 03**: Configure the SqlDataSource to Use the Northwind Database  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-vb/_static/image9.png))</span></span>

<span data-ttu-id="0c7a1-154">次に、ドロップダウンリストから Products テーブルを選択し、`ProductName` 列と `UnitPrice` 列を返すことによって、データソースコントロールの `SELECT` ステートメントを指定します (図4を参照)。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-154">Next, specify the data source control's `SELECT` statement by choosing the Products table from the drop-down list and returning the `ProductName` and `UnitPrice` columns (see Figure 4).</span></span> <span data-ttu-id="0c7a1-155">[次へ] をクリックし、[完了] をクリックして、データソースの構成ウィザードを完了します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-155">Click Next and then Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="0c7a1-156">[Products テーブルから ProductName フィールドと UnitPrice フィールドを返す ![](interacting-with-the-content-page-from-the-master-page-vb/_static/image11.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-156">[![Return the ProductName and UnitPrice Fields from the Products Table](interacting-with-the-content-page-from-the-master-page-vb/_static/image11.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image10.png)</span></span>

<span data-ttu-id="0c7a1-157">**図 04**: `Products` テーブルから `ProductName` フィールドと `UnitPrice` フィールドを返す ([クリックすると、フルサイズの画像が表示](interacting-with-the-content-page-from-the-master-page-vb/_static/image12.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-157">**Figure 04**: Return the `ProductName` and `UnitPrice` Fields from the `Products` Table  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-vb/_static/image12.png))</span></span>

<span data-ttu-id="0c7a1-158">必要な作業は以上です。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-158">That's all there is to it!</span></span> <span data-ttu-id="0c7a1-159">ウィザードを完了すると、Visual Studio によって2つの BoundFields が GridView に追加され、SqlDataSource コントロールによって返される2つのフィールドがミラー化されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-159">After completing the wizard Visual Studio adds two BoundFields to the GridView to mirror the two fields returned by the SqlDataSource control.</span></span> <span data-ttu-id="0c7a1-160">GridView および SqlDataSource コントロールのマークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-160">The GridView and SqlDataSource controls' markup follows.</span></span> <span data-ttu-id="0c7a1-161">図5は、ブラウザーを使用して表示した場合の結果を示しています。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-161">Figure 5 shows the results when viewed through a browser.</span></span>

[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample2.aspx)]

<span data-ttu-id="0c7a1-162">[各製品とその価格が GridView に表示される ![](interacting-with-the-content-page-from-the-master-page-vb/_static/image14.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-162">[![Each Product and its Price is Listed in the GridView](interacting-with-the-content-page-from-the-master-page-vb/_static/image14.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image13.png)</span></span>

<span data-ttu-id="0c7a1-163">**図 05**: 各製品とその価格が GridView に表示される ([クリックすると、フルサイズの画像が表示](interacting-with-the-content-page-from-the-master-page-vb/_static/image15.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-163">**Figure 05**: Each Product and its Price is Listed in the GridView  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-vb/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="0c7a1-164">GridView の外観を自由にクリーンアップしてください。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-164">Feel free to clean up the appearance of the GridView.</span></span> <span data-ttu-id="0c7a1-165">いくつかの提案には、表示される UnitPrice 値を通貨として書式設定し、背景色とフォントを使用してグリッドの外観を向上させることがあります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-165">Some suggestions include formatting the displayed UnitPrice value as a currency and using background colors and fonts to improve the grid's appearance.</span></span> <span data-ttu-id="0c7a1-166">ASP.NET でのデータの表示と書式設定の詳細については、「[データチュートリアルシリーズの使用](../../data-access/index.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-166">For more information on displaying and formatting data in ASP.NET, refer to my [Working with Data tutorial series](../../data-access/index.md).</span></span>

## <a name="step-2-adding-a-double-prices-button-to-the-master-page"></a><span data-ttu-id="0c7a1-167">手順 2: マスターページに2つの価格ボタンを追加する</span><span class="sxs-lookup"><span data-stu-id="0c7a1-167">Step 2: Adding a Double Prices Button to the Master Page</span></span>

<span data-ttu-id="0c7a1-168">次のタスクでは、マスターページにボタン Web コントロールを追加します。クリックすると、データベース内のすべての製品の価格が2倍になります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-168">Our next task is to add a Button Web control to the master page that, when clicked, will double the price of all products in the database.</span></span> <span data-ttu-id="0c7a1-169">`Site.master` マスターページを開き、[ツールボックス] からボタンをデザイナーにドラッグして、前のチュートリアルで追加した `RecentProductsDataSource` SqlDataSource コントロールの下に配置します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-169">Open the `Site.master` master page and drag a Button from the Toolbox onto the Designer, placing it beneath the `RecentProductsDataSource` SqlDataSource control we added in the previous tutorial.</span></span> <span data-ttu-id="0c7a1-170">ボタンの `ID` プロパティを `DoublePrice` に設定し、その `Text` プロパティを "Double Product プライス" に設定します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-170">Set the Button's `ID` property to `DoublePrice` and its `Text` property to "Double Product Prices".</span></span>

<span data-ttu-id="0c7a1-171">次に、`DoublePricesDataSource`に名前を付けて、SqlDataSource コントロールをマスターページに追加します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-171">Next, add a SqlDataSource control to the master page, naming it `DoublePricesDataSource`.</span></span> <span data-ttu-id="0c7a1-172">この SqlDataSource は、`UPDATE` ステートメントを実行してすべての価格を2倍にするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-172">This SqlDataSource will be used to execute the `UPDATE` statement to double all prices.</span></span> <span data-ttu-id="0c7a1-173">具体的には、`ConnectionString` と `UpdateCommand` プロパティを適切な接続文字列と `UPDATE` ステートメントに設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-173">Specifically, we need to set its `ConnectionString` and `UpdateCommand` properties to the appropriate connection string and `UPDATE` statement.</span></span> <span data-ttu-id="0c7a1-174">次に、[`DoublePrice`] ボタンをクリックしたときに、この SqlDataSource コントロールの `Update` メソッドを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-174">Then we need to call this SqlDataSource control's `Update` method when the `DoublePrice` Button is clicked.</span></span> <span data-ttu-id="0c7a1-175">`ConnectionString` と `UpdateCommand` のプロパティを設定するには、SqlDataSource コントロールを選択し、プロパティウィンドウにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-175">To set the `ConnectionString` and `UpdateCommand` properties, select the SqlDataSource control and then go to the Properties window.</span></span> <span data-ttu-id="0c7a1-176">`ConnectionString` プロパティには、`Web.config` に既に格納されている接続文字列がドロップダウンリストに表示されます。図6に示すように、`NorthwindConnectionString` オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-176">The `ConnectionString` property lists those connection strings already stored in `Web.config` in a drop-down list; choose the `NorthwindConnectionString` option as shown in Figure 6.</span></span>

<span data-ttu-id="0c7a1-177">[NorthwindConnectionString を使用するように SqlDataSource を構成 ![には](interacting-with-the-content-page-from-the-master-page-vb/_static/image17.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-177">[![Configure the SqlDataSource to Use the NorthwindConnectionString](interacting-with-the-content-page-from-the-master-page-vb/_static/image17.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image16.png)</span></span>

<span data-ttu-id="0c7a1-178">**図 06**: `NorthwindConnectionString` を使用するように SqlDataSource を構成する ([クリックすると、フルサイズの画像が表示](interacting-with-the-content-page-from-the-master-page-vb/_static/image18.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-178">**Figure 06**: Configure the SqlDataSource to Use the `NorthwindConnectionString` ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-vb/_static/image18.png))</span></span>

<span data-ttu-id="0c7a1-179">`UpdateCommand` プロパティを設定するには、プロパティウィンドウで UpdateQuery オプションを見つけます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-179">To set the `UpdateCommand` property, locate the UpdateQuery option in the Properties window.</span></span> <span data-ttu-id="0c7a1-180">このプロパティを選択すると、ボタンが省略記号付きで表示されます。このボタンをクリックすると、図7に示す [コマンドおよびパラメーターエディター] ダイアログボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-180">This property, when selected, displays a button with ellipses; click this button to display the Command and Parameter Editor dialog box shown in Figure 7.</span></span> <span data-ttu-id="0c7a1-181">ダイアログボックスのテキストボックスに、次の `UPDATE` ステートメントを入力します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-181">Type the following `UPDATE` statement into the dialog box's textbox:</span></span>

[!code-sql[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample3.sql)]

<span data-ttu-id="0c7a1-182">このステートメントを実行すると、`Products` テーブル内の各レコードの `UnitPrice` 値が2倍になります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-182">This statement, when executed, will double the `UnitPrice` value for each record in the `Products` table.</span></span>

<span data-ttu-id="0c7a1-183">[SqlDataSource の UpdateCommand プロパティを設定 ![](interacting-with-the-content-page-from-the-master-page-vb/_static/image20.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-183">[![Set SqlDataSource's UpdateCommand Property](interacting-with-the-content-page-from-the-master-page-vb/_static/image20.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image19.png)</span></span>

<span data-ttu-id="0c7a1-184">**図 07**: SqlDataSource の `UpdateCommand` プロパティを設定[する (クリックすると、フルサイズの画像が表示](interacting-with-the-content-page-from-the-master-page-vb/_static/image21.png)される)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-184">**Figure 07**: Set SqlDataSource's `UpdateCommand` Property  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-vb/_static/image21.png))</span></span>

<span data-ttu-id="0c7a1-185">これらのプロパティを設定した後、ボタンおよび SqlDataSource コントロールの宣言型マークアップは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-185">After setting these properties, your Button and SqlDataSource controls' declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample4.aspx)]

<span data-ttu-id="0c7a1-186">残っているのは、`DoublePrice` ボタンをクリックしたときに `Update` メソッドを呼び出すことだけです。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-186">All that remains is to call its `Update` method when the `DoublePrice` Button is clicked.</span></span> <span data-ttu-id="0c7a1-187">`DoublePrice` ボタンの `Click` イベントハンドラーを作成し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-187">Create a `Click` event handler for the `DoublePrice` Button and add the following code:</span></span>

[!code-vb[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample5.vb)]

<span data-ttu-id="0c7a1-188">この機能をテストするには、手順1で作成した `~/Admin/Products.aspx` のページにアクセスし、[Double Product プライス] \ (二重製品価格 \) ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-188">To test this functionality, visit the `~/Admin/Products.aspx` page we created in Step 1 and click the "Double Product Prices" button.</span></span> <span data-ttu-id="0c7a1-189">このボタンをクリックすると、ポストバックが発生し、`DoublePrice` ボタンの `Click` イベントハンドラーが実行され、すべての製品の価格が2倍になります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-189">Clicking the button causes a postback and executes the `DoublePrice` Button's `Click` event handler, doubling the prices of all products.</span></span> <span data-ttu-id="0c7a1-190">ページが再レンダリングされ、マークアップが返されて、ブラウザーに再表示されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-190">The page is then re-rendered and the markup is returned and re-displayed in the browser.</span></span> <span data-ttu-id="0c7a1-191">ただし、[コンテンツ] ページの GridView には、[二重の製品価格] ボタンがクリックされたときと同じ価格が表示されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-191">The GridView in the content page, however, lists the same prices as before the "Double Product Prices" button was clicked.</span></span> <span data-ttu-id="0c7a1-192">これは、GridView に最初に読み込まれたデータの状態がビューステートに格納されているため、特に指示がない限りポストバックに再読み込みされないためです。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-192">This is because the data initially loaded in the GridView had its state stored in view state, so it's not reloaded on postbacks unless instructed otherwise.</span></span> <span data-ttu-id="0c7a1-193">別のページにアクセスし、[`~/Admin/Products.aspx`] ページに戻ると、更新された価格が表示されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-193">If you visit a different page and then return to the `~/Admin/Products.aspx` page you'll see the updated prices.</span></span>

## <a name="step-3-raising-an-event-when-the-prices-are-doubled"></a><span data-ttu-id="0c7a1-194">手順 3: 価格が2倍になったときにイベントを発生させる</span><span class="sxs-lookup"><span data-stu-id="0c7a1-194">Step 3: Raising an Event When the Prices are Doubled</span></span>

<span data-ttu-id="0c7a1-195">`~/Admin/Products.aspx` ページの GridView には、価格の2倍がすぐに反映されていないので、ユーザーは [当然の製品価格] ボタンをクリックしなかったか、または機能していないと思われるかもしれません。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-195">Because the GridView in the `~/Admin/Products.aspx` page does not immediately reflect the price doubling, a user may understandably think that they did not click the "Double Product Prices" button, or that it didn't work.</span></span> <span data-ttu-id="0c7a1-196">このボタンを数回クリックすると、もう一度もう一度料金が倍増します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-196">They may try clicking the button a few more times, doubling the prices again and again.</span></span> <span data-ttu-id="0c7a1-197">この問題を解決するには、コンテンツページのグリッドに、2倍になった後すぐに新しい価格が表示されるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-197">To fix this we need to have the grid in the content page display the new prices immediately after they are doubled.</span></span>

<span data-ttu-id="0c7a1-198">このチュートリアルで既に説明したように、ユーザーが [`DoublePrice`] ボタンをクリックするたびに、マスターページでイベントを発生させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-198">As discussed earlier in this tutorial, we need to raise an event in the master page whenever the user clicks the `DoublePrice` Button.</span></span> <span data-ttu-id="0c7a1-199">イベントは、1つのクラス (イベントパブリッシャー) が、興味深い問題が発生した他のクラス (イベントサブスクライバー) のセットを別のクラスに通知する方法です。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-199">An event is a way for one class (an event publisher) to notify another a set of other classes (the event subscribers) that something interesting has occurred.</span></span> <span data-ttu-id="0c7a1-200">この例では、マスターページはイベントパブリッシャーです。`DoublePrice` ボタンをクリックしたときに注意するコンテンツページはサブスクライバーです。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-200">In this example, the master page is the event publisher; those content pages that care about when the `DoublePrice` Button is clicked are the subscribers.</span></span>

<span data-ttu-id="0c7a1-201">クラスは、発生するイベントに応答して実行されるメソッドである*イベントハンドラー*を作成することによって、イベントをサブスクライブします。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-201">A class subscribes to an event by creating an *event handler*, which is a method that is executed in response to the event being raised.</span></span> <span data-ttu-id="0c7a1-202">発行元は、*イベントデリゲート*を定義することによって発生するイベントを定義します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-202">The publisher defines the events he raises by defining an *event delegate*.</span></span> <span data-ttu-id="0c7a1-203">イベントデリゲートは、イベントハンドラーが受け入れる必要のある入力パラメーターを指定します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-203">The event delegate specifies what input parameters the event handler must accept.</span></span> <span data-ttu-id="0c7a1-204">.NET Framework では、イベントデリゲートは値を返さず、次の2つの入力パラメーターを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-204">In the .NET Framework, event delegates do not return any value and accept two input parameters:</span></span>

- <span data-ttu-id="0c7a1-205">イベントソースを識別する `Object`</span><span class="sxs-lookup"><span data-stu-id="0c7a1-205">An `Object`, which identifies the event source, and</span></span>
- <span data-ttu-id="0c7a1-206">`System.EventArgs` から派生したクラス</span><span class="sxs-lookup"><span data-stu-id="0c7a1-206">A class derived from `System.EventArgs`</span></span>

<span data-ttu-id="0c7a1-207">イベントハンドラーに渡される2番目のパラメーターには、イベントに関する追加情報を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-207">The second parameter passed to an event handler can include additional information about the event.</span></span> <span data-ttu-id="0c7a1-208">基本 `EventArgs` クラスは情報に沿って渡されませんが、.NET Framework には `EventArgs` を拡張し、追加のプロパティを含む多数のクラスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-208">While the base `EventArgs` class does not pass along any information, the .NET Framework includes a number of classes that extend `EventArgs` and encompass additional properties.</span></span> <span data-ttu-id="0c7a1-209">たとえば、`CommandEventArgs` インスタンスは、`Command` イベントに応答するイベントハンドラーに渡され、`CommandArgument` と `CommandName`の2つの情報プロパティが含まれます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-209">For example, a `CommandEventArgs` instance is passed to event handlers that respond to the `Command` event, and includes two informational properties: `CommandArgument` and `CommandName`.</span></span>

> [!NOTE]
> <span data-ttu-id="0c7a1-210">イベントの作成、発生、および処理の詳細については、「[単純な英語の](http://www.codeproject.com/KB/cs/eventdelegates.aspx)[イベントとデリゲート](https://msdn.microsoft.com/library/17sde2xt.aspx)およびイベントデリゲート」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-210">For more information on creating, raising, and handling events, see [Events and Delegates](https://msdn.microsoft.com/library/17sde2xt.aspx) and [Event Delegates in Simple English](http://www.codeproject.com/KB/cs/eventdelegates.aspx).</span></span>

<span data-ttu-id="0c7a1-211">イベントを定義するには、次の構文を使用します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-211">To define an event use the following syntax:</span></span>

[!code-vb[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample6.vb)]

<span data-ttu-id="0c7a1-212">ユーザーが [`DoublePrice`] ボタンをクリックし、他の追加情報を渡す必要がない場合にのみ、コンテンツページにアラートを通知する必要があるため、イベントデリゲート `EventHandler`を使用できます。これにより、`System.EventArgs`型のオブジェクトを2番目のパラメーターとして受け取るイベントハンドラーが定義されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-212">Because we only need to alert the content page when the user has clicked the `DoublePrice` Button and do not need to pass along any other additional information, we can use the event delegate `EventHandler`, which defines an event handler that accepts as its second parameter an object of type `System.EventArgs`.</span></span> <span data-ttu-id="0c7a1-213">マスターページでイベントを作成するには、マスターページの分離コードクラスに次のコード行を追加します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-213">To create the event in the master page, add the following line of code to the master page's code-behind class:</span></span>

[!code-vb[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample7.vb)]

<span data-ttu-id="0c7a1-214">上記のコードでは、`PricesDoubled`という名前のマスターページにパブリックイベントを追加します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-214">The above code adds a public event to the master page named `PricesDoubled`.</span></span> <span data-ttu-id="0c7a1-215">価格が2倍になった後に、このイベントを発生させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-215">We now need to raise this event after the prices have been doubled.</span></span> <span data-ttu-id="0c7a1-216">イベントを発生させるには、次の構文を使用します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-216">To raise an event use the following syntax:</span></span>

[!code-vb[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample8.vb)]

<span data-ttu-id="0c7a1-217">ここで、 *sender*と*eventArgs*は、サブスクライバーのイベントハンドラーに渡す値です。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-217">Where *sender* and *eventArgs* are the values you want to pass to the subscriber's event handler.</span></span>

<span data-ttu-id="0c7a1-218">次のコードを使用して、`DoublePrice` `Click` イベントハンドラーを更新します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-218">Update the `DoublePrice` `Click` event handler with the following code:</span></span>

[!code-vb[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample9.vb)]

<span data-ttu-id="0c7a1-219">前と同様に、`Click` イベントハンドラーは、`DoublePricesDataSource` SqlDataSource コントロールの `Update` メソッドを呼び出して、すべての製品の価格を2倍にしてから開始します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-219">As before, the `Click` event handler starts by calling the `DoublePricesDataSource` SqlDataSource control's `Update` method to double the prices of all products.</span></span> <span data-ttu-id="0c7a1-220">次に、イベントハンドラーへの追加が2つあります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-220">Following that there are two additions to the event handler.</span></span> <span data-ttu-id="0c7a1-221">まず、`RecentProducts` GridView のデータが更新されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-221">First, the `RecentProducts` GridView's data is refreshed.</span></span> <span data-ttu-id="0c7a1-222">この GridView は、前のチュートリアルのマスターページに追加されており、最近追加された5つの製品が表示されています。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-222">This GridView was added to the master page in the preceding tutorial and displays the five most recently-added products.</span></span> <span data-ttu-id="0c7a1-223">このグリッドを更新して、これら5つの製品の2倍の価格が表示されるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-223">We need to refresh this grid so that it shows the just-doubled prices for these five products.</span></span> <span data-ttu-id="0c7a1-224">その後、`PricesDoubled` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-224">Following that, the `PricesDoubled` event is raised.</span></span> <span data-ttu-id="0c7a1-225">マスターページ自体 (`Me`) への参照がイベントソースとしてイベントハンドラーに送信され、空の `EventArgs` オブジェクトがイベント引数として送信されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-225">A reference to the master page itself (`Me`) is sent to the event handler as the event source and an empty `EventArgs` object is sent as the event arguments.</span></span>

## <a name="step-4-handling-the-event-in-the-content-page"></a><span data-ttu-id="0c7a1-226">手順 4: コンテンツページでイベントを処理する</span><span class="sxs-lookup"><span data-stu-id="0c7a1-226">Step 4: Handling the Event in the Content Page</span></span>

<span data-ttu-id="0c7a1-227">この時点で、`DoublePrice` ボタンコントロールがクリックされるたびに、マスターページの `PricesDoubled` イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-227">At this point the master page raises its `PricesDoubled` event whenever the `DoublePrice` Button control is clicked.</span></span> <span data-ttu-id="0c7a1-228">ただし、これは戦いの半分に過ぎません。サブスクライバーでイベントを処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-228">However, this is only half the battle - we still need to handle the event in the subscriber.</span></span> <span data-ttu-id="0c7a1-229">これには、イベントハンドラーを作成し、イベントを発生させてイベントハンドラーが実行されるようにイベントの配線コードを追加するという2つのステップが含まれます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-229">This involves two steps: creating the event handler and adding event wiring code so that when the event is raised the event handler is executed.</span></span>

<span data-ttu-id="0c7a1-230">まず、`Master_PricesDoubled`という名前のイベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-230">Start by creating an event handler named `Master_PricesDoubled`.</span></span> <span data-ttu-id="0c7a1-231">マスターページで `PricesDoubled` イベントを定義する方法により、イベントハンドラーの2つの入力パラメーターはそれぞれ `Object` と `EventArgs`の型である必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-231">Because of how we defined the `PricesDoubled` event in the master page the event handler's two input parameters must be of types `Object` and `EventArgs`, respectively.</span></span> <span data-ttu-id="0c7a1-232">イベントハンドラーで `ProductsGrid` GridView の `DataBind` メソッドを呼び出して、データをグリッドに再バインドします。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-232">In the event handler call the `ProductsGrid` GridView's `DataBind` method to rebind the data to the grid.</span></span>

[!code-vb[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample10.vb)]

<span data-ttu-id="0c7a1-233">イベントハンドラーのコードは完成しましたが、マスターページの `PricesDoubled` イベントをこのイベントハンドラーに送信していません。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-233">The code for the event handler is complete but we've yet to wire the master page's `PricesDoubled` event to this event handler.</span></span> <span data-ttu-id="0c7a1-234">サブスクライバーは、次の構文を使用してイベントハンドラーにイベントをワイヤで配線します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-234">The subscriber wires an event to an event handler via the following syntax:</span></span>

[!code-vb[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample11.vb)]

<span data-ttu-id="0c7a1-235">*発行元*は、イベント*eventName*を提供するオブジェクトへの参照です。 *methodName*は、サブスクライバーで定義されているイベントハンドラーの名前です。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-235">*publisher* is a reference to the object that offers the event *eventName*, and *methodName* is the name of the event handler defined in the subscriber.</span></span>

<span data-ttu-id="0c7a1-236">このイベント配線コードは、最初のページへのアクセスと後続のポストバックで実行する必要があり、イベントが発生する前のページのライフサイクルのポイントで発生する必要があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-236">This event wiring code must be executed on the first page visit and subsequent postbacks and should occur at a point in the page lifecycle that precedes when the event may be raised.</span></span> <span data-ttu-id="0c7a1-237">イベントの配線コードを追加するには、ページのライフサイクルの初期段階で PreInit 段階にあることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-237">A good time to add event wiring code is in the PreInit stage, which occurs very early in the page lifecycle.</span></span>

<span data-ttu-id="0c7a1-238">`~/Admin/Products.aspx` を開き、`Page_PreInit` イベントハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-238">Open `~/Admin/Products.aspx` and create a `Page_PreInit` event handler:</span></span>

[!code-vb[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample12.vb)]

<span data-ttu-id="0c7a1-239">この配線コードを完了するには、コンテンツページからマスターページへのプログラムによる参照が必要です。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-239">In order to complete this wiring code we need a programmatic reference to the master page from the content page.</span></span> <span data-ttu-id="0c7a1-240">前のチュートリアルで説明したように、これを行うには次の2つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-240">As noted in the previous tutorial, there are two ways to do this:</span></span>

- <span data-ttu-id="0c7a1-241">緩く型指定された `Page.Master` プロパティを適切なマスターページ型にキャストする。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-241">By casting the loosely-typed `Page.Master` property to the appropriate master page type, or</span></span>
- <span data-ttu-id="0c7a1-242">`.aspx` ページで `@MasterType` ディレクティブを追加し、厳密に型指定された `Master` プロパティを使用します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-242">By adding a `@MasterType` directive in the `.aspx` page and then using the strongly-typed `Master` property.</span></span>

<span data-ttu-id="0c7a1-243">後者の方法を使用してみましょう。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-243">Let's use the latter approach.</span></span> <span data-ttu-id="0c7a1-244">ページの宣言型マークアップの先頭に、次の `@MasterType` ディレクティブを追加します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-244">Add the following `@MasterType` directive to the top of the page's declarative markup:</span></span>

[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample13.aspx)]

<span data-ttu-id="0c7a1-245">次に、`Page_PreInit` イベントハンドラーに次のイベント配線コードを追加します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-245">Then add the following event wiring code in the `Page_PreInit` event handler:</span></span>

[!code-vb[Main](interacting-with-the-content-page-from-the-master-page-vb/samples/sample14.vb)]

<span data-ttu-id="0c7a1-246">このコードを配置すると、[`DoublePrice`] ボタンがクリックされるたびにコンテンツページの GridView が更新されます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-246">With this code in place, the GridView in the content page is refreshed whenever the `DoublePrice` Button is clicked.</span></span>

<span data-ttu-id="0c7a1-247">図8と9はこの動作を示しています。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-247">Figures 8 and 9 illustrate this behavior.</span></span> <span data-ttu-id="0c7a1-248">図8に、最初にアクセスしたときのページを示します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-248">Figure 8 shows the page when first visited.</span></span> <span data-ttu-id="0c7a1-249">`RecentProducts` GridView (マスターページの左側の列) と `ProductsGrid` GridView ([コンテンツ] ページ) の両方で価格値が指定されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-249">Note that price values in both the `RecentProducts` GridView (in the left column of the master page) and the `ProductsGrid` GridView (in the content page).</span></span> <span data-ttu-id="0c7a1-250">図9は、[`DoublePrice`] ボタンがクリックされた直後の同じ画面を示しています。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-250">Figure 9 shows the same screen immediately after the `DoublePrice` Button has been clicked.</span></span> <span data-ttu-id="0c7a1-251">ご覧のとおり、新しい価格は両方の GridViews に瞬時に反映されています。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-251">As you can see, the new prices are instantaneously reflected in both GridViews.</span></span>

<span data-ttu-id="0c7a1-252">[初期価格の値を ![する](interacting-with-the-content-page-from-the-master-page-vb/_static/image23.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-252">[![The Initial Price Values](interacting-with-the-content-page-from-the-master-page-vb/_static/image23.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image22.png)</span></span>

<span data-ttu-id="0c7a1-253">**図 08**: 初期価格値 ([クリックすると、フルサイズの画像が表示](interacting-with-the-content-page-from-the-master-page-vb/_static/image24.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-253">**Figure 08**: The Initial Price Values  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-vb/_static/image24.png))</span></span>

<span data-ttu-id="0c7a1-254">[2倍の価格がグリッドビューに表示される ![](interacting-with-the-content-page-from-the-master-page-vb/_static/image26.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-254">[![The Just-Doubled Prices are Displayed in the GridViews](interacting-with-the-content-page-from-the-master-page-vb/_static/image26.png)](interacting-with-the-content-page-from-the-master-page-vb/_static/image25.png)</span></span>

<span data-ttu-id="0c7a1-255">**図 09**: 単純な価格がグリッドビューに表示される ([クリックすると、フルサイズの画像が表示](interacting-with-the-content-page-from-the-master-page-vb/_static/image27.png)されます)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-255">**Figure 09**: The Just-Doubled Prices are Displayed in the GridViews  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-vb/_static/image27.png))</span></span>

## <a name="summary"></a><span data-ttu-id="0c7a1-256">要約</span><span class="sxs-lookup"><span data-stu-id="0c7a1-256">Summary</span></span>

<span data-ttu-id="0c7a1-257">マスターページとそのコンテンツページが相互に完全に分離されていることが理想的であり、操作のレベルは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-257">Ideally, a master page and its content pages are completely separate from one another and require no level of interaction.</span></span> <span data-ttu-id="0c7a1-258">ただし、マスターページまたはコンテンツページから変更できるデータを表示するマスターページまたはコンテンツページがある場合は、表示を更新できるようにデータが変更されたときに、マスターページに対してコンテンツページの警告 (またはその逆) の通知が必要になることがあります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-258">However, if you have a master page or content page that displays data that can be modified from the master page or content page, then you may need to have the master page alert the content page (or vice-a-versa) when data is modified so that the display can be updated.</span></span> <span data-ttu-id="0c7a1-259">前のチュートリアルでは、プログラムによってマスターページと対話するコンテンツページを作成する方法を説明しました。このチュートリアルでは、マスターページで相互作用を開始する方法を見てきました。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-259">In the preceding tutorial we saw how to have a content page programmatically interact with its master page; in this tutorial we looked at how to have a master page initiate the interaction.</span></span>

<span data-ttu-id="0c7a1-260">コンテンツとマスターページ間のプログラムによる対話は、コンテンツまたはマスターページのどちらからでも行うことができますが、使用される相互作用パターンは、発信元によって異なります。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-260">While programmatic interaction between a content and master page can originate from either the content or master page, the interaction pattern used depends on the origination.</span></span> <span data-ttu-id="0c7a1-261">違いは、コンテンツページには1つのマスターページがありますが、マスターページにはさまざまなコンテンツページがあることがあるためです。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-261">The differences are due to the fact that a content page has a single master page, but a master page can have many different content pages.</span></span> <span data-ttu-id="0c7a1-262">マスターページでコンテンツページを直接操作するのではなく、何らかのアクションが実行されたことを通知するイベントをマスターページで生成する方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-262">Rather than having a master page directly interact with a content page, a better approach is to have the master page raise an event to signal that some action has taken place.</span></span> <span data-ttu-id="0c7a1-263">アクションを考慮するコンテンツページでは、イベントハンドラーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-263">Those content pages that care about the action can create event handlers.</span></span>

<span data-ttu-id="0c7a1-264">プログラミングを楽しんでください。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-264">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="0c7a1-265">関連項目</span><span class="sxs-lookup"><span data-stu-id="0c7a1-265">Further Reading</span></span>

<span data-ttu-id="0c7a1-266">このチュートリアルで説明しているトピックの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-266">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="0c7a1-267">ASP.NET でのデータへのアクセスと更新</span><span class="sxs-lookup"><span data-stu-id="0c7a1-267">Accessing and Updating Data in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="0c7a1-268">イベントとデリゲート</span><span class="sxs-lookup"><span data-stu-id="0c7a1-268">Events and Delegates</span></span>](https://msdn.microsoft.com/library/17sde2xt.aspx)
- [<span data-ttu-id="0c7a1-269">コンテンツとマスターページの間で情報を渡す</span><span class="sxs-lookup"><span data-stu-id="0c7a1-269">Passing Information Between Content and Master Pages</span></span>](http://aspnet.4guysfromrolla.com/articles/013107-1.aspx)
- [<span data-ttu-id="0c7a1-270">ASP.NET チュートリアルでのデータの操作</span><span class="sxs-lookup"><span data-stu-id="0c7a1-270">Working with Data in ASP.NET Tutorials</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="0c7a1-271">作成者について</span><span class="sxs-lookup"><span data-stu-id="0c7a1-271">About the Author</span></span>

<span data-ttu-id="0c7a1-272">1998以降、Microsoft の Web テクノロジを使用して、 [Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)(複数の asp/創設者4GuysFromRolla.com の執筆者) が Microsoft の Web テクノロジを使用しています。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0c7a1-273">Scott は、独立したコンサルタント、トレーナー、およびライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-273">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0c7a1-274">彼の最新の書籍は[ *、ASP.NET 3.5 を24時間以内に教え*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco)ています。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-274">His latest book is [*Sams Teach Yourself ASP.NET 3.5 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco).</span></span> <span data-ttu-id="0c7a1-275">Scott は、 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)またはブログで[http://ScottOnWriting.NET](http://scottonwriting.net/)にアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-275">Scott can be reached at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="0c7a1-276">ありがとうございました。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-276">Special Thanks To</span></span>

<span data-ttu-id="0c7a1-277">このチュートリアルシリーズは、役に立つ多くのレビュー担当者によってレビューされました。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-277">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="0c7a1-278">このチュートリアルのリードレビューアーは、Suchi になりました。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-278">Lead reviewer for this tutorial was Suchi Banerjee.</span></span> <span data-ttu-id="0c7a1-279">今後の MSDN 記事を確認することに興味がありますか?</span><span class="sxs-lookup"><span data-stu-id="0c7a1-279">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="0c7a1-280">その場合は、 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)の行を削除します。</span><span class="sxs-lookup"><span data-stu-id="0c7a1-280">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0c7a1-281">[前へ](interacting-with-the-master-page-from-the-content-page-vb.md)
> [次へ](master-pages-and-asp-net-ajax-vb.md)</span><span class="sxs-lookup"><span data-stu-id="0c7a1-281">[Previous](interacting-with-the-master-page-from-the-content-page-vb.md)
[Next](master-pages-and-asp-net-ajax-vb.md)</span></span>
