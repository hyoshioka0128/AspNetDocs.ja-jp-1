---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12
title: 'Visual Studio または Visual Web Developer を使用した SQL Server Compact を使用した ASP.NET Web アプリケーションのデプロイ: SQL Server Compact データベースの配置-2/12 |Microsoft Docs'
author: tdykstra
description: この一連のチュートリアルでは、Visual Stu... を使用して SQL Server Compact データベースを含む ASP.NET web アプリケーションプロジェクトをデプロイ (発行) する方法について説明します。
ms.author: riande
ms.date: 11/17/2011
ms.assetid: c3c76516-4c48-4153-bd03-d70e3a3edbb0
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12
msc.type: authoredcontent
ms.openlocfilehash: 56ceabc79947967846d342354fd033510be5f05a
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74625530"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-deploying-sql-server-compact-databases---2-of-12"></a><span data-ttu-id="189ae-103">Visual Studio または Visual Web Developer を使用した SQL Server Compact を使用した ASP.NET Web アプリケーションのデプロイ: SQL Server Compact データベースの配置-2/12</span><span class="sxs-lookup"><span data-stu-id="189ae-103">Deploying an ASP.NET Web Application with SQL Server Compact using Visual Studio or Visual Web Developer: Deploying SQL Server Compact Databases - 2 of 12</span></span>

<span data-ttu-id="189ae-104">[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="189ae-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="189ae-105">スタートプロジェクトのダウンロード</span><span class="sxs-lookup"><span data-stu-id="189ae-105">Download Starter Project</span></span>](https://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> <span data-ttu-id="189ae-106">この一連のチュートリアルでは、Visual Studio 2012 RC または Visual Studio Express 2012 RC for Web を使用して SQL Server Compact データベースを含む ASP.NET web アプリケーションプロジェクトをデプロイ (発行) する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="189ae-106">This series of tutorials shows you how to deploy (publish) an ASP.NET web application project that includes a SQL Server Compact database by using Visual Studio 2012 RC or Visual Studio Express 2012 RC for Web.</span></span> <span data-ttu-id="189ae-107">Web 発行の更新をインストールする場合は、Visual Studio 2010 を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="189ae-107">You can also use Visual Studio 2010 if you install the Web Publish Update.</span></span> <span data-ttu-id="189ae-108">シリーズの概要については、[シリーズの最初のチュートリアル](deployment-to-a-hosting-provider-introduction-1-of-12.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="189ae-108">For an introduction to the series, see [the first tutorial in the series](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span></span>
> 
> <span data-ttu-id="189ae-109">Visual Studio 2012 の RC リリース後に導入された配置機能を示すチュートリアルについては、SQL Server Compact 以外の SQL Server のエディションをデプロイする方法、Azure App Service Web Apps にデプロイする方法については、「 [ASP.NET Web deployment Using Visual studio (Visual studio を使用した Web デプロイ](../../deployment/visual-studio-web-deployment/introduction.md)のデプロイ)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="189ae-109">For a tutorial that shows deployment features introduced after the RC release of Visual Studio 2012, shows how to deploy SQL Server editions other than SQL Server Compact, and shows how to deploy to Azure App Service Web Apps, see [ASP.NET Web Deployment using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="189ae-110">の概要</span><span class="sxs-lookup"><span data-stu-id="189ae-110">Overview</span></span>

<span data-ttu-id="189ae-111">このチュートリアルでは、配置用に2つの SQL Server Compact データベースとデータベースエンジンを設定する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="189ae-111">This tutorial shows how to set up two SQL Server Compact databases and the database engine for deployment.</span></span>

<span data-ttu-id="189ae-112">データベースアクセスの場合、Contoso 大学アプリケーションは、.NET Framework に含まれていないため、アプリケーションと共に展開する必要がある次のソフトウェアを必要とします。</span><span class="sxs-lookup"><span data-stu-id="189ae-112">For database access, the Contoso University application requires the following software that must be deployed with the application because it is not included in the .NET Framework:</span></span>

- <span data-ttu-id="189ae-113">[SQL Server Compact](https://www.microsoft.com/sqlserver/en/us/editions/compact.aspx) (データベースエンジン)。</span><span class="sxs-lookup"><span data-stu-id="189ae-113">[SQL Server Compact](https://www.microsoft.com/sqlserver/en/us/editions/compact.aspx) (the database engine).</span></span>
- <span data-ttu-id="189ae-114">[ASP.NET ユニバーサルプロバイダー](http://www.hanselman.com/blog/IntroducingSystemWebProvidersASPNETUniversalProvidersForSessionMembershipRolesAndUserProfileOnSQLCompactAndSQLAzure.aspx) (ASP.NET メンバーシップシステムで SQL Server Compact を使用できるようにする)</span><span class="sxs-lookup"><span data-stu-id="189ae-114">[ASP.NET Universal Providers](http://www.hanselman.com/blog/IntroducingSystemWebProvidersASPNETUniversalProvidersForSessionMembershipRolesAndUserProfileOnSQLCompactAndSQLAzure.aspx) (which enable the ASP.NET membership system to use SQL Server Compact)</span></span>
- <span data-ttu-id="189ae-115">[Entity Framework 5.0](https://msdn.microsoft.com/library/gg696172(d=lightweight,v=vs.103).aspx)(移行を伴う Code First)。</span><span class="sxs-lookup"><span data-stu-id="189ae-115">[Entity Framework 5.0](https://msdn.microsoft.com/library/gg696172(d=lightweight,v=vs.103).aspx)(Code First with Migrations).</span></span>

<span data-ttu-id="189ae-116">データベース構造と、アプリケーションの2つのデータベース内のデータの一部 (すべてではない) も配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-116">The database structure and some (not all) of the data in the application's two databases must also be deployed.</span></span> <span data-ttu-id="189ae-117">通常は、アプリケーションを開発するときに、ライブサイトに配置しないデータベースにテストデータを入力します。</span><span class="sxs-lookup"><span data-stu-id="189ae-117">Typically, as you develop an application, you enter test data into a database that you don't want to deploy to a live site.</span></span> <span data-ttu-id="189ae-118">ただし、デプロイするいくつかの実稼働データを入力する場合もあります。</span><span class="sxs-lookup"><span data-stu-id="189ae-118">However, you might also enter some production data that you do want to deploy.</span></span> <span data-ttu-id="189ae-119">このチュートリアルでは、を展開するときに、必要なソフトウェアと正しいデータが含まれるように Contoso 大学プロジェクトを構成します。</span><span class="sxs-lookup"><span data-stu-id="189ae-119">In this tutorial you'll configure the Contoso University project so that the required software and the correct data are included when you deploy.</span></span>

<span data-ttu-id="189ae-120">リマインダー: チュートリアルを実行しているときにエラーメッセージが表示されたり機能しない場合は、必ず[トラブルシューティングのページ](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md)を確認してください。</span><span class="sxs-lookup"><span data-stu-id="189ae-120">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the [troubleshooting page](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span></span>

## <a name="sql-server-compact-versus-sql-server-express"></a><span data-ttu-id="189ae-121">SQL Server Compact と SQL Server Express</span><span class="sxs-lookup"><span data-stu-id="189ae-121">SQL Server Compact versus SQL Server Express</span></span>

<span data-ttu-id="189ae-122">このサンプルアプリケーションでは、SQL Server Compact 4.0 を使用します。</span><span class="sxs-lookup"><span data-stu-id="189ae-122">The sample application uses SQL Server Compact 4.0.</span></span> <span data-ttu-id="189ae-123">このデータベースエンジンは、web サイトの比較的新しいオプションです。以前のバージョンの SQL Server Compact は、web ホスティング環境では機能しません。</span><span class="sxs-lookup"><span data-stu-id="189ae-123">This database engine is a relatively new option for websites; earlier versions of SQL Server Compact do not work in a web hosting environment.</span></span> <span data-ttu-id="189ae-124">SQL Server Compact には、SQL Server Express を使用した開発と完全 SQL Server への展開の一般的なシナリオと比較して、いくつかの利点があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-124">SQL Server Compact offers a few benefits compared to the more common scenario of developing with SQL Server Express and deploying to full SQL Server.</span></span> <span data-ttu-id="189ae-125">選択したホスティングプロバイダーによっては、SQL Server Compact をデプロイする方がコストがかかることがあります。これは、一部のプロバイダーが完全 SQL Server データベースをサポートするために追加料金を支払うためです。</span><span class="sxs-lookup"><span data-stu-id="189ae-125">Depending on the hosting provider you choose, SQL Server Compact might be cheaper to deploy, because some providers charge extra to support a full SQL Server database.</span></span> <span data-ttu-id="189ae-126">SQL Server Compact に対して追加料金は発生しません。これは、web アプリケーションの一部としてデータベースエンジン自体をデプロイできるためです。</span><span class="sxs-lookup"><span data-stu-id="189ae-126">There is no extra charge for SQL Server Compact because you can deploy the database engine itself as part of your web application.</span></span>

<span data-ttu-id="189ae-127">ただし、制限も考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-127">However, you should also be aware of its limitations.</span></span> <span data-ttu-id="189ae-128">SQL Server Compact では、ストアドプロシージャ、トリガー、ビュー、またはレプリケーションはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="189ae-128">SQL Server Compact does not support stored procedures, triggers, views, or replication.</span></span> <span data-ttu-id="189ae-129">(SQL Server Compact でサポートされていない SQL Server の機能の完全な一覧については、「 [SQL Server Compact と SQL Server の違い](https://msdn.microsoft.com/library/bb896140.aspx)」を参照してください)。また、SQL Server Express および SQL Server データベースのスキーマやデータを操作するために使用できるツールの中には、SQL Server Compact では機能しないものもあります。</span><span class="sxs-lookup"><span data-stu-id="189ae-129">(For a complete list of SQL Server features that are not supported by SQL Server Compact, see [Differences Between SQL Server Compact and SQL Server](https://msdn.microsoft.com/library/bb896140.aspx).) Also, some of the tools that you can use to manipulate schemas and data in SQL Server Express and SQL Server databases do not work with SQL Server Compact.</span></span> <span data-ttu-id="189ae-130">たとえば、Visual Studio で SQL Server Compact データベースを使用して SQL Server Management Studio または SQL Server Data Tools を使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="189ae-130">For example, you cannot use SQL Server Management Studio or SQL Server Data Tools in Visual Studio with SQL Server Compact databases.</span></span> <span data-ttu-id="189ae-131">SQL Server Compact データベースを操作するための他のオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="189ae-131">You do have other options for working with SQL Server Compact databases:</span></span>

- <span data-ttu-id="189ae-132">Visual Studio でサーバーエクスプローラーを使用すると、SQL Server Compact に対して制限されたデータベース操作機能を提供できます。</span><span class="sxs-lookup"><span data-stu-id="189ae-132">You can use Server Explorer in Visual Studio, which offers limited database manipulation functionality for SQL Server Compact.</span></span>
- <span data-ttu-id="189ae-133">[WebMatrix](https://www.microsoft.com/web/webmatrix/)のデータベース操作機能を使用できます。これにはサーバーエクスプローラーよりも多くの機能があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-133">You can use the database manipulation feature of [WebMatrix](https://www.microsoft.com/web/webmatrix/), which has more features than Server Explorer.</span></span>
- <span data-ttu-id="189ae-134">[SQL Server Compact ツールボックス](https://github.com/ErikEJ/SqlCeToolbox)や[SQL Compact データやスキーマスクリプトユーティリティ](https://github.com/ErikEJ/SqlCeToolbox)など、比較的多機能なサードパーティまたはオープンソースのツールを使用できます。</span><span class="sxs-lookup"><span data-stu-id="189ae-134">You can use relatively full-featured third-party or open source tools, such as the [SQL Server Compact Toolbox](https://github.com/ErikEJ/SqlCeToolbox) and [SQL Compact data and schema script utility](https://github.com/ErikEJ/SqlCeToolbox).</span></span>
- <span data-ttu-id="189ae-135">独自の DDL (データ定義言語) スクリプトを記述して実行し、データベーススキーマを操作できます。</span><span class="sxs-lookup"><span data-stu-id="189ae-135">You can write and run your own DDL (data definition language) scripts to manipulate the database schema.</span></span>

<span data-ttu-id="189ae-136">SQL Server Compact から開始し、必要に応じて後でアップグレードすることができます。</span><span class="sxs-lookup"><span data-stu-id="189ae-136">You can start with SQL Server Compact and then upgrade later as your needs evolve.</span></span> <span data-ttu-id="189ae-137">このシリーズの後のチュートリアルでは、SQL Server Compact から SQL Server Express および SQL Server に移行する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="189ae-137">Later tutorials in this series show you how to migrate from SQL Server Compact to SQL Server Express and to SQL Server.</span></span> <span data-ttu-id="189ae-138">ただし、新しいアプリケーションを作成していて、近い将来に SQL Server が必要になることが予想される場合は、SQL Server または SQL Server Express から始めることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="189ae-138">However, if you're creating a new application and expect to need SQL Server in the near future, it's probably best to start with SQL Server or SQL Server Express.</span></span>

## <a name="configuring-the-sql-server-compact-database-engine-for-deployment"></a><span data-ttu-id="189ae-139">展開のための SQL Server Compact データベースエンジンの構成</span><span class="sxs-lookup"><span data-stu-id="189ae-139">Configuring the SQL Server Compact Database Engine for Deployment</span></span>

<span data-ttu-id="189ae-140">Contoso 大学アプリケーションでのデータアクセスに必要なソフトウェアは、次の NuGet パッケージをインストールすることによって追加されました。</span><span class="sxs-lookup"><span data-stu-id="189ae-140">The software required for data access in the Contoso University application was added by installing the following NuGet packages:</span></span>

- [<span data-ttu-id="189ae-141">SqlServerCompact</span><span class="sxs-lookup"><span data-stu-id="189ae-141">SqlServerCompact</span></span>](http://nuget.org/List/Packages/SqlServerCompact)
- <span data-ttu-id="189ae-142">[System.web. providers](http://nuget.org/List/Packages/System.Web.Providers) (ASP.NET ユニバーサルプロバイダー)</span><span class="sxs-lookup"><span data-stu-id="189ae-142">[System.Web.Providers](http://nuget.org/List/Packages/System.Web.Providers) (ASP.NET universal providers)</span></span>
- [<span data-ttu-id="189ae-143">EntityFramework</span><span class="sxs-lookup"><span data-stu-id="189ae-143">EntityFramework</span></span>](http://nuget.org/List/Packages/EntityFramework)
- [<span data-ttu-id="189ae-144">EntityFramework</span><span class="sxs-lookup"><span data-stu-id="189ae-144">EntityFramework.SqlServerCompact</span></span>](http://nuget.org/List/Packages/EntityFramework.sqlservercompact)

<span data-ttu-id="189ae-145">リンクは、これらのパッケージの現在のバージョンを指しています。これらのパッケージは、このチュートリアルでダウンロードしたスタートプロジェクトにインストールされているものよりも新しい可能性があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-145">The links point to the current versions of these packages, which might be newer than what is installed in the starter project that you downloaded for this tutorial.</span></span> <span data-ttu-id="189ae-146">ホスティングプロバイダーへの配置については、Entity Framework 5.0 以降を使用していることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="189ae-146">For deployment to a hosting provider, make sure that you use Entity Framework 5.0 or later.</span></span> <span data-ttu-id="189ae-147">以前のバージョンの Code First Migrations には完全な信頼が必要であり、多くのホスティングプロバイダーでは、アプリケーションは中程度の信頼で実行されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-147">Earlier versions of Code First Migrations require Full Trust, and at many hosting providers your application will run in Medium Trust.</span></span> <span data-ttu-id="189ae-148">中程度の信頼の詳細については、「[テスト環境として IIS に配置する](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md)」チュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="189ae-148">For more information about Medium Trust, see the [Deploying to IIS as a Test Environment](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md) tutorial.</span></span>

<span data-ttu-id="189ae-149">NuGet パッケージのインストールは、通常、このソフトウェアをアプリケーションと共に展開するために必要なすべての処理を行います。</span><span class="sxs-lookup"><span data-stu-id="189ae-149">NuGet package installation generally takes care of everything that you need in order to deploy this software with the application.</span></span> <span data-ttu-id="189ae-150">場合によっては、web.config ファイルの変更や、ソリューションをビルドするたびに実行される PowerShell スクリプトの追加などのタスクが必要になります。</span><span class="sxs-lookup"><span data-stu-id="189ae-150">In some cases, this involves tasks such as changing the Web.config file and adding PowerShell scripts that run whenever you build the solution.</span></span> <span data-ttu-id="189ae-151">**NuGet を使用せずにこれらの機能 (SQL Server Compact や Entity Framework など) のサポートを追加する場合は、NuGet パッケージのインストールによって、同じ作業を手動で行うことができることを確認してください。**</span><span class="sxs-lookup"><span data-stu-id="189ae-151">**If you want to add support for any of these features (such as SQL Server Compact and Entity Framework) without using NuGet, make sure that you know what NuGet package installation does so that you can do the same work manually.**</span></span>

<span data-ttu-id="189ae-152">正常に展開できるようにするために必要なすべての処理が NuGet によって処理されない例外が1つあります。</span><span class="sxs-lookup"><span data-stu-id="189ae-152">There is one exception where NuGet doesn't take care of everything you have to do in order to ensure successful deployment.</span></span> <span data-ttu-id="189ae-153">SqlServerCompact NuGet パッケージは、プロジェクトにビルド後のスクリプトを追加します。このスクリプトは、ネイティブアセンブリをプロジェクトの*bin*フォルダーの下にある*x86*および*amd64*サブフォルダーにコピーしますが、スクリプトにはプロジェクト内のこれらのフォルダーは含まれません。</span><span class="sxs-lookup"><span data-stu-id="189ae-153">The SqlServerCompact NuGet package adds a post-build script to your project that copies the native assemblies to *x86* and *amd64* subfolders under the project *bin* folder, but the script does not include those folders in the project.</span></span> <span data-ttu-id="189ae-154">結果として、プロジェクトに手動で含める場合を除き、Web 配置によってコピー先の Web サイトにコピーされません。</span><span class="sxs-lookup"><span data-stu-id="189ae-154">As a result, Web Deploy will not copy them to the destination web site unless you manually include them in the project.</span></span> <span data-ttu-id="189ae-155">(この動作は、既定の配置構成によって発生します。このチュートリアルでは使用しないもう1つのオプションは、この動作を制御する設定を変更することです。</span><span class="sxs-lookup"><span data-stu-id="189ae-155">(This behavior results from the default deployment configuration; another option, which you won't use in these tutorials, is to change the setting that controls this behavior.</span></span> <span data-ttu-id="189ae-156">変更できる設定は、 **[プロジェクトのプロパティ]** ウィンドウの **[パッケージ/発行 Web]** タブで、 **[配置する項目]** で**アプリケーションを実行するために必要なファイルのみ**です。</span><span class="sxs-lookup"><span data-stu-id="189ae-156">The setting that you can change is **Only files needed to run the application** under **Items to deploy** on the **Package/Publish Web** tab of the **Project Properties** window.</span></span> <span data-ttu-id="189ae-157">通常、この設定を変更することは、必要以上に多くのファイルが運用環境に展開される可能性があるため、通常は推奨されません。</span><span class="sxs-lookup"><span data-stu-id="189ae-157">Changing this setting is not generally recommended because it can result in the deployment of many more files to the production environment than are needed there.</span></span> <span data-ttu-id="189ae-158">代替方法の詳細については、「[プロジェクトプロパティの構成](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md)」チュートリアルを参照してください。)</span><span class="sxs-lookup"><span data-stu-id="189ae-158">For more information about the alternatives, see the [Configuring Project Properties](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md) tutorial.)</span></span>

<span data-ttu-id="189ae-159">プロジェクトをビルドし、**ソリューションエクスプローラー** [すべての**ファイルを表示**] をクリックします (まだ作成していない場合)。</span><span class="sxs-lookup"><span data-stu-id="189ae-159">Build the project, and then in **Solution Explorer** click **Show all Files** if you have not already done so.</span></span> <span data-ttu-id="189ae-160">また、 **[更新]** をクリックする必要がある場合もあります。</span><span class="sxs-lookup"><span data-stu-id="189ae-160">You might also have to click **Refresh**.</span></span>

![Solution_Explorer_Show_All_Files](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image1.png)

<span data-ttu-id="189ae-162">**[Bin]** フォルダーを展開して**amd64**および**x86**フォルダーを表示し、それらのフォルダーを選択して右クリックし、 **[プロジェクトに含める]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="189ae-162">Expand the **bin** folder to see the **amd64** and **x86** folders, and then select those folders, right-click, and select **Include in Project**.</span></span>

![amd64_and_x86_in_Solution_Explorer .png](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image2.png)

<span data-ttu-id="189ae-164">フォルダーアイコンが変更され、そのフォルダーがプロジェクトに含まれていることが示されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-164">The folder icons change to show that the folder has been included in the project.</span></span>

![Solution_Explorer_amd64_included .png](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image3.png)

## <a name="configuring-code-first-migrations-for-application-database-deployment"></a><span data-ttu-id="189ae-166">アプリケーションデータベースの展開のための Code First Migrations の構成</span><span class="sxs-lookup"><span data-stu-id="189ae-166">Configuring Code First Migrations for Application Database Deployment</span></span>

<span data-ttu-id="189ae-167">アプリケーションデータベースを配置する場合、通常は、単に開発データベースを運用環境に配置するだけではありません。これは、ほとんどのデータがテスト目的でのみ使用されるためです。</span><span class="sxs-lookup"><span data-stu-id="189ae-167">When you deploy an application database, typically you don't simply deploy your development database with all of the data in it to production, because much of the data in it is probably there only for testing purposes.</span></span> <span data-ttu-id="189ae-168">たとえば、テストデータベースの学生名は架空の名前です。</span><span class="sxs-lookup"><span data-stu-id="189ae-168">For example, the student names in a test database are fictional.</span></span> <span data-ttu-id="189ae-169">一方、データがまったく存在しないデータベース構造だけを配置することはほとんどありません。</span><span class="sxs-lookup"><span data-stu-id="189ae-169">On the other hand, you often can't deploy just the database structure with no data in it at all.</span></span> <span data-ttu-id="189ae-170">テストデータベースの一部のデータは実際のデータであり、ユーザーがアプリケーションの使用を開始するときに必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-170">Some of the data in your test database might be real data and must be there when users begin to use the application.</span></span> <span data-ttu-id="189ae-171">たとえば、有効なグレード値または実際の部署名を含むテーブルがデータベースに存在する場合があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-171">For example, your database might have a table that contains valid grade values or real department names.</span></span>

<span data-ttu-id="189ae-172">この一般的なシナリオをシミュレートするには、実稼働環境に配置するデータのみをデータベースに挿入する Code First Migrations Seed メソッドを構成します。</span><span class="sxs-lookup"><span data-stu-id="189ae-172">To simulate this common scenario, you'll configure a Code First Migrations Seed method that inserts into the database only the data that you want to be there in production.</span></span> <span data-ttu-id="189ae-173">このシードメソッドは、実稼働環境でデータベースを作成 Code First た後に運用環境で実行されるため、テストデータを挿入しません。</span><span class="sxs-lookup"><span data-stu-id="189ae-173">This Seed method won't insert test data because it will run in production after Code First creates the database in production.</span></span>

<span data-ttu-id="189ae-174">以前のバージョンの Code First では、移行がリリースされる前に、シードメソッドによってテストデータを挿入することが一般的でした。これは、開発時にすべてのモデルが変更されたため、データベースを完全に削除してから再作成する必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="189ae-174">In earlier versions of Code First before Migrations was released, it was common for Seed methods to insert test data also, because with every model change during development the database had to be completely deleted and re-created from scratch.</span></span> <span data-ttu-id="189ae-175">Code First Migrations では、データベースの変更後にテストデータが保持されるため、Seed メソッドにテストデータを含める必要はありません。</span><span class="sxs-lookup"><span data-stu-id="189ae-175">With Code First Migrations, test data is retained after database changes, so including test data in the Seed method is not necessary.</span></span> <span data-ttu-id="189ae-176">ダウンロードしたプロジェクトは、初期化子クラスのシードメソッドにすべてのデータを含めるための移行前の方法を使用します。</span><span class="sxs-lookup"><span data-stu-id="189ae-176">The project you downloaded uses the pre-Migrations method of including all data in the Seed method of an initializer class.</span></span> <span data-ttu-id="189ae-177">このチュートリアルでは、初期化子クラスを無効にして、移行を有効にします。</span><span class="sxs-lookup"><span data-stu-id="189ae-177">In this tutorial you'll disable the initializer class and enable Migrations.</span></span> <span data-ttu-id="189ae-178">次に、移行構成クラスの Seed メソッドを更新して、運用環境に挿入するデータのみを挿入するようにします。</span><span class="sxs-lookup"><span data-stu-id="189ae-178">Then you'll update the Seed method in the Migrations configuration class so that it inserts only data that you want to be inserted in production.</span></span>

<span data-ttu-id="189ae-179">次の図は、アプリケーションデータベースのスキーマを示しています。</span><span class="sxs-lookup"><span data-stu-id="189ae-179">The following diagram illustrates the schema of the application database:</span></span>

<span data-ttu-id="189ae-180">[![School_database_diagram](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="189ae-180">[![School_database_diagram](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image4.png)</span></span>

<span data-ttu-id="189ae-181">これらのチュートリアルでは、サイトを最初に展開するときに、`Student` テーブルと `Enrollment` テーブルが空であると想定します。</span><span class="sxs-lookup"><span data-stu-id="189ae-181">For these tutorials, you'll assume that the `Student` and `Enrollment` tables should be empty when the site is first deployed.</span></span> <span data-ttu-id="189ae-182">他のテーブルには、アプリケーションが稼働しているときに事前に読み込む必要があるデータが含まれています。</span><span class="sxs-lookup"><span data-stu-id="189ae-182">The other tables contain data that has to be preloaded when the application goes live.</span></span>

<span data-ttu-id="189ae-183">Code First Migrations を使用するため、 **Dropcreatedatabaseifmodelchanges** Code First 初期化子を使用する必要がなくなりました。</span><span class="sxs-lookup"><span data-stu-id="189ae-183">Since you will be using Code First Migrations, you no longer have to use the **DropCreateDatabaseIfModelChanges** Code First initializer.</span></span> <span data-ttu-id="189ae-184">この初期化子のコードは、ContosoUniversity プロジェクトの SchoolInitializer.cs ファイルにあります。</span><span class="sxs-lookup"><span data-stu-id="189ae-184">The code for this initializer is in the SchoolInitializer.cs file in the ContosoUniversity.DAL project.</span></span> <span data-ttu-id="189ae-185">Web.config ファイルの**appSettings**要素の設定により、アプリケーションが初めてデータベースにアクセスしようとしたときに、この初期化子が実行されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-185">A setting in the **appSettings** element of the Web.config file causes this initializer to run whenever the application tries to access the database for the first time:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample1.xml?highlight=3)]

<span data-ttu-id="189ae-186">アプリケーションの Web.config ファイルを開き、appSettings 要素から Code First 初期化子クラスを指定する要素を削除します。</span><span class="sxs-lookup"><span data-stu-id="189ae-186">Open the application Web.config file and remove the element that specifies the Code First initializer class from the appSettings element.</span></span> <span data-ttu-id="189ae-187">AppSettings 要素は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="189ae-187">The appSettings element now looks like this:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample2.xml)]

> [!NOTE]
> <span data-ttu-id="189ae-188">初期化子クラスを指定するもう1つの方法は、 *global.asax*ファイルの `Application_Start` メソッドで `Database.SetInitializer` を呼び出すことによって行います。</span><span class="sxs-lookup"><span data-stu-id="189ae-188">Another way to specify an initializer class is do it by calling `Database.SetInitializer` in the `Application_Start` method in the *Global.asax* file.</span></span> <span data-ttu-id="189ae-189">そのメソッドを使用して初期化子を指定するプロジェクトで移行を有効にする場合は、そのコード行を削除します。</span><span class="sxs-lookup"><span data-stu-id="189ae-189">If you are enabling Migrations in a project that uses that method to specify the initializer, remove that line of code.</span></span>

<span data-ttu-id="189ae-190">次に、Code First Migrations を有効にします。</span><span class="sxs-lookup"><span data-stu-id="189ae-190">Next, enable Code First Migrations.</span></span>

<span data-ttu-id="189ae-191">最初の手順として、ContosoUniversity プロジェクトがスタートアッププロジェクトとして設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="189ae-191">The first step is to make sure that the ContosoUniversity project is set as the startup project.</span></span> <span data-ttu-id="189ae-192">**ソリューションエクスプローラー**で、ContosoUniversity プロジェクトを右クリックし、 **[スタートアッププロジェクトに設定]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="189ae-192">In **Solution Explorer**, right-click the ContosoUniversity project and select **Set as Startup Project**.</span></span> <span data-ttu-id="189ae-193">Code First Migrations によってスタートアッププロジェクトが検索され、データベース接続文字列が検索されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-193">Code First Migrations will look in the startup project to find the database connection string.</span></span>

<span data-ttu-id="189ae-194">**[ツール]** メニューの **[NuGet パッケージマネージャー]** をクリックし、 **[パッケージマネージャーコンソール]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="189ae-194">From the **Tools** menu, click **NuGet Package Manager** and then **Package Manager Console**.</span></span>

![Selecting_Package_Manager_Console](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image6.png)

<span data-ttu-id="189ae-196">**パッケージマネージャーコンソール**ウィンドウの上部で、既定のプロジェクトとして [ContosoUniversity] を選択し、`PM>` プロンプトで「enable-移行」と入力します。</span><span class="sxs-lookup"><span data-stu-id="189ae-196">At the top of the **Package Manager Console** window select ContosoUniversity.DAL as the default project and then at the `PM>` prompt enter "enable-migrations".</span></span>

![enable-migrations_command](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image7.png)

<span data-ttu-id="189ae-198">このコマンドを実行すると、ContosoUniversity プロジェクトの新しい [*移行*] フォルダーに*Configuration.cs*ファイルが作成されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-198">This command creates a *Configuration.cs* file in a new *Migrations* folder in the ContosoUniversity.DAL project.</span></span>

![Migrations_folder_in_Solution_Explorer](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image8.png)

<span data-ttu-id="189ae-200">DAL プロジェクトを選択しました。これは、Code First コンテキストクラスを含むプロジェクトで [移行を有効にする] コマンドを実行する必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="189ae-200">You selected the DAL project because the "enable-migrations" command must be executed in the project that contains the Code First context class.</span></span> <span data-ttu-id="189ae-201">このクラスがクラスライブラリプロジェクト内にある場合、Code First Migrations は、ソリューションのスタートアッププロジェクトでデータベース接続文字列を検索します。</span><span class="sxs-lookup"><span data-stu-id="189ae-201">When that class is in a class library project, Code First Migrations looks for the database connection string in the startup project for the solution.</span></span> <span data-ttu-id="189ae-202">ContosoUniversity ソリューションでは、web プロジェクトはスタートアッププロジェクトとして設定されています。</span><span class="sxs-lookup"><span data-stu-id="189ae-202">In the ContosoUniversity solution, the web project has been set as the startup project.</span></span> <span data-ttu-id="189ae-203">(Visual Studio でスタートアッププロジェクトとして接続文字列を含むプロジェクトを指定しない場合は、PowerShell コマンドでスタートアッププロジェクトを指定できます。</span><span class="sxs-lookup"><span data-stu-id="189ae-203">(If you did not want to designate the project that has the connection string as the startup project in Visual Studio, you can specify the startup project in the PowerShell command.</span></span> <span data-ttu-id="189ae-204">[移行を有効にする] コマンドのコマンド構文を確認するには、「get-help enable-移行」というコマンドを入力します)。</span><span class="sxs-lookup"><span data-stu-id="189ae-204">To see the command syntax for the enable-migrations command, you can enter the command "get-help enable-migrations".)</span></span>

<span data-ttu-id="189ae-205">Configuration.cs ファイルを開き、`Seed` メソッドのコメントを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="189ae-205">Open the Configuration.cs file and replace the comments in the `Seed` method with the following code:</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample3.cs)]

<span data-ttu-id="189ae-206">名前空間の `using` ステートメントをまだ持っていないため、`List` への参照の下に赤い波線が表示されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-206">The references to `List` have red squiggly lines under them because you don't have a `using` statement for its namespace yet.</span></span> <span data-ttu-id="189ae-207">`List` のインスタンスの1つを右クリックし、 **[解決]** をクリックして、 **[using]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="189ae-207">Right-click one of the instances of `List` and click **Resolve**, and then click **using System.Collections.Generic**.</span></span>

![Using ステートメントを使用して解決する](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image9.png)

<span data-ttu-id="189ae-209">このメニューを選択すると、ファイルの先頭付近にある `using` のステートメントに次のコードが追加されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-209">This menu selection adds the following code to the `using` statements near the top of the file.</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample4.cs)]

> [!NOTE]
> <span data-ttu-id="189ae-210">`Seed` メソッドにコードを追加することは、データベースに固定データを挿入する多くの方法の1つです。</span><span class="sxs-lookup"><span data-stu-id="189ae-210">Adding code to the `Seed` method is one of many ways that you can insert fixed data into the database.</span></span> <span data-ttu-id="189ae-211">別の方法として、各移行クラスの `Up` および `Down` メソッドにコードを追加する方法があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-211">An alternative is to add code to the `Up` and `Down` methods of each migration class.</span></span> <span data-ttu-id="189ae-212">`Up` および `Down` メソッドには、データベースの変更を実装するコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="189ae-212">The `Up` and `Down` methods contain code that implements database changes.</span></span> <span data-ttu-id="189ae-213">これらの例については、「[データベースの更新のデプロイ](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12.md)」チュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="189ae-213">You'll see examples of them in the [Deploying a Database Update](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12.md) tutorial.</span></span>
> 
> <span data-ttu-id="189ae-214">`Sql` メソッドを使用して SQL ステートメントを実行するコードを記述することもできます。</span><span class="sxs-lookup"><span data-stu-id="189ae-214">You can also write code that executes SQL statements by using the `Sql` method.</span></span> <span data-ttu-id="189ae-215">たとえば、Department テーブルに予算列を追加し、移行の一部としてすべての部門の予算を $1000.00 に初期化する必要がある場合は、その移行の `Up` メソッドに次のコード行を追加します。</span><span class="sxs-lookup"><span data-stu-id="189ae-215">For example, if you were adding a Budget column to the Department table and wanted to initialize all department budgets to $1,000.00 as part of a migration, you could add the following line of code to the `Up` method for that migration:</span></span>
> 
> `Sql("UPDATE Department SET Budget = 1000");`
> 
> <span data-ttu-id="189ae-216">このチュートリアルで示されているこの例では、Code First Migrations `Configuration` クラスの `Seed` メソッドの `AddOrUpdate` メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="189ae-216">This example shown for this tutorial uses the `AddOrUpdate` method in the `Seed` method of the Code First Migrations `Configuration` class.</span></span> <span data-ttu-id="189ae-217">Code First Migrations は、移行のたびに `Seed` メソッドを呼び出します。このメソッドは、既に挿入されている行を更新するか、まだ存在しない場合は挿入します。</span><span class="sxs-lookup"><span data-stu-id="189ae-217">Code First Migrations calls the `Seed` method after every migration, and this method updates rows that have already been inserted, or inserts them if they don't exist yet.</span></span> <span data-ttu-id="189ae-218">`AddOrUpdate` メソッドは、お客様のシナリオに最適な選択肢ではない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-218">The `AddOrUpdate` method might not be the best choice for your scenario.</span></span> <span data-ttu-id="189ae-219">詳細については、「ジュリー Lerman のブログの[EF 4.3 AddOrUpdate メソッドに](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/)対処する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="189ae-219">For more information, see [Take care with EF 4.3 AddOrUpdate Method](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) on Julie Lerman's blog.</span></span>

<span data-ttu-id="189ae-220">CTRL + SHIFT + B キーを押して、プロジェクトをビルドします。</span><span class="sxs-lookup"><span data-stu-id="189ae-220">Press CTRL-SHIFT-B to build the project.</span></span>

<span data-ttu-id="189ae-221">次の手順では、初期移行のために `DbMigration` クラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="189ae-221">The next step is to create a `DbMigration` class for the initial migration.</span></span> <span data-ttu-id="189ae-222">この移行を使用して新しいデータベースを作成する場合は、既に存在するデータベースを削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-222">You want this migration to create a new database, so you have to delete the database that already exists.</span></span> <span data-ttu-id="189ae-223">SQL Server Compact データベースは、 *App\_Data*フォルダー内の *.sdf*ファイルに含まれています。</span><span class="sxs-lookup"><span data-stu-id="189ae-223">SQL Server Compact databases are contained in *.sdf* files in the *App\_Data* folder.</span></span> <span data-ttu-id="189ae-224">**ソリューションエクスプローラー**で、ContosoUniversity プロジェクトの [*アプリ\_データ*] を展開して、 *.sdf*ファイルで表される2つの SQL Server Compact データベースを表示します。</span><span class="sxs-lookup"><span data-stu-id="189ae-224">In **Solution Explorer**, expand *App\_Data* in the ContosoUniversity project to see the two SQL Server Compact databases, which are represented by *.sdf* files.</span></span>

<span data-ttu-id="189ae-225">*School*ファイルを右クリックし、 **[削除]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="189ae-225">Right-click the *School.sdf* file and click **Delete**.</span></span>

![sdf_files_in_Solution_Explorer](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image10.png)

<span data-ttu-id="189ae-227">**[パッケージマネージャーコンソール]** ウィンドウで、「最初の移行を作成するには」というコマンドを入力し、"initial" という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="189ae-227">In the **Package Manager Console** window, enter the command "add-migration Initial" to create the initial migration and name it "Initial".</span></span>

![migration_command の追加](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image11.png)

<span data-ttu-id="189ae-229">Code First Migrations は、*移行*フォルダーに別のクラスファイルを作成します。このクラスには、データベーススキーマを作成するコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="189ae-229">Code First Migrations creates another class file in the *Migrations* folder, and this class contains code that creates the database schema.</span></span>

<span data-ttu-id="189ae-230">**パッケージマネージャーコンソール**で、"データベースの更新" コマンドを入力してデータベースを作成し、 **Seed**メソッドを実行します。</span><span class="sxs-lookup"><span data-stu-id="189ae-230">In the **Package Manager Console**, enter the command "update-database" to create the database and run the **Seed** method.</span></span>

![更新プログラム-database_command](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image12.png)

<span data-ttu-id="189ae-232">(テーブルが既に存在していて作成できないことを示すエラーが表示される場合は、データベースを削除した後、`update-database`を実行する前にアプリケーションを実行したことが原因である可能性があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-232">(If you get an error that indicates a table already exists and can't be created, it is probably because you ran the application after you deleted the database and before you executed `update-database`.</span></span> <span data-ttu-id="189ae-233">その場合は、 *School .sdf*ファイルをもう一度削除し、`update-database` コマンドを再試行してください)。</span><span class="sxs-lookup"><span data-stu-id="189ae-233">In that case, delete the *School.sdf* file again and retry the `update-database` command.)</span></span>

<span data-ttu-id="189ae-234">アプリケーションを実行します。</span><span class="sxs-lookup"><span data-stu-id="189ae-234">Run the application.</span></span> <span data-ttu-id="189ae-235">これで、Students ページは空になりますが、インストラクターのページにはインストラクターが含まれています。</span><span class="sxs-lookup"><span data-stu-id="189ae-235">Now the Students page is empty but the Instructors page contains instructors.</span></span> <span data-ttu-id="189ae-236">これは、アプリケーションをデプロイした後、運用環境で使用できるようにするためのものです。</span><span class="sxs-lookup"><span data-stu-id="189ae-236">This is what you will get in production after you deploy the application.</span></span>

![Empty_Students_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image13.png)

![Instructors_page_after_initial_migration](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image14.png)

<span data-ttu-id="189ae-239">これで、プロジェクトは*School*データベースをデプロイする準備ができました。</span><span class="sxs-lookup"><span data-stu-id="189ae-239">The project is now ready to deploy the *School* database.</span></span>

## <a name="creating-a-membership-database-for-deployment"></a><span data-ttu-id="189ae-240">配置のためのメンバーシップデータベースの作成</span><span class="sxs-lookup"><span data-stu-id="189ae-240">Creating a Membership Database for Deployment</span></span>

<span data-ttu-id="189ae-241">Contoso 大学アプリケーションは、ASP.NET メンバーシップシステムとフォーム認証を使用してユーザーを認証および承認します。</span><span class="sxs-lookup"><span data-stu-id="189ae-241">The Contoso University application uses the ASP.NET membership system and forms authentication to authenticate and authorize users.</span></span> <span data-ttu-id="189ae-242">ページの1つは、管理者のみがアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="189ae-242">One of its pages is accessible only to administrators.</span></span> <span data-ttu-id="189ae-243">このページを表示するには、アプリケーションを実行し、 **[コース]** の下にあるポップアップメニューから **[更新プログラムのクレジット]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="189ae-243">To see this page, run the application and select **Update Credits** from the flyout menu under **Courses**.</span></span> <span data-ttu-id="189ae-244">アプリケーションでは、管理者のみが **[クレジットの更新]** ページを使用することが許可されているので、 **[ログイン]** ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-244">The application displays the **Log In** page, because only administrators are authorized to use the **Update Credits** page.</span></span>

<span data-ttu-id="189ae-245">[![Log_in_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image16.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="189ae-245">[![Log_in_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image16.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image15.png)</span></span>

<span data-ttu-id="189ae-246">パスワード "Pas $ w0rd" を使用して "admin" としてログインします ("w0rd" の文字 "o" の代わりに数字0が表示されます)。</span><span class="sxs-lookup"><span data-stu-id="189ae-246">Log in as "admin" using the password "Pas$w0rd" (notice the number zero in place of the letter "o" in "w0rd").</span></span> <span data-ttu-id="189ae-247">ログインすると、 **[更新プログラムのクレジット]** ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-247">After you log in, the **Update Credits** page is displayed.</span></span>

<span data-ttu-id="189ae-248">[![Update_Credits_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image18.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="189ae-248">[![Update_Credits_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image18.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image17.png)</span></span>

<span data-ttu-id="189ae-249">サイトを初めて展開する場合は、テスト用に作成したユーザーアカウントのほとんどまたはすべてを除外するのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="189ae-249">When you deploy a site for the first time, it is common to exclude most or all of the user accounts you create for testing.</span></span> <span data-ttu-id="189ae-250">この場合は、管理者アカウントを展開し、ユーザーアカウントを使用しません。</span><span class="sxs-lookup"><span data-stu-id="189ae-250">In this case, you'll deploy an administrator account and no user accounts.</span></span> <span data-ttu-id="189ae-251">テストアカウントを手動で削除するのではなく、運用環境で必要な管理者ユーザーアカウントを1つだけ持つ新しいメンバーシップデータベースを作成します。</span><span class="sxs-lookup"><span data-stu-id="189ae-251">Rather than manually deleting test accounts, you'll create a new membership database that has only the one administrator user account that you need in production.</span></span>

> [!NOTE]
> <span data-ttu-id="189ae-252">メンバーシップデータベースには、アカウントパスワードのハッシュが格納されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-252">The membership database stores a hash of account passwords.</span></span> <span data-ttu-id="189ae-253">あるコンピューターから別のコンピューターにアカウントを展開するには、ハッシュルーチンが、移行元コンピューターとは異なるハッシュを移行先サーバー上で生成しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-253">In order to deploy accounts from one machine to another, you must make sure that hashing routines don't generate different hashes on the destination server than they do on the source computer.</span></span> <span data-ttu-id="189ae-254">既定のアルゴリズムを変更しない限り、ASP.NET ユニバーサルプロバイダーを使用すると、同じハッシュが生成されます。</span><span class="sxs-lookup"><span data-stu-id="189ae-254">They will generate the same hashes when you use the ASP.NET Universal Providers, as long as you don't change the default algorithm.</span></span> <span data-ttu-id="189ae-255">既定のアルゴリズムは HMACSHA256 で、web.config ファイルの **[machineKey](https://msdn.microsoft.com/library/w8h3skw9.aspx)** 要素の**validation**属性で指定されています。</span><span class="sxs-lookup"><span data-stu-id="189ae-255">The default algorithm is HMACSHA256 and is specified in the **validation** attribute of the **[machineKey](https://msdn.microsoft.com/library/w8h3skw9.aspx)** element in the Web.config file.</span></span>

<span data-ttu-id="189ae-256">メンバーシップデータベースは Code First Migrations によって保持されません。また、データベースにテストアカウントをシードする自動初期化子はありません (School データベースの場合と同様)。</span><span class="sxs-lookup"><span data-stu-id="189ae-256">The membership database is not maintained by Code First Migrations, and there is no automatic initializer that seeds the database with test accounts (as there is for the School database).</span></span> <span data-ttu-id="189ae-257">そのため、テストデータを使用可能な状態に保つには、新しいテストデータベースを作成する前に、そのコピーを作成します。</span><span class="sxs-lookup"><span data-stu-id="189ae-257">Therefore, to keep test data available you'll make a copy of the test database before you create a new one.</span></span>

<span data-ttu-id="189ae-258">**ソリューションエクスプローラー**で、 *App\_Data*フォルダー内の*aspnet*ファイルの名前を*aspnet-Dev*に変更します。</span><span class="sxs-lookup"><span data-stu-id="189ae-258">In **Solution Explorer**, rename the *aspnet.sdf* file in the *App\_Data* folder to *aspnet-Dev.sdf*.</span></span> <span data-ttu-id="189ae-259">(コピーを作成しないでください。名前を変更するだけで、新しいデータベースが作成されます)。</span><span class="sxs-lookup"><span data-stu-id="189ae-259">(Don't make a copy, just rename it — you'll create a new database in a moment.)</span></span>

<span data-ttu-id="189ae-260">**ソリューションエクスプローラー**で、web プロジェクト (ContosoUniversity ではなく ContosoUniversity) が選択されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="189ae-260">In **Solution Explorer**, make sure that the web project (ContosoUniversity, not ContosoUniversity.DAL) is selected.</span></span> <span data-ttu-id="189ae-261">次に、 **[プロジェクト]** メニューの **[ASP.NET Configuration]** を選択して、 **Web サイト管理ツール**(WAT) を実行します。</span><span class="sxs-lookup"><span data-stu-id="189ae-261">Then in the **Project** menu, select **ASP.NET Configuration** to run the **Web Site Administration Tool**(WAT).</span></span>

<span data-ttu-id="189ae-262">**[セキュリティ]** タブを選択します</span><span class="sxs-lookup"><span data-stu-id="189ae-262">Select the **Security** tab.</span></span>

<span data-ttu-id="189ae-263">[![WAT_Security_tab](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image20.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="189ae-263">[![WAT_Security_tab](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image20.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image19.png)</span></span>

<span data-ttu-id="189ae-264">**[ロールの作成または管理]** をクリックし、**管理者**ロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="189ae-264">Click **Create or Manage Roles** and add an **Administrator** role.</span></span>

<span data-ttu-id="189ae-265">[![WAT_Create_New_Role](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image22.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="189ae-265">[![WAT_Create_New_Role](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image22.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image21.png)</span></span>

<span data-ttu-id="189ae-266">**[セキュリティ]** タブに戻り、 **[ユーザーの作成]** をクリックして、管理者としてユーザー "admin" を追加します。</span><span class="sxs-lookup"><span data-stu-id="189ae-266">Navigate back to the **Security** tab, click **Create User**, and add user "admin" as an administrator.</span></span> <span data-ttu-id="189ae-267">**[ユーザーの作成]** ページの **[ユーザーの作成]** ボタンをクリックする前に、 **[管理者]** チェックボックスがオンになっていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="189ae-267">Before you click the **Create User** button on the **Create User** page, make sure that you select the **Administrator** check box.</span></span> <span data-ttu-id="189ae-268">このチュートリアルで使用するパスワードは "Pas $ w0rd" で、任意の電子メールアドレスを入力できます。</span><span class="sxs-lookup"><span data-stu-id="189ae-268">The password used in this tutorial is "Pas$w0rd", and you can enter any email address.</span></span>

<span data-ttu-id="189ae-269">[![WAT_Create_User](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image24.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="189ae-269">[![WAT_Create_User](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image24.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image23.png)</span></span>

<span data-ttu-id="189ae-270">ブラウザーを閉じます。</span><span class="sxs-lookup"><span data-stu-id="189ae-270">Close the browser.</span></span> <span data-ttu-id="189ae-271">**ソリューションエクスプローラー**で、[更新] ボタンをクリックして新しい*aspnet. .sdf*ファイルを表示します。</span><span class="sxs-lookup"><span data-stu-id="189ae-271">In **Solution Explorer**, click the refresh button to see the new *aspnet.sdf* file.</span></span>

![New_aspnet。 sdf_in_Solution_Explorer](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image25.png)

<span data-ttu-id="189ae-273">**[Aspnet. .sdf]** を右クリックし、 **[プロジェクトに含める]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="189ae-273">Right-click **aspnet.sdf** and select **Include in Project**.</span></span>

## <a name="distinguishing-development-from-production-databases"></a><span data-ttu-id="189ae-274">運用データベースからの開発を区別する</span><span class="sxs-lookup"><span data-stu-id="189ae-274">Distinguishing Development from Production Databases</span></span>

<span data-ttu-id="189ae-275">このセクションでは、データベースの名前を変更して、開発バージョンが School-Dev、aspnet-Dev、および production バージョンが School-Prod と aspnet-Prod になるようにします。</span><span class="sxs-lookup"><span data-stu-id="189ae-275">In this section, you'll rename the databases so that the development versions are School-Dev.sdf and aspnet-Dev.sdf and the production versions are School-Prod.sdf and aspnet-Prod.sdf.</span></span> <span data-ttu-id="189ae-276">これは必須ではありませんが、これを行うと、データベースのテストバージョンと実稼働バージョンが混同されるのを防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="189ae-276">This isn't necessary, but doing so will help keep you from getting test and production versions of the databases confused.</span></span>

<span data-ttu-id="189ae-277">**ソリューションエクスプローラー**で、 **[最新]** の情報に更新 をクリックし、App\_Data フォルダーを展開して、先ほど作成した School データベースを表示します。それを右クリックし、 **[プロジェクトに含める]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="189ae-277">In **Solution Explorer**, click **Refresh** and expand the App\_Data folder to see the School database that you created earlier; right-click it and select **Include in project**.</span></span>

![Including_School。 sdf_in_project](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image26.png)

<span data-ttu-id="189ae-279">*Aspnet. .sdf*を*aspnet-Prod*に変更します。</span><span class="sxs-lookup"><span data-stu-id="189ae-279">Rename *aspnet.sdf* to *aspnet-Prod.sdf*.</span></span>

<span data-ttu-id="189ae-280">*School .sdf*の名前を*School-Dev*に変更します。</span><span class="sxs-lookup"><span data-stu-id="189ae-280">Rename *School.sdf* to *School-Dev.sdf*.</span></span>

<span data-ttu-id="189ae-281">Visual Studio でアプリケーションを実行するときに、- *Dev*バージョンを使用する必要がある *-* 製品版のデータベースファイルを使用しない場合。</span><span class="sxs-lookup"><span data-stu-id="189ae-281">When you run the application in Visual Studio you don't want to use the *-Prod* versions of the database files, you want to use *-Dev* versions.</span></span> <span data-ttu-id="189ae-282">そのため、データベースの *-Dev*バージョンを参照するように、web.config ファイル内の接続文字列を変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-282">Therefore you have to change the connection strings in the Web.config file so that they point to the *-Dev* versions of the databases.</span></span> <span data-ttu-id="189ae-283">(School-Prod ファイルは作成されていませんが、アプリケーションを初めて実行するときに、Code First によってそのデータベースが運用環境に作成されるため、問題はありません)。</span><span class="sxs-lookup"><span data-stu-id="189ae-283">(You haven't created a School-Prod.sdf file, but that's OK because Code First will create that database in production the first time you run your app there.)</span></span>

<span data-ttu-id="189ae-284">アプリケーションの Web.config ファイルを開き、接続文字列を見つけます。</span><span class="sxs-lookup"><span data-stu-id="189ae-284">Open the application Web.config file, and locate the connection strings:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample5.xml)]

<span data-ttu-id="189ae-285">"Aspnet. .sdf" を "aspnet-Dev" に変更し、"School" を "School-Dev" に変更します。</span><span class="sxs-lookup"><span data-stu-id="189ae-285">Change "aspnet.sdf" to "aspnet-Dev.sdf", and change "School.sdf" to "School-Dev.sdf":</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample6.xml?highlight=4-5)]

<span data-ttu-id="189ae-286">これで、SQL Server Compact データベースエンジンと両方のデータベースを配置する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="189ae-286">The SQL Server Compact database engine and both databases are now ready to be deployed.</span></span> <span data-ttu-id="189ae-287">次のチュートリアルでは、開発環境、テスト環境、および運用環境で異なる必要がある設定に対して、web.config ファイルの自動変換を設定*します。*</span><span class="sxs-lookup"><span data-stu-id="189ae-287">In the following tutorial you set up automatic *Web.config* file transformations for settings that must be different in the development, test, and production environments.</span></span> <span data-ttu-id="189ae-288">(変更が必要な設定の中には接続文字列がありますが、後で発行プロファイルを作成するときにこれらの変更を設定します)。</span><span class="sxs-lookup"><span data-stu-id="189ae-288">(Among the settings that must be changed are the connection strings, but you'll set up those changes later when you create a publish profile.)</span></span>

## <a name="more-information"></a><span data-ttu-id="189ae-289">その他の情報</span><span class="sxs-lookup"><span data-stu-id="189ae-289">More Information</span></span>

<span data-ttu-id="189ae-290">NuGet の詳細については、「NuGet と Nuget の[ドキュメント](http://docs.nuget.org/docs/start-here/overview)[を使用したプロジェクトライブラリの管理](https://msdn.microsoft.com/magazine/hh547106.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="189ae-290">For more information on NuGet, see [Manage Project Libraries with NuGet](https://msdn.microsoft.com/magazine/hh547106.aspx) and [NuGet Documentation](http://docs.nuget.org/docs/start-here/overview).</span></span> <span data-ttu-id="189ae-291">NuGet を使用しない場合は、NuGet パッケージを分析してインストールしたときの動作を確認する方法について学習する必要があります。</span><span class="sxs-lookup"><span data-stu-id="189ae-291">If you don't want to use NuGet, you'll need to learn how to analyze a NuGet package to determine what it does when it is installed.</span></span> <span data-ttu-id="189ae-292">(たとえば、web.config 変換を構成したり、PowerShell スクリプトをビルド時に実行するように構成し*たりすること*があります)。NuGet のしくみの詳細については、「パッケージと構成ファイル[の作成と発行](http://docs.nuget.org/docs/creating-packages/creating-and-publishing-a-package)」[および「ソースコード変換](http://docs.nuget.org/docs/creating-packages/configuration-file-and-source-code-transformations)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="189ae-292">(For example, it might configure *Web.config* transformations, configure PowerShell scripts to run at build time, etc.) To learn more about how NuGet works, see especially [Creating and Publishing a Package](http://docs.nuget.org/docs/creating-packages/creating-and-publishing-a-package) and [Configuration File and Source Code Transformations](http://docs.nuget.org/docs/creating-packages/configuration-file-and-source-code-transformations).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="189ae-293">[前へ](deployment-to-a-hosting-provider-introduction-1-of-12.md)
> [次へ](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12.md)</span><span class="sxs-lookup"><span data-stu-id="189ae-293">[Previous](deployment-to-a-hosting-provider-introduction-1-of-12.md)
[Next](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12.md)</span></span>
