---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12
title: 'Visual Studio または Visual Web Developer を使用した SQL Server Compact を使用した ASP.NET Web アプリケーションの配置: テスト環境としての IIS への配置-5/12 |Microsoft Docs'
author: tdykstra
description: この一連のチュートリアルでは、Visual Stu... を使用して SQL Server Compact データベースを含む ASP.NET web アプリケーションプロジェクトをデプロイ (発行) する方法について説明します。
ms.author: riande
ms.date: 11/17/2011
ms.assetid: 493b2a66-816c-485c-8315-952ed1085ccc
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12
msc.type: authoredcontent
ms.openlocfilehash: 5d85232ff2cb229d771d517db7173721c9e277bf
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78515680"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-deploying-to-iis-as-a-test-environment---5-of-12"></a><span data-ttu-id="c6f61-103">Visual Studio または Visual Web Developer を使用した SQL Server Compact を使用した ASP.NET Web アプリケーションの配置: テスト環境としての IIS への配置-5/12</span><span class="sxs-lookup"><span data-stu-id="c6f61-103">Deploying an ASP.NET Web Application with SQL Server Compact using Visual Studio or Visual Web Developer: Deploying to IIS as a Test Environment - 5 of 12</span></span>

<span data-ttu-id="c6f61-104">[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="c6f61-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="c6f61-105">スタートプロジェクトのダウンロード</span><span class="sxs-lookup"><span data-stu-id="c6f61-105">Download Starter Project</span></span>](https://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> <span data-ttu-id="c6f61-106">この一連のチュートリアルでは、Visual Studio 2012 RC または Visual Studio Express 2012 RC for Web を使用して SQL Server Compact データベースを含む ASP.NET web アプリケーションプロジェクトをデプロイ (発行) する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-106">This series of tutorials shows you how to deploy (publish) an ASP.NET web application project that includes a SQL Server Compact database by using Visual Studio 2012 RC or Visual Studio Express 2012 RC for Web.</span></span> <span data-ttu-id="c6f61-107">Web 発行の更新をインストールする場合は、Visual Studio 2010 を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-107">You can also use Visual Studio 2010 if you install the Web Publish Update.</span></span> <span data-ttu-id="c6f61-108">シリーズの概要については、[シリーズの最初のチュートリアル](deployment-to-a-hosting-provider-introduction-1-of-12.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-108">For an introduction to the series, see [the first tutorial in the series](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span></span>
> 
> <span data-ttu-id="c6f61-109">Visual Studio 2012 の RC リリース後に導入された配置機能を示すチュートリアルについては、SQL Server Compact 以外の SQL Server のエディションをデプロイする方法、Azure App Service Web Apps にデプロイする方法については、「 [ASP.NET Web deployment Using Visual studio (Visual studio を使用した Web デプロイ](../../deployment/visual-studio-web-deployment/introduction.md)のデプロイ)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-109">For a tutorial that shows deployment features introduced after the RC release of Visual Studio 2012, shows how to deploy SQL Server editions other than SQL Server Compact, and shows how to deploy to Azure App Service Web Apps, see [ASP.NET Web Deployment using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="c6f61-110">概要</span><span class="sxs-lookup"><span data-stu-id="c6f61-110">Overview</span></span>

<span data-ttu-id="c6f61-111">このチュートリアルでは、ASP.NET web アプリケーションをローカルコンピューター上の IIS に配置する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-111">This tutorial shows how to deploy an ASP.NET web application to IIS on the local computer.</span></span>

<span data-ttu-id="c6f61-112">アプリケーションを開発する場合は、通常、Visual Studio で実行することでテストします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-112">When you develop an application, you generally test by running it in Visual Studio.</span></span> <span data-ttu-id="c6f61-113">既定では、これは Visual Studio 開発サーバー (Cassini とも呼ばれます) を使用していることを意味します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-113">By default, this means you're using the Visual Studio Development Server (also known as Cassini).</span></span> <span data-ttu-id="c6f61-114">Visual Studio 開発サーバーを使用すると、Visual Studio での開発時のテストが簡単になりますが、IIS とまったく同じようには機能しません。</span><span class="sxs-lookup"><span data-stu-id="c6f61-114">The Visual Studio Development Server makes it easy to test during development in Visual Studio, but it doesn't work exactly like IIS.</span></span> <span data-ttu-id="c6f61-115">その結果、Visual Studio でアプリケーションをテストするときに、アプリケーションが正常に実行されることはありますが、ホスト環境の IIS に配置すると失敗します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-115">As a result, it's possible that an application will run correctly when you test it in Visual Studio, but fail when it's deployed to IIS in a hosting environment.</span></span>

<span data-ttu-id="c6f61-116">次の方法で、アプリケーションをより確実にテストできます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-116">You can test your application more reliably in these ways:</span></span>

1. <span data-ttu-id="c6f61-117">開発中に Visual Studio でテストする場合は、Visual Studio 開発サーバーではなく IIS Express または完全な IIS を使用します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-117">Use IIS Express or full IIS instead of the Visual Studio Development Server when you test in Visual Studio during development.</span></span> <span data-ttu-id="c6f61-118">通常、この方法では、IIS でのサイトの実行方法がより正確にエミュレートされます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-118">This method generally emulates more accurately how your site will run under IIS.</span></span> <span data-ttu-id="c6f61-119">ただし、この方法では、配置プロセスをテストしたり、配置プロセスの結果が正常に実行されることを検証したりすることはありません。</span><span class="sxs-lookup"><span data-stu-id="c6f61-119">However, this method does not test your deployment process or validate that the result of the deployment process will run correctly.</span></span>
2. <span data-ttu-id="c6f61-120">後で運用環境に配置する場合と同じプロセスを使用して、開発用コンピューター上の IIS にアプリケーションを配置します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-120">Deploy the application to IIS on your development computer by using the same process that you'll use later to deploy it to your production environment.</span></span> <span data-ttu-id="c6f61-121">このメソッドは、IIS でアプリケーションが正しく実行されることを検証するだけでなく、デプロイプロセスを検証します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-121">This method validates your deployment process in addition to validating that your application will run correctly under IIS.</span></span>
3. <span data-ttu-id="c6f61-122">実稼働環境にできるだけ近いテスト環境にアプリケーションをデプロイします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-122">Deploy the application to a test environment that is as close as possible to your production environment.</span></span> <span data-ttu-id="c6f61-123">これらのチュートリアルの運用環境はサードパーティのホスティングプロバイダーなので、最適なテスト環境は、ホスティングプロバイダーによる2番目のアカウントになります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-123">Since the production environment for these tutorials is a third-party hosting provider, the ideal test environment would be a second account with the hosting provider.</span></span> <span data-ttu-id="c6f61-124">この2番目のアカウントはテストにのみ使用しますが、運用アカウントと同じ方法で設定します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-124">You would use this second account only for testing, but it would be set up the same way as the production account.</span></span>

<span data-ttu-id="c6f61-125">このチュートリアルでは、オプション2の手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-125">This tutorial shows the steps for option 2.</span></span> <span data-ttu-id="c6f61-126">オプション3に関するガイダンスは、「[運用環境へのデプロイ](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md)」チュートリアルの最後に記載されています。このチュートリアルの最後には、オプション1のリソースへのリンクがあります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-126">Guidance for option 3 is provided at the end of the [Deploying to the Production Environment](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md) tutorial, and at the end of this tutorial there are links to resources for option 1.</span></span>

<span data-ttu-id="c6f61-127">リマインダー: チュートリアルを実行しているときにエラーメッセージが表示されたり機能しない場合は、必ず[トラブルシューティングのページ](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md)を確認してください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-127">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the [troubleshooting page](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span></span>

## <a name="configuring-the-application-to-run-in-medium-trust"></a><span data-ttu-id="c6f61-128">中程度の信頼で実行されるようにアプリケーションを構成する</span><span class="sxs-lookup"><span data-stu-id="c6f61-128">Configuring the Application to Run in Medium Trust</span></span>

<span data-ttu-id="c6f61-129">IIS をインストールして配置する前に、通常の共有ホスティング環境と同様に、サイトを実行するように web.config ファイルの設定を変更します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-129">Before installing IIS and deploying to it, you'll change a Web.config file setting in order to make the site run more like it will in a typical shared hosting environment.</span></span>

<span data-ttu-id="c6f61-130">通常、ホスティングプロバイダーは、web サイトを*中程度の信頼*で実行します。これは、許可されていないものがあることを意味します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-130">Hosting providers typically run your web site in *medium trust*, which means there are some things it is not allowed to do.</span></span> <span data-ttu-id="c6f61-131">たとえば、アプリケーションコードは Windows レジストリにアクセスできず、アプリケーションのフォルダー階層の外部にあるファイルの読み取りや書き込みもできません。</span><span class="sxs-lookup"><span data-stu-id="c6f61-131">For example, application code can't access the Windows registry and can't read or write files that are outside of your application's folder hierarchy.</span></span> <span data-ttu-id="c6f61-132">既定では、アプリケーションはローカルコンピューター上で*高い信頼*で実行されます。つまり、アプリケーションは、運用環境に配置するときに失敗する可能性がある処理を実行できます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-132">By default your application runs in *high trust* on your local computer, which means that the application might be able to do things that would fail when you deploy it to production.</span></span> <span data-ttu-id="c6f61-133">したがって、テスト環境に実稼働環境をより正確に反映させるには、アプリケーションを中程度の信頼で実行するように構成します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-133">Therefore, to make the test environment more accurately reflect the production environment, you'll configure the application to run in medium trust.</span></span>

<span data-ttu-id="c6f61-134">アプリケーションの Web.config ファイルで、次の例に示すように、 **system.web 要素に** **trust**要素を追加します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-134">In the application Web.config file, add a **trust** element in the **system.web** element, as shown in this example.</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/samples/sample1.xml?highlight=4)]

<span data-ttu-id="c6f61-135">これで、アプリケーションはローカルコンピューター上でも IIS の中程度の信頼で実行されるようになります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-135">The application will now run in medium trust in IIS even on your local computer.</span></span> <span data-ttu-id="c6f61-136">この設定を使用すると、アプリケーションコードによって、運用環境でエラーが発生する可能性のある処理をできるだけ早くキャッチできます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-136">This setting enables you to catch as early as possible any attempts by application code to do something that would fail in production.</span></span>

> [!NOTE]
> <span data-ttu-id="c6f61-137">Entity Framework Code First Migrations を使用している場合は、バージョン5.0 以降がインストールされていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-137">If you are using Entity Framework Code First Migrations, make sure that you have version 5.0 or later installed.</span></span> <span data-ttu-id="c6f61-138">Entity Framework バージョン4.3 では、データベーススキーマを更新するために、移行には完全な信頼が必要です。</span><span class="sxs-lookup"><span data-stu-id="c6f61-138">In Entity Framework version 4.3, Migrations requires full trust in order to update the database schema.</span></span>

## <a name="installing-iis-and-web-deploy"></a><span data-ttu-id="c6f61-139">IIS と Web 配置のインストール</span><span class="sxs-lookup"><span data-stu-id="c6f61-139">Installing IIS and Web Deploy</span></span>

<span data-ttu-id="c6f61-140">開発用コンピューターに IIS を配置するには、IIS と Web 配置がインストールされている必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-140">To deploy to IIS on your development computer, you must have IIS and Web Deploy installed.</span></span> <span data-ttu-id="c6f61-141">これらは、既定の Windows 7 構成には含まれていません。</span><span class="sxs-lookup"><span data-stu-id="c6f61-141">These are not included in the default Windows 7 configuration.</span></span> <span data-ttu-id="c6f61-142">IIS と Web 配置の両方を既にインストールしている場合は、次のセクションに進んでください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-142">If you have already installed both IIS and Web Deploy, skip to the next section.</span></span>

<span data-ttu-id="c6f61-143">Web platform Installer は iis 用に推奨される構成をインストールし、必要に応じて iis および Web 配置の前提条件を自動的にインストールするため、IIS と Web 配置をインストールするには、 [Web Platform installer](https://www.microsoft.com/web/downloads/platform.aspx)を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-143">Using the [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx) is the preferred way to install IIS and Web Deploy, because the Web Platform Installer installs a recommended configuration for IIS and it automatically installs the prerequisites for IIS and Web Deploy if necessary.</span></span>

<span data-ttu-id="c6f61-144">Web Platform Installer を実行して IIS と Web 配置をインストールするには、次のリンクを使用します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-144">To run Web Platform Installer to install IIS and Web Deploy, use the following link.</span></span> <span data-ttu-id="c6f61-145">IIS、Web 配置、または必要なコンポーネントのいずれかが既にインストールされている場合は、不足しているものだけが Web Platform Installer によってインストールされます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-145">If you already have installed IIS, Web Deploy or any of their required components, the Web Platform Installer installs only what is missing.</span></span>

- [<span data-ttu-id="c6f61-146">WebPI を使用した IIS と Web 配置のインストール</span><span class="sxs-lookup"><span data-stu-id="c6f61-146">Install IIS and Web Deploy using WebPI</span></span>](https://www.microsoft.com/web/gallery/install.aspx?appsxml=&amp;appid=IIS7;ASPNET;NETFramework4;WDeploy)

## <a name="setting-the-default-application-pool-to-net-4"></a><span data-ttu-id="c6f61-147">既定のアプリケーションプールを .NET 4 に設定する</span><span class="sxs-lookup"><span data-stu-id="c6f61-147">Setting the Default Application Pool to .NET 4</span></span>

<span data-ttu-id="c6f61-148">IIS をインストールした後、 **Iis マネージャー**を実行して、.NET Framework バージョン4が既定のアプリケーションプールに割り当てられていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-148">After installing IIS, run **IIS Manager** to make sure that the .NET Framework version 4 is assigned to the default application pool.</span></span>

<span data-ttu-id="c6f61-149">Windows の **[スタート]** メニューから、 **[実行]** を選択し、「inetmgr.exe」と入力して、 **[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-149">From the Windows **Start** menu, select **Run**, enter "inetmgr", and then click **OK**.</span></span> <span data-ttu-id="c6f61-150">( **[実行]** コマンドが **[スタート]** メニューにない場合は、Windows キーと R キーを押して開くことができます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-150">(If the **Run** command is not in your **Start** menu, you can press the Windows Key and R to open it.</span></span> <span data-ttu-id="c6f61-151">または、タスクバーを右クリックし、 **[プロパティ]** をクリックします。 [**スタート] メニュー**を選択し、 **[カスタマイズ]** をクリックして、 **[コマンドの実行]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-151">Or right-click the taskbar, click **Properties**, select the **Start Menu** tab, click **Customize**, and select **Run command**.)</span></span>

<span data-ttu-id="c6f61-152">**[接続]** ウィンドウで、サーバーノードを展開し、 **[アプリケーションプール]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-152">In the **Connections** pane, expand the server node and select **Application Pools**.</span></span> <span data-ttu-id="c6f61-153">次の図に示すように、 **[アプリケーションプール]** ウィンドウで、 **DefaultAppPool**が .net framework version 4 に割り当てられている場合は、次のセクションに進みます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-153">In the **Application Pools** pane, if **DefaultAppPool** is assigned to the .NET framework version 4 as in the following illustration, skip to the next section.</span></span>

<span data-ttu-id="c6f61-154">[![Inetmgr_showing_4。0_app_pools](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image2.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-154">[![Inetmgr_showing_4.0_app_pools](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image2.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image1.png)</span></span>

<span data-ttu-id="c6f61-155">アプリケーションプールが2つだけ表示され、その両方が .NET Framework 2.0 に設定されている場合は、IIS で ASP.NET 4 をインストールする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-155">If you see only two application pools and both of them are set to the .NET Framework 2.0, you have to install ASP.NET 4 in IIS:</span></span>

- <span data-ttu-id="c6f61-156">Windows の **[スタート]** メニューの **[コマンドプロンプト]** を右クリックし、 **[管理者として実行]** をクリックして、コマンドプロンプトウィンドウを開きます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-156">Open a command prompt window by right-clicking **Command Prompt** in the Windows **Start** menu and selecting **Run as Administrator**.</span></span> <span data-ttu-id="c6f61-157">次に、次のコマンドを使用して、 [aspnet\_iis 登録ツール](https://msdn.microsoft.com/library/k6h9cz8h.aspx)を実行し、IIS に ASP.NET 4 をインストールします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-157">Then run [aspnet\_regiis.exe](https://msdn.microsoft.com/library/k6h9cz8h.aspx) to install ASP.NET 4 in IIS, using the following commands.</span></span> <span data-ttu-id="c6f61-158">(64 ビットシステムでは、"Framework" を "Framework64" に置き換えます)。</span><span class="sxs-lookup"><span data-stu-id="c6f61-158">(In 64-bit systems, replace "Framework" with "Framework64".)</span></span>

    [!code-console[Main](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/samples/sample2.cmd)]

    <span data-ttu-id="c6f61-159">[![aspnet_regiis_installing_ASP。 NET_4](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image4.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-159">[![aspnet_regiis_installing_ASP.NET_4](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image4.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image3.png)</span></span>

    <span data-ttu-id="c6f61-160">このコマンドは .NET Framework 4 の新しいアプリケーションプールを作成しますが、既定のアプリケーションプールは2.0 に設定されたままになります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-160">This command creates new application pools for the .NET Framework 4, but the default application pool will still be set to 2.0.</span></span> <span data-ttu-id="c6f61-161">.NET 4 を対象とするアプリケーションをそのアプリケーションプールに配置するため、アプリケーションプールを .NET 4 に変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-161">You'll be deploying an application that targets .NET 4 to that application pool, so you have to change the application pool to .NET 4.</span></span>

<span data-ttu-id="c6f61-162">**IIS マネージャー**を閉じた場合は、もう一度実行し、サーバーノードを展開して **[アプリケーションプール]** をクリックすると、 **[アプリケーションプール]** ウィンドウが再び表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-162">If you closed **IIS Manager**, run it again, expand the server node, and click **Application Pools** to display the **Application Pools** pane again.</span></span>

<span data-ttu-id="c6f61-163">**[アプリケーションプール]** ウィンドウで、 **[DefaultAppPool**] をクリックし、 **[操作]** ウィンドウで **[基本設定]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-163">In the **Application Pools** pane, click **DefaultAppPool**, and then in the **Actions** pane click **Basic Settings**.</span></span>

<span data-ttu-id="c6f61-164">[![Inetmgr_selecting_Basic_Settings_for_app_pool](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image6.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-164">[![Inetmgr_selecting_Basic_Settings_for_app_pool](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image6.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image5.png)</span></span>

<span data-ttu-id="c6f61-165">**[アプリケーションプールの編集]** ダイアログボックスで **.NET Framework バージョン**を **.NET Framework v v4.0.30319**に変更し、[ **OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-165">In the **Edit Application Pool** dialog box, change **.NET Framework version** to **.NET Framework v4.0.30319** and click **OK**.</span></span>

<span data-ttu-id="c6f61-166">[![Selecting_。 NET_4_for_DefaultAppPool](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image8.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-166">[![Selecting_.NET_4_for_DefaultAppPool](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image8.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image7.png)</span></span>

<span data-ttu-id="c6f61-167">これで、IIS に発行する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="c6f61-167">You are now ready to publish to IIS.</span></span>

## <a name="publishing-to-iis"></a><span data-ttu-id="c6f61-168">IIS への発行</span><span class="sxs-lookup"><span data-stu-id="c6f61-168">Publishing to IIS</span></span>

<span data-ttu-id="c6f61-169">Visual Studio 2010 と Web 配置を使用してデプロイできる方法はいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-169">There are several ways you can deploy using Visual Studio 2010 and Web Deploy:</span></span>

- <span data-ttu-id="c6f61-170">Visual Studio のワンクリック発行を使用します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-170">Use Visual Studio one-click publish.</span></span>
- <span data-ttu-id="c6f61-171">*展開パッケージ*を作成し、IIS マネージャーの UI を使用してインストールします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-171">Create a *deployment package* and install it using the IIS Manager UI.</span></span> <span data-ttu-id="c6f61-172">展開パッケージは、IIS にサイトをインストールするために必要なすべてのファイルとメタデータを含む *.zip*ファイルで構成されます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-172">The deployment package consists of a *.zip* file that contains all the files and metadata needed to install a site in IIS.</span></span>
- <span data-ttu-id="c6f61-173">展開パッケージを作成し、コマンドラインを使用してインストールします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-173">Create a deployment package and install it using the command line.</span></span>

<span data-ttu-id="c6f61-174">デプロイタスクを自動化するように Visual Studio を設定するために、前のチュートリアルで実行したプロセスは、これら3つの方法すべてに適用されます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-174">The process you went through in the previous tutorials to set up Visual Studio to automate deployment tasks applies to all of these three methods.</span></span> <span data-ttu-id="c6f61-175">これらのチュートリアルでは、これらのメソッドの1つ目を使用します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-175">In these tutorials you'll use the first of these methods.</span></span> <span data-ttu-id="c6f61-176">配置パッケージの使用方法の詳細については、「 [ASP.NET Deployment Content Map](https://msdn.microsoft.com/library/bb386521.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-176">For information about using deployment packages, see [ASP.NET Deployment Content Map](https://msdn.microsoft.com/library/bb386521.aspx).</span></span>

<span data-ttu-id="c6f61-177">発行する前に、管理者モードで Visual Studio を実行していることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-177">Before publishing, make sure that you are running Visual Studio in administrator mode.</span></span> <span data-ttu-id="c6f61-178">(Windows 7 の **[スタート]** メニューで、使用している Visual Studio のバージョンのアイコンを右クリックし、 **[管理者として実行]** を選択します)。ローカルコンピューター上の IIS に発行する場合にのみ、発行に管理者モードが必要です。</span><span class="sxs-lookup"><span data-stu-id="c6f61-178">(In the Windows 7 **Start** menu, right-click the icon for the version of Visual Studio you're using and select **Run as Administrator**.) Administrator mode is required for publishing only when you are publishing to IIS on the local computer.</span></span>

<span data-ttu-id="c6f61-179">**ソリューションエクスプローラー**で、(ContosoUniversity プロジェクトではなく) ContosoUniversity プロジェクトを右クリックし、 **[発行]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-179">In **Solution Explorer**, right-click the ContosoUniversity project (not the ContosoUniversity.DAL project) and select **Publish**.</span></span>

<span data-ttu-id="c6f61-180">**Web の発行** ウィザードが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-180">The **Publish Web** wizard appears.</span></span>

![Publish_Web_wizard_Profile_tab](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image9.png)

<span data-ttu-id="c6f61-182">ドロップダウンリストで、[ **&lt;新しい...&gt;** ] を選択します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-182">In the drop-down list, select **&lt;New...&gt;**.</span></span>

<span data-ttu-id="c6f61-183">**[新しいプロファイル]** ダイアログボックスで、「Test」と入力し、 **[OK]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-183">In the **New Profile** dialog box, enter "Test", and then click **OK**.</span></span>

![New_Profile_dialog_box](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image10.png)

<span data-ttu-id="c6f61-185">この名前は、前に作成した web.config 変換ファイルの中間ノードと同じです。</span><span class="sxs-lookup"><span data-stu-id="c6f61-185">This name is the same as the middle node of the Web.Test.config transform file that you created earlier.</span></span> <span data-ttu-id="c6f61-186">この対応により、このプロファイルを使用して発行するときに web.config 変換が適用されます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-186">This correspondence is what causes the Web.Test.config transformations to be applied when you publish by using this profile.</span></span>

<span data-ttu-id="c6f61-187">ウィザードは自動的に **[接続]** タブに進みます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-187">The wizard automatically advances to the **Connection** tab.</span></span>

<span data-ttu-id="c6f61-188">**[サービス URL]** ボックスに、「 *localhost*」と入力します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-188">In the **Service URL** box, enter *localhost*.</span></span>

<span data-ttu-id="c6f61-189">**[サイト/アプリケーション]** ボックスに、「 *Default Web Site/ContosoUniversity」と*入力します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-189">In the **Site/application** box, enter *Default Web Site/ContosoUniversity*.</span></span>

<span data-ttu-id="c6f61-190">**[宛先 URL]** ボックスに、「`http://localhost/ContosoUniversity`」と入力します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-190">In the **Destination URL** box, enter `http://localhost/ContosoUniversity`.</span></span>

<span data-ttu-id="c6f61-191">**送信先 URL**の設定は必須ではありません。</span><span class="sxs-lookup"><span data-stu-id="c6f61-191">The **Destination URL** setting isn't required.</span></span> <span data-ttu-id="c6f61-192">Visual Studio がアプリケーションの配置を完了すると、既定のブラウザーが自動的にこの URL に表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-192">When Visual Studio finishes deploying the application, it automatically opens your default browser to this URL.</span></span> <span data-ttu-id="c6f61-193">配置後にブラウザーが自動的に開かないようにする場合は、このボックスを空白のままにします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-193">If you don't want the browser to open automatically after deployment, leave this box blank.</span></span>

![Publish_Web_wizard_Connection_tab_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image11.png)

<span data-ttu-id="c6f61-195">**[接続の検証]** をクリックして設定が正しいことを確認し、ローカルコンピューターの IIS に接続できることを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-195">Click **Validate Connection** to verify that the settings are correct and you can connect to IIS on the local computer.</span></span>

<span data-ttu-id="c6f61-196">緑色のチェックマークは、接続が成功したことを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-196">A green check mark verifies that the connection is successful.</span></span>

![Publish_Web_wizard_Connection_tab_validated](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image12.png)

<span data-ttu-id="c6f61-198">**[次]** へ をクリックして、 **[設定]** タブに進みます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-198">Click **Next** to advance to the **Settings** tab.</span></span>

<span data-ttu-id="c6f61-199">**[構成]** ボックスの一覧で、配置するビルド構成を指定します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-199">The **Configuration** drop-down box specifies the build configuration to deploy.</span></span> <span data-ttu-id="c6f61-200">既定値は Release です。これが必要です。</span><span class="sxs-lookup"><span data-stu-id="c6f61-200">The default value is Release, which is what you want.</span></span>

<span data-ttu-id="c6f61-201">[**ターゲットで追加ファイルを削除**する] チェックボックスをオフのままにします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-201">Leave the **Remove additional files at destination** check box cleared.</span></span> <span data-ttu-id="c6f61-202">これは最初の配置であるため、コピー先のフォルダーにはまだファイルがありません。</span><span class="sxs-lookup"><span data-stu-id="c6f61-202">Since this is your first deployment, there won't be any files in the destination folder yet.</span></span>

<span data-ttu-id="c6f61-203">**[データベース]** セクションで、 **schoolcontext.cs**の [接続文字列] ボックスに次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-203">In the **Databases** section, enter the following value in the connection string box for **SchoolContext**:</span></span>

[!code-console[Main](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/samples/sample3.cmd)]

<span data-ttu-id="c6f61-204">配置プロセスでは、この接続文字列が配置された Web.config ファイルに配置されます。これは、**実行時にこの接続文字列を使用する (実行時にこの接続文字列を使用する**)。</span><span class="sxs-lookup"><span data-stu-id="c6f61-204">The deployment process will put this connection string in the deployed Web.config file because **Use this connection string at runtime** is selected.</span></span>

<span data-ttu-id="c6f61-205">また、 **[schoolcontext.cs]** の下の **[Code First Migrations の適用]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-205">Also under **SchoolContext**, select **Apply Code First Migrations**.</span></span> <span data-ttu-id="c6f61-206">このオプションを選択すると、配置プロセスによって、配置された Web.config ファイルが `MigrateDatabaseToLatestVersion` 初期化子を指定するように構成されます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-206">This option causes the deployment process to configure the deployed Web.config file to specify the `MigrateDatabaseToLatestVersion` initializer.</span></span> <span data-ttu-id="c6f61-207">この初期化子は、配置後にアプリケーションが初めてデータベースにアクセスしたときに、データベースを最新バージョンに自動的に更新します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-207">This initializer automatically updates the database to the latest version when the application accesses the database for the first time after deployment.</span></span>

<span data-ttu-id="c6f61-208">**Defaultconnection**の [接続文字列] ボックスに、次の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-208">In the connection string box for **DefaultConnection**, enter the following value:</span></span>

[!code-console[Main](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/samples/sample4.cmd)]

<span data-ttu-id="c6f61-209">**更新データベース**をクリアしたままにします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-209">Leave **Update database** cleared.</span></span> <span data-ttu-id="c6f61-210">メンバーシップデータベースは、アプリ\_データ内の .sdf ファイルをコピーすることによってデプロイされます。このデータベースでは、配置プロセスで他の操作を実行しないようにします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-210">The membership database will be deployed by copying the .sdf file in App\_Data, and you don't want the deployment process to do anything else with this database.</span></span>

![Publish_Web_wizard_Settings_tab_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image13.png)

<span data-ttu-id="c6f61-212">**[次]** へ をクリックして、 **[プレビュー]** タブに進みます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-212">Click **Next** to advance to the **Preview** tab.</span></span>

<span data-ttu-id="c6f61-213">**[プレビュー]** タブで、 **[プレビューの開始]** をクリックして、コピーされるファイルの一覧を表示します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-213">In the **Preview** tab, click **Start Preview** to see a list of the files that will be copied.</span></span>

![Publish_Web_wizard_Preview_tab_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image14.png)

![Publish_Web_wizard_Preview_tab_Test_with_file_list](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image15.png)

<span data-ttu-id="c6f61-216">**[発行]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-216">Click **Publish**.</span></span>

<span data-ttu-id="c6f61-217">Visual Studio が管理者モードでない場合は、アクセス許可のエラーを示すエラーメッセージが表示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-217">If Visual Studio is not in administrator mode, you might get an error message that indicates a permissions error.</span></span> <span data-ttu-id="c6f61-218">その場合は、Visual Studio を閉じて、管理者モードで開き、もう一度発行してみてください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-218">In that case, close Visual Studio, open it in administrator mode, and try to publish again.</span></span>

<span data-ttu-id="c6f61-219">Visual Studio が管理者モードの場合、 **[出力]** ウィンドウは成功したビルドと発行を報告します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-219">If Visual Studio is in administrator mode, the **Output** window reports successful build and publish.</span></span>

![Output_window_publish_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image16.png)

<span data-ttu-id="c6f61-221">ブラウザーが自動的に開き、ローカルコンピューターの IIS で実行されている Contoso 大学のホームページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-221">The browser automatically opens to the Contoso University Home page running in IIS on the local computer.</span></span>

<span data-ttu-id="c6f61-222">[![Home_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image18.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-222">[![Home_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image18.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image17.png)</span></span>

## <a name="testing-in-the-test-environment"></a><span data-ttu-id="c6f61-223">テスト環境でのテスト</span><span class="sxs-lookup"><span data-stu-id="c6f61-223">Testing in the Test Environment</span></span>

<span data-ttu-id="c6f61-224">環境インジケーターには、"(Dev)" ではなく "(Test)" と表示されます。これは、環境インジケーターの*web.config 変換が*成功したことを示しています。</span><span class="sxs-lookup"><span data-stu-id="c6f61-224">Notice that the environment indicator shows "(Test)" instead of "(Dev)", which shows that the *Web.config* transformation for the environment indicator was successful.</span></span>

<span data-ttu-id="c6f61-225">[![Home_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image20.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-225">[![Home_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image20.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image19.png)</span></span>

<span data-ttu-id="c6f61-226">**[Students]** ページを実行して、デプロイされたデータベースに学生がいないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-226">Run the **Students** page to verify that the deployed database has no students.</span></span> <span data-ttu-id="c6f61-227">このページを選択すると、Code First によってデータベースが作成され、`Seed` メソッドが実行されるため、読み込みに数分かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-227">When you select this page it may take a few minutes to load because Code First creates the database and then runs the `Seed` method.</span></span> <span data-ttu-id="c6f61-228">(これは、アプリケーションがデータベースにアクセスしようとしていないためにホームページを使用していた場合には行われませんでした)。</span><span class="sxs-lookup"><span data-stu-id="c6f61-228">(It didn't do that when you were on the home page because the application didn't try to access the database yet.)</span></span>

<span data-ttu-id="c6f61-229">[![Students_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image22.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-229">[![Students_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image22.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image21.png)</span></span>

<span data-ttu-id="c6f61-230">**インストラクターページを**実行して、Code First がインストラクターのデータでデータベースをシード処理したことを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-230">Run the **Instructors** page to verify that Code First seeded the database with instructor data:</span></span>

<span data-ttu-id="c6f61-231">[![Instructors_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image24.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-231">[![Instructors_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image24.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image23.png)</span></span>

<span data-ttu-id="c6f61-232">**学生メニューから** **[学生の追加]** を選択し、学生を追加します。次に、 **[学生]** ページで新しい学生を表示して、データベースへの書き込みが正常に完了したことを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-232">Select **Add Students** from the **Students** menu, add a student, and then view the new student in the **Students** page to verify that you can successfully write to the database:</span></span>

<span data-ttu-id="c6f61-233">[![Add_Students_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image26.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-233">[![Add_Students_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image26.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image25.png)</span></span>

<span data-ttu-id="c6f61-234">[![Students_page_with_new_student_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image28.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-234">[![Students_page_with_new_student_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image28.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image27.png)</span></span>

<span data-ttu-id="c6f61-235">**[コース]** メニューの **[クレジットの更新]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-235">From the **Courses** menu, select **Update Credits**.</span></span> <span data-ttu-id="c6f61-236">**[更新プログラムのクレジット]** ページには管理者権限が必要であるため、 **[ログイン]** ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-236">The **Update Credits** page requires administrator permissions, so the **Log In** page is displayed.</span></span> <span data-ttu-id="c6f61-237">前の手順で作成した管理者アカウントの資格情報を入力します ("admin" と "Pas $ w0rd")。</span><span class="sxs-lookup"><span data-stu-id="c6f61-237">Enter the administrator account credentials that you created earlier ("admin" and "Pas$w0rd").</span></span> <span data-ttu-id="c6f61-238">**[更新プログラムのクレジット]** ページが表示され、前のチュートリアルで作成した管理者アカウントがテスト環境に正しく配置されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-238">The **Update Credits** page is displayed, which verifies that the administrator account that you created in the previous tutorial was correctly deployed to the test environment.</span></span>

<span data-ttu-id="c6f61-239">[![Log_In_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image30.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-239">[![Log_In_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image30.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image29.png)</span></span>

<span data-ttu-id="c6f61-240">[![Update_Credits_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image32.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-240">[![Update_Credits_page_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image32.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image31.png)</span></span>

<span data-ttu-id="c6f61-241">プレースホルダーファイルのみを含む*Elmah*フォルダーが存在することを確認します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-241">Verify that an *Elmah* folder exists with only the placeholder file in it.</span></span>

<span data-ttu-id="c6f61-242">[![Elmah_folder_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image34.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="c6f61-242">[![Elmah_folder_Test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image34.png)](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image33.png)</span></span>

<a id="efcfmigrations"></a>

## <a name="reviewing-the-automatic-webconfig-changes-for-code-first-migrations"></a><span data-ttu-id="c6f61-243">Code First Migrations の web.config の自動変更の確認</span><span class="sxs-lookup"><span data-stu-id="c6f61-243">Reviewing the Automatic Web.config Changes for Code First Migrations</span></span>

<span data-ttu-id="c6f61-244">デプロイされたアプリケーションの*web.config*ファイルを*C:\inetpub\wwwroot\ContosoUniversity*で開き、データベースを最新バージョンに自動的に更新するように配置プロセスが構成さ Code First Migrations れている場所を確認できます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-244">Open the *Web.config* file in the deployed application at *C:\inetpub\wwwroot\ContosoUniversity* and you can see where the deployment process configured Code First Migrations to automatically update the database to the latest version.</span></span>

![](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image35.png)

<span data-ttu-id="c6f61-245">また、配置プロセスでは、データベーススキーマを更新するために排他的に使用する Code First Migrations 用の新しい接続文字列も作成しました。</span><span class="sxs-lookup"><span data-stu-id="c6f61-245">The deployment process also created a new connection string for Code First Migrations to use exclusively for updating the database schema:</span></span>

![DatabasePublish_connection_string](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12/_static/image36.png)

<span data-ttu-id="c6f61-247">この追加の接続文字列を使用すると、データベーススキーマの更新用に1つのユーザーアカウントを指定し、アプリケーションデータアクセスに別のユーザーアカウントを指定することができます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-247">This additional connection string enables you to specify one user account for database schema updates, and a different user account for application data access.</span></span> <span data-ttu-id="c6f61-248">たとえば、db\_所有者ロールを Code First Migrations に割り当て、db\_datareader および db\_datawriter ロールをアプリケーションに割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-248">For example, you could assign the db\_owner role to Code First Migrations, and db\_datareader and db\_datawriter roles to the application.</span></span> <span data-ttu-id="c6f61-249">これは、アプリケーション内の悪意のある可能性のあるコードによってデータベーススキーマが変更されないようにする、一般的な多層防御パターンです。</span><span class="sxs-lookup"><span data-stu-id="c6f61-249">This is a common defense-in-depth pattern that prevents potentially malicious code in the application from changing the database schema.</span></span> <span data-ttu-id="c6f61-250">(たとえば、SQL インジェクション攻撃が成功した場合に発生する可能性があります)。このパターンは、これらのチュートリアルでは使用されません。</span><span class="sxs-lookup"><span data-stu-id="c6f61-250">(For example, this might happen in a successful SQL injection attack.) This pattern is not used by these tutorials.</span></span> <span data-ttu-id="c6f61-251">SQL Server Compact には適用されません。このシリーズの後のチュートリアルで SQL Server に移行するときには適用されません。</span><span class="sxs-lookup"><span data-stu-id="c6f61-251">It does not apply to SQL Server Compact, and it does not apply when you migrate to SQL Server in a later tutorial in this series.</span></span> <span data-ttu-id="c6f61-252">Cytanium サイトには、Cytanium で作成した SQL Server データベースにアクセスするためのユーザーアカウントが1つだけ用意されています。</span><span class="sxs-lookup"><span data-stu-id="c6f61-252">The Cytanium site offers just one user account for accessing the SQL Server database that you create at Cytanium.</span></span> <span data-ttu-id="c6f61-253">シナリオでこのパターンを実装できる場合は、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-253">If you are able to implement this pattern in your scenario, you can do it by performing the following steps:</span></span>

1. <span data-ttu-id="c6f61-254">**Web の発行**ウィザードの **[設定]** タブで、完全なデータベーススキーマ更新権限を持つユーザーを指定する接続文字列を入力し、 **[実行時にこの接続文字列を使用]** する チェックボックスをオフにします。</span><span class="sxs-lookup"><span data-stu-id="c6f61-254">In the **Settings** tab of the **Publish Web** wizard, enter the connection string that specifies a user with full database schema update permissions, and clear the **Use this connection string at runtime** check box.</span></span> <span data-ttu-id="c6f61-255">配置された Web.config ファイルで、これが `DatabasePublish` 接続文字列になります。</span><span class="sxs-lookup"><span data-stu-id="c6f61-255">In the deployed Web.config file, this becomes the `DatabasePublish` connection string.</span></span>
2. <span data-ttu-id="c6f61-256">アプリケーションで実行時に使用する接続文字列の Web.config ファイル変換を作成します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-256">Create a Web.config file transformation for the connection string that you want the application to use at run time.</span></span>

<span data-ttu-id="c6f61-257">これで、開発用コンピューター上の IIS にアプリケーションを配置し、そこでテストしました。</span><span class="sxs-lookup"><span data-stu-id="c6f61-257">You have now deployed your application to IIS on your development computer and tested it there.</span></span> <span data-ttu-id="c6f61-258">これにより、展開プロセスによって、アプリケーションのコンテンツが適切な場所にコピーされているかどうかが確認されます (展開する必要のないファイルは除外されます)。また、展開時に IIS が正しく構成された Web 配置ます。</span><span class="sxs-lookup"><span data-stu-id="c6f61-258">This verifies that the deployment process copied the application's content to the right location (excluding the files that you did not want to deploy), and also that Web Deploy configured IIS correctly during deployment.</span></span> <span data-ttu-id="c6f61-259">次のチュートリアルでは、まだ完了していない配置タスクを検索するテストをもう1つ実行します。これは、 *Elmah*フォルダーのフォルダーアクセス許可の設定です。</span><span class="sxs-lookup"><span data-stu-id="c6f61-259">In the next tutorial, you'll run one more test that finds a deployment task that has not yet been done: setting folder permissions on the *Elmah* folder.</span></span>

## <a name="more-information"></a><span data-ttu-id="c6f61-260">詳細情報</span><span class="sxs-lookup"><span data-stu-id="c6f61-260">More Information</span></span>

<span data-ttu-id="c6f61-261">Visual Studio で IIS または IIS Express を実行する方法の詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-261">For information about running IIS or IIS Express in Visual Studio, see the following resources:</span></span>

- <span data-ttu-id="c6f61-262">IIS.net サイトの[IIS Express の概要](https://www.iis.net/learn/extensions/introduction-to-iis-express/iis-express-overview)。</span><span class="sxs-lookup"><span data-stu-id="c6f61-262">[IIS Express Overview](https://www.iis.net/learn/extensions/introduction-to-iis-express/iis-express-overview) on the IIS.net site.</span></span>
- <span data-ttu-id="c6f61-263">Scott Guthrie のブログで[IIS Express を紹介](https://weblogs.asp.net/scottgu/archive/2010/06/28/introducing-iis-express.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-263">[Introducing IIS Express](https://weblogs.asp.net/scottgu/archive/2010/06/28/introducing-iis-express.aspx) on Scott Guthrie's blog.</span></span>
- <span data-ttu-id="c6f61-264">[方法: Visual Studio で Web プロジェクトの Web サーバーを指定する](https://msdn.microsoft.com/library/ms178108.aspx)</span><span class="sxs-lookup"><span data-stu-id="c6f61-264">[How to: Specify the Web Server for Web Projects in Visual Studio](https://msdn.microsoft.com/library/ms178108.aspx).</span></span>
- <span data-ttu-id="c6f61-265">[IIS と](../deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-cs.md)ASP.NET サイトの ASP.NET 開発サーバーの主な相違点。</span><span class="sxs-lookup"><span data-stu-id="c6f61-265">[Core Differences Between IIS and the ASP.NET Development Server](../deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-cs.md) on the ASP.NET site.</span></span>
- <span data-ttu-id="c6f61-266">Rick Anderson のブログで[、ASP.NET MVC または Web フォームアプリケーションを IIS 7 で30秒以内にテスト](https://blogs.msdn.com/b/rickandy/archive/2011/04/22/test-you-asp-net-mvc-or-webforms-application-on-iis-7-in-30-seconds.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-266">[Test your ASP.NET MVC or Web Forms Application on IIS 7 in 30 seconds](https://blogs.msdn.com/b/rickandy/archive/2011/04/22/test-you-asp-net-mvc-or-webforms-application-on-iis-7-in-30-seconds.aspx) on Rick Anderson's blog.</span></span> <span data-ttu-id="c6f61-267">このエントリでは、Visual Studio 開発サーバー (Cassini) を使用したテストが IIS Express でのテストほど信頼性の低いものではなく、IIS Express でのテストが IIS でのテストほど信頼性がない理由の例を示します。</span><span class="sxs-lookup"><span data-stu-id="c6f61-267">This entry provides examples of why testing with the Visual Studio Development Server (Cassini) is not as reliable as testing in IIS Express, and why testing in IIS Express is not as reliable as testing in IIS.</span></span>

<span data-ttu-id="c6f61-268">アプリケーションが中程度の信頼で実行されている場合に発生する可能性がある問題の詳細については、「Rolla サイトからの4人の[信頼での ASP.NET アプリケーションのホスティング](http://www.4guysfromrolla.com/articles/100307-1.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c6f61-268">For information about what issues might arise when your application runs in medium trust, see [Hosting ASP.NET Applications in Medium Trust](http://www.4guysfromrolla.com/articles/100307-1.aspx) on the 4 Guys from Rolla site.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c6f61-269">[前へ](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md)
> [次へ](deployment-to-a-hosting-provider-setting-folder-permissions-6-of-12.md)</span><span class="sxs-lookup"><span data-stu-id="c6f61-269">[Previous](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md)
[Next](deployment-to-a-hosting-provider-setting-folder-permissions-6-of-12.md)</span></span>
