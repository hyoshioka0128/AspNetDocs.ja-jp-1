---
uid: web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/configuring-permissions-for-team-build-deployment
title: チームビルド配置のアクセス許可を構成する |Microsoft Docs
author: jrjlee
description: このトピックでは、ビルドサーバーが自動 b の一部として web サーバーおよびデータベースサーバーにコンテンツをデプロイできるようにするためのアクセス許可を構成する方法について説明します。
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 2488a91e-b0a8-465a-b874-3233f724b56b
msc.legacyurl: /web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/configuring-permissions-for-team-build-deployment
msc.type: authoredcontent
ms.openlocfilehash: 5699f72af6b8d7f18d1a2c631dfdedd63c66e1e6
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78518506"
---
# <a name="configuring-permissions-for-team-build-deployment"></a><span data-ttu-id="6e87f-103">チーム ビルド配置のアクセス許可を構成する</span><span class="sxs-lookup"><span data-stu-id="6e87f-103">Configuring Permissions for Team Build Deployment</span></span>

<span data-ttu-id="6e87f-104">[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="6e87f-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

<span data-ttu-id="6e87f-105">[[Download PDF]\(PDF をダウンロード\)](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span><span class="sxs-lookup"><span data-stu-id="6e87f-105">[Download PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span></span>

> <span data-ttu-id="6e87f-106">このトピックでは、ビルドサーバーが自動ビルドプロセスの一環として web サーバーおよびデータベースサーバーにコンテンツを配置できるようにするためのアクセス許可を構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-106">This topic describes how to configure permissions to enable your build server to deploy content to web servers and database servers as part of an automated build process.</span></span>

<span data-ttu-id="6e87f-107">このトピックでは、Fabrikam, Inc. という架空の企業のエンタープライズ展開要件に基づいて、一連のチュートリアルの一部を説明します。このチュートリアルシリーズでは、&#x2014; [Contact Manager ソリューション](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;のサンプルソリューションを使用して、ASP.NET MVC 3 アプリケーション、Windows Communication Foundation (WCF) サービス、データベースプロジェクトなど、現実的なレベルの複雑さを持つ web アプリケーションを表します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-107">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="6e87f-108">これらのチュートリアルの中核となる配置方法は、「[プロジェクトファイルについ](../web-deployment-in-the-enterprise/understanding-the-project-file.md)て」で説明されている分割プロジェクトファイルアプローチに基づいています。この&#x2014;プロジェクトファイルには、ビルドプロセスは、すべての変換先環境に適用されるビルド命令を含む2つのプロジェクトファイルと、環境固有のビルドおよび配置設定を含んでいます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-108">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="6e87f-109">ビルド時に、環境固有のプロジェクトファイルが環境に依存しないプロジェクトファイルにマージされ、ビルド命令の完全なセットが形成されます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-109">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="6e87f-110">タスクの概要</span><span class="sxs-lookup"><span data-stu-id="6e87f-110">Task Overview</span></span>

<span data-ttu-id="6e87f-111">Team Foundation Server (TFS) 2010 ビルドサービスをインストールするときに、サービスを実行する id を指定します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-111">When you install the Team Foundation Server (TFS) 2010 build service, you specify the identity with which you want the service to run.</span></span> <span data-ttu-id="6e87f-112">既定では、これは Network Service アカウントです。</span><span class="sxs-lookup"><span data-stu-id="6e87f-112">By default, this is the Network Service account.</span></span> <span data-ttu-id="6e87f-113">または、ドメインアカウントを使用してビルドサービスを実行するように構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-113">Alternatively, you can configure the build service to run using a domain account.</span></span>

<span data-ttu-id="6e87f-114">Windows 認証を必要とし、チームビルドを使用して自動化する予定の展開タスクは、ビルドサービス id を使用して実行されます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-114">Any deployment tasks that require Windows authentication, and that you plan to automate using Team Build, will run using the build service identity.</span></span> <span data-ttu-id="6e87f-115">そのため、web サーバーとデータベースサーバーで必要なアクセス許可をビルドサービス id に付与する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-115">As such, you'll need to grant the build service identity any required permissions on your web servers and your database servers.</span></span>

> [!NOTE]
> <span data-ttu-id="6e87f-116">Network Service アカウントは、コンピューターアカウントを使用して他のコンピューターに対する認証を行います。</span><span class="sxs-lookup"><span data-stu-id="6e87f-116">The Network Service account uses the machine account to authenticate to other computers.</span></span> <span data-ttu-id="6e87f-117">コンピューターアカウントは、\* [ドメイン名]\[マシン名] \* **$** &#x2014;のようになります。たとえば、 **FABRIKAM\TFSBUILD $** です。</span><span class="sxs-lookup"><span data-stu-id="6e87f-117">Machine accounts take the form \*[domain name]\[machine name]\***$**&#x2014;for example, **FABRIKAM\TFSBUILD$**.</span></span> <span data-ttu-id="6e87f-118">そのため、ビルドサービスがネットワークサービス id を使用して実行されている場合は、ビルドサーバーのコンピューターアカウント id に必要なアクセス許可を付与する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-118">As such, if your build service runs using the Network Service identity, you should grant any required permissions to the machine account identity for your build server.</span></span>

## <a name="configuring-web-server-permissions"></a><span data-ttu-id="6e87f-119">Web サーバーのアクセス許可の構成</span><span class="sxs-lookup"><span data-stu-id="6e87f-119">Configuring Web Server Permissions</span></span>

<span data-ttu-id="6e87f-120">「 [Web 配置に適切なアプローチを選択](../configuring-server-environments-for-web-deployment/choosing-the-right-approach-to-web-deployment.md)する」で説明したように、web パッケージをリモート web サーバーに配置する場合は、次の2つの主な方法を使用できます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-120">As described in [Choosing the Right Approach to Web Deployment](../configuring-server-environments-for-web-deployment/choosing-the-right-approach-to-web-deployment.md), there are two main approaches you can use if you want to deploy web packages to a remote web server:</span></span>

- <span data-ttu-id="6e87f-121">移行先サーバーで*Web Deployment Agent サービス*(リモートエージェントとも呼ばれます) を対象にして、リモートの場所からアプリケーションを展開します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-121">Deploy the application from a remote location by targeting the *Web Deployment Agent Service* (also known as the remote agent) on the destination server.</span></span>
- <span data-ttu-id="6e87f-122">移行先サーバーで*インターネットインフォメーションサービス*(*IIS) Web 配置ハンドラー*をターゲットにして、リモートの場所からアプリケーションを展開します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-122">Deploy the application from a remote location by targeting the *Internet Information Services* (*IIS) Web Deploy Handler* on the destination server.</span></span>

<span data-ttu-id="6e87f-123">この場合、リモートエージェントには次の2つの重要な制限があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-123">The remote agent has two key limitations in this case:</span></span>

- <span data-ttu-id="6e87f-124">リモートエージェントは、NTLM 認証のみをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="6e87f-124">The remote agent supports only NTLM authentication.</span></span> <span data-ttu-id="6e87f-125">言い換えると、デプロイでは、別のアカウントを偽装&#x2014;できないビルドサービス id を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-125">In other words, the deployment must use the build service identity&#x2014;you can't impersonate another account.</span></span>
- <span data-ttu-id="6e87f-126">リモートエージェントを使用するには、展開を実行するアカウントが対象サーバーの管理者である必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-126">To use the remote agent, the account that performs the deployment must be an administrator on the target server.</span></span>

<span data-ttu-id="6e87f-127">これらの2つの制限により、自動化されたチームビルドの配置に対してリモートエージェントのアプローチが望ましくないようになります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-127">Together, these two limitations make the remote agent approach undesirable for an automated Team Build deployment.</span></span> <span data-ttu-id="6e87f-128">この方法を使用するには、ビルドサービスアカウントをターゲット web サーバーの管理者にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-128">To use this approach, you'd need to make the build service account an administrator on any target web servers.</span></span>

<span data-ttu-id="6e87f-129">これに対し、Web 配置ハンドラーのアプローチには、次のような利点があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-129">In contrast, the Web Deploy Handler approach offers various advantages:</span></span>

- <span data-ttu-id="6e87f-130">Web 配置ハンドラーは、HTTPS 経由の基本認証をサポートしています。これにより、別のアカウントの資格情報を IIS Web 配置ツール (Web 配置) に渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-130">The Web Deploy Handler supports basic authentication over HTTPS, which allows you to pass the credentials of an alternative account to the IIS Web Deployment Tool (Web Deploy).</span></span>
- <span data-ttu-id="6e87f-131">対象の web サーバーを構成して、管理者以外のユーザーが Web 配置ハンドラーを使用して特定の IIS web サイトにコンテンツを展開できるようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-131">You can configure target web servers to allow non-administrator users to deploy content to specific IIS websites using the Web Deploy Handler.</span></span>

<span data-ttu-id="6e87f-132">そのため、チームビルドから Web パッケージの配置を自動化する場合は、Web 配置ハンドラーを対象にすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="6e87f-132">As a result, it's clearly preferable to target the Web Deploy Handler when you automate web package deployment from Team Build.</span></span> <span data-ttu-id="6e87f-133">これは推奨されるプロセスです。</span><span class="sxs-lookup"><span data-stu-id="6e87f-133">This is the recommended process:</span></span>

1. <span data-ttu-id="6e87f-134">展開に使用する低特権ドメインアカウントを作成します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-134">Create a low-privileged domain account to use for the deployment.</span></span>
2. <span data-ttu-id="6e87f-135">Web 配置ハンドラーを構成し、特定の IIS web サイトにコンテンツを展開するために必要なアクセス許可をアカウントに付与します。詳細については、「 [Web サーバーを Web 配置発行用に構成する (Web 配置ハンドラー)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e87f-135">Configure the Web Deploy Handler and grant the account the required permissions to deploy content to a specific IIS website, as described in [Configuring a Web Server for Web Deploy Publishing (Web Deploy Handler)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md).</span></span>
3. <span data-ttu-id="6e87f-136">基本認証を使用し、作成したドメインアカウントの資格情報を指定して、デプロイを実行するために、Web 配置を呼び出し、Web 配置ハンドラーをターゲットにします。</span><span class="sxs-lookup"><span data-stu-id="6e87f-136">Invoke Web Deploy and target the Web Deploy Handler, using basic authentication and supplying the credentials of the domain account you created, to perform the deployment.</span></span>

<span data-ttu-id="6e87f-137">[Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)サンプルソリューションでは、認証の種類 (基本または NTLM)、Web 配置の資格情報、および環境固有のプロジェクトファイル内のエンドポイントアドレス (リモートエージェントまたは Web 配置ハンドラー) を指定します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-137">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, you specify the authentication type (basic or NTLM), the Web Deploy credentials, and the endpoint address (remote agent or Web Deploy Handler) in the environment-specific project file.</span></span> <span data-ttu-id="6e87f-138">これらの値は、プロジェクトファイルの実行時に Web 配置コマンドを策定して実行するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-138">These values are used to formulate and run a Web Deploy command when the project file is executed.</span></span> <span data-ttu-id="6e87f-139">詳細については、「 [Web パッケージの配置](../web-deployment-in-the-enterprise/deploying-web-packages.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e87f-139">For more information, see [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="6e87f-140">アクセス許可の構成方法など、Web 配置ハンドラーの構成の詳細については、「 [Web 配置発行用の Web サーバーの構成 (Web 配置ハンドラー)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e87f-140">For more information on configuring the Web Deploy Handler, including how to configure permissions, see [Configuring a Web Server for Web Deploy Publishing (Web Deploy Handler)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-web-deploy-handler.md).</span></span> <span data-ttu-id="6e87f-141">リモートエージェントの構成の詳細については、「 [Web 配置の発行用の Web サーバーの構成 (リモートエージェント)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-remote-agent.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e87f-141">For more information on configuring the remote agent, see [Configuring a Web Server for Web Deploy Publishing (Remote Agent)](../configuring-server-environments-for-web-deployment/configuring-a-web-server-for-web-deploy-publishing-remote-agent.md).</span></span>

## <a name="configuring-database-server-permissions"></a><span data-ttu-id="6e87f-142">データベースサーバーのアクセス許可の構成</span><span class="sxs-lookup"><span data-stu-id="6e87f-142">Configuring Database Server Permissions</span></span>

<span data-ttu-id="6e87f-143">SQL Server にデータベースを配置するには、次のことを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-143">To deploy a database to SQL Server, you must:</span></span>

- <span data-ttu-id="6e87f-144">SQL Server インスタンスに展開するアカウントのログインを作成します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-144">Create a login for the deploying account on the SQL Server instance.</span></span>
- <span data-ttu-id="6e87f-145">SQL Server インスタンスに対して、ログインの**DBCreator**権限を付与します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-145">Grant the login **DBCreator** permissions on the SQL Server instance.</span></span>
- <span data-ttu-id="6e87f-146">初期デプロイ後に、ターゲットデータベースの**db\_所有者**ロールにログインを追加します。</span><span class="sxs-lookup"><span data-stu-id="6e87f-146">After the initial deployment, add the login to the **db\_owner** role on the target database.</span></span> <span data-ttu-id="6e87f-147">これは、後続の配置では、新しいデータベースを作成するのではなく、既存のデータベースを変更するために必要です。</span><span class="sxs-lookup"><span data-stu-id="6e87f-147">This is required because on subsequent deployments, you're modifying an existing database rather than creating a new database.</span></span>

<span data-ttu-id="6e87f-148">NTLM 認証または SQL Server 認証を使用して、SQL Server インスタンスに対する認証を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-148">You can authenticate to a SQL Server instance using either NTLM authentication or SQL Server authentication:</span></span>

- <span data-ttu-id="6e87f-149">NTLM 認証を使用する場合は、上記で説明したアクセス許可をビルドサービスアカウントに付与する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-149">If you use NTLM authentication, you need to grant the permissions described above to the build service account.</span></span>
- <span data-ttu-id="6e87f-150">SQL Server 認証を使用する場合は、前に説明したアクセス許可を SQL Server アカウントに付与する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-150">If you use SQL Server authentication, you need to grant the permissions described above to the SQL Server account.</span></span> <span data-ttu-id="6e87f-151">また、データベースの配置に使用する接続文字列に SQL Server のユーザー名とパスワードを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-151">You also need to include the SQL Server user name and password in the connection string you use to deploy the database.</span></span>

<span data-ttu-id="6e87f-152">データベース配置のアクセス許可を構成する方法の詳細な手順については、「 [Web 配置発行用のデータベースサーバーの構成](../configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e87f-152">For step-by-step details on how to configure permissions for database deployment, see [Configuring a Database Server for Web Deploy Publishing](../configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="6e87f-153">まとめ</span><span class="sxs-lookup"><span data-stu-id="6e87f-153">Conclusion</span></span>

<span data-ttu-id="6e87f-154">この時点で、チームビルドから web アプリケーションとデータベースの配置を自動化するときに、必要なアクセス許可と、開いている認証オプションを理解しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="6e87f-154">At this point, you should understand the permissions required, together with the authentication options open to you, when you automate web application and database deployments from Team Build.</span></span> <span data-ttu-id="6e87f-155">また、IIS web サーバーおよび SQL Server データベースサーバーに対して必要なアクセス許可を実装することもできます。</span><span class="sxs-lookup"><span data-stu-id="6e87f-155">You should also be able to implement the necessary permissions on IIS web servers and SQL Server database servers.</span></span>

## <a name="further-reading"></a><span data-ttu-id="6e87f-156">参考資料</span><span class="sxs-lookup"><span data-stu-id="6e87f-156">Further Reading</span></span>

<span data-ttu-id="6e87f-157">リモート展開をサポートするように Windows server 環境を構成する方法の詳細については、「 [Web 配置用のサーバー環境の構成](../configuring-server-environments-for-web-deployment/configuring-server-environments-for-web-deployment.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="6e87f-157">For more information on configuring Windows server environments to support remote deployment, see [Configuring Server Environments for Web Deployment](../configuring-server-environments-for-web-deployment/configuring-server-environments-for-web-deployment.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6e87f-158">[[戻る]](deploying-a-specific-build.md)</span><span class="sxs-lookup"><span data-stu-id="6e87f-158">[Previous](deploying-a-specific-build.md)</span></span>
