---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: データベースプロジェクトの配置 |Microsoft Docs
author: jrjlee
description: '注: 多くのエンタープライズ展開シナリオでは、配置されたデータベースに増分更新を発行する機能が必要です。 もう1つの方法は、再作成することです。'
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: 221808758492aedb8e8329364e511df28fd11105
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78514942"
---
# <a name="deploying-database-projects"></a><span data-ttu-id="ea0b6-104">データベース プロジェクトを配置する</span><span class="sxs-lookup"><span data-stu-id="ea0b6-104">Deploying Database Projects</span></span>

<span data-ttu-id="ea0b6-105">[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="ea0b6-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

<span data-ttu-id="ea0b6-106">[[Download PDF]\(PDF をダウンロード\)](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span><span class="sxs-lookup"><span data-stu-id="ea0b6-106">[Download PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span></span>

> [!NOTE]
> <span data-ttu-id="ea0b6-107">多くのエンタープライズ展開シナリオでは、配置されたデータベースに増分更新を発行する機能が必要です。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-107">In lots of enterprise deployment scenarios, you need the ability to publish incremental updates to a deployed database.</span></span> <span data-ttu-id="ea0b6-108">別の方法として、すべての配置でデータベースを再作成する方法があります。これは、既存のデータベース内のデータが失われることを意味します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-108">The alternative is to recreate the database on every deployment, which means you lose any data in the existing database.</span></span> <span data-ttu-id="ea0b6-109">Visual Studio 2010 を使用する場合、データベースの増分公開には VSDBCMD を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-109">When you work with Visual Studio 2010, using VSDBCMD is the recommended approach to incremental database publishing.</span></span> <span data-ttu-id="ea0b6-110">ただし、次のバージョンの Visual Studio と Web 発行パイプライン (WPP) には、増分発行を直接サポートするツールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-110">However, the next version of Visual Studio and the Web Publishing Pipeline (WPP) will include tooling that supports incremental publishing directly.</span></span>

<span data-ttu-id="ea0b6-111">Visual Studio 2010 で Contact Manager サンプルソリューションを開くと、4つのファイルを含む Properties フォルダーがデータベースプロジェクトに含まれていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-111">If you open the Contact Manager sample solution in Visual Studio 2010, you'll see that the database project includes a Properties folder that contains four files.</span></span>

![](deploying-database-projects/_static/image1.png)

<span data-ttu-id="ea0b6-112">プロジェクトファイル (この場合は*Contactmanager. Database. .dbproj* ) と共に、これらのファイルはビルドと配置のプロセスのさまざまな側面を制御します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-112">Together with the project file (*ContactManager.Database.dbproj* in this case), these files control various aspects of the build and deployment process:</span></span>

- <span data-ttu-id="ea0b6-113">プロジェクトを配置するときに使用する SQLCMD 変数の値は、*データベースの sqlcmdvars*ファイルによって提供されます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-113">The *Database.sqlcmdvars* file provides values for any SQLCMD variables you use when you deploy the project.</span></span> <span data-ttu-id="ea0b6-114">各ソリューション構成 (デバッグやリリースなど) では、別の sqlcmdvars ファイルを指定できます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-114">Each solution configuration (for example, debug and release) can specify a different .sqlcmdvars file.</span></span>
- <span data-ttu-id="ea0b6-115">*データベースの sqldeployment*ファイルは、プロジェクトで定義されている照合順序を使用するか、移行先サーバーの照合順序を使用するか、移行先データベースを毎回再作成するか、既存のデータベースを修正して最新の状態にするかなど、配置固有の設定を提供します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-115">The *Database.sqldeployment* file provides deployment-specific settings, like whether to use the collation defined in your project or the collation of the destination server, whether to recreate the destination database every time or simply amend the existing database to bring it up to date, and so on.</span></span> <span data-ttu-id="ea0b6-116">各ソリューション構成では、別の sqldeployment ファイルを指定できます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-116">Each solution configuration can specify a different .sqldeployment file.</span></span>
- <span data-ttu-id="ea0b6-117">*データベースの sqlpermissions*ファイルは、ターゲットデータベースに追加する権限を定義するために使用できる XML ドキュメントです。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-117">The *Database.sqlpermissions* file is an XML document that you can use to define any permissions you want to add to the target database.</span></span> <span data-ttu-id="ea0b6-118">すべてのソリューション構成は、同じ sqlpermissions ファイルを共有します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-118">All solution configurations share the same .sqlpermissions file.</span></span>
- <span data-ttu-id="ea0b6-119">データベースの*sqlsettings*ファイルでは、使用する照合順序、比較演算子の動作など、データベースの作成時に使用するデータベースレベルのプロパティを指定します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-119">The *Database.sqlsettings* file specifies the database-level properties to use when creating the database, like the collation to use, the behavior of comparison operators, and so on.</span></span> <span data-ttu-id="ea0b6-120">すべてのソリューション構成は、同じ sqlsettings ファイルを共有します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-120">All solution configurations share the same .sqlsettings file.</span></span>

<span data-ttu-id="ea0b6-121">これらのファイルを Visual Studio で開いて、内容を理解しておくことができます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-121">It's worth taking a moment to open these files in Visual Studio and familiarize yourself with the contents.</span></span>

<span data-ttu-id="ea0b6-122">データベースプロジェクトをビルドすると、ビルドプロセスによって次の2つのファイルが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-122">When you build a database project, the build process creates two files:</span></span>

- <span data-ttu-id="ea0b6-123">*データベーススキーマ*(.dbschema ファイル)。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-123">A *database schema* (.dbschema file).</span></span> <span data-ttu-id="ea0b6-124">ここでは、XML 形式で作成するデータベースのスキーマについて説明します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-124">This describes the schema of the database you want to create in XML format.</span></span>
- <span data-ttu-id="ea0b6-125">*配置マニフェスト*(deploymanifest ファイル)。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-125">A *deployment manifest* (.deploymanifest file).</span></span> <span data-ttu-id="ea0b6-126">これには、データベースを作成および配置するために必要なすべての情報が含まれます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-126">This contains all the information required to create and deploy your database.</span></span> <span data-ttu-id="ea0b6-127">これは、配置手順 (sqldeployment ファイル) や配置前または配置後の SQL スクリプトなど、その他のリソースと共に、.dbschema ファイルを参照します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-127">It references the .dbschema file along with other resources, like the deployment instructions (the .sqldeployment file) and any pre-deployment or post-deployment SQL scripts.</span></span>

<span data-ttu-id="ea0b6-128">これは、次のリソース間の関係を示しています。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-128">This shows the relationship between these resources:</span></span>

![](deploying-database-projects/_static/image2.png)

<span data-ttu-id="ea0b6-129">ご覧のように、sqlsettings ファイルと、sqlsettings ファイルはビルドプロセスへの入力です。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-129">As you can see, the .sqlsettings file and the .sqlpermissions file are inputs to the build process.</span></span> <span data-ttu-id="ea0b6-130">データベースプロジェクトファイルと共に、これらのファイルを使用してデータベーススキーマファイルが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-130">Along with the database project file, these files are used to create the database schema file.</span></span> <span data-ttu-id="ea0b6-131">Sqldeployment ファイルと、sqlcmdvar ファイルは、ビルドプロセスを変更せずに渡します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-131">The .sqldeployment file and the .sqlcmdvars file pass through the build process unchanged.</span></span> <span data-ttu-id="ea0b6-132">配置マニフェストは、データベーススキーマの場所、sqldeployment ファイル、sqlcmdvar ファイル、および配置前または配置後 SQL スクリプトの場所を示します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-132">The deployment manifest indicates the location of the database schema, the .sqldeployment file, the .sqlcmdvars file, and any pre-deployment or post-deployment SQL scripts.</span></span>

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a><span data-ttu-id="ea0b6-133">VSDBCMD を使用してデータベースプロジェクトを配置する理由</span><span class="sxs-lookup"><span data-stu-id="ea0b6-133">Why Use VSDBCMD to Deploy a Database Project?</span></span>

<span data-ttu-id="ea0b6-134">データベースプロジェクトを配置するには、さまざまな方法があります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-134">There are various different approaches to deploying database projects.</span></span> <span data-ttu-id="ea0b6-135">ただし、エンタープライズ環境でリモートサーバーにデータベースプロジェクトを配置する場合は、これらのすべてが適しているわけではありません。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-135">However, not all of them are suitable for deploying a database project to remote servers in an enterprise environment.</span></span> <span data-ttu-id="ea0b6-136">データベースプロジェクトの配置から必要なものを検討してください。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-136">Consider what you want from a database project deployment.</span></span> <span data-ttu-id="ea0b6-137">エンタープライズ展開シナリオでは、次のことが必要になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-137">In enterprise deployment scenarios, you're likely to want:</span></span>

- <span data-ttu-id="ea0b6-138">リモートの場所からデータベースプロジェクトを配置する権限。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-138">The ability to deploy the database project from a remote location.</span></span>
- <span data-ttu-id="ea0b6-139">既存のデータベースに対して増分更新を行う機能。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-139">The ability to make incremental updates to an existing database.</span></span>
- <span data-ttu-id="ea0b6-140">配置前スクリプトまたは配置後スクリプトを含める機能。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-140">The ability to include pre-deployment scripts or post-deployment scripts.</span></span>
- <span data-ttu-id="ea0b6-141">配置を複数の配置先環境に合わせて調整する機能。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-141">The ability to tailor the deployment to multiple destination environments.</span></span>
- <span data-ttu-id="ea0b6-142">大規模でスクリプト化された、単一ステップのソリューション配置の一部としてデータベースプロジェクトを配置する機能。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-142">The ability to deploy the database project as part of a larger, typically scripted, single-step solution deployment.</span></span>

<span data-ttu-id="ea0b6-143">データベースプロジェクトを配置するには、主に次の3つの方法を使用します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-143">There are three main approaches you can use to deploy a database project:</span></span>

- <span data-ttu-id="ea0b6-144">Visual Studio 2010 では、データベースプロジェクトの種類と共に配置機能を使用できます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-144">You can use the deployment functionality with the database project type in Visual Studio 2010.</span></span> <span data-ttu-id="ea0b6-145">Visual Studio 2010 でデータベースプロジェクトをビルドして配置すると、配置プロセスでは、配置マニフェストを使用して、ビルド構成に固有の SQL ベースの配置ファイルが生成されます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-145">When you build and deploy a database project in Visual Studio 2010, the deployment process uses the deployment manifest to generate a SQL-based deployment file specific to the build configuration.</span></span> <span data-ttu-id="ea0b6-146">データベースがまだ存在しない場合は作成され、既に存在する場合はデータベースに必要な変更を加えます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-146">This will create the database if it doesn't already exist or make any necessary changes to the database if it does already exist.</span></span> <span data-ttu-id="ea0b6-147">このファイルは、SQLCMD を使用して移行先サーバーで実行できます。また、ファイルを作成して実行するように Visual Studio を設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-147">You can use SQLCMD.exe to run this file on your destination server, or you can set Visual Studio to create and run the file.</span></span> <span data-ttu-id="ea0b6-148">この方法の欠点は、展開設定の制御が制限されていることです。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-148">The disadvantage of this approach is that you have only limited control over the deployment settings.</span></span> <span data-ttu-id="ea0b6-149">また、場合によっては、環境固有の変数値を提供するために、SQL 配置ファイルを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-149">You may often also need to modify the SQL deployment file to provide environment-specific variable values.</span></span> <span data-ttu-id="ea0b6-150">このアプローチは、Visual Studio 2010 がインストールされているコンピューターからのみ使用できます。開発者は、すべての接続先環境の接続文字列と資格情報を把握し、提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-150">You can only use this approach from a computer with Visual Studio 2010 installed, and the developer would need to know and provide connection strings and credentials for all destination environments.</span></span>
- <span data-ttu-id="ea0b6-151">インターネットインフォメーションサービス (IIS) Web 配置ツール (Web 配置) を使用して、 [web アプリケーションプロジェクトの一部としてデータベースを配置](https://msdn.microsoft.com/library/dd465343.aspx)できます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-151">You can use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to [deploy a database as part of a web application project](https://msdn.microsoft.com/library/dd465343.aspx).</span></span> <span data-ttu-id="ea0b6-152">ただし、この方法は、移行先サーバーに既存のローカルデータベースをレプリケートするだけではなく、データベースプロジェクトを配置する場合に、はるかに複雑になります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-152">However, this approach is a lot more complex if you want to deploy a database project rather than simply replicate an existing local database on a destination server.</span></span> <span data-ttu-id="ea0b6-153">データベースプロジェクトによって生成される SQL 配置スクリプトを実行するように Web 配置を構成できますが、そのためには、Web アプリケーションプロジェクト用のカスタムの WPP ターゲットファイルを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-153">You can configure Web Deploy to run the SQL deployment script that the database project generates, but in order to do this, you need to create a custom WPP targets file for your web application project.</span></span> <span data-ttu-id="ea0b6-154">これにより、展開プロセスの複雑さが大幅に増加します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-154">This adds a substantial amount of complexity to the deployment process.</span></span> <span data-ttu-id="ea0b6-155">また、Web 配置は、既存のデータベースの増分更新を直接サポートしません。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-155">In addition, Web Deploy does not directly support incremental updates to existing databases.</span></span> <span data-ttu-id="ea0b6-156">この方法の詳細については、「 [Web 発行パイプラインのパッケージデータベースプロジェクトの配置 SQL ファイルへの拡張](https://go.microsoft.com/?linkid=9805121)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-156">For more information on this approach, see [Extending the Web Publishing Pipeline to package database project deployed SQL file](https://go.microsoft.com/?linkid=9805121).</span></span>
- <span data-ttu-id="ea0b6-157">データベーススキーマまたは配置マニフェストのいずれかを使用して、VSDBCMD ユーティリティを使用してデータベースを配置できます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-157">You can use the VSDBCMD utility to deploy the database, using either the database schema or the deployment manifest.</span></span> <span data-ttu-id="ea0b6-158">MSBuild ターゲットから VSDBCMD を呼び出すことができます。これにより、スクリプト化された大規模な配置プロセスの一部としてデータベースをパブリッシュできます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-158">You can call VSDBCMD.exe from an MSBuild target, which lets you publish databases as part of a larger, scripted deployment process.</span></span> <span data-ttu-id="ea0b6-159">VSDBCMD コマンドでは、sqlcmdvars ファイル内の変数とその他の多くのデータベースプロパティをオーバーライドできます。これにより、複数のビルド構成を作成することなく、さまざまな環境の配置をカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-159">You can override the variables in your .sqlcmdvars file and lots of other database properties from a VSDBCMD command, which allows you to customize your deployment for different environments without creating multiple build configurations.</span></span> <span data-ttu-id="ea0b6-160">VSDBCMD は、区別機能を提供します。これは、対象データベースをデータベーススキーマに合わせるために必要な変更のみを行うことを意味します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-160">VSDBCMD provides differentiation functionality, which means it will make only the necessary changes to align a destination database with your database schema.</span></span> <span data-ttu-id="ea0b6-161">また、VSDBCMD にはさまざまなコマンドラインオプションが用意されており、展開プロセスをきめ細かく制御することができます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-161">VSDBCMD also offers a wide range of command-line options, which give you fine-grained control over the deployment process.</span></span>

<span data-ttu-id="ea0b6-162">この概要から、MSBuild で VSDBCMD を使用することは、一般的なエンタープライズ展開シナリオに最適なアプローチであることがわかります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-162">From this overview, you can see that using VSDBCMD with MSBuild is the approach best suited to a typical enterprise deployment scenario:</span></span>

|  | <span data-ttu-id="ea0b6-163">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="ea0b6-163">Visual Studio 2010</span></span> | <span data-ttu-id="ea0b6-164">Web Deploy 2.0</span><span class="sxs-lookup"><span data-stu-id="ea0b6-164">Web Deploy 2.0</span></span> | <span data-ttu-id="ea0b6-165">VSDBCMD.exe</span><span class="sxs-lookup"><span data-stu-id="ea0b6-165">VSDBCMD.exe</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="ea0b6-166">リモート展開をサポートしますか?</span><span class="sxs-lookup"><span data-stu-id="ea0b6-166">Supports remote deployment?</span></span> | <span data-ttu-id="ea0b6-167">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-167">Yes</span></span> | <span data-ttu-id="ea0b6-168">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-168">Yes</span></span> | <span data-ttu-id="ea0b6-169">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-169">Yes</span></span> |
| <span data-ttu-id="ea0b6-170">増分更新をサポートしていますか?</span><span class="sxs-lookup"><span data-stu-id="ea0b6-170">Supports incremental updates?</span></span> | <span data-ttu-id="ea0b6-171">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-171">Yes</span></span> | <span data-ttu-id="ea0b6-172">いいえ</span><span class="sxs-lookup"><span data-stu-id="ea0b6-172">No</span></span> | <span data-ttu-id="ea0b6-173">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-173">Yes</span></span> |
| <span data-ttu-id="ea0b6-174">配置前または配置後のスクリプトをサポートしていますか?</span><span class="sxs-lookup"><span data-stu-id="ea0b6-174">Supports pre/post-deployment scripts?</span></span> | <span data-ttu-id="ea0b6-175">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-175">Yes</span></span> | <span data-ttu-id="ea0b6-176">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-176">Yes</span></span> | <span data-ttu-id="ea0b6-177">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-177">Yes</span></span> |
| <span data-ttu-id="ea0b6-178">複数環境のデプロイはサポートされていますか?</span><span class="sxs-lookup"><span data-stu-id="ea0b6-178">Supports multi-environment deployment?</span></span> | <span data-ttu-id="ea0b6-179">制限あり</span><span class="sxs-lookup"><span data-stu-id="ea0b6-179">Limited</span></span> | <span data-ttu-id="ea0b6-180">制限あり</span><span class="sxs-lookup"><span data-stu-id="ea0b6-180">Limited</span></span> | <span data-ttu-id="ea0b6-181">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-181">Yes</span></span> |
| <span data-ttu-id="ea0b6-182">スクリプト化された展開をサポートしますか。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-182">Supports scripted deployment?</span></span> | <span data-ttu-id="ea0b6-183">制限あり</span><span class="sxs-lookup"><span data-stu-id="ea0b6-183">Limited</span></span> | <span data-ttu-id="ea0b6-184">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-184">Yes</span></span> | <span data-ttu-id="ea0b6-185">はい</span><span class="sxs-lookup"><span data-stu-id="ea0b6-185">Yes</span></span> |

<span data-ttu-id="ea0b6-186">このトピックの残りの部分では、VSDBCMD と MSBuild を使用してデータベースプロジェクトを配置する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-186">The remainder of this topic describes the use of VSDBCMD with MSBuild to deploy database projects.</span></span>

## <a name="understanding-the-deployment-process"></a><span data-ttu-id="ea0b6-187">デプロイプロセスについて</span><span class="sxs-lookup"><span data-stu-id="ea0b6-187">Understanding the Deployment Process</span></span>

<span data-ttu-id="ea0b6-188">VSDBCMD ユーティリティを使用すると、データベーススキーマ (.dbschema ファイル) または配置マニフェスト (deploymanifest ファイル) のいずれかを使用してデータベースを配置できます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-188">The VSDBCMD utility lets you deploy a database using either the database schema (the .dbschema file) or the deployment manifest (the .deploymanifest file).</span></span> <span data-ttu-id="ea0b6-189">実際には、配置マニフェストを使用して、さまざまな配置プロパティの既定値を指定し、実行する配置前または配置後の SQL スクリプトを特定できるため、ほとんどの場合、配置マニフェストを使用します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-189">In practice, you'll almost always use the deployment manifest, as the deployment manifest lets you provide default values for various deployment properties and identify any pre-deployment or post-deployment SQL scripts you want to run.</span></span> <span data-ttu-id="ea0b6-190">たとえば、次の VSDBCMD コマンドは、テスト環境で**Contactmanager**データベースをデータベースサーバーに配置するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-190">For example, this VSDBCMD command is used to deploy the **ContactManager** database to a database server in a test environment:</span></span>

[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]

<span data-ttu-id="ea0b6-191">この場合、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-191">In this case:</span></span>

- <span data-ttu-id="ea0b6-192">**/A** (または **/Action**) スイッチは、VSDBCMD を実行する対象を指定します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-192">The **/a** (or **/Action**) switch specifies what you want VSDBCMD to do.</span></span> <span data-ttu-id="ea0b6-193">これを**インポート**または**配置**するように設定できます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-193">You can set this to **Import** or **Deploy**.</span></span> <span data-ttu-id="ea0b6-194">**インポート**オプションは、既存のデータベースから .dbschema ファイルを生成するために使用されます。また、**配置**オプションを使用して、.dbschema ファイルを対象のデータベースに配置します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-194">The **Import** option is used to generate a .dbschema file from an existing database, and the **Deploy** option is used to deploy a .dbschema file to a target database.</span></span>
- <span data-ttu-id="ea0b6-195">**/マニフェスト**(または **/manifestfile**) スイッチは、配置する deploymanifest ファイルを識別します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-195">The **/manifest** (or **/ManifestFile**) switch identifies the .deploymanifest file you want to deploy.</span></span> <span data-ttu-id="ea0b6-196">代わりに、そのような .dbschema ファイルを使用する場合は、 **/モデル**(または **/modelfile**) スイッチを使用します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-196">If you wanted to use the .dbschema file instead, you'd use the **/model** (or **/ModelFile**) switch.</span></span>
- <span data-ttu-id="ea0b6-197">**/Cs** (または **/ConnectionString**) スイッチは、ターゲットデータベースサーバーの接続文字列を提供します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-197">The **/cs** (or **/ConnectionString**) switch provides the connection string for the target database server.</span></span> <span data-ttu-id="ea0b6-198">これには、データベースを作成するために&#x2014;サーバーに接続する必要がある VSDBCMD データベースの名前は含まれないことに注意してください。個々のデータベースに接続する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-198">Note that this doesn't include the name of the database&#x2014;VSDBCMD needs to connect to the server to create the database; it doesn't need to connect to an individual database.</span></span> <span data-ttu-id="ea0b6-199">Deploymanifest ファイルに接続文字列が含まれている場合は、このスイッチを省略できます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-199">If your .deploymanifest file includes a connection string, you can omit this switch.</span></span> <span data-ttu-id="ea0b6-200">スイッチを使用すると、スイッチの値によって、deploymanifest 値がオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-200">If you use the switch anyway, the switch value will override the .deploymanifest value.</span></span>
- <span data-ttu-id="ea0b6-201"><strong>/P: targetdatabase</strong>プロパティは、作成時にターゲットデータベースに割り当てる名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-201">The <strong>/p:TargetDatabase</strong> property provides the name you want to assign to the target database on creation.</span></span> <span data-ttu-id="ea0b6-202">これにより、deploymanifest ファイルの<strong>Targetdatabase</strong>プロパティの値がオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-202">This overrides the value of the <strong>TargetDatabase</strong> property in the .deploymanifest file.</span></span> <span data-ttu-id="ea0b6-203"><strong>/P:</strong> <em>[property name]</em>構文を使用すると、さまざまな配置プロパティを設定し、sqlcmdvars ファイルで宣言されているすべての SQLCMD 変数をオーバーライドできます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-203">You can use the <strong>/p:</strong> <em>[property name]</em>syntax to set a wide variety of deployment properties and to override any SQLCMD variables declared in your .sqlcmdvars file.</span></span>
- <span data-ttu-id="ea0b6-204">**/Dd +** (または **/deploytodatabase +** ) スイッチは、デプロイを作成し、ターゲット環境に配置することを示します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-204">The **/dd+** (or **/DeployToDatabase+**) switch indicates that you want to create a deployment and deploy it to the target environment.</span></span> <span data-ttu-id="ea0b6-205">**/Dd-** を指定した場合、またはスイッチを省略した場合は、VSDBCMD によって配置スクリプトが生成されますが、ターゲット環境には配置されません。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-205">If you specify **/dd-**, or omit the switch, VSDBCMD will generate a deployment script but will not deploy it to the target environment.</span></span> <span data-ttu-id="ea0b6-206">多くの場合、このスイッチは混乱の原因となります。詳細については、次のセクションで説明します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-206">This switch is often the source of confusion and is explained in more detail in the next section.</span></span>
- <span data-ttu-id="ea0b6-207">**/Script** (または **/DeploymentScriptFile**) スイッチは、配置スクリプトを生成する場所を指定します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-207">The **/script** (or **/DeploymentScriptFile**) switch specifies where you want to generate the deployment script.</span></span> <span data-ttu-id="ea0b6-208">この値は、デプロイプロセスには影響しません。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-208">This value does not affect the deployment process.</span></span>

<span data-ttu-id="ea0b6-209">VSDBCMD の詳細については、「 [VSDBCMD のコマンドラインリファレンス」を参照してください。EXE (配置とスキーマのインポート)](https://msdn.microsoft.com/library/dd193283.aspx)および[方法: VSDBCMD を使用して、コマンドプロンプトから配置するデータベースを準備します。EXE](https://msdn.microsoft.com/library/dd193258.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-209">For more information on VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span></span>

<span data-ttu-id="ea0b6-210">MSBuild プロジェクトファイルから VSDBCMD を使用する方法の例については、「[ビルドプロセスについ](understanding-the-build-process.md)て」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-210">For an example of how you can use VSDBCMD from an MSBuild project file, see [Understanding the Build Process](understanding-the-build-process.md).</span></span> <span data-ttu-id="ea0b6-211">複数の環境のデータベース配置設定を構成する方法の例については、「[複数の環境でのデータベース配置のカスタマイズ](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-211">For examples of how to configure database deployment settings for multiple environments, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="understanding-the-deploytodatabase-switch"></a><span data-ttu-id="ea0b6-212">DeployToDatabase スイッチについて</span><span class="sxs-lookup"><span data-stu-id="ea0b6-212">Understanding the DeployToDatabase Switch</span></span>

<span data-ttu-id="ea0b6-213">**/Dd**または **/deploytodatabase**スイッチの動作は、VSDBCMD を .dbschema ファイルと共に使用するか、または deploymanifest ファイルと共に使用するかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-213">The behavior of the **/dd** or **/DeployToDatabase** switch depends on whether you're using VSDBCMD with a .dbschema file or a .deploymanifest file.</span></span> <span data-ttu-id="ea0b6-214">.Dbschema ファイルを使用している場合、動作は非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-214">If you're using a .dbschema file, the behavior is fairly straightforward:</span></span>

- <span data-ttu-id="ea0b6-215">**/Dd +** または **/dd**を指定すると、VSDBCMD によって配置スクリプトが生成され、データベースが配置されます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-215">If you specify **/dd+** or **/dd**, VSDBCMD will generate a deployment script and deploy the database.</span></span>
- <span data-ttu-id="ea0b6-216">**/Ddを**指定した場合、またはスイッチを省略した場合、VSDBCMD では配置スクリプトのみが生成されます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-216">If you specify **/dd-** or omit the switch, VSDBCMD will generate a deployment script only.</span></span>

<span data-ttu-id="ea0b6-217">Deploymanifest ファイルを使用している場合、動作ははるかに複雑になります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-217">If you're using a .deploymanifest file, the behavior is a lot more complicated.</span></span> <span data-ttu-id="ea0b6-218">これは、deploymanifest ファイルに、データベースが配置されているかどうかも確認するプロパティ名**Deploytodatabase**が含まれているためです。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-218">This is because the .deploymanifest file contains a property name **DeployToDatabase** that also determines whether the database is deployed.</span></span>

[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]

<span data-ttu-id="ea0b6-219">このプロパティの値は、データベースプロジェクトのプロパティに従って設定されます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-219">The value of this property is set according to the properties of the database project.</span></span> <span data-ttu-id="ea0b6-220">配置**スクリプト (.sql) を作成**するように**配置アクション**を設定した場合、値は**False**になります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-220">If you set the **Deploy action** to **Create a deployment script (.sql)**, the value will be **False**.</span></span> <span data-ttu-id="ea0b6-221">配置**スクリプト (.sql) を作成してデータベースに配置**するように**配置アクション**を設定した場合、値は**True**になります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-221">If you set the **Deploy action** to **Create a deployment script (.sql) and deploy to the database**, the value will be **True**.</span></span>

> [!NOTE]
> <span data-ttu-id="ea0b6-222">これらの設定は、特定のビルド構成およびプラットフォームに関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-222">These settings are associated with a specific build configuration and platform.</span></span> <span data-ttu-id="ea0b6-223">たとえば、**デバッグ**構成の設定を構成してから、**リリース**構成を使用して発行すると、設定は使用されません。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-223">For example, if you configure settings for the **Debug** configuration and then publish using the **Release** configuration, your settings will not be used.</span></span>

![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> <span data-ttu-id="ea0b6-224">このシナリオでは、Visual Studio 2010 でデータベースを配置しないようにするため、配置**アクション** **(.Sql) を作成**するように常に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-224">In this scenario, the **Deploy action** should always be set to **Create a deployment script (.sql)**, because you don't want Visual Studio 2010 to deploy your database.</span></span> <span data-ttu-id="ea0b6-225">つまり、 **Deploytodatabase**プロパティは常に**False**である必要があります。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-225">In other words, the **DeployToDatabase** property should always be **False**.</span></span>

<span data-ttu-id="ea0b6-226">**Deploytodatabase**プロパティを指定すると、プロパティ値が**false**の場合にのみ、 **/dd**スイッチでプロパティがオーバーライドされます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-226">When a **DeployToDatabase** property is specified, the **/dd** switch will only override the property if the property value is **false**:</span></span>

- <span data-ttu-id="ea0b6-227">**Deploytodatabase**プロパティが**False**の場合に、 **/dd +** または **/dd**を指定すると、VSDBCMD は**deploytodatabase**プロパティをオーバーライドし、データベースを配置します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-227">If the **DeployToDatabase** property is **False**, and you specify **/dd+** or **/dd**, VSDBCMD will override the **DeployToDatabase** property and deploy the database.</span></span>
- <span data-ttu-id="ea0b6-228">**Deploytodatabase**プロパティが**False**で、 **/ddを**指定した場合、またはスイッチを省略した場合、VSDBCMD ではデータベースが配置されません。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-228">If the **DeployToDatabase** property is **False**, and you specify **/dd-** or omit the switch, VSDBCMD will not deploy the database.</span></span>
- <span data-ttu-id="ea0b6-229">**Deploytodatabase**プロパティが**True**の場合、VSDBCMD はスイッチを無視し、データベースを配置します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-229">If the **DeployToDatabase** property is **True**, VSDBCMD will ignore the switch and deploy the database.</span></span>
- <span data-ttu-id="ea0b6-230">配置スクリプトは、データベースを配置するかどうかに関係なく、それぞれのケースで生成されます。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-230">A deployment script is generated in each case, regardless of whether you're deploying the database as well.</span></span>

## <a name="conclusion"></a><span data-ttu-id="ea0b6-231">まとめ</span><span class="sxs-lookup"><span data-stu-id="ea0b6-231">Conclusion</span></span>

<span data-ttu-id="ea0b6-232">このトピックでは、Visual Studio 2010 のデータベースプロジェクトのビルドおよび配置プロセスの概要について説明しました。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-232">This topic provided an overview of the build and deployment process for database projects in Visual Studio 2010.</span></span> <span data-ttu-id="ea0b6-233">また、MSBuild で VSDBCMD を使用して、エンタープライズ規模のデータベース配置をサポートする方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-233">It also described how you can use VSDBCMD.exe with MSBuild to support enterprise-scale database deployment.</span></span>

<span data-ttu-id="ea0b6-234">実際の動作方法の詳細については、「[複数の環境でのデータベース配置のカスタマイズ](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-234">For more information on how this works in practice, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="further-reading"></a><span data-ttu-id="ea0b6-235">参考資料</span><span class="sxs-lookup"><span data-stu-id="ea0b6-235">Further Reading</span></span>

<span data-ttu-id="ea0b6-236">各環境用に個別の配置構成ファイルを作成してデータベース配置をカスタマイズする方法については、「[複数の環境でのデータベース配置のカスタマイズ](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-236">For information on how to customize database deployments by creating a separate deployment configuration file for each environment, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="ea0b6-237">配置後スクリプトを実行してデータベースロールのメンバーシップを構成する方法については、「[テスト環境にデータベースロールメンバーシップを配置する](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-237">For guidance on how to configure database role memberships by running a post-deployment script, see [Deploying Database Role Memberships to Test Environments](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span></span> <span data-ttu-id="ea0b6-238">メンバーシップデータベースによって課せられるいくつかの固有の課題を管理するためのガイダンスについては、「[エンタープライズ環境へのメンバーシップデータベースの配置](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-238">For guidance on managing some of the unique challenges that membership databases impose, see [Deploying Membership Databases to Enterprise Environments](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span></span>

<span data-ttu-id="ea0b6-239">MSDN の次のトピックでは、Visual Studio データベースプロジェクトとデータベース配置プロセスに関する広範なガイダンスと背景情報を提供しています。</span><span class="sxs-lookup"><span data-stu-id="ea0b6-239">These topics on MSDN provide broader guidance and background information on Visual Studio database projects and the database deployment process:</span></span>

- [<span data-ttu-id="ea0b6-240">Visual Studio 2010 SQL Server データベースプロジェクト</span><span class="sxs-lookup"><span data-stu-id="ea0b6-240">Visual Studio 2010 SQL Server Database Projects</span></span>](https://msdn.microsoft.com/library/ff678491.aspx)
- [<span data-ttu-id="ea0b6-241">データベースの変更の管理</span><span class="sxs-lookup"><span data-stu-id="ea0b6-241">Managing Database Change</span></span>](https://msdn.microsoft.com/library/aa833404.aspx)
- [<span data-ttu-id="ea0b6-242">方法: VSDBCMD を使用して、コマンドプロンプトからデータベースを配置するための準備を行います。EXCEL.EXE</span><span class="sxs-lookup"><span data-stu-id="ea0b6-242">How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE</span></span>](https://msdn.microsoft.com/library/dd193258.aspx)
- [<span data-ttu-id="ea0b6-243">データベースビルド & デプロイの概要</span><span class="sxs-lookup"><span data-stu-id="ea0b6-243">An Overview of Database Build and Deployment</span></span>](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="ea0b6-244">[前へ](deploying-web-packages.md)
> [次へ](creating-and-running-a-deployment-command-file.md)</span><span class="sxs-lookup"><span data-stu-id="ea0b6-244">[Previous](deploying-web-packages.md)
[Next](creating-and-running-a-deployment-command-file.md)</span></span>
