---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: データベース プロジェクトの配置 |Microsoft Docs
author: jrjlee
description: メモ:エンタープライズ展開シナリオの多くは、配置されたデータベースに増分更新を発行する機能が必要です。 代わりでは、再作成しています.
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: 221808758492aedb8e8329364e511df28fd11105
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/06/2019
ms.locfileid: "65119314"
---
# <a name="deploying-database-projects"></a><span data-ttu-id="087e8-104">データベース プロジェクトを配置する</span><span class="sxs-lookup"><span data-stu-id="087e8-104">Deploying Database Projects</span></span>

<span data-ttu-id="087e8-105">によって[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="087e8-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="087e8-106">PDF のダウンロード</span><span class="sxs-lookup"><span data-stu-id="087e8-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> <span data-ttu-id="087e8-107">エンタープライズ展開シナリオの多くは、配置されたデータベースに増分更新を発行する機能が必要です。</span><span class="sxs-lookup"><span data-stu-id="087e8-107">In lots of enterprise deployment scenarios, you need the ability to publish incremental updates to a deployed database.</span></span> <span data-ttu-id="087e8-108">代わりに、すべてのデプロイでは、既存のデータベース内のデータが失われることを意味上のデータベースを再作成することです。</span><span class="sxs-lookup"><span data-stu-id="087e8-108">The alternative is to recreate the database on every deployment, which means you lose any data in the existing database.</span></span> <span data-ttu-id="087e8-109">Visual Studio 2010 を使用する場合は、増分データベース発行に推奨される方法は VSDBCMD を使用します。</span><span class="sxs-lookup"><span data-stu-id="087e8-109">When you work with Visual Studio 2010, using VSDBCMD is the recommended approach to incremental database publishing.</span></span> <span data-ttu-id="087e8-110">ただし、次のバージョンの Visual Studio と Web 発行パイプライン (WPP) 増分直接公開をサポートするツールが含まれます。</span><span class="sxs-lookup"><span data-stu-id="087e8-110">However, the next version of Visual Studio and the Web Publishing Pipeline (WPP) will include tooling that supports incremental publishing directly.</span></span>

<span data-ttu-id="087e8-111">Contact Manager サンプル ソリューションを開くには、Visual Studio 2010 で、データベース プロジェクトに 4 つのファイルを含むプロパティ フォルダーが含まれることがわかります。</span><span class="sxs-lookup"><span data-stu-id="087e8-111">If you open the Contact Manager sample solution in Visual Studio 2010, you'll see that the database project includes a Properties folder that contains four files.</span></span>

![](deploying-database-projects/_static/image1.png)

<span data-ttu-id="087e8-112">プロジェクト ファイルと共に (*ContactManager.Database.dbproj*ここでは)、これらのファイルがビルドおよび配置プロセスのさまざまな側面を制御します。</span><span class="sxs-lookup"><span data-stu-id="087e8-112">Together with the project file (*ContactManager.Database.dbproj* in this case), these files control various aspects of the build and deployment process:</span></span>

- <span data-ttu-id="087e8-113">*Database.sqlcmdvars*ファイルがプロジェクトを配置するときに使用するすべての SQLCMD 変数の値を提供します。</span><span class="sxs-lookup"><span data-stu-id="087e8-113">The *Database.sqlcmdvars* file provides values for any SQLCMD variables you use when you deploy the project.</span></span> <span data-ttu-id="087e8-114">各ソリューション構成 (たとえば、デバッグとリリース) には、さまざまな .sqlcmdvars ファイルを指定できます。</span><span class="sxs-lookup"><span data-stu-id="087e8-114">Each solution configuration (for example, debug and release) can specify a different .sqlcmdvars file.</span></span>
- <span data-ttu-id="087e8-115">*Database.sqldeployment*ファイル、プロジェクトまたは移行先サーバーの照合順序で定義されている照合順序を使用するかどうかのように、展開に固有の設定は、転送先データベースを再作成するかどうかごと時間または単純にして、最新では、既存のデータベースを修正します。</span><span class="sxs-lookup"><span data-stu-id="087e8-115">The *Database.sqldeployment* file provides deployment-specific settings, like whether to use the collation defined in your project or the collation of the destination server, whether to recreate the destination database every time or simply amend the existing database to bring it up to date, and so on.</span></span> <span data-ttu-id="087e8-116">各ソリューション構成では、さまざまな .sqldeployment ファイルを指定できます。</span><span class="sxs-lookup"><span data-stu-id="087e8-116">Each solution configuration can specify a different .sqldeployment file.</span></span>
- <span data-ttu-id="087e8-117">*Database.sqlpermissions*ファイルは、ターゲット データベースに追加するすべての権限の定義に使用できる XML ドキュメント。</span><span class="sxs-lookup"><span data-stu-id="087e8-117">The *Database.sqlpermissions* file is an XML document that you can use to define any permissions you want to add to the target database.</span></span> <span data-ttu-id="087e8-118">すべてのソリューション構成では、同じ .sqlpermissions ファイルを共有します。</span><span class="sxs-lookup"><span data-stu-id="087e8-118">All solution configurations share the same .sqlpermissions file.</span></span>
- <span data-ttu-id="087e8-119">*Database.sqlsettings*ファイルが、比較演算子の動作を使用する照合順序など、データベースを作成するときに使用するデータベース レベルのプロパティを指定します。</span><span class="sxs-lookup"><span data-stu-id="087e8-119">The *Database.sqlsettings* file specifies the database-level properties to use when creating the database, like the collation to use, the behavior of comparison operators, and so on.</span></span> <span data-ttu-id="087e8-120">すべてのソリューション構成では、同じ .sqlsettings ファイルを共有します。</span><span class="sxs-lookup"><span data-stu-id="087e8-120">All solution configurations share the same .sqlsettings file.</span></span>

<span data-ttu-id="087e8-121">ですが、Visual Studio でこれらのファイルを開き、内容を理解しておきます。</span><span class="sxs-lookup"><span data-stu-id="087e8-121">It's worth taking a moment to open these files in Visual Studio and familiarize yourself with the contents.</span></span>

<span data-ttu-id="087e8-122">データベース プロジェクトをビルドすると、ビルド プロセスには、2 つのファイルが作成されます。</span><span class="sxs-lookup"><span data-stu-id="087e8-122">When you build a database project, the build process creates two files:</span></span>

- <span data-ttu-id="087e8-123">A*データベース スキーマ*(.dbschema ファイル)。</span><span class="sxs-lookup"><span data-stu-id="087e8-123">A *database schema* (.dbschema file).</span></span> <span data-ttu-id="087e8-124">これには、XML 形式で作成するデータベースのスキーマについて説明します。</span><span class="sxs-lookup"><span data-stu-id="087e8-124">This describes the schema of the database you want to create in XML format.</span></span>
- <span data-ttu-id="087e8-125">A*配置マニフェスト*(.deploymanifest ファイル)。</span><span class="sxs-lookup"><span data-stu-id="087e8-125">A *deployment manifest* (.deploymanifest file).</span></span> <span data-ttu-id="087e8-126">これには、作成して、データベースをデプロイするために必要なすべての情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="087e8-126">This contains all the information required to create and deploy your database.</span></span> <span data-ttu-id="087e8-127">デプロイの手順 (.sqldeployment ファイル) と、配置前または配置後の SQL スクリプトのように、他のリソースと一緒に .dbschema ファイルを参照します。</span><span class="sxs-lookup"><span data-stu-id="087e8-127">It references the .dbschema file along with other resources, like the deployment instructions (the .sqldeployment file) and any pre-deployment or post-deployment SQL scripts.</span></span>

<span data-ttu-id="087e8-128">これは、これらのリソース間の関係を示します。</span><span class="sxs-lookup"><span data-stu-id="087e8-128">This shows the relationship between these resources:</span></span>

![](deploying-database-projects/_static/image2.png)

<span data-ttu-id="087e8-129">ご覧のとおり、.sqlsettings ファイルと .sqlpermissions ファイルには、ビルド プロセスに入力です。</span><span class="sxs-lookup"><span data-stu-id="087e8-129">As you can see, the .sqlsettings file and the .sqlpermissions file are inputs to the build process.</span></span> <span data-ttu-id="087e8-130">データベース プロジェクト ファイルで、と共に、これらのファイルは、データベースのスキーマ ファイルを作成に使用されます。</span><span class="sxs-lookup"><span data-stu-id="087e8-130">Along with the database project file, these files are used to create the database schema file.</span></span> <span data-ttu-id="087e8-131">.Sqldeployment ファイルと .sqlcmdvars ファイルは、変更、ビルド プロセスを通過します。</span><span class="sxs-lookup"><span data-stu-id="087e8-131">The .sqldeployment file and the .sqlcmdvars file pass through the build process unchanged.</span></span> <span data-ttu-id="087e8-132">配置マニフェストでは、データベース スキーマ、.sqldeployment ファイル、.sqlcmdvars ファイル、および配置前または配置後の SQL スクリプトの場所を示します。</span><span class="sxs-lookup"><span data-stu-id="087e8-132">The deployment manifest indicates the location of the database schema, the .sqldeployment file, the .sqlcmdvars file, and any pre-deployment or post-deployment SQL scripts.</span></span>

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a><span data-ttu-id="087e8-133">VSDBCMD を使用して、データベース プロジェクトを配置する理由ですか。</span><span class="sxs-lookup"><span data-stu-id="087e8-133">Why Use VSDBCMD to Deploy a Database Project?</span></span>

<span data-ttu-id="087e8-134">データベース プロジェクトを展開する各種のさまざまな方法はあります。</span><span class="sxs-lookup"><span data-stu-id="087e8-134">There are various different approaches to deploying database projects.</span></span> <span data-ttu-id="087e8-135">ただし、それらのすべては、エンタープライズ環境でのリモート サーバーにデータベース プロジェクトを展開するのに適しています。</span><span class="sxs-lookup"><span data-stu-id="087e8-135">However, not all of them are suitable for deploying a database project to remote servers in an enterprise environment.</span></span> <span data-ttu-id="087e8-136">データベース プロジェクトの配置からたいことを検討してください。</span><span class="sxs-lookup"><span data-stu-id="087e8-136">Consider what you want from a database project deployment.</span></span> <span data-ttu-id="087e8-137">エンタープライズ展開シナリオでは、するできました。</span><span class="sxs-lookup"><span data-stu-id="087e8-137">In enterprise deployment scenarios, you're likely to want:</span></span>

- <span data-ttu-id="087e8-138">リモートの場所からデータベース プロジェクトを配置する権限です。</span><span class="sxs-lookup"><span data-stu-id="087e8-138">The ability to deploy the database project from a remote location.</span></span>
- <span data-ttu-id="087e8-139">既存のデータベースを増分更新する権限です。</span><span class="sxs-lookup"><span data-stu-id="087e8-139">The ability to make incremental updates to an existing database.</span></span>
- <span data-ttu-id="087e8-140">配置前スクリプトまたは配置後スクリプトを含むことのできます。</span><span class="sxs-lookup"><span data-stu-id="087e8-140">The ability to include pre-deployment scripts or post-deployment scripts.</span></span>
- <span data-ttu-id="087e8-141">複数の展開先環境へのデプロイを調整する機能。</span><span class="sxs-lookup"><span data-stu-id="087e8-141">The ability to tailor the deployment to multiple destination environments.</span></span>
- <span data-ttu-id="087e8-142">大きくの一部としてデータベース プロジェクトをデプロイできる通常、スクリプト化された 1 つの手順から成るソリューションの配置。</span><span class="sxs-lookup"><span data-stu-id="087e8-142">The ability to deploy the database project as part of a larger, typically scripted, single-step solution deployment.</span></span>

<span data-ttu-id="087e8-143">データベース プロジェクトを展開に使用できる 3 つの主な方法はあります。</span><span class="sxs-lookup"><span data-stu-id="087e8-143">There are three main approaches you can use to deploy a database project:</span></span>

- <span data-ttu-id="087e8-144">Visual Studio 2010 データベース プロジェクトの種類でデプロイ機能を使用できます。</span><span class="sxs-lookup"><span data-stu-id="087e8-144">You can use the deployment functionality with the database project type in Visual Studio 2010.</span></span> <span data-ttu-id="087e8-145">ビルドして、Visual Studio 2010 データベース プロジェクトを展開するとき、展開プロセスは、ビルド構成に固有の SQL ベースの展開ファイルを生成するのに、配置マニフェストを使用します。</span><span class="sxs-lookup"><span data-stu-id="087e8-145">When you build and deploy a database project in Visual Studio 2010, the deployment process uses the deployment manifest to generate a SQL-based deployment file specific to the build configuration.</span></span> <span data-ttu-id="087e8-146">既に存在かが既に存在する場合は、データベースに必要な変更を加える場合は、データベースが作成されます。</span><span class="sxs-lookup"><span data-stu-id="087e8-146">This will create the database if it doesn't already exist or make any necessary changes to the database if it does already exist.</span></span> <span data-ttu-id="087e8-147">SQLCMD.exe を使用するには、移行先サーバーでこのファイルを実行するか作成し、ファイルを実行する Visual Studio を設定することができます。</span><span class="sxs-lookup"><span data-stu-id="087e8-147">You can use SQLCMD.exe to run this file on your destination server, or you can set Visual Studio to create and run the file.</span></span> <span data-ttu-id="087e8-148">このアプローチの欠点は、展開の設定の制御がのみに制限されています。</span><span class="sxs-lookup"><span data-stu-id="087e8-148">The disadvantage of this approach is that you have only limited control over the deployment settings.</span></span> <span data-ttu-id="087e8-149">多くの場合も、特定の環境変数の値を指定する SQL デプロイ ファイルを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="087e8-149">You may often also need to modify the SQL deployment file to provide environment-specific variable values.</span></span> <span data-ttu-id="087e8-150">Visual Studio 2010 がインストールされている場合、このアプローチのコンピューターからのみ使用でき、開発者が知るし、すべての展開先環境の接続文字列と資格情報を提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="087e8-150">You can only use this approach from a computer with Visual Studio 2010 installed, and the developer would need to know and provide connection strings and credentials for all destination environments.</span></span>
- <span data-ttu-id="087e8-151">インターネット インフォメーション サービス (IIS) Web 配置ツール (Web 配置) を使用する[web アプリケーション プロジェクトの一部としてデータベースを展開](https://msdn.microsoft.com/library/dd465343.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="087e8-151">You can use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to [deploy a database as part of a web application project](https://msdn.microsoft.com/library/dd465343.aspx).</span></span> <span data-ttu-id="087e8-152">ただし、この手法は、移行先サーバー上の既存のローカル データベースをレプリケートするだけではなく、データベース プロジェクトを配置する場合は、もっと複雑です。</span><span class="sxs-lookup"><span data-stu-id="087e8-152">However, this approach is a lot more complex if you want to deploy a database project rather than simply replicate an existing local database on a destination server.</span></span> <span data-ttu-id="087e8-153">Web 配置のためにが、データベース プロジェクトを生成する SQL デプロイ スクリプトを実行することができます、web アプリケーション プロジェクトのカスタム WPP ターゲット ファイルを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="087e8-153">You can configure Web Deploy to run the SQL deployment script that the database project generates, but in order to do this, you need to create a custom WPP targets file for your web application project.</span></span> <span data-ttu-id="087e8-154">展開プロセスに膨大な量の複雑さが追加されます。</span><span class="sxs-lookup"><span data-stu-id="087e8-154">This adds a substantial amount of complexity to the deployment process.</span></span> <span data-ttu-id="087e8-155">さらに、Web Deploy 直接サポートしませんの増分更新を既存のデータベース。</span><span class="sxs-lookup"><span data-stu-id="087e8-155">In addition, Web Deploy does not directly support incremental updates to existing databases.</span></span> <span data-ttu-id="087e8-156">この方法の詳細については、次を参照してください。 [SQL ファイルを展開パッケージのデータベース プロジェクトに Web 発行パイプラインを拡張する](https://go.microsoft.com/?linkid=9805121)します。</span><span class="sxs-lookup"><span data-stu-id="087e8-156">For more information on this approach, see [Extending the Web Publishing Pipeline to package database project deployed SQL file](https://go.microsoft.com/?linkid=9805121).</span></span>
- <span data-ttu-id="087e8-157">VSDBCMD ユーティリティを使用して、データベース スキーマまたは配置マニフェストのいずれかを使用して、データベースをデプロイすることができます。</span><span class="sxs-lookup"><span data-stu-id="087e8-157">You can use the VSDBCMD utility to deploy the database, using either the database schema or the deployment manifest.</span></span> <span data-ttu-id="087e8-158">VSDBCMD.exe は、MSBuild ターゲット データベースをスクリプト化されたより大規模の展開プロセスの一環として発行できますから呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="087e8-158">You can call VSDBCMD.exe from an MSBuild target, which lets you publish databases as part of a larger, scripted deployment process.</span></span> <span data-ttu-id="087e8-159">.Sqlcmdvars ファイルとその他のデータベースのプロパティを複数のビルド構成を作成せず、展開のさまざまな環境をカスタマイズすることができます、VSDBCMD のコマンドから多数の変数をオーバーライドできます。</span><span class="sxs-lookup"><span data-stu-id="087e8-159">You can override the variables in your .sqlcmdvars file and lots of other database properties from a VSDBCMD command, which allows you to customize your deployment for different environments without creating multiple build configurations.</span></span> <span data-ttu-id="087e8-160">VSDBCMD は、データベース スキーマを転送先データベースを配置するために必要な変更のみが行われますが、差別化機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="087e8-160">VSDBCMD provides differentiation functionality, which means it will make only the necessary changes to align a destination database with your database schema.</span></span> <span data-ttu-id="087e8-161">VSDBCMD は、さまざまなコマンド ライン オプションは、展開プロセスをよりきめ細かく制御も提供します。</span><span class="sxs-lookup"><span data-stu-id="087e8-161">VSDBCMD also offers a wide range of command-line options, which give you fine-grained control over the deployment process.</span></span>

<span data-ttu-id="087e8-162">この概要については、MSBuild で VSDBCMD を使用するが一般的な企業の展開シナリオに最適な方法がわかります。</span><span class="sxs-lookup"><span data-stu-id="087e8-162">From this overview, you can see that using VSDBCMD with MSBuild is the approach best suited to a typical enterprise deployment scenario:</span></span>

|  | <span data-ttu-id="087e8-163">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="087e8-163">Visual Studio 2010</span></span> | <span data-ttu-id="087e8-164">Web 配置 2.0</span><span class="sxs-lookup"><span data-stu-id="087e8-164">Web Deploy 2.0</span></span> | <span data-ttu-id="087e8-165">VSDBCMD.exe</span><span class="sxs-lookup"><span data-stu-id="087e8-165">VSDBCMD.exe</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="087e8-166">リモート展開をサポートしますか。</span><span class="sxs-lookup"><span data-stu-id="087e8-166">Supports remote deployment?</span></span> | <span data-ttu-id="087e8-167">[はい]</span><span class="sxs-lookup"><span data-stu-id="087e8-167">Yes</span></span> | <span data-ttu-id="087e8-168">はい</span><span class="sxs-lookup"><span data-stu-id="087e8-168">Yes</span></span> | <span data-ttu-id="087e8-169">[はい]</span><span class="sxs-lookup"><span data-stu-id="087e8-169">Yes</span></span> |
| <span data-ttu-id="087e8-170">増分更新をサポートしていますか。</span><span class="sxs-lookup"><span data-stu-id="087e8-170">Supports incremental updates?</span></span> | <span data-ttu-id="087e8-171">[はい]</span><span class="sxs-lookup"><span data-stu-id="087e8-171">Yes</span></span> | <span data-ttu-id="087e8-172">×</span><span class="sxs-lookup"><span data-stu-id="087e8-172">No</span></span> | <span data-ttu-id="087e8-173">[はい]</span><span class="sxs-lookup"><span data-stu-id="087e8-173">Yes</span></span> |
| <span data-ttu-id="087e8-174">前/配置スクリプトをサポートしていますか。</span><span class="sxs-lookup"><span data-stu-id="087e8-174">Supports pre/post-deployment scripts?</span></span> | <span data-ttu-id="087e8-175">[はい]</span><span class="sxs-lookup"><span data-stu-id="087e8-175">Yes</span></span> | <span data-ttu-id="087e8-176">はい</span><span class="sxs-lookup"><span data-stu-id="087e8-176">Yes</span></span> | <span data-ttu-id="087e8-177">[はい]</span><span class="sxs-lookup"><span data-stu-id="087e8-177">Yes</span></span> |
| <span data-ttu-id="087e8-178">マルチ環境の展開をサポートしていますか。</span><span class="sxs-lookup"><span data-stu-id="087e8-178">Supports multi-environment deployment?</span></span> | <span data-ttu-id="087e8-179">制限</span><span class="sxs-lookup"><span data-stu-id="087e8-179">Limited</span></span> | <span data-ttu-id="087e8-180">制限</span><span class="sxs-lookup"><span data-stu-id="087e8-180">Limited</span></span> | <span data-ttu-id="087e8-181">はい</span><span class="sxs-lookup"><span data-stu-id="087e8-181">Yes</span></span> |
| <span data-ttu-id="087e8-182">スクリプト化されたデプロイをサポートしていますか。</span><span class="sxs-lookup"><span data-stu-id="087e8-182">Supports scripted deployment?</span></span> | <span data-ttu-id="087e8-183">制限</span><span class="sxs-lookup"><span data-stu-id="087e8-183">Limited</span></span> | <span data-ttu-id="087e8-184">[はい]</span><span class="sxs-lookup"><span data-stu-id="087e8-184">Yes</span></span> | <span data-ttu-id="087e8-185">[はい]</span><span class="sxs-lookup"><span data-stu-id="087e8-185">Yes</span></span> |

<span data-ttu-id="087e8-186">このトピックの残りの部分では、VSDBCMD をデータベース プロジェクトを配置するために MSBuild の使用について説明します。</span><span class="sxs-lookup"><span data-stu-id="087e8-186">The remainder of this topic describes the use of VSDBCMD with MSBuild to deploy database projects.</span></span>

## <a name="understanding-the-deployment-process"></a><span data-ttu-id="087e8-187">展開プロセスを理解します。</span><span class="sxs-lookup"><span data-stu-id="087e8-187">Understanding the Deployment Process</span></span>

<span data-ttu-id="087e8-188">VSDBCMD ユーティリティを使用して、データベース スキーマ (.dbschema ファイル) または配置マニフェスト (.deploymanifest ファイル) を使用してデータベースを展開できます。</span><span class="sxs-lookup"><span data-stu-id="087e8-188">The VSDBCMD utility lets you deploy a database using either the database schema (the .dbschema file) or the deployment manifest (the .deploymanifest file).</span></span> <span data-ttu-id="087e8-189">実際には、配置マニフェストを使用すると、さまざまな展開のプロパティの既定値を指定し、配置前または配置後 SQL スクリプトを実行するように、配置マニフェストをほぼ常に使用します。</span><span class="sxs-lookup"><span data-stu-id="087e8-189">In practice, you'll almost always use the deployment manifest, as the deployment manifest lets you provide default values for various deployment properties and identify any pre-deployment or post-deployment SQL scripts you want to run.</span></span> <span data-ttu-id="087e8-190">デプロイにこの VSDBCMD コマンドを使用するなど、 **ContactManager**データベースをテスト環境でデータベース サーバー。</span><span class="sxs-lookup"><span data-stu-id="087e8-190">For example, this VSDBCMD command is used to deploy the **ContactManager** database to a database server in a test environment:</span></span>

[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]

<span data-ttu-id="087e8-191">この場合、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="087e8-191">In this case:</span></span>

- <span data-ttu-id="087e8-192">**/A** (または **/Action**) スイッチでは、VSDBCMD を実行するを指定します。</span><span class="sxs-lookup"><span data-stu-id="087e8-192">The **/a** (or **/Action**) switch specifies what you want VSDBCMD to do.</span></span> <span data-ttu-id="087e8-193">これを設定して**インポート**または**デプロイ**します。</span><span class="sxs-lookup"><span data-stu-id="087e8-193">You can set this to **Import** or **Deploy**.</span></span> <span data-ttu-id="087e8-194">**インポート**オプションを使用して、既存のデータベースから .dbschema ファイルを生成し、**デプロイ**.dbschema ファイルをターゲット データベースに展開するオプションを使用します。</span><span class="sxs-lookup"><span data-stu-id="087e8-194">The **Import** option is used to generate a .dbschema file from an existing database, and the **Deploy** option is used to deploy a .dbschema file to a target database.</span></span>
- <span data-ttu-id="087e8-195">**/Manifest** (または **/ManifestFile**) スイッチを展開する .deploymanifest ファイルを識別します。</span><span class="sxs-lookup"><span data-stu-id="087e8-195">The **/manifest** (or **/ManifestFile**) switch identifies the .deploymanifest file you want to deploy.</span></span> <span data-ttu-id="087e8-196">代わりに .dbschema ファイルを使用したい場合は使用、**モデル/** (または **/ModelFile**) スイッチします。</span><span class="sxs-lookup"><span data-stu-id="087e8-196">If you wanted to use the .dbschema file instead, you'd use the **/model** (or **/ModelFile**) switch.</span></span>
- <span data-ttu-id="087e8-197">**/Cs** (または **/ConnectionString**) スイッチでは、対象のデータベース サーバーの接続文字列を提供します。</span><span class="sxs-lookup"><span data-stu-id="087e8-197">The **/cs** (or **/ConnectionString**) switch provides the connection string for the target database server.</span></span> <span data-ttu-id="087e8-198">データベースの名前が含まれていない、この注&#x2014;VSDBCMD は、データベースを作成するサーバーに接続する必要があります個々 のデータベースに接続する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="087e8-198">Note that this doesn't include the name of the database&#x2014;VSDBCMD needs to connect to the server to create the database; it doesn't need to connect to an individual database.</span></span> <span data-ttu-id="087e8-199">.Deploymanifest ファイルには、接続文字列が含まれている場合は、このスイッチを省略できます。</span><span class="sxs-lookup"><span data-stu-id="087e8-199">If your .deploymanifest file includes a connection string, you can omit this switch.</span></span> <span data-ttu-id="087e8-200">とにかく、スイッチを使用する場合、スイッチの値は .deploymanifest 値をオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="087e8-200">If you use the switch anyway, the switch value will override the .deploymanifest value.</span></span>
- <span data-ttu-id="087e8-201"><strong>/P:TargetDatabase</strong>プロパティをターゲット データベースの作成時に割り当てる名前を提供します。</span><span class="sxs-lookup"><span data-stu-id="087e8-201">The <strong>/p:TargetDatabase</strong> property provides the name you want to assign to the target database on creation.</span></span> <span data-ttu-id="087e8-202">値が上書きされます。、 <strong>TargetDatabase</strong> .deploymanifest ファイルのプロパティ。</span><span class="sxs-lookup"><span data-stu-id="087e8-202">This overrides the value of the <strong>TargetDatabase</strong> property in the .deploymanifest file.</span></span> <span data-ttu-id="087e8-203">使用することができます、 <strong>/p:</strong> <em>[プロパティ名]</em>.sqlcmdvars ファイルで宣言されている構文をさまざまな展開のプロパティを設定して、すべての SQLCMD 変数をオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="087e8-203">You can use the <strong>/p:</strong> <em>[property name]</em>syntax to set a wide variety of deployment properties and to override any SQLCMD variables declared in your .sqlcmdvars file.</span></span>
- <span data-ttu-id="087e8-204">**/Dd+** (または **/DeployToDatabase+**) スイッチでは、展開を作成し、ターゲット環境にデプロイすることを示します。</span><span class="sxs-lookup"><span data-stu-id="087e8-204">The **/dd+** (or **/DeployToDatabase+**) switch indicates that you want to create a deployment and deploy it to the target environment.</span></span> <span data-ttu-id="087e8-205">指定した場合 **/dd-** スイッチは省略または、VSDBCMD は配置スクリプトが生成されますが、ターゲット環境に配置されません。</span><span class="sxs-lookup"><span data-stu-id="087e8-205">If you specify **/dd-**, or omit the switch, VSDBCMD will generate a deployment script but will not deploy it to the target environment.</span></span> <span data-ttu-id="087e8-206">このスイッチは、混乱の原因は、多くの場合とは、次のセクションで詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="087e8-206">This switch is often the source of confusion and is explained in more detail in the next section.</span></span>
- <span data-ttu-id="087e8-207">**/Script** (または **/DeploymentScriptFile**) スイッチでは、配置スクリプトを生成するを指定します。</span><span class="sxs-lookup"><span data-stu-id="087e8-207">The **/script** (or **/DeploymentScriptFile**) switch specifies where you want to generate the deployment script.</span></span> <span data-ttu-id="087e8-208">この値は、展開プロセスには影響しません。</span><span class="sxs-lookup"><span data-stu-id="087e8-208">This value does not affect the deployment process.</span></span>

<span data-ttu-id="087e8-209">VSDBCMD の詳細については、次を参照してください。 [VSDBCMD のコマンド ライン リファレンス。EXE (展開およびスキーマのインポート)](https://msdn.microsoft.com/library/dd193283.aspx)と[方法。VSDBCMD を使用して、コマンド プロンプトからのデプロイのデータベースを準備します。EXE](https://msdn.microsoft.com/library/dd193258.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="087e8-209">For more information on VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span></span>

<span data-ttu-id="087e8-210">MSBuild プロジェクト ファイルから、VSDBCMD を使用する方法の例は、次を参照してください。[ビルド プロセスを理解する](understanding-the-build-process.md)します。</span><span class="sxs-lookup"><span data-stu-id="087e8-210">For an example of how you can use VSDBCMD from an MSBuild project file, see [Understanding the Build Process](understanding-the-build-process.md).</span></span> <span data-ttu-id="087e8-211">複数の環境のデータベースの配置設定を構成する方法の例については、次を参照してください。[複数の環境のデータベースの配置をカスタマイズする](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)します。</span><span class="sxs-lookup"><span data-stu-id="087e8-211">For examples of how to configure database deployment settings for multiple environments, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="understanding-the-deploytodatabase-switch"></a><span data-ttu-id="087e8-212">DeployToDatabase スイッチを理解します。</span><span class="sxs-lookup"><span data-stu-id="087e8-212">Understanding the DeployToDatabase Switch</span></span>

<span data-ttu-id="087e8-213">動作、 **/dd**または **/DeployToDatabase**スイッチは、VSDBCMD .dbschema ファイルまたは .deploymanifest ファイルを使用するかどうかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="087e8-213">The behavior of the **/dd** or **/DeployToDatabase** switch depends on whether you're using VSDBCMD with a .dbschema file or a .deploymanifest file.</span></span> <span data-ttu-id="087e8-214">.Dbschema ファイルを使用している場合の動作は非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="087e8-214">If you're using a .dbschema file, the behavior is fairly straightforward:</span></span>

- <span data-ttu-id="087e8-215">指定した場合 **/dd+** または **/dd**VSDBCMD は配置スクリプトを生成し、データベースを展開します。</span><span class="sxs-lookup"><span data-stu-id="087e8-215">If you specify **/dd+** or **/dd**, VSDBCMD will generate a deployment script and deploy the database.</span></span>
- <span data-ttu-id="087e8-216">指定した場合 **/dd-** またはスイッチは省略、VSDBCMD 配置スクリプトのみが生成されます。</span><span class="sxs-lookup"><span data-stu-id="087e8-216">If you specify **/dd-** or omit the switch, VSDBCMD will generate a deployment script only.</span></span>

<span data-ttu-id="087e8-217">.Deploymanifest ファイルを使用している場合の動作ははるかに複雑です。</span><span class="sxs-lookup"><span data-stu-id="087e8-217">If you're using a .deploymanifest file, the behavior is a lot more complicated.</span></span> <span data-ttu-id="087e8-218">これは、.deploymanifest ファイルには、プロパティ名が含まれているため**DeployToDatabase**も、データベースが展開されているかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="087e8-218">This is because the .deploymanifest file contains a property name **DeployToDatabase** that also determines whether the database is deployed.</span></span>

[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]

<span data-ttu-id="087e8-219">このプロパティの値は、データベース プロジェクトのプロパティに従って設定されます。</span><span class="sxs-lookup"><span data-stu-id="087e8-219">The value of this property is set according to the properties of the database project.</span></span> <span data-ttu-id="087e8-220">設定した場合、**アクション展開**に**デプロイ スクリプト (.sql) 作成**、値になります**False**。</span><span class="sxs-lookup"><span data-stu-id="087e8-220">If you set the **Deploy action** to **Create a deployment script (.sql)**, the value will be **False**.</span></span> <span data-ttu-id="087e8-221">設定した場合、**アクション展開**に**デプロイ スクリプト (.sql) を作成し、データベースに展開**、値になります**True**します。</span><span class="sxs-lookup"><span data-stu-id="087e8-221">If you set the **Deploy action** to **Create a deployment script (.sql) and deploy to the database**, the value will be **True**.</span></span>

> [!NOTE]
> <span data-ttu-id="087e8-222">これらの設定は、特定のビルド構成とプラットフォームに関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="087e8-222">These settings are associated with a specific build configuration and platform.</span></span> <span data-ttu-id="087e8-223">設定を構成する場合など、**デバッグ**構成し、発行を使用して、**リリース**の構成の設定は使用されません。</span><span class="sxs-lookup"><span data-stu-id="087e8-223">For example, if you configure settings for the **Debug** configuration and then publish using the **Release** configuration, your settings will not be used.</span></span>

![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> <span data-ttu-id="087e8-224">このシナリオで、**アクション展開**に常に設定する必要があります**デプロイ スクリプト (.sql) 作成**Visual Studio 2010、データベースの配置をしたくないので。</span><span class="sxs-lookup"><span data-stu-id="087e8-224">In this scenario, the **Deploy action** should always be set to **Create a deployment script (.sql)**, because you don't want Visual Studio 2010 to deploy your database.</span></span> <span data-ttu-id="087e8-225">つまり、 **DeployToDatabase**プロパティは常に**False**します。</span><span class="sxs-lookup"><span data-stu-id="087e8-225">In other words, the **DeployToDatabase** property should always be **False**.</span></span>

<span data-ttu-id="087e8-226">ときに、 **DeployToDatabase**プロパティが指定されて、 **/dd**プロパティの値がある場合は、スイッチに、プロパティはオーバーライドのみ**false**:</span><span class="sxs-lookup"><span data-stu-id="087e8-226">When a **DeployToDatabase** property is specified, the **/dd** switch will only override the property if the property value is **false**:</span></span>

- <span data-ttu-id="087e8-227">場合、 **DeployToDatabase**プロパティは**False**を指定して **/dd+** または **/dd**、VSDBCMD を上書、 **DeployToDatabase**プロパティおよびデータベースを展開します。</span><span class="sxs-lookup"><span data-stu-id="087e8-227">If the **DeployToDatabase** property is **False**, and you specify **/dd+** or **/dd**, VSDBCMD will override the **DeployToDatabase** property and deploy the database.</span></span>
- <span data-ttu-id="087e8-228">場合、 **DeployToDatabase**プロパティは**False**を指定して **/dd-** またはスイッチは省略、VSDBCMD は、データベースは展開しません。</span><span class="sxs-lookup"><span data-stu-id="087e8-228">If the **DeployToDatabase** property is **False**, and you specify **/dd-** or omit the switch, VSDBCMD will not deploy the database.</span></span>
- <span data-ttu-id="087e8-229">場合、 **DeployToDatabase**プロパティは**True**VSDBCMD は、スイッチを無視して、データベースを展開します。</span><span class="sxs-lookup"><span data-stu-id="087e8-229">If the **DeployToDatabase** property is **True**, VSDBCMD will ignore the switch and deploy the database.</span></span>
- <span data-ttu-id="087e8-230">データベースを配置するかどうかに関係なく、各ケースでは、配置スクリプトが生成されます。</span><span class="sxs-lookup"><span data-stu-id="087e8-230">A deployment script is generated in each case, regardless of whether you're deploying the database as well.</span></span>

## <a name="conclusion"></a><span data-ttu-id="087e8-231">まとめ</span><span class="sxs-lookup"><span data-stu-id="087e8-231">Conclusion</span></span>

<span data-ttu-id="087e8-232">このトピックでは、Visual Studio 2010 データベース プロジェクトのビルドと展開プロセスの概要が提供されます。</span><span class="sxs-lookup"><span data-stu-id="087e8-232">This topic provided an overview of the build and deployment process for database projects in Visual Studio 2010.</span></span> <span data-ttu-id="087e8-233">また、エンタープライズ規模のデータベースの配置をサポートするために、MSBuild で VSDBCMD.exe を使用する方法も説明します。</span><span class="sxs-lookup"><span data-stu-id="087e8-233">It also described how you can use VSDBCMD.exe with MSBuild to support enterprise-scale database deployment.</span></span>

<span data-ttu-id="087e8-234">実際にこのしくみの詳細については、次を参照してください。[複数の環境のデータベースの配置をカスタマイズする](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)します。</span><span class="sxs-lookup"><span data-stu-id="087e8-234">For more information on how this works in practice, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="further-reading"></a><span data-ttu-id="087e8-235">関連項目</span><span class="sxs-lookup"><span data-stu-id="087e8-235">Further Reading</span></span>

<span data-ttu-id="087e8-236">環境ごとに個別のデプロイの構成ファイルを作成してデータベースの配置をカスタマイズする方法については、次を参照してください。[複数の環境のデータベースの配置をカスタマイズする](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)します。</span><span class="sxs-lookup"><span data-stu-id="087e8-236">For information on how to customize database deployments by creating a separate deployment configuration file for each environment, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="087e8-237">配置後スクリプトを実行してデータベース ロールのメンバーシップを構成する方法のガイダンスについては、次を参照してください。[テスト環境にデータベース ロール メンバーシップを展開する](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md)します。</span><span class="sxs-lookup"><span data-stu-id="087e8-237">For guidance on how to configure database role memberships by running a post-deployment script, see [Deploying Database Role Memberships to Test Environments](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span></span> <span data-ttu-id="087e8-238">固有の課題のいくつかのメンバーシップを管理する方法のガイダンスについては、データベースは強制を参照してください[エンタープライズ環境にメンバーシップ データベースを展開する](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md)します。</span><span class="sxs-lookup"><span data-stu-id="087e8-238">For guidance on managing some of the unique challenges that membership databases impose, see [Deploying Membership Databases to Enterprise Environments](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span></span>

<span data-ttu-id="087e8-239">MSDN でこれらのトピックより広範なガイダンスと背景情報については、Visual Studio データベース プロジェクトとデータベースの展開プロセスを説明します。</span><span class="sxs-lookup"><span data-stu-id="087e8-239">These topics on MSDN provide broader guidance and background information on Visual Studio database projects and the database deployment process:</span></span>

- [<span data-ttu-id="087e8-240">Visual Studio 2010 の SQL Server データベース プロジェクト</span><span class="sxs-lookup"><span data-stu-id="087e8-240">Visual Studio 2010 SQL Server Database Projects</span></span>](https://msdn.microsoft.com/library/ff678491.aspx)
- [<span data-ttu-id="087e8-241">データベースの変更を管理します。</span><span class="sxs-lookup"><span data-stu-id="087e8-241">Managing Database Change</span></span>](https://msdn.microsoft.com/library/aa833404.aspx)
- [<span data-ttu-id="087e8-242">方法: VSDBCMD を使用して、コマンド プロンプトからのデプロイのデータベースを準備します。実行可能ファイル</span><span class="sxs-lookup"><span data-stu-id="087e8-242">How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE</span></span>](https://msdn.microsoft.com/library/dd193258.aspx)
- [<span data-ttu-id="087e8-243">データベースのビルドと展開の概要</span><span class="sxs-lookup"><span data-stu-id="087e8-243">An Overview of Database Build and Deployment</span></span>](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="087e8-244">[前へ](deploying-web-packages.md)
> [次へ](creating-and-running-a-deployment-command-file.md)</span><span class="sxs-lookup"><span data-stu-id="087e8-244">[Previous](deploying-web-packages.md)
[Next](creating-and-running-a-deployment-command-file.md)</span></span>
