---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/understanding-the-build-process
title: ビルドプロセスについてMicrosoft Docs
author: jrjlee
description: このトピックでは、エンタープライズ規模のビルドおよび配置プロセスのチュートリアルを提供します。 このトピックで説明する方法では、カスタムの Microsoft Build Engin を使用します。
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 5b982451-547b-4a2f-a5dc-79bc64d84d40
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/understanding-the-build-process
msc.type: authoredcontent
ms.openlocfilehash: 802d93f7ca987d018967275bae68b8c56d883a25
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78520834"
---
# <a name="understanding-the-build-process"></a><span data-ttu-id="ce4d2-104">ビルド処理について理解する</span><span class="sxs-lookup"><span data-stu-id="ce4d2-104">Understanding the Build Process</span></span>

<span data-ttu-id="ce4d2-105">[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="ce4d2-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

<span data-ttu-id="ce4d2-106">[[Download PDF]\(PDF をダウンロード\)](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span><span class="sxs-lookup"><span data-stu-id="ce4d2-106">[Download PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span></span>

> <span data-ttu-id="ce4d2-107">このトピックでは、エンタープライズ規模のビルドおよび配置プロセスのチュートリアルを提供します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-107">This topic provides a walkthrough of an enterprise-scale build and deployment process.</span></span> <span data-ttu-id="ce4d2-108">このトピックで説明する方法では、カスタム Microsoft Build Engine (MSBuild) プロジェクトファイルを使用して、プロセスのすべての側面をきめ細かく制御します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-108">The approach described in this topic uses custom Microsoft Build Engine (MSBuild) project files to provide fine-grained control over every aspect of the process.</span></span> <span data-ttu-id="ce4d2-109">プロジェクトファイル内では、カスタム MSBuild ターゲットを使用して、インターネットインフォメーションサービス (IIS) Web 配置ツール (Msdeploy.exe) やデータベース配置ユーティリティ VSDBCMD などの配置ユーティリティを実行します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-109">Within the project files, custom MSBuild targets are used to run deployment utilities like the Internet Information Services (IIS) Web Deployment Tool (MSDeploy.exe) and the database deployment utility VSDBCMD.exe.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="ce4d2-110">前のトピック「[プロジェクトファイルについ](understanding-the-project-file.md)て」では、MSBuild プロジェクトファイルの主要なコンポーネントについて説明し、複数のターゲット環境への配置をサポートするために分割されたプロジェクトファイルの概念を紹介しました。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-110">The previous topic, [Understanding the Project File](understanding-the-project-file.md), described the key components of an MSBuild project file and introduced the concept of split project files to support deployment to multiple target environments.</span></span> <span data-ttu-id="ce4d2-111">これらの概念を理解していない場合は、このトピックを使用する前に、「[プロジェクトファイルについて理解](understanding-the-project-file.md)する必要があります」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-111">If you're not already familiar with these concepts, you should review [Understanding the Project File](understanding-the-project-file.md) before you work through this topic.</span></span>

<span data-ttu-id="ce4d2-112">このトピックでは、Fabrikam, Inc. という架空の企業のエンタープライズ展開要件に基づいて、一連のチュートリアルの一部を説明します。このチュートリアルシリーズでは、&#x2014; [Contact Manager ソリューション](the-contact-manager-solution.md)&#x2014;のサンプルソリューションを使用して、ASP.NET MVC 3 アプリケーション、Windows Communication Foundation (WCF) サービス、データベースプロジェクトなど、現実的なレベルの複雑さを持つ web アプリケーションを表します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-112">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="ce4d2-113">これらのチュートリアルの中核となる配置方法は、「[プロジェクトファイルについ](understanding-the-project-file.md)て」で説明されている分割プロジェクトファイルアプローチに基づいています。この&#x2014;プロジェクトファイルには、ビルドプロセスは、すべての変換先環境に適用されるビルド命令を含む2つのプロジェクトファイルと、環境固有のビルドおよび配置設定を含んでいます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-113">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="ce4d2-114">ビルド時に、環境固有のプロジェクトファイルが環境に依存しないプロジェクトファイルにマージされ、ビルド命令の完全なセットが形成されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-114">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="build-and-deployment-overview"></a><span data-ttu-id="ce4d2-115">ビルド & デプロイの概要</span><span class="sxs-lookup"><span data-stu-id="ce4d2-115">Build and Deployment Overview</span></span>

<span data-ttu-id="ce4d2-116">[Contact Manager ソリューション](the-contact-manager-solution.md)では、3つのファイルによってビルドとデプロイのプロセスが制御されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-116">In the [Contact Manager solution](the-contact-manager-solution.md), three files control the build and deployment process:</span></span>

- <span data-ttu-id="ce4d2-117">*ユニバーサルプロジェクトファイル*(*Publish. proj*)。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-117">A *universal project file* (*Publish.proj*).</span></span> <span data-ttu-id="ce4d2-118">これには、対象となる環境間で変更されないビルドおよび配置の手順が含まれます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-118">This contains build and deployment instructions that do not change between destination environments.</span></span>
- <span data-ttu-id="ce4d2-119">*環境固有のプロジェクトファイル*(*Env Dev. proj*)。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-119">An *environment-specific project file* (*Env-Dev.proj*).</span></span> <span data-ttu-id="ce4d2-120">これには、特定の対象環境に固有のビルドおよび配置の設定が含まれます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-120">This contains build and deployment settings that are specific to a particular destination environment.</span></span> <span data-ttu-id="ce4d2-121">たとえば、 *env-Dev. proj*ファイルを使用して、開発者またはテスト環境の設定を指定し、環境のステージング環境の設定を提供するために、 *env*という名前の別のファイルを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-121">For example, you could use the *Env-Dev.proj* file to provide settings for a developer or test environment and create an alternative file named *Env-Stage.proj* to provide settings for a staging environment.</span></span>
- <span data-ttu-id="ce4d2-122">*コマンドファイル*(*Publish-Dev*)。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-122">A *command file* (*Publish-Dev.cmd*).</span></span> <span data-ttu-id="ce4d2-123">これには、実行するプロジェクトファイルを指定する Msbuild.exe コマンドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-123">This contains an MSBuild.exe command that specifies which project files you want to execute.</span></span> <span data-ttu-id="ce4d2-124">すべての変換先環境に対してコマンドファイルを作成できます。各ファイルには、別の環境固有のプロジェクトファイルを指定する Msbuild.exe コマンドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-124">You can create a command file for every destination environment, where each file contains an MSBuild.exe command that specifies a different environment-specific project file.</span></span> <span data-ttu-id="ce4d2-125">これにより、開発者は、適切なコマンドファイルを実行するだけで、さまざまな環境に配置できます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-125">This lets the developer deploy to different environments simply by running the appropriate command file.</span></span>

<span data-ttu-id="ce4d2-126">サンプルソリューションでは、[ソリューションの発行] フォルダーにこれら3つのファイルがあります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-126">In the sample solution, you can find these three files in the Publish solution folder.</span></span>

![](understanding-the-build-process/_static/image1.png)

<span data-ttu-id="ce4d2-127">これらのファイルについてさらに詳しく説明する前に、この方法を使用した場合のビルドプロセス全体のしくみを見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-127">Before you look at these files in more detail, let's take a look at how the overall build process works when you use this approach.</span></span> <span data-ttu-id="ce4d2-128">大まかに言えば、ビルドと配置のプロセスは次のようになります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-128">At a high level, the build and deployment process looks like this:</span></span>

![](understanding-the-build-process/_static/image2.png)

<span data-ttu-id="ce4d2-129">最初に実行されるのは、2つの&#x2014;プロジェクトファイル (ユニバーサルビルドと配置の手順を含む) と、環境&#x2014;固有の設定を含むファイルが1つのプロジェクトファイルにマージされることです。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-129">The first thing that happens is that the two project files&#x2014;one containing universal build and deployment instructions, and one containing environment-specific settings&#x2014;are merged into a single project file.</span></span> <span data-ttu-id="ce4d2-130">MSBuild は、プロジェクトファイルの指示に従って動作します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-130">MSBuild then works through the instructions in the project file.</span></span> <span data-ttu-id="ce4d2-131">各プロジェクトのプロジェクトファイルを使用して、ソリューション内の各プロジェクトをビルドします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-131">It builds each of the projects in the solution, using the project file for each project.</span></span> <span data-ttu-id="ce4d2-132">次に、Web 配置 (Msdeploy.exe) などの他のツールを呼び出し、Web コンテンツとデータベースをターゲット環境に配置するための VSDBCMD ユーティリティを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-132">It then calls out to other tools, like Web Deploy (MSDeploy.exe) and the VSDBCMD utility to deploy your web content and databases to the target environment.</span></span>

<span data-ttu-id="ce4d2-133">最初から最後まで、ビルドと展開のプロセスで次のタスクが実行されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-133">From start to finish, the build and deployment process performs these tasks:</span></span>

1. <span data-ttu-id="ce4d2-134">新しいビルドの準備として、出力ディレクトリの内容を削除します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-134">It deletes the contents of the output directory, in preparation for a fresh build.</span></span>
2. <span data-ttu-id="ce4d2-135">ソリューション内の各プロジェクトをビルドします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-135">It builds each project in the solution:</span></span>

    1. <span data-ttu-id="ce4d2-136">この場合の&#x2014;web プロジェクトでは、ASP.NET MVC web アプリケーションと WCF web サービス&#x2014;のビルドプロセスによって、各プロジェクトの web 配置パッケージが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-136">For web projects&#x2014;in this case, an ASP.NET MVC web application and a WCF web service&#x2014;the build process creates a web deployment package for each project.</span></span>
    2. <span data-ttu-id="ce4d2-137">データベースプロジェクトの場合、ビルドプロセスによって、各プロジェクトの配置マニフェスト (deploymanifest ファイル) が作成されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-137">For database projects, the build process creates a deployment manifest (.deploymanifest file) for each project.</span></span>
3. <span data-ttu-id="ce4d2-138">VSDBCMD ユーティリティを使用して、ソリューション内の各データベースプロジェクトを配置します。これには、プロジェクト&#x2014;ファイルのさまざまなプロパティ、ターゲット接続&#x2014;文字列、データベース名、および deploymanifest ファイルを使用します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-138">It uses the VSDBCMD.exe utility to deploy each database project in the solution, using various properties from the project files&#x2014;a target connection string and a database name&#x2014;together with the .deploymanifest file.</span></span>
4. <span data-ttu-id="ce4d2-139">Msdeploy.exe ユーティリティを使用してソリューション内の各 web プロジェクトを配置し、プロジェクトファイルのさまざまなプロパティを使用して配置プロセスを制御します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-139">It uses the MSDeploy.exe utility to deploy each web project in the solution, using various properties from the project files to control the deployment process.</span></span>

<span data-ttu-id="ce4d2-140">サンプルソリューションを使用して、このプロセスをより詳細にトレースできます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-140">You can use the sample solution to trace this process in more detail.</span></span>

> [!NOTE]
> <span data-ttu-id="ce4d2-141">独自のサーバー環境用に環境固有のプロジェクトファイルをカスタマイズする方法については、「[ターゲット環境の配置プロパティを構成](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-141">For guidance on how to customize the environment-specific project files for your own server environments, see [Configure Deployment Properties for a Target Environment](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).</span></span>

## <a name="invoking-the-build-and-deployment-process"></a><span data-ttu-id="ce4d2-142">ビルド & デプロイプロセスの呼び出し</span><span class="sxs-lookup"><span data-stu-id="ce4d2-142">Invoking the Build and Deployment Process</span></span>

<span data-ttu-id="ce4d2-143">開発者テスト環境に Contact Manager ソリューションを配置するには、 *Publish-Dev*コマンドファイルを実行します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-143">To deploy the Contact Manager solution to a developer test environment, the developer runs the *Publish-Dev.cmd* command file.</span></span> <span data-ttu-id="ce4d2-144">これにより Msbuild.exe が呼び出され、実行するプロジェクトファイルとして*Publish*が指定され、パラメーター値として*proj が*指定されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-144">This invokes MSBuild.exe, specifying *Publish.proj* as the project file to execute and *Env-Dev.proj* as a parameter value.</span></span>

[!code-console[Main](understanding-the-build-process/samples/sample1.cmd)]

> [!NOTE]
> <span data-ttu-id="ce4d2-145">**/Fl**スイッチ ( **/fileLogger**の short) は、ビルド出力を現在のディレクトリの*msbuild.exe*という名前のファイルに記録します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-145">The **/fl** switch (short for **/fileLogger**) logs the build output to a file named *msbuild.log* in the current directory.</span></span> <span data-ttu-id="ce4d2-146">詳細については、「 [MSBuild コマンドラインリファレンス](https://msdn.microsoft.com/library/ms164311.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-146">For more information, see the [MSBuild Command Line Reference](https://msdn.microsoft.com/library/ms164311.aspx).</span></span>

<span data-ttu-id="ce4d2-147">この時点で、MSBuild は実行を開始し、*発行の proj*ファイルを読み込み、そこに含まれる命令の処理を開始します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-147">At this point, MSBuild starts running, loads the *Publish.proj* file, and starts processing the instructions within it.</span></span> <span data-ttu-id="ce4d2-148">最初の命令は、 **TargetEnvPropsFile**パラメーターによって指定されたプロジェクトファイルをインポートするよう MSBuild に指示します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-148">The first instruction tells MSBuild to import the project file that the **TargetEnvPropsFile** parameter specifies.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample2.xml)]

<span data-ttu-id="ce4d2-149">**TargetEnvPropsFile**パラメーターによって*env*ファイルが指定されるため、MSBuild では、 *Env*ファイルの内容が*Publish*ファイルにマージされます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-149">The **TargetEnvPropsFile** parameter specifies the *Env-Dev.proj* file, so MSBuild merges the contents of the *Env-Dev.proj* file into the *Publish.proj* file.</span></span>

<span data-ttu-id="ce4d2-150">マージされたプロジェクトファイルで MSBuild が検出する次の要素は、プロパティグループです。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-150">The next elements that MSBuild encounters in the merged project file are property groups.</span></span> <span data-ttu-id="ce4d2-151">プロパティは、ファイルに出現する順序で処理されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-151">Properties are processed in the order in which they appear in the file.</span></span> <span data-ttu-id="ce4d2-152">MSBuild は、各プロパティのキーと値のペアを作成し、指定された条件が満たされていることを示します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-152">MSBuild creates a key-value pair for each property, providing that any specified conditions are met.</span></span> <span data-ttu-id="ce4d2-153">ファイルの後半で定義されているプロパティは、ファイルで定義されている名前と同じ名前のプロパティを上書きします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-153">Properties defined later in the file will overwrite any properties with the same name defined earlier in the file.</span></span> <span data-ttu-id="ce4d2-154">たとえば、 **Outputroot**プロパティについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-154">For example, consider the **OutputRoot** properties.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample3.xml)]

<span data-ttu-id="ce4d2-155">MSBuild が最初の**outputroot**要素を処理するときに、同様の名前付きパラメーターが指定されていない場合、 **outputroot**プロパティの値が. に設定されます。 \**\** 発行します。2番目の**outputroot**要素が検出されると、条件が**true**と評価されると、 **Outputroot**プロパティの値が**OutDir**パラメーターの値で上書きされます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-155">When MSBuild processes the first **OutputRoot** element, providing a similarly named parameter has not been provided, it sets the value of the **OutputRoot** property to **..\Publish\Out**. When it encounters the second **OutputRoot** element, if the condition evaluates to **true**, it will overwrite the value of the **OutputRoot** property with the value of the **OutDir** parameter.</span></span>

<span data-ttu-id="ce4d2-156">MSBuild が検出する次の要素は、 **Projectstobuild**という名前の項目を含む単一の項目グループです。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-156">The next element that MSBuild encounters is a single item group, containing an item named **ProjectsToBuild**.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample4.xml)]

<span data-ttu-id="ce4d2-157">MSBuild は、 **Projectstobuild**という名前の項目リストを構築することによって、この命令を処理します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-157">MSBuild processes this instruction by building an item list named **ProjectsToBuild**.</span></span> <span data-ttu-id="ce4d2-158">この場合、項目の一覧には、ソリューションファイル&#x2014;のパスとファイル名の1つの値が含まれます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-158">In this case, the item list contains a single value&#x2014;the path and filename of the solution file.</span></span>

<span data-ttu-id="ce4d2-159">この時点で、残りの要素はターゲットです。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-159">At this point, the remaining elements are targets.</span></span> <span data-ttu-id="ce4d2-160">ターゲットは、プロパティと項目&#x2014;とは異なる方法で処理されます。つまり、ターゲットは、ユーザーが明示的に指定した場合、またはプロジェクトファイル内の別の構造体によって呼び出された場合を除き、処理されません。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-160">Targets are processed differently from properties and items&#x2014;essentially, targets are not processed unless they are either explicitly specified by the user or invoked by another construct within the project file.</span></span> <span data-ttu-id="ce4d2-161">開いている**プロジェクト**タグに**defaulttargets**属性が含まれていることを思い出してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-161">Recall that the opening **Project** tag includes a **DefaultTargets** attribute.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample5.xml)]

<span data-ttu-id="ce4d2-162">これにより、msbuild.exe が呼び出されたときにターゲットが指定されていない場合、 **Fullpublish**ターゲットを呼び出すように msbuild に指示します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-162">This instructs MSBuild to invoke the **FullPublish** target, if targets are not specified when MSBuild.exe is invoked.</span></span> <span data-ttu-id="ce4d2-163">**Fullpublish**ターゲットにタスクが含まれていません。代わりに、単に依存関係の一覧を指定します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-163">The **FullPublish** target doesn't contain any tasks; instead it simply specifies a list of dependencies.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample6.xml)]

<span data-ttu-id="ce4d2-164">この依存関係は、 **Fullpublish**ターゲットを実行するために、指定された順序でこのターゲットの一覧を呼び出す必要があることを MSBuild に指示します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-164">This dependency tells MSBuild that in order to execute the **FullPublish** target, it needs to invoke this list of targets in the order provided:</span></span>

1. <span data-ttu-id="ce4d2-165">**クリーン**ターゲットを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-165">It must invoke the **Clean** target.</span></span>
2. <span data-ttu-id="ce4d2-166">**Buildprojects**ターゲットを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-166">It must invoke the **BuildProjects** target.</span></span>
3. <span data-ttu-id="ce4d2-167">**GatherPackagesForPublishing**ターゲットを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-167">It must invoke the **GatherPackagesForPublishing** target.</span></span>
4. <span data-ttu-id="ce4d2-168">**Publishdbpackages**ターゲットを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-168">It must invoke the **PublishDbPackages** target.</span></span>
5. <span data-ttu-id="ce4d2-169">**Publishwebpackages**ターゲットを呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-169">It must invoke the **PublishWebPackages** target.</span></span>

### <a name="the-clean-target"></a><span data-ttu-id="ce4d2-170">クリーンターゲット</span><span class="sxs-lookup"><span data-stu-id="ce4d2-170">The Clean Target</span></span>

<span data-ttu-id="ce4d2-171">**クリーン**ターゲットは、基本的に、新しいビルドの準備として、出力ディレクトリとそのすべての内容を削除します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-171">The **Clean** target basically deletes the output directory and all its contents, as preparation for a fresh build.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample7.xml)]

<span data-ttu-id="ce4d2-172">ターゲットに**ItemGroup**要素が含まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-172">Notice that the target includes an **ItemGroup** element.</span></span> <span data-ttu-id="ce4d2-173">**ターゲット**要素内にプロパティまたは項目を定義すると、*動的*なプロパティと項目が作成されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-173">When you define properties or items within a **Target** element, you're creating *dynamic* properties and items.</span></span> <span data-ttu-id="ce4d2-174">つまり、プロパティまたは項目は、ターゲットが実行されるまで処理されません。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-174">In other words, the properties or items aren't processed until the target is executed.</span></span> <span data-ttu-id="ce4d2-175">出力ディレクトリが存在しないか、ビルドプロセスが開始するまでファイルが含まれている可能性があるため、 **\_FilesToDelete** list を静的項目としてビルドすることはできません。実行が進行するまで待機する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-175">The output directory might not exist or contain any files until the build process begins, so you can't build the **\_FilesToDelete** list as a static item; you have to wait until execution is underway.</span></span> <span data-ttu-id="ce4d2-176">そのため、リストはターゲット内の動的な項目としてビルドします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-176">As such, you build the list as a dynamic item within the target.</span></span>

> [!NOTE]
> <span data-ttu-id="ce4d2-177">この場合、**クリーン**ターゲットは最初に実行されるため、動的な項目グループを使用する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-177">In this case, because the **Clean** target is the first to be executed, there's no real need to use a dynamic item group.</span></span> <span data-ttu-id="ce4d2-178">ただし、この種のシナリオでは、ある時点で異なる順序でターゲットを実行する場合があるので、動的なプロパティと項目を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-178">However, it's good practice to use dynamic properties and items in this type of scenario, as you might want to execute targets in a different order at some point.</span></span>  
> <span data-ttu-id="ce4d2-179">また、使用されない項目を宣言しないようにすることもお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-179">You should also aim to avoid declaring items that will never be used.</span></span> <span data-ttu-id="ce4d2-180">特定のターゲットによってのみ使用される項目がある場合は、ターゲット内に配置して、ビルドプロセスの不要なオーバーヘッドを解消することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-180">If you have items that will only be used by a specific target, consider placing them inside the target to remove any unnecessary overhead on the build process.</span></span>

<span data-ttu-id="ce4d2-181">動的な項目については、**クリーン**ターゲットは非常に単純であり、組み込みの**Message**、 **Delete**、および**RemoveDir**タスクを使用して次のことを行います。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-181">Dynamic items aside, the **Clean** target is fairly straightforward and makes use of the built-in **Message**, **Delete**, and **RemoveDir** tasks to:</span></span>

1. <span data-ttu-id="ce4d2-182">ロガーにメッセージを送信します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-182">Send a message to the logger.</span></span>
2. <span data-ttu-id="ce4d2-183">削除するファイルの一覧を作成します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-183">Build a list of files to delete.</span></span>
3. <span data-ttu-id="ce4d2-184">ファイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-184">Delete the files.</span></span>
4. <span data-ttu-id="ce4d2-185">出力ディレクトリを削除します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-185">Remove the output directory.</span></span>

### <a name="the-buildprojects-target"></a><span data-ttu-id="ce4d2-186">BuildProjects ターゲット</span><span class="sxs-lookup"><span data-stu-id="ce4d2-186">The BuildProjects Target</span></span>

<span data-ttu-id="ce4d2-187">**Buildprojects**ターゲットは基本的に、サンプルソリューション内のすべてのプロジェクトをビルドします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-187">The **BuildProjects** target basically builds all the projects in the sample solution.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample8.xml)]

<span data-ttu-id="ce4d2-188">このターゲットについては、前のトピック「[プロジェクトファイルについ](understanding-the-project-file.md)て」で説明しました。これは、タスクとターゲットがプロパティと項目を参照する方法を説明するためのものです。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-188">This target was described in some detail in the previous topic, [Understanding the Project File](understanding-the-project-file.md), to illustrate how tasks and targets reference properties and items.</span></span> <span data-ttu-id="ce4d2-189">この時点で、主に**MSBuild**タスクに関心があります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-189">At this point, you're mainly interested in the **MSBuild** task.</span></span> <span data-ttu-id="ce4d2-190">このタスクを使用すると、複数のプロジェクトをビルドできます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-190">You can use this task to build multiple projects.</span></span> <span data-ttu-id="ce4d2-191">このタスクでは、Msbuild.exe の新しいインスタンスは作成されません。現在実行中のインスタンスを使用して、各プロジェクトをビルドします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-191">The task does not create a new instance of MSBuild.exe; it uses the current running instance to build each project.</span></span> <span data-ttu-id="ce4d2-192">この例の重要なポイントは、展開のプロパティです。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-192">The key points of interest in this example are the deployment properties:</span></span>

- <span data-ttu-id="ce4d2-193">**Deployonbuild**プロパティは、各プロジェクトのビルドが完了したときに、プロジェクト設定の配置手順を実行するよう MSBuild に指示します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-193">The **DeployOnBuild** property instructs MSBuild to run any deployment instructions in the project settings when the build of each project is complete.</span></span>
- <span data-ttu-id="ce4d2-194">**Deploytarget**プロパティは、プロジェクトのビルド後に呼び出すターゲットを指定します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-194">The **DeployTarget** property identifies the target that you want to invoke after the project is built.</span></span> <span data-ttu-id="ce4d2-195">この場合、**パッケージ**ターゲットは、配置可能な web パッケージにプロジェクト出力をビルドします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-195">In this case, the **Package** target builds the project output into a deployable web package.</span></span>

> [!NOTE]
> <span data-ttu-id="ce4d2-196">**パッケージ**ターゲットは、MSBuild と Web 配置の統合を提供する Web 発行パイプライン (WPP) を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-196">The **Package** target invokes the Web Publishing Pipeline (WPP), which provides integration between MSBuild and Web Deploy.</span></span> <span data-ttu-id="ce4d2-197">WPP によって提供される組み込みターゲットを確認する場合は、% PROGRAMFILES (x86)% \ MSBuild\Microsoft\VisualStudio\v10.0\Web フォルダー内のファイルを確認して*みてください*。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-197">If you want to take a look at the built-in targets that the WPP provides, review the *Microsoft.Web.Publishing.targets* file in the %PROGRAMFILES(x86)%\MSBuild\Microsoft\VisualStudio\v10.0\Web folder.</span></span>

### <a name="the-gatherpackagesforpublishing-target"></a><span data-ttu-id="ce4d2-198">GatherPackagesForPublishing ターゲット</span><span class="sxs-lookup"><span data-stu-id="ce4d2-198">The GatherPackagesForPublishing Target</span></span>

<span data-ttu-id="ce4d2-199">**GatherPackagesForPublishing**ターゲットを調べると、実際にはタスクが含まれていないことがわかります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-199">If you study the **GatherPackagesForPublishing** target, you'll notice that it doesn't actually contain any tasks.</span></span> <span data-ttu-id="ce4d2-200">代わりに、3つの動的な項目を定義する1つの項目グループが含まれています。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-200">Instead, it contains a single item group that defines three dynamic items.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample9.xml)]

<span data-ttu-id="ce4d2-201">これらの項目は、 **Buildprojects**ターゲットの実行時に作成された配置パッケージを参照します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-201">These items refer to the deployment packages that were created when the **BuildProjects** target was executed.</span></span> <span data-ttu-id="ce4d2-202">これらの項目をプロジェクトファイルで静的に定義することはできません。これは、項目が参照するファイルが、 **Buildprojects**ターゲットが実行されるまで存在しないためです。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-202">You couldn't define these items statically in the project file, because the files to which the items refer don't exist until the **BuildProjects** target is executed.</span></span> <span data-ttu-id="ce4d2-203">代わりに、項目は、 **Buildprojects**ターゲットが実行されるまで呼び出されないターゲット内で動的に定義される必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-203">Instead, the items must be defined dynamically within a target that is not invoked until after the **BuildProjects** target is executed.</span></span>

<span data-ttu-id="ce4d2-204">項目はこのターゲット&#x2014;内では使用されません。このターゲットは、項目と各項目の値に関連付けられているメタデータを作成するだけです。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-204">The items are not used within this target&#x2014;this target simply builds the items and the metadata associated with each item value.</span></span> <span data-ttu-id="ce4d2-205">これらの要素が処理されると、 **Publishpackages**項目に2つの値 ( *Contactmanager. Mvc*ファイルのパスと*contactmanager. Service. .deploy*ファイルへのパス) が格納されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-205">Once these elements are processed, the **PublishPackages** item will contain two values, the path to the *ContactManager.Mvc.deploy.cmd* file and the path to the *ContactManager.Service.deploy.cmd* file.</span></span> <span data-ttu-id="ce4d2-206">Web 配置は、各プロジェクトの web パッケージの一部としてこれらのファイルを作成します。これらのファイルは、パッケージを配置するために移行先サーバーで呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-206">Web Deploy creates these files as part of the web package for each project, and these are the files that you must invoke on the destination server in order to deploy the packages.</span></span> <span data-ttu-id="ce4d2-207">これらのファイルのいずれかを開くと、基本的に、さまざまなビルド固有のパラメーター値を持つ Msdeploy.exe コマンドが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-207">If you open up one of these files, you'll basically see an MSDeploy.exe command with various build-specific parameter values.</span></span>

<span data-ttu-id="ce4d2-208">**Dbpublishpackages**項目には、 *Contactmanager. Database. deploymanifest*ファイルへのパスである単一の値が含まれます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-208">The **DbPublishPackages** item will contain a single value, the path to the *ContactManager.Database.deploymanifest* file.</span></span>

> [!NOTE]
> <span data-ttu-id="ce4d2-209">Deploymanifest ファイルは、データベースプロジェクトをビルドするときに生成され、MSBuild プロジェクトファイルと同じスキーマを使用します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-209">A .deploymanifest file is generated when you build a database project, and it uses the same schema as an MSBuild project file.</span></span> <span data-ttu-id="ce4d2-210">データベースの配置に必要なすべての情報 (データベーススキーマ (.dbschema) の場所、配置前スクリプトと配置後スクリプトの詳細など) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-210">It contains all the information required to deploy a database, including the location of the database schema (.dbschema) and details of any pre-deployment and post-deployment scripts.</span></span> <span data-ttu-id="ce4d2-211">詳細については、「[データベースビルド & デプロイの概要](https://msdn.microsoft.com/library/aa833165.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-211">For more information, see [An Overview of Database Build and Deployment](https://msdn.microsoft.com/library/aa833165.aspx).</span></span>

<span data-ttu-id="ce4d2-212">配置パッケージとデータベース配置マニフェストの作成方法と使用方法については、 [Web アプリケーションプロジェクトのビルドとパッケージ化](building-and-packaging-web-application-projects.md)、および[データベースプロジェクトの配置](deploying-database-projects.md)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-212">You'll learn more about how deployment packages and database deployment manifests are created and used in [Building and Packaging Web Application Projects](building-and-packaging-web-application-projects.md) and [Deploying Database Projects](deploying-database-projects.md).</span></span>

### <a name="the-publishdbpackages-target"></a><span data-ttu-id="ce4d2-213">PublishDbPackages ターゲット</span><span class="sxs-lookup"><span data-stu-id="ce4d2-213">The PublishDbPackages Target</span></span>

<span data-ttu-id="ce4d2-214">簡単に言うと、 **Publishdbpackages**ターゲットは VSDBCMD ユーティリティを呼び出して、 **contactmanager**データベースをターゲット環境にデプロイします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-214">Briefly speaking, the **PublishDbPackages** target invokes the VSDBCMD utility to deploy the **ContactManager** database to a target environment.</span></span> <span data-ttu-id="ce4d2-215">データベース配置の構成には多くの意思決定と微妙な関係があります。詳細については、[データベースプロジェクトの配置](deploying-database-projects.md)と[複数の環境のデータベース配置のカスタマイズ](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-215">Configuring database deployment involves lots of decisions and nuances, and you'll learn more about this in [Deploying Database Projects](deploying-database-projects.md) and [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="ce4d2-216">このトピックでは、このターゲットが実際にどのように機能するかについて説明します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-216">In this topic, we'll focus on how this target actually functions.</span></span>

<span data-ttu-id="ce4d2-217">まず、開始タグに**Outputs**属性が含まれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-217">First, notice that the opening tag includes an **Outputs** attribute.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample10.xml)]

<span data-ttu-id="ce4d2-218">これは、ターゲットの*バッチ*処理の例です。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-218">This is an example of *target batching*.</span></span> <span data-ttu-id="ce4d2-219">MSBuild プロジェクトファイルでは、バッチ処理はコレクションを反復処理するための手法です。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-219">In MSBuild project files, batching is a technique for iterating over collections.</span></span> <span data-ttu-id="ce4d2-220">**Outputs**属性の値 **"% (dbpublishpackages. Identity)"** は、 **Dbpublishpackages**項目リストの**id**メタデータプロパティを参照します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-220">The value of the **Outputs** attribute, **"%(DbPublishPackages.Identity)"**, refers to the **Identity** metadata property of the **DbPublishPackages** item list.</span></span> <span data-ttu-id="ce4d2-221">この記法 \**Outputs =% \* \* \* (Itemlist)* は、次のように変換されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-221">This notation, \**Outputs=%\*\*\*(ItemList.ItemMetadataName)*, is translated as:</span></span>

- <span data-ttu-id="ce4d2-222">**Dbpublishpackages**の項目を、同じ**id**メタデータ値を含む項目のバッチに分割します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-222">Split the items in **DbPublishPackages** into batches of items that contain the same **Identity** metadata value.</span></span>
- <span data-ttu-id="ce4d2-223">バッチごとにターゲットを1回実行します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-223">Execute the target once per batch.</span></span>

> [!NOTE]
> <span data-ttu-id="ce4d2-224">**Identity**は、作成時にすべての項目に割り当てられる[組み込みメタデータ値](https://msdn.microsoft.com/library/ms164313.aspx)の1つです。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-224">**Identity** is one of the [built-in metadata values](https://msdn.microsoft.com/library/ms164313.aspx) that is assigned to every item on creation.</span></span> <span data-ttu-id="ce4d2-225">ここでは、 **item**要素&#x2014;の**Include**属性の値 (項目のパスとファイル名) を参照します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-225">It refers to the value of the **Include** attribute in the **Item** element&#x2014;in other words, the path and filename of the item.</span></span>

<span data-ttu-id="ce4d2-226">この場合、同じパスとファイル名を持つ複数の項目を指定することはできないので、基本的には1つのバッチサイズを使用しています。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-226">In this case, because there should never be more than one item with the same path and filename, we're essentially working with batch sizes of one.</span></span> <span data-ttu-id="ce4d2-227">ターゲットは、データベースパッケージごとに1回実行されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-227">The target is executed once for every database package.</span></span>

<span data-ttu-id="ce4d2-228">**\_Cmd**プロパティにも同様の表記が表示されます。これにより、適切なスイッチで VSDBCMD コマンドが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-228">You can see a similar notation in the **\_Cmd** property, which builds a VSDBCMD command with the appropriate switches.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample11.xml)]

<span data-ttu-id="ce4d2-229">この場合、 **% (DatabaseConnectionString)** 、 **% (dbpublishpackages)** 、および **% (dbpublishpackages. FullPath)** はすべて、 **dbpublishpackages**項目コレクションのメタデータ値を参照します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-229">In this case, **%(DbPublishPackages.DatabaseConnectionString)**, **%(DbPublishPackages.TargetDatabase)**, and **%(DbPublishPackages.FullPath)** all refer to metadata values of the **DbPublishPackages** item collection.</span></span> <span data-ttu-id="ce4d2-230">**\_Cmd**プロパティは、コマンドを呼び出す**Exec**タスクによって使用されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-230">The **\_Cmd** property is used by the **Exec** task, which invokes the command.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample12.xml)]

<span data-ttu-id="ce4d2-231">この表記の結果、 **Exec**タスクは、 **DatabaseConnectionString**、 **targetdatabase**、および**FullPath**メタデータ値の一意の組み合わせに基づいてバッチを作成します。このタスクは、バッチごとに1回実行されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-231">As a result of this notation, the **Exec** task will create batches based on unique combinations of the **DatabaseConnectionString**, **TargetDatabase**, and **FullPath** metadata values, and the task will execute once for each batch.</span></span> <span data-ttu-id="ce4d2-232">*タスクバッチ*の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-232">This is an example of *task batching*.</span></span> <span data-ttu-id="ce4d2-233">ただし、ターゲットレベルのバッチ処理では、項目コレクションが既に単一項目のバッチに分割されているため、 **Exec**タスクは、ターゲットの反復ごとに1回だけ実行されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-233">However, because the target-level batching has already divided our item collection into single-item batches, the **Exec** task will run once and only once for each iteration of the target.</span></span> <span data-ttu-id="ce4d2-234">言い換えると、このタスクは、ソリューション内のデータベースパッケージごとに VSDBCMD ユーティリティを1回呼び出します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-234">In other words, this task invokes the VSDBCMD utility once for each database package in the solution.</span></span>

> [!NOTE]
> <span data-ttu-id="ce4d2-235">ターゲットとタスクのバッチ処理の詳細については、「MSBuild の[バッチ](https://msdn.microsoft.com/library/ms171473.aspx)処理」、「[ターゲットのバッチの項目メタデータ](https://msdn.microsoft.com/library/ms228229.aspx)」、および「[タスクバッチの項目メタデータ](https://msdn.microsoft.com/library/ms171474.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-235">For more information on target and task batching, see MSBuild [Batching](https://msdn.microsoft.com/library/ms171473.aspx), [Item Metadata in Target Batching](https://msdn.microsoft.com/library/ms228229.aspx), and [Item Metadata in Task Batching](https://msdn.microsoft.com/library/ms171474.aspx).</span></span>

### <a name="the-publishwebpackages-target"></a><span data-ttu-id="ce4d2-236">PublishWebPackages ターゲット</span><span class="sxs-lookup"><span data-stu-id="ce4d2-236">The PublishWebPackages Target</span></span>

<span data-ttu-id="ce4d2-237">この時点で、 **Buildprojects**ターゲットが呼び出されました。これにより、サンプルソリューション内の各プロジェクトの web 配置パッケージが生成されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-237">By this point, you've invoked the **BuildProjects** target, which generates a web deployment package for each project in the sample solution.</span></span> <span data-ttu-id="ce4d2-238">各パッケージは、ターゲット環境にパッケージを配置するために必要な Msdeploy.exe コマンドを含む *.deploy*ファイルであり、ターゲット環境の必要な詳細を指定する*setparameters .xml*ファイルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-238">Accompanying each package is a *deploy.cmd* file, which contains the MSDeploy.exe commands required to deploy the package to the target environment, and a *SetParameters.xml* file, which specifies the necessary details of the target environment.</span></span> <span data-ttu-id="ce4d2-239">また、 **GatherPackagesForPublishing**ターゲットも呼び出されました。これにより、目的の *.deploy*ファイルを含む項目コレクションが生成されます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-239">You've also invoked the **GatherPackagesForPublishing** target, which generates an item collection containing the *deploy.cmd* files you're interested in.</span></span> <span data-ttu-id="ce4d2-240">基本的に、 **Publishwebpackages**ターゲットは、次の関数を実行します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-240">Essentially, the **PublishWebPackages** target performs these functions:</span></span>

- <span data-ttu-id="ce4d2-241">**XmlPoke**タスクを使用して、各パッケージの*setparameters .xml*ファイルを操作し、ターゲット環境の正しい詳細を含めます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-241">It manipulates the *SetParameters.xml* file for each package to include the correct details for the target environment, using the **XmlPoke** task.</span></span>
- <span data-ttu-id="ce4d2-242">適切なスイッチを使用して、パッケージごとに*配置 .cmd*ファイルを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-242">It invokes the *deploy.cmd* file for each package, using the appropriate switches.</span></span>

<span data-ttu-id="ce4d2-243">**Publishdbpackages**ターゲットと同様に、 **publishdbpackages**ターゲットはターゲットバッチを使用して、ターゲットが web パッケージごとに1回実行されるようにします。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-243">Just like the **PublishDbPackages** target, the **PublishWebPackages** target uses target batching to ensure that the target is executed once for each web package.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample13.xml)]

<span data-ttu-id="ce4d2-244">ターゲット内では、 **Exec**タスクを使用して、各 web パッケージの*配置 .cmd*ファイルを実行します。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-244">Within the target, the **Exec** task is used to run the *deploy.cmd* file for each web package.</span></span>

[!code-xml[Main](understanding-the-build-process/samples/sample14.xml)]

<span data-ttu-id="ce4d2-245">Web パッケージの配置の構成の詳細については、「 [Web アプリケーションプロジェクトのビルドおよびパッケージ化](building-and-packaging-web-application-projects.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-245">For more information on configuring the deployment of web packages, see [Building and Packaging Web Application Projects](building-and-packaging-web-application-projects.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="ce4d2-246">まとめ</span><span class="sxs-lookup"><span data-stu-id="ce4d2-246">Conclusion</span></span>

<span data-ttu-id="ce4d2-247">このトピックでは、Contact Manager サンプルソリューションのビルドおよび配置プロセスを開始から終了まで制御するために、分割プロジェクトファイルを使用する方法のチュートリアルを提供しました。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-247">This topic provided a walkthrough of how split project files are used to control the build and deployment process from start to finish for the Contact Manager sample solution.</span></span> <span data-ttu-id="ce4d2-248">このアプローチを使用すると、環境固有のコマンドファイルを実行するだけで、複雑なエンタープライズ規模のデプロイを単一の反復可能な手順で実行できます。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-248">Using this approach lets you run complex, enterprise-scale deployments in a single, repeatable step, simply by running an environment-specific command file.</span></span>

## <a name="further-reading"></a><span data-ttu-id="ce4d2-249">参考資料</span><span class="sxs-lookup"><span data-stu-id="ce4d2-249">Further Reading</span></span>

<span data-ttu-id="ce4d2-250">プロジェクトファイルと WPP の詳細については、「Microsoft Build Engine の内部」を参照してください[。: MSBuild と Team Foundation Build](http://amzn.com/0735645248) By 作成者 Iロウ Hashimi およびウィリアム Bartholomew、ISBN: 978-0-7356-4524-0。</span><span class="sxs-lookup"><span data-stu-id="ce4d2-250">For a more in-depth introduction to project files and the WPP, see [Inside the Microsoft Build Engine: Using MSBuild and Team Foundation Build](http://amzn.com/0735645248) by Sayed Ibrahim Hashimi and William Bartholomew, ISBN: 978-0-7356-4524-0.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ce4d2-251">[前へ](understanding-the-project-file.md)
> [次へ](building-and-packaging-web-application-projects.md)</span><span class="sxs-lookup"><span data-stu-id="ce4d2-251">[Previous](understanding-the-project-file.md)
[Next](building-and-packaging-web-application-projects.md)</span></span>
