---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
title: エンタープライズ環境へのメンバーシップデータベースの配置 |Microsoft Docs
author: jrjlee
description: このトピックでは、ASP.NET アプリケーションサービスデータベース (より一般的なもの) をプロビジョニングするときに対処する必要がある主な考慮事項と課題について説明します。
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3cf765df-d311-4f68-a295-c9685ceea830
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
msc.type: authoredcontent
ms.openlocfilehash: 50f49af502b75aa5ad52756a76a5e7340aca53f7
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78422158"
---
# <a name="deploying-membership-databases-to-enterprise-environments"></a><span data-ttu-id="9251c-103">エンタープライズ環境にメンバーシップ データベースを配置する</span><span class="sxs-lookup"><span data-stu-id="9251c-103">Deploying Membership Databases to Enterprise Environments</span></span>

<span data-ttu-id="9251c-104">[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="9251c-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

<span data-ttu-id="9251c-105">[[Download PDF]\(PDF をダウンロード\)](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span><span class="sxs-lookup"><span data-stu-id="9251c-105">[Download PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span></span>

> <span data-ttu-id="9251c-106">このトピックでは、テスト環境、ステージング環境、または運用環境で ASP.NET アプリケーションサービスデータベース (一般にメンバーシップデータベースと呼ばれます) をプロビジョニングするときに対処する必要がある主な考慮事項と課題について説明します。</span><span class="sxs-lookup"><span data-stu-id="9251c-106">This topic explains the key considerations and challenges you'll need to overcome when you provision ASP.NET application services databases (more commonly referred to as membership databases) in test, staging, or production environments.</span></span> <span data-ttu-id="9251c-107">また、これらの課題に対応するために使用できる方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="9251c-107">It also describes approaches you can use to meet these challenges.</span></span>

<span data-ttu-id="9251c-108">このトピックでは、Fabrikam, Inc. という架空の企業のエンタープライズ展開要件に基づいて、一連のチュートリアルの一部を説明します。このチュートリアルシリーズでは、&#x2014; [Contact Manager ソリューション](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;のサンプルソリューションを使用して、ASP.NET MVC 3 アプリケーション、Windows Communication Foundation (WCF) サービス、データベースプロジェクトなど、現実的なレベルの複雑さを持つ web アプリケーションを表します。</span><span class="sxs-lookup"><span data-stu-id="9251c-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="9251c-109">これらのチュートリアルの中核となる配置方法は、「[プロジェクトファイルについ](../web-deployment-in-the-enterprise/understanding-the-project-file.md)て」で説明されている分割プロジェクトファイルアプローチに基づいています。この&#x2014;プロジェクトファイルには、ビルドプロセスは、すべての変換先環境に適用されるビルド命令を含む2つのプロジェクトファイルと、環境固有のビルドおよび配置設定を含んでいます。</span><span class="sxs-lookup"><span data-stu-id="9251c-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="9251c-110">ビルド時に、環境固有のプロジェクトファイルが環境に依存しないプロジェクトファイルにマージされ、ビルド命令の完全なセットが形成されます。</span><span class="sxs-lookup"><span data-stu-id="9251c-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="what-are-the-issues-when-you-deploy-a-membership-database"></a><span data-ttu-id="9251c-111">メンバーシップデータベースをデプロイする際の問題は何ですか。</span><span class="sxs-lookup"><span data-stu-id="9251c-111">What Are the Issues When You Deploy a Membership Database?</span></span>

<span data-ttu-id="9251c-112">ほとんどの場合、データベースの配置戦略を考案する際には、配置するデータを最初に考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9251c-112">In most cases, when you devise a deployment strategy for a database, the first thing you need to consider is what data you want to deploy.</span></span> <span data-ttu-id="9251c-113">開発環境またはテスト環境では、ユーザーアカウントデータを展開して、迅速かつ簡単なテストを容易にすることができます。</span><span class="sxs-lookup"><span data-stu-id="9251c-113">In a development or test environment, you might want to deploy user account data to facilitate quick and easy testing.</span></span> <span data-ttu-id="9251c-114">ステージング環境または運用環境では、ユーザーアカウントデータを展開することはほとんどありません。</span><span class="sxs-lookup"><span data-stu-id="9251c-114">In a staging or production environment, it's very unlikely that you'd want to deploy user account data.</span></span>

<span data-ttu-id="9251c-115">残念ながら、ASP.NET メンバーシップデータベースでは、この決定をさらに複雑にするいくつかの問題が発生しています。</span><span class="sxs-lookup"><span data-stu-id="9251c-115">Unfortunately, ASP.NET membership databases introduce some specific challenges that make this decision a lot more complex:</span></span>

- <span data-ttu-id="9251c-116">スキーマのみの展開では、メンバーシップデータベースは操作不可能な状態のままになります。</span><span class="sxs-lookup"><span data-stu-id="9251c-116">A schema-only deployment will leave the membership database in a non-operational state.</span></span> <span data-ttu-id="9251c-117">これは、メンバーシップデータベースには、データベースが機能するために必要ないくつかの構成データ ( **aspnet\_SchemaVersions**テーブル) が含まれているためです。</span><span class="sxs-lookup"><span data-stu-id="9251c-117">This is because the membership database includes some configuration data (in the **aspnet\_SchemaVersions** table) that the database requires in order to function.</span></span> <span data-ttu-id="9251c-118">そのため、ユーザーアカウントデータを除外するためにメンバーシップデータベースのスキーマのみのデプロイを実行する場合は、配置後スクリプトを実行して、必要な構成データを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9251c-118">As such, if you perform a schema-only deployment of your membership database in order to exclude user account data, you'll need to run a post-deployment script to add the essential configuration data.</span></span>
- <span data-ttu-id="9251c-119">メンバーシップデータベースがどのように構成されているかによって、メンバーシッププロバイダーはコンピューターキーを使用してパスワードを暗号化し、データベースに格納することができます。</span><span class="sxs-lookup"><span data-stu-id="9251c-119">Depending on how your membership database is configured, the membership provider may use the machine key to encrypt passwords and store them in the database.</span></span> <span data-ttu-id="9251c-120">この場合、データベースと共に配置するすべてのユーザーアカウントデータは、移行先サーバーで使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="9251c-120">In this case, any user account data you deploy with the database will become unusable on the destination server.</span></span> <span data-ttu-id="9251c-121">このため、ユーザーアカウントデータの展開はサポートされていないシナリオです。</span><span class="sxs-lookup"><span data-stu-id="9251c-121">For this reason, deploying user account data is not a supported scenario.</span></span>

## <a name="choosing-a-membership-database-strategy"></a><span data-ttu-id="9251c-122">メンバーシップデータベース戦略の選択</span><span class="sxs-lookup"><span data-stu-id="9251c-122">Choosing a Membership Database Strategy</span></span>

<span data-ttu-id="9251c-123">エンタープライズサーバー環境でメンバーシップデータベースをプロビジョニングする方法を選択する際には、次のガイドラインを参考にしてください。</span><span class="sxs-lookup"><span data-stu-id="9251c-123">Use these guidelines when you choose how to provision a membership database in an enterprise server environment:</span></span>

- <span data-ttu-id="9251c-124">可能な限り、メンバーシップデータベースはデプロイしないでください。</span><span class="sxs-lookup"><span data-stu-id="9251c-124">Wherever possible, do not deploy membership databases.</span></span> <span data-ttu-id="9251c-125">代わりに、ターゲットデータベースサーバーでメンバーシップデータベースを手動で作成します。</span><span class="sxs-lookup"><span data-stu-id="9251c-125">Instead, create the membership database manually on the target database server.</span></span> <span data-ttu-id="9251c-126">メンバーシップデータベースのスキーマをカスタマイズしていない場合は、 [ASP.NET SQL Server 登録ツール (aspnet\_regsql)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx)を使用して、宛先の本来に新しいものを作成するだけで済みます。</span><span class="sxs-lookup"><span data-stu-id="9251c-126">If you haven't customized your membership database schema, you can simply create a new one in situ at the destination using the [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span>
- <span data-ttu-id="9251c-127">オプションがなく、メンバーシップデータベース&#x2014;を配置する場合など、データベーススキーマ&#x2014;に対して広範な変更を行った場合は、メンバーシップデータベースのスキーマのみの配置を実行し、ユーザーアカウントデータを除外してから、配置後スクリプトを実行して必要な構成データを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="9251c-127">If you have no option but to deploy a membership database&#x2014;for example, if you've made extensive modifications to the database schema&#x2014;you should perform a schema-only deployment of the membership database, to exclude user account data, and then run a post-deployment script to add any required configuration data.</span></span> <span data-ttu-id="9251c-128">これらのアプローチに関する広範なガイダンスについては[、「方法: ユーザーアカウントを含まない ASP.NET メンバーシップデータベースをデプロイする](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9251c-128">You can find broad guidance on these approaches in [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

<span data-ttu-id="9251c-129">*メンバーシップデータベースのスキーマは、ほぼ静的である可能性が*あることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="9251c-129">It's important to remember that *the schema of your membership database is likely to be fairly static*.</span></span> <span data-ttu-id="9251c-130">メンバーシップデータベースをカスタマイズした場合でも、スキーマを定期的&#x2014;に更新する必要はほとんどありませんが、web アプリケーションやデータベースプロジェクトのコードと同じ頻度で変更されることはありません。</span><span class="sxs-lookup"><span data-stu-id="9251c-130">Even if you've customized the membership database, it's unlikely that you'll need to update the schema on a regular basis&#x2014;it's not going to change with the same frequency as the code in a web application or a database project.</span></span> <span data-ttu-id="9251c-131">そのため、自動または単一ステップのデプロイプロセスにメンバーシップデータベースを含める必要はありません。</span><span class="sxs-lookup"><span data-stu-id="9251c-131">As such, you shouldn't need to include the membership database in any automated or single-step deployment processes.</span></span>

## <a name="using-vsdbcmd-to-update-a-membership-database-schema"></a><span data-ttu-id="9251c-132">VSDBCMD を使用してメンバーシップデータベーススキーマを更新する</span><span class="sxs-lookup"><span data-stu-id="9251c-132">Using VSDBCMD to Update a Membership Database Schema</span></span>

<span data-ttu-id="9251c-133">最初の配置後にメンバーシップデータベースの構造を変更する場合は、インターネットインフォメーションサービス (IIS) Web 配置ツール (Web 配置) を使用してデータベースを再配置しないことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="9251c-133">If you modify the structure of your membership database after your first deployment, you may not want to use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to redeploy the database.</span></span> <span data-ttu-id="9251c-134">Web 配置のデータベース配置機能には、転送先データベース&#x2014;に対して差分更新を行う機能は含まれません。データベースを削除してから再作成する必要があり Web 配置。</span><span class="sxs-lookup"><span data-stu-id="9251c-134">The database deployment functionality in Web Deploy doesn't include the capability to make differential updates to a destination database&#x2014;instead, Web Deploy must drop and re-create the database.</span></span> <span data-ttu-id="9251c-135">これは、既存のユーザーアカウントデータが失われることを意味します。これは通常、ステージング環境または運用環境では望ましくありません。</span><span class="sxs-lookup"><span data-stu-id="9251c-135">This means that you lose any existing user account data, which is typically undesirable in staging or production environments.</span></span>

<span data-ttu-id="9251c-136">別の方法として、VSDBCMD ユーティリティを使用して、転送先データベースのスキーマを更新する方法があります。</span><span class="sxs-lookup"><span data-stu-id="9251c-136">The alternative is to use the VSDBCMD utility to update the schema of your destination database.</span></span> <span data-ttu-id="9251c-137">VSDBCMD には、2つの重要な機能があります。</span><span class="sxs-lookup"><span data-stu-id="9251c-137">VSDBCMD includes two important capabilities.</span></span> <span data-ttu-id="9251c-138">まず、既存のデータベースのスキーマを .dbschema ファイルにインポートできます。</span><span class="sxs-lookup"><span data-stu-id="9251c-138">First, it can import the schema of an existing database into a .dbschema file.</span></span> <span data-ttu-id="9251c-139">2つ目の方法として、.dbschema ファイルを差分更新として既存のデータベースに配置できます。つまり、ターゲットデータベースを最新の状態にするために必要な変更のみが加えられ、データが失われることはありません。</span><span class="sxs-lookup"><span data-stu-id="9251c-139">Second, it can deploy a .dbschema file to an existing database as a differential update, which means that it only makes the changes required to bring the target database up to date and you don't lose any data.</span></span>

<span data-ttu-id="9251c-140">次の大まかな手順を使用して、メンバーシップデータベーススキーマを更新できます。</span><span class="sxs-lookup"><span data-stu-id="9251c-140">You can use these high-level steps to update a membership database schema:</span></span>

1. <span data-ttu-id="9251c-141">VSDBCMD **Import**アクションを使用して、ソースメンバーシップデータベースの .dbschema ファイルを生成します。</span><span class="sxs-lookup"><span data-stu-id="9251c-141">Use the VSDBCMD **Import** action to generate a .dbschema file for your source membership database.</span></span> <span data-ttu-id="9251c-142">この手順については、「[方法: コマンドプロンプトからスキーマをインポート](https://msdn.microsoft.com/library/dd172135.aspx)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9251c-142">This procedure is described in [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span>
2. <span data-ttu-id="9251c-143">VSDBCMD **deploy**アクションを使用して、対象のメンバーシップデータベースに .dbschema ファイルを配置します。</span><span class="sxs-lookup"><span data-stu-id="9251c-143">Use the VSDBCMD **Deploy** action to deploy the .dbschema file to your destination membership database.</span></span> <span data-ttu-id="9251c-144">この手順については、「 [VSDBCMD のコマンドラインリファレンス」を参照してください。EXE (デプロイとスキーマのインポート)](https://msdn.microsoft.com/library/dd193283.aspx)。</span><span class="sxs-lookup"><span data-stu-id="9251c-144">This procedure is described in [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx).</span></span>

## <a name="conclusion"></a><span data-ttu-id="9251c-145">まとめ</span><span class="sxs-lookup"><span data-stu-id="9251c-145">Conclusion</span></span>

<span data-ttu-id="9251c-146">このトピックでは、さまざまなターゲット環境で ASP.NET メンバーシップデータベースをプロビジョニングする必要がある場合に直面する可能性があるいくつかの課題について説明します。</span><span class="sxs-lookup"><span data-stu-id="9251c-146">This topic described some of the challenges you may face when you need to provision ASP.NET membership databases in various target environments.</span></span> <span data-ttu-id="9251c-147">特に、スキーマのみの展開では、メンバーシップデータベースが非運用状態のままになる理由と、ユーザーアカウントデータの展開がサポートされていない理由について説明しました。</span><span class="sxs-lookup"><span data-stu-id="9251c-147">In particular, it explained why schema-only deployments will leave the membership database in a non-operational state and why deploying user account data is not supported.</span></span> <span data-ttu-id="9251c-148">このトピックでは、さまざまなシナリオでメンバーシップデータベースをプロビジョニング、デプロイ、および更新する方法についても説明しています。</span><span class="sxs-lookup"><span data-stu-id="9251c-148">The topic also presented guidance on how to provision, deploy, and update membership databases in different scenarios.</span></span>

## <a name="further-reading"></a><span data-ttu-id="9251c-149">参考資料</span><span class="sxs-lookup"><span data-stu-id="9251c-149">Further Reading</span></span>

<span data-ttu-id="9251c-150">VSDBCMD の使用方法の詳細なガイダンスと例については、「 [VSDBCMD のコマンドラインリファレンス」を参照してください。EXE (配置およびスキーマインポート)](https://msdn.microsoft.com/library/dd193283.aspx)と[方法: コマンドプロンプトからスキーマをインポート](https://msdn.microsoft.com/library/dd172135.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="9251c-150">For more guidance and examples of how to use VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span> <span data-ttu-id="9251c-151">Aspnet\_使用してメンバーシップデータベースを作成する方法の詳細については、「 [ASP.NET SQL Server Registration Tool (aspnet\_regsql .exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9251c-151">For more information on using aspnet\_regsql.exe to create membership databases, see [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span> <span data-ttu-id="9251c-152">メンバーシップデータベースの配置に関する一般的なガイダンスについては、「[方法: ユーザーアカウントを含まない ASP.NET メンバーシップデータベースを配置](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx)する」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="9251c-152">For more general guidance on deploying membership databases, see [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9251c-153">[前へ](deploying-database-role-memberships-to-test-environments.md)
> [次へ](excluding-files-and-folders-from-deployment.md)</span><span class="sxs-lookup"><span data-stu-id="9251c-153">[Previous](deploying-database-role-memberships-to-test-environments.md)
[Next](excluding-files-and-folders-from-deployment.md)</span></span>
