---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
title: 複数の環境のデータベース配置のカスタマイズ |Microsoft Docs
author: jrjlee
description: 'このトピックでは、配置プロセスの一部として、データベースのプロパティを特定のターゲット環境に合わせて調整する方法について説明します。 注: このトピックでは、'
ms.author: riande
ms.date: 05/04/2012
ms.assetid: a172979a-1318-4318-a9c6-4f9560d26267
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
msc.type: authoredcontent
ms.openlocfilehash: 8ae8cb1a322afb95c5d2e8d5e73c7825c7b2fe5a
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78489034"
---
# <a name="customizing-database-deployments-for-multiple-environments"></a><span data-ttu-id="5a9e6-104">複数の環境のためにデータベース配置をカスタマイズする</span><span class="sxs-lookup"><span data-stu-id="5a9e6-104">Customizing Database Deployments for Multiple Environments</span></span>

<span data-ttu-id="5a9e6-105">[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="5a9e6-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

<span data-ttu-id="5a9e6-106">[[Download PDF]\(PDF をダウンロード\)](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span><span class="sxs-lookup"><span data-stu-id="5a9e6-106">[Download PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)</span></span>

> <span data-ttu-id="5a9e6-107">このトピックでは、配置プロセスの一部として、データベースのプロパティを特定のターゲット環境に合わせて調整する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-107">This topic describes how to tailor the properties of a database to specific target environments as part of the deployment process.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="5a9e6-108">このトピックでは、Msbuild.exe と VSDBCMD を使用して Visual Studio 2010 データベースプロジェクトを配置することを前提としています。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-108">The topic assumes that you're deploying a Visual Studio 2010 database project using MSBuild.exe and VSDBCMD.exe.</span></span> <span data-ttu-id="5a9e6-109">この方法を選択する理由の詳細については、「[エンタープライズ環境での Web 配置](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md)」および「[データベースプロジェクトの配置](../web-deployment-in-the-enterprise/deploying-database-projects.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-109">For more information on why you might choose this approach, see [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) and [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span>
> 
> 
> <span data-ttu-id="5a9e6-110">複数の変換先にデータベースプロジェクトを配置する場合は、多くの場合、ターゲット環境ごとにデータベース配置プロパティをカスタマイズすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-110">When you deploy a database project to multiple destinations, you'll often want to customize the database deployment properties for each target environment.</span></span> <span data-ttu-id="5a9e6-111">たとえば、テスト環境では、通常、すべての配置でデータベースを再作成します。一方、ステージング環境や運用環境では、データを保持するために増分更新を行う方がはるかに多くなります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-111">For example, in test environments you'd typically recreate the database on every deployment, whereas in staging or production environments you'd be a lot more likely to make incremental updates to preserve your data.</span></span>
> 
> <span data-ttu-id="5a9e6-112">Visual Studio 2010 データベースプロジェクトでは、配置設定は配置構成 (sqldeployment) ファイル内に含まれます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-112">In a Visual Studio 2010 database project, deployment settings are contained within a deployment configuration (.sqldeployment) file.</span></span> <span data-ttu-id="5a9e6-113">このトピックでは、環境固有の配置構成ファイルを作成し、VSDBCMD パラメーターとして使用するものを指定する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-113">This topic will show you how to create environment-specific deployment configuration files and specify the one you want to use as a VSDBCMD parameter.</span></span>

<span data-ttu-id="5a9e6-114">このトピックでは、Fabrikam, Inc. という架空の企業のエンタープライズ展開要件に基づいて、一連のチュートリアルの一部を説明します。このチュートリアルシリーズでは、&#x2014; [Contact Manager ソリューション](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;のサンプルソリューションを使用して、ASP.NET MVC 3 アプリケーション、Windows Communication Foundation (WCF) サービス、データベースプロジェクトなど、現実的なレベルの複雑さを持つ web アプリケーションを表します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-114">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="5a9e6-115">これらのチュートリアルの中核となる配置方法は、「[プロジェクトファイルについ](../web-deployment-in-the-enterprise/understanding-the-project-file.md)て」で説明されている分割プロジェクトファイルアプローチに基づいています。この&#x2014;プロジェクトファイルには、ビルドプロセスは、すべての変換先環境に適用されるビルド命令を含む2つのプロジェクトファイルと、環境固有のビルドおよび配置設定を含んでいます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-115">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="5a9e6-116">ビルド時に、環境固有のプロジェクトファイルが環境に依存しないプロジェクトファイルにマージされ、ビルド命令の完全なセットが形成されます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-116">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="5a9e6-117">タスクの概要</span><span class="sxs-lookup"><span data-stu-id="5a9e6-117">Task Overview</span></span>

<span data-ttu-id="5a9e6-118">このトピックは次のことを前提としています。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-118">This topic assumes that:</span></span>

- <span data-ttu-id="5a9e6-119">「プロジェクト[ファイルについ](../web-deployment-in-the-enterprise/understanding-the-project-file.md)て」で説明されているように、ソリューションの配置には、プロジェクトファイルの分割アプローチを使用します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-119">You use the split project file approach to solution deployment, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span>
- <span data-ttu-id="5a9e6-120">「[ビルドプロセスについ](../web-deployment-in-the-enterprise/understanding-the-build-process.md)て」で説明されているように、プロジェクトファイルから VSDBCMD を呼び出して、データベースプロジェクトを配置します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-120">You call VSDBCMD from the project file to deploy your database project, as described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="5a9e6-121">ターゲット環境間でのデータベース配置プロパティの変化をサポートする展開システムを作成するには、次のことを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-121">To create a deployment system that supports varying the database deployment properties between target environments, you'll need to:</span></span>

- <span data-ttu-id="5a9e6-122">各ターゲット環境の配置構成 (sqldeployment) ファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-122">Create a deployment configuration (.sqldeployment) file for each target environment.</span></span>
- <span data-ttu-id="5a9e6-123">展開構成ファイルをコマンドラインスイッチとして指定する VSDBCMD コマンドを作成します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-123">Create a VSDBCMD command that specifies the deployment configuration file as a command-line switch.</span></span>
- <span data-ttu-id="5a9e6-124">Microsoft Build Engine (MSBuild) プロジェクトファイル内の VSDBCMD コマンドをパラメーター化して、VSDBCMD オプションがターゲット環境に適したものになるようにします。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-124">Parameterize the VSDBCMD command in a Microsoft Build Engine (MSBuild) project file, so that the VSDBCMD options are appropriate to the target environment.</span></span>

<span data-ttu-id="5a9e6-125">このトピックでは、これらの各手順を実行する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-125">This topic will show you how to perform each of these procedures.</span></span>

## <a name="creating-environment-specific-deployment-configuration-files"></a><span data-ttu-id="5a9e6-126">環境固有の配置構成ファイルの作成</span><span class="sxs-lookup"><span data-stu-id="5a9e6-126">Creating Environment-Specific Deployment Configuration Files</span></span>

<span data-ttu-id="5a9e6-127">既定では、データベースプロジェクトには、*データベースの sqldeployment*という名前の単一の配置構成ファイルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-127">By default, a database project contains a single deployment configuration file named *Database.sqldeployment*.</span></span> <span data-ttu-id="5a9e6-128">このファイルを Visual Studio 2010 で開くと、使用可能なさまざまなデプロイオプションが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-128">If you open this file in Visual Studio 2010, you can see the different deployment options that are available to you:</span></span>

- <span data-ttu-id="5a9e6-129">**配置比較の照合順序**。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-129">**Deployment comparison collation**.</span></span> <span data-ttu-id="5a9e6-130">これにより、プロジェクトのデータベースの照合順序 (*変換元*の照合順序) と転送先サーバーのデータベース照合順序 (*ターゲット*照合順序) のどちらを使用するかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-130">This lets you choose whether to use the database collation of your project (the *source* collation) or the database collation of your destination server (the *target* collation).</span></span> <span data-ttu-id="5a9e6-131">ほとんどの場合、開発環境またはテスト環境に配置するときに、ソース照合順序を使用します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-131">In most cases, you'll want to use the source collation when you deploy to a development or test environment.</span></span> <span data-ttu-id="5a9e6-132">ステージング環境または運用環境に配置する場合は、相互運用性の問題を回避するために、ターゲットの照合順序を変更せずに残しておくことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-132">When you deploy to a staging or production environment, you'll usually want to leave the target collation unchanged to avoid any interoperability issues.</span></span>
- <span data-ttu-id="5a9e6-133">**データベースのプロパティを配置**します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-133">**Deploy database properties**.</span></span> <span data-ttu-id="5a9e6-134">これにより、データベースの*sqlsettings*ファイルで定義されているように、データベースのプロパティを適用するかどうかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-134">This lets you choose whether to apply the database properties, as defined in the *Database.sqlsettings* file.</span></span> <span data-ttu-id="5a9e6-135">データベースを初めて配置する場合は、データベースのプロパティを配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-135">When you deploy a database for the first time, you should deploy the database properties.</span></span> <span data-ttu-id="5a9e6-136">既存のデータベースを更新する場合は、プロパティが既に存在している必要があるため、再度配置する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-136">If you're updating an existing database, the properties should already be in place, and you shouldn't need to deploy them again.</span></span>
- <span data-ttu-id="5a9e6-137">**常にデータベースを再作成**します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-137">**Always re-create database**.</span></span> <span data-ttu-id="5a9e6-138">これにより、配置または増分変更を行うたびに対象データベースを再作成して、スキーマを使用してターゲットデータベースを最新の状態にするかどうかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-138">This lets you choose whether to re-create the target database every time you deploy or make incremental changes to bring the target database up to date with your schema.</span></span> <span data-ttu-id="5a9e6-139">データベースを再作成すると、既存のデータベース内のデータはすべて失われます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-139">If you re-create the database, you'll lose any data in the existing database.</span></span> <span data-ttu-id="5a9e6-140">そのため、ステージング環境または運用環境への配置では、通常、これを**false**に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-140">As such, you should usually set this to **false** for deployments to staging or production environments.</span></span>
- <span data-ttu-id="5a9e6-141">**データ損失が発生する可能性がある場合は、増分配置をブロック**します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-141">**Block incremental deployment if data loss might occur**.</span></span> <span data-ttu-id="5a9e6-142">これにより、データベーススキーマの変更によってデータが失われた場合に配置を停止するかどうかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-142">This lets you choose whether deployment should stop if a change to the database schema will cause the loss of data.</span></span> <span data-ttu-id="5a9e6-143">運用環境へのデプロイの場合は、通常、これを**true**に設定して、重要なデータを介入して保護する機会を与えます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-143">You typically set this to **true** for a deployment to a production environment, to give you the opportunity to intervene and protect any important data.</span></span> <span data-ttu-id="5a9e6-144">**[常にデータベースを再作成]** する を **[false]** に設定した場合、この設定は無効になります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-144">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="5a9e6-145">**デプロイをシングルユーザーモードで実行**します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-145">**Execute deployment in single-user mode**.</span></span> <span data-ttu-id="5a9e6-146">これは、通常、開発環境またはテスト環境では問題になりません。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-146">This is not usually an issue in development or test environments.</span></span> <span data-ttu-id="5a9e6-147">ただし、ステージング環境または運用環境への配置では、通常、これを**true**に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-147">However, you should typically set this to **true** for deployments to staging or production environments.</span></span> <span data-ttu-id="5a9e6-148">これにより、配置の実行中にユーザーがデータベースに変更を加えることを防止できます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-148">This prevents users from making changes to the database while the deployment is underway.</span></span>
- <span data-ttu-id="5a9e6-149">**配置前にデータベースをバックアップ**します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-149">**Back up database before deployment**.</span></span> <span data-ttu-id="5a9e6-150">通常、運用環境に配置するときは、データ損失に対する予防措置として、これを**true**に設定します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-150">You typically set this to **true** when you deploy to a production environment, as a precaution against data loss.</span></span> <span data-ttu-id="5a9e6-151">ステージング環境に配置するときに、ステージングデータベースに大量のデータが含まれている場合は、これを**true**に設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-151">You may also want to set it to **true** when you deploy to a staging environment, if your staging database contains a lot of data.</span></span>
- <span data-ttu-id="5a9e6-152">**ターゲットデータベースに存在するが、データベースプロジェクトに含まれていないオブジェクトに対して DROP ステートメントを生成**します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-152">**Generate DROP statements for objects that are in the target database but that are not in the database project**.</span></span> <span data-ttu-id="5a9e6-153">ほとんどの場合、これは、データベースに対する増分変更を行うための不可欠で重要な部分です。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-153">In most cases, this is an integral and essential part of making incremental changes to a database.</span></span> <span data-ttu-id="5a9e6-154">**[常にデータベースを再作成]** する を **[false]** に設定した場合、この設定は無効になります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-154">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="5a9e6-155">**ALTER ASSEMBLY ステートメントを使用して CLR 型を更新しないで**ください。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-155">**Do not use ALTER ASSEMBLY statements to update CLR types**.</span></span> <span data-ttu-id="5a9e6-156">この設定では、共通言語ランタイム (CLR) 型を新しいアセンブリバージョンに更新 SQL Server 方法を決定します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-156">This setting determines how SQL Server should update common language runtime (CLR) types to newer assembly versions.</span></span> <span data-ttu-id="5a9e6-157">ほとんどのシナリオでは、この値を**false**に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-157">This should be set to **false** in most scenarios.</span></span>

<span data-ttu-id="5a9e6-158">次の表は、さまざまな変換先環境の一般的な配置設定を示しています。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-158">This table shows typical deployment settings for different destination environments.</span></span> <span data-ttu-id="5a9e6-159">ただし、実際の要件によっては、設定が異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-159">However, your settings may be different depending on your exact requirements.</span></span>

|  | <span data-ttu-id="5a9e6-160">開発者/テスト</span><span class="sxs-lookup"><span data-stu-id="5a9e6-160">Developer/Test</span></span> | <span data-ttu-id="5a9e6-161">ステージング/統合</span><span class="sxs-lookup"><span data-stu-id="5a9e6-161">Staging/Integration</span></span> | <span data-ttu-id="5a9e6-162">Production</span><span class="sxs-lookup"><span data-stu-id="5a9e6-162">Production</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="5a9e6-163">**配置比較の照合順序**</span><span class="sxs-lookup"><span data-stu-id="5a9e6-163">**Deployment comparison collation**</span></span> | <span data-ttu-id="5a9e6-164">source</span><span class="sxs-lookup"><span data-stu-id="5a9e6-164">Source</span></span> | <span data-ttu-id="5a9e6-165">移行先</span><span class="sxs-lookup"><span data-stu-id="5a9e6-165">Target</span></span> | <span data-ttu-id="5a9e6-166">移行先</span><span class="sxs-lookup"><span data-stu-id="5a9e6-166">Target</span></span> |
| <span data-ttu-id="5a9e6-167">**データベースプロパティの配置**</span><span class="sxs-lookup"><span data-stu-id="5a9e6-167">**Deploy database properties**</span></span> | <span data-ttu-id="5a9e6-168">True</span><span class="sxs-lookup"><span data-stu-id="5a9e6-168">True</span></span> | <span data-ttu-id="5a9e6-169">初回のみ</span><span class="sxs-lookup"><span data-stu-id="5a9e6-169">First time only</span></span> | <span data-ttu-id="5a9e6-170">初回のみ</span><span class="sxs-lookup"><span data-stu-id="5a9e6-170">First time only</span></span> |
| <span data-ttu-id="5a9e6-171">**データベースを常に再作成する**</span><span class="sxs-lookup"><span data-stu-id="5a9e6-171">**Always re-create database**</span></span> | <span data-ttu-id="5a9e6-172">True</span><span class="sxs-lookup"><span data-stu-id="5a9e6-172">True</span></span> | <span data-ttu-id="5a9e6-173">False</span><span class="sxs-lookup"><span data-stu-id="5a9e6-173">False</span></span> | <span data-ttu-id="5a9e6-174">False</span><span class="sxs-lookup"><span data-stu-id="5a9e6-174">False</span></span> |
| <span data-ttu-id="5a9e6-175">**データ損失が発生する可能性がある場合に増分配置をブロックする**</span><span class="sxs-lookup"><span data-stu-id="5a9e6-175">**Block incremental deployment if data loss might occur**</span></span> | <span data-ttu-id="5a9e6-176">False</span><span class="sxs-lookup"><span data-stu-id="5a9e6-176">False</span></span> | <span data-ttu-id="5a9e6-177">可能性あり</span><span class="sxs-lookup"><span data-stu-id="5a9e6-177">Maybe</span></span> | <span data-ttu-id="5a9e6-178">True</span><span class="sxs-lookup"><span data-stu-id="5a9e6-178">True</span></span> |
| <span data-ttu-id="5a9e6-179">**シングルユーザーモードで配置スクリプトを実行する**</span><span class="sxs-lookup"><span data-stu-id="5a9e6-179">**Execute deployment script in single-user mode**</span></span> | <span data-ttu-id="5a9e6-180">False</span><span class="sxs-lookup"><span data-stu-id="5a9e6-180">False</span></span> | <span data-ttu-id="5a9e6-181">True</span><span class="sxs-lookup"><span data-stu-id="5a9e6-181">True</span></span> | <span data-ttu-id="5a9e6-182">True</span><span class="sxs-lookup"><span data-stu-id="5a9e6-182">True</span></span> |
| <span data-ttu-id="5a9e6-183">**配置前にデータベースをバックアップする**</span><span class="sxs-lookup"><span data-stu-id="5a9e6-183">**Back up database before deployment**</span></span> | <span data-ttu-id="5a9e6-184">False</span><span class="sxs-lookup"><span data-stu-id="5a9e6-184">False</span></span> | <span data-ttu-id="5a9e6-185">可能性あり</span><span class="sxs-lookup"><span data-stu-id="5a9e6-185">Maybe</span></span> | <span data-ttu-id="5a9e6-186">True</span><span class="sxs-lookup"><span data-stu-id="5a9e6-186">True</span></span> |
| <span data-ttu-id="5a9e6-187">**ターゲットデータベースに存在するが、データベースプロジェクトに含まれていないオブジェクトに対して DROP ステートメントを生成する**</span><span class="sxs-lookup"><span data-stu-id="5a9e6-187">**Generate DROP statements for objects that are in the target database but that are not in the database project**</span></span> | <span data-ttu-id="5a9e6-188">False</span><span class="sxs-lookup"><span data-stu-id="5a9e6-188">False</span></span> | <span data-ttu-id="5a9e6-189">True</span><span class="sxs-lookup"><span data-stu-id="5a9e6-189">True</span></span> | <span data-ttu-id="5a9e6-190">True</span><span class="sxs-lookup"><span data-stu-id="5a9e6-190">True</span></span> |
| <span data-ttu-id="5a9e6-191">**ALTER ASSEMBLY ステートメントを使用して CLR 型を更新しない**</span><span class="sxs-lookup"><span data-stu-id="5a9e6-191">**Do not use ALTER ASSEMBLY statements to update CLR types**</span></span> | <span data-ttu-id="5a9e6-192">False</span><span class="sxs-lookup"><span data-stu-id="5a9e6-192">False</span></span> | <span data-ttu-id="5a9e6-193">False</span><span class="sxs-lookup"><span data-stu-id="5a9e6-193">False</span></span> | <span data-ttu-id="5a9e6-194">False</span><span class="sxs-lookup"><span data-stu-id="5a9e6-194">False</span></span> |

> [!NOTE]
> <span data-ttu-id="5a9e6-195">データベース配置プロパティと環境に関する考慮事項の詳細については、「[データベースプロジェクト設定の概要](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)」、「[方法: 配置の詳細のプロパティを構成する](https://msdn.microsoft.com/library/dd172125.aspx)」、「[分離開発環境にデータベースを構築して配置](https://msdn.microsoft.com/library/dd193409.aspx)する」、および「データベースを[ビルドしてステージング環境または運用環境に配置する](https://msdn.microsoft.com/library/dd193413.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-195">For more information on database deployment properties and environment considerations, see [An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [How to: Configure Properties for Deployment Details](https://msdn.microsoft.com/library/dd172125.aspx), [Build and Deploy Database to an Isolated Development Environment](https://msdn.microsoft.com/library/dd193409.aspx), and [Build and Deploy Databases to a Staging or Production Environment](https://msdn.microsoft.com/library/dd193413.aspx).</span></span>

<span data-ttu-id="5a9e6-196">複数の変換先へのデータベースプロジェクトの配置をサポートするには、各ターゲット環境の配置構成ファイルを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-196">To support the deployment of a database project to multiple destinations, you should create a deployment configuration file for each target environment.</span></span>

<span data-ttu-id="5a9e6-197">**環境固有の構成ファイルを作成するには**</span><span class="sxs-lookup"><span data-stu-id="5a9e6-197">**To create an environment-specific configuration file**</span></span>

1. <span data-ttu-id="5a9e6-198">Visual Studio 2010 の **[ソリューションエクスプローラー]** ウィンドウで、データベースプロジェクトを右クリックし、 **[プロパティ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-198">In Visual Studio 2010, in the **Solution Explorer** window, right-click your database project, and then click **Properties**.</span></span>
2. <span data-ttu-id="5a9e6-199">データベースプロジェクトのプロパティページの **[配置]** タブで、 **[配置構成ファイル]** 行の **[新規作成]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-199">On the database project properties page, on the **Deploy** tab, in the **Deployment configuration file** row, click **New**.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image1.png)
3. <span data-ttu-id="5a9e6-200">**[新しい展開構成ファイル]** ダイアログボックスで、ファイルにわかりやすい名前 (たとえば、「 **testenvironment. sqldeployment**」) を指定し、 **[保存]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-200">In the **New Deployment Configuration File** dialog box, give the file a meaningful name (for example, **TestEnvironment.sqldeployment**), and then click **Save**.</span></span>
4. <span data-ttu-id="5a9e6-201">*[ファイル名] \* \* \* sqldeployment*\* ページで、配置のプロパティを設定します。展開先の環境の要件に合わせて、ファイルを保存します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-201">On the *[Filename]\*\*\*.sqldeployment*\* page, set the deployment properties to match the requirements of your destination environment, and then save the file.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image2.png)
5. <span data-ttu-id="5a9e6-202">データベースプロジェクトの Properties フォルダーに新しいファイルが追加されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-202">Notice that the new file is added to the Properties folder in your database project.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image3.png)

## <a name="specifying-the-deployment-configuration-file-in-vsdbcmd"></a><span data-ttu-id="5a9e6-203">VSDBCMD での展開構成ファイルの指定</span><span class="sxs-lookup"><span data-stu-id="5a9e6-203">Specifying the Deployment Configuration File in VSDBCMD</span></span>

<span data-ttu-id="5a9e6-204">Visual Studio 2010 内でソリューション構成 (デバッグやリリースなど) を使用する場合は、配置構成ファイルを各構成に関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-204">When you use solution configurations (like Debug and Release) within Visual Studio 2010, you can associate a deployment configuration file with each configuration.</span></span> <span data-ttu-id="5a9e6-205">特定の構成をビルドすると、ビルドプロセスによって、構成固有の配置構成ファイルを指す構成固有の配置マニフェストファイルが生成されます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-205">When you build a particular configuration, the build process generates a configuration-specific deployment manifest file that points to the configuration-specific deployment configuration file.</span></span> <span data-ttu-id="5a9e6-206">ただし、このチュートリアルで説明されているデプロイ方法の主な目的の1つは、Visual Studio 2010 およびソリューション構成を使用せずに、デプロイプロセスを制御できるようにすることです。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-206">However, one of the main aims of the approach to deployment described in these tutorials is to give people the ability to control the deployment process without using Visual Studio 2010 and solution configurations.</span></span> <span data-ttu-id="5a9e6-207">この方法では、ターゲットの配置環境に関係なく、ソリューション構成は同じです。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-207">In this approach, the solution configuration is the same regardless of the target deployment environment.</span></span> <span data-ttu-id="5a9e6-208">特定の配置先環境へのデータベースの配置を調整するには、VSDBCMD コマンドラインオプションを使用して、配置構成ファイルを指定します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-208">To tailor your database deployment to a specific destination environment, you can use the VSDBCMD command-line options to specify your deployment configuration file.</span></span>

<span data-ttu-id="5a9e6-209">VSDBCMD で展開構成ファイルを指定するには、 **p:/deploymentconfigurationfile**スイッチを使用して、ファイルへの完全パスを指定します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-209">To specify a deployment configuration file in your VSDBCMD, use the **p:/DeploymentConfigurationFile** switch and provide the full path to your file.</span></span> <span data-ttu-id="5a9e6-210">これは、配置マニフェストによって識別される配置構成ファイルよりも優先されます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-210">This will override the deployment configuration file that the deployment manifest identifies.</span></span> <span data-ttu-id="5a9e6-211">たとえば、次の VSDBCMD コマンドを使用して、 **Contactmanager**データベースをテスト環境に配置できます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-211">For example, you could use this VSDBCMD command to deploy the **ContactManager** database to a test environment:</span></span>

[!code-console[Main](customizing-database-deployments-for-multiple-environments/samples/sample1.cmd)]

> [!NOTE]
> <span data-ttu-id="5a9e6-212">ビルドプロセスでは、ファイルを出力ディレクトリにコピーするときに、sqldeployment ファイルの名前を変更することができます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-212">Note that the build process may rename your .sqldeployment file when it copies the file to the output directory.</span></span>

<span data-ttu-id="5a9e6-213">配置前または配置後の SQL スクリプトで SQL コマンド変数を使用する場合は、同様の方法を使用して、環境固有の sqlcmdvars ファイルを配置に関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-213">If you use SQL command variables in your pre-deployment or post-deployment SQL scripts, you can use a similar approach to associate an environment-specific .sqlcmdvars file with your deployment.</span></span> <span data-ttu-id="5a9e6-214">この場合は、 **p:/SqlCommandVariablesFile**スイッチを使用して、sqlcmdvars ファイルを識別します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-214">In this case, you use the **p:/SqlCommandVariablesFile** switch to identify your .sqlcmdvars file.</span></span>

## <a name="running-the-vsdbcmd-command-from-an-msbuild-project-file"></a><span data-ttu-id="5a9e6-215">MSBuild プロジェクトファイルからの VSDBCMD コマンドの実行</span><span class="sxs-lookup"><span data-stu-id="5a9e6-215">Running the VSDBCMD Command from an MSBuild Project File</span></span>

<span data-ttu-id="5a9e6-216">Msbuild ターゲット内の**Exec**タスクを使用して、msbuild プロジェクトファイルから VSDBCMD コマンドを呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-216">You can invoke a VSDBCMD command from an MSBuild project file by using an **Exec** task within an MSBuild target.</span></span> <span data-ttu-id="5a9e6-217">最も単純な形式では、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-217">In its simplest form, it would look like this:</span></span>

[!code-xml[Main](customizing-database-deployments-for-multiple-environments/samples/sample2.xml)]

- <span data-ttu-id="5a9e6-218">実際には、プロジェクトファイルを読み取って再利用しやすくするために、さまざまなコマンドラインパラメーターを格納するプロパティを作成します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-218">In practice, to make your project files easy to read and reuse, you'll want to create properties to store the various command-line parameters.</span></span> <span data-ttu-id="5a9e6-219">これにより、ユーザーは、環境固有のプロジェクトファイルにプロパティ値を提供したり、MSBuild コマンドラインから既定値をオーバーライドしたりすることが容易になります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-219">This makes it easier for users to provide property values in an environment-specific project file or to override default values from the MSBuild command line.</span></span> <span data-ttu-id="5a9e6-220">「[プロジェクトファイルについて](../web-deployment-in-the-enterprise/understanding-the-project-file.md)」で説明されているプロジェクトファイルの分割方法を使用する場合は、次の2つのファイル間でビルドの命令とプロパティを分割する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-220">If you use the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), you should divide your build instructions and properties between the two files accordingly:</span></span>
- <span data-ttu-id="5a9e6-221">環境固有の設定 (配置構成ファイル名、データベース接続文字列、ターゲットデータベース名など) は、環境固有のプロジェクトファイルで指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-221">Environment-specific settings, like the deployment configuration filename, the database connection string, and the target database name, should go in the environment-specific project file.</span></span>
- <span data-ttu-id="5a9e6-222">VSDBCMD コマンドを実行する MSBuild ターゲットは、VSDBCMD 実行可能ファイルの場所などの汎用プロパティと共に、ユニバーサルプロジェクトファイルに含まれている必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-222">The MSBuild target that runs the VSDBCMD command, together with any universal properties like the location of the VSDBCMD executable, should go in the universal project file.</span></span>

<span data-ttu-id="5a9e6-223">また、VSDBCMD を呼び出す前に、データベースプロジェクトをビルドして、deploymanifest ファイルが作成され、使用できる状態になっていることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-223">You should also ensure that you build the database project before you invoke VSDBCMD so that the .deploymanifest file is created and ready to use.</span></span> <span data-ttu-id="5a9e6-224">このアプローチの完全な例については、トピック「[ビルドプロセスについ](../web-deployment-in-the-enterprise/understanding-the-build-process.md)て」を参照してください。このチュートリアルでは、 [Contact Manager サンプルソリューション](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)のプロジェクトファイルについて説明します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-224">You can see a full example of this approach in the topic [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md), which walks you through the project files in the [Contact Manager sample solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="5a9e6-225">まとめ</span><span class="sxs-lookup"><span data-stu-id="5a9e6-225">Conclusion</span></span>

<span data-ttu-id="5a9e6-226">このトピックでは、MSBuild と VSDBCMD を使用してデータベースプロジェクトを配置するときに、さまざまな変換先環境に対してデータベースプロパティを調整する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-226">This topic described how you can tailor database properties to different destination environments when you deploy database projects using MSBuild and VSDBCMD.</span></span> <span data-ttu-id="5a9e6-227">この方法は、大規模なエンタープライズ規模のソリューションの一部としてデータベースプロジェクトを配置する必要がある場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-227">This approach is useful when you need to deploy database projects as part of larger, enterprise-scale solutions.</span></span> <span data-ttu-id="5a9e6-228">これらのソリューションは、多くの場合、サンドボックス化された開発やテスト環境、ステージングまたは統合プラットフォーム、運用環境またはライブ環境などの複数の宛先にデプロイされます。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-228">These solutions are often deployed to multiple destinations, like sandboxed development or test environments, staging or integration platforms, and production or live environments.</span></span> <span data-ttu-id="5a9e6-229">これらの各ターゲット環境では、通常、データベース配置プロパティの一意のセットが必要です。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-229">Each of these target environments typically requires a unique set of database deployment properties.</span></span>

## <a name="further-reading"></a><span data-ttu-id="5a9e6-230">参考資料</span><span class="sxs-lookup"><span data-stu-id="5a9e6-230">Further Reading</span></span>

<span data-ttu-id="5a9e6-231">VSDBCMD を使用したデータベースプロジェクトの配置の詳細については、「[データベースプロジェクトの配置](../web-deployment-in-the-enterprise/deploying-database-projects.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-231">For more information on deploying database projects using VSDBCMD.exe, see [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span> <span data-ttu-id="5a9e6-232">カスタム MSBuild プロジェクトファイルを使用した配置プロセスの制御の詳細については、「[プロジェクトファイルについ](../web-deployment-in-the-enterprise/understanding-the-project-file.md)て」および「[ビルドプロセスについ](../web-deployment-in-the-enterprise/understanding-the-build-process.md)て」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-232">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="5a9e6-233">次の MSDN の記事では、データベースの配置に関する一般的なガイダンスを提供しています。</span><span class="sxs-lookup"><span data-stu-id="5a9e6-233">These articles on MSDN provide more general guidance on database deployment:</span></span>

- <span data-ttu-id="5a9e6-234">[データベースプロジェクト設定の概要](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="5a9e6-234">[An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span></span>
- [<span data-ttu-id="5a9e6-235">方法: 配置の詳細のプロパティを構成する</span><span class="sxs-lookup"><span data-stu-id="5a9e6-235">How to: Configure Properties for Deployment Details</span></span>](https://msdn.microsoft.com/library/dd172125.aspx)
- [<span data-ttu-id="5a9e6-236">データベースをビルドし、分離開発環境に配置する</span><span class="sxs-lookup"><span data-stu-id="5a9e6-236">Build and Deploy Databases to an Isolated Development Environment</span></span>](https://msdn.microsoft.com/library/dd193409.aspx)
- [<span data-ttu-id="5a9e6-237">ステージング環境または運用環境へのデータベースの構築と配置</span><span class="sxs-lookup"><span data-stu-id="5a9e6-237">Build and Deploy Databases to a Staging or Production Environment</span></span>](https://msdn.microsoft.com/library/dd193413.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="5a9e6-238">[前へ](performing-a-what-if-deployment.md)
> [次へ](deploying-database-role-memberships-to-test-environments.md)</span><span class="sxs-lookup"><span data-stu-id="5a9e6-238">[Previous](performing-a-what-if-deployment.md)
[Next](deploying-database-role-memberships-to-test-environments.md)</span></span>
