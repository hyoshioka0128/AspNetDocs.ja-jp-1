---
uid: web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-production
title: Visual Studio を使用して ASP.NET Web の展開:運用環境に展開する |Microsoft Docs
author: tdykstra
description: このチュートリアル シリーズは、展開する方法を示します (発行) ASP.NET web アプリケーションを Azure App Service Web Apps、またはサード パーティのホスティング プロバイダーを使用して、.
ms.author: riande
ms.date: 02/15/2013
ms.assetid: 416438a1-3b2f-4d27-bf53-6b76223c33bf
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-production
msc.type: authoredcontent
ms.openlocfilehash: b9c4a4d035c78b4f4c53942219ccfa3048c7a82b
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/06/2019
ms.locfileid: "65133817"
---
# <a name="aspnet-web-deployment-using-visual-studio-deploying-to-production"></a><span data-ttu-id="87fea-103">Visual Studio を使用して ASP.NET Web の展開:運用環境に配置する</span><span class="sxs-lookup"><span data-stu-id="87fea-103">ASP.NET Web Deployment using Visual Studio: Deploying to Production</span></span>

<span data-ttu-id="87fea-104">によって[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="87fea-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="87fea-105">スタート プロジェクトをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="87fea-105">Download Starter Project</span></span>](http://go.microsoft.com/fwlink/p/?LinkId=282627)

> <span data-ttu-id="87fea-106">このチュートリアル シリーズは、展開する方法を示します (発行) ASP.NET web アプリケーションを Azure App Service Web Apps、またはサード パーティのホスティング プロバイダーを Visual Studio 2012 または Visual Studio 2010 を使用しています。</span><span class="sxs-lookup"><span data-stu-id="87fea-106">This tutorial series shows you how to deploy (publish) an ASP.NET web application to Azure App Service Web Apps or to a third-party hosting provider, by using Visual Studio 2012 or Visual Studio 2010.</span></span> <span data-ttu-id="87fea-107">系列の詳細については、次を参照してください。[シリーズの最初のチュートリアル](introduction.md)します。</span><span class="sxs-lookup"><span data-stu-id="87fea-107">For information about the series, see [the first tutorial in the series](introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="87fea-108">概要</span><span class="sxs-lookup"><span data-stu-id="87fea-108">Overview</span></span>

<span data-ttu-id="87fea-109">このチュートリアルでは、Microsoft Azure アカウントを設定する、ステージングと運用環境を作成およびステージングに ASP.NET web アプリケーションを配置して、Visual Studio の 1 回のクリックを使用して、運用環境の発行機能。</span><span class="sxs-lookup"><span data-stu-id="87fea-109">In this tutorial, you set up a Microsoft Azure account, create staging and production environments, and deploy your ASP.NET web application to the staging and production environments by using the Visual Studio one-click publish feature.</span></span>

<span data-ttu-id="87fea-110">場合は、サード パーティのホスティング プロバイダーにデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="87fea-110">If you prefer, you can deploy to a third-party hosting provider.</span></span> <span data-ttu-id="87fea-111">このチュートリアルで説明する手順のほとんどは、する点を除いて、各プロバイダーは独自のユーザー インターフェイスのアカウントと web サイトの管理、ホスティング プロバイダーまたは Azure では、同じです。</span><span class="sxs-lookup"><span data-stu-id="87fea-111">Most of the procedures described in this tutorial are the same for a hosting provider or for Azure, except that each provider has its own user interface for account and web site management.</span></span> <span data-ttu-id="87fea-112">ホスティング プロバイダーを見つけることができます、[プロバイダーのギャラリー](https://www.microsoft.com/web/hosting) Microsoft.com web サイト。</span><span class="sxs-lookup"><span data-stu-id="87fea-112">You can find a hosting provider in the [gallery of providers](https://www.microsoft.com/web/hosting) on the Microsoft.com web site.</span></span>

<span data-ttu-id="87fea-113">リマインダー:エラー メッセージを取得する、または、チュートリアルを進めるときに機能しない、必ずこのチュートリアル シリーズでトラブルシューティングのページを確認してください。</span><span class="sxs-lookup"><span data-stu-id="87fea-113">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the Troubleshooting page in this tutorial series.</span></span>

## <a name="get-a-microsoft-azure-account"></a><span data-ttu-id="87fea-114">Microsoft Azure アカウントを取得します。</span><span class="sxs-lookup"><span data-stu-id="87fea-114">Get a Microsoft Azure account</span></span>

<span data-ttu-id="87fea-115">Azure アカウントがない場合は、ほんの数分で無料試用版アカウントを作成できます。</span><span class="sxs-lookup"><span data-stu-id="87fea-115">If you don't already have an Azure account, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="87fea-116">詳細については、[Azure 無料試用版](https://azure.microsoft.com/free/?WT.mc_id=A443DD604)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="87fea-116">For details, see [Azure Free Trial](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span></span>

## <a name="create-a-staging-environment"></a><span data-ttu-id="87fea-117">ステージング環境を作成します。</span><span class="sxs-lookup"><span data-stu-id="87fea-117">Create a staging environment</span></span>

> [!NOTE]
> <span data-ttu-id="87fea-118">このチュートリアルを作成したので、Azure App Service には、ステージングと運用環境を作成するためのプロセスの多くを自動化する新しい機能が追加されました。</span><span class="sxs-lookup"><span data-stu-id="87fea-118">Since this tutorial was written, Azure App Service added a new feature to automate many of the processes for creating staging and production environments.</span></span> <span data-ttu-id="87fea-119">参照してください[を設定すると、Azure App Service で web アプリのステージング環境](https://azure.microsoft.com/documentation/articles/web-sites-staged-publishing/)します。</span><span class="sxs-lookup"><span data-stu-id="87fea-119">See [Set up staging environments for web apps in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-staged-publishing/).</span></span>

<span data-ttu-id="87fea-120">説明したように、[環境のテストのチュートリアルへのデプロイ](deploying-to-iis.md)最も信頼性の高いテスト環境は運用環境の web サイトと同様にしているホスティング プロバイダーの web サイト。</span><span class="sxs-lookup"><span data-stu-id="87fea-120">As explained in the [Deploy to the Test Environment tutorial](deploying-to-iis.md), the most reliable test environment is a web site at the hosting provider that's just like the production web site.</span></span> <span data-ttu-id="87fea-121">多くのホスティング プロバイダーには、重要な追加の費用に対してこの利点を比較検討する必要が、Azure でステージング アプリとして追加の無料の web アプリを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="87fea-121">At many hosting providers you would have to weigh the benefits of this against significant additional cost, but in Azure you can create an additional free web app as your staging app.</span></span> <span data-ttu-id="87fea-122">データベースが必要であり、実稼働データベースの経費をそのため、追加の費用なし] または [最小です。</span><span class="sxs-lookup"><span data-stu-id="87fea-122">You also need a database, and the additional expense for that over the expense of your production database will be either none or minimal.</span></span> <span data-ttu-id="87fea-123">Azure でお支払いいただきます。 各データベースに対してではなく、使用するデータベース記憶域の量、ステージング環境で使用する追加のストレージの量を最小限になります。</span><span class="sxs-lookup"><span data-stu-id="87fea-123">In Azure you pay for the amount of database storage you use rather than for each database, and the amount of additional storage you'll use in staging will be minimal.</span></span>

<span data-ttu-id="87fea-124">説明したように、[テスト環境のチュートリアルへのデプロイ](deploying-to-iis.md)、ステージング環境と運用環境の 1 つのデータベースに、2 つのデータベースをデプロイすることにします。</span><span class="sxs-lookup"><span data-stu-id="87fea-124">As explained in the [Deploy to the Test Environment tutorial](deploying-to-iis.md), in staging and production you're going to deploy your two databases into one database.</span></span> <span data-ttu-id="87fea-125">それらを分離する場合は、プロセスは同じになりますが、環境ごとに、追加のデータベースを作成し、発行プロファイルを作成するときに、各データベースの正しいコピー先文字列が選択されます。 します。</span><span class="sxs-lookup"><span data-stu-id="87fea-125">If you wanted to keep them separate, the process would be the same except that you'd create an additional database for each environment and you would select the correct destination string for each database when you create the publish profile.</span></span>

<span data-ttu-id="87fea-126">チュートリアルのこのセクションでは、web アプリとステージング環境では、使用するデータベースを作成し、ステージングへのデプロイを作成し、実稼働環境に展開する前にテストがあります。</span><span class="sxs-lookup"><span data-stu-id="87fea-126">In this section of the tutorial you'll create a web app and database to use for the staging environment, and you'll deploy to staging and test there before creating and deploying to the production environment.</span></span>

> [!NOTE]
> <span data-ttu-id="87fea-127">次の手順では、Azure 管理ポータルを使用して Azure App Service で web アプリを作成する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="87fea-127">The following steps show how to create a web app in Azure App Service by using the Azure management portal.</span></span> <span data-ttu-id="87fea-128">Azure SDK の最新のバージョンで行うことができますもこのサーバー エクスプ ローラーを使用して、Visual Studio を離れることがなく。</span><span class="sxs-lookup"><span data-stu-id="87fea-128">In the latest version of the Azure SDK, you can also do this without leaving Visual Studio, by using Server Explorer.</span></span> <span data-ttu-id="87fea-129">Visual Studio 2013 での発行 ダイアログ ボックスから直接 web アプリを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="87fea-129">In Visual Studio 2013, you can also create a web app directly from the Publish dialog.</span></span> <span data-ttu-id="87fea-130">詳細については、次を参照してください。 [Azure App Service で ASP.NET web アプリを作成します。](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)</span><span class="sxs-lookup"><span data-stu-id="87fea-130">For more information, see [Create an ASP.NET web app in Azure App Service.](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)</span></span>

1. <span data-ttu-id="87fea-131">[Azure 管理ポータル](https://manage.windowsazure.com/)、 をクリックして**Websites**、順にクリックします**新規**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-131">In the [Azure Management Portal](https://manage.windowsazure.com/), click **Websites**, and then click **New**.</span></span>
2. <span data-ttu-id="87fea-132">クリックして**web サイト**、 をクリックし、**カスタム作成**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-132">Click **Website**, and then click **Custom Create**.</span></span>

    <span data-ttu-id="87fea-133">**新規 web サイト - カスタム作成**ウィザードが開きます。</span><span class="sxs-lookup"><span data-stu-id="87fea-133">The **New Website - Custom Create** wizard opens.</span></span> <span data-ttu-id="87fea-134">**カスタム作成**ウィザードでは、同時に web サイトとデータベースを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="87fea-134">The **Custom Create** wizard enables you to create a web site and a database at the same time.</span></span>
3. <span data-ttu-id="87fea-135">**Web サイトの作成**手順と、ウィザードの文字列を入力、 **URL**アプリケーションの一意の URL として使用する ボックスのステージング環境です。</span><span class="sxs-lookup"><span data-stu-id="87fea-135">In the **Create Website** step of the wizard, enter a string in the **URL** box to use as the unique URL for your application's staging environment.</span></span> <span data-ttu-id="87fea-136">たとえば、ContosoUniversity staging123 (ContosoUniversity ステージングが実行される場合に一意にする最後にランダムな数値を含む) を入力します。</span><span class="sxs-lookup"><span data-stu-id="87fea-136">For example, enter ContosoUniversity-staging123 (including random numbers at the end to make it unique in case ContosoUniversity-staging is taken).</span></span>

    <span data-ttu-id="87fea-137">完全な URL は、ここで入力とテキスト ボックスの横に表示されるサフィックスで構成されます。</span><span class="sxs-lookup"><span data-stu-id="87fea-137">The complete URL will consist of what you enter here plus the suffix that you see next to the text box.</span></span>
4. <span data-ttu-id="87fea-138">**リージョン**ドロップダウン リストで、地に最も近いリージョンを選択します。</span><span class="sxs-lookup"><span data-stu-id="87fea-138">In the **Region** drop-down list, choose the region that is closest to you.</span></span>

    <span data-ttu-id="87fea-139">この設定では、web アプリが実行されるデータ センターを指定します。</span><span class="sxs-lookup"><span data-stu-id="87fea-139">This setting specifies which data center your web app will run in.</span></span>
5. <span data-ttu-id="87fea-140">**データベース**ドロップダウン リストで、選択**新しい SQL データベースの作成**です。</span><span class="sxs-lookup"><span data-stu-id="87fea-140">In the **Database** drop-down list, choose **Create a new SQL database**.</span></span>
6. <span data-ttu-id="87fea-141">**DB 接続文字列名**ボックスで、既定値をそのまま*DefaultConnection*します。</span><span class="sxs-lookup"><span data-stu-id="87fea-141">In the **DB Connection String Name** box, leave the default value, *DefaultConnection*.</span></span>
7. <span data-ttu-id="87fea-142">ボックスの下部にある右を指している矢印をクリックします。</span><span class="sxs-lookup"><span data-stu-id="87fea-142">Click the arrow that points to the right at the bottom of the box.</span></span>

    <span data-ttu-id="87fea-143">次の図は、 **web サイトの作成** ダイアログ ボックスで、サンプルの値。</span><span class="sxs-lookup"><span data-stu-id="87fea-143">The following illustration shows the **Create Website** dialog with sample values in it.</span></span> <span data-ttu-id="87fea-144">URL と入力したリージョンは別になります。</span><span class="sxs-lookup"><span data-stu-id="87fea-144">The URL and Region that you have entered will be different.</span></span>

    ![Web サイトを作成します。](deploying-to-production/_static/image1.png)

    <span data-ttu-id="87fea-146">ウィザード、**データベース設定を指定**手順。</span><span class="sxs-lookup"><span data-stu-id="87fea-146">The wizard advances to the **Specify database settings** step.</span></span>
8. <span data-ttu-id="87fea-147">**名前**ボックスに、入力*ContosoUniversity*さらにそれを一意にするなどのランダムな数値*ContosoUniversity123*します。</span><span class="sxs-lookup"><span data-stu-id="87fea-147">In the **Name** box, enter *ContosoUniversity* plus a random number to make it unique, for example *ContosoUniversity123*.</span></span>
9. <span data-ttu-id="87fea-148">**Server**ボックスで、**新しい SQL Database Server**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-148">In the **Server** box, select **New SQL Database Server**.</span></span>
10. <span data-ttu-id="87fea-149">管理者名とパスワードを入力します。</span><span class="sxs-lookup"><span data-stu-id="87fea-149">Enter an administrator name and password.</span></span>

    <span data-ttu-id="87fea-150">既存の名前とパスワードでを入力することはありません。</span><span class="sxs-lookup"><span data-stu-id="87fea-150">You aren't entering an existing name and password here.</span></span> <span data-ttu-id="87fea-151">新しい名前と後、データベースにアクセスするときに使用するには、現在定義しているパスワードを入力してください。</span><span class="sxs-lookup"><span data-stu-id="87fea-151">You're entering a new name and password that you're defining now to use later when you access the database.</span></span>
11. <span data-ttu-id="87fea-152">**リージョン**ボックスで、web アプリの選択したのと同じリージョンを選択します。</span><span class="sxs-lookup"><span data-stu-id="87fea-152">In the **Region** box, choose the same region that you chose for the web app.</span></span>

    <span data-ttu-id="87fea-153">Web サーバーとデータベース サーバーと同じリージョンに置くことは最適なパフォーマンスを提供し、費用を最小限に抑えられます。</span><span class="sxs-lookup"><span data-stu-id="87fea-153">Keeping the web server and the database server in the same region gives you the best performance and minimizes expenses.</span></span>
12. <span data-ttu-id="87fea-154">完了することを示すボックスの下部にあるチェック マークをクリックします。</span><span class="sxs-lookup"><span data-stu-id="87fea-154">Click the check mark at the bottom of the box to indicate that you're finished.</span></span>

    <span data-ttu-id="87fea-155">次の図は、**データベース設定を指定** ダイアログ ボックスで、サンプルの値。</span><span class="sxs-lookup"><span data-stu-id="87fea-155">The following illustration shows the **Specify database settings** dialog with sample values in it.</span></span> <span data-ttu-id="87fea-156">入力した値が異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="87fea-156">The values you have entered may be different.</span></span>

    ![データベースの設定手順の新しい web サイト - データベースとともに作成ウィザード](deploying-to-production/_static/image2.png)

    <span data-ttu-id="87fea-158">管理ポータルの web サイトのページに戻り、**状態**列は、web アプリが作成されていることを示しています。</span><span class="sxs-lookup"><span data-stu-id="87fea-158">The Management Portal returns to the Websites page, and the **Status** column shows that the web app is being created.</span></span> <span data-ttu-id="87fea-159">(通常、1 分未満)、しばらくしてから、**状態**列は、web アプリが正常に作成されたことを示しています。</span><span class="sxs-lookup"><span data-stu-id="87fea-159">After a while (typically less than a minute), the **Status** column shows that the web app was successfully created.</span></span> <span data-ttu-id="87fea-160">自分のアカウントにある web アプリの数を横に表示、左側のナビゲーション バーで、 **Websites**アイコン、およびデータベースの数が横に表示されます、 **SQL データベース**アイコン。</span><span class="sxs-lookup"><span data-stu-id="87fea-160">In the navigation bar at the left, the number of web apps you have in your account appears next to the **Websites** icon, and the number of databases appears next to the **SQL Databases** icon.</span></span>

    ![管理ポータルで作成された web サイトの Web サイトのページ](deploying-to-production/_static/image3.png)

    <span data-ttu-id="87fea-162">Web アプリ名は、別の図に例のアプリからになります。</span><span class="sxs-lookup"><span data-stu-id="87fea-162">Your web app name will be different from the example app in the illustration.</span></span>

## <a name="deploy-the-application-to-staging"></a><span data-ttu-id="87fea-163">ステージング環境にアプリケーションをデプロイします。</span><span class="sxs-lookup"><span data-stu-id="87fea-163">Deploy the application to staging</span></span>

<span data-ttu-id="87fea-164">Web アプリとステージング環境のデータベースを作成して、プロジェクトをデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="87fea-164">Now that you have created a web app and database for the staging environment, you can deploy the project to it.</span></span>

> [!NOTE]
> <span data-ttu-id="87fea-165">この手順でダウンロードして、発行プロファイルを作成する方法を示します、 *.publishsettings*ファイルで、サード パーティのホスティング プロバイダーも Azure のだけでなく動作します。</span><span class="sxs-lookup"><span data-stu-id="87fea-165">These instructions show how to create a publish profile by downloading a *.publishsettings* file, which works not only for Azure but also for third-party hosting providers.</span></span> <span data-ttu-id="87fea-166">最新の Azure SDK することもできます、Visual Studio から直接 Azure に接続し、Azure アカウント内にある web アプリの一覧から選択します。</span><span class="sxs-lookup"><span data-stu-id="87fea-166">The latest Azure SDK also enables you to connect directly to Azure from Visual Studio, and choose from a list of web apps that you have in your Azure account.</span></span> <span data-ttu-id="87fea-167">Visual Studio 2013 ではから Azure にサインインすることができます、 **Web の発行**ダイアログから、または、**サーバー エクスプ ローラー**ウィンドウ。</span><span class="sxs-lookup"><span data-stu-id="87fea-167">In Visual Studio 2013, you can sign in to Azure from the **Web Publish** dialog or from the **Server Explorer** window.</span></span> <span data-ttu-id="87fea-168">詳細については、次を参照してください。 [Azure App Service で ASP.NET web アプリを作成](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)です。</span><span class="sxs-lookup"><span data-stu-id="87fea-168">For more information, see [Create an ASP.NET web app in Azure App Service](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span></span>

### <a name="download-the-publishsettings-file"></a><span data-ttu-id="87fea-169">.Publishsettings ファイルをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="87fea-169">Download the .publishsettings file</span></span>

1. <span data-ttu-id="87fea-170">先ほど作成した web アプリの名前をクリックします。</span><span class="sxs-lookup"><span data-stu-id="87fea-170">Click the name of the web app that you just created.</span></span>

    ![ダッシュ ボードに移動するサイトをクリックします。](deploying-to-production/_static/image4.png)
2. <span data-ttu-id="87fea-172">**概要**で、**ダッシュ ボード** タブで **発行プロファイルのダウンロード**。</span><span class="sxs-lookup"><span data-stu-id="87fea-172">Under **Quick glance** in the **Dashboard** tab, click **Download publish profile**.</span></span>

    ![リンクの発行プロファイルをダウンロードします。](deploying-to-production/_static/image5.png)

    <span data-ttu-id="87fea-174">この手順では、すべてのアプリケーション、web アプリをデプロイするために必要な設定を含むファイルをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="87fea-174">This step downloads a file that contains all of the settings that you need in order to deploy an application to your web app.</span></span> <span data-ttu-id="87fea-175">この情報を手動で入力する必要はありませんので、Visual Studio をこのファイルをインポートします。</span><span class="sxs-lookup"><span data-stu-id="87fea-175">You'll import this file into Visual Studio so you don't have to enter this information manually.</span></span>
3. <span data-ttu-id="87fea-176">保存、 *.publishsettings* Visual Studio からアクセスできるフォルダー内のファイル。</span><span class="sxs-lookup"><span data-stu-id="87fea-176">Save the *.publishsettings* file in a folder that you can access from Visual Studio.</span></span>

    ![.publishsettings ファイルの保存](deploying-to-production/_static/image6.png)

    > [!WARNING]
    > <span data-ttu-id="87fea-178">セキュリティ -、 *.publishsettings*ファイルには、Azure サブスクリプションとサービスの管理に使用される (エンコードされていない) 資格情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="87fea-178">Security - The *.publishsettings* file contains your credentials (unencoded) that are used to administer your Azure subscriptions and services.</span></span> <span data-ttu-id="87fea-179">このファイルのセキュリティのベスト プラクティスでは、(たとえば libraries \documents フォルダーにある) でソース ディレクトリの外に一時的に格納し、インポートが完了したら、削除します。</span><span class="sxs-lookup"><span data-stu-id="87fea-179">The security best practice for this file is to store it temporarily outside your source directories (for example in the Libraries\Documents folder), and then delete it once the import has completed.</span></span> <span data-ttu-id="87fea-180">アクセスした悪意のあるユーザー、 *.publishsettings*ファイルは、編集、作成、および Azure サービスを削除します。</span><span class="sxs-lookup"><span data-stu-id="87fea-180">A malicious user who gains access to the *.publishsettings* file can edit, create, and delete your Azure services.</span></span>

### <a name="create-a-publish-profile"></a><span data-ttu-id="87fea-181">発行プロファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="87fea-181">Create a publish profile</span></span>

1. <span data-ttu-id="87fea-182">Visual Studio で、ContosoUniversity プロジェクトを右クリックして**ソリューション エクスプ ローラー**選択**発行**コンテキスト メニュー。</span><span class="sxs-lookup"><span data-stu-id="87fea-182">In Visual Studio, right-click the ContosoUniversity project in **Solution Explorer** and select **Publish** from the context menu.</span></span>

    <span data-ttu-id="87fea-183">**Web の発行**ウィザードが開きます。</span><span class="sxs-lookup"><span data-stu-id="87fea-183">The **Publish Web** wizard opens.</span></span>
2. <span data-ttu-id="87fea-184">をクリックして、**プロファイル**タブ。</span><span class="sxs-lookup"><span data-stu-id="87fea-184">Click the **Profile** tab.</span></span>
3. <span data-ttu-id="87fea-185">**[インポート]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="87fea-185">Click **Import**.</span></span>
4. <span data-ttu-id="87fea-186">移動し、 *.publishsettings*クリックして、以前ダウンロードしたファイルに**オープン**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-186">Navigate to the *.publishsettings* file you downloaded earlier, and then click **Open**.</span></span>

    ![インポートの発行の設定 ダイアログ ボックス](deploying-to-production/_static/image7.png)
5. <span data-ttu-id="87fea-188">**接続**] タブで [**接続の検証**設定が正しいことを確認します。</span><span class="sxs-lookup"><span data-stu-id="87fea-188">In the **Connection** tab, click **Validate Connection** to make sure that the settings are correct.</span></span>

    <span data-ttu-id="87fea-189">横に緑色のチェック マークが表示、接続が検証されると、**接続の検証**ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="87fea-189">When the connection has been validated, a green check mark is shown next to the **Validate Connection** button.</span></span>

    <span data-ttu-id="87fea-190">一部のホスティング プロバイダーをクリックすると**接続の検証**、表示される、**証明書エラー**  ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="87fea-190">For some hosting providers, when you click **Validate Connection**, you might see a **Certificate Error** dialog box.</span></span> <span data-ttu-id="87fea-191">を行った場合は、サーバー名が期待どおりであることを確認します。</span><span class="sxs-lookup"><span data-stu-id="87fea-191">If you do, verify that the server name is what you expect.</span></span> <span data-ttu-id="87fea-192">サーバー名が正しい場合は、選択**Visual Studio の今後のセッションにこの証明書を保存**クリック**Accept**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-192">If the server name is correct, select **Save this certificate for future sessions of Visual Studio** and click **Accept**.</span></span> <span data-ttu-id="87fea-193">(このエラーは、ホスティング プロバイダーをデプロイしている URL の SSL 証明書を購入する必要を回避するために選択したことを意味します。</span><span class="sxs-lookup"><span data-stu-id="87fea-193">(This error means that the hosting provider has chosen to avoid the expense of purchasing an SSL certificate for the URL that you are deploying to.</span></span> <span data-ttu-id="87fea-194">有効な証明書を使用してセキュリティで保護された接続を確立する場合は、連絡、ホスティング プロバイダー)。</span><span class="sxs-lookup"><span data-stu-id="87fea-194">If you prefer to establish a secure connection by using a valid certificate, contact your hosting provider.)</span></span>
6. <span data-ttu-id="87fea-195">**[次へ]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="87fea-195">Click **Next**.</span></span>

    ![接続成功アイコンと [接続] タブで [次へ] ボタンをクリックします。](deploying-to-production/_static/image8.png)
7. <span data-ttu-id="87fea-197">**設定**] タブで、展開**ファイル発行オプション**、し、[**アプリからファイルを除外する\_データ フォルダー**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-197">In the **Settings** tab, expand **File Publish Options**, and then select **Exclude files from the App\_Data folder**.</span></span>

    <span data-ttu-id="87fea-198">その他のオプションについて**ファイル発行オプション**を参照してください、 [IIS への配置](deploying-to-iis.md)チュートリアル。</span><span class="sxs-lookup"><span data-stu-id="87fea-198">For information about the other options under **File Publish Options**, see the [deploying to IIS](deploying-to-iis.md) tutorial.</span></span> <span data-ttu-id="87fea-199">画面は、この手順と、次のデータベースの構成手順の結果が、データベースの構成手順の最後に表示されます。</span><span class="sxs-lookup"><span data-stu-id="87fea-199">The screen shot that shows the result of this step and the following database configuration steps is at the end of the database configuration steps.</span></span>
8. <span data-ttu-id="87fea-200">**DefaultConnection**で、**データベース**セクションで、メンバーシップ データベースに対するデータベース デプロイを構成します。</span><span class="sxs-lookup"><span data-stu-id="87fea-200">Under **DefaultConnection** in the **Databases** section, configure database deployment for the membership database.</span></span>
9. 1. <span data-ttu-id="87fea-201">選択**Update database**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-201">Select **Update database**.</span></span>

        <span data-ttu-id="87fea-202">**リモート接続文字列**すぐ下のボックス**DefaultConnection** .publishsettings ファイルから接続文字列が入力されます。接続文字列がプレーン テキストで格納されている SQL Server 資格情報を含む、 *.pubxml*ファイル。</span><span class="sxs-lookup"><span data-stu-id="87fea-202">The **Remote connection string** box directly below **DefaultConnection** is filled in with the connection string from the .publishsettings file.The connection string includes SQL Server credentials, which are stored in plain text in the *.pubxml* file.</span></span> <span data-ttu-id="87fea-203">完全に保存しないようにする場合は、データベースを展開した後、発行プロファイルから削除して、代わりに Azure に保存します。</span><span class="sxs-lookup"><span data-stu-id="87fea-203">If you prefer not to store them permanently there, you can remove them from the publish profile after the database is deployed and store them in Azure instead.</span></span> <span data-ttu-id="87fea-204">詳細については、次を参照してください。[保護する方法、ASP.NET データベース接続文字列のソースから Azure にデプロイするときに](http://www.hanselman.com/blog/HowToKeepYourASPNETDatabaseConnectionStringsSecureWhenDeployingToAzureFromSource.aspx)Scott Hanselman のブログ。</span><span class="sxs-lookup"><span data-stu-id="87fea-204">For more information, see [How to keep your ASP.NET database connection strings secure when deploying to Azure from Source](http://www.hanselman.com/blog/HowToKeepYourASPNETDatabaseConnectionStringsSecureWhenDeployingToAzureFromSource.aspx) on Scott Hanselman's blog.</span></span>
      2. <span data-ttu-id="87fea-205">クリックして**データベース更新を構成する**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-205">Click **Configure database updates**.</span></span>
      3. <span data-ttu-id="87fea-206">**データベース更新を構成する**ダイアログ ボックスで、をクリックして**SQL スクリプトの追加**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-206">In the **Configure Database Updates** dialog box, click **Add SQL Script**.</span></span>
      4. <span data-ttu-id="87fea-207">**SQL スクリプトの追加**ボックスに移動、 *aspnet-データ-prod.sql*する前に、ソリューション フォルダーに保存し、スクリプト**オープン**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-207">In the **Add SQL Script** box, navigate to the *aspnet-data-prod.sql* script that you saved earlier in the solution folder, and then click **Open**.</span></span>
      5. <span data-ttu-id="87fea-208">閉じる、**データベース更新を構成する** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="87fea-208">Close the **Configure Database Updates** dialog box.</span></span>
10. <span data-ttu-id="87fea-209">**SchoolContext**で、**データベース**セクションで、**実行 Code First Migrations (アプリケーションの起動時に実行)** します。</span><span class="sxs-lookup"><span data-stu-id="87fea-209">Under **SchoolContext** in the **Databases** section, select **Execute Code First Migrations (runs on application start)**.</span></span>

    <span data-ttu-id="87fea-210">Visual Studio に表示**Code First Migrations の実行**の代わりに**Update Database**の`DbContext`クラス。</span><span class="sxs-lookup"><span data-stu-id="87fea-210">Visual Studio displays **Execute Code First Migrations** instead of **Update Database** for `DbContext` classes.</span></span> <span data-ttu-id="87fea-211">移行ではなく dbDacFx プロバイダーを使用して、使用してアクセスするデータベースを配置するかどうか、`DbContext`クラスを参照してください[移行せず、Code First のデータベースをデプロイする方法でしょうか](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations)for Visual Studio Web 配置の faq。MSDN 上の ASP.NET。</span><span class="sxs-lookup"><span data-stu-id="87fea-211">If you want to use the dbDacFx provider instead of Migrations to deploy a database that you access by using a `DbContext` class, see [How do I deploy a Code First database without Migrations?](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations) in the Web Deployment FAQ for Visual Studio and ASP.NET on MSDN.</span></span>

    <span data-ttu-id="87fea-212">**設定** タブでは、次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="87fea-212">The **Settings** tab now looks like the following example:</span></span>

    ![ステージング環境の設定 タブ](deploying-to-production/_static/image9.png)
11. <span data-ttu-id="87fea-214">プロファイルを保存して、変更するには、次の手順を実行*ステージング*:</span><span class="sxs-lookup"><span data-stu-id="87fea-214">Perform the following steps to save the profile and rename it to *Staging*:</span></span>

    1. <span data-ttu-id="87fea-215">をクリックして、**プロファイル**タブをクリックし、をクリックし、**プロファイルの管理**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-215">Click the **Profile** tab, and then click **Manage Profiles**.</span></span>
    2. <span data-ttu-id="87fea-216">インポートでは、FTP 用と Web デプロイのための 2 つの新しいプロファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="87fea-216">The import created two new profiles, one for FTP and one for Web Deploy.</span></span> <span data-ttu-id="87fea-217">Web デプロイ プロファイルを構成する: このプロファイルの名前を変更*ステージング*します。</span><span class="sxs-lookup"><span data-stu-id="87fea-217">You configured the Web Deploy profile: rename this profile to *Staging*.</span></span>

        ![ステージング環境にプロファイル名の変更します。](deploying-to-production/_static/image10.png)
    3. <span data-ttu-id="87fea-219">閉じる、 **Web の発行プロファイルの編集** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="87fea-219">Close the **Edit Web Publish Profiles** dialog box.</span></span>
    4. <span data-ttu-id="87fea-220">閉じる、 **Web の発行**ウィザード。</span><span class="sxs-lookup"><span data-stu-id="87fea-220">Close the **Publish Web** wizard.</span></span>

### <a name="configure-a-publish-profile-transform-for-the-environment-indicator"></a><span data-ttu-id="87fea-221">環境のインジケーターの発行プロファイルの変換を構成します。</span><span class="sxs-lookup"><span data-stu-id="87fea-221">Configure a publish profile transform for the environment indicator</span></span>

> [!NOTE]
> <span data-ttu-id="87fea-222">このセクションでは、環境のインジケーターの Web.config 変換を設定する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="87fea-222">This section shows how to set up a Web.config transform for the environment indicator.</span></span> <span data-ttu-id="87fea-223">インジケーターがあるため、`<appSettings>`要素では、Azure App Service にデプロイするときに、変換を指定するための別の方法があります。</span><span class="sxs-lookup"><span data-stu-id="87fea-223">Because the indicator is in the `<appSettings>` element, you have another alternative for specifying the transformation when you're deploying to Azure App Service.</span></span> <span data-ttu-id="87fea-224">詳細については、次を参照してください。[を指定する Web.config の設定を Azure で](web-config-transformations.md#watransforms)します。</span><span class="sxs-lookup"><span data-stu-id="87fea-224">For more information, see [Specifying Web.config settings in Azure](web-config-transformations.md#watransforms).</span></span>

1. <span data-ttu-id="87fea-225">**ソリューション エクスプ ローラー**、展開**プロパティ**、順に展開**PublishProfiles**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-225">In **Solution Explorer**, expand **Properties**, and then expand **PublishProfiles**.</span></span>
2. <span data-ttu-id="87fea-226">右クリック*Staging.pubxml*、 をクリックし、**構成変換の追加**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-226">Right-click *Staging.pubxml*, and then click **Add Config Transform**.</span></span>

    ![ステージング用の構成変換を追加します。](deploying-to-production/_static/image11.png)

    <span data-ttu-id="87fea-228">Visual Studio によって作成、 *Web.Staging.config*変換ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="87fea-228">Visual Studio creates the *Web.Staging.config* transform file and opens it.</span></span>
3. <span data-ttu-id="87fea-229">*Web.Staging.config*ファイルの変換を開始した直後に次のコードを挿入`configuration`タグ。</span><span class="sxs-lookup"><span data-stu-id="87fea-229">In the *Web.Staging.config* transform file, insert the following code immediately after the opening `configuration` tag.</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample1.xml)]

    <span data-ttu-id="87fea-230">ステージング環境の発行プロファイルを使用する場合、この変換は、"Prod"するインジケーターを環境を設定します。</span><span class="sxs-lookup"><span data-stu-id="87fea-230">When you use the Staging publish profile, this transform sets the environment indicator to "Prod".</span></span> <span data-ttu-id="87fea-231">デプロイされた web アプリで、"Contoso University"H1 見出し"(Dev)"などの任意のサフィックスまたは"(Test)"は表示されません。</span><span class="sxs-lookup"><span data-stu-id="87fea-231">In the deployed web app, you won't see any suffix such as "(Dev)" or "(Test)" after the "Contoso University" H1 heading.</span></span>
4. <span data-ttu-id="87fea-232">右クリックし、 *Web.Staging.config*ファイルを**プレビュー変換**を組み込んだ変換が期待どおりの変更を生成するかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="87fea-232">Right-click the *Web.Staging.config* file and click **Preview Transform** to make sure that the transform you coded produces the expected changes.</span></span>

    <span data-ttu-id="87fea-233">**Web.config プレビュー**ウィンドウには、両方を適用した結果が表示されます、 *Web.Release.config*変換と*Web.Staging.config*を変換します。</span><span class="sxs-lookup"><span data-stu-id="87fea-233">The **Web.config Preview** window shows the result of applying both the *Web.Release.config* transforms and the *Web.Staging.config* transforms.</span></span>

### <a name="prevent-public-use-of-the-test-app"></a><span data-ttu-id="87fea-234">テスト アプリをパブリックに使用できないようにします。</span><span class="sxs-lookup"><span data-stu-id="87fea-234">Prevent public use of the test app</span></span>

<span data-ttu-id="87fea-235">ステージングのアプリの重要な考慮事項は、インターネット上でライブになりますが、それを使用する公開したくないことです。</span><span class="sxs-lookup"><span data-stu-id="87fea-235">An important consideration for the staging app is that it will be live on the Internet, but you don't want the public to use it.</span></span> <span data-ttu-id="87fea-236">ユーザーが検索し、使用する可能性を最小限に抑えるには、次の方法の 1 つ以上を使用できます。</span><span class="sxs-lookup"><span data-stu-id="87fea-236">To minimize the likelihood that people will find and use it, you can use one or more of the following methods:</span></span>

- <span data-ttu-id="87fea-237">ステージングのアプリをステージング環境のテストに使用する IP アドレスからのみアクセスを許可するファイアウォール規則を設定します。</span><span class="sxs-lookup"><span data-stu-id="87fea-237">Set firewall rules that allow access to the staging app only from IP addresses that you use to test staging.</span></span>
- <span data-ttu-id="87fea-238">推測することはできませんを難読化された URL を使用します。</span><span class="sxs-lookup"><span data-stu-id="87fea-238">Use an obfuscated URL that would be impossible to guess.</span></span>
- <span data-ttu-id="87fea-239">作成、 *robots.txt*ファイルを検索エンジンがクロール テスト アプリとレポートのリンクを検索結果にすることを確認します。</span><span class="sxs-lookup"><span data-stu-id="87fea-239">Create a *robots.txt* file to ensure that search engines will not crawl the test app and report links to it in search results.</span></span>

<span data-ttu-id="87fea-240">これらのメソッドの最初が最も効果的ですが、Azure App Service ではなく Azure クラウド サービスをデプロイすることが必要になるため、このチュートリアルでは説明しません。</span><span class="sxs-lookup"><span data-stu-id="87fea-240">The first of these methods is the most effective but is not covered in this tutorial because it would require that you deploy to an Azure Cloud Service instead of Azure App Service.</span></span> <span data-ttu-id="87fea-241">クラウド サービスの詳細についてと Azure で IP 制限は、次を参照してください。 [Azure によって提供されるオプションをホストしているコンピューティング](https://docs.microsoft.com/azure/cloud-services/cloud-services-choose-me)と[Web ロールへのアクセスを特定の IP アドレスをブロック](https://msdn.microsoft.com/library/windowsazure/jj154098.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="87fea-241">For more information about Cloud Services and IP restrictions in Azure, see [Compute Hosting Options Provided by Azure](https://docs.microsoft.com/azure/cloud-services/cloud-services-choose-me) and [Block Specific IP Addresses from Accessing a Web Role](https://msdn.microsoft.com/library/windowsazure/jj154098.aspx).</span></span> <span data-ttu-id="87fea-242">サード パーティのホスティング プロバイダーに展開する場合は、IP 制限を実装する方法について説明を検索するプロバイダーに問い合わせてください。</span><span class="sxs-lookup"><span data-stu-id="87fea-242">If you are deploying to a third-party hosting provider, contact the provider to find out how to implement IP restrictions.</span></span>

<span data-ttu-id="87fea-243">このチュートリアルで作成します、 *robots.txt*ファイル。</span><span class="sxs-lookup"><span data-stu-id="87fea-243">For this tutorial, you'll create a *robots.txt* file.</span></span>

1. <span data-ttu-id="87fea-244">**ソリューション エクスプ ローラー**ContosoUniversity プロジェクトを右クリックし、クリックして、**新しい項目の追加**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-244">In **Solution Explorer**, right-click the ContosoUniversity project and click **Add New Item**.</span></span>
2. <span data-ttu-id="87fea-245">新規作成**テキスト ファイル**という*robots.txt*、し、次のテキストを配置します。</span><span class="sxs-lookup"><span data-stu-id="87fea-245">Create a new **Text File** named *robots.txt*, and put the following text in it:</span></span>

    [!code-console[Main](deploying-to-production/samples/sample2.cmd)]

    <span data-ttu-id="87fea-246">`User-agent`行は、ファイル内のルールがすべて検索エンジン web クローラー (ロボット) に適用される検索エンジンに指示し、`Disallow`行では、サイトのページをクロールないことを指定します。</span><span class="sxs-lookup"><span data-stu-id="87fea-246">The `User-agent` line tells search engines that the rules in the file apply to all search engine web crawlers (robots), and the `Disallow` line specifies that no pages on the site should be crawled.</span></span>

    <span data-ttu-id="87fea-247">検索エンジンを運用環境のデプロイからこのファイルを除外する必要があるため、実稼働アプリをカタログ化するようにします。</span><span class="sxs-lookup"><span data-stu-id="87fea-247">You do want search engines to catalog your production app, so you need to exclude this file from production deployment.</span></span> <span data-ttu-id="87fea-248">構成することを行う運用環境の設定は、作成するときにプロファイルを発行します。</span><span class="sxs-lookup"><span data-stu-id="87fea-248">To do that, you'll configure a setting in the Production publish profile when you create it.</span></span>

### <a name="deploy-to-staging"></a><span data-ttu-id="87fea-249">ステージングへのデプロイします。</span><span class="sxs-lookup"><span data-stu-id="87fea-249">Deploy to staging</span></span>

1. <span data-ttu-id="87fea-250">開く、 **Web の発行**を Contoso University のプロジェクトを右クリックしてウィザード**発行**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-250">Open the **Publish Web** wizard by right-clicking the Contoso University project and clicking **Publish**.</span></span>
2. <span data-ttu-id="87fea-251">必ず、**ステージング**プロファイルが選択されています。</span><span class="sxs-lookup"><span data-stu-id="87fea-251">Make sure that the **Staging** profile is selected.</span></span>
3. <span data-ttu-id="87fea-252">**[発行]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="87fea-252">Click **Publish**.</span></span>

    <span data-ttu-id="87fea-253">**出力**ウィンドウが実行されたどのようなデプロイ操作を示しています。 され、展開が正常に完了を報告します。</span><span class="sxs-lookup"><span data-stu-id="87fea-253">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span> <span data-ttu-id="87fea-254">デプロイされた web アプリの URL に既定のブラウザーが自動的に開きます。</span><span class="sxs-lookup"><span data-stu-id="87fea-254">The default browser automatically opens to the URL of the deployed web app.</span></span>

## <a name="test-in-the-staging-environment"></a><span data-ttu-id="87fea-255">ステージング環境でのテストします。</span><span class="sxs-lookup"><span data-stu-id="87fea-255">Test in the staging environment</span></span>

<span data-ttu-id="87fea-256">環境のインジケーターが存在しないことに注意してください (がない"(Test)"または"(Dev)"ことを示していますの H1 見出しの後、 *Web.config*環境インジケーターの変換が成功しました。</span><span class="sxs-lookup"><span data-stu-id="87fea-256">Notice that the environment indicator is absent (there is no "(Test)" or "(Dev)" after the H1 heading, which shows that the *Web.config* transformation for the environment indicator was successful.</span></span>

![ホーム ページのステージング](deploying-to-production/_static/image12.png)

<span data-ttu-id="87fea-258">実行、**学生**ページに配置されているデータベースに学生がないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="87fea-258">Run the **Students** page to verify that the deployed database has no students.</span></span>

<span data-ttu-id="87fea-259">実行、 **Instructors** Code First シード インストラクター データでデータベースを確認します。</span><span class="sxs-lookup"><span data-stu-id="87fea-259">Run the **Instructors** page to verify that Code First seeded the database with instructor data:</span></span>

<span data-ttu-id="87fea-260">選択**受講者の追加**から、**学生** メニューの は、生徒を追加しで新しい学生を表示し、**受講者**データベースに正常に記述できることを確認する ページ.</span><span class="sxs-lookup"><span data-stu-id="87fea-260">Select **Add Students** from the **Students** menu, add a student, and then view the new student in the **Students** page to verify that you can successfully write to the database.</span></span>

<span data-ttu-id="87fea-261">**コース**] ページで [**更新クレジット**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-261">From the **Courses** page, click **Update Credits**.</span></span> <span data-ttu-id="87fea-262">**更新クレジット**ページには、管理者のアクセス許可が必要ですので、**ログで**ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="87fea-262">The **Update Credits** page requires administrator permissions, so the **Log In** page is displayed.</span></span> <span data-ttu-id="87fea-263">以前 ("admin"および"prodpwd") で作成した管理者アカウントの資格情報を入力します。</span><span class="sxs-lookup"><span data-stu-id="87fea-263">Enter the administrator account credentials that you created earlier ("admin" and "prodpwd").</span></span> <span data-ttu-id="87fea-264">**更新クレジット**ページが表示され、前のチュートリアルで作成した管理者アカウントがテスト環境に正しくデプロイされたことを確認します。</span><span class="sxs-lookup"><span data-stu-id="87fea-264">The **Update Credits** page is displayed, which verifies that the administrator account that you created in the previous tutorial was correctly deployed to the test environment.</span></span>

<span data-ttu-id="87fea-265">ELMAH は追跡、および、ELMAH のエラー レポートを要求し、エラーが発生する、無効な URL を要求します。</span><span class="sxs-lookup"><span data-stu-id="87fea-265">Request an invalid URL to cause an error that ELMAH will track, and then request the ELMAH error report.</span></span> <span data-ttu-id="87fea-266">サード パーティのホスティング プロバイダーに展開する場合、レポートが空で、前のチュートリアルを同じ理由から空である可能性がありますわかります。</span><span class="sxs-lookup"><span data-stu-id="87fea-266">If you are deploying to a third-party hosting provider, you will probably find that the report is empty for the same reason that it was empty in the previous tutorial.</span></span> <span data-ttu-id="87fea-267">ホスティング プロバイダーのアカウントの管理ツールを使用して、ログ フォルダーに書き込む ELMAH を有効にするフォルダーのアクセス許可を構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="87fea-267">You will have to use the hosting provider's account management tools to configure folder permissions to enable ELMAH to write to the log folder.</span></span>

<span data-ttu-id="87fea-268">実稼働に使用するものと同じように web アプリにクラウドで作成したアプリケーションが実行されているようになりました。</span><span class="sxs-lookup"><span data-stu-id="87fea-268">The application that you created is now running in the cloud in a web app that is just like what you will use for production.</span></span> <span data-ttu-id="87fea-269">すべてが正しく動作しているために、次の手順は、運用環境に配置です。</span><span class="sxs-lookup"><span data-stu-id="87fea-269">Since everything is working correctly, the next step is to deploy to production.</span></span>

## <a name="deploy-to-production"></a><span data-ttu-id="87fea-270">運用環境にデプロイします。</span><span class="sxs-lookup"><span data-stu-id="87fea-270">Deploy to production</span></span>

<span data-ttu-id="87fea-271">運用 web アプリを作成して、運用環境にデプロイするプロセスは、ステージング環境の場合と同様を除外する必要がある点が異なります、 *robots.txt*展開からします。</span><span class="sxs-lookup"><span data-stu-id="87fea-271">The process for creating a production web app and deploying to production is the same as for staging, except that you need to exclude the *robots.txt* from deployment.</span></span> <span data-ttu-id="87fea-272">そのためには、発行プロファイル ファイルを編集します。</span><span class="sxs-lookup"><span data-stu-id="87fea-272">To do that you'll edit the publish profile file.</span></span>

### <a name="create-the-production-environment-and-the-production-publish-profile"></a><span data-ttu-id="87fea-273">運用環境を作成し、運用環境の発行プロファイル</span><span class="sxs-lookup"><span data-stu-id="87fea-273">Create the production environment and the production publish profile</span></span>

1. <span data-ttu-id="87fea-274">Azure では、ステージングのために使用した同じ手順を次に、運用 web アプリとデータベースを作成します。</span><span class="sxs-lookup"><span data-stu-id="87fea-274">Create the production web app and database in Azure, following the same procedure that you used for staging.</span></span>

    <span data-ttu-id="87fea-275">データベースを作成するときに、先ほど作成した同じサーバー上に選択または新しいサーバーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="87fea-275">When you create the database, you can choose to put it on the same server you created earlier, or create a new server.</span></span>
2. <span data-ttu-id="87fea-276">ダウンロード、 *.publishsettings*ファイル。</span><span class="sxs-lookup"><span data-stu-id="87fea-276">Download the *.publishsettings* file.</span></span>
3. <span data-ttu-id="87fea-277">運用環境にインポートすることで、発行プロファイルを作成 *.publishsettings*ファイルをステージングに使用した同じ手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="87fea-277">Create the publish profile by importing the production *.publishsettings* file, following the same procedure that you used for staging.</span></span>

    <span data-ttu-id="87fea-278">データ デプロイ スクリプトを構成することを忘れないでください**DefaultConnection**で、**データベース**のセクション、**設定**タブ。</span><span class="sxs-lookup"><span data-stu-id="87fea-278">Don't forget to configure the data deployment script under **DefaultConnection** in the **Databases** section of the **Settings** tab.</span></span>
4. <span data-ttu-id="87fea-279">発行プロファイルの名前を変更*運用*します。</span><span class="sxs-lookup"><span data-stu-id="87fea-279">Rename the publish profile to *Production*.</span></span>
5. <span data-ttu-id="87fea-280">ステージングのために使用した同じ手順に従って、環境のインジケーターの発行プロファイルの変換を構成するには.</span><span class="sxs-lookup"><span data-stu-id="87fea-280">Configure a publish profile transform for the environment indicator, following the same procedure that you used for staging..</span></span>

### <a name="edit-the-pubxml-file-to-exclude-robotstxt"></a><span data-ttu-id="87fea-281">Robots.txt を除外する .pubxml ファイルを編集します。</span><span class="sxs-lookup"><span data-stu-id="87fea-281">Edit the .pubxml file to exclude robots.txt</span></span>

<span data-ttu-id="87fea-282">発行プロファイル ファイルの名前は&lt;profilename&gt;*.pubxml*に存在し、 *PublishProfiles*フォルダー。</span><span class="sxs-lookup"><span data-stu-id="87fea-282">Publish profile files are named &lt;profilename&gt;*.pubxml* and are located in the *PublishProfiles* folder.</span></span> <span data-ttu-id="87fea-283">*PublishProfiles*フォルダーは、*プロパティ*フォルダー c# web アプリケーション プロジェクトで、 *My Project*フォルダーまたは VB の web アプリケーション プロジェクトで、*アプリ\_データ*web アプリ プロジェクトのフォルダー。</span><span class="sxs-lookup"><span data-stu-id="87fea-283">The *PublishProfiles* folder is under the *Properties* folder in a C# web application project, under the *My Project* folder in a VB web application project, or under the *App\_Data* folder in a web app project.</span></span> <span data-ttu-id="87fea-284">各 *.pubxml*ファイルには、いずれかに適用される設定が含まれています。 プロファイルを公開します。</span><span class="sxs-lookup"><span data-stu-id="87fea-284">Each *.pubxml* file contains settings that apply to one publish profile.</span></span> <span data-ttu-id="87fea-285">Web の発行ウィザードで入力した値は、これらのファイルに格納され、Visual Studio UI で利用可能になっていない設定を作成または変更し、編集します。</span><span class="sxs-lookup"><span data-stu-id="87fea-285">The values you enter in the Publish Web wizard are stored in these files, and you can edit them to create or change settings that aren't made available in the Visual Studio UI.</span></span>

<span data-ttu-id="87fea-286">既定では、 *.pubxml*発行プロファイルを作成し、プロジェクトから除外することができますと Visual Studio は現在でも使用、プロジェクトにファイルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="87fea-286">By default, *.pubxml* files are included in the project when you create a publish profile, but you can exclude them from the project and Visual Studio will still use them.</span></span> <span data-ttu-id="87fea-287">Visual Studio では、 *PublishProfiles*フォルダー *.pubxml*プロジェクトに含まれているかどうかに関係なく、ファイル。</span><span class="sxs-lookup"><span data-stu-id="87fea-287">Visual Studio looks in the *PublishProfiles* folder for *.pubxml* files, regardless of whether they are included in the project.</span></span>

<span data-ttu-id="87fea-288">各 *.pubxml*ファイルがある、 *. >.pubxml.user*ファイル。</span><span class="sxs-lookup"><span data-stu-id="87fea-288">For each *.pubxml* file there is a *.pubxml.user* file.</span></span> <span data-ttu-id="87fea-289">*. >.pubxml.user*を選択した場合、ファイルが暗号化されたパスワードを含む、**パスワードの保存**オプション、および既定では、プロジェクトから除外されます。</span><span class="sxs-lookup"><span data-stu-id="87fea-289">The *.pubxml.user* file contains the encrypted password if you selected the **Save password** option, and by default it is excluded from the project.</span></span>

<span data-ttu-id="87fea-290">A *.pubxml*ファイルには、特定の発行プロファイルに関連する設定が含まれています。</span><span class="sxs-lookup"><span data-stu-id="87fea-290">A *.pubxml* file contains the settings that pertain to a specific publish profile.</span></span> <span data-ttu-id="87fea-291">すべてのプロファイルに適用される設定を構成する場合を作成、 *. wpp.targets*ファイル。</span><span class="sxs-lookup"><span data-stu-id="87fea-291">If you want to configure settings that apply to all profiles, you can create a *.wpp.targets* file.</span></span> <span data-ttu-id="87fea-292">ビルド プロセスは、これらのファイルをインポート、 *.csproj*または *.vbproj*プロジェクト ファイル、プロジェクト ファイルで構成できる設定のほとんどは、これらのファイルで構成できます。</span><span class="sxs-lookup"><span data-stu-id="87fea-292">The build process imports these files into the *.csproj* or *.vbproj* project file, so most settings that you can configure in the project file can be configured in these files.</span></span> <span data-ttu-id="87fea-293">詳細については *.pubxml*ファイルと *. wpp.targets*ファイルを参照してください[方法。展開設定を編集するプロファイル (.pubxml) ファイルを発行するとします。 Visual Studio Web プロジェクトで wpp.targets ファイル](https://msdn.microsoft.com/library/ff398069.aspx)。</span><span class="sxs-lookup"><span data-stu-id="87fea-293">For more information about *.pubxml* files and *.wpp.targets* files, see [How to: Edit Deployment Settings in Publish Profile (.pubxml) Files and the .wpp.targets File in Visual Studio Web Projects](https://msdn.microsoft.com/library/ff398069.aspx).</span></span>

1. <span data-ttu-id="87fea-294">**ソリューション エクスプ ローラー**、展開**プロパティ**展開**PublishProfiles**します。</span><span class="sxs-lookup"><span data-stu-id="87fea-294">In **Solution Explorer**, expand **Properties** and expand **PublishProfiles**.</span></span>
2. <span data-ttu-id="87fea-295">右クリック*Production.pubxml*クリック**オープン**。</span><span class="sxs-lookup"><span data-stu-id="87fea-295">Right-click *Production.pubxml* and click **Open**.</span></span>

    ![.Pubxml ファイルを開く](deploying-to-production/_static/image13.png)
3. <span data-ttu-id="87fea-297">右クリック*Production.pubxml*クリック**オープン**。</span><span class="sxs-lookup"><span data-stu-id="87fea-297">Right-click *Production.pubxml* and click **Open**.</span></span>
4. <span data-ttu-id="87fea-298">終了する直前に次の行を追加`PropertyGroup`要素。</span><span class="sxs-lookup"><span data-stu-id="87fea-298">Add the following lines immediately before the closing `PropertyGroup` element:</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample3.xml)]

    <span data-ttu-id="87fea-299">.Pubxml ファイルは、次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="87fea-299">The .pubxml file now looks like the following example:</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample4.xml?highlight=18-20)]

    <span data-ttu-id="87fea-300">ファイルとフォルダーを除外する方法の詳細については、次を参照してください。[できますしないようにする特定のファイルまたはフォルダーの展開からでしょうか。](https://msdn.microsoft.com/library/ee942158.aspx#can_i_exclude_specific_files_or_folders_from_deployment)で、 **for Visual Studio および ASP.NET Web 配置の FAQ** msdn です。</span><span class="sxs-lookup"><span data-stu-id="87fea-300">For more information about how to exclude files and folders, see [Can I exclude specific files or folders from deployment?](https://msdn.microsoft.com/library/ee942158.aspx#can_i_exclude_specific_files_or_folders_from_deployment) in the **Web Deployment FAQ for Visual Studio and ASP.NET** on MSDN.</span></span>

### <a name="deploy-to-production"></a><span data-ttu-id="87fea-301">運用環境にデプロイします。</span><span class="sxs-lookup"><span data-stu-id="87fea-301">Deploy to production</span></span>

1. <span data-ttu-id="87fea-302">開く、 **Web の発行**ウィザードことを確認します、**運用**発行プロファイルが選択されているし、をクリックし、**プレビューの開始**で、**プレビュー**ことを確認するには、タブ、 *robots.txt*ファイルは、運用アプリにコピーされません。</span><span class="sxs-lookup"><span data-stu-id="87fea-302">Open the **Publish Web** wizard make sure that the **Production** publish profile is selected, and then click **Start Preview** on the **Preview** tab to verify that the *robots.txt* file will not be copied to the production app.</span></span>

    ![運用環境に発行するファイルのプレビュー](deploying-to-production/_static/image14.png)

    <span data-ttu-id="87fea-304">コピーされるファイルの一覧を確認します。</span><span class="sxs-lookup"><span data-stu-id="87fea-304">Review the list of files that will be copied.</span></span> <span data-ttu-id="87fea-305">表示されているすべての *.cs*など、ファイル *. aspx.cs*、 *. aspx.designer.cs*、 *Master.cs*、および*Master.designer.cs*ファイルは省略されます。</span><span class="sxs-lookup"><span data-stu-id="87fea-305">You'll see that all of the *.cs* files, including *.aspx.cs*, *.aspx.designer.cs*, *Master.cs*, and *Master.designer.cs* files are omitted.</span></span> <span data-ttu-id="87fea-306">このコードすべてをコンパイルした後、 *ContosoUniversity.dll*と*ContosoUniversity.pdb*で見つかるファイル、 *bin*フォルダー。</span><span class="sxs-lookup"><span data-stu-id="87fea-306">All of this code has been compiled into the *ContosoUniversity.dll* and *ContosoUniversity.pdb* files that you'll find in the *bin* folder.</span></span> <span data-ttu-id="87fea-307">ため、のみ、 *.dll*に必要な実行して、アプリケーションでは、前に指定、アプリケーションの実行に必要なファイルのみを配置すること、no *.cs*ファイルは、先にコピーされました環境。</span><span class="sxs-lookup"><span data-stu-id="87fea-307">Because only the *.dll* is needed to run the application, and you specified earlier that only files needed to run the application should be deployed, no *.cs* files were copied to the destination environment.</span></span> <span data-ttu-id="87fea-308">*Obj*フォルダーと *[contosouniversity.csproj]* と *. csproj.user*ファイルは同じ理由から省略されます。</span><span class="sxs-lookup"><span data-stu-id="87fea-308">The *obj* folder and the *ContosoUniversity.csproj* and *.csproj.user* files are omitted for the same reason.</span></span>

    <span data-ttu-id="87fea-309">クリックして**発行**実稼働環境に配置します。</span><span class="sxs-lookup"><span data-stu-id="87fea-309">Click **Publish** to deploy to the production environment.</span></span>
2. <span data-ttu-id="87fea-310">ステージング環境で使用するのと同じ手順を実行して、運用環境でテストします。</span><span class="sxs-lookup"><span data-stu-id="87fea-310">Test in production, following the same procedure you used for staging.</span></span>

    <span data-ttu-id="87fea-311">すべての URL 以外のステージング環境とがない場合と同じですが、 *robots.txt*ファイル。</span><span class="sxs-lookup"><span data-stu-id="87fea-311">Everything is identical to staging except for the URL and the absence of the *robots.txt* file.</span></span>

## <a name="summary"></a><span data-ttu-id="87fea-312">まとめ</span><span class="sxs-lookup"><span data-stu-id="87fea-312">Summary</span></span>

<span data-ttu-id="87fea-313">これで正常にデプロイして、web アプリをテストし、入手可能になったパブリック インターネット経由で。</span><span class="sxs-lookup"><span data-stu-id="87fea-313">You have now successfully deployed and tested your web app and it is available publicly over the Internet.</span></span>

![運用環境のホーム ページ](deploying-to-production/_static/image15.png)

<span data-ttu-id="87fea-315">次のチュートリアルでは、アプリケーション コードを更新し、テスト、ステージング、実稼働環境に変更をデプロイします。</span><span class="sxs-lookup"><span data-stu-id="87fea-315">In the next tutorial, you'll update application code and deploy the change to the test, staging, and production environments.</span></span>

> [!NOTE]
> <span data-ttu-id="87fea-316">アプリケーションを運用環境で使用中には、復旧計画を実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="87fea-316">While your application is in use in the production environment you should be implementing a recovery plan.</span></span> <span data-ttu-id="87fea-317">つまり、する必要がありますが定期的にデータベースのバックアップ、運用環境のアプリから、セキュリティで保護された記憶域の場所に、このようなバックアップのいくつかの世代を保存する必要があります。</span><span class="sxs-lookup"><span data-stu-id="87fea-317">That is, you should be periodically backing up your databases from the production app to a secure storage location, and you should be keeping several generations of such backups.</span></span> <span data-ttu-id="87fea-318">データベースを更新するときに、変更の直前のバックアップ コピーをする必要があります。</span><span class="sxs-lookup"><span data-stu-id="87fea-318">When you update the database, you should make a backup copy from immediately before the change.</span></span> <span data-ttu-id="87fea-319">次に、設定を間違えたして運用環境に配置した後に検出されるまでそのしない場合が破損する前に、の状態にデータベースを復旧できます。</span><span class="sxs-lookup"><span data-stu-id="87fea-319">Then, if you make a mistake and don't discover it until after you have deployed it to production, you will still be able to recover the database to the state it was in before it became corrupted.</span></span> <span data-ttu-id="87fea-320">詳細については、次を参照してください。 [Azure SQL Database のバックアップと復元](https://msdn.microsoft.com/library/windowsazure/jj650016.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="87fea-320">For more information, see [Azure SQL Database Backup and Restore](https://msdn.microsoft.com/library/windowsazure/jj650016.aspx).</span></span>
> 
> 
> [!NOTE]
> <span data-ttu-id="87fea-321">このチュートリアル SQL Server を展開しているエディションは、Azure SQL Database は。</span><span class="sxs-lookup"><span data-stu-id="87fea-321">In this tutorial the SQL Server edition that you are deploying to is Azure SQL Database.</span></span> <span data-ttu-id="87fea-322">展開プロセスは他のエディションの SQL Server に似ていますが、実際の運用アプリケーション必要があります特別なコードを Azure SQL Database の一部のシナリオで。</span><span class="sxs-lookup"><span data-stu-id="87fea-322">While the deployment process is similar to other editions of SQL Server, a real production application might require special code for Azure SQL Database in some scenarios.</span></span> <span data-ttu-id="87fea-323">詳細については、次を参照してください。 [Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdb)と[SQL Server および Azure SQL Database の使い分け](../../../../whitepapers/aspnet-data-access-content-map.md#ssdbchoosing)します。</span><span class="sxs-lookup"><span data-stu-id="87fea-323">For more information, see [Working with Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdb) and [Choosing between SQL Server and Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdbchoosing).</span></span>
> 
> [!div class="step-by-step"]
> <span data-ttu-id="87fea-324">[前へ](setting-folder-permissions.md)
> [次へ](deploying-a-code-update.md)</span><span class="sxs-lookup"><span data-stu-id="87fea-324">[Previous](setting-folder-permissions.md)
[Next](deploying-a-code-update.md)</span></span>
