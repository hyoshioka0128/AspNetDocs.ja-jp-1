---
uid: web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-production
title: 'Visual Studio を使用した ASP.NET Web デプロイ: 運用環境へのデプロイ |Microsoft Docs'
author: tdykstra
description: このチュートリアルシリーズでは、ASP.NET web アプリケーションをデプロイ (発行) して、Web Apps またはサードパーティのホスティングプロバイダーに Azure App Service する方法について説明します。
ms.author: riande
ms.date: 02/15/2013
ms.assetid: 416438a1-3b2f-4d27-bf53-6b76223c33bf
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-production
msc.type: authoredcontent
ms.openlocfilehash: ddc3d15f0436c4c3a24491cf0377111768da67df
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74617643"
---
# <a name="aspnet-web-deployment-using-visual-studio-deploying-to-production"></a><span data-ttu-id="dc967-103">Visual Studio を使用した ASP.NET Web 配置: 運用環境への配置</span><span class="sxs-lookup"><span data-stu-id="dc967-103">ASP.NET Web Deployment using Visual Studio: Deploying to Production</span></span>

<span data-ttu-id="dc967-104">[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="dc967-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="dc967-105">スタートプロジェクトのダウンロード</span><span class="sxs-lookup"><span data-stu-id="dc967-105">Download Starter Project</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=282627)

> <span data-ttu-id="dc967-106">このチュートリアルシリーズでは、Visual Studio 2012 または Visual Studio 2010 を使用して、Azure App Service Web Apps またはサードパーティのホスティングプロバイダーにするために、ASP.NET web アプリケーションをデプロイ (発行) する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="dc967-106">This tutorial series shows you how to deploy (publish) an ASP.NET web application to Azure App Service Web Apps or to a third-party hosting provider, by using Visual Studio 2012 or Visual Studio 2010.</span></span> <span data-ttu-id="dc967-107">シリーズの詳細については、[シリーズの最初のチュートリアル](introduction.md)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-107">For information about the series, see [the first tutorial in the series](introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="dc967-108">の概要</span><span class="sxs-lookup"><span data-stu-id="dc967-108">Overview</span></span>

<span data-ttu-id="dc967-109">このチュートリアルでは、Microsoft Azure アカウントを設定し、ステージング環境と運用環境を作成します。次に、Visual Studio のワンクリック発行機能を使用して、ステージング環境と運用環境に ASP.NET web アプリケーションをデプロイします。</span><span class="sxs-lookup"><span data-stu-id="dc967-109">In this tutorial, you set up a Microsoft Azure account, create staging and production environments, and deploy your ASP.NET web application to the staging and production environments by using the Visual Studio one-click publish feature.</span></span>

<span data-ttu-id="dc967-110">必要に応じて、サードパーティのホスティングプロバイダーにデプロイすることもできます。</span><span class="sxs-lookup"><span data-stu-id="dc967-110">If you prefer, you can deploy to a third-party hosting provider.</span></span> <span data-ttu-id="dc967-111">このチュートリアルで説明する手順のほとんどは、ホスティングプロバイダーまたは Azure の場合と同じですが、各プロバイダーには、アカウントと web サイト管理のための独自のユーザーインターフェイスが用意されています。</span><span class="sxs-lookup"><span data-stu-id="dc967-111">Most of the procedures described in this tutorial are the same for a hosting provider or for Azure, except that each provider has its own user interface for account and web site management.</span></span> <span data-ttu-id="dc967-112">ホスティングプロバイダーは、Microsoft.com web サイトの[プロバイダーのギャラリー](https://www.microsoft.com/web/hosting)にあります。</span><span class="sxs-lookup"><span data-stu-id="dc967-112">You can find a hosting provider in the [gallery of providers](https://www.microsoft.com/web/hosting) on the Microsoft.com web site.</span></span>

<span data-ttu-id="dc967-113">リマインダー: チュートリアルを実行するときにエラーメッセージが表示されたり、機能しない場合は、このチュートリアルシリーズのトラブルシューティングのページを確認してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-113">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the Troubleshooting page in this tutorial series.</span></span>

## <a name="get-a-microsoft-azure-account"></a><span data-ttu-id="dc967-114">Microsoft Azure アカウントを取得する</span><span class="sxs-lookup"><span data-stu-id="dc967-114">Get a Microsoft Azure account</span></span>

<span data-ttu-id="dc967-115">まだ Azure アカウントを持っていない場合は、無料試用版アカウントを数分で作成できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-115">If you don't already have an Azure account, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="dc967-116">詳細については、「 [Azure 無料試用版](https://azure.microsoft.com/free/?WT.mc_id=A443DD604)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-116">For details, see [Azure Free Trial](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span></span>

## <a name="create-a-staging-environment"></a><span data-ttu-id="dc967-117">ステージング環境を作成する</span><span class="sxs-lookup"><span data-stu-id="dc967-117">Create a staging environment</span></span>

> [!NOTE]
> <span data-ttu-id="dc967-118">このチュートリアルの執筆以来、ステージング環境と運用環境を作成するための多くのプロセスを自動化する新しい機能が追加されました Azure App Service。</span><span class="sxs-lookup"><span data-stu-id="dc967-118">Since this tutorial was written, Azure App Service added a new feature to automate many of the processes for creating staging and production environments.</span></span> <span data-ttu-id="dc967-119">「 [Azure App Service で web アプリのステージング環境を設定する](https://azure.microsoft.com/documentation/articles/web-sites-staged-publishing/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-119">See [Set up staging environments for web apps in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-staged-publishing/).</span></span>

<span data-ttu-id="dc967-120">「[テスト環境にデプロイする」チュートリアル](deploying-to-iis.md)で説明したように、最も信頼性の高いテスト環境は、実稼働 web サイトと同様に、ホスティングプロバイダーの web サイトです。</span><span class="sxs-lookup"><span data-stu-id="dc967-120">As explained in the [Deploy to the Test Environment tutorial](deploying-to-iis.md), the most reliable test environment is a web site at the hosting provider that's just like the production web site.</span></span> <span data-ttu-id="dc967-121">多くのホスティングプロバイダーでは、この利点と大幅な追加コストを比較する必要がありますが、Azure では、追加の無料 web アプリをステージングアプリとして作成できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-121">At many hosting providers you would have to weigh the benefits of this against significant additional cost, but in Azure you can create an additional free web app as your staging app.</span></span> <span data-ttu-id="dc967-122">また、データベースが必要であり、実稼働データベースを犠牲にした場合の追加費用は、[なし] または [最小] のどちらかになります。</span><span class="sxs-lookup"><span data-stu-id="dc967-122">You also need a database, and the additional expense for that over the expense of your production database will be either none or minimal.</span></span> <span data-ttu-id="dc967-123">Azure では、各データベースではなく、使用するデータベースストレージの量に対して課金されます。ステージングで使用する追加のストレージの量は最小限に抑えられます。</span><span class="sxs-lookup"><span data-stu-id="dc967-123">In Azure you pay for the amount of database storage you use rather than for each database, and the amount of additional storage you'll use in staging will be minimal.</span></span>

<span data-ttu-id="dc967-124">「[テスト環境にデプロイする」チュートリアル](deploying-to-iis.md)で説明したように、ステージング環境と運用環境では、2つのデータベースを1つのデータベースに配置します。</span><span class="sxs-lookup"><span data-stu-id="dc967-124">As explained in the [Deploy to the Test Environment tutorial](deploying-to-iis.md), in staging and production you're going to deploy your two databases into one database.</span></span> <span data-ttu-id="dc967-125">個別に保持する場合、プロセスは同じです。ただし、環境ごとに追加のデータベースを作成し、発行プロファイルを作成するときに、各データベースに対して正しい宛先文字列を選択する点が異なります。</span><span class="sxs-lookup"><span data-stu-id="dc967-125">If you wanted to keep them separate, the process would be the same except that you'd create an additional database for each environment and you would select the correct destination string for each database when you create the publish profile.</span></span>

<span data-ttu-id="dc967-126">チュートリアルのこのセクションでは、ステージング環境に使用する web アプリとデータベースを作成し、ステージング環境にデプロイしてテストしてから、運用環境にデプロイします。</span><span class="sxs-lookup"><span data-stu-id="dc967-126">In this section of the tutorial you'll create a web app and database to use for the staging environment, and you'll deploy to staging and test there before creating and deploying to the production environment.</span></span>

> [!NOTE]
> <span data-ttu-id="dc967-127">次の手順では、Azure 管理ポータルを使用して Azure App Service で web アプリを作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="dc967-127">The following steps show how to create a web app in Azure App Service by using the Azure management portal.</span></span> <span data-ttu-id="dc967-128">Azure SDK の最新バージョンでは、サーバーエクスプローラーを使用して、Visual Studio を離れることなくこの操作を行うこともできます。</span><span class="sxs-lookup"><span data-stu-id="dc967-128">In the latest version of the Azure SDK, you can also do this without leaving Visual Studio, by using Server Explorer.</span></span> <span data-ttu-id="dc967-129">Visual Studio 2013 では、[発行] ダイアログから直接 web アプリを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="dc967-129">In Visual Studio 2013, you can also create a web app directly from the Publish dialog.</span></span> <span data-ttu-id="dc967-130">詳細については、「 [Azure App Service での ASP.NET web アプリの作成](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-130">For more information, see [Create an ASP.NET web app in Azure App Service.](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)</span></span>

1. <span data-ttu-id="dc967-131">[Azure 管理ポータル](https://manage.windowsazure.com/)で **[Websites]** をクリックし、 **[New]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-131">In the [Azure Management Portal](https://manage.windowsazure.com/), click **Websites**, and then click **New**.</span></span>
2. <span data-ttu-id="dc967-132">**[Web サイト]** をクリックし、 **[カスタム作成]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-132">Click **Website**, and then click **Custom Create**.</span></span>

    <span data-ttu-id="dc967-133">**新しい Web サイト-カスタム作成**ウィザードが開きます。</span><span class="sxs-lookup"><span data-stu-id="dc967-133">The **New Website - Custom Create** wizard opens.</span></span> <span data-ttu-id="dc967-134">**カスタム作成**ウィザードを使用すると、web サイトとデータベースを同時に作成できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-134">The **Custom Create** wizard enables you to create a web site and a database at the same time.</span></span>
3. <span data-ttu-id="dc967-135">ウィザードの **[Web サイトの作成]** 手順で、アプリケーションのステージング環境の一意の url として使用する文字列を **[url]** ボックスに入力します。</span><span class="sxs-lookup"><span data-stu-id="dc967-135">In the **Create Website** step of the wizard, enter a string in the **URL** box to use as the unique URL for your application's staging environment.</span></span> <span data-ttu-id="dc967-136">たとえば、「ContosoUniversity-staging123」と入力します (ContosoUniversity の場合に一意になるように、末尾に乱数を含めます)。</span><span class="sxs-lookup"><span data-stu-id="dc967-136">For example, enter ContosoUniversity-staging123 (including random numbers at the end to make it unique in case ContosoUniversity-staging is taken).</span></span>

    <span data-ttu-id="dc967-137">完全な URL は、ここで入力した内容に、テキストボックスの横に表示されるサフィックスを加えたものになります。</span><span class="sxs-lookup"><span data-stu-id="dc967-137">The complete URL will consist of what you enter here plus the suffix that you see next to the text box.</span></span>
4. <span data-ttu-id="dc967-138">**[リージョン]** ドロップダウンリストで、ユーザーに最も近いリージョンを選択します。</span><span class="sxs-lookup"><span data-stu-id="dc967-138">In the **Region** drop-down list, choose the region that is closest to you.</span></span>

    <span data-ttu-id="dc967-139">この設定では、web アプリが実行されるデータセンターを指定します。</span><span class="sxs-lookup"><span data-stu-id="dc967-139">This setting specifies which data center your web app will run in.</span></span>
5. <span data-ttu-id="dc967-140">**[データベース]** ドロップダウンリストで、 **[新しい SQL データベースの作成]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="dc967-140">In the **Database** drop-down list, choose **Create a new SQL database**.</span></span>
6. <span data-ttu-id="dc967-141">**[DB 接続文字列名]** ボックスに、既定値の*defaultconnection*をそのまま使用します。</span><span class="sxs-lookup"><span data-stu-id="dc967-141">In the **DB Connection String Name** box, leave the default value, *DefaultConnection*.</span></span>
7. <span data-ttu-id="dc967-142">ボックスの下部にある右矢印をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-142">Click the arrow that points to the right at the bottom of the box.</span></span>

    <span data-ttu-id="dc967-143">次の図は、サンプルの値を含む **[Web サイトの作成]** ダイアログを示しています。</span><span class="sxs-lookup"><span data-stu-id="dc967-143">The following illustration shows the **Create Website** dialog with sample values in it.</span></span> <span data-ttu-id="dc967-144">入力した URL とリージョンは異なります。</span><span class="sxs-lookup"><span data-stu-id="dc967-144">The URL and Region that you have entered will be different.</span></span>

    ![Web サイトの作成手順](deploying-to-production/_static/image1.png)

    <span data-ttu-id="dc967-146">ウィザードは、 **[データベースの設定の指定]** 手順に進みます。</span><span class="sxs-lookup"><span data-stu-id="dc967-146">The wizard advances to the **Specify database settings** step.</span></span>
8. <span data-ttu-id="dc967-147">**[名前]** ボックスに「 *ContosoUniversity* 」と入力し、たとえば「 *ContosoUniversity123*」と入力します。</span><span class="sxs-lookup"><span data-stu-id="dc967-147">In the **Name** box, enter *ContosoUniversity* plus a random number to make it unique, for example *ContosoUniversity123*.</span></span>
9. <span data-ttu-id="dc967-148">**[サーバー]** ボックスで、 **[新しい SQL Database サーバー]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="dc967-148">In the **Server** box, select **New SQL Database Server**.</span></span>
10. <span data-ttu-id="dc967-149">管理者の名前とパスワードを入力します。</span><span class="sxs-lookup"><span data-stu-id="dc967-149">Enter an administrator name and password.</span></span>

    <span data-ttu-id="dc967-150">ここには既存の名前とパスワードを入力していません。</span><span class="sxs-lookup"><span data-stu-id="dc967-150">You aren't entering an existing name and password here.</span></span> <span data-ttu-id="dc967-151">後でデータベースにアクセスするときに使用するために定義する新しい名前とパスワードを入力します。</span><span class="sxs-lookup"><span data-stu-id="dc967-151">You're entering a new name and password that you're defining now to use later when you access the database.</span></span>
11. <span data-ttu-id="dc967-152">**[リージョン]** ボックスで、web アプリ用に選択したのと同じリージョンを選択します。</span><span class="sxs-lookup"><span data-stu-id="dc967-152">In the **Region** box, choose the same region that you chose for the web app.</span></span>

    <span data-ttu-id="dc967-153">Web サーバーとデータベースサーバーを同じリージョンに保持することで、最高のパフォーマンスが得られ、コストを最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="dc967-153">Keeping the web server and the database server in the same region gives you the best performance and minimizes expenses.</span></span>
12. <span data-ttu-id="dc967-154">終了したことを示すには、ボックスの下部にあるチェックマークをクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-154">Click the check mark at the bottom of the box to indicate that you're finished.</span></span>

    <span data-ttu-id="dc967-155">次の図は、 **[データベースの設定の指定]** ダイアログを示しています。</span><span class="sxs-lookup"><span data-stu-id="dc967-155">The following illustration shows the **Specify database settings** dialog with sample values in it.</span></span> <span data-ttu-id="dc967-156">入力した値が異なる場合があります。</span><span class="sxs-lookup"><span data-stu-id="dc967-156">The values you have entered may be different.</span></span>

    ![新しい Web サイト-データベースを使用した作成ウィザードの [データベースの設定] 手順](deploying-to-production/_static/image2.png)

    <span data-ttu-id="dc967-158">管理ポータルが Websites ページに戻り、 **[状態]** 列に web アプリが作成されていることが示されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-158">The Management Portal returns to the Websites page, and the **Status** column shows that the web app is being created.</span></span> <span data-ttu-id="dc967-159">しばらくすると (通常は1分未満)、web アプリが正常に作成されたことが **[状態]** 列に表示されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-159">After a while (typically less than a minute), the **Status** column shows that the web app was successfully created.</span></span> <span data-ttu-id="dc967-160">左側のナビゲーションバーで、アカウントにある web アプリの数が**Websites**アイコンの横に表示され、 **[SQL データベース]** アイコンの横にデータベースの数が表示されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-160">In the navigation bar at the left, the number of web apps you have in your account appears next to the **Websites** icon, and the number of databases appears next to the **SQL Databases** icon.</span></span>

    ![管理ポータルの web サイトページ、作成された web サイト](deploying-to-production/_static/image3.png)

    <span data-ttu-id="dc967-162">Web アプリ名は、この図のサンプルアプリとは異なります。</span><span class="sxs-lookup"><span data-stu-id="dc967-162">Your web app name will be different from the example app in the illustration.</span></span>

## <a name="deploy-the-application-to-staging"></a><span data-ttu-id="dc967-163">アプリケーションをステージングにデプロイする</span><span class="sxs-lookup"><span data-stu-id="dc967-163">Deploy the application to staging</span></span>

<span data-ttu-id="dc967-164">ステージング環境用の web アプリとデータベースを作成したので、プロジェクトを配置できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-164">Now that you have created a web app and database for the staging environment, you can deploy the project to it.</span></span>

> [!NOTE]
> <span data-ttu-id="dc967-165">次の手順では、.publishsettings ファイルをダウンロードして発行プロファイルを作成する方法を説明*します。* このファイルは、Azure だけでなく、サードパーティのホスティングプロバイダーでも機能します。</span><span class="sxs-lookup"><span data-stu-id="dc967-165">These instructions show how to create a publish profile by downloading a *.publishsettings* file, which works not only for Azure but also for third-party hosting providers.</span></span> <span data-ttu-id="dc967-166">最新の Azure SDK では、Visual Studio から Azure に直接接続し、Azure アカウントにある web アプリの一覧から選択することもできます。</span><span class="sxs-lookup"><span data-stu-id="dc967-166">The latest Azure SDK also enables you to connect directly to Azure from Visual Studio, and choose from a list of web apps that you have in your Azure account.</span></span> <span data-ttu-id="dc967-167">Visual Studio 2013 では、 **[Web 発行]** ダイアログボックスまたは **[サーバーエクスプローラー]** ウィンドウから Azure にサインインできます。</span><span class="sxs-lookup"><span data-stu-id="dc967-167">In Visual Studio 2013, you can sign in to Azure from the **Web Publish** dialog or from the **Server Explorer** window.</span></span> <span data-ttu-id="dc967-168">詳細については、「 [Azure App Service での ASP.NET web アプリの作成](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-168">For more information, see [Create an ASP.NET web app in Azure App Service](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span></span>

### <a name="download-the-publishsettings-file"></a><span data-ttu-id="dc967-169">.Publishsettings ファイルをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="dc967-169">Download the .publishsettings file</span></span>

1. <span data-ttu-id="dc967-170">先ほど作成した web アプリの名前をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-170">Click the name of the web app that you just created.</span></span>

    ![ダッシュボードにアクセスするには、サイトをクリックします](deploying-to-production/_static/image4.png)
2. <span data-ttu-id="dc967-172">**[ダッシュボード]** タブの **[概要]** で、 **[発行プロファイルのダウンロード]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-172">Under **Quick glance** in the **Dashboard** tab, click **Download publish profile**.</span></span>

    ![発行プロファイルのダウンロードのリンク](deploying-to-production/_static/image5.png)

    <span data-ttu-id="dc967-174">この手順では、web アプリにアプリケーションを配置するために必要なすべての設定を含むファイルをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="dc967-174">This step downloads a file that contains all of the settings that you need in order to deploy an application to your web app.</span></span> <span data-ttu-id="dc967-175">このファイルを Visual Studio にインポートすると、この情報を手動で入力する必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="dc967-175">You'll import this file into Visual Studio so you don't have to enter this information manually.</span></span>
3. <span data-ttu-id="dc967-176">Visual Studio からアクセスできるフォルダーに *.publishsettings*ファイルを保存します。</span><span class="sxs-lookup"><span data-stu-id="dc967-176">Save the *.publishsettings* file in a folder that you can access from Visual Studio.</span></span>

    ![.publishsettings ファイルを保存しています](deploying-to-production/_static/image6.png)

    > [!WARNING]
    > <span data-ttu-id="dc967-178">セキュリティ- *.publishsettings*ファイルには、Azure サブスクリプションとサービスの管理に使用される資格情報 (エンコードされていない) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="dc967-178">Security - The *.publishsettings* file contains your credentials (unencoded) that are used to administer your Azure subscriptions and services.</span></span> <span data-ttu-id="dc967-179">このファイルのセキュリティのベストプラクティスは、ソースディレクトリの外部 (たとえば、[ライブラリ] フォルダー内) に一時的に保存し、インポートが完了した後に削除することです。</span><span class="sxs-lookup"><span data-stu-id="dc967-179">The security best practice for this file is to store it temporarily outside your source directories (for example in the Libraries\Documents folder), and then delete it once the import has completed.</span></span> <span data-ttu-id="dc967-180">悪意のあるユーザーが *.publishsettings*ファイルにアクセスすると、Azure サービスを編集、作成、削除できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-180">A malicious user who gains access to the *.publishsettings* file can edit, create, and delete your Azure services.</span></span>

### <a name="create-a-publish-profile"></a><span data-ttu-id="dc967-181">発行プロファイルを作成する</span><span class="sxs-lookup"><span data-stu-id="dc967-181">Create a publish profile</span></span>

1. <span data-ttu-id="dc967-182">Visual Studio で**ソリューションエクスプローラー**で ContosoUniversity プロジェクトを右クリックし、コンテキストメニューから **[発行]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="dc967-182">In Visual Studio, right-click the ContosoUniversity project in **Solution Explorer** and select **Publish** from the context menu.</span></span>

    <span data-ttu-id="dc967-183">**Web の発行**ウィザードが開きます。</span><span class="sxs-lookup"><span data-stu-id="dc967-183">The **Publish Web** wizard opens.</span></span>
2. <span data-ttu-id="dc967-184">**[プロファイル]** タブをクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-184">Click the **Profile** tab.</span></span>
3. <span data-ttu-id="dc967-185">**[インポート]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-185">Click **Import**.</span></span>
4. <span data-ttu-id="dc967-186">前の手順でダウンロードした *.publishsettings*ファイルに移動し、 **[開く]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-186">Navigate to the *.publishsettings* file you downloaded earlier, and then click **Open**.</span></span>

    ![[発行設定のインポート] ダイアログボックス](deploying-to-production/_static/image7.png)
5. <span data-ttu-id="dc967-188">**[接続]** タブで、 **[接続の検証]** をクリックして、設定が正しいことを確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-188">In the **Connection** tab, click **Validate Connection** to make sure that the settings are correct.</span></span>

    <span data-ttu-id="dc967-189">接続が検証されると、 **[接続の検証]** ボタンの横に緑色のチェックマークが表示されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-189">When the connection has been validated, a green check mark is shown next to the **Validate Connection** button.</span></span>

    <span data-ttu-id="dc967-190">一部のホスティングプロバイダーでは、 **[接続の検証]** をクリックすると、 **[証明書のエラー]** ダイアログボックスが表示する場合があります。</span><span class="sxs-lookup"><span data-stu-id="dc967-190">For some hosting providers, when you click **Validate Connection**, you might see a **Certificate Error** dialog box.</span></span> <span data-ttu-id="dc967-191">その場合は、サーバー名が予期したとおりであることを確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-191">If you do, verify that the server name is what you expect.</span></span> <span data-ttu-id="dc967-192">サーバー名が正しい場合は、 **[この証明書を Visual Studio の今後のセッション用に保存する]** を選択し、 **[同意]** する をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-192">If the server name is correct, select **Save this certificate for future sessions of Visual Studio** and click **Accept**.</span></span> <span data-ttu-id="dc967-193">(このエラーは、デプロイ先の URL に対して SSL 証明書を購入する費用が発生しないように、ホスティングプロバイダーによって選択されたことを意味します。</span><span class="sxs-lookup"><span data-stu-id="dc967-193">(This error means that the hosting provider has chosen to avoid the expense of purchasing an SSL certificate for the URL that you are deploying to.</span></span> <span data-ttu-id="dc967-194">有効な証明書を使用してセキュリティで保護された接続を確立する場合は、ホスティングプロバイダーに問い合わせてください。)</span><span class="sxs-lookup"><span data-stu-id="dc967-194">If you prefer to establish a secure connection by using a valid certificate, contact your hosting provider.)</span></span>
6. <span data-ttu-id="dc967-195">[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-195">Click **Next**.</span></span>

    ![[接続] タブの [接続成功] アイコンと [次へ] ボタン](deploying-to-production/_static/image8.png)
7. <span data-ttu-id="dc967-197">**[設定]** タブで、 **[ファイル発行オプション]** を展開し、[**アプリ\_データフォルダーからファイルを除外する**] を選択します。</span><span class="sxs-lookup"><span data-stu-id="dc967-197">In the **Settings** tab, expand **File Publish Options**, and then select **Exclude files from the App\_Data folder**.</span></span>

    <span data-ttu-id="dc967-198">**[ファイル発行オプション]** の他のオプションの詳細については、「 [IIS への展開](deploying-to-iis.md)」チュートリアルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-198">For information about the other options under **File Publish Options**, see the [deploying to IIS](deploying-to-iis.md) tutorial.</span></span> <span data-ttu-id="dc967-199">この手順の結果と次のデータベース構成手順を示すスクリーンショットは、データベースの構成手順の最後にあります。</span><span class="sxs-lookup"><span data-stu-id="dc967-199">The screen shot that shows the result of this step and the following database configuration steps is at the end of the database configuration steps.</span></span>
8. <span data-ttu-id="dc967-200">**[データベース]** セクションの **[defaultconnection]** で、メンバーシップデータベースのデータベースの配置を構成します。</span><span class="sxs-lookup"><span data-stu-id="dc967-200">Under **DefaultConnection** in the **Databases** section, configure database deployment for the membership database.</span></span>
9. 1. <span data-ttu-id="dc967-201">**[データベースの更新]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="dc967-201">Select **Update database**.</span></span>

        <span data-ttu-id="dc967-202">**Defaultconnection**のすぐ下にある **[リモート接続文字列]** ボックスに、.publishsettings ファイルの接続文字列が入力されます。接続文字列には SQL Server 資格情報が含まれています。これは、 *pubxml*ファイルにプレーンテキストで格納されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-202">The **Remote connection string** box directly below **DefaultConnection** is filled in with the connection string from the .publishsettings file.The connection string includes SQL Server credentials, which are stored in plain text in the *.pubxml* file.</span></span> <span data-ttu-id="dc967-203">完全に保存しない場合は、データベースをデプロイした後に発行プロファイルからそれらを削除し、代わりに Azure に保存することができます。</span><span class="sxs-lookup"><span data-stu-id="dc967-203">If you prefer not to store them permanently there, you can remove them from the publish profile after the database is deployed and store them in Azure instead.</span></span> <span data-ttu-id="dc967-204">詳細については、Scott マン Selman のブログの[ソースから Azure へのデプロイ時に ASP.NET database 接続文字列を安全に保つ方法に](http://www.hanselman.com/blog/HowToKeepYourASPNETDatabaseConnectionStringsSecureWhenDeployingToAzureFromSource.aspx)関する記事をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="dc967-204">For more information, see [How to keep your ASP.NET database connection strings secure when deploying to Azure from Source](http://www.hanselman.com/blog/HowToKeepYourASPNETDatabaseConnectionStringsSecureWhenDeployingToAzureFromSource.aspx) on Scott Hanselman's blog.</span></span>
      2. <span data-ttu-id="dc967-205">**[データベースの更新の構成]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-205">Click **Configure database updates**.</span></span>
      3. <span data-ttu-id="dc967-206">**[データベースの更新の構成]** ダイアログボックスで、 **[SQL スクリプトの追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-206">In the **Configure Database Updates** dialog box, click **Add SQL Script**.</span></span>
      4. <span data-ttu-id="dc967-207">**[SQL スクリプトの追加]** ボックスで、ソリューションフォルダーの前の手順で保存した*aspnet-data-prod*スクリプトに移動し、 **[開く]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-207">In the **Add SQL Script** box, navigate to the *aspnet-data-prod.sql* script that you saved earlier in the solution folder, and then click **Open**.</span></span>
      5. <span data-ttu-id="dc967-208">**[データベースの更新の構成]** ダイアログボックスを閉じます。</span><span class="sxs-lookup"><span data-stu-id="dc967-208">Close the **Configure Database Updates** dialog box.</span></span>
10. <span data-ttu-id="dc967-209">**[データベース]** セクションの **[schoolcontext.cs]** で、 **[Code First Migrations の実行 (アプリケーションの起動時に実行)]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="dc967-209">Under **SchoolContext** in the **Databases** section, select **Execute Code First Migrations (runs on application start)**.</span></span>

    <span data-ttu-id="dc967-210">Visual Studio では、`DbContext` クラスの**更新データベース**ではなく**Execute Code First Migrations**が表示されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-210">Visual Studio displays **Execute Code First Migrations** instead of **Update Database** for `DbContext` classes.</span></span> <span data-ttu-id="dc967-211">移行ではなく dbDacFx プロバイダーを使用して、`DbContext` クラスを使用してアクセスするデータベースを配置する場合は、「Visual Studio の Web 配置に関する FAQ」と MSDN の ASP.NET を参照し[Code First 操作方法](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations)てください。</span><span class="sxs-lookup"><span data-stu-id="dc967-211">If you want to use the dbDacFx provider instead of Migrations to deploy a database that you access by using a `DbContext` class, see [How do I deploy a Code First database without Migrations?](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations) in the Web Deployment FAQ for Visual Studio and ASP.NET on MSDN.</span></span>

    <span data-ttu-id="dc967-212">**[設定]** タブは、次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="dc967-212">The **Settings** tab now looks like the following example:</span></span>

    ![ステージングの [設定] タブ](deploying-to-production/_static/image9.png)
11. <span data-ttu-id="dc967-214">次の手順を実行して、プロファイルを保存し、名前を「*ステージング*」に変更します。</span><span class="sxs-lookup"><span data-stu-id="dc967-214">Perform the following steps to save the profile and rename it to *Staging*:</span></span>

    1. <span data-ttu-id="dc967-215">**[プロファイル]** タブをクリックし、 **[プロファイルの管理]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-215">Click the **Profile** tab, and then click **Manage Profiles**.</span></span>
    2. <span data-ttu-id="dc967-216">インポートによって、FTP 用と Web 配置用の2つの新しいプロファイルが作成されました。</span><span class="sxs-lookup"><span data-stu-id="dc967-216">The import created two new profiles, one for FTP and one for Web Deploy.</span></span> <span data-ttu-id="dc967-217">Web 配置プロファイルを構成しました: このプロファイルの名前を*ステージング*に変更します。</span><span class="sxs-lookup"><span data-stu-id="dc967-217">You configured the Web Deploy profile: rename this profile to *Staging*.</span></span>

        ![プロファイル名をステージングに変更](deploying-to-production/_static/image10.png)
    3. <span data-ttu-id="dc967-219">**[Web 発行プロファイルの編集]** ダイアログボックスを閉じます。</span><span class="sxs-lookup"><span data-stu-id="dc967-219">Close the **Edit Web Publish Profiles** dialog box.</span></span>
    4. <span data-ttu-id="dc967-220">Web の**発行**ウィザードを閉じます。</span><span class="sxs-lookup"><span data-stu-id="dc967-220">Close the **Publish Web** wizard.</span></span>

### <a name="configure-a-publish-profile-transform-for-the-environment-indicator"></a><span data-ttu-id="dc967-221">環境インジケーターの発行プロファイルの変換を構成する</span><span class="sxs-lookup"><span data-stu-id="dc967-221">Configure a publish profile transform for the environment indicator</span></span>

> [!NOTE]
> <span data-ttu-id="dc967-222">このセクションでは、環境インジケーターの web.config 変換を設定する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="dc967-222">This section shows how to set up a Web.config transform for the environment indicator.</span></span> <span data-ttu-id="dc967-223">インジケーターは `<appSettings>` 要素内にあるため、Azure App Service を配置するときに変換を指定する別の方法があります。</span><span class="sxs-lookup"><span data-stu-id="dc967-223">Because the indicator is in the `<appSettings>` element, you have another alternative for specifying the transformation when you're deploying to Azure App Service.</span></span> <span data-ttu-id="dc967-224">詳細については、「 [Azure での web.config 設定の指定](web-config-transformations.md#watransforms)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-224">For more information, see [Specifying Web.config settings in Azure](web-config-transformations.md#watransforms).</span></span>

1. <span data-ttu-id="dc967-225">**ソリューションエクスプローラー**で、 **[プロパティ]** 、 **[publishprofiles]** の順に展開します。</span><span class="sxs-lookup"><span data-stu-id="dc967-225">In **Solution Explorer**, expand **Properties**, and then expand **PublishProfiles**.</span></span>
2. <span data-ttu-id="dc967-226">[ *Pubxml*] を右クリックし、 **[構成の変換の追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-226">Right-click *Staging.pubxml*, and then click **Add Config Transform**.</span></span>

    ![ステージング用の構成変換の追加](deploying-to-production/_static/image11.png)

    <span data-ttu-id="dc967-228">Visual *Studio によって、web.config 変換*ファイルが作成されて開きます。</span><span class="sxs-lookup"><span data-stu-id="dc967-228">Visual Studio creates the *Web.Staging.config* transform file and opens it.</span></span>
3. <span data-ttu-id="dc967-229">*Web.config 変換ファイル*で、開始 `configuration` タグの直後に次のコードを挿入します。</span><span class="sxs-lookup"><span data-stu-id="dc967-229">In the *Web.Staging.config* transform file, insert the following code immediately after the opening `configuration` tag.</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample1.xml)]

    <span data-ttu-id="dc967-230">ステージング発行プロファイルを使用すると、この変換によって環境インジケーターが "運用" に設定されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-230">When you use the Staging publish profile, this transform sets the environment indicator to "Prod".</span></span> <span data-ttu-id="dc967-231">デプロイされた web アプリでは、"(Dev)" や "(Test)" などのサフィックスは "Contoso 大学" H1 見出しの後には表示されません。</span><span class="sxs-lookup"><span data-stu-id="dc967-231">In the deployed web app, you won't see any suffix such as "(Dev)" or "(Test)" after the "Contoso University" H1 heading.</span></span>
4. <span data-ttu-id="dc967-232">*Web.config ファイルを*右クリックし、 **[変換のプレビュー]** をクリックして、コード化された変換によって予想される変更が生成されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-232">Right-click the *Web.Staging.config* file and click **Preview Transform** to make sure that the transform you coded produces the expected changes.</span></span>

    <span data-ttu-id="dc967-233">Web.config の**プレビュー**ウィンドウには、 *web.config 変換と* *web.config 変換の*両方を適用した結果が表示されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-233">The **Web.config Preview** window shows the result of applying both the *Web.Release.config* transforms and the *Web.Staging.config* transforms.</span></span>

### <a name="prevent-public-use-of-the-test-app"></a><span data-ttu-id="dc967-234">テストアプリが一般に使用されないようにする</span><span class="sxs-lookup"><span data-stu-id="dc967-234">Prevent public use of the test app</span></span>

<span data-ttu-id="dc967-235">ステージングアプリに関する重要な考慮事項は、インターネット上で公開されていても、パブリックに使用しないようにすることです。</span><span class="sxs-lookup"><span data-stu-id="dc967-235">An important consideration for the staging app is that it will be live on the Internet, but you don't want the public to use it.</span></span> <span data-ttu-id="dc967-236">ユーザーが見つけて使用する可能性を最小限に抑えるには、次の方法のうち1つ以上を使用します。</span><span class="sxs-lookup"><span data-stu-id="dc967-236">To minimize the likelihood that people will find and use it, you can use one or more of the following methods:</span></span>

- <span data-ttu-id="dc967-237">ステージングアプリへのアクセスを許可するファイアウォール規則を、ステージングのテストに使用する IP アドレスからのみ設定します。</span><span class="sxs-lookup"><span data-stu-id="dc967-237">Set firewall rules that allow access to the staging app only from IP addresses that you use to test staging.</span></span>
- <span data-ttu-id="dc967-238">推測が不可能な難読化された URL を使用します。</span><span class="sxs-lookup"><span data-stu-id="dc967-238">Use an obfuscated URL that would be impossible to guess.</span></span>
- <span data-ttu-id="dc967-239">*Robots.txt*ファイルを作成して、検索エンジンがテストアプリとレポートリンクを検索結果にクロールしないようにします。</span><span class="sxs-lookup"><span data-stu-id="dc967-239">Create a *robots.txt* file to ensure that search engines will not crawl the test app and report links to it in search results.</span></span>

<span data-ttu-id="dc967-240">これらの方法のうちの1つは最も効果的ですが、このチュートリアルでは説明しません。 Azure App Service ではなく Azure クラウドサービスにデプロイする必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="dc967-240">The first of these methods is the most effective but is not covered in this tutorial because it would require that you deploy to an Azure Cloud Service instead of Azure App Service.</span></span> <span data-ttu-id="dc967-241">Azure での Cloud Services と IP の制限の詳細については、「 [azure によって提供されるコンピューティングホスティングオプション](https://docs.microsoft.com/azure/cloud-services/cloud-services-choose-me)」を参照してください。また、[特定の Ip アドレスから Web ロールへのアクセスをブロックする](https://msdn.microsoft.com/library/windowsazure/jj154098.aspx)ことができます。</span><span class="sxs-lookup"><span data-stu-id="dc967-241">For more information about Cloud Services and IP restrictions in Azure, see [Compute Hosting Options Provided by Azure](https://docs.microsoft.com/azure/cloud-services/cloud-services-choose-me) and [Block Specific IP Addresses from Accessing a Web Role](https://msdn.microsoft.com/library/windowsazure/jj154098.aspx).</span></span> <span data-ttu-id="dc967-242">サードパーティのホスティングプロバイダーにデプロイする場合は、プロバイダーに問い合わせて、IP 制限を実装する方法を確認してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-242">If you are deploying to a third-party hosting provider, contact the provider to find out how to implement IP restrictions.</span></span>

<span data-ttu-id="dc967-243">このチュートリアルでは、 *robots.txt*ファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="dc967-243">For this tutorial, you'll create a *robots.txt* file.</span></span>

1. <span data-ttu-id="dc967-244">**ソリューションエクスプローラー**で、ContosoUniversity プロジェクトを右クリックし、 **[新しい項目の追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-244">In **Solution Explorer**, right-click the ContosoUniversity project and click **Add New Item**.</span></span>
2. <span data-ttu-id="dc967-245">*Robots.txt*という名前の新しい**テキストファイル**を作成し、次のテキストを入力します。</span><span class="sxs-lookup"><span data-stu-id="dc967-245">Create a new **Text File** named *robots.txt*, and put the following text in it:</span></span>

    [!code-console[Main](deploying-to-production/samples/sample2.cmd)]

    <span data-ttu-id="dc967-246">`User-agent` 行は、ファイル内のルールがすべての検索エンジン web クローラー (ロボット) に適用されることを検索エンジンに通知します。また、`Disallow` 行は、サイトのページをクロールする必要がないことを指定します。</span><span class="sxs-lookup"><span data-stu-id="dc967-246">The `User-agent` line tells search engines that the rules in the file apply to all search engine web crawlers (robots), and the `Disallow` line specifies that no pages on the site should be crawled.</span></span>

    <span data-ttu-id="dc967-247">検索エンジンで運用アプリのカタログを作成する場合は、このファイルを運用環境のデプロイから除外する必要があります。</span><span class="sxs-lookup"><span data-stu-id="dc967-247">You do want search engines to catalog your production app, so you need to exclude this file from production deployment.</span></span> <span data-ttu-id="dc967-248">これを行うには、作成時に実稼働発行プロファイルに設定を構成します。</span><span class="sxs-lookup"><span data-stu-id="dc967-248">To do that, you'll configure a setting in the Production publish profile when you create it.</span></span>

### <a name="deploy-to-staging"></a><span data-ttu-id="dc967-249">ステージング環境へのデプロイ</span><span class="sxs-lookup"><span data-stu-id="dc967-249">Deploy to staging</span></span>

1. <span data-ttu-id="dc967-250">Contoso 大学プロジェクトを右クリックし、 **[発行]** をクリックして、 **Web の発行**ウィザードを開きます。</span><span class="sxs-lookup"><span data-stu-id="dc967-250">Open the **Publish Web** wizard by right-clicking the Contoso University project and clicking **Publish**.</span></span>
2. <span data-ttu-id="dc967-251">**ステージング**プロファイルが選択されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-251">Make sure that the **Staging** profile is selected.</span></span>
3. <span data-ttu-id="dc967-252">**[発行]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-252">Click **Publish**.</span></span>

    <span data-ttu-id="dc967-253">**[出力]** ウィンドウには、実行された配置アクションが表示され、デプロイが正常に完了したことがレポートされます。</span><span class="sxs-lookup"><span data-stu-id="dc967-253">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span> <span data-ttu-id="dc967-254">既定のブラウザーが自動的に開き、デプロイされた web アプリの URL が表示されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-254">The default browser automatically opens to the URL of the deployed web app.</span></span>

## <a name="test-in-the-staging-environment"></a><span data-ttu-id="dc967-255">ステージング環境でのテスト</span><span class="sxs-lookup"><span data-stu-id="dc967-255">Test in the staging environment</span></span>

<span data-ttu-id="dc967-256">環境インジケーターが存在しないことに注意してください ("(テスト)" または "(Dev)" は H1 見出しの後にあります。これは、環境インジケーターの*web.config 変換が*成功したことを示しています。</span><span class="sxs-lookup"><span data-stu-id="dc967-256">Notice that the environment indicator is absent (there is no "(Test)" or "(Dev)" after the H1 heading, which shows that the *Web.config* transformation for the environment indicator was successful.</span></span>

![ホームページのステージング](deploying-to-production/_static/image12.png)

<span data-ttu-id="dc967-258">**[Students]** ページを実行して、デプロイされたデータベースに学生がいないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-258">Run the **Students** page to verify that the deployed database has no students.</span></span>

<span data-ttu-id="dc967-259">**インストラクターページを**実行して、Code First がインストラクターのデータでデータベースをシード処理したことを確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-259">Run the **Instructors** page to verify that Code First seeded the database with instructor data:</span></span>

<span data-ttu-id="dc967-260">[**学生] メニュー**から 学生の **[追加]** を選択し、学生を追加します。次に、 **[学生]** ページで新しい学生を表示して、データベースへの書き込みが正常に完了したことを確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-260">Select **Add Students** from the **Students** menu, add a student, and then view the new student in the **Students** page to verify that you can successfully write to the database.</span></span>

<span data-ttu-id="dc967-261">**[コース]** ページで、 **[クレジットの更新]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-261">From the **Courses** page, click **Update Credits**.</span></span> <span data-ttu-id="dc967-262">**[更新プログラムのクレジット]** ページには管理者権限が必要であるため、 **[ログイン]** ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-262">The **Update Credits** page requires administrator permissions, so the **Log In** page is displayed.</span></span> <span data-ttu-id="dc967-263">前の手順で作成した管理者アカウントの資格情報を入力します ("admin" と "prodpwd")。</span><span class="sxs-lookup"><span data-stu-id="dc967-263">Enter the administrator account credentials that you created earlier ("admin" and "prodpwd").</span></span> <span data-ttu-id="dc967-264">**[更新プログラムのクレジット]** ページが表示され、前のチュートリアルで作成した管理者アカウントがテスト環境に正しく配置されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-264">The **Update Credits** page is displayed, which verifies that the administrator account that you created in the previous tutorial was correctly deployed to the test environment.</span></span>

<span data-ttu-id="dc967-265">無効な URL を要求して、ELMAH が追跡するエラーを発生させ、ELMAH エラー報告を要求します。</span><span class="sxs-lookup"><span data-stu-id="dc967-265">Request an invalid URL to cause an error that ELMAH will track, and then request the ELMAH error report.</span></span> <span data-ttu-id="dc967-266">サードパーティのホスティングプロバイダーに配置している場合は、前のチュートリアルで空だったのと同じ理由でレポートが空であることがわかります。</span><span class="sxs-lookup"><span data-stu-id="dc967-266">If you are deploying to a third-party hosting provider, you will probably find that the report is empty for the same reason that it was empty in the previous tutorial.</span></span> <span data-ttu-id="dc967-267">フォルダーのアクセス許可を構成するには、ホスティングプロバイダーのアカウント管理ツールを使用して、ELMAH がログフォルダーに書き込むことができるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="dc967-267">You will have to use the hosting provider's account management tools to configure folder permissions to enable ELMAH to write to the log folder.</span></span>

<span data-ttu-id="dc967-268">これで、作成したアプリケーションは、運用環境で使用するものと同じように、web アプリのクラウドで実行されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-268">The application that you created is now running in the cloud in a web app that is just like what you will use for production.</span></span> <span data-ttu-id="dc967-269">すべてが正常に動作しているため、次の手順は運用環境にデプロイすることです。</span><span class="sxs-lookup"><span data-stu-id="dc967-269">Since everything is working correctly, the next step is to deploy to production.</span></span>

## <a name="deploy-to-production"></a><span data-ttu-id="dc967-270">運用環境へのデプロイ</span><span class="sxs-lookup"><span data-stu-id="dc967-270">Deploy to production</span></span>

<span data-ttu-id="dc967-271">運用 web アプリを作成し、運用環境にデプロイするプロセスは、ステージングの場合と同じですが、配置から*robots.txt*を除外する必要がある点が異なります。</span><span class="sxs-lookup"><span data-stu-id="dc967-271">The process for creating a production web app and deploying to production is the same as for staging, except that you need to exclude the *robots.txt* from deployment.</span></span> <span data-ttu-id="dc967-272">これを行うには、発行プロファイルファイルを編集します。</span><span class="sxs-lookup"><span data-stu-id="dc967-272">To do that you'll edit the publish profile file.</span></span>

### <a name="create-the-production-environment-and-the-production-publish-profile"></a><span data-ttu-id="dc967-273">運用環境と実稼働発行プロファイルを作成する</span><span class="sxs-lookup"><span data-stu-id="dc967-273">Create the production environment and the production publish profile</span></span>

1. <span data-ttu-id="dc967-274">ステージングに使用したのと同じ手順に従って、運用 web アプリとデータベースを Azure に作成します。</span><span class="sxs-lookup"><span data-stu-id="dc967-274">Create the production web app and database in Azure, following the same procedure that you used for staging.</span></span>

    <span data-ttu-id="dc967-275">データベースを作成するときに、以前に作成したのと同じサーバーに配置するか、新しいサーバーを作成するかを選択できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-275">When you create the database, you can choose to put it on the same server you created earlier, or create a new server.</span></span>
2. <span data-ttu-id="dc967-276">*.Publishsettings*ファイルをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="dc967-276">Download the *.publishsettings* file.</span></span>
3. <span data-ttu-id="dc967-277">ステージングに使用したのと同じ手順に従って、 *.publishsettings*ファイルをインポートして発行プロファイルを作成します。</span><span class="sxs-lookup"><span data-stu-id="dc967-277">Create the publish profile by importing the production *.publishsettings* file, following the same procedure that you used for staging.</span></span>

    <span data-ttu-id="dc967-278">**[設定]** タブの **[データベース]** セクションで、 **[defaultconnection]** の下にあるデータ配置スクリプトを必ず構成してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-278">Don't forget to configure the data deployment script under **DefaultConnection** in the **Databases** section of the **Settings** tab.</span></span>
4. <span data-ttu-id="dc967-279">発行プロファイルの名前を*運用環境*に変更します。</span><span class="sxs-lookup"><span data-stu-id="dc967-279">Rename the publish profile to *Production*.</span></span>
5. <span data-ttu-id="dc967-280">ステージングに使用したのと同じ手順に従って、環境インジケーターの発行プロファイルの変換を構成します。</span><span class="sxs-lookup"><span data-stu-id="dc967-280">Configure a publish profile transform for the environment indicator, following the same procedure that you used for staging..</span></span>

### <a name="edit-the-pubxml-file-to-exclude-robotstxt"></a><span data-ttu-id="dc967-281">Pubxml ファイルを編集して robots.txt を除外する</span><span class="sxs-lookup"><span data-stu-id="dc967-281">Edit the .pubxml file to exclude robots.txt</span></span>

<span data-ttu-id="dc967-282">発行プロファイルファイルには &lt;*profilename&gt;と*いう名前が付けられ、 *publishprofiles*フォルダーにあります。</span><span class="sxs-lookup"><span data-stu-id="dc967-282">Publish profile files are named &lt;profilename&gt;*.pubxml* and are located in the *PublishProfiles* folder.</span></span> <span data-ttu-id="dc967-283">*Publishprofiles* C#フォルダーは、web アプリケーションプロジェクトの [*プロパティ*] フォルダーの下、VB Web アプリケーションプロジェクトの [ *My project* ] フォルダーの下、または web アプリプロジェクトの [ *App\_Data* ] フォルダーの下にあります。</span><span class="sxs-lookup"><span data-stu-id="dc967-283">The *PublishProfiles* folder is under the *Properties* folder in a C# web application project, under the *My Project* folder in a VB web application project, or under the *App\_Data* folder in a web app project.</span></span> <span data-ttu-id="dc967-284">各*pubxml*ファイルには、1つの発行プロファイルに適用される設定が含まれています。</span><span class="sxs-lookup"><span data-stu-id="dc967-284">Each *.pubxml* file contains settings that apply to one publish profile.</span></span> <span data-ttu-id="dc967-285">Web の発行ウィザードで入力した値はこれらのファイルに格納され、Visual Studio UI では使用できない設定を作成または変更するために編集できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-285">The values you enter in the Publish Web wizard are stored in these files, and you can edit them to create or change settings that aren't made available in the Visual Studio UI.</span></span>

<span data-ttu-id="dc967-286">既定では、発行プロファイルを作成するときに、 *pubxml*ファイルはプロジェクトに含まれますが、プロジェクトから除外することができ、Visual Studio では引き続き使用されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-286">By default, *.pubxml* files are included in the project when you create a publish profile, but you can exclude them from the project and Visual Studio will still use them.</span></span> <span data-ttu-id="dc967-287">Visual Studio では、プロジェクトに含まれているかどうかに関係なく、pubxml ファイルの*Publishprofiles*フォルダーが検索され*ます。*</span><span class="sxs-lookup"><span data-stu-id="dc967-287">Visual Studio looks in the *PublishProfiles* folder for *.pubxml* files, regardless of whether they are included in the project.</span></span>

<span data-ttu-id="dc967-288">各*pubxml*ファイルには、 *pubxml. user*ファイルがあります。</span><span class="sxs-lookup"><span data-stu-id="dc967-288">For each *.pubxml* file there is a *.pubxml.user* file.</span></span> <span data-ttu-id="dc967-289">*Pubxml. user*ファイルには、[**パスワードを保存**する] オプションを選択した場合に暗号化されたパスワードが含まれ、既定ではプロジェクトから除外されます。</span><span class="sxs-lookup"><span data-stu-id="dc967-289">The *.pubxml.user* file contains the encrypted password if you selected the **Save password** option, and by default it is excluded from the project.</span></span>

<span data-ttu-id="dc967-290">*Pubxml*ファイルには、特定の発行プロファイルに関連する設定が含まれています。</span><span class="sxs-lookup"><span data-stu-id="dc967-290">A *.pubxml* file contains the settings that pertain to a specific publish profile.</span></span> <span data-ttu-id="dc967-291">すべてのプロファイルに適用する設定を構成する場合は、 *. .targets*ファイルを作成できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-291">If you want to configure settings that apply to all profiles, you can create a *.wpp.targets* file.</span></span> <span data-ttu-id="dc967-292">ビルドプロセスでは、これらのファイルが *.csproj*または *.vbproj*プロジェクトファイルにインポートされるため、プロジェクトファイルで構成できるほとんどの設定はこれらのファイルで構成できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-292">The build process imports these files into the *.csproj* or *.vbproj* project file, so most settings that you can configure in the project file can be configured in these files.</span></span> <span data-ttu-id="dc967-293">*Pubxml*ファイルおよび*wpp*ファイルの詳細については、「[方法: 発行プロファイル (Pubxml) ファイルの配置設定を編集する」および「Visual Studio Web プロジェクトの wpp ファイル](https://msdn.microsoft.com/library/ff398069.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-293">For more information about *.pubxml* files and *.wpp.targets* files, see [How to: Edit Deployment Settings in Publish Profile (.pubxml) Files and the .wpp.targets File in Visual Studio Web Projects](https://msdn.microsoft.com/library/ff398069.aspx).</span></span>

1. <span data-ttu-id="dc967-294">**ソリューションエクスプローラー**で、 **[プロパティ]** を展開し、 **[publishprofiles]** を展開します。</span><span class="sxs-lookup"><span data-stu-id="dc967-294">In **Solution Explorer**, expand **Properties** and expand **PublishProfiles**.</span></span>
2. <span data-ttu-id="dc967-295">[ *Production. pubxml* ] を右クリックし、 **[開く]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-295">Right-click *Production.pubxml* and click **Open**.</span></span>

    ![Pubxml ファイルを開きます。](deploying-to-production/_static/image13.png)
3. <span data-ttu-id="dc967-297">[ *Production. pubxml* ] を右クリックし、 **[開く]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="dc967-297">Right-click *Production.pubxml* and click **Open**.</span></span>
4. <span data-ttu-id="dc967-298">終了 `PropertyGroup` 要素の直前に、次の行を追加します。</span><span class="sxs-lookup"><span data-stu-id="dc967-298">Add the following lines immediately before the closing `PropertyGroup` element:</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample3.xml)]

    <span data-ttu-id="dc967-299">Pubxml ファイルは、次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="dc967-299">The .pubxml file now looks like the following example:</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample4.xml?highlight=18-20)]

    <span data-ttu-id="dc967-300">ファイルとフォルダーを除外する方法の詳細については、MSDN の「 **Visual Studio と ASP.NET の Web 配置に関してよく寄せ**られる質問」の「[特定のファイルまたはフォルダーをデプロイから除外](https://msdn.microsoft.com/library/ee942158.aspx#can_i_exclude_specific_files_or_folders_from_deployment)する方法」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-300">For more information about how to exclude files and folders, see [Can I exclude specific files or folders from deployment?](https://msdn.microsoft.com/library/ee942158.aspx#can_i_exclude_specific_files_or_folders_from_deployment) in the **Web Deployment FAQ for Visual Studio and ASP.NET** on MSDN.</span></span>

### <a name="deploy-to-production"></a><span data-ttu-id="dc967-301">運用環境へのデプロイ</span><span class="sxs-lookup"><span data-stu-id="dc967-301">Deploy to production</span></span>

1. <span data-ttu-id="dc967-302">Web の**発行**ウィザードを開き、 **[実稼働]** 発行プロファイル が選択されていることを確認し、 **[プレビュー]** タブの **[プレビューの開始]** をクリックして、 *robots.txt*ファイルが運用アプリにコピーされないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-302">Open the **Publish Web** wizard make sure that the **Production** publish profile is selected, and then click **Start Preview** on the **Preview** tab to verify that the *robots.txt* file will not be copied to the production app.</span></span>

    ![運用環境に発行するファイルのプレビュー](deploying-to-production/_static/image14.png)

    <span data-ttu-id="dc967-304">コピーされるファイルの一覧を確認します。</span><span class="sxs-lookup"><span data-stu-id="dc967-304">Review the list of files that will be copied.</span></span> <span data-ttu-id="dc967-305">*Aspx.cs*、 *aspx.designer.cs*、 *Master.cs*、 *Master.designer.cs*の各ファイルを含むすべての *.cs*ファイルが省略されていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="dc967-305">You'll see that all of the *.cs* files, including *.aspx.cs*, *.aspx.designer.cs*, *Master.cs*, and *Master.designer.cs* files are omitted.</span></span> <span data-ttu-id="dc967-306">このコードはすべて、 *bin*フォルダーにある*ContosoUniversity*ファイルと*ContosoUniversity*ファイルにコンパイルされています。</span><span class="sxs-lookup"><span data-stu-id="dc967-306">All of this code has been compiled into the *ContosoUniversity.dll* and *ContosoUniversity.pdb* files that you'll find in the *bin* folder.</span></span> <span data-ttu-id="dc967-307">アプリケーションを実行するために必要なのは *.dll*だけであり、アプリケーションの実行に必要なファイルのみを配置する必要があることを指定した場合、配布先の環境に *.cs*ファイルはコピーされません。</span><span class="sxs-lookup"><span data-stu-id="dc967-307">Because only the *.dll* is needed to run the application, and you specified earlier that only files needed to run the application should be deployed, no *.cs* files were copied to the destination environment.</span></span> <span data-ttu-id="dc967-308">*Obj*フォルダーと*ContosoUniversity*ファイルと *.csproj*ファイルは、同じ理由で省略されています。</span><span class="sxs-lookup"><span data-stu-id="dc967-308">The *obj* folder and the *ContosoUniversity.csproj* and *.csproj.user* files are omitted for the same reason.</span></span>

    <span data-ttu-id="dc967-309">**[発行]** をクリックして、運用環境にデプロイします。</span><span class="sxs-lookup"><span data-stu-id="dc967-309">Click **Publish** to deploy to the production environment.</span></span>
2. <span data-ttu-id="dc967-310">ステージングに使用したのと同じ手順に従って、運用環境でテストします。</span><span class="sxs-lookup"><span data-stu-id="dc967-310">Test in production, following the same procedure you used for staging.</span></span>

    <span data-ttu-id="dc967-311">すべてのものは、URL と*robots.txt*ファイルがない場合を除き、ステージングと同じです。</span><span class="sxs-lookup"><span data-stu-id="dc967-311">Everything is identical to staging except for the URL and the absence of the *robots.txt* file.</span></span>

## <a name="summary"></a><span data-ttu-id="dc967-312">要約</span><span class="sxs-lookup"><span data-stu-id="dc967-312">Summary</span></span>

<span data-ttu-id="dc967-313">これで、web アプリのデプロイとテストが正常に完了し、インターネット経由で公開されるようになりました。</span><span class="sxs-lookup"><span data-stu-id="dc967-313">You have now successfully deployed and tested your web app and it is available publicly over the Internet.</span></span>

![ホームページの運用](deploying-to-production/_static/image15.png)

<span data-ttu-id="dc967-315">次のチュートリアルでは、アプリケーションコードを更新し、テスト環境、ステージング環境、および運用環境に変更をデプロイします。</span><span class="sxs-lookup"><span data-stu-id="dc967-315">In the next tutorial, you'll update application code and deploy the change to the test, staging, and production environments.</span></span>

> [!NOTE]
> <span data-ttu-id="dc967-316">アプリケーションが運用環境で使用されている間は、復旧計画を実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="dc967-316">While your application is in use in the production environment you should be implementing a recovery plan.</span></span> <span data-ttu-id="dc967-317">つまり、データベースを運用アプリからセキュリティで保護されたストレージの場所に定期的にバックアップする必要があります。また、このようなバックアップの複数の世代を維持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="dc967-317">That is, you should be periodically backing up your databases from the production app to a secure storage location, and you should be keeping several generations of such backups.</span></span> <span data-ttu-id="dc967-318">データベースを更新するときは、変更の直前にからバックアップコピーを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="dc967-318">When you update the database, you should make a backup copy from immediately before the change.</span></span> <span data-ttu-id="dc967-319">これにより、間違いを犯しても、運用環境にデプロイするまで検出されない場合でも、データベースを破損する前の状態に復旧できます。</span><span class="sxs-lookup"><span data-stu-id="dc967-319">Then, if you make a mistake and don't discover it until after you have deployed it to production, you will still be able to recover the database to the state it was in before it became corrupted.</span></span> <span data-ttu-id="dc967-320">詳細については、「 [Azure SQL Database のバックアップと復元](https://msdn.microsoft.com/library/windowsazure/jj650016.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-320">For more information, see [Azure SQL Database Backup and Restore](https://msdn.microsoft.com/library/windowsazure/jj650016.aspx).</span></span>
> 
> 
> [!NOTE]
> <span data-ttu-id="dc967-321">このチュートリアルでは、デプロイ先の SQL Server エディションが Azure SQL Database ます。</span><span class="sxs-lookup"><span data-stu-id="dc967-321">In this tutorial the SQL Server edition that you are deploying to is Azure SQL Database.</span></span> <span data-ttu-id="dc967-322">デプロイプロセスは SQL Server の他のエディションに似ていますが、実際の運用アプリケーションでは、一部のシナリオで Azure SQL Database に特別なコードが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="dc967-322">While the deployment process is similar to other editions of SQL Server, a real production application might require special code for Azure SQL Database in some scenarios.</span></span> <span data-ttu-id="dc967-323">詳細については、「 [Azure SQL Database の操作](../../../../whitepapers/aspnet-data-access-content-map.md#ssdb)」および「 [SQL Server と Azure SQL Database の選択](../../../../whitepapers/aspnet-data-access-content-map.md#ssdbchoosing)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dc967-323">For more information, see [Working with Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdb) and [Choosing between SQL Server and Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdbchoosing).</span></span>
> 
> [!div class="step-by-step"]
> <span data-ttu-id="dc967-324">[前へ](setting-folder-permissions.md)
> [次へ](deploying-a-code-update.md)</span><span class="sxs-lookup"><span data-stu-id="dc967-324">[Previous](setting-folder-permissions.md)
[Next](deploying-a-code-update.md)</span></span>
