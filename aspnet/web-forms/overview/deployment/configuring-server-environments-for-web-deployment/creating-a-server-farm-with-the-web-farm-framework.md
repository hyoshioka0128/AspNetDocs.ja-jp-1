---
uid: web-forms/overview/deployment/configuring-server-environments-for-web-deployment/creating-a-server-farm-with-the-web-farm-framework
title: Web Farm Framework を使用したサーバーファームの作成 |Microsoft Docs
author: jrjlee
description: このトピックでは、Web Farm Framework (WFF) 2.0 を使用して、サーバーのコレクションから web サーバーファームを作成および構成する方法について説明します。
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 656dd06d-806c-467c-863d-9fc45e5ba3ab
msc.legacyurl: /web-forms/overview/deployment/configuring-server-environments-for-web-deployment/creating-a-server-farm-with-the-web-farm-framework
msc.type: authoredcontent
ms.openlocfilehash: 204996514bed336e60ab77f184a923f04e7e2bba
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78517498"
---
# <a name="creating-a-server-farm-with-the-web-farm-framework"></a>Web Farm Framework でサーバー ファームを作成する

[Jason Lee](https://github.com/jrjlee)

[[Download PDF]\(PDF をダウンロード\)](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> このトピックでは、Web Farm Framework (WFF) 2.0 を使用して、サーバーのコレクションから web サーバーファームを作成および構成する方法について説明します。

WFF を使用すると、web プラットフォームの製品とコンポーネント、web アプリケーション、web サイト、および構成設定を、負荷分散された複数の web サーバー間で同期できます。 ステージング環境や運用環境など、複数の web サーバーが必要なシナリオでは、これによってデプロイと構成のプロセスが大幅に簡素化されます。 Web アプリケーションを1台のサーバー&#x2014;に配置できます。*プライマリサーバー*&#x2014;と wff は、サーバーファーム内の他のすべての web サーバー上にその web アプリケーションを自動的にレプリケートします。

## <a name="understanding-the-web-farm-framework"></a>Web ファームフレームワークについて

WFF 2.0 を使用して、web サーバーのグループに対してコンテンツのプロビジョニング、管理、および展開を行うことができます。 WFF デプロイは、次の3つの主要なサーバーロールで構成されています。

- *コントローラーサーバー*。 このサーバーを使用して、WFF サーバーファームを作成および構成します。 コントローラーサーバーは、サーバーファーム内の web サーバー間で、web プラットフォームコンポーネント、構成設定、およびアプリケーションの同期を管理します。 コントローラーサーバーに WFF 2.0 をインストールすると、コントローラーサーバーはサーバーファーム内の各サーバーに WFF エージェントをインストールします。 コントローラーサーバーは、概念的にはどの WFF サーバーファームにも属しておらず、1つのコントローラーサーバーが複数のサーバーファームを管理できます。 このシナリオでは、単一の WFF コントローラーサーバーを使用して、ステージングサーバーファームと運用サーバーファームを作成し、管理します。
- *プライマリサーバー*。 各 WFF サーバーファームには、1つのプライマリサーバーが含まれています。 Web platform コンポーネントをインストールするか、アプリケーションをプライマリサーバーに配置すると、WFF はサーバーファーム内の他のすべてのサーバーに変更を同期します。
- *セカンダリサーバー*。 各 WFF サーバーファームには、1つまたは複数のセカンダリサーバーが含まれます。 プライマリサーバーに加えた変更は、サーバーファーム内のすべてのセカンダリサーバーにレプリケートされます。

ここでは、これらのサーバーロールが Fabrikam、Inc. のステージング環境、および運用環境にどのように関連しているかを示します。

![](creating-a-server-farm-with-the-web-farm-framework/_static/image1.png)

このシナリオでは、ステージング環境と運用環境の両方が WFF サーバーファームとして構成されています。 1つの WFF コントローラーサーバーが両方のファームを管理します。 各サーバーファーム内で、プライマリサーバーに加えられたすべての変更が、すべてのセカンダリサーバーにレプリケートされます。

ステージング環境と運用環境の構成を開始する前に、次の記事を読み、WFF 2.0 の主要概念について理解しておくことをお勧めします。

- [IIS 7 の Web Farm Framework 2.0 の概要](https://go.microsoft.com/?linkid=9805126)
- [IIS 7 用の Web Farm Framework 2.0 を使用したサーバーファームの設定](https://go.microsoft.com/?linkid=9805127)
- [IIS 7 用 Web Farm Framework 2.0 のシステム要件とプラットフォーム要件](https://go.microsoft.com/?linkid=9805128)

## <a name="task-overview"></a>タスクの概要

このトピックのタスクとチュートリアルを完了するには、少なくとも3台&#x2014;のサーバーと1つのサーバーファーム用の1つのプライマリ web サーバー、およびサーバーファーム用の1台以上のセカンダリ web サーバーが必要です。 WFF サーバーファームには、いつでもセカンダリサーバーを追加できます。 大まかに言えば、ステージング環境または運用環境用に WFF サーバーファームを作成して構成するには、次のことを行う必要があります。

- インターネットインフォメーションサービス (IIS) 7.5 および WFF 2.0 をインストールして、コントローラーサーバーを作成します。
- 共通の管理者アカウントを作成し、ファイアウォールの例外を構成して、プライマリサーバーとセカンダリサーバーを準備します。
- コントローラーサーバーで IIS マネージャーを使用して、サーバーファームを構成します。
- IIS アプリケーション要求ルーティング (ARR) または別の負荷分散テクノロジを使用して負荷分散を構成します。

このトピックのタスクとチュートリアルでは、Windows Server 2008 R2 を実行するクリーンなサーバービルドから始めることを前提としています。 開始する前に、各サーバーで次のことを確認します。

- Windows Server 2008 R2 Service Pack 1 および利用可能なすべての更新プログラムがインストールされています。
- サーバーはドメインに参加しています。
- サーバーには静的 IP アドレスがあります。

> [!NOTE]
> コンピューターをドメインに参加させる方法の詳細については、「[コンピューターをドメインに参加](https://technet.microsoft.com/library/cc725618(v=WS.10).aspx)させ、ログオンする」を参照してください。 静的 IP アドレスの構成の詳細については、「[静的 Ip アドレスの構成](https://technet.microsoft.com/library/cc754203(v=ws.10).aspx)」を参照してください。

## <a name="create-the-wff-controller-server"></a>WFF コントローラーサーバーを作成する

WFF コントローラーサーバーを作成するには、IIS 7 以降と WFF 2.0 以降の両方をインストールする必要があります。 内部的には、WFF は IIS Web 配置ツール (Web 配置) 2.x を使用してファーム内のサーバーを同期します。 Web Platform Installer を使用して WFF をインストールすると、インストーラーによって Web 配置が自動的にダウンロードされ、インストールされます。

**WFF コントローラーサーバーを作成するには**

1. [Web Platform Installer](https://go.microsoft.com/?linkid=9739157)をダウンロードしてインストールします。
2. **Web Platform Installer 3.0**ウィンドウの上部にある **[Products]** をクリックします。
3. ウィンドウの左側のナビゲーションウィンドウで、 **[サーバー]** をクリックします。
4. **IIS 7 の推奨構成**行で、 **[追加]** をクリックします。
5. ( <strong>Web Farm Framework 2)。</strong><em>x</em>行で、[<strong>追加</strong>] をクリックします。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image2.png)
6. **[インストール]** をクリックします。 Web Platform Installer によって、Web 配置ツールが他のさまざまな依存関係と共にインストールリストに追加されていることに注意してください。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image3.png)
7. ライセンス条項を確認し、条項に同意する場合は [**同意**する] をクリックします。
8. インストールが完了したら、 **[完了]** をクリックし、 **[Web Platform Installer 3.0]** ウィンドウを閉じます。

## <a name="configure-the-primary-and-secondary-servers"></a>プライマリおよびセカンダリサーバーを構成する

WFF サーバーファームを作成する前に、ファームを構成する web サーバー上でいくつかの準備タスクを完了する必要があります。

- **コアネットワーク**、**リモート管理**、および**ファイルとプリンターの共有**機能が wff コントローラーサーバーと通信できるように、ファイアウォールの例外を追加します。
- Active Directory でドメインアカウント (たとえば、 **FABRIKAM\stagingfarm**) を作成し、各サーバーのローカルの administrators グループに追加します。 このアカウントは、サーバーファームを作成するときにサーバーファームの管理者アカウントとして使用します。

Windows ファイアウォールでこれらのファイアウォール例外を構成する方法の詳細については、「 [Web Farm Framework 2.0 FOR IIS 7 のシステム要件とプラットフォーム要件](https://go.microsoft.com/?linkid=9805128)」を参照してください。 その他のファイアウォールシステムについては、製品ドキュメントを参照してください。

Windows Server 2008 R2 のローカルの administrators グループにドメインアカウントを追加するには、次の手順を実行します。 サーバーファーム&#x2014;に追加するすべてのサーバーで、この手順を実行する必要があります。つまり、プライマリサーバーと各セカンダリサーバーのローカルの administrators グループに同じドメインアカウントを追加します。

**ローカルの administrators グループにドメインアカウントを追加するには**

1. **[スタート]** メニューの **[管理ツール]** をポイントし、 **[サーバーマネージャー]** をクリックします。
2. **[サーバーマネージャー]** ウィンドウのツリービューペインで、 **[構成]** 、 **[ローカルユーザーとグループ]** の順に展開し、 **[グループ]** をクリックします。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image4.png)
3. **[グループ]** ウィンドウで、 **[Administrators]** をダブルクリックします。
4. **[管理者のプロパティ]** ダイアログボックスで、 **[追加]** をクリックします。
5. **[ユーザー、コンピューター、サービスアカウントまたはグループの選択**] ダイアログボックスで、ドメインアカウント ( **FABRIKAM\stagingfarm**など) を入力 (または参照) し、[ **OK]** をクリックします。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image5.png)
6. **[管理者のプロパティ]** ダイアログボックスで、[ **OK]** をクリックします。

サーバーをサーバーファームに追加する準備ができました。 プライマリサーバーの場合は、サーバーファーム&#x2014;を作成する前または後に、アプリケーションの要件を満たすようにサーバーを構成できます。 wff は、セカンダリサーバーに同じ製品、コンポーネント、または構成を展開してサーバーを同期します。 わかりやすくするために、このチュートリアルでは、サーバーファームの作成が終了したときにプライマリサーバーを構成することを前提としています。

## <a name="create-the-wff-server-farm"></a>WFF サーバーファームを作成する

この時点で、すべてのサーバーを WFF サーバーファームに追加する準備ができています。

- コントローラーサーバーに WFF がインストールされています。
- プライマリおよびセカンダリ web サーバーでファイアウォールの例外を構成しました。
- プライマリおよびセカンダリ web サーバーのローカルの administrators グループにドメインアカウントを追加しました。

次の手順では、WFF でサーバーファームを作成します。 これは、WFF コントローラーサーバー上の IIS マネージャーから行うことができます。

**WFF サーバーファームを作成するには**

1. WFF コントローラーサーバーで、 **[スタート]** メニューの **[管理ツール]** をポイントし、 **[インターネットインフォメーションサービス (IIS) マネージャー]** をクリックします。
2. **[接続]** ウィンドウで、ローカルサーバー ノードを展開し、 **[サーバーファーム]** を右クリックして、 **[サーバーファームの作成]** をクリックします。
3. **[サーバーファームの作成]** ダイアログボックスで、サーバーファームのわかりやすい名前 (たとえば、 **[ステージングファーム]** ) を入力し、 **[サーバーファームのプロビジョニング]** を選択します。
4. 各サーバーのローカルの administrators グループに追加したドメインアカウントのユーザー名とパスワードを入力します。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image6.png)
5. **[次へ]** をクリックします。
6. **[サーバーの追加]** ページで、プライマリサーバーの完全修飾ドメイン名 (FQDN) を入力し、 **[プライマリサーバー]** を選択して、 **[追加]** をクリックします。
7. この時点で、指定した資格情報を使用して、WFF がプライマリサーバーに接続しようとします。 接続に成功すると、 **[サーバーの追加]** ページのテーブルにプライマリサーバーが追加されます。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image7.png)

    > [!NOTE]
    > 既定では、**負荷分散に使用できるサーバー**が選択されていることがわかります。 WFF は、IIS ARR モジュールを使用して負荷分散を実装し、サーバーファーム内の web サーバー全体に要求を分散します。 ほとんどのシナリオでは、代わりにサードパーティの負荷分散ソリューションを使用する場合にのみ、**負荷分散オプションでサーバーを使用でき**ます。
8. **[サーバーの追加]** ページで、最初のセカンダリサーバーの FQDN を入力し、 **[追加]** をクリックします。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image8.png)
9. ファーム内のその他のセカンダリサーバーについても手順 7. を繰り返し、 **[完了]** をクリックします。

WFF サーバーファームが稼働状態になりました。 プライマリサーバーにインストールした web プラットフォーム製品またはコンポーネント、およびプライマリサーバーに配置したすべての web アプリケーションやコンテンツは、すべてのセカンダリサーバーに自動的にプロビジョニングされます。

WFF は広範で複雑なトピックです。詳細については、 [Microsoft Web Farm Framework 2.0 FOR IIS 7](https://go.microsoft.com/?linkid=9805129) web サイトを参照してください。 ただし、時間については、注意が必要な2つの機能領域があります。

- *アプリケーションのプロビジョニング*は、サーバーファーム内のすべてのセカンダリサーバー間で、web アプリケーションや構成設定などのプライマリサーバーからコンテンツをレプリケートするプロセスです。 たとえば、Contact Manager サンプルソリューションをプライマリステージングサーバーにデプロイすると、WFF アプリケーションのプロビジョニングプロセスによって、このソリューションがすべてのセカンダリステージングサーバーにデプロイされます。 既定では、アプリケーションのプロビジョニングプロセスは30秒ごとに実行されます。
- *プラットフォームのプロビジョニング*は、web プラットフォームの製品とコンポーネントをプライマリサーバーからサーバーファーム内のすべてのセカンダリサーバーに同期するプロセスです。 たとえば、プライマリステージングサーバーに ASP.NET MVC 3 をインストールする場合、プラットフォームのプロビジョニングプロセスでは、Web Platform Installer を使用して、すべてのセカンダリステージングサーバーに ASP.NET MVC 3 をインストールします。 既定では、プラットフォームのプロビジョニングプロセスは5分ごとに実行されます。

アプリケーションとプラットフォームの基本的なプロビジョニング設定は、WFF コントローラーサーバー上の IIS マネージャーから管理できます。

**アプリケーションとプラットフォームのプロビジョニング設定の詳細**

1. IIS マネージャーの **[接続]** ウィンドウで、サーバーファームを選択します。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image9.png)
2. **[サーバーファーム]** ウィンドウで、 **[アプリケーションのプロビジョニング]** をダブルクリックします。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image10.png)
3. ご覧のように、サーバーファームは現在、プライマリサーバーとセカンダリサーバー間の web コンテンツと構成設定を30秒ごとに同期するように構成されています。
4. **[戻る]** をクリックし、 **[プラットフォームのプロビジョニング]** をダブルクリックします。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image11.png)
5. ご覧のように、サーバーファームは現在、プライマリサーバーとセカンダリサーバー間の web プラットフォームの製品とコンポーネントを、5分ごとに同期するように構成されています。
6. **[戻る]** をクリックします。
7. サーバーファームで web platform 製品を直ちに同期させるには、 **[操作]** ウィンドウで **[プラットフォームの準備]** をクリックします。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image12.png)

    > [!NOTE]
    > プラットフォームのプロビジョニングには時間がかかることがあります。 インストーラープロセスは、サーバーファーム内のセカンダリサーバーのバックグラウンドで実行されます。
8. プロビジョニング処理が完了するのに十分な時間が与えられたら、プライマリサーバーに追加した製品とコンポーネントがセカンダリサーバーでレプリケートされていることを確認できます。 たとえば、セカンダリサーバーにログオンし、 **[サーバーマネージャー]** ウィンドウを使用して、web サーバーの役割がインストールされていることを確認できます。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image13.png)
9. また、[インストールされているプログラム] の一覧を確認して、さまざまな web プラットフォームコンポーネントが追加されていることを確認することもできます。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image14.png)

## <a name="configure-load-balancing"></a>負荷分散の構成

Web ファームを作成する場合は、web サーバー間で HTTP 要求を分散させるために、何らかの形式の負荷分散を設定する必要があります。 Windows Server 2008 のネットワーク負荷分散、IIS ARR、サードパーティ製のソフトウェアベースまたはハードウェアベースの負荷分散ソリューションなどが考えられます。

WFF は、IIS ARR と密接に統合するように設計されています。 この統合を利用するには、ARR モジュールを WFF コントローラーサーバーにインストールする必要があります。 その後、すべての web トラフィックをコントローラーサーバーに転送します。通常は、ドメインネームシステム (DNS) レコードを構成します。 その後、コントローラーサーバーは、サーバーの可用性やその他のさまざまな条件に基づいて、ファーム内のサーバー間で受信要求を分散します。

> [!NOTE]
> ARR を WFF で使用する必要はありません。サードパーティ製の負荷分散ソリューションと連携するように WFF を構成できます。 詳細については、「 [IIS 7 用 Web ファームフレームワーク2.0 の概要](https://go.microsoft.com/?linkid=9805126)」を参照してください。

ARR を使用した負荷分散は複雑なトピックであり、そのほとんどはこのチュートリアルでは扱いません。 ただし、次の手順を使用して ARR モジュールをインストールし、負荷分散を開始することができます。

**WFF コントローラーサーバーで負荷分散を設定するには**

1. WFF コントローラーサーバーで、Web Platform Installer を起動します。
2. **Web Platform Installer 3.0**ウィンドウの上部にある **[Products]** をクリックします。
3. ウィンドウの左側のナビゲーションウィンドウで、 **[サーバー]** をクリックします。
4. **[アプリケーション要求ルーティング 2.5]** 行で、 **[追加]** をクリックします。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image15.png)
5. **[インストール]** をクリックし、 **Web Platform のインストール**ウィンドウに表示される指示に従います。
6. インストールが完了したら、IIS マネージャーを起動し、**接続** ウィンドウで サーバーファーム ノードをクリックします。 **[サーバーファーム]** ウィンドウに新しいアイコンがいくつか追加されていることに注意してください。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image16.png)
7. **[サーバーファーム]** ウィンドウで、 **[負荷分散]** をダブルクリックします。
8. **[負荷分散]** ウィンドウで、負荷分散アルゴリズムを選択します (たとえば、 **[現在の要求の最小要求]** など)。

    > [!NOTE]
    > 負荷分散アルゴリズムとその他の構成設定の詳細については、「[アプリケーション要求ルーティングモジュール](https://go.microsoft.com/?linkid=9805130)」を参照してください。

    ![](creating-a-server-farm-with-the-web-farm-framework/_static/image17.png)
9. **[操作]** ウィンドウで、 **[適用]** をクリックします。

これで、サーバーファーム内のサーバーの基本的な負荷分散を構成できました。 Web ファームのすべてのトラフィックをコントローラーサーバーに送信すると、選択した可用性と負荷分散アルゴリズムに応じて、ファーム内のサーバー間で要求が分散されます。

ARR で負荷分散を構成する方法の詳細については、「[アプリケーション要求ルーティングモジュール](https://go.microsoft.com/?linkid=9805130)」を参照してください。

## <a name="monitor-the-server-farm"></a>サーバーファームを監視する

サーバーファームの正常性は、コントローラーサーバー上の IIS マネージャーを使用していつでも監視できます。 **[接続]** ウィンドウでサーバーファームを展開し、 **[サーバー]** をクリックします。 中央のウィンドウには、ファーム内の各サーバーの概要が、最近のアクティビティのトレースログと共に表示されます。

![](creating-a-server-farm-with-the-web-farm-framework/_static/image18.png)

## <a name="conclusion"></a>まとめ

これで、WFF サーバーファームが稼働状態になります。 優先&#x2014;する展開方法をサポートするようにプライマリサーバーを構成することができます。詳細&#x2014;については、「詳細」を参照してください。構成は、サーバーファーム内の各セカンダリサーバーでレプリケートされます。

## <a name="further-reading"></a>参考資料

WFF の構成と使用のすべての側面の詳細については、 [Microsoft Web Farm Framework 2.0 FOR IIS 7](https://go.microsoft.com/?linkid=9805129) web サイトを参照してください。

> [!div class="step-by-step"]
> [前へ](configuring-a-database-server-for-web-deploy-publishing.md)
> [次へ](configuring-deployment-properties-for-a-target-environment.md)
