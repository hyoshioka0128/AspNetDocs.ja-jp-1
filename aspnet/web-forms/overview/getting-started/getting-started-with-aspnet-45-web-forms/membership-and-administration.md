---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
title: メンバーシップと管理 |Microsoft Docs
author: Erikre
description: このチュートリアルシリーズでは、ASP.NET 4.5 と Microsoft Visual Studio Express 2013 を使用して ASP.NET Web フォームアプリケーションを構築するための基本について説明します。
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 732a2316-e49f-4f72-becd-0cd72f14457e
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
msc.type: authoredcontent
ms.openlocfilehash: ab00bc90bfc767d06e747be6dfb973245b5aae88
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2019
ms.locfileid: "74615470"
---
# <a name="membership-and-administration"></a><span data-ttu-id="45843-103">メンバーシップと管理</span><span class="sxs-lookup"><span data-stu-id="45843-103">Membership and Administration</span></span>

<span data-ttu-id="45843-104">[Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="45843-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="45843-105">[Wingtip Toys サンプルプロジェクト (C#) をダウンロード](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409)するか[、電子書籍 (PDF) をダウンロード](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)します。</span><span class="sxs-lookup"><span data-stu-id="45843-105">[Download Wingtip Toys Sample Project (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="45843-106">このチュートリアルシリーズでは、ASP.NET 4.5 を使用して ASP.NET Web フォームアプリケーションを構築するための基礎と、Web 用の Microsoft Visual Studio Express 2013 について説明します。</span><span class="sxs-lookup"><span data-stu-id="45843-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="45843-107">このチュートリアルシリーズ[でC#は、ソースコードが含ま](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409)れる Visual Studio 2013 プロジェクトを利用できます。</span><span class="sxs-lookup"><span data-stu-id="45843-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>

<span data-ttu-id="45843-108">このチュートリアルでは、Wingtip Toys サンプルアプリケーションを更新してカスタムロールを追加し、ASP.NET Identity を使用する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="45843-108">This tutorial shows you how to update the Wingtip Toys sample application to add a custom role and use ASP.NET Identity.</span></span> <span data-ttu-id="45843-109">また、カスタムロールを持つユーザーが web サイトから製品を追加および削除できる管理ページを実装する方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="45843-109">It also shows you how to implement an administration page from which the user with a custom role can add and remove products from the website.</span></span>

<span data-ttu-id="45843-110">[ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md)は、ASP.NET web アプリケーションのビルドに使用されるメンバーシップシステムであり、ASP.NET 4.5 で使用できます。</span><span class="sxs-lookup"><span data-stu-id="45843-110">[ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) is the membership system used to build ASP.NET web application and is available in ASP.NET 4.5.</span></span> <span data-ttu-id="45843-111">ASP.NET Identity は、Visual Studio 2013 Web フォームプロジェクトテンプレートと、 [ASP.NET MVC](../../../../mvc/index.md)、 [ASP.NET Web API](../../../../web-api/index.md)、および[ASP.NET のシングルページアプリケーション](../../../../single-page-application/index.md)のテンプレートで使用されます。</span><span class="sxs-lookup"><span data-stu-id="45843-111">ASP.NET Identity is used in the Visual Studio 2013 Web Forms project template, as well as the templates for [ASP.NET MVC](../../../../mvc/index.md), [ASP.NET Web API](../../../../web-api/index.md), and [ASP.NET Single Page Application](../../../../single-page-application/index.md).</span></span> <span data-ttu-id="45843-112">空の Web アプリケーションから開始する場合は、NuGet を使用して ASP.NET Identity システムを明示的にインストールすることもできます。</span><span class="sxs-lookup"><span data-stu-id="45843-112">You can also specifically install the ASP.NET Identity system using NuGet when you start with an empty Web application.</span></span> <span data-ttu-id="45843-113">ただし、このチュートリアルシリーズでは、ASP.NET Identity システムを含む**Web フォーム**projecttemplate を使用します。</span><span class="sxs-lookup"><span data-stu-id="45843-113">However, in this tutorial series you use the **Web Forms**projecttemplate, which includes the ASP.NET Identity system.</span></span> <span data-ttu-id="45843-114">ASP.NET Identity を使用すると、ユーザー固有のプロファイルデータをアプリケーションデータに簡単に統合できます。</span><span class="sxs-lookup"><span data-stu-id="45843-114">ASP.NET Identity makes it easy to integrate user-specific profile data with application data.</span></span> <span data-ttu-id="45843-115">また、ASP.NET Identity を使用すると、アプリケーションのユーザープロファイルの永続性モデルを選択できます。</span><span class="sxs-lookup"><span data-stu-id="45843-115">Also, ASP.NET Identity allows you to choose the persistence model for user profiles in your application.</span></span> <span data-ttu-id="45843-116">データは、SQL Server データベースまたは別のデータストア (Windows Azure Storage テーブルなどの*NoSQL*データストア) に格納できます。</span><span class="sxs-lookup"><span data-stu-id="45843-116">You can store the data in a SQL Server database or another data store, including *NoSQL* data stores such as Windows Azure Storage Tables.</span></span>

<span data-ttu-id="45843-117">このチュートリアルでは、Wingtip Toys チュートリアルシリーズで、前述の「PayPal を使用した精算と支払い」というタイトルのチュートリアルを基にしています。</span><span class="sxs-lookup"><span data-stu-id="45843-117">This tutorial builds on the previous tutorial titled "Checkout and Payment with PayPal" in the Wingtip Toys tutorial series.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="45843-118">学習内容:</span><span class="sxs-lookup"><span data-stu-id="45843-118">What you'll learn:</span></span>

- <span data-ttu-id="45843-119">コードを使用して、カスタムロールとユーザーをアプリケーションに追加する方法。</span><span class="sxs-lookup"><span data-stu-id="45843-119">How to use code to add a custom role and a user to the application.</span></span>
- <span data-ttu-id="45843-120">管理フォルダーとページへのアクセスを制限する方法。</span><span class="sxs-lookup"><span data-stu-id="45843-120">How to restrict access to the administration folder and page.</span></span>
- <span data-ttu-id="45843-121">カスタムロールに属しているユーザーのナビゲーションを提供する方法。</span><span class="sxs-lookup"><span data-stu-id="45843-121">How to provide navigation for the user that belongs to the custom role.</span></span>
- <span data-ttu-id="45843-122">モデルバインドを使用して、 [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx)コントロールに製品カテゴリを設定する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="45843-122">How to use model binding to populate a [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) control with product categories.</span></span>
- <span data-ttu-id="45843-123">[FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx)コントロールを使用して web アプリケーションにファイルをアップロードする方法。</span><span class="sxs-lookup"><span data-stu-id="45843-123">How to upload a file to the web application using the [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) control.</span></span>
- <span data-ttu-id="45843-124">検証コントロールを使用して入力検証を実装する方法。</span><span class="sxs-lookup"><span data-stu-id="45843-124">How to use validation controls to implement input validation.</span></span>
- <span data-ttu-id="45843-125">アプリケーションの製品を追加および削除する方法。</span><span class="sxs-lookup"><span data-stu-id="45843-125">How to add and remove products from the application.</span></span>

## <a name="these-features-are-included-in-the-tutorial"></a><span data-ttu-id="45843-126">このチュートリアルでは、次の機能について説明します。</span><span class="sxs-lookup"><span data-stu-id="45843-126">These features are included in the tutorial:</span></span>

- <span data-ttu-id="45843-127">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="45843-127">ASP.NET Identity</span></span>
- <span data-ttu-id="45843-128">構成と承認</span><span class="sxs-lookup"><span data-stu-id="45843-128">Configuration and Authorization</span></span>
- <span data-ttu-id="45843-129">モデル バインド</span><span class="sxs-lookup"><span data-stu-id="45843-129">Model Binding</span></span>
- <span data-ttu-id="45843-130">控えめに検証</span><span class="sxs-lookup"><span data-stu-id="45843-130">Unobtrusive Validation</span></span>

<span data-ttu-id="45843-131">ASP.NET Web フォームは、メンバーシップ機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="45843-131">ASP.NET Web Forms provides membership capabilities.</span></span> <span data-ttu-id="45843-132">既定のテンプレートを使用すると、アプリケーションの実行時にすぐに使用できる組み込みのメンバーシップ機能を使用できます。</span><span class="sxs-lookup"><span data-stu-id="45843-132">By using the default template, you have built-in membership functionality that you can immediately use when the application runs.</span></span> <span data-ttu-id="45843-133">このチュートリアルでは、ASP.NET Identity を使用してカスタムロールを追加し、そのロールにユーザーを割り当てる方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="45843-133">This tutorial shows you how to use ASP.NET Identity to add a custom role and assign a user to that role.</span></span> <span data-ttu-id="45843-134">管理フォルダーへのアクセスを制限する方法についても説明します。</span><span class="sxs-lookup"><span data-stu-id="45843-134">You will learn how to restrict access to the administration folder.</span></span> <span data-ttu-id="45843-135">管理フォルダーにページを追加して、カスタムロールを持つユーザーが製品を追加および削除したり、追加後に製品をプレビューしたりできるようにします。</span><span class="sxs-lookup"><span data-stu-id="45843-135">You'll add a page to the administration folder that allows a user with a custom role to add and remove products, and to preview a product after it has been added.</span></span>

## <a name="adding-a-custom-role"></a><span data-ttu-id="45843-136">カスタムロールの追加</span><span class="sxs-lookup"><span data-stu-id="45843-136">Adding a Custom Role</span></span>

<span data-ttu-id="45843-137">ASP.NET Identity を使用すると、カスタムロールを追加し、コードを使用してそのロールにユーザーを割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="45843-137">Using ASP.NET Identity, you can add a custom role and assign a user to that role using code.</span></span>

1. <span data-ttu-id="45843-138">**ソリューションエクスプローラー**で、 *Logic*フォルダーを右クリックし、新しいクラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="45843-138">In **Solution Explorer**, right-click on the *Logic* folder and create a new class.</span></span>
2. <span data-ttu-id="45843-139">新しいクラスに*RoleActions.cs*という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="45843-139">Name the new class *RoleActions.cs*.</span></span>
3. <span data-ttu-id="45843-140">次のようにコードを変更します。</span><span class="sxs-lookup"><span data-stu-id="45843-140">Modify the code so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample1.cs?highlight=8)]
4. <span data-ttu-id="45843-141">**ソリューションエクスプローラー**で、 *Global.asax.cs*ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="45843-141">In **Solution Explorer**, open the *Global.asax.cs* file.</span></span>
5. <span data-ttu-id="45843-142">次のように、黄色で強調表示されているコードを追加して、 *Global.asax.cs*ファイルを変更します。</span><span class="sxs-lookup"><span data-stu-id="45843-142">Modify the *Global.asax.cs* file by adding the code highlighted in yellow so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample2.cs?highlight=11,26-28)]
6. <span data-ttu-id="45843-143">`AddUserAndRole` が赤で下線が引かれていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="45843-143">Notice that `AddUserAndRole` is underlined in red.</span></span> <span data-ttu-id="45843-144">AddUserAndRole コードをダブルクリックします。</span><span class="sxs-lookup"><span data-stu-id="45843-144">Double-click the AddUserAndRole code.</span></span>  
   <span data-ttu-id="45843-145">強調表示されたメソッドの先頭にある文字 "A" に下線が引かれます。</span><span class="sxs-lookup"><span data-stu-id="45843-145">The letter "A" at the beginning of the highlighted method will be underlined.</span></span>
7. <span data-ttu-id="45843-146">文字 "A" をポイントし、`AddUserAndRole` メソッドのメソッドスタブを生成するための UI をクリックします。</span><span class="sxs-lookup"><span data-stu-id="45843-146">Hover over the letter "A" and click the UI that allows you to generate a method stub for the `AddUserAndRole` method.</span></span> 

    ![メンバーシップと管理-メソッドスタブの生成](membership-and-administration/_static/image1.png)
8. <span data-ttu-id="45843-148">次のタイトルのオプションをクリックします。</span><span class="sxs-lookup"><span data-stu-id="45843-148">Click the option titled:</span></span>  
    `Generate method stub for "AddUserAndRole" in "WingtipToys.Logic.RoleActions"`
9. <span data-ttu-id="45843-149">*Logic*フォルダーから*RoleActions.cs*ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="45843-149">Open the *RoleActions.cs* file from the *Logic* folder.</span></span>  
   <span data-ttu-id="45843-150">`AddUserAndRole` メソッドがクラスファイルに追加されました。</span><span class="sxs-lookup"><span data-stu-id="45843-150">The `AddUserAndRole` method has been added to the class file.</span></span>
10. <span data-ttu-id="45843-151">`NotImplementedException` を削除し、次のように黄色で強調表示されているコードを追加して、 *RoleActions.cs*ファイルを変更します。</span><span class="sxs-lookup"><span data-stu-id="45843-151">Modify the *RoleActions.cs* file by removing the `NotImplementedException` and adding the code highlighted in yellow, so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample3.cs?highlight=5-7,15-51)]

<span data-ttu-id="45843-152">上記のコードでは、最初にメンバーシップデータベースのデータベースコンテキストを確立します。</span><span class="sxs-lookup"><span data-stu-id="45843-152">The above code first establishes a database context for the membership database.</span></span> <span data-ttu-id="45843-153">メンバーシップデータベースは、 *App\_Data*フォルダーに *.mdf*ファイルとしても格納されます。</span><span class="sxs-lookup"><span data-stu-id="45843-153">The membership database is also stored as an *.mdf* file in the *App\_Data* folder.</span></span> <span data-ttu-id="45843-154">最初のユーザーがこの web アプリケーションにサインインすると、このデータベースを表示できるようになります。</span><span class="sxs-lookup"><span data-stu-id="45843-154">You will be able to view this database once the first user has signed in to this web application.</span></span> 

> [!NOTE] 
> 
> <span data-ttu-id="45843-155">メンバーシップデータと製品データを格納する場合は、上記のコードに製品データを格納するために使用したものと同じ**Dbcontext**を使用することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="45843-155">If you wish to store the membership data along with the product data, you can consider using the same **DbContext** that you used to store the product data in the above code.</span></span>

 <span data-ttu-id="45843-156">*Internal*キーワードは、型 (クラスなど) および型のメンバー (メソッドやプロパティなど) のアクセス修飾子です。</span><span class="sxs-lookup"><span data-stu-id="45843-156">The *internal* keyword is an access modifier for types (such as classes) and type members (such as methods or properties).</span></span> <span data-ttu-id="45843-157">内部の型またはメンバーは、同じアセンブリ *(.dll*ファイル) に含まれるファイル内でのみアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="45843-157">Internal types or members are accessible only within files contained in the same assembly *(.dll* file).</span></span> <span data-ttu-id="45843-158">アプリケーションをビルドすると、アプリケーションの実行時に実行されるコードを含むアセンブリファイル *(.dll*) が作成されます。</span><span class="sxs-lookup"><span data-stu-id="45843-158">When you build your application, an assembly file *(.dll*) is created that contains the code that is executed when you run your application.</span></span> 

<span data-ttu-id="45843-159">ロール管理を提供する `RoleStore` オブジェクトは、データベースコンテキストに基づいて作成されます。</span><span class="sxs-lookup"><span data-stu-id="45843-159">A `RoleStore` object, which provides role management, is created based on the database context.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="45843-160">`RoleStore` オブジェクトが作成されると、ジェネリック `IdentityRole` 型が使用されることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="45843-160">Notice that when the `RoleStore` object is created it uses a Generic `IdentityRole` type.</span></span> <span data-ttu-id="45843-161">これは、`RoleStore` に `IdentityRole` オブジェクトのみを含めることができることを意味します。</span><span class="sxs-lookup"><span data-stu-id="45843-161">This means that the `RoleStore` is only allowed to contain `IdentityRole` objects.</span></span> <span data-ttu-id="45843-162">また、ジェネリックを使用することにより、メモリ内のリソースの処理が向上します。</span><span class="sxs-lookup"><span data-stu-id="45843-162">Also by using Generics, resources in memory are handled better.</span></span>

<span data-ttu-id="45843-163">次に、`RoleManager` オブジェクトが、先ほど作成した `RoleStore` オブジェクトに基づいて作成されます。</span><span class="sxs-lookup"><span data-stu-id="45843-163">Next, the `RoleManager` object, is created based on the `RoleStore` object that you just created.</span></span> <span data-ttu-id="45843-164">`RoleManager` オブジェクトは、`RoleStore`への変更を自動的に保存するために使用できるロール関連の API を公開します。</span><span class="sxs-lookup"><span data-stu-id="45843-164">the `RoleManager` object exposes role related API which can be used to automatically save changes to the `RoleStore`.</span></span> <span data-ttu-id="45843-165">このコードでは `<IdentityRole>` ジェネリック型が使用されているため、`RoleManager` には `IdentityRole` オブジェクトのみを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="45843-165">The `RoleManager` is only allowed to contain `IdentityRole` objects because the code uses the `<IdentityRole>` Generic type.</span></span>

<span data-ttu-id="45843-166">"CanEdit" ロールがメンバーシップデータベースに存在するかどうかを判断するには、`RoleExists` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="45843-166">You call the `RoleExists` method to determine if the "canEdit" role is present in the membership database.</span></span> <span data-ttu-id="45843-167">そうでない場合は、ロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="45843-167">If it is not, you create the role.</span></span>

<span data-ttu-id="45843-168">`UserManager` オブジェクトの作成は、`RoleManager` コントロールよりも複雑に見えますが、ほぼ同じです。</span><span class="sxs-lookup"><span data-stu-id="45843-168">Creating the `UserManager` object appears to be more complicated than the `RoleManager` control, however it is nearly the same.</span></span> <span data-ttu-id="45843-169">このコードは、いくつかではなく1行に記述されているだけです。</span><span class="sxs-lookup"><span data-stu-id="45843-169">It is just coded on one line rather than several.</span></span> <span data-ttu-id="45843-170">ここでは、渡されるパラメーターは、かっこ内に含まれる新しいオブジェクトとしてインスタンス化されます。</span><span class="sxs-lookup"><span data-stu-id="45843-170">Here, the parameter that you are passing is instantiating as a new object contained in the parenthesis.</span></span>

<span data-ttu-id="45843-171">次に、新しい `ApplicationUser` オブジェクトを作成して "canEditUser" ユーザーを作成します。</span><span class="sxs-lookup"><span data-stu-id="45843-171">Next you create the "canEditUser" user by creating a new `ApplicationUser` object.</span></span> <span data-ttu-id="45843-172">その後、ユーザーが正常に作成されたら、そのユーザーを新しいロールに追加します。</span><span class="sxs-lookup"><span data-stu-id="45843-172">Then, if you successfully create the user, you add the user to the new role.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="45843-173">エラー処理は、このチュートリアルシリーズの後半の「ASP.NET Error 処理」チュートリアルで更新されます。</span><span class="sxs-lookup"><span data-stu-id="45843-173">The error handling will be updated during the "ASP.NET Error Handling" tutorial later in this tutorial series.</span></span>

<span data-ttu-id="45843-174">アプリケーションの次回の起動時に、"canEditUser" という名前のユーザーが、アプリケーションの "canEdit" という名前のロールとして追加されます。</span><span class="sxs-lookup"><span data-stu-id="45843-174">The next time the application starts, the user named "canEditUser" will be added as the role named "canEdit" of the application.</span></span> <span data-ttu-id="45843-175">このチュートリアルの後の方で、このチュートリアルで追加する機能を表示するには、"canEditUser" ユーザーとしてログインします。</span><span class="sxs-lookup"><span data-stu-id="45843-175">Later in this tutorial, you will login as the "canEditUser" user to display additional capabilities that you will added during this tutorial.</span></span> <span data-ttu-id="45843-176">ASP.NET Identity に関する API の詳細につい[ては、](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx)「」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45843-176">For API details about ASP.NET Identity, see the [Microsoft.AspNet.Identity Namespace](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span></span> <span data-ttu-id="45843-177">ASP.NET Identity システムの初期化の詳細については、 [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="45843-177">For additional details about initializing the ASP.NET Identity system, see the [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span></span>

### <a name="restricting-access-to-the-administration-page"></a><span data-ttu-id="45843-178">管理ページへのアクセスの制限</span><span class="sxs-lookup"><span data-stu-id="45843-178">Restricting Access to the Administration Page</span></span>

<span data-ttu-id="45843-179">Wingtip Toys サンプルアプリケーションでは、匿名ユーザーとログインユーザーの両方が製品を表示および購入できます。</span><span class="sxs-lookup"><span data-stu-id="45843-179">The Wingtip Toys sample application allows both anonymous users and logged-in users to view and purchase products.</span></span> <span data-ttu-id="45843-180">ただし、カスタムの "canEdit" ロールを持つログインユーザーは、製品を追加および削除するために制限されたページにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="45843-180">However, the logged-in user that has the custom "canEdit" role can access a restricted page in order to add and remove products.</span></span>

#### <a name="add-an-administration-folder-and-page"></a><span data-ttu-id="45843-181">管理フォルダーとページの追加</span><span class="sxs-lookup"><span data-stu-id="45843-181">Add an Administration Folder and Page</span></span>

<span data-ttu-id="45843-182">次に、Wingtip Toys サンプルアプリケーションのカスタムロールに属している "canEditUser" ユーザーの " *Admin* " という名前のフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="45843-182">Next, you will create a folder named *Admin* for the "canEditUser" user belonging to the custom role of the Wingtip Toys sample application.</span></span>

1. <span data-ttu-id="45843-183">**ソリューションエクスプローラー**でプロジェクト名 (**Wingtip Toys**) を右クリックし、[ -&gt;**新しいフォルダー**の**追加**] を選択します。</span><span class="sxs-lookup"><span data-stu-id="45843-183">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add** -&gt; **New Folder**.</span></span>
2. <span data-ttu-id="45843-184">新しいフォルダーに「 *Admin*」という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="45843-184">Name the new folder *Admin*.</span></span>
3. <span data-ttu-id="45843-185">[ *Admin* ] フォルダーを右クリックし、[ -の**追加**] &gt; **[新しい項目]** の順に選択します。</span><span class="sxs-lookup"><span data-stu-id="45843-185">Right-click the *Admin* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="45843-186">**[新しい項目の追加]** ダイアログ ボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="45843-186">The **Add New Item** dialog box is displayed.</span></span>
4. <span data-ttu-id="45843-187">左側の<strong>[ C# Visual</strong>-&gt; <strong>Web</strong>テンプレート] グループを選択します。</span><span class="sxs-lookup"><span data-stu-id="45843-187">Select the <strong>Visual C#</strong>-&gt; <strong>Web</strong> templates group on the left.</span></span> <span data-ttu-id="45843-188">中央の一覧で、[<strong>マスターページを含む Web フォーム</strong>] を選択し、「 <em>adminpage .aspx</em><strong>」</strong>という名前を付けて、[<strong>追加</strong>] を選択します。</span><span class="sxs-lookup"><span data-stu-id="45843-188">From the middle list, select <strong>Web Form with Master Page</strong>,name it <em>AdminPage.aspx</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
5. <span data-ttu-id="45843-189">マスターページとして [] を選択し、[ **OK]** を選択し*ます。*</span><span class="sxs-lookup"><span data-stu-id="45843-189">Select the *Site.Master* file as the master page, and then choose **OK**.</span></span>

#### <a name="add-a-webconfig-file"></a><span data-ttu-id="45843-190">Web.config ファイルを追加する</span><span class="sxs-lookup"><span data-stu-id="45843-190">Add a Web.config File</span></span>

<span data-ttu-id="45843-191">*管理*フォルダーに*web.config*ファイルを追加することで、フォルダーに含まれているページへのアクセスを制限できます。</span><span class="sxs-lookup"><span data-stu-id="45843-191">By adding a *Web.config* file to the *Admin* folder, you can restrict access to the page contained in the folder.</span></span>

1. <span data-ttu-id="45843-192">[ *Admin* ] フォルダーを右クリックし、 **[追加]** [ -&gt;**新しい項目**] の順に選択します。</span><span class="sxs-lookup"><span data-stu-id="45843-192">Right-click the *Admin* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="45843-193">**[新しい項目の追加]** ダイアログ ボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="45843-193">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="45843-194">C# Visual web テンプレートの一覧から、中央の一覧から [ <strong>web 構成ファイル</strong>] を選択し、web.config の既定の名前をそのまま<strong>使用し</strong><em>て、[</em><strong>追加</strong>] を選択します。</span><span class="sxs-lookup"><span data-stu-id="45843-194">From the list of Visual C# web templates, select <strong>Web Configuration File</strong>from the middle list, accept the default name of <em>Web.config</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
3. <span data-ttu-id="45843-195">*Web.config ファイル内*の既存の XML コンテンツを次の内容に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="45843-195">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](membership-and-administration/samples/sample4.xml)]

<span data-ttu-id="45843-196">*Web.config ファイルを*保存します。</span><span class="sxs-lookup"><span data-stu-id="45843-196">Save the *Web.config* file.</span></span> <span data-ttu-id="45843-197">Web.config*ファイルは*、アプリケーションの "canedit" ロールに属しているユーザーのみが、*管理*フォルダーに含まれるページにアクセスできることを指定します。</span><span class="sxs-lookup"><span data-stu-id="45843-197">The *Web.config* file specifies that only user belonging to the "canEdit" role of the application can access the page contained in the *Admin* folder.</span></span>

### <a name="including-custom-role-navigation"></a><span data-ttu-id="45843-198">カスタムロールナビゲーションを含む</span><span class="sxs-lookup"><span data-stu-id="45843-198">Including Custom Role Navigation</span></span>

<span data-ttu-id="45843-199">カスタムの "canEdit" ロールのユーザーがアプリケーションの [管理] セクションに移動できるようにするには、サイトの [*マスター* ] ページへのリンクを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="45843-199">To enable the user of the custom "canEdit" role to navigate to the administration section of the application, you must add a link to the *Site.Master* page.</span></span> <span data-ttu-id="45843-200">"CanEdit" ロールに属しているユーザーのみが、管理**者**リンクを表示し、[管理] セクションにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="45843-200">Only users that belong to the "canEdit" role will be able to see the **Admin** link and access the administration section.</span></span>

1. <span data-ttu-id="45843-201">ソリューションエクスプローラーで、[ *] ページを*見つけて開きます。</span><span class="sxs-lookup"><span data-stu-id="45843-201">In Solution Explorer, find and open the *Site.Master* page.</span></span>
2. <span data-ttu-id="45843-202">"CanEdit" ロールのユーザーのリンクを作成するには、次のようにリストが表示されるように、黄色で強調表示されているマークアップを次の順序付けされていないリスト `<ul>` 要素に追加します。</span><span class="sxs-lookup"><span data-stu-id="45843-202">To create a link for the user of the "canEdit" role, add the markup highlighted in yellow to the following unordered list `<ul>` element so that the list appears as follows:</span></span>  

    [!code-html[Main](membership-and-administration/samples/sample5.html?highlight=2-3)]
3. <span data-ttu-id="45843-203">*Site.Master.cs*ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="45843-203">Open the *Site.Master.cs* file.</span></span> <span data-ttu-id="45843-204">黄色で強調表示されているコードを `Page_Load` ハンドラーに追加することで、"canEditUser" ユーザーにのみ**Admin**リンクを表示します。</span><span class="sxs-lookup"><span data-stu-id="45843-204">Make the **Admin** link visible only to the "canEditUser" user by adding the code highlighted in yellow to the `Page_Load` handler.</span></span> <span data-ttu-id="45843-205">`Page_Load` ハンドラーは次のように表示されます。</span><span class="sxs-lookup"><span data-stu-id="45843-205">The `Page_Load` handler will appear as follows:</span></span>   

    [!code-csharp[Main](membership-and-administration/samples/sample6.cs?highlight=3-6)]

<span data-ttu-id="45843-206">ページが読み込まれると、コードは、ログインしているユーザーのロールが "canEdit" であるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="45843-206">When the page loads, the code checks whether the logged-in user has the role of "canEdit".</span></span> <span data-ttu-id="45843-207">ユーザーが "canEdit" ロールに属している場合、 *adminpage .aspx*ページへのリンクを含む span 要素 (およびスパン内のリンク) が表示されます。</span><span class="sxs-lookup"><span data-stu-id="45843-207">If the user belongs to the "canEdit" role, the span element containing the link to the *AdminPage.aspx* page (and consequently the link inside the span) is made visible.</span></span>

### <a name="enabling-product-administration"></a><span data-ttu-id="45843-208">製品管理の有効化</span><span class="sxs-lookup"><span data-stu-id="45843-208">Enabling Product Administration</span></span>

<span data-ttu-id="45843-209">ここまでで、"canEdit" ロールを作成し、"canEditUser" ユーザー、管理フォルダー、および管理ページを追加しました。</span><span class="sxs-lookup"><span data-stu-id="45843-209">So far, you have created the "canEdit" role and added an "canEditUser" user, an administration folder, and an administration page.</span></span> <span data-ttu-id="45843-210">管理フォルダーとページのアクセス権を設定し、アプリケーションに "canEdit" ロールのユーザーのナビゲーションリンクを追加しました。</span><span class="sxs-lookup"><span data-stu-id="45843-210">You have set access rights for the administration folder and page, and have added a navigation link for the user of the "canEdit" role to the application.</span></span> <span data-ttu-id="45843-211">次に、 *adminpage .aspx*ページにマークアップを追加し、 *AdminPage.aspx.cs*分離コードファイルにコードを追加します。これにより、"canedit" ロールのユーザーが製品を追加したり削除したりできるようになります。</span><span class="sxs-lookup"><span data-stu-id="45843-211">Next, you will add markup to the *AdminPage.aspx* page and code to the *AdminPage.aspx.cs* code-behind file that will enable the user with the "canEdit" role to add and remove products.</span></span>

1. <span data-ttu-id="45843-212">**ソリューションエクスプローラー**で、 *Admin*フォルダーから*adminpage*ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="45843-212">In **Solution Explorer**, open the *AdminPage.aspx* file from the *Admin* folder.</span></span>
2. <span data-ttu-id="45843-213">既存のマークアップを次のように置き換えます。</span><span class="sxs-lookup"><span data-stu-id="45843-213">Replace the existing markup with the following:</span></span>  

    [!code-aspx[Main](membership-and-administration/samples/sample7.aspx)]
3. <span data-ttu-id="45843-214">次に、 *adminpage*を右クリックして **[コードの表示]** をクリックし、 *AdminPage.aspx.cs*分離コードファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="45843-214">Next, open the *AdminPage.aspx.cs* code-behind file by right-clicking the *AdminPage.aspx* and clicking **View Code**.</span></span>
4. <span data-ttu-id="45843-215">*AdminPage.aspx.cs*分離コードファイルの既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="45843-215">Replace the existing code in the *AdminPage.aspx.cs* code-behind file with the following code:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample8.cs)]

<span data-ttu-id="45843-216">*AdminPage.aspx.cs*分離コードファイルに入力したコードでは、`AddProducts` というクラスを使用して、実際に製品をデータベースに追加する作業が行われます。</span><span class="sxs-lookup"><span data-stu-id="45843-216">In the code that you entered for the *AdminPage.aspx.cs* code-behind file, a class called `AddProducts` does the actual work of adding products to the database.</span></span> <span data-ttu-id="45843-217">このクラスはまだ存在しないため、ここで作成します。</span><span class="sxs-lookup"><span data-stu-id="45843-217">This class doesn't exist yet, so you will create it now.</span></span>

1. <span data-ttu-id="45843-218">**ソリューションエクスプローラー**で、 *Logic*フォルダーを右クリックし、 **[追加]** [ -&gt;**新しい項目**] の順に選択します。</span><span class="sxs-lookup"><span data-stu-id="45843-218">In **Solution Explorer**, right-click the *Logic* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="45843-219">**[新しい項目の追加]** ダイアログ ボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="45843-219">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="45843-220">左側の **[ C# Visual** -&gt;**コード**テンプレート] グループを選択します。</span><span class="sxs-lookup"><span data-stu-id="45843-220">Select the **Visual C#** -&gt; **Code** templates group on the left.</span></span> <span data-ttu-id="45843-221">次に、中央の一覧から **[クラス]** を選択し、「 *AddProducts.cs*」という名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="45843-221">Then, select **Class**from the middle list and name it *AddProducts.cs*.</span></span>   
   <span data-ttu-id="45843-222">新しいクラスファイルが表示されます。</span><span class="sxs-lookup"><span data-stu-id="45843-222">The new class file is displayed.</span></span>
3. <span data-ttu-id="45843-223">既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="45843-223">Replace the existing code with the following:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample9.cs)]

<span data-ttu-id="45843-224">*Adminpage .aspx*ページでは、"canedit" ロールに属しているユーザーが製品を追加および削除できます。</span><span class="sxs-lookup"><span data-stu-id="45843-224">The *AdminPage.aspx* page allows the user belonging to the "canEdit" role to add and remove products.</span></span> <span data-ttu-id="45843-225">新しい製品が追加されると、製品の詳細が検証され、データベースに入力されます。</span><span class="sxs-lookup"><span data-stu-id="45843-225">When a new product is added, the details about the product are validated and then entered into the database.</span></span> <span data-ttu-id="45843-226">新しい製品は、web アプリケーションのすべてのユーザーがすぐに使用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="45843-226">The new product is immediately available to all users of the web application.</span></span>

#### <a name="unobtrusive-validation"></a><span data-ttu-id="45843-227">控えめに検証</span><span class="sxs-lookup"><span data-stu-id="45843-227">Unobtrusive Validation</span></span>

<span data-ttu-id="45843-228">ユーザーが*adminpage .aspx*ページで提供する製品の詳細は、検証コントロール (`RequiredFieldValidator` および `RegularExpressionValidator`) を使用して検証されます。</span><span class="sxs-lookup"><span data-stu-id="45843-228">The product details that the user provides on the *AdminPage.aspx* page are validated using validation controls (`RequiredFieldValidator` and `RegularExpressionValidator`).</span></span> <span data-ttu-id="45843-229">これらのコントロールは、控えめな検証を自動的に使用します。</span><span class="sxs-lookup"><span data-stu-id="45843-229">These controls automatically use unobtrusive validation.</span></span> <span data-ttu-id="45843-230">控えめな検証では、検証コントロールがクライアント側の検証ロジックに JavaScript を使用できるようになります。これは、ページが検証のためにサーバーへのトリップを必要としないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="45843-230">Unobtrusive validation allows the validation controls to use JavaScript for client-side validation logic, which means the page does not require a trip to the server to be validated.</span></span> <span data-ttu-id="45843-231">既定では、次の構成設定に基づいて、控えめな検証が*web.config ファイルに*含まれています。</span><span class="sxs-lookup"><span data-stu-id="45843-231">By default, unobtrusive validation is included in the *Web.config* file based on the following configuration setting:</span></span>

[!code-xml[Main](membership-and-administration/samples/sample10.xml)]

#### <a name="regular-expressions"></a><span data-ttu-id="45843-232">正規表現</span><span class="sxs-lookup"><span data-stu-id="45843-232">Regular Expressions</span></span>

<span data-ttu-id="45843-233">*Adminpage .aspx*ページの製品価格は、 **RegularExpressionValidator**コントロールを使用して検証されます。</span><span class="sxs-lookup"><span data-stu-id="45843-233">The product price on the *AdminPage.aspx* page is validated using a **RegularExpressionValidator** control.</span></span> <span data-ttu-id="45843-234">このコントロールは、関連付けられている入力コントロール ("AddProductPrice" テキストボックス) の値が正規表現で指定されたパターンと一致するかどうかを検証します。</span><span class="sxs-lookup"><span data-stu-id="45843-234">This control validates whether the value of the associated input control (the "AddProductPrice" TextBox) matches the pattern specified by the regular expression.</span></span> <span data-ttu-id="45843-235">正規表現は、パターンマッチングの表記で、特定の文字パターンをすばやく検索して一致させることができます。</span><span class="sxs-lookup"><span data-stu-id="45843-235">A regular expression is a pattern-matching notation that enables you to quickly find and match specific character patterns.</span></span> <span data-ttu-id="45843-236">**RegularExpressionValidator**コントロールには、次に示すように、価格入力の検証に使用される正規表現を含む `ValidationExpression` という名前のプロパティが含まれています。</span><span class="sxs-lookup"><span data-stu-id="45843-236">The **RegularExpressionValidator** control includes a property named `ValidationExpression` that contains the regular expression used to validate price input, as shown below:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample11.aspx)]

#### <a name="fileupload-control"></a><span data-ttu-id="45843-237">FileUpload コントロール</span><span class="sxs-lookup"><span data-stu-id="45843-237">FileUpload Control</span></span>

<span data-ttu-id="45843-238">入力コントロールと検証コントロールに加えて、 **FileUpload**コントロールを*adminpage .aspx*ページに追加しました。</span><span class="sxs-lookup"><span data-stu-id="45843-238">In addition to the input and validation controls, you added the **FileUpload** control to the *AdminPage.aspx* page.</span></span> <span data-ttu-id="45843-239">このコントロールには、ファイルをアップロードする機能が用意されています。</span><span class="sxs-lookup"><span data-stu-id="45843-239">This control provides the capability to upload files.</span></span> <span data-ttu-id="45843-240">この場合、イメージファイルのアップロードのみを許可します。</span><span class="sxs-lookup"><span data-stu-id="45843-240">In this case, you are only allowing image files to be uploaded.</span></span> <span data-ttu-id="45843-241">分離コードファイル (*AdminPage.aspx.cs*) で、`AddProductButton` をクリックすると、コードは**FileUpload**コントロールの `HasFile` プロパティをチェックします。</span><span class="sxs-lookup"><span data-stu-id="45843-241">In the code-behind file (*AdminPage.aspx.cs*), when the `AddProductButton` is clicked, the code checks the `HasFile` property of the **FileUpload** control.</span></span> <span data-ttu-id="45843-242">コントロールにファイルがあり、ファイルの種類 (ファイル拡張子に基づく) が許可されている場合、イメージは*images*フォルダーと、アプリケーションの*images/親指*フォルダーに保存されます。</span><span class="sxs-lookup"><span data-stu-id="45843-242">If the control has a file and if the file type (based on file extension) is allowed, the image is saved to the *Images* folder and the *Images/Thumbs* folder of the application.</span></span>

#### <a name="model-binding"></a><span data-ttu-id="45843-243">モデル バインド</span><span class="sxs-lookup"><span data-stu-id="45843-243">Model Binding</span></span>

<span data-ttu-id="45843-244">このチュートリアルシリーズの前半では、モデルバインドを使用して**ListView**コントロール、**フォームビュー**コントロール、 **GridView**コントロール、および**ビュー**コントロールを設定していました。</span><span class="sxs-lookup"><span data-stu-id="45843-244">Earlier in this tutorial series you used model binding to populate a **ListView** control, a **FormsView** control, a **GridView** control, and a **DetailView** control.</span></span> <span data-ttu-id="45843-245">このチュートリアルでは、モデルバインドを使用して、 **DropDownList**コントロールに製品カテゴリの一覧を設定します。</span><span class="sxs-lookup"><span data-stu-id="45843-245">In this tutorial, you use model binding to populate a **DropDownList** control with a list of product categories.</span></span>

<span data-ttu-id="45843-246">*Adminpage*ファイルに追加したマークアップには、`DropDownAddCategory`という**DropDownList**コントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="45843-246">The markup that you added to the *AdminPage.aspx* file contains a **DropDownList** control called `DropDownAddCategory`:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample12.aspx)]

<span data-ttu-id="45843-247">モデルバインドを使用して、`ItemType` 属性と `SelectMethod` 属性を設定して、この**DropDownList**を設定します。</span><span class="sxs-lookup"><span data-stu-id="45843-247">You use model binding to populate this **DropDownList** by setting the `ItemType` attribute and the `SelectMethod` attribute.</span></span> <span data-ttu-id="45843-248">`ItemType` 属性は、コントロールを設定するときに `WingtipToys.Models.Category` 型を使用することを指定します。</span><span class="sxs-lookup"><span data-stu-id="45843-248">The `ItemType` attribute specifies that you use the `WingtipToys.Models.Category` type when populating the control.</span></span> <span data-ttu-id="45843-249">この型は、このチュートリアルシリーズの冒頭で、`Category` クラスを作成して定義しています (以下の図を参照)。</span><span class="sxs-lookup"><span data-stu-id="45843-249">You defined this type at the beginning of this tutorial series by creating the `Category` class (shown below).</span></span> <span data-ttu-id="45843-250">`Category` クラスは、 *Category.cs*ファイル内の [*モデル*] フォルダーにあります。</span><span class="sxs-lookup"><span data-stu-id="45843-250">The `Category` class is in the *Models* folder inside the *Category.cs* file.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample13.cs)]

<span data-ttu-id="45843-251">**DropDownList**コントロールの `SelectMethod` 属性は、分離コードファイル (*AdminPage.aspx.cs*) に含まれる `GetCategories` メソッド (下記参照) を使用することを指定します。</span><span class="sxs-lookup"><span data-stu-id="45843-251">The `SelectMethod` attribute of the **DropDownList** control specifies that you use the `GetCategories` method (shown below) that is included in the code-behind file (*AdminPage.aspx.cs*).</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample14.cs)]

<span data-ttu-id="45843-252">このメソッドは、`Category` 型に対してクエリを評価するために `IQueryable` インターフェイスを使用することを指定します。</span><span class="sxs-lookup"><span data-stu-id="45843-252">This method specifies that an `IQueryable` interface is used to evaluate a query against a `Category` type.</span></span> <span data-ttu-id="45843-253">返された値は、ページのマークアップ (*adminpage*) で**DropDownList**を設定するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="45843-253">The returned value is used to populate the **DropDownList** in the markup of the page (*AdminPage.aspx*).</span></span>

<span data-ttu-id="45843-254">リスト内の各項目に対して表示されるテキストは、`DataTextField` 属性を設定することによって指定されます。</span><span class="sxs-lookup"><span data-stu-id="45843-254">The text displayed for each item in the list is specified by setting the `DataTextField` attribute.</span></span> <span data-ttu-id="45843-255">`DataTextField` 属性は、上に示した `Category` クラスの `CategoryName` を使用して、 **DropDownList**コントロールに各カテゴリを表示します。</span><span class="sxs-lookup"><span data-stu-id="45843-255">The `DataTextField` attribute uses the `CategoryName` of the `Category` class (shown above) to display each category in the **DropDownList** control.</span></span> <span data-ttu-id="45843-256">**DropDownList**コントロールで項目が選択されたときに渡される実際の値は、`DataValueField` 属性に基づきます。</span><span class="sxs-lookup"><span data-stu-id="45843-256">The actual value that is passed when an item is selected in the **DropDownList** control is based on the `DataValueField` attribute.</span></span> <span data-ttu-id="45843-257">`DataValueField` 属性は、上に示した `Category` クラスの定義に従って `CategoryID` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="45843-257">The `DataValueField` attribute is set to the `CategoryID` as define in the `Category` class (shown above).</span></span>

### <a name="how-the-application-will-work"></a><span data-ttu-id="45843-258">アプリケーションの動作</span><span class="sxs-lookup"><span data-stu-id="45843-258">How the Application Will Work</span></span>

<span data-ttu-id="45843-259">"CanEdit" ロールに属しているユーザーが最初にページに移動すると、前述のように `DropDownAddCategory`**DropDownList**コントロールが設定されます。</span><span class="sxs-lookup"><span data-stu-id="45843-259">When the user belonging to the "canEdit" role navigates to the page for the first time, the `DropDownAddCategory`**DropDownList** control is populated as described above.</span></span> <span data-ttu-id="45843-260">`DropDownRemoveProduct`**DropDownList**コントロールにも、同じ方法で製品が設定されます。</span><span class="sxs-lookup"><span data-stu-id="45843-260">The `DropDownRemoveProduct`**DropDownList** control is also populated with products using the same approach.</span></span> <span data-ttu-id="45843-261">"CanEdit" ロールに属しているユーザーは、カテゴリの種類を選択し、製品の詳細 (**名前**、**説明**、**価格**、および**画像ファイル**) を追加します。</span><span class="sxs-lookup"><span data-stu-id="45843-261">The user belonging to the "canEdit" role selects the category type and adds product details (**Name**, **Description**, **Price**, and **Image File**).</span></span> <span data-ttu-id="45843-262">"CanEdit" ロールに属しているユーザーが **[製品の追加]** ボタンをクリックすると、`AddProductButton_Click` イベントハンドラーがトリガーされます。</span><span class="sxs-lookup"><span data-stu-id="45843-262">When the user belonging to the "canEdit" role clicks the **Add Product** button, the `AddProductButton_Click` event handler is triggered.</span></span> <span data-ttu-id="45843-263">分離コードファイル (*AdminPage.aspx.cs*) にある `AddProductButton_Click` イベントハンドラーは、イメージファイルが、許可されているファイルの種類 *(.gif*、 *.png*、 *.jpeg*、または *.jpg*) と一致しているかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="45843-263">The `AddProductButton_Click` event handler located in the code-behind file (*AdminPage.aspx.cs*) checks the image file to make sure it matches the allowed file types *(.gif*, *.png*, *.jpeg*, or *.jpg*).</span></span> <span data-ttu-id="45843-264">次に、イメージファイルは Wingtip Toys サンプルアプリケーションのフォルダーに保存されます。</span><span class="sxs-lookup"><span data-stu-id="45843-264">Then, the image file is saved into a folder of the Wingtip Toys sample application.</span></span> <span data-ttu-id="45843-265">次に、新しい製品がデータベースに追加されます。</span><span class="sxs-lookup"><span data-stu-id="45843-265">Next, the new product is added to the database.</span></span> <span data-ttu-id="45843-266">新しい製品の追加を完了するために、`AddProducts` クラスの新しいインスタンスが作成され、製品という名前が付けられます。</span><span class="sxs-lookup"><span data-stu-id="45843-266">To accomplish adding a new product, a new instance of the `AddProducts` class is created and named products.</span></span> <span data-ttu-id="45843-267">`AddProducts` クラスには `AddProduct`という名前のメソッドがあり、products オブジェクトはこのメソッドを呼び出して、製品をデータベースに追加します。</span><span class="sxs-lookup"><span data-stu-id="45843-267">The `AddProducts` class has a method named `AddProduct`, and the products object calls this method to add products to the database.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample15.cs)]

<span data-ttu-id="45843-268">コードによって新しい製品がデータベースに正常に追加されると、`ProductAction=add`クエリ文字列値を使用してページが再読み込みされます。</span><span class="sxs-lookup"><span data-stu-id="45843-268">If the code successfully adds the new product to the database, the page is reloaded with the query string value `ProductAction=add`.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample16.cs)]

<span data-ttu-id="45843-269">ページが再読み込みされると、クエリ文字列が URL に含まれます。</span><span class="sxs-lookup"><span data-stu-id="45843-269">When the page reloads, the query string is included in the URL.</span></span> <span data-ttu-id="45843-270">ページを再読み込みすると、"canEdit" ロールに属しているユーザーは、 *adminpage .aspx*ページの**DropDownList**コントロールで更新をすぐに確認できます。</span><span class="sxs-lookup"><span data-stu-id="45843-270">By reloading the page, the user belonging to the "canEdit" role can immediately see the updates in the **DropDownList** controls on the *AdminPage.aspx* page.</span></span> <span data-ttu-id="45843-271">また、URL と共にクエリ文字列を含めることで、"canEdit" ロールに属しているユーザーに成功メッセージを表示できます。</span><span class="sxs-lookup"><span data-stu-id="45843-271">Also, by including the query string with the URL, the page can display a success message to the user belonging to the "canEdit" role.</span></span>

<span data-ttu-id="45843-272">*Adminpage .aspx*ページを再読み込みすると、`Page_Load` イベントが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="45843-272">When the *AdminPage.aspx* page reloads, the `Page_Load` event is called.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample17.cs)]

<span data-ttu-id="45843-273">`Page_Load` イベントハンドラーは、クエリ文字列の値を確認し、成功メッセージを表示するかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="45843-273">The `Page_Load` event handler checks the query string value and determines whether to show a success message.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="45843-274">アプリケーションの実行</span><span class="sxs-lookup"><span data-stu-id="45843-274">Running the Application</span></span>

<span data-ttu-id="45843-275">ここでアプリケーションを実行して、ショッピングカートのアイテムを追加、削除、および更新する方法を確認できます。</span><span class="sxs-lookup"><span data-stu-id="45843-275">You can run the application now to see how you can add, delete, and update items in the shopping cart.</span></span> <span data-ttu-id="45843-276">ショッピングカートの合計には、ショッピングカート内のすべての品目の合計コストが反映されます。</span><span class="sxs-lookup"><span data-stu-id="45843-276">The shopping cart total will reflect the total cost of all items in the shopping cart.</span></span>

1. <span data-ttu-id="45843-277">ソリューションエクスプローラーで、 **F5**キーを押して Wingtip Toys サンプルアプリケーションを実行します。</span><span class="sxs-lookup"><span data-stu-id="45843-277">In Solution Explorer, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="45843-278">ブラウザーが開き、 *default.aspx*ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="45843-278">The browser opens and shows the *Default.aspx* page.</span></span>
2. <span data-ttu-id="45843-279">ページの上部にある **[ログイン]** リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="45843-279">Click the **Log in** link at the top of the page.</span></span> 

    ![メンバーシップと管理-[ログイン] リンク](membership-and-administration/_static/image2.png)

   <span data-ttu-id="45843-281">*Login.aspx*ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="45843-281">The *Login.aspx* page is displayed.</span></span>
3. <span data-ttu-id="45843-282">次のユーザー名とパスワードを使用します。</span><span class="sxs-lookup"><span data-stu-id="45843-282">Use the following user name and password:</span></span>  
   <span data-ttu-id="45843-283">ユーザー名: canEditUser@wingtiptoys.com</span><span class="sxs-lookup"><span data-stu-id="45843-283">User name: canEditUser@wingtiptoys.com</span></span>  
   <span data-ttu-id="45843-284">パスワード: Pa $ $word 1</span><span class="sxs-lookup"><span data-stu-id="45843-284">Password: Pa$$word1</span></span> 

    ![メンバーシップと管理-[ログイン] ページ](membership-and-administration/_static/image3.png)
4. <span data-ttu-id="45843-286">ページの下部にある **[ログイン]** ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="45843-286">Click the **Log in** button near the bottom of the page.</span></span>
5. <span data-ttu-id="45843-287">次のページの上部にある **[管理者]** リンクを選択して、 *adminpage .aspx*ページに移動します。</span><span class="sxs-lookup"><span data-stu-id="45843-287">At the top of the next page, select the **Admin** link to navigate to the *AdminPage.aspx* page.</span></span> 

    ![メンバーシップと管理-管理者リンク](membership-and-administration/_static/image4.png)
6. <span data-ttu-id="45843-289">入力の検証をテストするには、製品の詳細を追加せずに **[製品の追加]** ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="45843-289">To test the input validation, click the **Add Product** button without adding any product details.</span></span> 

    ![メンバーシップと管理-[管理者] ページ](membership-and-administration/_static/image5.png)

   <span data-ttu-id="45843-291">必須フィールドメッセージが表示されていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="45843-291">Notice that the required field messages are displayed.</span></span>
7. <span data-ttu-id="45843-292">新しい製品の詳細を追加し、 **[製品の追加]** ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="45843-292">Add the details for a new product, and then click the **Add Product** button.</span></span> 

    ![メンバーシップと管理-製品の追加](membership-and-administration/_static/image6.png)
8. <span data-ttu-id="45843-294">上部のナビゲーションメニューから **[製品]** を選択すると、追加した新しい製品が表示されます。</span><span class="sxs-lookup"><span data-stu-id="45843-294">Select **Products** from the top navigation menu to view the new product you added.</span></span> 

    ![メンバーシップと管理-新しい製品の表示](membership-and-administration/_static/image7.png)
9. <span data-ttu-id="45843-296">[管理**者**] リンクをクリックして、[管理] ページに戻ります。</span><span class="sxs-lookup"><span data-stu-id="45843-296">Click the **Admin** link to return to the administration page.</span></span>
10. <span data-ttu-id="45843-297">ページの **[製品の削除]** セクションで、ドロップダウン**リスト**に追加した新しい製品を選択します。</span><span class="sxs-lookup"><span data-stu-id="45843-297">In the **Remove Product** section of the page, select the new product you added in the **DropDownListBox**.</span></span>
11. <span data-ttu-id="45843-298">**[製品の削除]** ボタンをクリックして、新しい製品をアプリケーションから削除します。</span><span class="sxs-lookup"><span data-stu-id="45843-298">Click the **Remove Product** button to remove the new product from the application.</span></span> 

    ![メンバーシップと管理-製品の削除](membership-and-administration/_static/image8.png)
12. <span data-ttu-id="45843-300">上部のナビゲーションメニューから **[製品]** を選択して、製品が削除されたことを確認します。</span><span class="sxs-lookup"><span data-stu-id="45843-300">Select **Products** from the top navigation menu to confirm that the product has been removed.</span></span>
13. <span data-ttu-id="45843-301">[ログオフ] を**クリックして**、存在する管理モードにします。</span><span class="sxs-lookup"><span data-stu-id="45843-301">Click **Log off** to exist administration mode.</span></span>   
    <span data-ttu-id="45843-302">上部のナビゲーションウィンドウに **[管理]** メニュー項目が表示されなくなっていることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="45843-302">Notice that the top navigation pane no longer shows the **Admin** menu item.</span></span>

## <a name="summary"></a><span data-ttu-id="45843-303">要約</span><span class="sxs-lookup"><span data-stu-id="45843-303">Summary</span></span>

<span data-ttu-id="45843-304">このチュートリアルでは、カスタムロールとカスタムロールに属しているユーザー、管理フォルダーとページへの制限付きアクセス、およびカスタムロールに属しているユーザーのナビゲーションを追加しました。</span><span class="sxs-lookup"><span data-stu-id="45843-304">In this tutorial, you added a custom role and a user belonging to the custom role, restricted access to the administration folder and page, and provided navigation for the user belonging to the custom role.</span></span> <span data-ttu-id="45843-305">モデルバインドを使用して、 **DropDownList**コントロールにデータを設定しています。</span><span class="sxs-lookup"><span data-stu-id="45843-305">You used model binding to populate a **DropDownList** control with data.</span></span> <span data-ttu-id="45843-306">**FileUpload**コントロールと検証コントロールを実装しています。</span><span class="sxs-lookup"><span data-stu-id="45843-306">You implemented the **FileUpload** control and validation controls.</span></span> <span data-ttu-id="45843-307">また、データベースの製品を追加および削除する方法についても説明しました。</span><span class="sxs-lookup"><span data-stu-id="45843-307">Also, you have learned how to add and remove products from a database.</span></span> <span data-ttu-id="45843-308">次のチュートリアルでは、ASP.NET ルーティングを実装する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="45843-308">In the next tutorial, you'll learn how to implement ASP.NET routing.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="45843-309">その他の資料</span><span class="sxs-lookup"><span data-stu-id="45843-309">Additional Resources</span></span>

<span data-ttu-id="45843-310">[Web.config-authorization 要素](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="45843-310">[Web.config - authorization Element](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="45843-311">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="45843-311">ASP.NET Identity</span></span>](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md)  
[<span data-ttu-id="45843-312">メンバーシップ、OAuth、SQL Database を持つ Secure ASP.NET Web フォームアプリを Azure の Web サイトにデプロイする</span><span class="sxs-lookup"><span data-stu-id="45843-312">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to an Azure Web Site</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="45843-313">Microsoft Azure-無料試用版</span><span class="sxs-lookup"><span data-stu-id="45843-313">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

> [!div class="step-by-step"]
> <span data-ttu-id="45843-314">[前へ](checkout-and-payment-with-paypal.md)
> [次へ](url-routing.md)</span><span class="sxs-lookup"><span data-stu-id="45843-314">[Previous](checkout-and-payment-with-paypal.md)
[Next](url-routing.md)</span></span>
