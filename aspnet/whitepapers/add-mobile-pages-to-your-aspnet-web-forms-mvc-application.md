---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: '方法: モバイルページを ASP.NET Web フォーム/MVC アプリケーションに追加する |Microsoft Docs'
author: rick-anderson
description: ここでは、ASP.NET Web フォーム/MVC アプリケーションからモバイルデバイス用に最適化されたページを提供するさまざまな方法について説明し、アーキテクチャと...
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 63c555358d06a9506bb5c8c993800c3307108192
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/06/2020
ms.locfileid: "78462214"
---
# <a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="3dbf3-103">方法: ASP.NET Web フォームまたは MVC アプリケーションにモバイル ページを追加する</span><span class="sxs-lookup"><span data-stu-id="3dbf3-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>

> <span data-ttu-id="3dbf3-104">**適用対象**</span><span class="sxs-lookup"><span data-stu-id="3dbf3-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="3dbf3-105">ASP.NET Web フォームバージョン4.0</span><span class="sxs-lookup"><span data-stu-id="3dbf3-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="3dbf3-106">ASP.NET MVC バージョン3.0</span><span class="sxs-lookup"><span data-stu-id="3dbf3-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="3dbf3-107">**まとめ**</span><span class="sxs-lookup"><span data-stu-id="3dbf3-107">**Summary**</span></span>
> 
> <span data-ttu-id="3dbf3-108">ここでは、ASP.NET Web フォーム/MVC アプリケーションからモバイルデバイス用に最適化されたページを提供するさまざまな方法について説明し、幅広いデバイスを対象とする場合に考慮する必要があるアーキテクチャと設計上の問題について説明します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="3dbf3-109">このドキュメントでは、ASP.NET 2.0 から3.5 への ASP.NET モバイルコントロールが互換性のために残されている理由についても説明し、いくつかの最新の代替手段について説明します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>

## <a name="contents"></a><span data-ttu-id="3dbf3-110">内容</span><span class="sxs-lookup"><span data-stu-id="3dbf3-110">Contents</span></span>

- <span data-ttu-id="3dbf3-111">概要</span><span class="sxs-lookup"><span data-stu-id="3dbf3-111">Overview</span></span>
- <span data-ttu-id="3dbf3-112">アーキテクチャオプション</span><span class="sxs-lookup"><span data-stu-id="3dbf3-112">Architectural options</span></span>
- <span data-ttu-id="3dbf3-113">ブラウザーとデバイスの検出</span><span class="sxs-lookup"><span data-stu-id="3dbf3-113">Browser and device detection</span></span>
- <span data-ttu-id="3dbf3-114">ASP.NET Web Forms アプリケーションでモバイル専用ページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="3dbf3-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="3dbf3-115">ASP.NET MVC アプリケーションでモバイル専用ページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="3dbf3-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="3dbf3-116">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="3dbf3-116">Additional resources</span></span>

<span data-ttu-id="3dbf3-117">ASP.NET Web フォームと MVC の両方に関するこのホワイトペーパーの手法について説明したダウンロード可能なコードサンプルについては、「 [ASP.NET を使用したサイトの Mobile Apps &](https://docs.microsoft.com/aspnet/mobile/overview)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="3dbf3-118">概要</span><span class="sxs-lookup"><span data-stu-id="3dbf3-118">Overview</span></span>

<span data-ttu-id="3dbf3-119">モバイルデバイス–スマートフォン、機能フォン、タブレット– Web にアクセスする手段として、引き続き広く普及しています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="3dbf3-120">多くの web 開発者や web 指向企業にとって、このようなデバイスを使用する訪問者のための優れた閲覧エクスペリエンスを提供することがますます重要になっています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="3dbf3-121">以前のバージョンの ASP.NET でサポートされているモバイルブラウザー</span><span class="sxs-lookup"><span data-stu-id="3dbf3-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="3dbf3-122">*ASP.NET Mobile Controls*に含まれる ASP.NET バージョン2.0 から3.5 に*は、* MobileControls 名前空間と名前空間にあるモバイルデバイスの一連のサーバーコントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="3dbf3-123">アセンブリはまだ ASP.NET 4 に含まれていますが、非推奨とされます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="3dbf3-124">開発者は、このペーパーで説明されているような、より新しいアプローチに移行することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="3dbf3-125">ASP.NET モバイルコントロールが不使用とマークされている理由は、2005以前の共通の携帯電話を中心に設計されているためです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="3dbf3-126">これらのコントロールは、主に、その時代 (標準の HTML ではなく) WML または cHTML マークアップを、その時代 (年号) の WAP ブラウザー用にレンダリングするように設計されています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="3dbf3-127">しかし、多くのプロジェクトでは、ほとんどのプロジェクトに対して WAP、WML、および cHTML が関係していません。これは、HTML がモバイルブラウザーやデスクトップブラウザーのユビキタスマークアップ言語と同じになるようになったためです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="3dbf3-128">現在、モバイルデバイスをサポートするための課題</span><span class="sxs-lookup"><span data-stu-id="3dbf3-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="3dbf3-129">モバイルブラウザーでは HTML がほぼ一般にサポートされていますが、優れたモバイルブラウズエクスペリエンスを作成するためには、多くの課題に直面しています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="3dbf3-130">***画面サイズ***-モバイルデバイスはフォームによって大きく異なり、多くの場合、画面はデスクトップモニターよりもはるかに小さくなります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="3dbf3-131">そのため、まったく異なるページレイアウトを設計する必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="3dbf3-132">***入力方式***–一部のデバイスにはキーパッドがあり、styluses はありますが、タッチを使用します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="3dbf3-133">場合によっては、複数のナビゲーションメカニズムとデータ入力方法を検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="3dbf3-134">***標準への準拠***–多くのモバイルブラウザーでは、最新の HTML、CSS、または JavaScript の標準がサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="3dbf3-135">***帯域幅***–携帯データネットワークのパフォーマンスは大きく異なります。また、一部のエンドユーザーは、メガバイト単位で課金される tariffs を使用しています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="3dbf3-136">オールインワンサイズのソリューションはありません。アプリケーションの外観と動作は、デバイスにアクセスするデバイスによって異なります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="3dbf3-137">必要なモバイルサポートのレベルによっては、これはデスクトップの "browser ウォーズ" よりも web 開発者にとって大きな課題になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="3dbf3-138">初めてモバイルブラウザーのサポートに近づいた開発者は、おそらく、最新のスマートフォン (Windows Phone 7、iPhone、Android など) をサポートすることが重要であると考えられています。ハードウェア.</span><span class="sxs-lookup"><span data-stu-id="3dbf3-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="3dbf3-139">しかし、低価格の電話は依然として非常に人気があり、その所有者はこれらを使用して web を閲覧します。特に、携帯電話がブロードバンド接続よりも簡単に利用できる国では、</span><span class="sxs-lookup"><span data-stu-id="3dbf3-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="3dbf3-140">お客様のビジネスでは、顧客の可能性を考慮して、サポートするデバイスの範囲を決める必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="3dbf3-141">非常に優れた正常性 spa のオンラインパンフレットを構築している場合は、高度なスマートフォンのみを対象とするビジネス上の意思決定を行うことができます。一方、映画のチケット予約システムを作成する場合は、あまり強力でない訪問者を考慮する必要があります。電話.</span><span class="sxs-lookup"><span data-stu-id="3dbf3-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="3dbf3-142">アーキテクチャオプション</span><span class="sxs-lookup"><span data-stu-id="3dbf3-142">Architectural options</span></span>

<span data-ttu-id="3dbf3-143">ASP.NET Web フォームまたは MVC の特定の技術的な詳細に進む前に、一般的な web 開発者には、モバイルブラウザーをサポートするための主な3つのオプションが用意されています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="3dbf3-144">***何もしない–*** 標準のデスクトップ指向 web アプリケーションを作成し、モバイルブラウザーに依存して、それを許容できるようにレンダリングするだけです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="3dbf3-145">**利点**: 追加の作業を行わずに、実装して保守するための最もコストの高いオプションです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="3dbf3-146">**欠点**: 最も悪いエンドユーザーエクスペリエンスを提供します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="3dbf3-147">最新のスマートフォンでは、デスクトップブラウザーと同様に HTML がレンダリングされる場合がありますが、ユーザーは小さい画面でコンテンツを使用するために、水平方向および垂直方向にズームおよびスクロールすることが強制されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="3dbf3-148">これは最適なものではありません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-148">This is far from optimal.</span></span>
        - <span data-ttu-id="3dbf3-149">古いデバイスや機能の電話では、適切な方法でマークアップをレンダリングできない場合があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="3dbf3-150">最新のタブレットデバイス (画面がラップトップの画面ほど大きくなる可能性がある) でも、さまざまな相互作用ルールが適用されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="3dbf3-151">タッチベースの入力は、より大きなボタンやリンクをさらに重ねることで最適に動作します。また、マウスカーソルをフライアウトメニュー上に置く方法もありません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="3dbf3-152">\***クライアント上の問題を解決\*する–** CSS と[プログレッシブ拡張機能](http://en.wikipedia.org/wiki/Progressive_enhancement)を使用すると、マークアップ、スタイル、およびスクリプトを作成して、どのブラウザーで実行しているかに適合させることができます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="3dbf3-153">たとえば、 [CSS 3 メディアクエリ](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)では、選択したしきい値よりも画面が狭いデバイスで1列のレイアウトに変換する複数列のレイアウトを作成できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="3dbf3-154">**利点**: 使用されている特定のデバイスのレンダリングを最適化します。これには、どのような画面と入力特性に従っても、将来のデバイスは不明です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="3dbf3-155">**利点**: すべてのデバイスの種類で、サーバー側のロジックを簡単に共有できます (コードの重複を最小限に抑えることができます)</span><span class="sxs-lookup"><span data-stu-id="3dbf3-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="3dbf3-156">**欠点**: モバイルデバイスはデスクトップデバイスとは異なるため、モバイルページはデスクトップページとはまったく別のものにして、さまざまな情報が表示されるようにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="3dbf3-157">このようなバリエーションは、CSS だけを通じて堅牢で実現するのは効率的ではありません。特に、古いデバイスが CSS ルールを解釈する際にどの程度一貫性がないかを検討</span><span class="sxs-lookup"><span data-stu-id="3dbf3-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="3dbf3-158">これは、特に CSS 3 の属性に当てはまります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="3dbf3-159">**短所**: さまざまなデバイスに対して、サーバー側のロジックとワークフローの違いをサポートしません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="3dbf3-160">たとえば、CSS だけを使用して、モバイルユーザー向けの簡単なショッピングカートのチェックアウトワークフローを実装することはできません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="3dbf3-161">**欠点**: 帯域幅の使用効率が低い。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="3dbf3-162">対象のデバイスがその情報のサブセットのみを使用する場合でも、サーバーは、すべての可能なデバイスに適用されるマークアップとスタイルを送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="3dbf3-163">***サーバー上の問題を解決し*** ます。サーバーがどのデバイスにアクセスしているかを認識している場合、またはそのデバイスの画面サイズと入力方法、モバイルデバイスかどうかなど、少なくともそのデバイスの特性をサーバーが認識している場合は、異なるロジックを実行して、異なる HTML マークアップを出力できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="3dbf3-164">**利点:** 最大限の柔軟性。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="3dbf3-165">モバイルのサーバー側のロジックを変更したり、目的のデバイス固有のレイアウトに合わせてマークアップを最適化したりできる量に制限はありません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="3dbf3-166">**利点:** 効率的な帯域幅の使用。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="3dbf3-167">ターゲットデバイスが使用するマークアップとスタイル設定情報を送信するだけです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="3dbf3-168">**欠点:** 場合によっては、労力やコードを強制的に繰り返す必要があります (たとえば、Web フォームページまたは MVC ビューの類似したコピーを作成することになります)。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="3dbf3-169">可能な場合は、基になるレイヤーまたはサービスに共通のロジックを考慮しますが、UI コードまたはマークアップの一部は重複して並列に保持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="3dbf3-170">**欠点:** デバイスの検出は簡単ではありません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="3dbf3-171">既知のデバイスの種類とその特性 (常に最新の状態ではない可能性があります) のリストまたはデータベースが必要であり、すべての受信要求が正確に一致するとは限りません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="3dbf3-172">このドキュメントでは、後でいくつかのオプションとその落とし穴について説明します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="3dbf3-173">最良の結果を得るには、ほとんどの開発者がオプション (2) と (3) を結合する必要があることを見つけます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="3dbf3-174">スタイルの微妙な違いについては、クライアントでは CSS または JavaScript を使用することをお勧めしますが、データ、ワークフロー、またはマークアップの大きな違いはサーバー側のコードで最も効果的に実装されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="3dbf3-175">このホワイトペーパーでは、サーバー側の手法に焦点を当てています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="3dbf3-176">ASP.NET Web フォームと MVC は両方ともサーバー側テクノロジであるため、このホワイトペーパーでは、モバイルブラウザー用にさまざまなマークアップとロジックを生成できるサーバー側の手法に焦点を当てます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="3dbf3-177">もちろん、これをクライアント側の手法 (CSS 3 メディアクエリ、プログレッシブ拡張 JavaScript など) と組み合わせることもできますが、これは ASP.NET 開発よりも web デザインの方が重要です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="3dbf3-178">ブラウザーとデバイスの検出</span><span class="sxs-lookup"><span data-stu-id="3dbf3-178">Browser and device detection</span></span>

<span data-ttu-id="3dbf3-179">モバイルデバイスをサポートするためのすべてのサーバー側の手法に関する重要な前提条件は、ビジターが使用しているデバイスを把握することです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="3dbf3-180">実際には、デバイスの製造元とモデル番号を知るよりも、デバイスの*特性*がわかっていることがわかります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="3dbf3-181">次のような特性があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-181">Characteristics may include:</span></span>

- <span data-ttu-id="3dbf3-182">モバイルデバイスですか。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-182">Is it a mobile device?</span></span>
- <span data-ttu-id="3dbf3-183">Input メソッド (マウス/キーボード、タッチ、キーボードボタン、ジョイスティック、...)</span><span class="sxs-lookup"><span data-stu-id="3dbf3-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="3dbf3-184">画面のサイズ (物理的およびピクセル単位)</span><span class="sxs-lookup"><span data-stu-id="3dbf3-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="3dbf3-185">サポートされているメディアとデータ形式</span><span class="sxs-lookup"><span data-stu-id="3dbf3-185">Supported media and data formats</span></span>
- <span data-ttu-id="3dbf3-186">など</span><span class="sxs-lookup"><span data-stu-id="3dbf3-186">Etc.</span></span>

<span data-ttu-id="3dbf3-187">モデル番号よりも特性に基づいて決定することをお勧めします。これは、将来のデバイスをより適切に処理できるようになるためです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="3dbf3-188">ASP を使用する。NET の組み込みのブラウザー検出のサポート</span><span class="sxs-lookup"><span data-stu-id="3dbf3-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="3dbf3-189">ASP.NET Web フォームと MVC 開発者は、*要求ブラウザー*オブジェクトのプロパティを調べることによって、閲覧ブラウザーの重要な特性をすぐに見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="3dbf3-190">たとえば、「」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-190">For example, see</span></span>

- <span data-ttu-id="3dbf3-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="3dbf3-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="3dbf3-192">MobileDeviceManufacturer、MobileDeviceModel を要求します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="3dbf3-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="3dbf3-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="3dbf3-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="3dbf3-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="3dbf3-195">...参照できます他の多くのユーザー</span><span class="sxs-lookup"><span data-stu-id="3dbf3-195">…and many others</span></span>

<span data-ttu-id="3dbf3-196">バックグラウンドでは、ASP.NET プラットフォームは、一連のブラウザー定義 XML ファイル内の正規表現との受信*ユーザーエージェント*(UA) HTTP ヘッダーを照合します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="3dbf3-197">既定では、プラットフォームに多くの一般的なモバイルデバイスの定義が含まれています。また、認識したい他のユーザーに対してカスタムブラウザー定義ファイルを追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="3dbf3-198">詳細については、MSDN ページ[ASP.NET Web サーバーコントロールとブラウザー機能](https://msdn.microsoft.com/library/x3k2ssx2.aspx)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="3dbf3-199">51Degrees.mobi Foundation による WURFL デバイスデータベースの使用</span><span class="sxs-lookup"><span data-stu-id="3dbf3-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="3dbf3-200">ASP で実行します。多くのアプリケーションでは、NET の組み込みのブラウザー検出サポートで十分ですが、大きなケースは2つあります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="3dbf3-201">***最新のデバイスを認識する***(ブラウザー定義ファイルを手動で作成する必要はありません)。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="3dbf3-202">.NET 4 のブラウザー定義ファイルは、Windows Phone 7、Android フォン、Opera モバイルブラウザー、または Apple Ipad を認識するのに十分な最新ではないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="3dbf3-203">***デバイスの機能の詳細については、***「」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="3dbf3-204">場合によっては、デバイスの入力方法 (タッチ vs パッドなど)、またはブラウザーがサポートするオーディオ形式について知る必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="3dbf3-205">この情報は、標準のブラウザー定義ファイルでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="3dbf3-206">[*ワイヤレスユニバーサルリソースファイル*(wurfl) プロジェクト](http://wurfl.sourceforge.net/)は、現在使用されているモバイルデバイスに関する最新の詳細情報を保持します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="3dbf3-207">.NET 開発者向けのすばらしいニュースは、その ASP です。NET のブラウザー検出機能は拡張可能であるため、これらの問題を克服するために拡張することができます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="3dbf3-208">たとえば、オープンソースの[*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection)ライブラリをプロジェクトに追加できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="3dbf3-209">これは、WURFL データを直接読み取り、ASP にフックする ASP.NET IHttpModule またはブラウザー機能プロバイダーです (Web フォームと MVC アプリケーションの両方で使用できます)。NET の組み込みのブラウザー検出メカニズム。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="3dbf3-210">モジュールをインストールすると、要求されたブラウザーには、より正確で詳細な情報が表示され*ます。* 前述の多くのデバイスが正しく認識され、機能 (入力方式などの追加機能を含む) が表示されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="3dbf3-211">詳細については、プロジェクトのドキュメントを参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="3dbf3-212">Web フォームアプリケーションでモバイル専用ページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="3dbf3-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="3dbf3-213">既定では、次のように、一般的なモバイルデバイスに新しい Web フォームアプリケーションが表示されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="3dbf3-214">どちらのレイアウトも、非常にモバイルに適しているとは言えません。このページは、縦向きの小さな画面ではなく、大規模な横向きのモニター向けに設計されています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="3dbf3-215">では、どうすればよいでしょうか。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-215">So what can you do about it?</span></span>

<span data-ttu-id="3dbf3-216">このドキュメントで既に説明したように、モバイルデバイス用にページを調整する方法は多数あります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="3dbf3-217">一部の手法はサーバーベースであり、他の方法はクライアント上で実行されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="3dbf3-218">モバイル専用マスターページの作成</span><span class="sxs-lookup"><span data-stu-id="3dbf3-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="3dbf3-219">要件に応じて、すべての訪問者に同じ Web フォームを使用できますが、2つの独立したマスターページがあります。1つはデスクトップ訪問者用、もう1つはモバイル訪問者用です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="3dbf3-220">これにより、ページロジックを強制的に複製しなくても、CSS スタイルシートまたは最上位レベルの HTML マークアップをモバイルデバイスに合わせて変更できる柔軟性が得られます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="3dbf3-221">これは簡単に行うことができます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-221">This is easy to do.</span></span> <span data-ttu-id="3dbf3-222">たとえば、Web フォームに次のような PreInit ハンドラーを追加できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="3dbf3-223">次に、アプリケーションの最上位フォルダーに、Mobile という名前のマスターページを作成します。これは、モバイルデバイスが検出されたときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="3dbf3-224">モバイルマスターページは、必要に応じてモバイル固有の CSS スタイルシートを参照できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="3dbf3-225">デスクトップの訪問者には、モバイルデバイスではなく、既定のマスターページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="3dbf3-226">モバイル専用の独立した Web フォームを作成する</span><span class="sxs-lookup"><span data-stu-id="3dbf3-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="3dbf3-227">柔軟性を最大限に高めるために、さまざまな種類のデバイスに個別のマスターページを用意するだけでなく、さらに多くのことを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="3dbf3-228">一連の*Web フォームページ*(デスクトップブラウザー用に1セット、モバイル用に別のセット) をそれぞれ実装できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="3dbf3-229">これは、モバイル訪問者に対して非常に異なる情報やワークフローを提示する場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="3dbf3-230">このセクションの残りの部分では、この方法について詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="3dbf3-231">デスクトップブラウザー用にデザインされた Web フォームアプリケーションが既に存在する場合、最も簡単な方法は、プロジェクト内に "Mobile" というサブフォルダーを作成し、そこにモバイルページを作成することです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="3dbf3-232">他の Web フォームアプリケーションで使用するのと同じ手法を使用して、独自のマスターページ、スタイルシート、およびページを含むサブサイト全体を構築できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="3dbf3-233">必ずしもデスクトップサイト内の*すべて*のページに対して同等のモバイルを作成する必要はありません。モバイル訪問者にとって意味のある機能のサブセットを選択できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="3dbf3-234">モバイルページは、必要に応じて、一般的な静的リソース (画像、JavaScript、CSS ファイルなど) を通常のページと共有できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="3dbf3-235">"Mobile" フォルダーは、IIS でホストされている場合は個別のアプリケーションとしてマークされ*ない*ため (Web フォームページの単純なサブフォルダー)、デスクトップページと同じ構成、セッションデータ、およびその他のインフラストラクチャもすべて共有されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="3dbf3-236">通常、この方法にはコードの重複が含まれます (モバイルページはデスクトップページと類似点を共有する可能性があります)。一般的なビジネスロジックやデータアクセスコードを、共有されている基になるレイヤーまたはサービスに分割することが重要です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="3dbf3-237">それ以外の場合は、アプリケーションの作成と保守を2倍にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>

#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="3dbf3-238">モバイルページへのモバイルユーザーのリダイレクト</span><span class="sxs-lookup"><span data-stu-id="3dbf3-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="3dbf3-239">多くの場合、モバイルユーザーを参照セッション (セッションのすべての要求ではありません) の*最初*の要求でのみモバイルページにリダイレクトすると便利です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="3dbf3-240">そうすれば、モバイル訪問者はデスクトップページに "デスクトップバージョン" に移動するだけで簡単にアクセスできるようになります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="3dbf3-241">訪問者は、セッションの最初の要求ではなくなったため、モバイルページにリダイレクトされません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="3dbf3-242">サイトのデスクトップとモバイルの部分で共有されている動的リソース (たとえば、サイトのデスクトップとモバイルの両方の部分が IFRAME に表示される共通の Web フォームがある場合や、特定の Ajax ハンドラー) に対する要求を妨げるリスクを回避します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="3dbf3-243">これを行うには、**セッション\_開始**メソッドにリダイレクトロジックを配置します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="3dbf3-244">たとえば、次のメソッドを Global.asax.cs ファイルに追加します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="3dbf3-245">モバイルページを対象としたフォーム認証の構成</span><span class="sxs-lookup"><span data-stu-id="3dbf3-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="3dbf3-246">フォーム認証では、認証プロセス中および認証後に訪問者をリダイレクトできる場所について、特定の前提条件を使用します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="3dbf3-247">ユーザーを認証する必要がある場合、フォーム認証では、デスクトップとモバイルユーザーのどちらであるかに関係なく、ユーザーがデスクトップのログインページにリダイレクトされます。これは、 *1 つ*のログイン URL の概念しか持たないためです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="3dbf3-248">モバイルログインページのスタイルを別にする場合は、モバイルユーザーを別のモバイルログインページにリダイレクトするように、デスクトップのログインページを拡張する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="3dbf3-249">たとえば、次のコードを**デスクトップ**ログインページの分離コードに追加します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="3dbf3-250">ユーザーがログインに成功すると、既定ではフォーム認証によって、既定のページが*1 つ*だけになるため、既定でデスクトップのホームページにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="3dbf3-251">ログインが成功した後にモバイルホームページにリダイレクトされるように、モバイルログインページを拡張する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="3dbf3-252">たとえば、**モバイル**ログインページの分離コードに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="3dbf3-253">このコードは、既定のプロジェクトテンプレートのように、ページに LoginUser というログインサーバーコントロールがあることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="3dbf3-254">出力キャッシュの操作</span><span class="sxs-lookup"><span data-stu-id="3dbf3-254">Working with Output Caching</span></span>

<span data-ttu-id="3dbf3-255">出力キャッシュを使用している場合は、既定では、デスクトップユーザーが特定の URL にアクセスし、その後、モバイルユーザーがキャッシュされたデスクトップ出力を受け取る可能性があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="3dbf3-256">この警告は、デバイスの種類ごとにマスターページを変更するか、デバイスの種類ごとに Web フォームをまったく個別に実装するかによって適用されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="3dbf3-257">この問題を回避するには、ビジターがモバイルデバイスを使用しているかどうかに応じて、キャッシュエントリを変更するように ASP.NET に指示します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="3dbf3-258">次のように、VaryByCustom パラメーターをページの OutputCache 宣言に追加します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="3dbf3-259">次に、Global.asax.cs ファイルに次のメソッドオーバーライドを追加して、 *isMobileDevice*をカスタムキャッシュパラメーターとして定義します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="3dbf3-260">これにより、ページへのモバイル訪問者は、以前にデスクトップ訪問者によってキャッシュに格納された出力を受信しなくなります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="3dbf3-261">実際の例</span><span class="sxs-lookup"><span data-stu-id="3dbf3-261">A working example</span></span>

<span data-ttu-id="3dbf3-262">これらの手法を実際に確認するには、[このホワイトペーパーのコードサンプル](https://docs.microsoft.com/aspnet/mobile/overview)をダウンロードしてください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="3dbf3-263">Web フォームサンプルアプリケーションは、モバイルユーザーをモバイルと呼ばれるサブフォルダー内の一連のモバイル固有ページに自動的にリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="3dbf3-264">これらのページのマークアップとスタイル設定は、次のスクリーンショットからわかるように、モバイルブラウザー向けに最適化されています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="3dbf3-265">モバイルブラウザー用にマークアップと CSS を最適化する方法の詳細については、このドキュメントの後半の「モバイルブラウザーのモバイルページのスタイル設定」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="3dbf3-266">ASP.NET MVC アプリケーションでモバイル専用ページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="3dbf3-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="3dbf3-267">モデルビューコントローラーのパターンでは、アプリケーションロジック (コントローラー内) とプレゼンテーションロジック (ビュー内) を分離するため、次のいずれかの方法を選択して、サーバー側コードでモバイルサポートを処理できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="3dbf3-268">\***デスクトップとモバイルの両方のブラウザーで同じコントローラーとビューを使用しますが、デバイスの種類 \* に応じて、さまざまな Razor レイアウトでビューをレンダリングします。**</span><span class="sxs-lookup"><span data-stu-id="3dbf3-268">\***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type\*.**</span></span> <span data-ttu-id="3dbf3-269">このオプションは、すべてのデバイスで同一のデータを表示していても、別の CSS スタイルシートを提供したり、モバイルのいくつかのトップレベル HTML 要素を変更したりする場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="3dbf3-270">***デスクトップとモバイルの両方のブラウザーで同じコントローラーを使用しますが、デバイスの種類によって異なるビューをレンダリング***します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="3dbf3-271">このオプションは、ほぼ同じデータを表示し、エンドユーザーに対して同じワークフローを提供しているが、使用されているデバイスに合わせてまったく異なる HTML マークアップを表示する場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="3dbf3-272">\**デスクトップとモバイルのブラウザー用に個別の領域を作成し、各 \* の独立したコントローラーとビューを実装 *ます。**</span><span class="sxs-lookup"><span data-stu-id="3dbf3-272">\***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each\*.**</span></span> <span data-ttu-id="3dbf3-273">このオプションは、さまざまな情報を含む非常に異なる画面を表示し、デバイスの種類に合わせて最適化されたさまざまなワークフローを使用してユーザーを指導する場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="3dbf3-274">これはコードの繰り返しを意味する場合がありますが、共通のロジックを基になるレイヤーまたはサービスに分解することによって、これを最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="3dbf3-275">**最初**のオプションを使用して、デバイスの種類ごとに Razor レイアウトのみを変更する場合は、非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="3dbf3-276">\_ViewStart. cshtml ファイルを次のように変更します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="3dbf3-277">これで、ページ構造とモバイルデバイス用に最適化された CSS ルールを使用して、\_LayoutMobile. cshtml という名前のモバイル固有のレイアウトを作成できるようになりました。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="3dbf3-278">**2 番目**のオプションを使用して、ビジターのデバイスの種類に応じてまったく異なるビューを表示する場合は、 [Scott マン selman のブログ](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx)記事を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="3dbf3-279">このホワイトペーパーの残りの部分では、 **3 番目**のオプションである [モバイルデバイス用に個別のコントローラー*と*ビューを作成する] を中心に説明します。これにより、モバイル訪問者に提供される機能のサブセットを正確に制御できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="3dbf3-280">ASP.NET MVC アプリケーション内でのモバイルエリアの設定</span><span class="sxs-lookup"><span data-stu-id="3dbf3-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="3dbf3-281">通常の方法で、既存の ASP.NET MVC アプリケーションに "Mobile" という名前の領域を追加できます。ソリューションエクスプローラーでプロジェクト名を右クリックし、[追加] を選択します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="3dbf3-282">その後、ASP.NET MVC アプリケーション内の他の領域の場合と同様に、コントローラーとビューを追加できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="3dbf3-283">たとえば、モバイルユーザーのホームページとして機能する HomeController という新しいコントローラーをモバイルエリアに追加します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="3dbf3-284">URL/モバイルがモバイルホームページに到達することを確認する</span><span class="sxs-lookup"><span data-stu-id="3dbf3-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="3dbf3-285">URL/モバイルでモバイルエリア内の HomeController のインデックスアクションに接続する場合は、ルーティング構成に2つの小さな変更を加える必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="3dbf3-286">まず、次のコードに示すように、MobileAreaRegistration クラスを更新して、HomeController がモバイル領域の既定のコントローラーになるようにします。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="3dbf3-287">つまり、モバイルホームページは、/Mobile/Home ではなく、/mobile に配置されるようになりました。これは、"Home" がモバイルページの既定のコントローラー名として暗黙的に使用されるためです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="3dbf3-288">次に、アプリケーションに2つ目の HomeController (つまり、既存のデスクトップに加えて) を追加すると、通常のデスクトップホームページが破損していることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="3dbf3-289">"*ホーム" という名前のコントローラーと一致する "複数の種類が見つかりまし*た" というエラーが表示され、失敗します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="3dbf3-290">これを解決するには、最上位レベルのルーティング構成 (Global.asax.cs) を更新して、あいまいさがあるときにデスクトップ HomeController が優先されるように指定します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="3dbf3-291">これでエラーが解消されます。 URL http:\/\/*サイト*にアクセスします。また、サイト/mobile/がデスクトップのホームページにアクセスし、http:\/\/*サイト*のホームページに移動します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-291">Now the error will go away, and the URL http:\/\/*yoursite*/ will reach the desktop homepage, and http:\/\/*yoursite*/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="3dbf3-292">モバイルユーザーをモバイルエリアにリダイレクトする</span><span class="sxs-lookup"><span data-stu-id="3dbf3-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="3dbf3-293">多くのさまざまな機能拡張ポイントがある ASP.NET MVC で可能なリダイレクト ロジックを挿入する方法はたくさんありますので。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="3dbf3-294">便利なオプションの1つは、次の条件が満たされた場合にリダイレクトを実行するフィルター属性 [RedirectMobileDevicesToMobileArea] を作成することです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="3dbf3-295">これは、ユーザーのセッションでの最初の要求 (つまり、セッションは true に等しい) です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="3dbf3-296">要求はモバイルブラウザーから取得されます (つまり、IsMobileDevice が true に等しい)</span><span class="sxs-lookup"><span data-stu-id="3dbf3-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="3dbf3-297">ユーザーが既にモバイルエリアにリソースを要求していない (つまり、URL の*パス*部分が/mobile で始まらない)</span><span class="sxs-lookup"><span data-stu-id="3dbf3-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="3dbf3-298">このホワイトペーパーに含まれているダウンロード可能なサンプルには、このロジックの実装が含まれています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="3dbf3-299">AuthorizeAttribute から派生した承認フィルターとして実装されます。これは、出力キャッシュを使用している場合でも正常に動作することを意味します (それ以外の場合、デスクトップのビジターが特定の URL にアクセスすると、デスクトップの出力がキャッシュされ、次のように処理される可能性があります)。その後のモバイル訪問者)。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="3dbf3-300">フィルターとして、特定のコントローラーとアクションに適用するかどうかを選択できます。たとえば、</span><span class="sxs-lookup"><span data-stu-id="3dbf3-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="3dbf3-301">...</span><span class="sxs-lookup"><span data-stu-id="3dbf3-301">…</span></span> <span data-ttu-id="3dbf3-302">また、Global.asax.cs ファイル内のすべてのコントローラーとアクションに MVC 3*グローバルフィルター*として適用することもできます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="3dbf3-303">ダウンロード可能なサンプルでは、モバイル領域内の特定の場所にリダイレクトするこの属性のサブクラスを作成する方法も示しています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="3dbf3-304">つまり、たとえば、次のようなことが可能です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-304">This means, for example, you can:</span></span>

- <span data-ttu-id="3dbf3-305">既定でモバイルホームページにモバイル訪問者を送信するように、上記のようにグローバルフィルターを登録します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="3dbf3-306">また、特別な [RedirectMobileDevicesToMobileProductPage] フィルターを "view product" アクションに適用して、モバイルユーザーが要求したすべての製品ページのモバイルバージョンにモバイル訪問者を与えます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="3dbf3-307">また、フィルターの他の特殊なサブクラスも特定のアクションに適用し、モバイル訪問者を同等のモバイルページにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="3dbf3-308">モバイルページを対象としたフォーム認証の構成</span><span class="sxs-lookup"><span data-stu-id="3dbf3-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="3dbf3-309">フォーム認証を使用している場合は、ユーザーがログインする必要があるときに、ユーザーが1つの特定の "ログオン" URL に自動的にリダイレクトされることに注意してください。これは既定では、 **/Account/LogOn**です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="3dbf3-310">これは、モバイルユーザーがデスクトップの "ログオン" アクションにリダイレクトされる可能性があることを意味します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="3dbf3-311">この問題を回避するには、デスクトップの [ログオン] アクションにロジックを追加して、モバイルユーザーをモバイルの "ログオン" アクションに再リダイレクトするようにします。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="3dbf3-312">既定の ASP.NET MVC アプリケーションテンプレートを使用している場合は、AccountController のログオンアクションを次のように更新します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="3dbf3-313">...</span><span class="sxs-lookup"><span data-stu-id="3dbf3-313">…</span></span> <span data-ttu-id="3dbf3-314">次に、モバイル領域で AccountController というコントローラーに対して、適切なモバイル固有の "ログオン" アクションを実装します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="3dbf3-315">出力キャッシュの操作</span><span class="sxs-lookup"><span data-stu-id="3dbf3-315">Working with Output Caching</span></span>

<span data-ttu-id="3dbf3-316">[OutputCache] フィルターを使用している場合は、デバイスの種類に応じてキャッシュエントリを強制的に変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="3dbf3-317">たとえば、次のように記述します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="3dbf3-318">次に、Global.asax.cs ファイルに次のメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="3dbf3-319">これにより、ページへのモバイル訪問者は、以前にデスクトップ訪問者によってキャッシュに格納された出力を受信しなくなります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="3dbf3-320">実際の例</span><span class="sxs-lookup"><span data-stu-id="3dbf3-320">A working example</span></span>

<span data-ttu-id="3dbf3-321">これらの手法を実際に確認するには、[このホワイトペーパーのコードに関連するサンプル](https://docs.microsoft.com/aspnet/mobile/overview)をダウンロードしてください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="3dbf3-322">このサンプルには、前に説明した方法を使用してモバイルデバイスをサポートするための ASP.NET MVC 3 (リリース候補) アプリケーションが含まれています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="3dbf3-323">その他のガイダンスと提案</span><span class="sxs-lookup"><span data-stu-id="3dbf3-323">Further guidance and suggestions</span></span>

<span data-ttu-id="3dbf3-324">次の説明は、このドキュメントで説明されている手法を使用する Web フォームと MVC 開発者の両方に適用されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="3dbf3-325">51Degrees.mobi Foundation を使用してリダイレクトロジックを拡張する</span><span class="sxs-lookup"><span data-stu-id="3dbf3-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="3dbf3-326">このドキュメントに示されているリダイレクトロジックは、アプリケーションに対して十分であると考えられますが、セッションを無効にする必要がある場合、または cookie を拒否するモバイルブラウザー (セッションがない場合) では、指定された要求があるかどうかがわからないため、機能しません。そのビジターの最初のものです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="3dbf3-327">ここでは、オープンソースの 51Degrees.mobi Foundation が ASP の精度を向上させる方法について学習しました。NET のブラウザーの検出。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="3dbf3-328">また、web.config に構成されている特定の場所にモバイルユーザーをリダイレクトする機能も備えています。訪問者の HTTP ヘッダーと IP アドレスのハッシュの一時的なログを保存することで、ASP.NET セッション (および cookie) に依存することなく作業できます。そのため、各要求が特定の vistor の最初の要求であるかどうかを認識します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="3dbf3-329">Web.config ファイルの fiftyOne セクションに追加された次の要素によって、検出されたモバイルデバイスからページに最初の要求がリダイレクトされます ~/Mobile/Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="3dbf3-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="3dbf3-330">モバイルフォルダーの下にあるページへの要求は、デバイスの種類に関係なくリダイレクトされ*ません*。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="3dbf3-331">モバイルデバイスが20分以上非アクティブになっている場合、デバイスは忘れられ、その後の要求はリダイレクトのために新しい要求として扱われます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="3dbf3-332">詳細については、 [51Degrees.mobi Foundation のドキュメント](https://github.com/51Degrees/dotNET-Device-Detection)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="3dbf3-333">ASP.NET MVC アプリケーションでは、51Degrees.mobi Foundation のリダイレクト機能を使用*できます*が、ルーティングパラメーターやアクションに MVC フィルターを配置することではなく、プレーンな url の観点からリダイレクト構成を定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="3dbf3-334">これは、(書き込み時に) 51Degrees.mobi Foundation がフィルターやルーティングを認識しないためです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>

### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="3dbf3-335">Tricaster とプロキシサーバーの無効化</span><span class="sxs-lookup"><span data-stu-id="3dbf3-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="3dbf3-336">モバイルネットワークオペレーターは、モバイルインターネットへのアプローチに2つの広範な目標を持ちます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="3dbf3-337">可能な限り関連性のあるコンテンツを提供する</span><span class="sxs-lookup"><span data-stu-id="3dbf3-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="3dbf3-338">限られた無線ネットワーク帯域幅を共有できる顧客の数を最大にする</span><span class="sxs-lookup"><span data-stu-id="3dbf3-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="3dbf3-339">ほとんどの web ページは大規模なデスクトップサイズの画面と高速の固定ラインブロードバンド接続向けに設計されているため、多くのオペレーターは、web コンテンツを動的に変更する*tricaster*または*プロキシサーバー*を使用しています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="3dbf3-340">これにより、HTML マークアップまたは CSS が小さな画面に合わせて変更される可能性があります (特に、複雑なレイアウトを処理する処理能力がない "機能フォン" の場合)。また、ページ配信速度を向上させるために、イメージを再圧縮する (品質を大幅に下げる) ことがあります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="3dbf3-341">ただし、モバイルで最適化されたバージョンのサイトを作成するための作業を行ったことがある場合は、ネットワークオペレーターがそれ以上のことを妨げないようにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="3dbf3-342">次の行をページに追加するには、任意の ASP.NET Web フォームに\_Load イベントを追加します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="3dbf3-343">または、ASP.NET MVC コントローラーの場合、次のメソッドオーバーライドを追加して、そのコントローラーのすべてのアクションに適用されるようにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="3dbf3-344">生成された HTTP メッセージは、W3C 準拠の tricaster とプロキシがコンテンツを変更することを通知しません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="3dbf3-345">もちろん、モバイルネットワークオペレーターがこのメッセージを尊重する保証はありません。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="3dbf3-346">モバイルブラウザーのモバイルページのスタイル設定</span><span class="sxs-lookup"><span data-stu-id="3dbf3-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="3dbf3-347">このドキュメントでは、適切に動作する HTML マークアップの種類、または特定のデバイスでの操作性を最大化する web デザイン手法について詳しく説明しています。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="3dbf3-348">信頼性の低い HTML や CSS の配置を使用せずに、モバイルサイズの画面用に最適化された、十分にシンプルなレイアウトを見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="3dbf3-349">ただし、注目すべき重要な手法の1つは、*ビューポートのメタタグ*です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="3dbf3-350">一部の最新のモバイルブラウザーでは、デスクトップモニター用の web ページを表示します。また、"ビューポート" とも呼ばれる仮想キャンバスでページをレンダリングします (たとえば、仮想ビューは iPhone では980ピクセル、既定では850ピクセル幅、Opera Mobile では、既定ではピクセル)。画面の物理的なピクセルに合わせて結果を縮小します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="3dbf3-351">ユーザーは、そのビューポートを拡大してパンできます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="3dbf3-352">これには、ブラウザーが目的のレイアウトでページを表示できるという利点がありますが、ユーザーにとって不便なズームとパンが強制されるという欠点もあります。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="3dbf3-353">モバイル向けに設計している場合は、ズームや水平スクロールが不要になるように、狭い画面をデザインすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="3dbf3-354">モバイルブラウザーにビューポートの幅を指定する方法は、非標準の*ビューポート*のメタタグを使用することです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="3dbf3-355">たとえば、ページの HEAD セクションに次のコードを追加するとします。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="3dbf3-356">...</span><span class="sxs-lookup"><span data-stu-id="3dbf3-356">…</span></span> <span data-ttu-id="3dbf3-357">スマートフォンブラウザーをサポートすると、480ピクセル幅の仮想キャンバス上にページがレイアウトされます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="3dbf3-358">これは、HTML 要素の幅がパーセンテージで定義されている場合、既定のビューポートの幅ではなく、この480ピクセルの幅に対してパーセンテージが解釈されることを意味します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="3dbf3-359">その結果、ユーザーは水平方向にズームしてパンする必要が少なくなり、モバイルブラウズエクスペリエンスが大幅に向上します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="3dbf3-360">ビューポートの幅がデバイスの物理ピクセルと一致するようにするには、次のように指定します。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="3dbf3-361">これが正しく機能するためには、要素の幅を明示的に超えないように明示する必要があります ( *width*属性または CSS プロパティを使用するなど)。そうしないと、ブラウザーはに関係なく、より大きなビューポートを使用するように強制されます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="3dbf3-362">関連項目:[非標準のビューポートの詳細については、](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)「」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="3dbf3-363">最新のスマートフォンは、*両面の向き*をサポートしています。これは、縦モードまたは横モードで保持できます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="3dbf3-364">そのため、画面の幅をピクセル単位で推測しないことが重要です。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="3dbf3-365">画面の幅が固定されていることを想定しないでください。ユーザーが自分のデバイスをページ上に再表示できるためです。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="3dbf3-366">古い Windows Mobile および Blackberry デバイスでは、ページヘッダーに次のメタタグを使用して、コンテンツがモバイル用に最適化されているため、変換できないことを通知することもできます。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="3dbf3-367">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="3dbf3-367">Additional Resources</span></span>

<span data-ttu-id="3dbf3-368">Mobile ASP.NET web アプリケーションをテストするために使用できるモバイルデバイスエミュレーターとシミュレーターの一覧については、「[テスト用の一般的なモバイルデバイスのシミュレート](../mobile/device-simulators.md)」ページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="3dbf3-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="3dbf3-369">謝辞</span><span class="sxs-lookup"><span data-stu-id="3dbf3-369">Credits</span></span>

- <span data-ttu-id="3dbf3-370">プライマリ作成者: 秋山 Sanderson</span><span class="sxs-lookup"><span data-stu-id="3dbf3-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="3dbf3-371">レビュー担当者/追加のコンテンツライター: James Rosewell、Mikael Söderström、Scott マン Selman、Scott Hunter</span><span class="sxs-lookup"><span data-stu-id="3dbf3-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
